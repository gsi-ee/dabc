<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
   <head>
      <title>Draw of single element</title>
      <!--  this file used by THttpServer to display single element -->
      <meta http-equiv="X-UA-Compatible" content="IE=Edge; text/html">
      <script type="text/javascript" src="/jsrootsys/scripts/JSRootCore.js"></script>
   </head>

   <script type='text/javascript'>
   
      var myInterval = null;
      var myCounter = -1;
      var objpainter = null;

      function ResizeTimer() {
        if (myCounter<0) return;
        myCounter += 1;
        if (myCounter < 3) return;

        if (myInterval!=null) {
           clearInterval(myInterval);
           myInterval = null;
        }
        myCounter = -1;
        
        if (objpainter) objpainter.CheckResize();
      }

      function ProcessResize() {  
        if ((objpainter!=null) && (myInterval==null)) {
           myInterval = setInterval(ResizeTimer, 500);
        }
        myCounter = 0;
      }
   
      function CreateDrawGui() {
         var pos = document.URL.indexOf("?");
         var drawopt = "", monitor = -1;
         if (pos>0) {
           var p1 = document.URL.indexOf("opt=", pos);
           if (p1>0) {
              p1+=4;
              var p2 = document.URL.indexOf("&", p1);
              if (p2<0) p2 = document.URL.length;
              drawopt = document.URL.substr(p1, p2-p1);
              // console.log("draw opt = " + drawopt);
           }
           p1 = document.URL.indexOf("monitor");
           if (p1>0) {
             monitor = 3000;
             p1+=7;
             if (document.URL.charAt(p1) == "=") {
                p1++;
                var p2 = document.URL.indexOf("&", p1);
                if (p2<0) p2 = document.URL.length;
                monitor = parseInt(document.URL.substr(p1, p2-p1));
                if (typeof monitor== 'undefined') monitor = 3000; 
             }
            // console.log("monitor = " + monitor);
          }
         }
   
         var drawfunction = function() {
           
            var req = JSROOT.NewHttpRequest("root.json.gz?compact=3", 'text', function(itemres) {
                var obj = JSROOT.parse(itemres);
                if (!obj) return;
                
                if (!objpainter) {
                   objpainter = JSROOT.draw('drawing', obj, drawopt); 
                } else {
                   objpainter.UpdateObject(obj);   
                   objpainter.RedrawFrame();
                }
            });
            
            req.send(null);
         }
   
         drawfunction();
   
         if (monitor>0)
            setInterval(drawfunction, monitor);
   
         window.addEventListener('resize', ProcessResize);
      }
   
   </script>

   <body onload="JSROOT.AssertPrerequisites('2d', CreateDrawGui)">
      <div id="drawing" style="position:absolute; left:2px; top:2px; bottom:2px; right:2px"></div>
   </body>

</html>
