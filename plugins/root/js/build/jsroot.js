// https://root.cern/js/ v7.0.99
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JSROOT=t.JSROOT||{})}(this,(function(t){"use strict";let e="dev",i="2/05/2022",n="dev 2/05/2022";t.source_dir="";let r=!!("object"==typeof process&&process.version&&"object"==typeof process.versions&&process.versions.node&&process.versions.v8),s={id_counter:1};const a="undefined"==typeof document&&"undefined"==typeof location?new(require("url").URL)("file:"+__filename).href:"undefined"==typeof document?location.href:document.currentScript&&document.currentScript.src||new URL("jsroot.min.js",document.baseURI).href;if(a&&"string"==typeof a){const e=a.indexOf("modules/core.mjs");e>=0?(t.source_dir=a.slice(0,e),console.log(`Set jsroot source_dir to ${t.source_dir}, ${n}`)):(console.log(`jsroot bundle, ${n}`),s.ignore_v6=!0)}let o=r;function l(){return o}function h(t){o=!!t}function c(){return r}let d={isOpera:!1,isFirefox:!0,isSafari:!1,isChrome:!1,isWin:!1,touches:!1};function u(t){if(t.length<14||0!=t.indexOf("[object "))return 0;let e=t.indexOf("Array]");return e<0||e!=t.length-6?0:14==t.length?1:2}"undefined"!=typeof document&&"undefined"!=typeof window&&(d.isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,d.isFirefox="undefined"!=typeof InstallTrigger,d.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,d.isChrome=!!window.chrome&&!d.isOpera,d.isChromeHeadless=navigator.userAgent.indexOf("HeadlessChrome")>=0,d.chromeVersion=d.isChrome||d.isChromeHeadless?parseInt(navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)/)[1]):0,d.isWin=navigator.platform.indexOf("Win")>=0,d.touches="ontouchend"in document);let f={Render3D:{Default:0,WebGL:1,WebGLImage:2,SVG:3,fromString:function(t){return"webgl"===t||"gl"==t?this.WebGL:"img"===t?this.WebGLImage:"svg"===t?this.SVG:this.Default}},Embed3D:{NoEmbed:-1,Default:0,Overlay:1,Embed:2,EmbedSVG:3,fromString:function(t){return"embed"===t?this.Embed:"overlay"===t?this.Overlay:this.Default}},Latex:{Off:0,Symbols:1,Normal:2,MathJax:3,AlwaysMathJax:4,fromString:function(t){if(!t||"string"!=typeof t)return this.Normal;switch(t){case"off":return this.Off;case"symbols":return this.Symbols;case"normal":case"latex":case"exp":case"experimental":return this.Normal;case"MathJax":case"mathjax":case"math":return this.MathJax;case"AlwaysMathJax":case"alwaysmath":case"alwaysmathjax":return this.AlwaysMathJax}let e=parseInt(t);return Number.isInteger(e)&&e>=this.Off&&e<=this.AlwaysMathJax?e:this.Normal}}},m={Render3D:f.Render3D.Default,Render3DBatch:f.Render3D.Default,Embed3D:f.Embed3D.Default,Tooltip:!0,TooltipAnimation:500,ContextMenu:!0,Zooming:!0,ZoomMouse:!0,ZoomWheel:!0,ZoomTouch:!0,MoveResize:!0,HandleKeys:!0,DragAndDrop:!0,DragGraphs:!0,ProgressBox:!0,ToolBar:"popup",ToolBarSide:"left",ToolBarVert:!1,CanEnlarge:!0,CanAdjustFrame:!1,ApproxTextSize:!1,OptimizeDraw:1,AutoStat:!0,FrameNDC:{fX1NDC:.07,fY1NDC:.12,fX2NDC:.95,fY2NDC:.88},SmallPad:{width:150,height:100},Palette:57,Latex:f.Latex.Normal,GeoGradPerSegm:6,GeoCompressComp:!0,IgnoreUrlOptions:!1,HierarchyLimit:250,XValuesFormat:void 0,YValuesFormat:void 0,ZValuesFormat:void 0,HandleWrongHttpResponse:!1,UseStamp:!0,SkipStreamerInfos:!1,OnlyLastCycle:!1};r&&Object.assign(m,{ToolBar:!1,Tooltip:0,ContextMenu:!1,Zooming:!1,MoveResize:!1,DragAndDrop:!1,ProgressBox:!1});let p={fOptLogx:0,fOptLogy:0,fOptLogz:0,fOptDate:0,fOptFile:0,fOptTitle:1,fPadBottomMargin:.1,fPadTopMargin:.1,fPadLeftMargin:.1,fPadRightMargin:.1,fPadGridX:!1,fPadGridY:!1,fPadTickX:0,fPadTickY:0,fStatColor:0,fStatTextColor:1,fStatBorderSize:1,fStatFont:42,fStatFontSize:0,fStatStyle:1001,fStatFormat:"6.4g",fStatX:.98,fStatY:.935,fStatW:.2,fStatH:.16,fTitleAlign:23,fTitleColor:0,fTitleTextColor:1,fTitleBorderSize:0,fTitleFont:42,fTitleFontSize:.05,fTitleStyle:0,fTitleX:.5,fTitleY:.995,fTitleW:0,fTitleH:0,fFitFormat:"5.4g",fOptStat:1111,fOptFit:0,fNumberContours:20,fGridColor:0,fGridStyle:3,fGridWidth:1,fFrameFillColor:0,fFrameFillStyle:1001,fFrameLineColor:1,fFrameLineWidth:1,fFrameLineStyle:1,fFrameBorderSize:1,fFrameBorderMode:0,fEndErrorSize:2,fErrorX:.5,fHistMinimumZero:!1,fPaintTextFormat:"g",fTimeOffset:788918400};function g(){return r?s.nodejs_document:"undefined"!=typeof document?document:"object"==typeof window?window.document:void 0}function _(t){if(r){let e,i;return Promise.resolve().then((function(){return Gw})).then((t=>(e=t.tmpNameSync()+".js",Promise.resolve().then((function(){return Gw}))))).then((n=>(i=n,i.writeFileSync(e,t),import("file://"+e)))).finally((()=>i.unlinkSync(e)))}if("undefined"!=typeof document){let e=document.getElementsByTagName("script");for(let i=0;i<e.length;++i)if(e[i].innerHTML==t)return Promise.resolve(!0);let i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.innerHTML=t,document.head.appendChild(i),Promise.resolve(!0)}return Promise.resolve(!1)}function x(e){if(!e)return Promise.resolve(!0);if("string"==typeof e&&e.indexOf(";")>=0&&(e=e.split(";")),"string"!=typeof e){let t=e,i=()=>!t.length||x(t.shift()).then(i,i);return i()}0===e.indexOf("$$$")&&(0==(e=e.slice(3)).indexOf("style/")&&e.indexOf(".css")<0&&(e+=".css"),e=t.source_dir+e);let i,n=e.indexOf(".css")>0;if(r)return n?Promise.resolve(null):0==e.indexOf("http:")||0==e.indexOf("https:")?E(e,"text").then((t=>_(t))):import(e);const s=t=>{if(t==e)return!0;let i=t.indexOf(e);return i>0&&i+e.length==t.length&&"/"==t[i-1]};if(n){let t=document.getElementsByTagName("link");for(let e=0;e<t.length;++e)if(t[e].href&&"text/css"===t[e].type&&"stylesheet"===t[e].rel&&s(t[e].href))return Promise.resolve(!0)}else{let t=document.getElementsByTagName("script");for(let e=0;e<t.length;++e)if(s(t[e].src))return Promise.resolve(!0)}return n?(i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",e)):(i=document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("src",e)),new Promise(((t,n)=>{i.onload=()=>t(!0),i.onerror=()=>{i.remove(),n(Error(`Fail to load ${e}`))},document.head.appendChild(i)}))}function y(t){return 1<<t}function A(t,e,i){if(!t)return null;if(e){const i=e.obj.indexOf(t);if(i>=0)return e.clones[i]}else e={obj:[],clones:[],nofunc:i};let n=u(Object.prototype.toString.apply(t));if(1==n){let i=[];e.obj.push(t),e.clones.push(i);for(let n=0;n<t.length;++n)"object"==typeof t[n]?i.push(A(t[n],e)):i.push(t[n]);return i}if(2==n){let i=[];e.obj.push(t),e.clones.push(i);for(let e=0;e<t.length;++e)i.push(t[e]);return i}let r={};e.obj.push(t),e.clones.push(r);for(let i in t)"object"==typeof t[i]?r[i]=A(t[i],e):e.nofunc&&"function"==typeof t[i]||(r[i]=t[i]);return r}const v=Object.assign;function b(t,e){v(t,N(e||t._typename,t))}function w(t){if(!t)return null;let e,i="string"==typeof t?JSON.parse(t):t,n=[];const s=t=>{if(null==t)return;if("string"==typeof t){if(e||t.length<6||0!==t.indexOf("$ref:"))return;let i=parseInt(t.slice(5));if(!Number.isInteger(i)||i<0||i>=n.length)return;return e=!1,n[i]}if("object"!=typeof t)return;if(u(Object.prototype.toString.apply(t))>0){for(let e=0;e<t.length;++e){let i=s(t[e]);void 0!==i&&(t[e]=i)}return}let i=Object.keys(t),a=i.length;if(!1!==e&&1===a&&"$ref"===i[0]){const i=parseInt(t.$ref);if(!Number.isInteger(i)||i<0||i>=n.length)return;return e=!0,n[i]}if(!1!==e&&a>1&&"$arr"===i[0]&&"len"===i[1]){let e;switch(t.$arr){case"Int8":e=new Int8Array(t.len);break;case"Uint8":e=new Uint8Array(t.len);break;case"Int16":e=new Int16Array(t.len);break;case"Uint16":e=new Uint16Array(t.len);break;case"Int32":e=new Int32Array(t.len);break;case"Uint32":e=new Uint32Array(t.len);break;case"Float32":e=new Float32Array(t.len);break;case"Int64":case"Uint64":case"Float64":e=new Float64Array(t.len);break;default:e=new Array(t.len)}if(e.fill("Bool"!==t.$arr&&0),void 0!==t.b){let i=(r?undefined:window.atob)(t.b);if(!e.buffer)throw new Error("base64 coding supported only for native arrays with binary data");{let n=new DataView(e.buffer,t.o||0),r=Math.min(i.length,n.byteLength);for(let t=0;t<r;++t)n.setUint8(t,i.charCodeAt(t))}}else{let n=2,r=0;for(;n<a;){if("p"==i[n][0]&&(r=t[i[n++]]),"v"!==i[n][0])throw new Error("Unexpected member "+i[n]+" in array decoding");let s=t[i[n++]];if("object"==typeof s)for(let t=0;t<s.length;++t)e[r++]=s[t];else if(e[r++]=s,n<a&&"n"==i[n][0]){let a=t[i[n++]];for(;--a;)e[r++]=s}}}return e}if(!1!==e&&3===a&&"$pair"===i[0]&&"first"===i[1]&&"second"===i[2]){e=!0;let i=s(t.first),n=s(t.second);return void 0!==i&&(t.first=i),void 0!==n&&(t.second=n),t._typename=t.$pair,void delete t.$pair}if(!(n.indexOf(t)>=0)){n.push(t),t._typename&&b(t);for(let e=0;e<a;++e){const n=i[e],r=s(t[n]);void 0!==r&&(t[n]=r)}}};return s(i),i}function M(t){if(!t)return null;let e=w(t);if(e&&e.length)for(let t=0;t<e.length;++t)e[t]=w(e[t]);return e}function T(t,e){if(!t||"object"!=typeof t)return"";let i=[];const n=t=>{if("function"==typeof t)return;if(null==t||"object"!=typeof t)return t;if(u(Object.prototype.toString.apply(t))>0){let e=new Array(t.length);for(let i=0;i<t.length;++i)e[i]=n(t[i]);return e}let e=i.indexOf(t);if(e>=0)return{$ref:e};let r=Object.keys(t),s=r.length,a={};if(3==s&&"$pair"===r[0]&&"first"===r[1]&&"second"===r[2])return a.$pair=t.$pair,a.first=n(t.first),a.second=n(t.second),a;i.push(t);for(let e=0;e<s;++e){let i=r[e];i&&"$"!=i[0]&&(a[i]=n(t[i]))}return a};let r=n(t);return JSON.stringify(r,null,e)}function S(t){let e={opts:{},has:function(t){return void 0!==this.opts[t]},get:function(t,e){let i=this.opts[t];return void 0!==i?i:e}};if(!t||"string"!=typeof t){if(m.IgnoreUrlOptions||"undefined"==typeof document)return e;t=document.URL}e.url=t;let i=t.indexOf("?");if(i<0)return e;for(t=decodeURI(t.slice(i+1));t.length>0;){let i=0,n=0,r=-1,s=-1;for(;i<t.length&&(0!==n||"&"!==t[i]&&"#"!==t[i]);){switch(t[i]){case"'":n>=0&&(n=(n+1)%2),s<0&&(s=i);break;case'"':n<=0&&(n=(n-1)%2),s<0&&(s=i);break;case"=":s<0&&r<0&&(r=i)}i++}if(r<0&&s<0&&(e.opts[t.slice(0,i)]=""),r>0){let n=t.slice(r+1,i);"'"!==n[0]&&'"'!==n[0]||n[0]!==n[n.length-1]||(n=n.slice(1,n.length-1)),e.opts[t.slice(0,r)]=n}if(i>=t.length||"#"==t[i])break;t=t.slice(i+1)}return e}function C(t){if("function"==typeof t)return t;if("string"!=typeof t)return null;let e=t.split("."),i=globalThis;for(let t=0;i&&t<e.length;++t)i=i[e[t]];return"function"==typeof i?i:null}function P(t,e,i,n){let s=r?new undefined:new XMLHttpRequest;s.http_callback="function"==typeof i?i.bind(s):function(){},s.error_callback="function"==typeof n?n.bind(s):function(t){console.warn(t.message),this.http_callback(null)}.bind(s),e||(e="buf");let a="GET",o=!0,l=e.indexOf(";sync");switch(l>0&&(e=e.slice(0,l),o=!1),e){case"head":a="HEAD";break;case"posttext":a="POST",e="text";break;case"postbuf":a="POST",e="buf";break;case"post":case"multi":a="POST"}return s.kind=e,m.HandleWrongHttpResponse&&"GET"==a&&"function"==typeof s.addEventListener&&s.addEventListener("progress",function(t){t.lengthComputable&&this.expected_size&&t.loaded>this.expected_size&&(this.did_abort=!0,this.abort(),this.error_callback(Error("Server sends more bytes "+t.loaded+" than expected "+this.expected_size+". Abort I/O operation"),598))}.bind(s)),s.onreadystatechange=function(){if(!this.did_abort){if(2===this.readyState&&this.expected_size){let t=parseInt(this.getResponseHeader("Content-Length"));if(Number.isInteger(t)&&t>this.expected_size&&!m.HandleWrongHttpResponse)return this.did_abort=!0,this.abort(),this.error_callback(Error("Server response size "+t+" larger than expected "+this.expected_size+". Abort I/O operation"),599)}if(4==this.readyState){if(200!=this.status&&206!=this.status&&!d.qt5&&(0!=this.status||0!=t.indexOf("file://")&&0!=t.indexOf("blob:")))return this.error_callback(Error("Fail to load url "+t),this.status);if(this.nodejs_checkzip&&"gzip"==this.getResponseHeader("content-encoding"))return import("zlib").then((t=>{let e=t.unzipSync(Buffer.from(this.response)),i=JSON.parse(e);return this.http_callback(w(i))}));switch(this.kind){case"xml":return this.http_callback(this.responseXML);case"text":return this.http_callback(this.responseText);case"object":return this.http_callback(w(this.responseText));case"multi":return this.http_callback(M(this.responseText));case"head":return this.http_callback(this)}if(void 0===this.responseType)return this.http_callback(this.responseText);if("bin"==this.kind&&"byteLength"in this.response){let t="",e=new Uint8Array(this.response);for(let i=0;i<e.length;++i)t+=String.fromCharCode(e[i]);return this.http_callback(t)}this.http_callback(this.response)}}},s.open(a,t,o),"bin"!=e&&"buf"!=e||(s.responseType="arraybuffer"),r&&"GET"==a&&"object"===e&&t.indexOf(".json.gz")>0&&(s.nodejs_checkzip=!0,s.responseType="arraybuffer"),s}function E(t,e,i){return new Promise(((n,r)=>{P(t,e,n,r).send(i||null)}))}function k(t,e){let i=e||{};switch(t){case"TObject":v(i,{fUniqueID:0,fBits:0});break;case"TNamed":v(i,{fUniqueID:0,fBits:0,fName:"",fTitle:""});break;case"TList":case"THashList":v(i,{name:t,arr:[],opt:[]});break;case"TAttAxis":v(i,{fNdivisions:510,fAxisColor:1,fLabelColor:1,fLabelFont:42,fLabelOffset:.005,fLabelSize:.035,fTickLength:.03,fTitleOffset:1,fTitleSize:.035,fTitleColor:1,fTitleFont:42});break;case"TAxis":k("TNamed",i),k("TAttAxis",i),v(i,{fNbins:1,fXmin:0,fXmax:1,fXbins:[],fFirst:0,fLast:0,fBits2:0,fTimeDisplay:!1,fTimeFormat:"",fLabels:null,fModLabs:null});break;case"TAttLine":v(i,{fLineColor:1,fLineStyle:1,fLineWidth:1});break;case"TAttFill":v(i,{fFillColor:0,fFillStyle:0});break;case"TAttMarker":v(i,{fMarkerColor:1,fMarkerStyle:1,fMarkerSize:1});break;case"TLine":k("TObject",i),k("TAttLine",i),v(i,{fX1:0,fX2:1,fY1:0,fY2:1});break;case"TBox":k("TObject",i),k("TAttLine",i),k("TAttFill",i),v(i,{fX1:0,fX2:1,fY1:0,fY2:1});break;case"TPave":k("TBox",i),v(i,{fX1NDC:0,fY1NDC:0,fX2NDC:1,fY2NDC:1,fBorderSize:0,fInit:1,fShadowColor:1,fCornerRadius:0,fOption:"blNDC",fName:"title"});break;case"TAttText":v(i,{fTextAngle:0,fTextSize:0,fTextAlign:22,fTextColor:1,fTextFont:42});break;case"TPaveText":k("TPave",i),k("TAttText",i),v(i,{fLabel:"",fLongest:27,fMargin:.05,fLines:k("TList")});break;case"TPaveStats":k("TPaveText",i),v(i,{fOptFit:0,fOptStat:0,fFitFormat:"",fStatFormat:"",fParent:null});break;case"TLegend":k("TPave",i),k("TAttText",i),v(i,{fColumnSeparation:0,fEntrySeparation:.1,fMargin:.25,fNColumns:1,fPrimitives:k("TList")});break;case"TLegendEntry":k("TObject",i),k("TAttText",i),k("TAttLine",i),k("TAttFill",i),k("TAttMarker",i),v(i,{fLabel:"",fObject:null,fOption:""});break;case"TText":k("TNamed",i),k("TAttText",i),v(i,{fLimitFactorSize:3,fOriginSize:.04});break;case"TLatex":k("TText",i),k("TAttLine",i),v(i,{fX:0,fY:0});break;case"TObjString":k("TObject",i),v(i,{fString:""});break;case"TH1":k("TNamed",i),k("TAttLine",i),k("TAttFill",i),k("TAttMarker",i),v(i,{fBits:8,fNcells:0,fXaxis:k("TAxis"),fYaxis:k("TAxis"),fZaxis:k("TAxis"),fBarOffset:0,fBarWidth:1e3,fEntries:0,fTsumw:0,fTsumw2:0,fTsumwx:0,fTsumwx2:0,fMaximum:-1111,fMinimum:-1111,fNormFactor:0,fContour:[],fSumw2:[],fOption:"",fFunctions:k("TList"),fBufferSize:0,fBuffer:[],fBinStatErrOpt:0,fStatOverflows:2});break;case"TH1I":case"TH1L64":case"TH1F":case"TH1D":case"TH1S":case"TH1C":k("TH1",i),i.fArray=[];break;case"TH2":k("TH1",i),v(i,{fScalefactor:1,fTsumwy:0,fTsumwy2:0,fTsumwxy:0});break;case"TH2I":case"TH2L64":case"TH2F":case"TH2D":case"TH2S":case"TH2C":k("TH2",i),i.fArray=[];break;case"TH3":k("TH1",i),v(i,{fTsumwy:0,fTsumwy2:0,fTsumwz:0,fTsumwz2:0,fTsumwxy:0,fTsumwxz:0,fTsumwyz:0});break;case"TH3I":case"TH3L64":case"TH3F":case"TH3D":case"TH3S":case"TH3C":k("TH3",i),i.fArray=[];break;case"THStack":k("TNamed",i),v(i,{fHists:k("TList"),fHistogram:null,fMaximum:-1111,fMinimum:-1111});break;case"TGraph":k("TNamed",i),k("TAttLine",i),k("TAttFill",i),k("TAttMarker",i),v(i,{fFunctions:k("TList"),fHistogram:null,fMaxSize:0,fMaximum:-1111,fMinimum:-1111,fNpoints:0,fX:[],fY:[]});break;case"TGraphAsymmErrors":k("TGraph",i),v(i,{fEXlow:[],fEXhigh:[],fEYlow:[],fEYhigh:[]});break;case"TMultiGraph":k("TNamed",i),v(i,{fFunctions:k("TList"),fGraphs:k("TList"),fHistogram:null,fMaximum:-1111,fMinimum:-1111});break;case"TGraphPolargram":k("TNamed",i),k("TAttText",i),k("TAttLine",i),v(i,{fRadian:!0,fDegree:!1,fGrad:!1,fPolarLabelColor:1,fRadialLabelColor:1,fAxisAngle:0,fPolarOffset:.04,fPolarTextSize:.04,fRadialOffset:.025,fRadialTextSize:.035,fRwrmin:0,fRwrmax:1,fRwtmin:0,fRwtmax:2*Math.PI,fTickpolarSize:.02,fPolarLabelFont:62,fRadialLabelFont:62,fCutRadial:0,fNdivRad:508,fNdivPol:508});break;case"TPolyLine":k("TObject",i),k("TAttLine",i),k("TAttFill",i),v(i,{fLastPoint:-1,fN:0,fOption:"",fX:null,fY:null});break;case"TGaxis":k("TLine",i),k("TAttText",i),v(i,{fChopt:"",fFunctionName:"",fGridLength:0,fLabelColor:1,fLabelFont:42,fLabelOffset:.005,fLabelSize:.035,fName:"",fNdiv:12,fTickSize:.02,fTimeFormat:"",fTitle:"",fTitleOffset:1,fTitleSize:.035,fWmax:100,fWmin:0});break;case"TAttPad":v(i,{fLeftMargin:p.fPadLeftMargin,fRightMargin:p.fPadRightMargin,fBottomMargin:p.fPadBottomMargin,fTopMargin:p.fPadTopMargin,fXfile:2,fYfile:2,fAfile:1,fXstat:.99,fYstat:.99,fAstat:2,fFrameFillColor:p.fFrameFillColor,fFrameFillStyle:p.fFrameFillStyle,fFrameLineColor:p.fFrameLineColor,fFrameLineWidth:p.fFrameLineWidth,fFrameLineStyle:p.fFrameLineStyle,fFrameBorderSize:p.fFrameBorderSize,fFrameBorderMode:p.fFrameBorderMode});break;case"TPad":k("TObject",i),k("TAttLine",i),k("TAttFill",i),k("TAttPad",i),v(i,{fX1:0,fY1:0,fX2:1,fY2:1,fXtoAbsPixelk:1,fXtoPixelk:1,fXtoPixel:1,fYtoAbsPixelk:1,fYtoPixelk:1,fYtoPixel:1,fUtoAbsPixelk:1,fUtoPixelk:1,fUtoPixel:1,fVtoAbsPixelk:1,fVtoPixelk:1,fVtoPixel:1,fAbsPixeltoXk:1,fPixeltoXk:1,fPixeltoX:1,fAbsPixeltoYk:1,fPixeltoYk:1,fPixeltoY:1,fXlowNDC:0,fYlowNDC:0,fXUpNDC:0,fYUpNDC:0,fWNDC:1,fHNDC:1,fAbsXlowNDC:0,fAbsYlowNDC:0,fAbsWNDC:1,fAbsHNDC:1,fUxmin:0,fUymin:0,fUxmax:0,fUymax:0,fTheta:30,fPhi:30,fAspectRatio:0,fNumber:0,fLogx:p.fOptLogx,fLogy:p.fOptLogy,fLogz:p.fOptLogz,fTickx:p.fPadTickX,fTicky:p.fPadTickY,fPadPaint:0,fCrosshair:0,fCrosshairPos:0,fBorderSize:2,fBorderMode:0,fModified:!1,fGridx:p.fPadGridX,fGridy:p.fPadGridY,fAbsCoord:!1,fEditable:!0,fFixedAspectRatio:!1,fPrimitives:k("TList"),fExecs:null,fName:"pad",fTitle:"canvas"});break;case"TAttCanvas":v(i,{fXBetween:2,fYBetween:2,fTitleFromTop:1.2,fXdate:.2,fYdate:.3,fAdate:1});break;case"TCanvas":k("TPad",i),v(i,{fNumPaletteColor:0,fNextPaletteColor:0,fDISPLAY:"$DISPLAY",fDoubleBuffer:0,fRetained:!0,fXsizeUser:0,fYsizeUser:0,fXsizeReal:20,fYsizeReal:10,fWindowTopX:0,fWindowTopY:0,fWindowWidth:0,fWindowHeight:0,fCw:500,fCh:300,fCatt:k("TAttCanvas"),kMoveOpaque:!0,kResizeOpaque:!0,fHighLightColor:5,fBatch:!0,kShowEventStatus:!1,kAutoExec:!0,kMenuBar:!0});break;case"TGeoVolume":k("TNamed",i),k("TAttLine",i),k("TAttFill",i),v(i,{fGeoAtt:0,fFinder:null,fMedium:null,fNodes:null,fNtotal:0,fNumber:0,fRefCount:0,fShape:null,fVoxels:null});break;case"TGeoNode":k("TNamed",i),v(i,{fGeoAtt:0,fMother:null,fNovlp:0,fNumber:0,fOverlaps:null,fVolume:null});break;case"TGeoNodeMatrix":k("TGeoNode",i),v(i,{fMatrix:null});break;case"TGeoTrack":k("TObject",i),k("TAttLine",i),k("TAttMarker",i),v(i,{fGeoAtt:0,fNpoints:0,fPoints:[]})}return i._typename=t,b(i,t),i}function D(t,e,i,n){let r=k(t);if(!r.fXaxis||!r.fYaxis||!r.fZaxis)return null;switch(r.fName="hist",r.fTitle="title",e&&v(r.fXaxis,{fNbins:e,fXmin:0,fXmax:e}),i&&v(r.fYaxis,{fNbins:i,fXmin:0,fXmax:i}),n&&v(r.fZaxis,{fNbins:n,fXmin:0,fXmax:n}),parseInt(t[2])){case 1:e&&(r.fNcells=e+2);break;case 2:e&&i&&(r.fNcells=(e+2)*(i+2));break;case 3:e&&i&&n&&(r.fNcells=(e+2)*(i+2)*(n+2))}if(r.fNcells>0){switch(t[3]){case"C":r.fArray=new Int8Array(r.fNcells);break;case"S":r.fArray=new Int16Array(r.fNcells);break;case"I":r.fArray=new Int32Array(r.fNcells);break;case"F":r.fArray=new Float32Array(r.fNcells);break;case"L":case"D":r.fArray=new Float64Array(r.fNcells);break;default:r.fArray=new Array(r.fNcells)}r.fArray.fill(0)}return r}function z(t,e){let i=k("TPolyLine");return t&&(i.fN=t,e?(i.fX=new Int32Array(t),i.fY=new Int32Array(t)):(i.fX=new Float32Array(t),i.fY=new Float32Array(t))),i}function O(t,e,i){let n=v(k("TGraph"),{fBits:1032,fName:"graph",fTitle:"title"});if(t>0){n.fMaxSize=n.fNpoints=t;const r="object"==typeof e&&e.length===t,s="object"==typeof i&&i.length===t;for(let a=0;a<t;++a)n.fX.push(r?e[a]:a/t),n.fY.push(s?i[a]:a/t)}return n}function R(){let t=k("THStack");for(let e=0;e<arguments.length;++e)t.fHists.Add(arguments[e],"");return t}function L(){let t=k("TMultiGraph");for(let e=0;e<arguments.length;++e)t.fGraphs.Add(arguments[e],"");return t}const B={};function N(t,e){let i=B[t],n=void 0!==i;return n||(i={}),("TObject"==t||"TNamed"==t||e&&void 0!==e.fBits)&&void 0===i.TestBit&&(i.TestBit=function(t){return 0!=(this.fBits&t)},i.InvertBit=function(t){this.fBits=this.fBits^16777215&t}),n||("TList"!==t&&"THashList"!==t||(i.Clear=function(){this.arr=[],this.opt=[]},i.Add=function(t,e){this.arr.push(t),this.opt.push(e&&"string"==typeof e?e:"")},i.AddFirst=function(t,e){this.arr.unshift(t),this.opt.unshift(e&&"string"==typeof e?e:"")},i.RemoveAt=function(t){this.arr.splice(t,1),this.opt.splice(t,1)}),"TPaveText"!==t&&"TPaveStats"!==t||(i.AddText=function(t){let e=k("TLatex");e.fTitle=t,this.fLines.Add(e)},i.Clear=function(){this.fLines.Clear()}),0!=t.indexOf("TF1")&&"TF2"!==t||(i.addFormula=function(t){t&&(void 0===this.formulas&&(this.formulas=[]),this.formulas.push(t))},i.GetParName=function(t){if(this.fParams&&this.fParams.fParNames)return this.fParams.fParNames[t];if(this.fFormula&&this.fFormula.fParams)for(let e=0;e<this.fFormula.fParams.length;++e)if(this.fFormula.fParams[e].second==t)return this.fFormula.fParams[e].first;return this.fNames&&this.fNames[t]?this.fNames[t]:"p"+t},i.GetParValue=function(t){return this.fParams&&this.fParams.fParameters?this.fParams.fParameters[t]:this.fFormula&&this.fFormula.fClingParameters?this.fFormula.fClingParameters[t]:this.fParams?this.fParams[t]:void 0},i.GetParError=function(t){return this.fParErrors?this.fParErrors[t]:void 0},i.GetNumPars=function(){return this.fNpar}),0!=t.indexOf("TGraph")&&"TCutG"!=t||"TGraphPolargram"==t||"TGraphTime"==t||(i.IsInside=function(t,e){let i=0,n=this.fNpoints-1,r=this.fX,s=this.fY,a=!1;for(;i<this.fNpoints;++i)(s[i]<e&&s[n]>=e||s[n]<e&&s[i]>=e)&&r[i]+(e-s[i])/(s[n]-s[i])*(r[n]-r[i])<t&&(a=!a),n=i;return a}),0!=t.indexOf("TH1")&&0!=t.indexOf("TH2")&&0!=t.indexOf("TH3")||(i.getBinError=function(t){return t>=this.fNcells&&(t=this.fNcells-1),t<0&&(t=0),t<this.fSumw2.length?Math.sqrt(this.fSumw2[t]):Math.sqrt(Math.abs(this.fArray[t]))},i.setBinContent=function(t,e){this.fEntries++,this.fTsumw=0,t>=0&&t<this.fArray.length&&(this.fArray[t]=e)}),0==t.indexOf("TH1")&&(i.getBin=function(t){return t},i.getBinContent=function(t){return this.fArray[t]},i.Fill=function(t,e){let i=this.fXaxis,n=1+Math.floor((t-i.fXmin)/(i.fXmax-i.fXmin)*i.fNbins);n<0?n=0:n>i.fNbins+1&&(n=i.fNbins+1),this.fArray[n]+=void 0===e?1:e,this.fEntries++}),0==t.indexOf("TH2")&&(i.getBin=function(t,e){return t+(this.fXaxis.fNbins+2)*e},i.getBinContent=function(t,e){return this.fArray[this.getBin(t,e)]},i.Fill=function(t,e,i){let n=this.fXaxis,r=this.fYaxis,s=1+Math.floor((t-n.fXmin)/(n.fXmax-n.fXmin)*n.fNbins),a=1+Math.floor((e-r.fXmin)/(r.fXmax-r.fXmin)*r.fNbins);s<0?s=0:s>n.fNbins+1&&(s=n.fNbins+1),a<0?a=0:a>r.fNbins+1&&(a=r.fNbins+1),this.fArray[s+(n.fNbins+2)*a]+=void 0===i?1:i,this.fEntries++}),0==t.indexOf("TH3")&&(i.getBin=function(t,e,i){return t+(this.fXaxis.fNbins+2)*(e+(this.fYaxis.fNbins+2)*i)},i.getBinContent=function(t,e,i){return this.fArray[this.getBin(t,e,i)]},i.Fill=function(t,e,i,n){let r=this.fXaxis,s=this.fYaxis,a=this.fZaxis,o=1+Math.floor((t-r.fXmin)/(r.fXmax-r.fXmin)*r.fNbins),l=1+Math.floor((e-s.fXmin)/(s.fXmax-s.fXmin)*s.fNbins),h=1+Math.floor((i-a.fXmin)/(a.fXmax-a.fXmin)*a.fNbins);o<0?o=0:o>r.fNbins+1&&(o=r.fNbins+1),l<0?l=0:l>s.fNbins+1&&(l=s.fNbins+1),h<0?h=0:h>a.fNbins+1&&(h=a.fNbins+1),this.fArray[o+(r.fNbins+2)*(l+(s.fNbins+2)*h)]+=void 0===n?1:n,this.fEntries++}),0==t.indexOf("TProfile")&&(0==t.indexOf("TProfile2D")?(i.getBin=function(t,e){return t+(this.fXaxis.fNbins+2)*e},i.getBinContent=function(t,e){let i=this.getBin(t,e);return i<0||i>=this.fNcells||this.fBinEntries[i]<1e-300?0:this.fArray?this.fArray[i]/this.fBinEntries[i]:0},i.getBinEntries=function(t,e){let i=this.getBin(t,e);return i<0||i>=this.fNcells?0:this.fBinEntries[i]}):(i.getBin=function(t){return t},i.getBinContent=function(t){return t<0||t>=this.fNcells||this.fBinEntries[t]<1e-300?0:this.fArray?this.fArray[t]/this.fBinEntries[t]:0}),i.getBinEffectiveEntries=function(t){if(t<0||t>=this.fNcells)return 0;let e=this.fBinEntries[t];if(!this.fBinSumw2||this.fBinSumw2.length!=this.fNcells)return e;let i=this.fBinSumw2[t];return i>0?e*e/i:0},i.getBinError=function(t){if(t<0||t>=this.fNcells)return 0;let e=this.fArray[t],i=this.fBinEntries[t],n=this.fSumw2[t],r=this.getBinEffectiveEntries(t);if(i<1e-300)return 0;const s=1,a=2,o=3;if(this.fErrorMode===o)return 1/Math.sqrt(i);let l=e/i,h=Math.sqrt(Math.abs(n/i-l*l));return this.fErrorMode===a?0!=h?h/Math.sqrt(r):1/Math.sqrt(12*r):this.fErrorMode===s?h:h/Math.sqrt(r)}),"TAxis"==t&&(i.GetBinLowEdge=function(t){return this.fNbins<=0?0:this.fXbins.length>0&&t>0&&t<=this.fNbins?this.fXbins[t-1]:this.fXmin+(t-1)*(this.fXmax-this.fXmin)/this.fNbins},i.GetBinCenter=function(t){return this.fNbins<=0?0:this.fXbins.length>0&&t>0&&t<this.fNbins?(this.fXbins[t-1]+this.fXbins[t])/2:this.fXmin+(t-.5)*(this.fXmax-this.fXmin)/this.fNbins}),0===t.indexOf("ROOT::Math::LorentzVector")&&(i.Px=i.X=function(){return this.fCoordinates.Px()},i.Py=i.Y=function(){return this.fCoordinates.Py()},i.Pz=i.Z=function(){return this.fCoordinates.Pz()},i.E=i.T=function(){return this.fCoordinates.E()},i.M2=function(){return this.fCoordinates.M2()},i.M=function(){return this.fCoordinates.M()},i.R=i.P=function(){return this.fCoordinates.R()},i.P2=function(){return this.P()*this.P()},i.Pt=i.pt=function(){return Math.sqrt(this.P2())},i.Phi=i.phi=function(){return Math.atan2(this.fCoordinates.Py(),this.fCoordinates.Px())},i.Eta=i.eta=function(){return Math.atanh(this.Pz()/this.P())}),0===t.indexOf("ROOT::Math::PxPyPzE4D")&&(i.Px=i.X=function(){return this.fX},i.Py=i.Y=function(){return this.fY},i.Pz=i.Z=function(){return this.fZ},i.E=i.T=function(){return this.fT},i.P2=function(){return this.fX*this.fX+this.fY*this.fY+this.fZ*this.fZ},i.R=i.P=function(){return Math.sqrt(this.P2())},i.Mag2=i.M2=function(){return this.fT*this.fT-this.fX*this.fX-this.fY*this.fY-this.fZ*this.fZ},i.Mag=i.M=function(){let t=this.M2();return t>=0?Math.sqrt(t):-Math.sqrt(-t)},i.Perp2=i.Pt2=function(){return this.fX*this.fX+this.fY*this.fY},i.Pt=i.pt=function(){return Math.sqrt(this.P2())},i.Phi=i.phi=function(){return Math.atan2(this.fY,this.fX)},i.Eta=i.eta=function(){return Math.atanh(this.Pz/this.P())}),B[t]=i),i}function F(t,e){B[t]=e}function I(t,e){if(t&&"object"==typeof t){if("TList"===t.$kind||"TObjArray"===t.$kind)return!0;e||(e=t._typename)}return!!e&&("TList"===e||"THashList"===e||"TMap"===e||"TObjArray"===e||"TClonesArray"===e)}function q(t){return t&&"object"==typeof t&&"function"==typeof t.then}function U(){return(globalThis.JSROOT?Promise.resolve(!0):x(t.source_dir+"scripts/JSRoot.core.js")).then((()=>{if(globalThis.JSROOT?._complete_loading)return globalThis.JSROOT._complete_loading()})).then((()=>globalThis.JSROOT))}var G=Object.freeze({__proto__:null,version_id:e,version_date:i,version:n,get source_dir(){return t.source_dir},isNodeJs:c,isBatchMode:l,setBatchMode:h,browser:d,internals:s,constants:f,settings:m,gStyle:p,isArrayProto:u,getDocument:g,BIT:y,clone:A,addMethods:b,parse:w,parseMulti:M,toJSON:T,decodeUrl:S,findFunction:C,createHttpRequest:P,httpRequest:E,loadScript:x,injectCode:_,create:k,createHistogram:D,createTPolyLine:z,createTGraph:O,createTHStack:R,createTMultiGraph:L,getMethods:N,registerMethods:F,isRootCollection:I,isPromise:q,_ensureJSROOT:U});function H(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function X(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function V(){}var Y=.7,$=1/Y,W="\\s*([+-]?\\d+)\\s*",Z="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Q="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",J=/^#([0-9a-f]{3,8})$/,K=new RegExp("^rgb\\("+[W,W,W]+"\\)$"),tt=new RegExp("^rgb\\("+[Q,Q,Q]+"\\)$"),et=new RegExp("^rgba\\("+[W,W,W,Z]+"\\)$"),it=new RegExp("^rgba\\("+[Q,Q,Q,Z]+"\\)$"),nt=new RegExp("^hsl\\("+[Z,Q,Q]+"\\)$"),rt=new RegExp("^hsla\\("+[Z,Q,Q,Z]+"\\)$"),st={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function at(){return this.rgb().formatHex()}function ot(){return this.rgb().formatRgb()}function lt(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=J.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?ht(e):3===i?new ft(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?ct(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?ct(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=K.exec(t))?new ft(e[1],e[2],e[3],1):(e=tt.exec(t))?new ft(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=et.exec(t))?ct(e[1],e[2],e[3],e[4]):(e=it.exec(t))?ct(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=nt.exec(t))?_t(e[1],e[2]/100,e[3]/100,1):(e=rt.exec(t))?_t(e[1],e[2]/100,e[3]/100,e[4]):st.hasOwnProperty(t)?ht(st[t]):"transparent"===t?new ft(NaN,NaN,NaN,0):null}function ht(t){return new ft(t>>16&255,t>>8&255,255&t,1)}function ct(t,e,i,n){return n<=0&&(t=e=i=NaN),new ft(t,e,i,n)}function dt(t){return t instanceof V||(t=lt(t)),t?new ft((t=t.rgb()).r,t.g,t.b,t.opacity):new ft}function ut(t,e,i,n){return 1===arguments.length?dt(t):new ft(t,e,i,null==n?1:n)}function ft(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}function mt(){return"#"+gt(this.r)+gt(this.g)+gt(this.b)}function pt(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function gt(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function _t(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new yt(t,e,i,n)}function xt(t){if(t instanceof yt)return new yt(t.h,t.s,t.l,t.opacity);if(t instanceof V||(t=lt(t)),!t)return new yt;if(t instanceof yt)return t;var e=(t=t.rgb()).r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),s=Math.max(e,i,n),a=NaN,o=s-r,l=(s+r)/2;return o?(a=e===s?(i-n)/o+6*(i<n):i===s?(n-e)/o+2:(e-i)/o+4,o/=l<.5?s+r:2-s-r,a*=60):o=l>0&&l<1?0:a,new yt(a,o,l,t.opacity)}function yt(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}function At(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}H(V,lt,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:at,formatHex:at,formatHsl:function(){return xt(this).formatHsl()},formatRgb:ot,toString:ot}),H(ft,ut,X(V,{brighter:function(t){return t=null==t?$:Math.pow($,t),new ft(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Y:Math.pow(Y,t),new ft(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mt,formatHex:mt,formatRgb:pt,toString:pt})),H(yt,(function(t,e,i,n){return 1===arguments.length?xt(t):new yt(t,e,i,null==n?1:n)}),X(V,{brighter:function(t){return t=null==t?$:Math.pow($,t),new yt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Y:Math.pow(Y,t),new yt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new ft(At(t>=240?t-240:t+120,r,n),At(t,r,n),At(t<120?t+240:t-120,r,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const vt=Math.PI/180,bt=180/Math.PI,wt=.96422,Mt=.82521,Tt=4/29,St=6/29,Ct=3*St*St;function Pt(t){if(t instanceof Et)return new Et(t.l,t.a,t.b,t.opacity);if(t instanceof Lt)return Bt(t);t instanceof ft||(t=dt(t));var e,i,n=Ot(t.r),r=Ot(t.g),s=Ot(t.b),a=kt((.2225045*n+.7168786*r+.0606169*s)/1);return n===r&&r===s?e=i=a:(e=kt((.4360747*n+.3850649*r+.1430804*s)/wt),i=kt((.0139322*n+.0971045*r+.7141733*s)/Mt)),new Et(116*a-16,500*(e-a),200*(a-i),t.opacity)}function Et(t,e,i,n){this.l=+t,this.a=+e,this.b=+i,this.opacity=+n}function kt(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ct+Tt}function Dt(t){return t>St?t*t*t:Ct*(t-Tt)}function zt(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ot(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Rt(t){if(t instanceof Lt)return new Lt(t.h,t.c,t.l,t.opacity);if(t instanceof Et||(t=Pt(t)),0===t.a&&0===t.b)return new Lt(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*bt;return new Lt(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Lt(t,e,i,n){this.h=+t,this.c=+e,this.l=+i,this.opacity=+n}function Bt(t){if(isNaN(t.h))return new Et(t.l,0,0,t.opacity);var e=t.h*vt;return new Et(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}H(Et,(function(t,e,i,n){return 1===arguments.length?Pt(t):new Et(t,e,i,null==n?1:n)}),X(V,{brighter:function(t){return new Et(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Et(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,i=isNaN(this.b)?t:t-this.b/200;return new ft(zt(3.1338561*(e=wt*Dt(e))-1.6168667*(t=1*Dt(t))-.4906146*(i=Mt*Dt(i))),zt(-.9787684*e+1.9161415*t+.033454*i),zt(.0719453*e-.2289914*t+1.4052427*i),this.opacity)}})),H(Lt,(function(t,e,i,n){return 1===arguments.length?Rt(t):new Lt(t,e,i,null==n?1:n)}),X(V,{brighter:function(t){return new Lt(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Lt(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return Bt(this).rgb()}}));var Nt=-.14861,Ft=1.78277,It=-.29227,jt=-.90649,qt=1.97294,Ut=qt*jt,Gt=qt*Ft,Ht=Ft*It-jt*Nt;function Xt(t){if(t instanceof Vt)return new Vt(t.h,t.s,t.l,t.opacity);t instanceof ft||(t=dt(t));var e=t.r/255,i=t.g/255,n=t.b/255,r=(Ht*n+Ut*e-Gt*i)/(Ht+Ut-Gt),s=n-r,a=(qt*(i-r)-It*s)/jt,o=Math.sqrt(a*a+s*s)/(qt*r*(1-r)),l=o?Math.atan2(a,s)*bt-120:NaN;return new Vt(l<0?l+360:l,o,r,t.opacity)}function Vt(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}H(Vt,(function(t,e,i,n){return 1===arguments.length?Xt(t):new Vt(t,e,i,null==n?1:n)}),X(V,{brighter:function(t){return t=null==t?$:Math.pow($,t),new Vt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Y:Math.pow(Y,t),new Vt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*vt,e=+this.l,i=isNaN(this.s)?0:this.s*e*(1-e),n=Math.cos(t),r=Math.sin(t);return new ft(255*(e+i*(Nt*n+Ft*r)),255*(e+i*(It*n+jt*r)),255*(e+i*(qt*n)),this.opacity)}}));var Yt=Math.abs,$t=Math.cos,Wt=Math.sin,Zt=Math.PI,Qt=Zt/2,Jt=2*Zt,Kt=Math.max,te=1e-12;function ee(t,e){return Array.from({length:e-t},((e,i)=>t+i))}function ie(t){return function(e,i){return t(e.source.value+e.target.value,i.source.value+i.target.value)}}function ne(){return function(t,e){var i=0,n=null,r=null,s=null;function a(a){var o,l=a.length,h=new Array(l),c=ee(0,l),d=new Array(l*l),u=new Array(l),f=0;a=Float64Array.from({length:l*l},e?(t,e)=>a[e%l][e/l|0]:(t,e)=>a[e/l|0][e%l]);for(let e=0;e<l;++e){let i=0;for(let n=0;n<l;++n)i+=a[e*l+n]+t*a[n*l+e];f+=h[e]=i}o=(f=Kt(0,Jt-i*l)/f)?i:Jt/l;{let e=0;n&&c.sort(((t,e)=>n(h[t],h[e])));for(const i of c){const n=e;if(t){const t=ee(1+~l,l).filter((t=>t<0?a[~t*l+i]:a[i*l+t]));r&&t.sort(((t,e)=>r(t<0?-a[~t*l+i]:a[i*l+t],e<0?-a[~e*l+i]:a[i*l+e])));for(const n of t)if(n<0){(d[~n*l+i]||(d[~n*l+i]={source:null,target:null})).target={index:i,startAngle:e,endAngle:e+=a[~n*l+i]*f,value:a[~n*l+i]}}else{(d[i*l+n]||(d[i*l+n]={source:null,target:null})).source={index:i,startAngle:e,endAngle:e+=a[i*l+n]*f,value:a[i*l+n]}}u[i]={index:i,startAngle:n,endAngle:e,value:h[i]}}else{const t=ee(0,l).filter((t=>a[i*l+t]||a[t*l+i]));r&&t.sort(((t,e)=>r(a[i*l+t],a[i*l+e])));for(const n of t){let t;if(i<n?(t=d[i*l+n]||(d[i*l+n]={source:null,target:null}),t.source={index:i,startAngle:e,endAngle:e+=a[i*l+n]*f,value:a[i*l+n]}):(t=d[n*l+i]||(d[n*l+i]={source:null,target:null}),t.target={index:i,startAngle:e,endAngle:e+=a[i*l+n]*f,value:a[i*l+n]},i===n&&(t.source=t.target)),t.source&&t.target&&t.source.value<t.target.value){const e=t.source;t.source=t.target,t.target=e}}u[i]={index:i,startAngle:n,endAngle:e,value:h[i]}}e+=o}}return(d=Object.values(d)).groups=u,s?d.sort(s):d}return a.padAngle=function(t){return arguments.length?(i=Kt(0,t),a):i},a.sortGroups=function(t){return arguments.length?(n=t,a):n},a.sortSubgroups=function(t){return arguments.length?(r=t,a):r},a.sortChords=function(t){return arguments.length?(null==t?s=null:(s=ie(t))._=t,a):s&&s._},a}(!1,!1)}const re=Math.PI,se=2*re,ae=1e-6,oe=se-ae;function le(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function he(){return new le}le.prototype=he.prototype={constructor:le,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,i,n){this._+="Q"+ +t+","+ +e+","+(this._x1=+i)+","+(this._y1=+n)},bezierCurveTo:function(t,e,i,n,r,s){this._+="C"+ +t+","+ +e+","+ +i+","+ +n+","+(this._x1=+r)+","+(this._y1=+s)},arcTo:function(t,e,i,n,r){t=+t,e=+e,i=+i,n=+n,r=+r;var s=this._x1,a=this._y1,o=i-t,l=n-e,h=s-t,c=a-e,d=h*h+c*c;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(d>ae)if(Math.abs(c*o-l*h)>ae&&r){var u=i-s,f=n-a,m=o*o+l*l,p=u*u+f*f,g=Math.sqrt(m),_=Math.sqrt(d),x=r*Math.tan((re-Math.acos((m+d-p)/(2*g*_)))/2),y=x/_,A=x/g;Math.abs(y-1)>ae&&(this._+="L"+(t+y*h)+","+(e+y*c)),this._+="A"+r+","+r+",0,0,"+ +(c*u>h*f)+","+(this._x1=t+A*o)+","+(this._y1=e+A*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,i,n,r,s){t=+t,e=+e,s=!!s;var a=(i=+i)*Math.cos(n),o=i*Math.sin(n),l=t+a,h=e+o,c=1^s,d=s?n-r:r-n;if(i<0)throw new Error("negative radius: "+i);null===this._x1?this._+="M"+l+","+h:(Math.abs(this._x1-l)>ae||Math.abs(this._y1-h)>ae)&&(this._+="L"+l+","+h),i&&(d<0&&(d=d%se+se),d>oe?this._+="A"+i+","+i+",0,1,"+c+","+(t-a)+","+(e-o)+"A"+i+","+i+",0,1,"+c+","+(this._x1=l)+","+(this._y1=h):d>ae&&(this._+="A"+i+","+i+",0,"+ +(d>=re)+","+c+","+(this._x1=t+i*Math.cos(r))+","+(this._y1=e+i*Math.sin(r))))},rect:function(t,e,i,n){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +i+"v"+ +n+"h"+-i+"Z"},toString:function(){return this._}};var ce=Array.prototype.slice;function de(t){return function(){return t}}function ue(t){return t.source}function fe(t){return t.target}function me(t){return t.radius}function pe(t){return t.startAngle}function ge(t){return t.endAngle}function _e(){return 0}function xe(){return function(t){var e=ue,i=fe,n=me,r=me,s=pe,a=ge,o=_e,l=null;function h(){var h,c=e.apply(this,arguments),d=i.apply(this,arguments),u=o.apply(this,arguments)/2,f=ce.call(arguments),m=+n.apply(this,(f[0]=c,f)),p=s.apply(this,f)-Qt,g=a.apply(this,f)-Qt,_=+r.apply(this,(f[0]=d,f)),x=s.apply(this,f)-Qt,y=a.apply(this,f)-Qt;if(l||(l=h=he()),u>te&&(Yt(g-p)>2*u+te?g>p?(p+=u,g-=u):(p-=u,g+=u):p=g=(p+g)/2,Yt(y-x)>2*u+te?y>x?(x+=u,y-=u):(x-=u,y+=u):x=y=(x+y)/2),l.moveTo(m*$t(p),m*Wt(p)),l.arc(0,0,m,p,g),p!==x||g!==y)if(t){var A=_-+t.apply(this,arguments),v=(x+y)/2;l.quadraticCurveTo(0,0,A*$t(x),A*Wt(x)),l.lineTo(_*$t(v),_*Wt(v)),l.lineTo(A*$t(y),A*Wt(y))}else l.quadraticCurveTo(0,0,_*$t(x),_*Wt(x)),l.arc(0,0,_,x,y);if(l.quadraticCurveTo(0,0,m*$t(p),m*Wt(p)),l.closePath(),h)return l=null,h+""||null}return t&&(h.headRadius=function(e){return arguments.length?(t="function"==typeof e?e:de(+e),h):t}),h.radius=function(t){return arguments.length?(n=r="function"==typeof t?t:de(+t),h):n},h.sourceRadius=function(t){return arguments.length?(n="function"==typeof t?t:de(+t),h):n},h.targetRadius=function(t){return arguments.length?(r="function"==typeof t?t:de(+t),h):r},h.startAngle=function(t){return arguments.length?(s="function"==typeof t?t:de(+t),h):s},h.endAngle=function(t){return arguments.length?(a="function"==typeof t?t:de(+t),h):a},h.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:de(+t),h):o},h.source=function(t){return arguments.length?(e=t,h):e},h.target=function(t){return arguments.length?(i=t,h):i},h.context=function(t){return arguments.length?(l=null==t?null:t,h):l},h}()}var ye={value:()=>{}};function Ae(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n||/[\s.]/.test(t))throw new Error("illegal type: "+t);n[t]=[]}return new ve(n)}function ve(t){this._=t}function be(t,e){return t.trim().split(/^|\s+/).map((function(t){var i="",n=t.indexOf(".");if(n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}}))}function we(t,e){for(var i,n=0,r=t.length;n<r;++n)if((i=t[n]).name===e)return i.value}function Me(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=ye,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}ve.prototype=Ae.prototype={constructor:ve,on:function(t,e){var i,n=this._,r=be(t+"",n),s=-1,a=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<a;)if(i=(t=r[s]).type)n[i]=Me(n[i],t.name,e);else if(null==e)for(i in n)n[i]=Me(n[i],t.name,null);return this}for(;++s<a;)if((i=(t=r[s]).type)&&(i=we(n[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new ve(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,r=new Array(i),s=0;s<i;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,i=(n=this._[t]).length;s<i;++s)n[s].value.apply(e,r)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,s=n.length;r<s;++r)n[r].value.apply(e,i)}};var Te="http://www.w3.org/1999/xhtml",Se={svg:"http://www.w3.org/2000/svg",xhtml:Te,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ce(t){var e=t+="",i=e.indexOf(":");return i>=0&&"xmlns"!==(e=t.slice(0,i))&&(t=t.slice(i+1)),Se.hasOwnProperty(e)?{space:Se[e],local:t}:t}function Pe(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===Te&&e.documentElement.namespaceURI===Te?e.createElement(t):e.createElementNS(i,t)}}function Ee(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function ke(t){var e=Ce(t);return(e.local?Ee:Pe)(e)}function De(){}function ze(t){return null==t?De:function(){return this.querySelector(t)}}function Oe(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function Re(){return[]}function Le(t){return null==t?Re:function(){return this.querySelectorAll(t)}}function Be(t){return function(){return this.matches(t)}}function Ne(t){return function(e){return e.matches(t)}}var Fe=Array.prototype.find;function Ie(){return this.firstElementChild}var je=Array.prototype.filter;function qe(){return Array.from(this.children)}function Ue(t){return new Array(t.length)}function Ge(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function He(t){return function(){return t}}function Xe(t,e,i,n,r,s){for(var a,o=0,l=e.length,h=s.length;o<h;++o)(a=e[o])?(a.__data__=s[o],n[o]=a):i[o]=new Ge(t,s[o]);for(;o<l;++o)(a=e[o])&&(r[o]=a)}function Ve(t,e,i,n,r,s,a){var o,l,h,c=new Map,d=e.length,u=s.length,f=new Array(d);for(o=0;o<d;++o)(l=e[o])&&(f[o]=h=a.call(l,l.__data__,o,e)+"",c.has(h)?r[o]=l:c.set(h,l));for(o=0;o<u;++o)h=a.call(t,s[o],o,s)+"",(l=c.get(h))?(n[o]=l,l.__data__=s[o],c.delete(h)):i[o]=new Ge(t,s[o]);for(o=0;o<d;++o)(l=e[o])&&c.get(f[o])===l&&(r[o]=l)}function Ye(t){return t.__data__}function $e(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function We(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Ze(t){return function(){this.removeAttribute(t)}}function Qe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Je(t,e){return function(){this.setAttribute(t,e)}}function Ke(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ti(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}function ei(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function ii(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ni(t){return function(){this.style.removeProperty(t)}}function ri(t,e,i){return function(){this.style.setProperty(t,e,i)}}function si(t,e,i){return function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function ai(t,e){return t.style.getPropertyValue(e)||ii(t).getComputedStyle(t,null).getPropertyValue(e)}function oi(t){return function(){delete this[t]}}function li(t,e){return function(){this[t]=e}}function hi(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}function ci(t){return t.trim().split(/^|\s+/)}function di(t){return t.classList||new ui(t)}function ui(t){this._node=t,this._names=ci(t.getAttribute("class")||"")}function fi(t,e){for(var i=di(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function mi(t,e){for(var i=di(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function pi(t){return function(){fi(this,t)}}function gi(t){return function(){mi(this,t)}}function _i(t,e){return function(){(e.apply(this,arguments)?fi:mi)(this,t)}}function xi(){this.textContent=""}function yi(t){return function(){this.textContent=t}}function Ai(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function vi(){this.innerHTML=""}function bi(t){return function(){this.innerHTML=t}}function wi(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function Mi(){this.nextSibling&&this.parentNode.appendChild(this)}function Ti(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Si(){return null}function Ci(){var t=this.parentNode;t&&t.removeChild(this)}function Pi(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ei(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ki(t){return t.trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}}))}function Di(t){return function(){var e=this.__on;if(e){for(var i,n=0,r=-1,s=e.length;n<s;++n)i=e[n],t.type&&i.type!==t.type||i.name!==t.name?e[++r]=i:this.removeEventListener(i.type,i.listener,i.options);++r?e.length=r:delete this.__on}}}function zi(t,e,i){return function(){var n,r=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var a=0,o=r.length;a<o;++a)if((n=r[a]).type===t.type&&n.name===t.name)return this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=i),void(n.value=e);this.addEventListener(t.type,s,i),n={type:t.type,name:t.name,value:e,listener:s,options:i},r?r.push(n):this.__on=[n]}}function Oi(t,e,i){var n=ii(t),r=n.CustomEvent;"function"==typeof r?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Ri(t,e){return function(){return Oi(this,t,e)}}function Li(t,e){return function(){return Oi(this,t,e.apply(this,arguments))}}Ge.prototype={constructor:Ge,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},ui.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Bi=[null];function Ni(t,e){this._groups=t,this._parents=e}function Fi(){return new Ni([[document.documentElement]],Bi)}function Ii(t){return"string"==typeof t?new Ni([[document.querySelector(t)]],[document.documentElement]):new Ni([[t]],Bi)}function ji(t){let e;for(;e=t.sourceEvent;)t=e;return t}function qi(t,e){if(t=ji(t),void 0===e&&(e=t.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var n=i.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,[(n=n.matrixTransform(e.getScreenCTM().inverse())).x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}function Ui(t,e){return t.target&&(t=ji(t),void 0===e&&(e=t.currentTarget),t=t.touches||[t]),Array.from(t,(t=>qi(t,e)))}Ni.prototype=Fi.prototype={constructor:Ni,select:function(t){"function"!=typeof t&&(t=ze(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,a,o=e[r],l=o.length,h=n[r]=new Array(l),c=0;c<l;++c)(s=o[c])&&(a=t.call(s,s.__data__,c,o))&&("__data__"in s&&(a.__data__=s.__data__),h[c]=a);return new Ni(n,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return Oe(t.apply(this,arguments))}}(t):Le(t);for(var e=this._groups,i=e.length,n=[],r=[],s=0;s<i;++s)for(var a,o=e[s],l=o.length,h=0;h<l;++h)(a=o[h])&&(n.push(t.call(a,a.__data__,h,o)),r.push(a));return new Ni(n,r)},selectChild:function(t){return this.select(null==t?Ie:function(t){return function(){return Fe.call(this.children,t)}}("function"==typeof t?t:Ne(t)))},selectChildren:function(t){return this.selectAll(null==t?qe:function(t){return function(){return je.call(this.children,t)}}("function"==typeof t?t:Ne(t)))},filter:function(t){"function"!=typeof t&&(t=Be(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,a=e[r],o=a.length,l=n[r]=[],h=0;h<o;++h)(s=a[h])&&t.call(s,s.__data__,h,a)&&l.push(s);return new Ni(n,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,Ye);var i=e?Ve:Xe,n=this._parents,r=this._groups;"function"!=typeof t&&(t=He(t));for(var s=r.length,a=new Array(s),o=new Array(s),l=new Array(s),h=0;h<s;++h){var c=n[h],d=r[h],u=d.length,f=$e(t.call(c,c&&c.__data__,h,n)),m=f.length,p=o[h]=new Array(m),g=a[h]=new Array(m),_=l[h]=new Array(u);i(c,d,p,g,_,f,e);for(var x,y,A=0,v=0;A<m;++A)if(x=p[A]){for(A>=v&&(v=A+1);!(y=g[v])&&++v<m;);x._next=y||null}}return(a=new Ni(a,n))._enter=o,a._exit=l,a},enter:function(){return new Ni(this._enter||this._groups.map(Ue),this._parents)},exit:function(){return new Ni(this._exit||this._groups.map(Ue),this._parents)},join:function(t,e,i){var n=this.enter(),r=this,s=this.exit();return"function"==typeof t?(n=t(n))&&(n=n.selection()):n=n.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==i?s.remove():i(s),n&&r?n.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,i=this._groups,n=e._groups,r=i.length,s=n.length,a=Math.min(r,s),o=new Array(r),l=0;l<a;++l)for(var h,c=i[l],d=n[l],u=c.length,f=o[l]=new Array(u),m=0;m<u;++m)(h=c[m]||d[m])&&(f[m]=h);for(;l<r;++l)o[l]=i[l];return new Ni(o,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n,r=t[e],s=r.length-1,a=r[s];--s>=0;)(n=r[s])&&(a&&4^n.compareDocumentPosition(a)&&a.parentNode.insertBefore(n,a),a=n);return this},sort:function(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=We);for(var i=this._groups,n=i.length,r=new Array(n),s=0;s<n;++s){for(var a,o=i[s],l=o.length,h=r[s]=new Array(l),c=0;c<l;++c)(a=o[c])&&(h[c]=a);h.sort(e)}return new Ni(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,s=n.length;r<s;++r){var a=n[r];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r,s=e[i],a=0,o=s.length;a<o;++a)(r=s[a])&&t.call(r,r.__data__,a,s);return this},attr:function(t,e){var i=Ce(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((null==e?i.local?Qe:Ze:"function"==typeof e?i.local?ei:ti:i.local?Ke:Je)(i,e))},style:function(t,e,i){return arguments.length>1?this.each((null==e?ni:"function"==typeof e?si:ri)(t,e,null==i?"":i)):ai(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?oi:"function"==typeof e?hi:li)(t,e)):this.node()[t]},classed:function(t,e){var i=ci(t+"");if(arguments.length<2){for(var n=di(this.node()),r=-1,s=i.length;++r<s;)if(!n.contains(i[r]))return!1;return!0}return this.each(("function"==typeof e?_i:e?pi:gi)(i,e))},text:function(t){return arguments.length?this.each(null==t?xi:("function"==typeof t?Ai:yi)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?vi:("function"==typeof t?wi:bi)(t)):this.node().innerHTML},raise:function(){return this.each(Mi)},lower:function(){return this.each(Ti)},append:function(t){var e="function"==typeof t?t:ke(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var i="function"==typeof t?t:ke(t),n=null==e?Si:"function"==typeof e?e:ze(e);return this.select((function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)}))},remove:function(){return this.each(Ci)},clone:function(t){return this.select(t?Ei:Pi)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,i){var n,r,s=ki(t+""),a=s.length;if(!(arguments.length<2)){for(o=e?zi:Di,n=0;n<a;++n)this.each(o(s[n],e,i));return this}var o=this.node().__on;if(o)for(var l,h=0,c=o.length;h<c;++h)for(n=0,l=o[h];n<a;++n)if((r=s[n]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?Li:Ri)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n,r=t[e],s=0,a=r.length;s<a;++s)(n=r[s])&&(yield n)}};const Gi={passive:!1},Hi={capture:!0,passive:!1};function Xi(t){t.stopImmediatePropagation()}function Vi(t){t.preventDefault(),t.stopImmediatePropagation()}var Yi=t=>()=>t;function $i(t,{sourceEvent:e,subject:i,target:n,identifier:r,active:s,x:a,y:o,dx:l,dy:h,dispatch:c}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:c}})}function Wi(t){return!t.ctrlKey&&!t.button}function Zi(){return this.parentNode}function Qi(t,e){return null==e?{x:t.x,y:t.y}:e}function Ji(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ki(){var t,e,i,n,r=Wi,s=Zi,a=Qi,o=Ji,l={},h=Ae("start","drag","end"),c=0,d=0;function u(t){t.on("mousedown.drag",f).filter(o).on("touchstart.drag",g).on("touchmove.drag",_,Gi).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(a,o){if(!n&&r.call(this,a,o)){var l=y(this,s.call(this,a,o),a,o,"mouse");l&&(Ii(a.view).on("mousemove.drag",m,Hi).on("mouseup.drag",p,Hi),function(t){var e=t.document.documentElement,i=Ii(t).on("dragstart.drag",Vi,Hi);"onselectstart"in e?i.on("selectstart.drag",Vi,Hi):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}(a.view),Xi(a),i=!1,t=a.clientX,e=a.clientY,l("start",a))}}function m(n){if(Vi(n),!i){var r=n.clientX-t,s=n.clientY-e;i=r*r+s*s>d}l.mouse("drag",n)}function p(t){Ii(t.view).on("mousemove.drag mouseup.drag",null),function(t,e){var i=t.document.documentElement,n=Ii(t).on("dragstart.drag",null);e&&(n.on("click.drag",Vi,Hi),setTimeout((function(){n.on("click.drag",null)}),0)),"onselectstart"in i?n.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}(t.view,i),Vi(t),l.mouse("end",t)}function g(t,e){if(r.call(this,t,e)){var i,n,a=t.changedTouches,o=s.call(this,t,e),l=a.length;for(i=0;i<l;++i)(n=y(this,o,t,e,a[i].identifier,a[i]))&&(Xi(t),n("start",t,a[i]))}}function _(t){var e,i,n=t.changedTouches,r=n.length;for(e=0;e<r;++e)(i=l[n[e].identifier])&&(Vi(t),i("drag",t,n[e]))}function x(t){var e,i,r=t.changedTouches,s=r.length;for(n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),e=0;e<s;++e)(i=l[r[e].identifier])&&(Xi(t),i("end",t,r[e]))}function y(t,e,i,n,r,s){var o,d,f,m=h.copy(),p=qi(s||i,e);if(null!=(f=a.call(t,new $i("beforestart",{sourceEvent:i,target:u,identifier:r,active:c,x:p[0],y:p[1],dx:0,dy:0,dispatch:m}),n)))return o=f.x-p[0]||0,d=f.y-p[1]||0,function i(s,a,h){var g,_=p;switch(s){case"start":l[r]=i,g=c++;break;case"end":delete l[r],--c;case"drag":p=qi(h||a,e),g=c}m.call(s,t,new $i(s,{sourceEvent:a,subject:f,target:u,identifier:r,active:g,x:p[0]+o,y:p[1]+d,dx:p[0]-_[0],dy:p[1]-_[1],dispatch:m}),n)}}return u.filter=function(t){return arguments.length?(r="function"==typeof t?t:Yi(!!t),u):r},u.container=function(t){return arguments.length?(s="function"==typeof t?t:Yi(t),u):s},u.subject=function(t){return arguments.length?(a="function"==typeof t?t:Yi(t),u):a},u.touchable=function(t){return arguments.length?(o="function"==typeof t?t:Yi(!!t),u):o},u.on=function(){var t=h.on.apply(h,arguments);return t===h?u:t},u.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,u):Math.sqrt(d)},u}function tn(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function en(t){let e=t,i=t,n=t;function r(t,e,r=0,s=t.length){if(r<s){if(0!==i(e,e))return s;do{const i=r+s>>>1;n(t[i],e)<0?r=i+1:s=i}while(r<s)}return r}return 2!==t.length&&(e=(e,i)=>t(e)-i,i=tn,n=(e,i)=>tn(t(e),i)),{left:r,center:function(t,i,n=0,s=t.length){const a=r(t,i,n,s-1);return a>n&&e(t[a-1],i)>-e(t[a],i)?a-1:a},right:function(t,e,r=0,s=t.length){if(r<s){if(0!==i(e,e))return s;do{const i=r+s>>>1;n(t[i],e)<=0?r=i+1:s=i}while(r<s)}return r}}}$i.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};const nn=en(tn).right;en((function(t){return null===t?NaN:+t})).center;var rn=nn,sn=Math.sqrt(50),an=Math.sqrt(10),on=Math.sqrt(2);function ln(t,e,i){var n,r,s,a,o=-1;if(i=+i,(t=+t)===(e=+e)&&i>0)return[t];if((n=e<t)&&(r=t,t=e,e=r),0===(a=hn(t,e,i))||!isFinite(a))return[];if(a>0){let i=Math.round(t/a),n=Math.round(e/a);for(i*a<t&&++i,n*a>e&&--n,s=new Array(r=n-i+1);++o<r;)s[o]=(i+o)*a}else{a=-a;let i=Math.round(t*a),n=Math.round(e*a);for(i/a<t&&++i,n/a>e&&--n,s=new Array(r=n-i+1);++o<r;)s[o]=(i+o)/a}return n&&s.reverse(),s}function hn(t,e,i){var n=(e-t)/Math.max(0,i),r=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,r);return r>=0?(s>=sn?10:s>=an?5:s>=on?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(s>=sn?10:s>=an?5:s>=on?2:1)}function cn(t,e,i){var n=Math.abs(e-t)/Math.max(0,i),r=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/r;return s>=sn?r*=10:s>=an?r*=5:s>=on&&(r*=2),e<t?-r:r}function dn(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}var un=t=>()=>t;function fn(t){return 1==(t=+t)?mn:function(e,i){return i-e?function(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}(e,i,t):un(isNaN(e)?i:e)}}function mn(t,e){var i=e-t;return i?function(t,e){return function(i){return t+i*e}}(t,i):un(isNaN(t)?e:t)}var pn=function t(e){var i=fn(e);function n(t,e){var n=i((t=ut(t)).r,(e=ut(e)).r),r=i(t.g,e.g),s=i(t.b,e.b),a=mn(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=s(e),t.opacity=a(e),t+""}}return n.gamma=t,n}(1);function gn(t,e){e||(e=[]);var i,n=t?Math.min(e.length,t.length):0,r=e.slice();return function(s){for(i=0;i<n;++i)r[i]=t[i]*(1-s)+e[i]*s;return r}}function _n(t,e){var i,n=e?e.length:0,r=t?Math.min(n,t.length):0,s=new Array(r),a=new Array(n);for(i=0;i<r;++i)s[i]=Mn(t[i],e[i]);for(;i<n;++i)a[i]=e[i];return function(t){for(i=0;i<r;++i)a[i]=s[i](t);return a}}function xn(t,e){var i=new Date;return t=+t,e=+e,function(n){return i.setTime(t*(1-n)+e*n),i}}function yn(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function An(t,e){var i,n={},r={};for(i in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)i in t?n[i]=Mn(t[i],e[i]):r[i]=e[i];return function(t){for(i in n)r[i]=n[i](t);return r}}var vn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,bn=new RegExp(vn.source,"g");function wn(t,e){var i,n,r,s=vn.lastIndex=bn.lastIndex=0,a=-1,o=[],l=[];for(t+="",e+="";(i=vn.exec(t))&&(n=bn.exec(e));)(r=n.index)>s&&(r=e.slice(s,r),o[a]?o[a]+=r:o[++a]=r),(i=i[0])===(n=n[0])?o[a]?o[a]+=n:o[++a]=n:(o[++a]=null,l.push({i:a,x:yn(i,n)})),s=bn.lastIndex;return s<e.length&&(r=e.slice(s),o[a]?o[a]+=r:o[++a]=r),o.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var i,n=0;n<e;++n)o[(i=l[n]).i]=i.x(t);return o.join("")})}function Mn(t,e){var i,n,r=typeof e;return null==e||"boolean"===r?un(e):("number"===r?yn:"string"===r?(i=lt(e))?(e=i,pn):wn:e instanceof lt?pn:e instanceof Date?xn:(n=e,!ArrayBuffer.isView(n)||n instanceof DataView?Array.isArray(e)?_n:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?An:yn:gn))(t,e)}function Tn(t,e){return t=+t,e=+e,function(i){return Math.round(t*(1-i)+e*i)}}var Sn,Cn=180/Math.PI,Pn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function En(t,e,i,n,r,s){var a,o,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(o=Math.sqrt(i*i+n*n))&&(i/=o,n/=o,l/=o),t*n<e*i&&(t=-t,e=-e,l=-l,a=-a),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Cn,skewX:Math.atan(l)*Cn,scaleX:a,scaleY:o}}function kn(t,e,i,n){function r(t){return t.length?t.pop()+" ":""}return function(s,a){var o=[],l=[];return s=t(s),a=t(a),function(t,n,r,s,a,o){if(t!==r||n!==s){var l=a.push("translate(",null,e,null,i);o.push({i:l-4,x:yn(t,r)},{i:l-2,x:yn(n,s)})}else(r||s)&&a.push("translate("+r+e+s+i)}(s.translateX,s.translateY,a.translateX,a.translateY,o,l),function(t,e,i,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:i.push(r(i)+"rotate(",null,n)-2,x:yn(t,e)})):e&&i.push(r(i)+"rotate("+e+n)}(s.rotate,a.rotate,o,l),function(t,e,i,s){t!==e?s.push({i:i.push(r(i)+"skewX(",null,n)-2,x:yn(t,e)}):e&&i.push(r(i)+"skewX("+e+n)}(s.skewX,a.skewX,o,l),function(t,e,i,n,s,a){if(t!==i||e!==n){var o=s.push(r(s)+"scale(",null,",",null,")");a.push({i:o-4,x:yn(t,i)},{i:o-2,x:yn(e,n)})}else 1===i&&1===n||s.push(r(s)+"scale("+i+","+n+")")}(s.scaleX,s.scaleY,a.scaleX,a.scaleY,o,l),s=a=null,function(t){for(var e,i=-1,n=l.length;++i<n;)o[(e=l[i]).i]=e.x(t);return o.join("")}}}var Dn=kn((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Pn:En(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),zn=kn((function(t){return null==t?Pn:(Sn||(Sn=document.createElementNS("http://www.w3.org/2000/svg","g")),Sn.setAttribute("transform",t),(t=Sn.transform.baseVal.consolidate())?En((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Pn)}),", ",")",")");function On(t){return+t}var Rn=[0,1];function Ln(t){return t}function Bn(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:(i=isNaN(e)?NaN:.5,function(){return i});var i}function Nn(t,e,i){var n=t[0],r=t[1],s=e[0],a=e[1];return r<n?(n=Bn(r,n),s=i(a,s)):(n=Bn(n,r),s=i(s,a)),function(t){return s(n(t))}}function Fn(t,e,i){var n=Math.min(t.length,e.length)-1,r=new Array(n),s=new Array(n),a=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<n;)r[a]=Bn(t[a],t[a+1]),s[a]=i(e[a],e[a+1]);return function(e){var i=rn(t,e,1,n)-1;return s[i](r[i](e))}}function In(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function jn(){var t,e,i,n,r,s,a=Rn,o=Rn,l=Mn,h=Ln;function c(){var t,e,i,l=Math.min(a.length,o.length);return h!==Ln&&(t=a[0],e=a[l-1],t>e&&(i=t,t=e,e=i),h=function(i){return Math.max(t,Math.min(e,i))}),n=l>2?Fn:Nn,r=s=null,d}function d(e){return null==e||isNaN(e=+e)?i:(r||(r=n(a.map(t),o,l)))(t(h(e)))}return d.invert=function(i){return h(e((s||(s=n(o,a.map(t),yn)))(i)))},d.domain=function(t){return arguments.length?(a=Array.from(t,On),c()):a.slice()},d.range=function(t){return arguments.length?(o=Array.from(t),c()):o.slice()},d.rangeRound=function(t){return o=Array.from(t),l=Tn,c()},d.clamp=function(t){return arguments.length?(h=!!t||Ln,c()):h!==Ln},d.interpolate=function(t){return arguments.length?(l=t,c()):l},d.unknown=function(t){return arguments.length?(i=t,d):i},function(i,n){return t=i,e=n,c()}}function qn(){return jn()(Ln,Ln)}function Un(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,n=t.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+t.slice(i+1)]}function Gn(t){return(t=Un(Math.abs(t)))?t[1]:NaN}var Hn,Xn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Vn(t){if(!(e=Xn.exec(t)))throw new Error("invalid format: "+t);var e;return new Yn({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Yn(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function $n(t,e){var i=Un(t,e);if(!i)return t+"";var n=i[0],r=i[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}Vn.prototype=Yn.prototype,Yn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Wn={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>$n(100*t,e),r:$n,s:function(t,e){var i=Un(t,e);if(!i)return t+"";var n=i[0],r=i[1],s=r-(Hn=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=n.length;return s===a?n:s>a?n+new Array(s-a+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Un(t,Math.max(0,e+s-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Zn(t){return t}var Qn,Jn,Kn,tr=Array.prototype.map,er=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ir(t){var e,i,n=void 0===t.grouping||void 0===t.thousands?Zn:(e=tr.call(t.grouping,Number),i=t.thousands+"",function(t,n){for(var r=t.length,s=[],a=0,o=e[0],l=0;r>0&&o>0&&(l+o+1>n&&(o=Math.max(1,n-l)),s.push(t.substring(r-=o,r+o)),!((l+=o+1)>n));)o=e[a=(a+1)%e.length];return s.reverse().join(i)}),r=void 0===t.currency?"":t.currency[0]+"",s=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",o=void 0===t.numerals?Zn:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(tr.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",h=void 0===t.minus?"−":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function d(t){var e=(t=Vn(t)).fill,i=t.align,d=t.sign,u=t.symbol,f=t.zero,m=t.width,p=t.comma,g=t.precision,_=t.trim,x=t.type;"n"===x?(p=!0,x="g"):Wn[x]||(void 0===g&&(g=12),_=!0,x="g"),(f||"0"===e&&"="===i)&&(f=!0,e="0",i="=");var y="$"===u?r:"#"===u&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",A="$"===u?s:/[%p]/.test(x)?l:"",v=Wn[x],b=/[defgprs%]/.test(x);function w(t){var r,s,l,u=y,w=A;if("c"===x)w=v(t)+w,t="";else{var M=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:v(Math.abs(t),g),_&&(t=function(t){t:for(var e,i=t.length,n=1,r=-1;n<i;++n)switch(t[n]){case".":r=e=n;break;case"0":0===r&&(r=n),e=n;break;default:if(!+t[n])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),M&&0==+t&&"+"!==d&&(M=!1),u=(M?"("===d?d:h:"-"===d||"("===d?"":d)+u,w=("s"===x?er[8+Hn/3]:"")+w+(M&&"("===d?")":""),b)for(r=-1,s=t.length;++r<s;)if(48>(l=t.charCodeAt(r))||l>57){w=(46===l?a+t.slice(r+1):t.slice(r))+w,t=t.slice(0,r);break}}p&&!f&&(t=n(t,1/0));var T=u.length+t.length+w.length,S=T<m?new Array(m-T+1).join(e):"";switch(p&&f&&(t=n(S+t,S.length?m-w.length:1/0),S=""),i){case"<":t=u+t+w+S;break;case"=":t=u+S+t+w;break;case"^":t=S.slice(0,T=S.length>>1)+u+t+w+S.slice(T);break;default:t=S+u+t+w}return o(t)}return g=void 0===g?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),w.toString=function(){return t+""},w}return{format:d,formatPrefix:function(t,e){var i=d(((t=Vn(t)).type="f",t)),n=3*Math.max(-8,Math.min(8,Math.floor(Gn(e)/3))),r=Math.pow(10,-n),s=er[8+n/3];return function(t){return i(r*t)+s}}}}function nr(t,e,i,n){var r,s=cn(t,e,i);switch((n=Vn(null==n?",f":n)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=n.precision||isNaN(r=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Gn(e)/3)))-Gn(Math.abs(t)))}(s,a))||(n.precision=r),Kn(n,a);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(r=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Gn(e)-Gn(t))+1}(s,Math.max(Math.abs(t),Math.abs(e))))||(n.precision=r-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(r=function(t){return Math.max(0,-Gn(Math.abs(t)))}(s))||(n.precision=r-2*("%"===n.type))}return Jn(n)}function rr(t){var e=t.domain;return t.ticks=function(t){var i=e();return ln(i[0],i[i.length-1],null==t?10:t)},t.tickFormat=function(t,i){var n=e();return nr(n[0],n[n.length-1],null==t?10:t,i)},t.nice=function(i){null==i&&(i=10);var n,r,s=e(),a=0,o=s.length-1,l=s[a],h=s[o],c=10;for(h<l&&(r=l,l=h,h=r,r=a,a=o,o=r);c-- >0;){if((r=hn(l,h,i))===n)return s[a]=l,s[o]=h,e(s);if(r>0)l=Math.floor(l/r)*r,h=Math.ceil(h/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,h=Math.floor(h*r)/r}n=r}return t},t}function sr(){var t=qn();return t.copy=function(){return In(t,sr())},dn.apply(t,arguments),rr(t)}function ar(t,e){var i,n=0,r=(t=t.slice()).length-1,s=t[n],a=t[r];return a<s&&(i=n,n=r,r=i,i=s,s=a,a=i),t[n]=e.floor(s),t[r]=e.ceil(a),t}function or(t){return Math.log(t)}function lr(t){return Math.exp(t)}function hr(t){return-Math.log(-t)}function cr(t){return-Math.exp(-t)}function dr(t){return isFinite(t)?+("1e"+t):t<0?0:t}function ur(t){return(e,i)=>-t(-e,i)}function fr(t){const e=t(or,lr),i=e.domain;let n,r,s=10;function a(){return n=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}(s),r=function(t){return 10===t?dr:t===Math.E?Math.exp:e=>Math.pow(t,e)}(s),i()[0]<0?(n=ur(n),r=ur(r),t(hr,cr)):t(or,lr),e}return e.base=function(t){return arguments.length?(s=+t,a()):s},e.domain=function(t){return arguments.length?(i(t),a()):i()},e.ticks=t=>{const e=i();let a=e[0],o=e[e.length-1];const l=o<a;l&&([a,o]=[o,a]);let h,c,d=n(a),u=n(o);const f=null==t?10:+t;let m=[];if(!(s%1)&&u-d<f){if(d=Math.floor(d),u=Math.ceil(u),a>0){for(;d<=u;++d)for(h=1;h<s;++h)if(c=d<0?h/r(-d):h*r(d),!(c<a)){if(c>o)break;m.push(c)}}else for(;d<=u;++d)for(h=s-1;h>=1;--h)if(c=d>0?h/r(-d):h*r(d),!(c<a)){if(c>o)break;m.push(c)}2*m.length<f&&(m=ln(a,o,f))}else m=ln(d,u,Math.min(u-d,f)).map(r);return l?m.reverse():m},e.tickFormat=(t,i)=>{if(null==t&&(t=10),null==i&&(i=10===s?"s":","),"function"!=typeof i&&(s%1||null!=(i=Vn(i)).precision||(i.trim=!0),i=Jn(i)),t===1/0)return i;const a=Math.max(1,s*t/e.ticks().length);return t=>{let e=t/r(Math.round(n(t)));return e*s<s-.5&&(e*=s),e<=a?i(t):""}},e.nice=()=>i(ar(i(),{floor:t=>r(Math.floor(n(t))),ceil:t=>r(Math.ceil(n(t)))})),e}function mr(){const t=fr(jn()).domain([1,10]);return t.copy=()=>In(t,mr()).base(t.base()),dn.apply(t,arguments),t}function pr(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function gr(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function _r(t){var e=1,i=t(pr(e),gr(e));return i.constant=function(i){return arguments.length?t(pr(e=+i),gr(e)):e},rr(i)}function xr(){var t=_r(jn());return t.copy=function(){return In(t,xr()).constant(t.constant())},dn.apply(t,arguments)}Qn=ir({thousands:",",grouping:[3],currency:["$",""]}),Jn=Qn.format,Kn=Qn.formatPrefix;var yr=new Date,Ar=new Date;function vr(t,e,i,n){function r(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return r.floor=function(e){return t(e=new Date(+e)),e},r.ceil=function(i){return t(i=new Date(i-1)),e(i,1),t(i),i},r.round=function(t){var e=r(t),i=r.ceil(t);return t-e<i-t?e:i},r.offset=function(t,i){return e(t=new Date(+t),null==i?1:Math.floor(i)),t},r.range=function(i,n,s){var a,o=[];if(i=r.ceil(i),s=null==s?1:Math.floor(s),!(i<n&&s>0))return o;do{o.push(a=new Date(+i)),e(i,s),t(i)}while(a<i&&i<n);return o},r.filter=function(i){return vr((function(e){if(e>=e)for(;t(e),!i(e);)e.setTime(e-1)}),(function(t,n){if(t>=t)if(n<0)for(;++n<=0;)for(;e(t,-1),!i(t););else for(;--n>=0;)for(;e(t,1),!i(t););}))},i&&(r.count=function(e,n){return yr.setTime(+e),Ar.setTime(+n),t(yr),t(Ar),Math.floor(i(yr,Ar))},r.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?r.filter(n?function(e){return n(e)%t==0}:function(e){return r.count(0,e)%t==0}):r:null}),r}var br=vr((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));br.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?vr((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,i){e.setTime(+e+i*t)}),(function(e,i){return(i-e)/t})):br:null};var wr=br;const Mr=1e3,Tr=6e4,Sr=36e5,Cr=864e5,Pr=6048e5,Er=2592e6,kr=31536e6;var Dr=vr((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*Mr)}),(function(t,e){return(e-t)/Mr}),(function(t){return t.getUTCSeconds()})),zr=Dr,Or=vr((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*Mr)}),(function(t,e){t.setTime(+t+e*Tr)}),(function(t,e){return(e-t)/Tr}),(function(t){return t.getMinutes()})),Rr=Or,Lr=vr((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*Mr-t.getMinutes()*Tr)}),(function(t,e){t.setTime(+t+e*Sr)}),(function(t,e){return(e-t)/Sr}),(function(t){return t.getHours()})),Br=Lr,Nr=vr((t=>t.setHours(0,0,0,0)),((t,e)=>t.setDate(t.getDate()+e)),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Tr)/Cr),(t=>t.getDate()-1)),Fr=Nr;function Ir(t){return vr((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Tr)/Pr}))}var jr=Ir(0),qr=Ir(1);Ir(2),Ir(3);var Ur=Ir(4);Ir(5),Ir(6);var Gr=vr((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()})),Hr=Gr,Xr=vr((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));Xr.every=function(t){return isFinite(t=Math.floor(t))&&t>0?vr((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,i){e.setFullYear(e.getFullYear()+i*t)})):null};var Vr=Xr;vr((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+e*Tr)}),(function(t,e){return(e-t)/Tr}),(function(t){return t.getUTCMinutes()})),vr((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+e*Sr)}),(function(t,e){return(e-t)/Sr}),(function(t){return t.getUTCHours()}));var Yr=vr((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/Cr}),(function(t){return t.getUTCDate()-1})),$r=Yr;function Wr(t){return vr((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/Pr}))}var Zr=Wr(0),Qr=Wr(1);Wr(2),Wr(3);var Jr=Wr(4);Wr(5),Wr(6),vr((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()}));var Kr=vr((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));Kr.every=function(t){return isFinite(t=Math.floor(t))&&t>0?vr((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i*t)})):null};var ts=Kr;const[es,is]=function(t,e,i,n,r,s){const a=[[zr,1,Mr],[zr,5,5e3],[zr,15,15e3],[zr,30,3e4],[s,1,Tr],[s,5,3e5],[s,15,9e5],[s,30,18e5],[r,1,Sr],[r,3,108e5],[r,6,216e5],[r,12,432e5],[n,1,Cr],[n,2,1728e5],[i,1,Pr],[e,1,Er],[e,3,7776e6],[t,1,kr]];function o(e,i,n){const r=Math.abs(i-e)/n,s=en((([,,t])=>t)).right(a,r);if(s===a.length)return t.every(cn(e/kr,i/kr,n));if(0===s)return wr.every(Math.max(cn(e,i,n),1));const[o,l]=a[r/a[s-1][2]<a[s][2]/r?s-1:s];return o.every(l)}return[function(t,e,i){const n=e<t;n&&([t,e]=[e,t]);const r=i&&"function"==typeof i.range?i:o(t,e,i),s=r?r.range(t,+e+1):[];return n?s.reverse():s},o]}(Vr,Hr,jr,Fr,Br,Rr);function ns(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function rs(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function ss(t,e,i){return{y:t,m:e,d:i,H:0,M:0,S:0,L:0}}var as,os,ls,hs,cs={"-":"",_:" ",0:"0"},ds=/^\s*\d+/,us=/^%/,fs=/[\\^$*+?|[\]().{}]/g;function ms(t,e,i){var n=t<0?"-":"",r=(n?-t:t)+"",s=r.length;return n+(s<i?new Array(i-s+1).join(e)+r:r)}function ps(t){return t.replace(fs,"\\$&")}function gs(t){return new RegExp("^(?:"+t.map(ps).join("|")+")","i")}function _s(t){return new Map(t.map(((t,e)=>[t.toLowerCase(),e])))}function xs(t,e,i){var n=ds.exec(e.slice(i,i+1));return n?(t.w=+n[0],i+n[0].length):-1}function ys(t,e,i){var n=ds.exec(e.slice(i,i+1));return n?(t.u=+n[0],i+n[0].length):-1}function As(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.U=+n[0],i+n[0].length):-1}function vs(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.V=+n[0],i+n[0].length):-1}function bs(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.W=+n[0],i+n[0].length):-1}function ws(t,e,i){var n=ds.exec(e.slice(i,i+4));return n?(t.y=+n[0],i+n[0].length):-1}function Ms(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function Ts(t,e,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(i,i+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function Ss(t,e,i){var n=ds.exec(e.slice(i,i+1));return n?(t.q=3*n[0]-3,i+n[0].length):-1}function Cs(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.m=n[0]-1,i+n[0].length):-1}function Ps(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.d=+n[0],i+n[0].length):-1}function Es(t,e,i){var n=ds.exec(e.slice(i,i+3));return n?(t.m=0,t.d=+n[0],i+n[0].length):-1}function ks(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.H=+n[0],i+n[0].length):-1}function Ds(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.M=+n[0],i+n[0].length):-1}function zs(t,e,i){var n=ds.exec(e.slice(i,i+2));return n?(t.S=+n[0],i+n[0].length):-1}function Os(t,e,i){var n=ds.exec(e.slice(i,i+3));return n?(t.L=+n[0],i+n[0].length):-1}function Rs(t,e,i){var n=ds.exec(e.slice(i,i+6));return n?(t.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function Ls(t,e,i){var n=us.exec(e.slice(i,i+1));return n?i+n[0].length:-1}function Bs(t,e,i){var n=ds.exec(e.slice(i));return n?(t.Q=+n[0],i+n[0].length):-1}function Ns(t,e,i){var n=ds.exec(e.slice(i));return n?(t.s=+n[0],i+n[0].length):-1}function Fs(t,e){return ms(t.getDate(),e,2)}function Is(t,e){return ms(t.getHours(),e,2)}function js(t,e){return ms(t.getHours()%12||12,e,2)}function qs(t,e){return ms(1+Fr.count(Vr(t),t),e,3)}function Us(t,e){return ms(t.getMilliseconds(),e,3)}function Gs(t,e){return Us(t,e)+"000"}function Hs(t,e){return ms(t.getMonth()+1,e,2)}function Xs(t,e){return ms(t.getMinutes(),e,2)}function Vs(t,e){return ms(t.getSeconds(),e,2)}function Ys(t){var e=t.getDay();return 0===e?7:e}function $s(t,e){return ms(jr.count(Vr(t)-1,t),e,2)}function Ws(t){var e=t.getDay();return e>=4||0===e?Ur(t):Ur.ceil(t)}function Zs(t,e){return t=Ws(t),ms(Ur.count(Vr(t),t)+(4===Vr(t).getDay()),e,2)}function Qs(t){return t.getDay()}function Js(t,e){return ms(qr.count(Vr(t)-1,t),e,2)}function Ks(t,e){return ms(t.getFullYear()%100,e,2)}function ta(t,e){return ms((t=Ws(t)).getFullYear()%100,e,2)}function ea(t,e){return ms(t.getFullYear()%1e4,e,4)}function ia(t,e){var i=t.getDay();return ms((t=i>=4||0===i?Ur(t):Ur.ceil(t)).getFullYear()%1e4,e,4)}function na(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+ms(e/60|0,"0",2)+ms(e%60,"0",2)}function ra(t,e){return ms(t.getUTCDate(),e,2)}function sa(t,e){return ms(t.getUTCHours(),e,2)}function aa(t,e){return ms(t.getUTCHours()%12||12,e,2)}function oa(t,e){return ms(1+$r.count(ts(t),t),e,3)}function la(t,e){return ms(t.getUTCMilliseconds(),e,3)}function ha(t,e){return la(t,e)+"000"}function ca(t,e){return ms(t.getUTCMonth()+1,e,2)}function da(t,e){return ms(t.getUTCMinutes(),e,2)}function ua(t,e){return ms(t.getUTCSeconds(),e,2)}function fa(t){var e=t.getUTCDay();return 0===e?7:e}function ma(t,e){return ms(Zr.count(ts(t)-1,t),e,2)}function pa(t){var e=t.getUTCDay();return e>=4||0===e?Jr(t):Jr.ceil(t)}function ga(t,e){return t=pa(t),ms(Jr.count(ts(t),t)+(4===ts(t).getUTCDay()),e,2)}function _a(t){return t.getUTCDay()}function xa(t,e){return ms(Qr.count(ts(t)-1,t),e,2)}function ya(t,e){return ms(t.getUTCFullYear()%100,e,2)}function Aa(t,e){return ms((t=pa(t)).getUTCFullYear()%100,e,2)}function va(t,e){return ms(t.getUTCFullYear()%1e4,e,4)}function ba(t,e){var i=t.getUTCDay();return ms((t=i>=4||0===i?Jr(t):Jr.ceil(t)).getUTCFullYear()%1e4,e,4)}function wa(){return"+0000"}function Ma(){return"%"}function Ta(t){return+t}function Sa(t){return Math.floor(+t/1e3)}!function(t){as=function(t){var e=t.dateTime,i=t.date,n=t.time,r=t.periods,s=t.days,a=t.shortDays,o=t.months,l=t.shortMonths,h=gs(r),c=_s(r),d=gs(s),u=_s(s),f=gs(a),m=_s(a),p=gs(o),g=_s(o),_=gs(l),x=_s(l),y={a:function(t){return a[t.getDay()]},A:function(t){return s[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return o[t.getMonth()]},c:null,d:Fs,e:Fs,f:Gs,g:ta,G:ia,H:Is,I:js,j:qs,L:Us,m:Hs,M:Xs,p:function(t){return r[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:Ta,s:Sa,S:Vs,u:Ys,U:$s,V:Zs,w:Qs,W:Js,x:null,X:null,y:Ks,Y:ea,Z:na,"%":Ma},A={a:function(t){return a[t.getUTCDay()]},A:function(t){return s[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return o[t.getUTCMonth()]},c:null,d:ra,e:ra,f:ha,g:Aa,G:ba,H:sa,I:aa,j:oa,L:la,m:ca,M:da,p:function(t){return r[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:Ta,s:Sa,S:ua,u:fa,U:ma,V:ga,w:_a,W:xa,x:null,X:null,y:ya,Y:va,Z:wa,"%":Ma},v={a:function(t,e,i){var n=f.exec(e.slice(i));return n?(t.w=m.get(n[0].toLowerCase()),i+n[0].length):-1},A:function(t,e,i){var n=d.exec(e.slice(i));return n?(t.w=u.get(n[0].toLowerCase()),i+n[0].length):-1},b:function(t,e,i){var n=_.exec(e.slice(i));return n?(t.m=x.get(n[0].toLowerCase()),i+n[0].length):-1},B:function(t,e,i){var n=p.exec(e.slice(i));return n?(t.m=g.get(n[0].toLowerCase()),i+n[0].length):-1},c:function(t,i,n){return M(t,e,i,n)},d:Ps,e:Ps,f:Rs,g:Ms,G:ws,H:ks,I:ks,j:Es,L:Os,m:Cs,M:Ds,p:function(t,e,i){var n=h.exec(e.slice(i));return n?(t.p=c.get(n[0].toLowerCase()),i+n[0].length):-1},q:Ss,Q:Bs,s:Ns,S:zs,u:ys,U:As,V:vs,w:xs,W:bs,x:function(t,e,n){return M(t,i,e,n)},X:function(t,e,i){return M(t,n,e,i)},y:Ms,Y:ws,Z:Ts,"%":Ls};function b(t,e){return function(i){var n,r,s,a=[],o=-1,l=0,h=t.length;for(i instanceof Date||(i=new Date(+i));++o<h;)37===t.charCodeAt(o)&&(a.push(t.slice(l,o)),null!=(r=cs[n=t.charAt(++o)])?n=t.charAt(++o):r="e"===n?" ":"0",(s=e[n])&&(n=s(i,r)),a.push(n),l=o+1);return a.push(t.slice(l,o)),a.join("")}}function w(t,e){return function(i){var n,r,s=ss(1900,void 0,1);if(M(s,t,i+="",0)!=i.length)return null;if("Q"in s)return new Date(s.Q);if("s"in s)return new Date(1e3*s.s+("L"in s?s.L:0));if(e&&!("Z"in s)&&(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),void 0===s.m&&(s.m="q"in s?s.q:0),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(r=(n=rs(ss(s.y,0,1))).getUTCDay(),n=r>4||0===r?Qr.ceil(n):Qr(n),n=$r.offset(n,7*(s.V-1)),s.y=n.getUTCFullYear(),s.m=n.getUTCMonth(),s.d=n.getUTCDate()+(s.w+6)%7):(r=(n=ns(ss(s.y,0,1))).getDay(),n=r>4||0===r?qr.ceil(n):qr(n),n=Fr.offset(n,7*(s.V-1)),s.y=n.getFullYear(),s.m=n.getMonth(),s.d=n.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:"W"in s?1:0),r="Z"in s?rs(ss(s.y,0,1)).getUTCDay():ns(ss(s.y,0,1)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(r+5)%7:s.w+7*s.U-(r+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,rs(s)):ns(s)}}function M(t,e,i,n){for(var r,s,a=0,o=e.length,l=i.length;a<o;){if(n>=l)return-1;if(37===(r=e.charCodeAt(a++))){if(r=e.charAt(a++),!(s=v[r in cs?e.charAt(a++):r])||(n=s(t,i,n))<0)return-1}else if(r!=i.charCodeAt(n++))return-1}return n}return y.x=b(i,y),y.X=b(n,y),y.c=b(e,y),A.x=b(i,A),A.X=b(n,A),A.c=b(e,A),{format:function(t){var e=b(t+="",y);return e.toString=function(){return t},e},parse:function(t){var e=w(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=b(t+="",A);return e.toString=function(){return t},e},utcParse:function(t){var e=w(t+="",!0);return e.toString=function(){return t},e}}}(t),os=as.format,ls=as.utcFormat,hs=as.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Ca="%Y-%m-%dT%H:%M:%S.%LZ";function Pa(t){return new Date(t)}function Ea(t){return t instanceof Date?+t:+new Date(+t)}function ka(t,e,i,n,r,s,a,o,l,h){var c=qn(),d=c.invert,u=c.domain,f=h(".%L"),m=h(":%S"),p=h("%I:%M"),g=h("%I %p"),_=h("%a %d"),x=h("%b %d"),y=h("%B"),A=h("%Y");function v(t){return(l(t)<t?f:o(t)<t?m:a(t)<t?p:s(t)<t?g:n(t)<t?r(t)<t?_:x:i(t)<t?y:A)(t)}return c.invert=function(t){return new Date(d(t))},c.domain=function(t){return arguments.length?u(Array.from(t,Ea)):u().map(Pa)},c.ticks=function(e){var i=u();return t(i[0],i[i.length-1],null==e?10:e)},c.tickFormat=function(t,e){return null==e?v:h(e)},c.nice=function(t){var i=u();return t&&"function"==typeof t.range||(t=e(i[0],i[i.length-1],null==t?10:t)),t?u(ar(i,t)):c},c.copy=function(){return In(c,ka(t,e,i,n,r,s,a,o,l,h))},c}function Da(){return dn.apply(ka(es,is,Vr,Hr,jr,Fr,Br,Rr,zr,os).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function za(t){return function(){return t}}Date.prototype.toISOString||ls(Ca),+new Date("2000-01-01T00:00:00.000Z")||hs(Ca);const Oa=Math.abs,Ra=Math.atan2,La=Math.cos,Ba=Math.max,Na=Math.min,Fa=Math.sin,Ia=Math.sqrt,ja=1e-12,qa=Math.PI,Ua=qa/2,Ga=2*qa;function Ha(t){return t>1?0:t<-1?qa:Math.acos(t)}function Xa(t){return t>=1?Ua:t<=-1?-Ua:Math.asin(t)}function Va(t){return t.innerRadius}function Ya(t){return t.outerRadius}function $a(t){return t.startAngle}function Wa(t){return t.endAngle}function Za(t){return t&&t.padAngle}function Qa(t,e,i,n,r,s,a,o){var l=i-t,h=n-e,c=a-r,d=o-s,u=d*l-c*h;if(!(u*u<ja))return[t+(u=(c*(e-s)-d*(t-r))/u)*l,e+u*h]}function Ja(t,e,i,n,r,s,a){var o=t-i,l=e-n,h=(a?s:-s)/Ia(o*o+l*l),c=h*l,d=-h*o,u=t+c,f=e+d,m=i+c,p=n+d,g=(u+m)/2,_=(f+p)/2,x=m-u,y=p-f,A=x*x+y*y,v=r-s,b=u*p-m*f,w=(y<0?-1:1)*Ia(Ba(0,v*v*A-b*b)),M=(b*y-x*w)/A,T=(-b*x-y*w)/A,S=(b*y+x*w)/A,C=(-b*x+y*w)/A,P=M-g,E=T-_,k=S-g,D=C-_;return P*P+E*E>k*k+D*D&&(M=S,T=C),{cx:M,cy:T,x01:-c,y01:-d,x11:M*(r/v-1),y11:T*(r/v-1)}}var Ka,to,eo=0,io=0,no=0,ro=0,so=0,ao=0,oo="object"==typeof performance&&performance.now?performance:Date,lo="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function ho(){return so||(lo(co),so=oo.now()+ao)}function co(){so=0}function uo(){this._call=this._time=this._next=null}function fo(t,e,i){var n=new uo;return n.restart(t,e,i),n}function mo(){so=(ro=oo.now())+ao,eo=io=0;try{!function(){ho(),++eo;for(var t,e=Ka;e;)(t=so-e._time)>=0&&e._call.call(void 0,t),e=e._next;--eo}()}finally{eo=0,function(){var t,e,i=Ka,n=1/0;for(;i;)i._call?(n>i._time&&(n=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:Ka=e);to=t,go(n)}(),so=0}}function po(){var t=oo.now(),e=t-ro;e>1e3&&(ao-=e,ro=t)}function go(t){eo||(io&&(io=clearTimeout(io)),t-so>24?(t<1/0&&(io=setTimeout(mo,t-oo.now()-ao)),no&&(no=clearInterval(no))):(no||(ro=oo.now(),no=setInterval(po,1e3)),eo=1,lo(mo)))}function _o(t,e,i){var n=new uo;return e=null==e?0:+e,n.restart((i=>{n.stop(),t(i+e)}),e,i),n}uo.prototype=fo.prototype={constructor:uo,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?ho():+i)+(null==e?0:+e),this._next||to===this||(to?to._next=this:Ka=this,to=this),this._call=t,this._time=i,go()},stop:function(){this._call&&(this._call=null,this._time=1/0,go())}};var xo=Ae("start","end","cancel","interrupt"),yo=[];function Ao(t,e,i,n,r,s){var a=t.__transition;if(a){if(i in a)return}else t.__transition={};!function(t,e,i){var n,r=t.__transition;function s(t){i.state=1,i.timer.restart(a,i.delay,i.time),i.delay<=t&&a(t-i.delay)}function a(s){var h,c,d,u;if(1!==i.state)return l();for(h in r)if((u=r[h]).name===i.name){if(3===u.state)return _o(a);4===u.state?(u.state=6,u.timer.stop(),u.on.call("interrupt",t,t.__data__,u.index,u.group),delete r[h]):+h<e&&(u.state=6,u.timer.stop(),u.on.call("cancel",t,t.__data__,u.index,u.group),delete r[h])}if(_o((function(){3===i.state&&(i.state=4,i.timer.restart(o,i.delay,i.time),o(s))})),i.state=2,i.on.call("start",t,t.__data__,i.index,i.group),2===i.state){for(i.state=3,n=new Array(d=i.tween.length),h=0,c=-1;h<d;++h)(u=i.tween[h].value.call(t,t.__data__,i.index,i.group))&&(n[++c]=u);n.length=c+1}}function o(e){for(var r=e<i.duration?i.ease.call(null,e/i.duration):(i.timer.restart(l),i.state=5,1),s=-1,a=n.length;++s<a;)n[s].call(t,r);5===i.state&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){for(var n in i.state=6,i.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=i,i.timer=fo(s,0,i.time)}(t,i,{name:e,index:n,group:r,on:xo,tween:yo,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function vo(t,e){var i=wo(t,e);if(i.state>0)throw new Error("too late; already scheduled");return i}function bo(t,e){var i=wo(t,e);if(i.state>3)throw new Error("too late; already running");return i}function wo(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function Mo(t,e){var i,n;return function(){var r=bo(this,t),s=r.tween;if(s!==i)for(var a=0,o=(n=i=s).length;a<o;++a)if(n[a].name===e){(n=n.slice()).splice(a,1);break}r.tween=n}}function To(t,e,i){var n,r;if("function"!=typeof i)throw new Error;return function(){var s=bo(this,t),a=s.tween;if(a!==n){r=(n=a).slice();for(var o={name:e,value:i},l=0,h=r.length;l<h;++l)if(r[l].name===e){r[l]=o;break}l===h&&r.push(o)}s.tween=r}}function So(t,e,i){var n=t._id;return t.each((function(){var t=bo(this,n);(t.value||(t.value={}))[e]=i.apply(this,arguments)})),function(t){return wo(t,n).value[e]}}function Co(t,e){var i;return("number"==typeof e?yn:e instanceof lt?pn:(i=lt(e))?(e=i,pn):wn)(t,e)}function Po(t){return function(){this.removeAttribute(t)}}function Eo(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ko(t,e,i){var n,r,s=i+"";return function(){var a=this.getAttribute(t);return a===s?null:a===n?r:r=e(n=a,i)}}function Do(t,e,i){var n,r,s=i+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===s?null:a===n?r:r=e(n=a,i)}}function zo(t,e,i){var n,r,s;return function(){var a,o,l=i(this);if(null!=l)return(a=this.getAttribute(t))===(o=l+"")?null:a===n&&o===r?s:(r=o,s=e(n=a,l));this.removeAttribute(t)}}function Oo(t,e,i){var n,r,s;return function(){var a,o,l=i(this);if(null!=l)return(a=this.getAttributeNS(t.space,t.local))===(o=l+"")?null:a===n&&o===r?s:(r=o,s=e(n=a,l));this.removeAttributeNS(t.space,t.local)}}function Ro(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function Lo(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function Bo(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&Lo(t,r)),i}return r._value=e,r}function No(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&Ro(t,r)),i}return r._value=e,r}function Fo(t,e){return function(){vo(this,t).delay=+e.apply(this,arguments)}}function Io(t,e){return e=+e,function(){vo(this,t).delay=e}}function jo(t,e){return function(){bo(this,t).duration=+e.apply(this,arguments)}}function qo(t,e){return e=+e,function(){bo(this,t).duration=e}}function Uo(t,e){if("function"!=typeof e)throw new Error;return function(){bo(this,t).ease=e}}function Go(t,e,i){var n,r,s=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?vo:bo;return function(){var a=s(this,t),o=a.on;o!==n&&(r=(n=o).copy()).on(e,i),a.on=r}}var Ho=Fi.prototype.constructor;function Xo(t){return function(){this.style.removeProperty(t)}}function Vo(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}function Yo(t,e,i){var n,r;function s(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&Vo(t,s,i)),n}return s._value=e,s}function $o(t){return function(e){this.textContent=t.call(this,e)}}function Wo(t){var e,i;function n(){var n=t.apply(this,arguments);return n!==i&&(e=(i=n)&&$o(n)),e}return n._value=t,n}var Zo=0;function Qo(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function Jo(){return++Zo}var Ko=Fi.prototype;Qo.prototype={constructor:Qo,select:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=ze(t));for(var n=this._groups,r=n.length,s=new Array(r),a=0;a<r;++a)for(var o,l,h=n[a],c=h.length,d=s[a]=new Array(c),u=0;u<c;++u)(o=h[u])&&(l=t.call(o,o.__data__,u,h))&&("__data__"in o&&(l.__data__=o.__data__),d[u]=l,Ao(d[u],e,i,u,d,wo(o,i)));return new Qo(s,this._parents,e,i)},selectAll:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=Le(t));for(var n=this._groups,r=n.length,s=[],a=[],o=0;o<r;++o)for(var l,h=n[o],c=h.length,d=0;d<c;++d)if(l=h[d]){for(var u,f=t.call(l,l.__data__,d,h),m=wo(l,i),p=0,g=f.length;p<g;++p)(u=f[p])&&Ao(u,e,i,p,f,m);s.push(f),a.push(l)}return new Qo(s,a,e,i)},selectChild:Ko.selectChild,selectChildren:Ko.selectChildren,filter:function(t){"function"!=typeof t&&(t=Be(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,a=e[r],o=a.length,l=n[r]=[],h=0;h<o;++h)(s=a[h])&&t.call(s,s.__data__,h,a)&&l.push(s);return new Qo(n,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,s=Math.min(n,r),a=new Array(n),o=0;o<s;++o)for(var l,h=e[o],c=i[o],d=h.length,u=a[o]=new Array(d),f=0;f<d;++f)(l=h[f]||c[f])&&(u[f]=l);for(;o<n;++o)a[o]=e[o];return new Qo(a,this._parents,this._name,this._id)},selection:function(){return new Ho(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,i=Jo(),n=this._groups,r=n.length,s=0;s<r;++s)for(var a,o=n[s],l=o.length,h=0;h<l;++h)if(a=o[h]){var c=wo(a,e);Ao(a,t,i,h,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Qo(n,this._parents,t,i)},call:Ko.call,nodes:Ko.nodes,node:Ko.node,size:Ko.size,empty:Ko.empty,each:Ko.each,on:function(t,e){var i=this._id;return arguments.length<2?wo(this.node(),i).on.on(t):this.each(Go(i,t,e))},attr:function(t,e){var i=Ce(t),n="transform"===i?zn:Co;return this.attrTween(t,"function"==typeof e?(i.local?Oo:zo)(i,n,So(this,"attr."+t,e)):null==e?(i.local?Eo:Po)(i):(i.local?Do:ko)(i,n,e))},attrTween:function(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var n=Ce(t);return this.tween(i,(n.local?Bo:No)(n,e))},style:function(t,e,i){var n="transform"==(t+="")?Dn:Co;return null==e?this.styleTween(t,function(t,e){var i,n,r;return function(){var s=ai(this,t),a=(this.style.removeProperty(t),ai(this,t));return s===a?null:s===i&&a===n?r:r=e(i=s,n=a)}}(t,n)).on("end.style."+t,Xo(t)):"function"==typeof e?this.styleTween(t,function(t,e,i){var n,r,s;return function(){var a=ai(this,t),o=i(this),l=o+"";return null==o&&(this.style.removeProperty(t),l=o=ai(this,t)),a===l?null:a===n&&l===r?s:(r=l,s=e(n=a,o))}}(t,n,So(this,"style."+t,e))).each(function(t,e){var i,n,r,s,a="style."+e,o="end."+a;return function(){var l=bo(this,t),h=l.on,c=null==l.value[a]?s||(s=Xo(e)):void 0;h===i&&r===c||(n=(i=h).copy()).on(o,r=c),l.on=n}}(this._id,t)):this.styleTween(t,function(t,e,i){var n,r,s=i+"";return function(){var a=ai(this,t);return a===s?null:a===n?r:r=e(n=a,i)}}(t,n,e),i).on("end.style."+t,null)},styleTween:function(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;return this.tween(n,Yo(t,e,null==i?"":i))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(So(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,Wo(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n,r=wo(this.node(),i).tween,s=0,a=r.length;s<a;++s)if((n=r[s]).name===t)return n.value;return null}return this.each((null==e?Mo:To)(i,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Fo:Io)(e,t)):wo(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?jo:qo)(e,t)):wo(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(Uo(e,t)):wo(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var i=e.apply(this,arguments);if("function"!=typeof i)throw new Error;bo(this,t).ease=i}}(this._id,t))},end:function(){var t,e,i=this,n=i._id,r=i.size();return new Promise((function(s,a){var o={value:a},l={value:function(){0==--r&&s()}};i.each((function(){var i=bo(this,n),r=i.on;r!==t&&((e=(t=r).copy())._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),i.on=e})),0===r&&s()}))},[Symbol.iterator]:Ko[Symbol.iterator]};var tl={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function el(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}function il(t,e){if(c()&&"bbox"!=e)return{x:0,y:0,width:parseInt(t.attr("width")),height:parseInt(t.attr("height"))};const i=e=>{let i=t.style(e);return i&&"string"==typeof i?(i=parseFloat(i.replace("px","")),Number.isFinite(i)?Math.round(i):0):0};let n=t.node().getBoundingClientRect();"bbox"==e&&parseFloat(n.width)>0&&(n=t.node().getBBox());let r={x:0,y:0,width:parseInt(n.width),height:parseInt(n.height)};return void 0!==n.left?(r.x=parseInt(n.left),r.y=parseInt(n.top)):void 0!==n.x&&(r.x=parseInt(n.x),r.y=parseInt(n.y)),void 0!==e&&"nopadding"!=e||(r.width-=i("padding-left")+i("padding-right"),r.height-=i("padding-top")+i("padding-bottom")),r}function nl(t,e){for(;!t.empty()&&!t.classed("root_canvas")&&e;){let i=t.attr("class");i&&(i.indexOf("root_frame")>=0||i.indexOf("__root_pad_")>=0)&&(e.x+=t.property("draw_x")||0,e.y+=t.property("draw_y")||0),t=Ii(t.node().parentNode)}return e}function rl(t,e,i){e||(e="6.4g");let n=(e=e.trim()).length;if(n<2)return i?[t.toFixed(4),"6.4f"]:t.toFixed(4);let r,s=e[n-1],a=(e=e.slice(0,n-1)).indexOf(".");a=a<0?4:parseInt(e.slice(a+1)),(!Number.isInteger(a)||a<=0)&&(a=4);let o=!1;if("e"==s||"E"==s)r=!0;else if("Q"==s)r=!0,o=!0;else if("f"==s||"F"==s)r=!1;else if("W"==s)r=!1,o=!0;else{if("g"==s||"G"==s){let n=rl(t,e+"Q",!0),r=rl(t,e+"W",!0);return n[0].length<r[0].length&&(r=n),i?r:r[0]}r=!1,a=4}if(r){o&&a--,a<0&&(a=0);let e=t.toExponential(a);return i?[e,"5."+a+"e"]:e}let l=t.toFixed(a);if(o){0!=t&&0==Number(l)&&a>0&&(a=20,l=t.toFixed(a));let e=0;for(;e<l.length&&("0"==l[e]||"-"==l[e]||"."==l[e]);)e++;let i=l.length-e-a;l.indexOf(".")>e&&i--,0!=i&&(a-=i,a<0?a=0:a>20&&(a=20),l=t.toFixed(a))}return i?[l,"5."+a+"f"]:l}Fi.prototype.interrupt=function(t){return this.each((function(){!function(t,e){var i,n,r,s=t.__transition,a=!0;if(s){for(r in e=null==e?null:e+"",s)(i=s[r]).name===e?(n=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(n?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete s[r]):a=!1;a&&delete t.__transition}}(this,t)}))},Fi.prototype.transition=function(t){var e,i;t instanceof Qo?(e=t._id,t=t._name):(e=Jo(),(i=tl).time=ho(),t=null==t?null:t+"");for(var n=this._groups,r=n.length,s=0;s<r;++s)for(var a,o=n[s],l=o.length,h=0;h<l;++h)(a=o[h])&&Ao(a,t,e,h,o,i||el(a,e));return new Qo(n,this._parents,t,e)};class sl{constructor(t){this.opt=t&&"string"==typeof t?t.toUpperCase().trim():"",this.part=""}empty(){return 0===this.opt.length||0==this.opt.replace(/[ ;_,]/g,"").length}remain(){return this.opt}check(t,e){let i=this.opt.indexOf(t);if(i<0)return!1;if(this.opt=this.opt.slice(0,i)+this.opt.slice(i+t.length),this.part="",!e)return!0;let n=i;for(;n<this.opt.length&&" "!==this.opt[n]&&","!==this.opt[n]&&";"!==this.opt[n];)n++;return n>i&&(this.part=this.opt.slice(i,n),this.opt=this.opt.slice(0,i)+this.opt.slice(n)),!0}partAsInt(t,e){let i=this.part.replace(/^\D+/g,"");return i=i?parseInt(i,10):Number.NaN,Number.isInteger(i)?i+(t||0):e||0}partAsFloat(t,e){let i=this.part.replace(/^\D+/g,"");return i=i?parseFloat(i):Number.NaN,Number.isFinite(i)?i+(t||0):e||0}}class al{constructor(t){void 0!==t&&this.seed(t)}seed(t){(t=Math.abs(t))>1e8?t=Math.abs(1e8*Math.sin(t)):t<1&&(t*=1e8),this.m_w=Math.round(t),this.m_z=987654321}random(){if(void 0===this.m_z)return Math.random();this.m_z=36969*(65535&this.m_z)+(this.m_z>>16)&4294967295,this.m_w=18e3*(65535&this.m_w)+(this.m_w>>16)&4294967295;let t=(this.m_z<<16)+this.m_w&4294967295;return t/=4294967296,t+.5}}function ol(t,e,i,n){const r=t.indexOf("bezier")>=0;void 0===n&&(n=r?2:0),void 0===i&&(i=0);const s=(t,e)=>(e.gry-t.gry)/(e.grx-t.grx);let a,o,l={path:"",close:""},h=e[0],c=Math.max(h.gry,i+5),d=Math.round(h.grx),u=Math.round(h.gry),f=e.length;const m=t=>{let e=Math.round(t);if(0==n||e===t)return e.toString();let i=t.toFixed(n);for(;"0"==i[i.length-1]&&i.lastIndexOf(".")<i.length-1;)i=i.slice(0,i.length-1);return"."==i[i.length-1]&&(i=i.slice(0,i.length-1)),"-0"==i&&(i="0"),i};if(l.path=("L"==t[0]?"L":"M")+m(h.grx)+","+m(h.gry),(r||t.indexOf("calc")>=0)&&(t=>{let e,i,n,r,a=(t=>{let e=0,i=t.length-1,n=[],r=t[0],a=t[1],o=n[0]=s(r,a);for(;++e<i;)r=a,a=t[e+1],n[e]=(o+(o=s(r,a)))/2;return n[e]=o,n})(t),o=-1,l=t.length-1;for(;++o<l;)e=s(t[o],t[o+1]),Math.abs(e)<1e-6?a[o]=a[o+1]=0:(i=a[o]/e,n=a[o+1]/e,r=i*i+n*n,r>9&&(r=3*e/Math.sqrt(r),a[o]=r*i,a[o+1]=r*n));for(o=-1;++o<=l;)r=(t[Math.min(l,o+1)].grx-t[Math.max(0,o-1)].grx)/(6*(1+a[o]*a[o])),t[o].dgrx=r||0,t[o].dgry=a[o]*r||0})(e),r){l.path+=`C${m(h.grx+h.dgrx)},${m(h.gry+h.dgry)},`;for(let t=1;t<f;++t){let i=h;h=e[t],t>1&&(l.path+="S"),l.path+=`${m(h.grx-h.dgrx)},${m(h.gry-h.dgry)},${m(h.grx)},${m(h.gry)}`,c=Math.max(c,i.gry)}}else if(f<1e4){let t=0,i=0;const n=()=>{t&&(l.path+="h"+t,t=0),i&&(l.path+="v"+i,i=0)};for(let r=1;r<f;++r)h=e[r],a=Math.round(h.grx)-d,o=Math.round(h.gry)-u,a&&o?(n(),l.path+=`l${a},${o}`):!a&&o?(0!==i&&o<0==i<0||n(),i+=o):a&&!o&&(0!==t&&a<0==t<0||n(),t+=a),d+=a,u+=o,c=Math.max(c,u);n()}else{let t,i,n=u,r=u,s=u;for(let m=1;m<f;++m)h=e[m],t=Math.round(h.grx),i=Math.round(h.gry),c=Math.max(c,i),a=t-d,0!==a?(n!==r&&(n!=u&&(l.path+="v"+(n-u)),l.path+="v"+(r-n),r!=s&&(l.path+="v"+(s-r)),u=s),o=i-u,l.path+=o?`l${a},${o}`:"h"+a,d=t,u=i,s=n=r=i):(n=Math.min(n,i),r=Math.max(r,i),s=i);n!=r&&(n!=u&&(l.path+="v"+(n-u)),l.path+="v"+(r-n),r!=s&&(l.path+="v"+(s-r)))}return i>0&&(l.close=`L${m(h.grx)},${m(c)}h${m(e[0].grx-h.grx)}Z`),l}function ll(t){return(t=(t=t.replace(/url\(\&quot\;\#(\w+)\&quot\;\)/g,"url(#$1)").replace(/ class=\"\w*\"/g,"").replace(/ pad=\"\w*\"/g,"").replace(/ title=\"\"/g,"").replace(/<g objname=\"\w*\" objtype=\"\w*\"/g,"<g").replace(/<g transform=\"translate\(\d+\,\d+\)\"><\/g>/g,"").replace(/<g><\/g>/g,"")).replace(/<svg x=\"0\" y=\"0\" overflow=\"hidden\" width=\"\d+\" height=\"\d+\" viewBox=\"0 0 \d+ \d+\"><\/svg>/g,"")).indexOf("xlink:href")<0&&(t=t.replace(/ xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\"/g,"")),t}class hl{constructor(t){this.divid=null,t&&this.setDom(t)}setDom(t){void 0!==t&&(this.divid=t,delete this._selected_main)}getDom(){return this.divid}selectDom(t){if(!this.divid)return Ii(null);let e=this._selected_main;if(!e){if("string"==typeof this.divid){let t=this.divid;"#"!=t[0]&&(t="#"+t),e=Ii(t),e.empty()||(this.divid=e.node())}else e=Ii(this.divid);this._selected_main=e}if(!e||e.empty()||"origin"===t)return e;let i=e.property("use_enlarge"),n="simple"==(e.property("layout")||"simple")?"":e.property("layout_selector");return n&&(e=e.select(n)),t||e.empty()||!i||(e=Ii("#jsroot_enlarge_div")),e}_accessTopPainter(t){let e=this.selectDom().node(),i=e?e.firstChild:null;return i?(!0===t?i.painter=this:!1===t&&delete i.painter,i.painter):null}setTopPainter(){this._accessTopPainter(!0)}getTopPainter(){return this._accessTopPainter()}clearTopPainter(){this._accessTopPainter(!1)}cleanup(t){this.clearTopPainter();let e=this.selectDom("origin");e.empty()||t||e.html(""),this.divid=null,delete this._selected_main,this._hpainter&&"function"==typeof this._hpainter.removePainter&&this._hpainter.removePainter(this),delete this._hitemname,delete this._hdrawopt,delete this._hpainter}checkResize(){}testMainResize(t,e,i){let n=this.enlargeMain("state"),r=this.selectDom("origin"),s=this.selectDom();"on"!==n&&e&&e.width&&e.height&&r.style("width",e.width+"px").style("height",e.height+"px");let a=il(r,!0),o=r.attr("can_resize"),l=!1;"height"==o&&i&&Math.abs(a.width*i-a.height)>.1*a.width&&(l=!0),(a.height<=5||a.width<=5)&&o&&"false"!==o&&(l=!0),l&&"on"!==n&&(a.width>5?(i=i||.66,r.style("height",Math.round(a.width*i)+"px")):"height"!==o&&r.style("width","200px").style("height","100px"));let h=il(s),c=s.property("draw_height"),d=s.property("draw_width");return h.changed=!1,c&&d&&c>0&&d>0?c===h.height&&d===h.width||(t>1||h.width/d<.66||h.width/d>1.5||h.height/c<.66&&h.height/c>1.5)&&(h.changed=!0):h.changed=!0,h}enlargeMain(t,e){let i=this.selectDom(!0),n=this.selectDom("origin");if(i.empty()||!m.CanEnlarge||!1===n.property("can_enlarge"))return!1;if(void 0===t)return!0;if("verify"===t)return!0;let r=n.property("use_enlarge")?"on":"off";if("state"===t)return r;"toggle"===t&&(t="off"===r);let s=Ii("#jsroot_enlarge_div");if(!0===t&&"on"!==r){if(!s.empty())return!1;s=Ii(document.body).append("div").attr("id","jsroot_enlarge_div").attr("style","position: fixed; margin: 0px; border: 0px; padding: 0px; left: 1px; right: 1px; top: 1px; bottom: 1px; background: white; opacity: 0.95; z-index: 100; overflow: hidden;");let t=il(i),r=il(s);if((r.width<=t.width||r.height<=t.height)&&r.width*r.height<t.width*t.height)return e||console.log("Enlarged area "+r.width+"x"+r.height+" smaller then original drawing "+t.width+"x"+t.height),s.remove(),!1;for(;i.node().childNodes.length>0;)s.node().appendChild(i.node().firstChild);return n.property("use_enlarge",!0),!0}if(!1===t&&"off"!==r){for(;s.node()&&s.node().childNodes.length>0;)i.node().appendChild(s.node().firstChild);return s.remove(),n.property("use_enlarge",!1),!0}return!1}setItemName(t,e,i){"string"==typeof t?this._hitemname=t:delete this._hitemname,"string"==typeof e&&(this._hdrawopt=e),this._hpainter=i}getItemName(){return"_hitemname"in this?this._hitemname:null}getItemDrawOpt(){return this._hdrawopt||""}}function cl(){return Promise.resolve().then((function(){return Gw})).then((t=>(s.nodejs_window||(s.nodejs_window=new t.JSDOM("<!DOCTYPE html>hello").window,s.nodejs_document=s.nodejs_window.document,s.nodejs_body=Ii(s.nodejs_document).select("body")),{JSDOM:t.JSDOM,doc:s.nodejs_document,body:s.nodejs_body})))}const dl=["Arial","iTimes New Roman","bTimes New Roman","biTimes New Roman","Arial","oArial","bArial","boArial","Courier New","oCourier New","bCourier New","boCourier New","Symbol","Times New Roman","Wingdings","iSymbol","Verdana","iVerdana","bVerdana","biVerdana"],ul=[.5778,.5314,.5809,.554,.5778,.5783,.6034,.603,.6003,.6004,.6003,.6005,.5521,.5521,.5664,.5314,.5664,.5495,.5748,.5578];class fl{constructor(t,e,i,n,r,s){if(this.name="Arial",this.style=null,this.weight=null,i&&e<1&&(e*=i,this.scaled=!0),this.size=Math.round(e||11),this.scale=i,null!==t){let e=Math.floor(t/10),i=dl[e]||"Arial";for(;i.length>0;){if("b"===i[0])this.weight="bold";else if("i"===i[0])this.style="italic";else{if("o"!==i[0])break;this.style="oblique"}i=i.slice(1)}this.name=i,this.aver_width=ul[e]||.55}else this.name=n,this.style=r||null,this.weight=s||null,this.aver_width=this.weight?.58:.55;"Symbol"==this.name||"Wingdings"==this.name?(this.isSymbol=this.name,this.name="Times New Roman"):this.isSymbol="",this.func=this.setFont.bind(this)}setFont(t,e){t.attr("font-family",this.name),"without-size"!=e&&t.attr("font-size",this.size).attr("xml:space","preserve"),this.weight&&t.attr("font-weight",this.weight),this.style&&t.attr("font-style",this.style)}setSize(t){this.size=Math.round(t)}setColor(t){this.color=t}setAlign(t){this.align=t}setAngle(t){this.angle=t}roundAngle(t,e){this.angle=parseInt(this.angle||0),Number.isInteger(this.angle)||(this.angle=0),this.angle=Math.round(this.angle/t)*t+(e||0),this.angle<0?this.angle+=360:this.angle>=360&&(this.angle-=360)}clearFont(t){t.attr("font-family",null).attr("font-size",null).attr("xml:space",null).attr("font-weight",null).attr("font-style",null)}isMonospace(){let t=this.name.toLowerCase();return 0==t.indexOf("courier")||"monospace"==t||"monaco"==t}getFontHtml(){let t=Math.round(this.size)+"pt "+this.name;return this.weight&&(t+=" "+this.weight),this.style&&(t+=" "+this.style),t}}const ml={"#alpha":"α","#beta":"β","#chi":"χ","#delta":"δ","#varepsilon":"ε","#phi":"φ","#gamma":"γ","#eta":"η","#iota":"ι","#varphi":"φ","#kappa":"κ","#lambda":"λ","#mu":"μ","#nu":"ν","#omicron":"ο","#pi":"π","#theta":"θ","#rho":"ρ","#sigma":"σ","#tau":"τ","#upsilon":"υ","#varomega":"ϖ","#omega":"ω","#xi":"ξ","#psi":"ψ","#zeta":"ζ","#Alpha":"Α","#Beta":"Β","#Chi":"Χ","#Delta":"Δ","#Epsilon":"Ε","#Phi":"Φ","#Gamma":"Γ","#Eta":"Η","#Iota":"Ι","#vartheta":"ϑ","#Kappa":"Κ","#Lambda":"Λ","#Mu":"Μ","#Nu":"Ν","#Omicron":"Ο","#Pi":"Π","#Theta":"Θ","#Rho":"Ρ","#Sigma":"Σ","#Tau":"Τ","#Upsilon":"Υ","#varsigma":"ς","#Omega":"Ω","#Xi":"Ξ","#Psi":"Ψ","#Zeta":"Ζ","#varUpsilon":"ϒ","#epsilon":"ε","#sqrt":"√","#bar":"","#overline":"","#underline":"","#strike":"","#leq":"≤","#/":"⁄","#infty":"∞","#voidb":"ƒ","#club":"♣","#diamond":"♦","#heart":"♥","#spade":"♠","#leftrightarrow":"↔","#leftarrow":"←","#uparrow":"↑","#rightarrow":"→","#downarrow":"↓","#circ":"ˆ","#pm":"±","#doublequote":"″","#geq":"≥","#times":"×","#propto":"∝","#partial":"∂","#bullet":"•","#divide":"÷","#neq":"≠","#equiv":"≡","#approx":"≈","#3dots":"…","#cbar":"|","#topbar":"¯","#downleftarrow":"↵","#aleph":"ℵ","#Jgothic":"ℑ","#Rgothic":"ℜ","#voidn":"℘","#otimes":"⊗","#oplus":"⊕","#oslash":"∅","#cap":"∩","#cup":"∪","#supseteq":"⊇","#supset":"⊃","#notsubset":"⊄","#subseteq":"⊆","#subset":"⊂","#int":"∫","#in":"∈","#notin":"∉","#angle":"∠","#nabla":"∇","#oright":"®","#ocopyright":"©","#trademark":"™","#prod":"∏","#surd":"√","#upoint":"˙","#corner":"¬","#wedge":"∧","#vee":"∨","#Leftrightarrow":"⇔","#Leftarrow":"⇐","#Uparrow":"⇑","#Rightarrow":"⇒","#Downarrow":"⇓","#LT":"<","#void1":"®","#copyright":"©","#void3":"™","#sum":"∑","#arctop":"⎛","#lbar":"⎸","#arcbottom":"⎝","#void8":"","#bottombar":"⌊","#arcbar":"⎧","#ltbar":"⎨","#AA":"Å","#aa":"å","#void06":"","#GT":">","#forall":"∀","#exists":"∃","#vec":"","#dot":"⋅","#hat":"·","#ddot":"","#acute":"","#grave":"","#check":"✓","#tilde":"˜","#slash":"⁄","#hbar":"ħ","#box":"◽","#Box":"☐","#parallel":"∥","#perp":"⊥","#odot":"⊙","#left":"","#right":"","{}":""},pl=new RegExp("("+Object.keys(ml).join("|").replace(/\\\{/g,"{").replace(/\\\}/g,"}")+")","g"),gl=(t,e)=>{for(;t.length>2&&"{"==t[0]&&"}"==t[t.length-1];)t=t.slice(1,t.length-1);return t.replace(pl,(t=>ml[t])).replace(/\{\}/g,"")},_l=[453,535,661,973,955,1448,1242,324,593,596,778,1011,431,570,468,492,947,885,947,947,947,947,947,947,947,947,511,495,980,1010,987,893,1624,1185,1147,1193,1216,1080,1028,1270,1274,531,910,1177,1004,1521,1252,1276,1111,1276,1164,1056,1073,1215,1159,1596,1150,1124,1065,540,591,540,837,874,572,929,972,879,973,901,569,967,973,453,458,903,453,1477,973,970,972,976,638,846,548,973,870,1285,884,864,835,656,430,656,1069],xl={945:1002,946:996,967:917,948:953,949:834,966:1149,947:847,951:989,953:516,954:951,955:913,956:1003,957:862,959:967,960:1070,952:954,961:973,963:1017,964:797,965:944,982:1354,969:1359,958:803,968:1232,950:825,913:1194,914:1153,935:1162,916:1178,917:1086,934:1358,915:1016,919:1275,921:539,977:995,922:1189,923:1170,924:1523,925:1253,927:1281,928:1281,920:1285,929:1102,931:1041,932:1069,933:1135,962:848,937:1279,926:1092,936:1334,918:1067,978:1154,8730:986,8804:940,8260:476,8734:1453,402:811,9827:1170,9830:931,9829:1067,9824:965,8596:1768,8592:1761,8593:895,8594:1761,8595:895,710:695,177:955,8243:680,8805:947,215:995,8733:1124,8706:916,8226:626,247:977,8800:969,8801:1031,8776:976,8230:1552,175:883,8629:1454,8501:1095,8465:1002,8476:1490,8472:1493,8855:1417,8853:1417,8709:1205,8745:1276,8746:1404,8839:1426,8835:1426,8836:1426,8838:1426,8834:1426,8747:480,8712:1426,8713:1426,8736:1608,8711:1551,174:1339,169:1339,8482:1469,8719:1364,729:522,172:1033,8743:1383,8744:1383,8660:1768,8656:1496,8657:1447,8658:1496,8659:1447,8721:1182,9115:882,9144:1e3,9117:882,8970:749,9127:1322,9128:1322,8491:1150,229:929,8704:1397,8707:1170,8901:524,183:519,10003:1477,732:692,295:984,9725:1780,9744:1581,8741:737,8869:1390,8857:1421},yl=(t,e,i)=>{let n=t.length,r=(i||e.size)*e.aver_width;if(e.isMonospace())return n*r;let s=0;for(let e=0;e<n;++e){let i=t.charCodeAt(e);s+=i>=32&&i<127?_l[i-32]:xl[i]||1e3}return s/1e3*r},Al=[{name:"#it{"},{name:"#bf{"},{name:"#underline{",deco:"underline"},{name:"#overline{",deco:"overline"},{name:"#strike{",deco:"line-through"},{name:"#kern[",arg:"float"},{name:"#lower[",arg:"float"},{name:"#scale[",arg:"float"},{name:"#color[",arg:"int"},{name:"#font[",arg:"int"},{name:"_{",low_up:"low"},{name:"^{",low_up:"up"},{name:"#bar{",deco:"overline"},{name:"#hat{",accent:"ˆ",hasw:!0},{name:"#check{",accent:"ˇ",hasw:!0},{name:"#acute{",accent:"ˊ"},{name:"#grave{",accent:"ˋ"},{name:"#dot{",accent:"˙"},{name:"#ddot{",accent:"ʺ",hasw:!0},{name:"#tilde{",accent:"˜",hasw:!0},{name:"#slash{",accent:"∕"},{name:"#vec{",accent:"˭",hasw:!0},{name:"#frac{",twolines:"line"},{name:"#splitline{",twolines:!0},{name:"#sqrt[",arg:"int",sqrt:!0},{name:"#sqrt{",sqrt:!0},{name:"#sum",special:"∑",w:.8,h:.9},{name:"#int",special:"∫",w:.3,h:1},{name:"#left[",right:"#right]",braces:"[]"},{name:"#left(",right:"#right)",braces:"()"},{name:"#left{",right:"#right}",braces:"{}"},{name:"#left|",right:"#right|",braces:"||"},{name:"#[]{",braces:"[]"},{name:"#(){",braces:"()"},{name:"#{}{",braces:"{}"},{name:"#||{",braces:"||"}],vl=[0,8704,0,8707,0,0,8717,0,0,8727,0,0,8722,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8773,913,914,935,916,917,934,915,919,921,977,922,923,924,925,927,928,920,929,931,932,933,962,937,926,936,918,0,8756,0,8869,0,0,945,946,967,948,949,966,947,951,953,981,954,955,956,957,959,960,952,961,963,964,965,982,969,958,968,950,0,402,0,8764,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,978,8242,8804,8260,8734,0,9827,9830,9829,9824,8596,8592,8593,8594,8595,0,0,8243,8805,0,8733,8706,8729,0,8800,8801,8776,8230,0,0,8629,8501,8465,8476,8472,8855,8853,8709,8745,8746,8835,8839,8836,8834,8838,8712,8713,8736,8711,0,0,8482,8719,8730,8901,0,8743,8744,8660,8656,8657,8658,8659,9674,9001,0,0,8482,8721,0,0,0,0,0,0,0,0,0,0,8364,9002,8747,8992,0,8993],bl=[128393,9986,9985,128083,128365,128366,128367,128383,9990,128386,128387,128234,128235,128236,128237,128193,128194,128196,128463,128464,128452,8987,128430,128432,128434,128435,128436,128427,128428,9991,9997,128398,9996,128076,128077,128078,9756,9758,9757,9759,128400,9786,128528,9785,128163,9760,127987,127985,9992,9788,128167,10052,128326,10014,128328,10016,10017,9770,9775,2384,9784,9800,9801,9802,9803,9804,9805,9806,9807,9808,9809,9810,9811,128624,128629,9679,128318,9632,9633,128912,10065,10066,11047,10731,9670,10070,11045,8999,11193,8984,127989,127990,128630,128631,0,9450,9312,9313,9314,9315,9316,9317,9318,9319,9320,9321,9471,10102,10103,10104,10105,10106,10107,10108,10109,10110,10111,128610,128608,128609,128611,128606,128604,128605,128607,183,8226,9642,9898,128902,128904,9673,9678,128319,9642,9723,128962,10022,9733,10038,10036,10041,10037,11216,8982,10209,8977,11217,10026,10032,128336,128337,128338,128339,128340,128341,128342,128343,128344,128345,128346,128347,11184,11185,11186,11187,11188,11189,11190,11191,128618,128619,128597,128596,128599,128598,128592,128593,128594,128595,9003,8998,11160,11162,11161,11163,11144,11146,11145,11147,129128,129130,129129,129131,129132,129133,129135,129134,129144,129146,129145,129147,129148,129149,129151,129150,8678,8680,8679,8681,11012,8691,11008,11009,11011,11010,129196,129197,128502,10004,128503,128505];function wl(t,e){let i="",n="Wingdings"==e?bl:vl;for(let e=0;e<t.length;++e){let r=t.charCodeAt(e),s=r>32?n[r-33]:0;i+=String.fromCodePoint(s||r)}return i}function Ml(t,e,i,n){let r=0;const s=()=>(n.g||(n.g=t.append("svg:g")),n.g),a=t=>{n.x+=Math.round(t)},o=(t,i,r,s)=>{n.rect?(n.rect.x1=Math.min(n.rect.x1,t),n.rect.y1=Math.min(n.rect.y1,i),n.rect.x2=Math.max(n.rect.x2,r),n.rect.y2=Math.max(n.rect.y2,s)):n.rect={x1:t,y1:i,x2:r,y2:s},n.rect.width=n.rect.x2-n.rect.x1,n.rect.height=n.rect.y2-n.rect.y1,n.parent||(e.text_rect=n.rect)},l=(t,e,i,r)=>{e=Math.round(e),(i=Math.round(i))?t.g.attr("transform",`translate(${e},${i})`):e&&t.g.attr("transform",`translate(${e})`),t.rect.x1+=e,t.rect.x2+=e,t.rect.y1+=i,t.rect.y2+=i,r?o(n.x+t.rect.x1,n.y+t.rect.y1,n.x+t.rect.x2,n.y+t.rect.y2):o(t.rect.x1,t.rect.y1,t.rect.x2,t.rect.y2)},h=()=>{let t=s();return 1!=r||i||n.x||n.y?(t=t.append("svg:g"),n.y?t.attr("transform",`translate(${n.x},${n.y})`):n.x&&t.attr("transform",`translate(${n.x})`),t):t},d=(t,e,n)=>{let r=0,s=1,a=!1;e||(e="{"),n||(n="}");const o=t=>r+t.length<=i.length&&i.slice(r,r+t.length)==t;for(t&&(o(e)?i=i.slice(e.length):a=!0);!a&&0!=s&&r<i.length;)o(e)?(s++,r+=e.length):o(n)?(s--,r+=n.length):r++;if(0!=s||a)return console.log(`mismatch with open ${e} and closing ${n} in ${i}`),-1;let l=i.slice(0,r-n.length);return i=i.slice(r),l},u=(t,i)=>t.append("svg:path").style("stroke",i?"none":n.color||e.color).style("stroke-width",i?null:Math.max(1,Math.round(n.fsize*(n.font.weight?.1:.07)))).style("fill",i?n.color||e.color:"none"),f=t=>({lvl:n.lvl+1,x:0,y:0,fsize:n.fsize*(t||1),color:n.color,font:n.font,parent:n,painter:n.painter});for(;i;){let p=i.length,g=null;for(let t=0;t<Al.length;++t){let e=i.indexOf(Al[t].name);e>=0&&e<p&&(p=e,g=Al[t])}if(p>0){let l=p==i.length&&0==r&&!g;r++;let h=gl(i.slice(0,p));if(h.length>0||l){let i=(n.g||(l?t:s())).append("svg:text");l&&!n.g&&(n.g=i),n.ufont&&n.font.setFont(n.g),void 0!==n.bold&&n.g.attr("font-weight",n.bold?"bold":"normal"),void 0!==n.italic&&n.g.attr("font-style",n.italic?"italic":"normal"),i.attr("fill",n.color||e.color||null),n.fisze!==n.font.size&&i.attr("font-size",Math.round(n.fsize)),n.font&&n.font.isSymbol?i.text(wl(h,n.font.isSymbol)):i.text(h);let r=c()||m.ApproxTextSize||e.fast?{height:1.2*n.fsize,width:yl(h,n.font,n.fsize)}:il(i,"nopadding");n.x&&i.attr("x",n.x),n.y&&i.attr("y",n.y),n.last_y1=n.y-.8*r.height,n.last_y2=n.y+.2*r.height,o(n.x,n.last_y1,n.x+r.width,n.last_y2),l?n.deco&&(i.attr("text-decoration",n.deco),delete n.deco):a(r.width)}}if(!g)return!0;if(i=i.slice(p+g.name.length),r++,g.accent){let t=d();if(-1===t)return!1;let i=h(),r=f();Ml(i,e,t,r);let s=.6*n.fsize,o=0,c=r.rect.width,m=Math.round(r.rect.y1),p=Math.round(.1*n.fsize),_=2*p,x=`a${p},${p},0,0,1,${_},0a${p},${p},0,0,1,${-_},0z`;g.hasw&&c<s&&(c=s,o=(s-r.rect.width)/2);let y=Math.round(.5*c),A=Math.round(.3*c),v=y-A,b=y+A;switch(c=2*y,l(r,o,0,!0),g.name){case"#check{":u(i).attr("d",`M${v},${m-_}L${y},${m}L${b},${m-_}`);break;case"#acute{":u(i).attr("d",`M${y},${m}l${_},${-_}`);break;case"#grave{":u(i).attr("d",`M${y},${m}l${-_},${-_}`);break;case"#dot{":u(i,!0).attr("d",`M${y-p},${m}${x}`);break;case"#ddot{":u(i,!0).attr("d",`M${y-3*p},${m}${x} M${y+p},${m}${x}`);break;case"#tilde{":u(i).attr("d",`M${v},${m} a${A},${_},0,0,1,${A},0 a${A},${_},0,0,0,${A},0`);break;case"#slash{":u(i).attr("d",`M${c},${m}L0,${Math.round(r.rect.y2)}`);break;case"#vec{":u(i).attr("d",`M${v},${m}H${b}M${b-_},${m-_}l${_},${_}l${-_},${_}`);break;default:u(i).attr("d",`M${v},${m}L${y},${m-_}L${b},${m}`)}a(r.rect.width);continue}if(g.twolines){n.twolines=!0;let t=d(),i=d(!0);if(-1===t||-1===i)return!1;let r=h(),s=n.parent&&n.parent.twolines?.7:1,o=f(s);Ml(r,e,t,o);let c="line"==g.twolines?u(r):null,m=f(s);Ml(r,e,i,m);let p=Math.max(o.rect.width,m.rect.width),_=o.rect.width-m.rect.width,x=.35*-n.fsize;l(o,_<0?-_/2:0,x-o.rect.y2,!0),l(m,_>0?_/2:0,x-m.rect.y1,!0),c&&c.attr("d",`M0,${Math.round(x)}h${Math.round(p-.1*n.fsize)}`),a(p),delete n.twolines;continue}const _=t=>{let e={};if(t&&(e[t]=d(),-1===e[t]))return!1;for(;i.length>0;)if("_"==i.charAt(0)){if(i=i.slice(1),e.low=e.low?-1:d(!0),-1===e.low)return console.log(`error with ${g.name} low limit`),!1}else{if("^"!=i.charAt(0))break;if(i=i.slice(1),e.up=e.up?-1:d(!0),-1===e.up)return console.log(`error with ${g.name} upper limit`),!1}return e};if(g.low_up){const t=_(g.low_up);if(!t)return!1;let i,r,o=n.x,h=-n.fsize,c=.25*n.fsize,d=0,u=0;t.up&&(i=f(.6),Ml(s(),e,t.up,i)),t.low&&(r=f(.6),Ml(s(),e,t.low,r)),void 0!==n.last_y1&&void 0!==n.last_y2&&(h=n.last_y1,c=n.last_y2),i&&(l(i,o,h-i.rect.y1-.1*n.fsize),d=i.rect.width),r&&(l(r,o,c-r.rect.y2+.1*n.fsize),u=r.rect.width),a(Math.max(d,u));continue}if(g.special){let t,i,r=_()||{},s=h(),c=u(s),d=Math.round(1.7*n.fsize),m=Math.round(n.fsize),p=Math.round(.1*d);if("#sum"==g.name?(t=i=m/2,c.attr("d",`M${m},${Math.round(-.75*d)}h${-m}l${Math.round(.4*m)},${Math.round(.3*d)}l${Math.round(-.4*m)},${Math.round(.7*d)}h${m}`)):(t=3*p,i=p,c.attr("d",`M0,${Math.round(.25*d-p)}a${p},${p},0,0,0,${2*p},0v${2*p-d}a${p},${p},0,1,1,${2*p},0`)),o(n.x,n.y-.6*d,n.x+m,n.y+.4*d),r.low){let t=f(.6);Ml(s,e,r.low,t),l(t,i-t.rect.width/2,.25*d-t.rect.y1,!0)}if(r.up){let i=f(.6);Ml(s,e,r.up,i),l(i,t-i.rect.width/2,-.75*d-i.rect.y2,!0)}a(m);continue}if(g.braces){let t=g.right,i=t?g.name:"{",r=d(!1,i,t),s=h(),c=f(),m=u(s);Ml(s,e,r,c);let p=u(s),_=Math.max(2,Math.round(.2*n.fsize)),x=c.rect,y=Math.round(x.y2-x.y1),A=Math.round(x.y1),v=Math.round(x.width);switch(g.braces){case"||":m.attr("d",`M${_},${A}v${y}`),p.attr("d",`M${3*_+v},${A}v${y}`);break;case"[]":m.attr("d",`M${2*_},${A}h${-_}v${y}h${_}`),p.attr("d",`M${2*_+v},${A}h${_}v${y}h${-_}`);break;case"{}":m.attr("d",`M${2*_},${A} a${_},${_},0,0,0,${-_},${_} v${y/2-2*_} a${_},${_},0,0,1,${-_},${_} a${_},${_},0,0,1,${_},${_} v${y/2-2*_} a${_},${_},0,0,0,${_},${_}`),p.attr("d",`M${2*_+v},${A} a${_},${_},0,0,1,${_},${_} v${y/2-2*_} a${_},${_},0,0,0,${_},${_} a${_},${_},0,0,0,${-_},${_} v${y/2-2*_} a${_},${_},0,0,1,${-_},${_}`);break;default:m.attr("d",`M${_},${A}a${4*y},${4*y},0,0,0,0,${y}`),p.attr("d",`M${3*_+v},${A}a${4*y},${4*y},0,0,1,0,${y}`)}l(c,2*_,0,!0),o(n.x,n.y+x.y1,n.x+4*_+x.width,n.y+x.y2),a(4*_+x.width),n.last_y1=x.y1,n.last_y2=x.y2;continue}if(g.deco){let t=d(),i=h(),n=f();n.deco=g.deco,Ml(i,e,t,n);let r=n.rect;if(n.deco){let t=u(i),e=Math.round(r.width);switch(n.deco){case"underline":t.attr("d",`M0,${Math.round(r.y2)}h${e}`);break;case"overline":t.attr("d",`M0,${Math.round(r.y1)}h${e}`);break;case"line-through":t.attr("d",`M0,${Math.round(.45*r.y1+.55*r.y2)}h${e}`)}}l(n,0,0,!0),a(r.width);continue}if("#bf{"==g.name||"#it{"==g.name){let t=d();if(-1===t)return!1;let i=f();"#bf{"==g.name?i.bold=!i.bold:i.italic=!i.italic,Ml(s(),e,t,i),l(i,n.x,n.y),a(i.rect.width);continue}let x=0;if(g.arg){let t=i.indexOf("]{");if(t<0)return console.log("missing argument for ",g.name),!1;if(x=i.slice(0,t),"int"==g.arg){if(x=parseInt(x),!Number.isInteger(x))return console.log("wrong int argument",i.slice(0,t)),!1}else if("float"==g.arg&&(x=parseFloat(x),!Number.isFinite(x)))return console.log("wrong float argument",i.slice(0,t)),!1;i=i.slice(t+2)}if("#kern["!=g.name&&"#lower["!=g.name)if("#color["!=g.name&&"#scale["!=g.name&&"#font["!=g.name)if(g.sqrt){let t=d();if(-1===t)return!1;let i,r=h(),s=f();g.arg&&(i=f(.7),Ml(r,e,x.toString(),i));let c=u(r);Ml(r,e,t,s);let m=s.rect,p=Math.round(m.height),_=Math.round(.1*m.height),y=Math.round(m.width),A=Math.round((m.y1+m.y2)/2),v=Math.round(.2*n.fsize),b=Math.round(m.y2);i&&l(i,0,A-.3*i.fsize,!0),c.attr("d",`M0,${A}h${_}l${_},${b-A-v}l${_},${-p+v}h${Math.round(.2*p+y)}v${_}`),l(s,.4*p,0,!0),o(n.x,n.y+m.y1-.1*n.fsize,n.x+y+.6*p,n.y+m.y2),a(y+.6*p)}else;else{let t=d();if(-1===t)return!1;let i=f();"#color["==g.name?i.color=n.painter.getColor(x):"#font["==g.name?(i.font=new fl(x),i.ufont=!0):i.fsize*=x,Ml(s(),e,t,i),l(i,n.x,n.y),a(i.rect.width)}else{let t=d();if(-1===t)return!1;let i=f();Ml(s(),e,t,i);let r=0,o=0;"kern["==g.name?r=x:o=x,l(i,n.x+r*i.rect.width,n.y+o*i.rect.height),a(i.rect.width*(r>0?1+x:1))}}return!0}function Tl(t,e,i){let n={lvl:0,g:e,x:0,y:0,dx:0,dy:-.1,fsize:i.font_size,font:i.font,parent:null,painter:t};return Ml(e,i,i.text,n)}let Sl;function Cl(){let t=void 0!==Sl;if(!t&&void 0!==globalThis.MathJax)return Promise.resolve(globalThis.MathJax);t||(Sl=[]);let e=new Promise((t=>{Sl?Sl.push(t):t(globalThis.MathJax)}));if(t)return e;let i,n={scale:1,minScale:.5,mtextInheritFont:!1,merrorInheritFont:!0,mathmlSpacing:!1,skipAttributes:{},exFactor:.5,displayAlign:"center",displayIndent:"0",fontCache:"local",localID:null,internalSpeechTitles:!0,titleID:0};return c()?cl().then((t=>(i=t.JSDOM,Promise.resolve().then((function(){return Gw}))))).then((t=>(t.init({loader:{load:["input/tex","output/svg","[tex]/color","[tex]/upgreek","[tex]/mathtools","[tex]/physics"]},tex:{packages:{"[+]":["color","upgreek","mathtools","physics"]}},svg:n,config:{JSDOM:i},startup:{typeset:!1,ready:function(){MathJax.startup.registerConstructor("jsdomAdaptor",(()=>new MathJax._.adaptors.HTMLAdaptor.HTMLAdaptor((new MathJax.config.config.JSDOM).window))),MathJax.startup.useAdaptor("jsdomAdaptor",!0),MathJax.startup.defaultReady();let t=Sl;Sl=void 0,t.forEach((t=>t(MathJax)))}}}),e))):(window.MathJax={options:{enableMenu:!1},loader:{load:["[tex]/color","[tex]/upgreek","[tex]/mathtools","[tex]/physics"]},tex:{packages:{"[+]":["color","upgreek","mathtools","physics"]}},svg:n,startup:{ready:function(){MathJax.startup.defaultReady();let t=Sl;Sl=void 0,t.forEach((t=>t(globalThis.MathJax)))}}},x("../../mathjax/3.2.0/es5/tex-svg.js").catch((()=>x("https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-svg.js"))).then((()=>e)))}const Pl={"#LT":"\\langle","#GT":"\\rangle","#club":"\\clubsuit","#spade":"\\spadesuit","#heart":"\\heartsuit","#diamond":"\\diamondsuit","#voidn":"\\wp","#voidb":"f","#copyright":"(c)","#ocopyright":"(c)","#trademark":"TM","#void3":"TM","#oright":"R","#void1":"R","#3dots":"\\ldots","#lbar":"\\mid","#void8":"\\mid","#divide":"\\div","#Jgothic":"\\Im","#Rgothic":"\\Re","#doublequote":'"',"#plus":"+","#minus":"-","#/":"/","#upoint":".","#aa":"\\mathring{a}","#AA":"\\mathring{A}","#omicron":"o","#Alpha":"A","#Beta":"B","#Epsilon":"E","#Zeta":"Z","#Eta":"H","#Iota":"I","#Kappa":"K","#Mu":"M","#Nu":"N","#Omicron":"O","#Rho":"P","#Tau":"T","#Chi":"X","#varomega":"\\varpi","#corner":"?","#ltbar":"?","#bottombar":"?","#notsubset":"?","#arcbottom":"?","#cbar":"?","#arctop":"?","#topbar":"?","#arcbar":"?","#downleftarrow":"?","#splitline":"\\genfrac{}{}{0pt}{}","#it":"\\textit","#bf":"\\textbf","#frac":"\\frac","#left{":"\\lbrace","#right}":"\\rbrace","#left\\[":"\\lbrack","#right\\]":"\\rbrack","#\\[\\]{":"\\lbrack"," } ":"\\rbrack","#\\[":"\\lbrack","#\\]":"\\rbrack","#{":"\\lbrace","#}":"\\rbrace"," ":"\\;"},El={upDelta:"Updelta",upGamma:"Upgamma",upLambda:"Uplambda",upOmega:"Upomega",upPhi:"Upphi",upPi:"Uppi",upPsi:"Uppsi",upSigma:"Upsigma",upTheta:"Uptheta",upUpsilon:"Upupsilon",upXi:"Upxi",notcong:"ncong",notgeq:"ngeq",notgr:"ngtr",notless:"nless",notleq:"nleq",notsucc:"nsucc",notprec:"nprec",notsubseteq:"nsubseteq",notsupseteq:"nsupseteq",openclubsuit:"clubsuit",openspadesuit:"spadesuit",dasharrow:"dashrightarrow",downuparrows:"updownarrow"};function kl(t,e,i,n,r,s){let a=parseInt(i.attr("width")),o=parseInt(i.attr("height"));if(Number.isInteger(o)&&Number.isInteger(a))s>0&&(a/=s,o/=s,i.attr("width",Math.round(a)).attr("height",Math.round(o)));else{let t=il(e,"bbox");a=t.width||a||100,o=t.height||o||10}s>0&&n.valign&&(n.valign=n.valign/s),null===n.valign&&(n.valign=(r-o)/2);let l={x:1,y:1},h="x",c="y";180==n.rotate?l.x=l.y=-1:270!=n.rotate&&90!=n.rotate||(l.x=270==n.rotate?-1:1,l.y=-l.x,h="y",c="x"),"middle"==n.align[0]?n[h]+=l.x*(n.width-a)/2:"end"==n.align[0]&&(n[h]+=l.x*(n.width-a)),"middle"==n.align[1]?n[c]+=l.y*(n.height-o)/2:"bottom"==n.align[1]?n[c]+=l.y*(n.height-o):"bottom-base"==n.align[1]&&(n[c]+=l.y*(n.height-o-n.valign));let d=`translate(${n.x},${n.y})`;n.rotate&&(d+=` rotate(${n.rotate})`),e.attr("transform",d).attr("visibility",null)}function Dl(t,e,i){let n=((t,e,i,n)=>{if(2!=e){for(let e in Pl)t=t.replace(new RegExp(e,"g"),Pl[e]);for(let e in ml)e.length>2&&(t=t.replace(new RegExp(e,"g"),"\\"+e.slice(1)));let e="",i=!0;for(;t;){let r=t.indexOf("#color[");if(r<0&&i){e=t;break}if(i=!1,0!=r&&(e+=r<0?t:t.slice(0,r),r<0))break;if(r=(t=t.slice(r+7)).indexOf("]{"),r<=0)break;let s=parseInt(t.slice(0,r));if(!Number.isInteger(s))break;let a=n.getColor(s),o=1;for(t=t.slice(r+2),r=-1;o&&++r<t.length;)"{"==t[r]?o++:"}"==t[r]&&o--;if(0!=o)break;let l=t.slice(0,r);t=t.slice(r+1),l&&(e+="\\color{"+a+"}{"+l+"}")}t=e}else{t=t.replace(/\\\^/g,"\\hat");for(let e in El)t=t.replace(new RegExp("\\\\"+e,"g"),"\\"+El[e])}return"string"!=typeof i?t:"\\color{"+i+"}{"+t+"}"})(i.text,i.latex,i.color,t),r={em:i.font.size,ex:i.font.size/2,family:i.font.name,scale:1,containerWidth:-1,lineWidth:1e5};return Cl().then((()=>MathJax.tex2svgPromise(n,r))).then((n=>{let r=n.querySelector("svg");return e.append((function(){return r})),function(t,e,i,n){let r=t=>{if(!t||"string"!=typeof t||t.length<3)return null;let e=t.indexOf("ex");return e<0||e!==t.length-2?null:(t=parseFloat(t.slice(0,e)),Number.isFinite(t)?t*n.font.size*.5:null)},s=r(i.getAttribute("width")),a=r(i.getAttribute("height")),o=i.getAttribute("style");if(o&&o.length>18&&0==o.indexOf("vertical-align:")){let t=o.indexOf("ex;");o=t>0&&t==o.length-3?r(o.slice(16,o.length-1)):null}else o=null;if(s=!s||s<=.5?1:Math.round(s),a=!a||a<=.5?1:Math.round(a),i.setAttribute("width",s),i.setAttribute("height",a),i.removeAttribute("style"),!c()){let t=il(e,"bbox");s=1.05*t.width,a=1.05*t.height}n.valign=o,n.scale&&t.scaleTextDrawing(Math.max(s/n.width,a/n.height),n.draw_g)}(t,e,r,i),i.applyAttributesToMathJax=kl,!0}))}function zl(t,e){let i=Math.round(t*(e||255)).toString(16);return 1==i.length?"0"+i:i}let Ol=[];function Rl(){return Ol}function Ll(t){if(!t||"TColor"!=t._typename)return null;let e="#"+zl(t.fRed)+zl(t.fGreen)+zl(t.fBlue);switch(void 0!==t.fAlpha&&1!==t.fAlpha&&(e+=zl(t.fAlpha)),e){case"#ffffff":return"white";case"#000000":return"black";case"#ff0000":return"red";case"#00ff00":return"green";case"#0000ff":return"blue";case"#ffff00":return"yellow";case"#ff00ff":return"magenta";case"#00ffff":return"cyan"}return e}function Bl(t,e){if(!t){t=[];for(let e=0;e<Ol.length;++e)t[e]=Ol[e]}if(!e)return t;let i=e;if(e._typename&&e.arr){i=[];for(let t=0;t<e.arr.length;++t){let n=e.arr[t];n&&"TColor"==n._typename&&(n.fNumber>=0&&n.fNumber<=1e4&&(i[n.fNumber]=Ll(n)))}}for(let e=0;e<i.length;++e)i[e]&&t[e]!=i[e]&&(t[e]=i[e]);return t}function Nl(t){Bl(Ol,t)}function Fl(t){return Ol[t]}class Il{constructor(t){this.palette=t}calcColorIndex(t,e){let i=this.palette.length,n=Math.floor((t+.99)*i/(e-1));return n>i-1?i-1:n}getColor(t){return this.palette[t]}getLength(){return this.palette.length}calcColor(t,e){return this.getColor(this.calcColorIndex(t,e))}}!function(){let t=["white","black","red","green","blue","yellow","magenta","cyan","#59d454","#5954d9","white"];t[110]="white",[{n:11,s:"c1b7ad4d4d4d6666668080809a9a9ab3b3b3cdcdcde6e6e6f3f3f3cdc8accdc8acc3c0a9bbb6a4b3a697b8a49cae9a8d9c8f83886657b1cfc885c3a48aa9a1839f8daebdc87b8f9a768a926983976e7b857d9ad280809caca6c0d4cf88dfbb88bd9f83c89a7dc08378cf5f61ac8f94a6787b946971d45a549300ff7b00ff6300ff4b00ff3300ff1b00ff0300ff0014ff002cff0044ff005cff0074ff008cff00a4ff00bcff00d4ff00ecff00fffd00ffe500ffcd00ffb500ff9d00ff8500ff6d00ff5500ff3d00ff2600ff0e0aff0022ff003aff0052ff006aff0082ff009aff00b1ff00c9ff00e1ff00f9ff00ffef00ffd700ffbf00ffa700ff8f00ff7700ff6000ff4800ff3000ff1800ff0000"},{n:201,s:"5c5c5c7b7b7bb8b8b8d7d7d78a0f0fb81414ec4848f176760f8a0f14b81448ec4876f1760f0f8a1414b84848ec7676f18a8a0fb8b814ecec48f1f1768a0f8ab814b8ec48ecf176f10f8a8a14b8b848ecec76f1f1"},{n:390,s:"ffffcdffff9acdcd9affff66cdcd669a9a66ffff33cdcd339a9a33666633ffff00cdcd009a9a00666600333300"},{n:406,s:"cdffcd9aff9a9acd9a66ff6666cd66669a6633ff3333cd33339a3333663300ff0000cd00009a00006600003300"},{n:422,s:"cdffff9affff9acdcd66ffff66cdcd669a9a33ffff33cdcd339a9a33666600ffff00cdcd009a9a006666003333"},{n:590,s:"cdcdff9a9aff9a9acd6666ff6666cd66669a3333ff3333cd33339a3333660000ff0000cd00009a000066000033"},{n:606,s:"ffcdffff9affcd9acdff66ffcd66cd9a669aff33ffcd33cd9a339a663366ff00ffcd00cd9a009a660066330033"},{n:622,s:"ffcdcdff9a9acd9a9aff6666cd66669a6666ff3333cd33339a3333663333ff0000cd00009a0000660000330000"},{n:791,s:"ffcd9acd9a669a66339a6600cd9a33ffcd66ff9a00ffcd33cd9a00ffcd00ff9a33cd66006633009a3300cd6633ff9a66ff6600ff6633cd3300ff33009aff3366cd00336600339a0066cd339aff6666ff0066ff3333cd0033ff00cdff9a9acd66669a33669a009acd33cdff669aff00cdff339acd00cdff009affcd66cd9a339a66009a6633cd9a66ffcd00ff6633ffcd00cd9a00ffcd33ff9a00cd66006633009a3333cd6666ff9a00ff9a33ff6600cd3300ff339acdff669acd33669a00339a3366cd669aff0066ff3366ff0033cd0033ff339aff0066cd00336600669a339acd66cdff009aff33cdff009acd00cdffcd9aff9a66cd66339a66009a9a33cdcd66ff9a00ffcd33ff9a00cdcd00ff9a33ff6600cd33006633009a6633cd9a66ff6600ff6633ff3300cd3300ffff339acd00666600339a0033cd3366ff669aff0066ff3366cd0033ff0033ff9acdcd669a9a33669a0066cd339aff66cdff009acd009aff33cdff009a"},{n:920,s:"cdcdcd9a9a9a666666333333"}].forEach((e=>{let i=e.s;for(let n=0;n<i.length;n+=6){let r=e.n+n/6;t[r]="#"+i.slice(n,n+6)}})),Ol=t}();const jl=[0,1,2,3,4,5,106,107,104,1,1,1,1,1,1,1,1,1,1,1,104,125,126,132,4,25,26,27,28,130,30,3,32,127,128,35,36,37,38,137,40,140,42,142,44,144,46,146,148,149];class ql{constructor(t){this.x0=this.y0=0,this.color="black",this.style=1,this.size=8,this.scale=1,this.stroke=!0,this.fill=!0,this.marker="",this.ndig=0,this.used=!0,this.changed=!1,this.func=this.apply.bind(this),this.setArgs(t),this.changed=!1}setArgs(t){"object"==typeof t&&"number"==typeof t.fMarkerStyle&&(t={attr:t}),t.attr&&(void 0===t.color&&(t.color=t.painter?t.painter.getColor(t.attr.fMarkerColor):Fl(t.attr.fMarkerColor)),(!t.style||t.style<0)&&(t.style=t.attr.fMarkerStyle),t.size||(t.size=t.attr.fMarkerSize)),this.color=t.color,this.style=t.style,this.size=t.size,this.refsize=t.refsize,this._configure()}resetPos(){this.lastx=this.lasty=null}create(t,e){if(!this.optimized)return`M${(t+this.x0).toFixed(this.ndig)},${(e+this.y0).toFixed(this.ndig)}${this.marker}`;let i=Math.round(t),n=Math.round(e),r=`M${i},${n}`;if(null!==this.lastx)if(i==this.lastx&&n==this.lasty)r="";else{let t=`m${i-this.lastx},${n-this.lasty}`;t.length<r.length&&(r=t)}return this.lastx=i+1,this.lasty=n,r+"h1"}getFullSize(){return this.scale*this.size}getMarkerLength(){return this.marker?this.marker.length:10}change(t,e,i){this.changed=!0,void 0!==t&&(this.color=t),void 0!==e&&e>=0&&(this.style=e),void 0!==i&&(this.size=i),this._configure()}_configure(){if(this.x0=this.y0=0,1===this.style||777===this.style)return this.fill=!1,this.marker="h1",this.size=1,this.optimized=!0,this.resetPos(),!0;this.optimized=!1;let t=jl[this.style]??104,e=t%100;this.fill=t>=100,this.scale=this.refsize||8;let i=this.getFullSize();this.ndig=i>7?0:i>2?1:2,30==e&&this.ndig++;let n=i.toFixed(this.ndig),r=(i/2).toFixed(this.ndig),s=(i/3).toFixed(this.ndig),a=(i/4).toFixed(this.ndig),o=(i/8).toFixed(this.ndig),l=(3*i/8).toFixed(this.ndig);switch(e){case 1:this.marker="h1";break;case 2:this.y0=-i/2,this.marker=`v${n}m-${r},-${r}h${n}`;break;case 3:this.x0=this.y0=-i/2,this.marker=`l${n},${n}m0,-${n}l-${n},${n}m0,-${r}h${n}m-${r},-${r}v${n}`;break;case 4:this.x0=-parseFloat(r),n=(2*parseFloat(r)).toFixed(this.ndig),this.marker=`a${r},${r},0,1,0,${n},0a${r},${r},0,1,0,-${n},0z`;break;case 5:this.x0=this.y0=-i/2,this.marker=`l${n},${n}m0,-${n}l-${n},${n}`;break;case 6:this.x0=-1,this.marker="a1,1,0,1,0,2,0a1,1,0,1,0,-2,0z";break;case 7:this.x0=-1.5,this.marker="a1.5,1.5,0,1,0,3,0a1.5,1.5,0,1,0,-3,0z";break;case 25:this.x0=this.y0=-i/2,this.marker=`v${n}h${n}v-${n}z`;break;case 26:this.y0=-i/2,this.marker=`l-${r},${n}h${n}z`;break;case 27:default:this.y0=-i/2,this.marker=`l${s},${r}l-${s},${r}l-${s},-${r}z`;break;case 28:this.x0=this.y0=i/6,this.marker=`h${s}v-${s}h-${s}v-${s}h-${s}v${s}h-${s}v${s}h${s}v${s}h${s}z`;break;case 30:this.y0=-i/2;let t=(5*i/6).toFixed(this.ndig),e=(5*i/8).toFixed(this.ndig);this.marker=`l${s},${n}l-${t},-${e}h${n}l-${t},${e}z`;break;case 32:this.y0=i/2,this.marker=`l-${r},-${n}h${n}z`;break;case 35:this.x0=-i/2,this.marker=`l${r},${r}l${r},-${r}l-${r},-${r}zh${n}m-${r},-${r}v${n}`;break;case 36:this.x0=this.y0=-i/2,this.marker=`h${n}v${n}h-${n}zl${n},${n}m0,-${n}l-${n},${n}`;break;case 37:this.x0=-i/2,this.marker=`h${n}l-${a},-${r}l-${r},${n}h${r}l-${r},-${n}z`;break;case 38:this.x0=-i/4,this.y0=-i/2,this.marker=`h${r}l${a},${a}v${r}l-${a},${a}h-${r}l-${a},-${a}v-${r}zm${a},0v${n}m-${r},-${r}h${n}`;break;case 40:this.x0=-i/4,this.y0=-i/2,this.marker=`l${r},${n}l${a},-${a}l-${n},-${r}zm${r},0l-${r},${n}l-${a},-${a}l${n},-${r}z`;break;case 42:this.y0=-i/2,this.marker=`l${o},${l}l${l},${o}l-${l},${o}l-${o},${l}l-${o},-${l}l-${l},-${o}l${l},-${o}z`;break;case 44:this.x0=-i/4,this.y0=-i/2,this.marker=`h${r}l-${o},${l}l${l},-${o}v${r}l-${l},-${o}l${o},${l}h-${r}l${o},-${l}l-${l},${o}v-${r}l${l},${o}z`;break;case 46:this.x0=-i/4,this.y0=-i/2,this.marker=`l${a},${a}l${a},-${a}l${a},${a}l-${a},${a}l${a},${a}l-${a},${a}l-${a},-${a}l-${a},${a}l-${a},-${a}l${a},-${a}l-${a},-${a}z`;break;case 48:this.x0=-i/4,this.y0=-i/2,this.marker=`l${a},${a}l-${a},${a}l-${a},-${a}zm${r},0l${a},${a}l-${a},${a}l-${a},-${a}zm0,${r}l${a},${a}l-${a},${a}l-${a},-${a}zm-${r},0l${a},${a}l-${a},${a}l-${a},-${a}z`;break;case 49:this.x0=-i/6,this.y0=-i/2,this.marker=`h${s}v${s}h-${s}zm${s},${s}h${s}v${s}h-${s}zm-${s},${s}h${s}v${s}h-${s}zm-${s},-${s}h${s}v${s}h-${s}z`}return!0}getStrokeColor(){return this.stroke?this.color:"none"}getFillColor(){return this.fill?this.color:"none"}empty(){return"none"===this.color||!this.fill&&!this.stroke}apply(t){t.style("stroke",this.stroke?this.color:"none").style("fill",this.fill?this.color:"none")}verifyDirectChange(){this.change(this.color,parseInt(this.style),parseFloat(this.size))}createSample(t,e,i){this.resetPos(),t.append("path").attr("d",this.create(e/2,i/2)).call(this.func)}}class Ul{constructor(t){this.color="none",this.colorindx=0,this.pattern=0,this.used=!0,this.kind=t.kind||2,this.changed=!1,this.func=this.apply.bind(this),this.setArgs(t),this.changed=!1}setArgs(t){t.attr&&"object"==typeof t.attr&&(void 0===t.pattern&&void 0!==t.attr.fFillStyle&&(t.pattern=t.attr.fFillStyle),void 0===t.color&&void 0!==t.attr.fFillColor&&(t.color=t.attr.fFillColor));let e=this.changed;this.change(t.color,t.pattern,t.svg,t.color_as_svg,t.painter),this.changed=e}apply(t){this.used=!0,t.style("fill",this.getFillColor()),"opacity"in this&&t.style("opacity",this.opacity),"antialias"in this&&t.style("antialias",this.antialias)}getFillColor(){return this.pattern_url||this.color}getFillColorAlt(t){return this.color&&"none"!=this.color?this.color:t}empty(){let t=this.getFillColor();return!t||"none"==t}hasColor(){return this.color&&"none"!=this.color}setSolidColor(t){delete this.pattern_url,this.color=t,this.pattern=1001}isSolid(t){return 1001===this.pattern&&(!t||t==this.color)}verifyDirectChange(t){"string"==typeof this.pattern&&(this.pattern=parseInt(this.pattern)),Number.isInteger(this.pattern)||(this.pattern=0),this.change(this.color,this.pattern,t?t.getCanvSvg():null,!0,t)}change(t,e,i,n,r){if(delete this.pattern_url,this.changed=!0,void 0!==t&&Number.isInteger(parseInt(t))&&!n&&(this.colorindx=parseInt(t)),void 0!==e&&Number.isInteger(parseInt(e))&&(this.pattern=parseInt(e),delete this.opacity,delete this.antialias),1e3==this.pattern&&0===this.colorindx)return this.pattern_url="white",!0;if(1e3==this.pattern&&(this.pattern=1001),this.pattern<1001)return this.pattern_url="none",!0;if(this.isSolid()&&0===this.colorindx&&1===this.kind&&!n)return this.pattern_url="none",!0;let s=this.colorindx;if(n?(this.color=t,"none"!=t&&(s=lt(t).hex().slice(1))):this.color=r?r.getColor(s):Fl(s),"string"!=typeof this.color&&(this.color="none"),this.isSolid())return!0;if(this.pattern>=4e3&&this.pattern<=4100)return this.opacity=(this.pattern-4e3)/100,!0;if(!i||i.empty()||this.pattern<3e3||"none"==this.color)return!1;let a="pat_"+this.pattern+"_"+s,o=i.select(".canvas_defs");if(o.empty()&&(o=i.insert("svg:defs",":first-child").attr("class","canvas_defs")),this.pattern_url="url(#"+a+")",this.antialias=!1,!o.select("."+a).empty())return!0;let l="",h=null,c="",d="",u=2,f=2;switch(this.pattern){case 3001:u=f=2,c="M0,0h1v1h-1zM1,1h1v1h-1z";break;case 3002:u=4,f=2,c="M1,0h1v1h-1zM3,1h1v1h-1z";break;case 3003:u=f=4,c="M2,1h1v1h-1zM0,3h1v1h-1z";break;case 3004:u=f=8,l="M8,0L0,8";break;case 3005:u=f=8,l="M0,0L8,8";break;case 3006:u=f=4,l="M1,0v4";break;case 3007:u=f=4,l="M0,1h4";break;case 3008:u=f=10,c="M0,3v-3h3ZM7,0h3v3ZM0,7v3h3ZM7,10h3v-3ZM5,2l3,3l-3,3l-3,-3Z",l="M0,3l5,5M3,10l5,-5M10,7l-5,-5M7,0l-5,5";break;case 3009:u=12,f=12,l="M0,0A6,6,0,0,0,12,0M6,6A6,6,0,0,0,12,12M6,6A6,6,0,0,1,0,12",h="none";break;case 3010:u=f=10,l="M0,2h10M0,7h10M2,0v2M7,2v5M2,7v3";break;case 3011:u=9,f=18,l="M5,0v8M2,1l6,6M8,1l-6,6M9,9v8M6,10l3,3l-3,3M0,9v8M3,10l-3,3l3,3",h="none";break;case 3012:u=10,f=20,l="M5,1A4,4,0,0,0,5,9A4,4,0,0,0,5,1M0,11A4,4,0,0,1,0,19M10,11A4,4,0,0,0,10,19",h="none";break;case 3013:u=f=7,l="M0,0L7,7M7,0L0,7",h="none";break;case 3014:u=f=16,l="M0,0h16v16h-16v-16M0,12h16M12,0v16M4,0v8M4,4h8M0,8h8M8,4v8",h="none";break;case 3015:u=6,f=12,l="M2,1A2,2,0,0,0,2,5A2,2,0,0,0,2,1M0,7A2,2,0,0,1,0,11M6,7A2,2,0,0,0,6,11",h="none";break;case 3016:u=12,f=7,l="M0,1A3,2,0,0,1,3,3A3,2,0,0,0,9,3A3,2,0,0,1,12,1",h="none";break;case 3017:u=f=4,l="M3,1l-2,2";break;case 3018:u=f=4,l="M1,1l2,2";break;case 3019:u=f=12,l="M1,6A5,5,0,0,0,11,6A5,5,0,0,0,1,6h-1h1A5,5,0,0,1,6,11v1v-1A5,5,0,0,1,11,6h1h-1A5,5,0,0,1,6,1v-1v1A5,5,0,0,1,1,6",h="none";break;case 3020:u=7,f=12,l="M1,0A2,3,0,0,0,3,3A2,3,0,0,1,3,9A2,3,0,0,0,1,12",h="none";break;case 3021:u=f=8,l="M8,2h-2v4h-4v2M2,0v2h-2",h="none";break;case 3022:u=f=8,l="M0,2h2v4h4v2M6,0v2h2",h="none";break;case 3023:u=f=8,c="M4,0h4v4zM8,4v4h-4z",d="M4,0L0,4L4,8L8,4Z";break;case 3024:u=f=16,c="M0,8v8h2v-8zM8,0v8h2v-8M4,14v2h12v-2z",d="M0,2h8v6h4v-6h4v12h-12v-6h-4z";break;case 3025:u=f=18,c="M5,13v-8h8ZM18,0v18h-18l5,-5h8v-8Z";break;default:if(this.pattern>3025&&this.pattern<3100){u=4,f=2,c="M1,0h1v1h-1zM3,1h1v1h-1z";break}let t=this.pattern%1e3,e=t%10,i=(t-e)%100/10,n=(t-10*i-e)/100;if(!n)break;let r,s,a,o,m,p,g,_=12*n;u=f=6*_;const x=(t,e)=>{for(r=[],s=_,m=0,g=f,Math.abs(t)<3&&(s=Math.round(_/12*9)),0==t?(s=Math.round(_/12*8),m=s/2):t>0?g-=s:m=s;m<=g;)p=m+t*s,p<0?(o=Math.round(m/(m-p)*u),r.push(0,m,o,0),r.push(u,f-m,u-o,f)):p>f?(o=Math.round((f-m)/(p-m)*u),r.push(0,m,o,f),r.push(u,f-m,u-o,0)):r.push(0,m,u,p),m+=s;for(let t=0;t<r.length;t+=4)e?(a=r[t+1],m=r[t],o=r[t+3],p=r[t+2]):(a=r[t],m=r[t+1],o=r[t+2],p=r[t+3]),l+=`M${a},${m}`,l+=p==m?"h"+(o-a):o==a?"v"+(p-m):`L${o},${p}`};switch(i){case 0:x(0);break;case 1:x(1);break;case 2:x(2);break;case 3:x(3);break;case 4:x(6);break;case 6:x(3,!0);break;case 7:x(2,!0);break;case 8:x(1,!0);break;case 9:x(0,!0)}switch(e){case 0:i&&x(0);break;case 1:x(-1);break;case 2:x(-2);break;case 3:x(-3);break;case 4:x(-6);break;case 6:x(-3,!0);break;case 7:x(-2,!0);break;case 8:x(-1,!0);break;case 9:9!=i&&x(0,!0)}}if(!c&&!l)return!1;let m=o.append("svg:pattern").attr("id",a).attr("class",a).attr("patternUnits","userSpaceOnUse").attr("width",u).attr("height",f);if(d){let t=ut(this.color);t.r=Math.round((t.r+255)/2),t.g=Math.round((t.g+255)/2),t.b=Math.round((t.b+255)/2),m.append("svg:path").attr("d",d).style("fill",t)}return c&&m.append("svg:path").attr("d",c).style("fill",this.color),l&&m.append("svg:path").attr("d",l).style("stroke",this.color).style("stroke-width",1).style("fill",h),!0}createSample(t,e,i){const n=new Ul({svg:t,pattern:this.pattern,color:this.color,color_as_svg:!0});t.append("path").attr("d",`M0,0h${e}v${i}h${-e}z`).call(n.func)}}const Gl=["","","3,3","1,2","3,4,1,4","5,3,1,3","5,3,1,3,1,3,1,3","5,5","5,3,1,3,1,3","20,5","20,10,1,10","1,3"];class Hl{constructor(t){this.func=this.apply.bind(this),this.used=!0,t._typename&&void 0!==t.fLineStyle&&(t={attr:t}),this.setArgs(t)}setArgs(t){t.attr?(t.color=t.color0||(t.painter?t.painter.getColor(t.attr.fLineColor):Fl(t.attr.fLineColor)),void 0===t.width&&(t.width=t.attr.fLineWidth),void 0===t.style&&(t.style=t.attr.fLineStyle)):"string"==typeof t.color?"none"===t.color||t.width||(t.width=1):"number"==typeof t.color&&(t.color=t.painter?t.painter.getColor(t.color):Fl(t.color)),void 0===t.width&&(t.width=t.color&&"none"!=t.color?1:0),this.color=0===t.width?"none":t.color,this.width=t.width,this.style=t.style,this.pattern=t.pattern||Gl[this.style]||null,t.can_excl&&(this.excl_side=this.excl_width=0,Math.abs(this.width)>99&&(this.excl_side=this.width<0?-1:1,this.excl_width=5*Math.floor(this.width/100),this.width=Math.abs(this.width%100))),!this.color&&this.width>0&&(this.color="lightgrey")}changeExcl(t,e){void 0!==e&&(this.excl_width=e),void 0!==t&&(this.excl_side=t,0===this.excl_width&&0!==this.excl_side&&(this.excl_width=20)),this.changed=!0}empty(){return"none"==this.color}setBorder(t,e){this.rx=t,this.ry=e,this.func=this.applyBorder.bind(this)}apply(t){this.used=!0,this.empty()?t.style("stroke",null).style("stroke-width",null).style("stroke-dasharray",null):t.style("stroke",this.color).style("stroke-width",this.width).style("stroke-dasharray",this.pattern)}applyBorder(t){this.used=!0,this.empty()?t.style("stroke",null).style("stroke-width",null).style("stroke-dasharray",null).attr("rx",null).attr("ry",null):t.style("stroke",this.color).style("stroke-width",this.width).style("stroke-dasharray",this.pattern).attr("rx",this.rx||null).attr("ry",this.ry||null)}change(t,e,i){void 0!==t&&(this.color=t),void 0!==e&&(this.width=e),void 0!==i&&(this.style=i,this.pattern=Gl[this.style]||null),this.changed=!0}createSample(t,e,i){t.append("path").attr("d",`M0,${i/2}h${e}`).call(this.func)}}function Xl(t){return(t<0||t>=Gl.length)&&(t=11),Gl[t]}class Vl extends hl{constructor(t,e,i){super(t),this.pad_name=t?this.selectCurrentPad():"",this.assignObject(e),"string"==typeof i&&(this.options={original:i})}assignObject(t){t&&"object"==typeof t?this.draw_object=t:delete this.draw_object}setPadName(t){this.pad_name="string"==typeof t?t:this.selectCurrentPad()}getPadName(){return this.pad_name||""}assignSnapId(t){this.snapid=t}cleanup(){this.removeG();let t=!0;if(this.isMainPainter()){let e=this.getPadPainter();e&&!1!==e.normal_canvas||(t=!1)}delete this.pad_name,delete this._main_painter,this.draw_object=null,delete this.snapid,delete this.fillatt,delete this.lineatt,delete this.markeratt,delete this.bins,delete this.root_colors,delete this.options,delete this.options_store,delete this.rstyle,delete this.csstype,super.cleanup(t)}getObject(){return this.draw_object}getClassName(){let t=this.getObject();return(t?t._typename:"")||""}matchObjectType(t){return!(!t||!this.draw_object)&&("string"==typeof t?this.draw_object._typename===t:t._typename?this.draw_object._typename===t._typename:this.draw_object._typename.match(t))}setItemName(t,e,i){if(super.setItemName(t,e,i),this.no_default_title||""==t)return;let n=this.getCanvSvg();n.empty()?this.selectDom().attr("title",t):n.select("title").text(t)}storeDrawOpt(t){if(!this.options)return;t||(t="");let e=t.indexOf(";;");e>=0&&(t=t.slice(0,e)),this.options.original=t,this.options_store=Object.assign({},this.options)}getDrawOpt(){if(!this.options)return"";if("function"==typeof this.options.asString){let t=!1,e=this.getPadPainter();if(!this.options_store||e&&e._interactively_changed)t=!0;else for(let e in this.options)this.options[e]!==this.options_store[e]&&(t=!0);if(t)return this.options.asString(this.isMainPainter(),e?e.getRootPad():null)}return this.options.original||""}getSupportedDrawOptions(){let t=this.getPadPainter(),e=this.getObject();return t&&e&&e._typename&&t.getObjectDrawSettings?t.getObjectDrawSettings("ROOT."+e._typename,"nosame")?.opts:[]}redrawObject(t,e){if(!this.updateObject(t,e))return!1;let i=document.body.style.cursor;document.body.style.cursor="wait";let n=this.redrawPad();return document.body.style.cursor=i,n||!0}updateObject(t){return!!this.matchObjectType(t)&&(Object.assign(this.getObject(),t),!0)}getObjectHint(){let t=this.getItemName(),e=this.getObject();return t||(t=e&&e.fName?e.fName:""),t||(t=this.getClassName()),t.length>20&&(t=t.slice(0,17)+"..."),t}getColor(t){let e=this.root_colors;if(!e){let t=this.getCanvPainter();e=this.root_colors=t&&t.root_colors?t.root_colors:Rl()}return e[t]}addColor(t){let e=this.root_colors;if(!e){let t=this.getCanvPainter();e=this.root_colors=t&&t.root_colors?t.root_colors:Rl()}let i=e.indexOf(t);return i>=0?i:(e.push(t),e.length-1)}isTooltipAllowed(){return!!(this.getCanvPainter()||this).tooltip_allowed}setTooltipAllowed(t){void 0===t&&(t=!0);let e=this.getCanvPainter()||this;e.tooltip_allowed="toggle"==t?!e.tooltip_allowed:t}checkResize(t){let e=this.getCanvPainter();return!!e&&(e.checkCanvasResize(t),!0)}removeG(){this.draw_g&&(this.draw_g.remove(),delete this.draw_g)}getG(){return this.draw_g}createG(t){let e;if(t){let i=this.getFrameSvg();if(i.empty())return console.error("Not found frame to create g element inside"),i;"string"!=typeof t&&(t="main_layer"),e=i.select("."+t)}else e=this.getLayerSvg("primitives_layer");return this.draw_g&&this.draw_g.node().parentNode!==e.node()&&(console.log("g element changes its layer!!"),this.removeG()),this.draw_g?this.draw_g.selectAll("*").remove():(this.draw_g=e.append("svg:g"),t||e.selectChildren(".most_upper_primitives").raise()),this.draw_object&&(this.draw_g.attr("objname",(this.draw_object.fName||"name").replace(/[^\w]/g,"_")),this.draw_g.attr("objtype",(this.draw_object._typename||"type").replace(/[^\w]/g,"_"))),this.draw_g.property("in_frame",!!t),this.draw_g}getCanvSvg(){return this.selectDom().select(".root_canvas")}getPadSvg(t){void 0===t&&(t=this.pad_name);let e=this.getCanvSvg();if(!t||e.empty())return e;let i=e.property("pad_painter");return i&&i.pads_cache&&i.pads_cache[t]?Ii(i.pads_cache[t]):(e=e.select(".primitives_layer .__root_pad_"+t),i&&(i.pads_cache||(i.pads_cache={}),i.pads_cache[t]=e.node()),e)}getLayerSvg(t,e){let i=this.getPadSvg(e);if(i.empty())return i;0==t.indexOf("prim#")&&(i=i.select(".primitives_layer"),t=t.slice(5));let n=i.node().firstChild;for(;n;){let e=Ii(n);if(e.classed(t))return e;n=n.nextSibling}return Ii(null)}selectCurrentPad(t){let e=this.getCanvSvg();if(e.empty())return"";let i=e.property("current_pad");return void 0!==t&&e.property("current_pad",t),i}getPadPainter(t){let e=this.getPadSvg("string"==typeof t?t:void 0);return e.empty()?null:e.property("pad_painter")}getCanvPainter(){let t=this.getCanvSvg();return t.empty()?null:t.property("pad_painter")}getAxisToSvgFunc(t,e){let i={isndc:t,nornd:e},n=this.draw_g&&this.draw_g.property("in_frame");if(n&&(i.main=this.getFramePainter()),i.main&&i.main.grx&&i.main.gry)e?(i.x=function(t){return this.main.grx(t)},i.y=function(t){return this.main.gry(t)}):(i.x=function(t){return Math.round(this.main.grx(t))},i.y=function(t){return Math.round(this.main.gry(t))});else if(n)console.error("Problem to create functor for",this.getClassName()),i.x=()=>0,i.y=()=>0;else{let e=this.getPadPainter();!t&&e&&(i.pad=e.getRootPad(!0)),i.padw=e?e.getPadWidth():10,i.x=function(t){return this.pad&&(this.pad.fLogx&&(t=t>0?Math.log10(t):this.pad.fUxmin),t=(t-this.pad.fX1)/(this.pad.fX2-this.pad.fX1)),t*=this.padw,this.nornd?t:Math.round(t)},i.padh=e?e.getPadHeight():10,i.y=function(t){return this.pad&&(this.pad.fLogy&&(t=t>0?Math.log10(t):this.pad.fUymin),t=(t-this.pad.fY1)/(this.pad.fY2-this.pad.fY1)),t=(1-t)*this.padh,this.nornd?t:Math.round(t)}}return i}axisToSvg(t,e,i,n){return this.getAxisToSvgFunc(i,n)[t](e)}svgToAxis(t,e,i){if(this.draw_g&&this.draw_g.property("in_frame")){let i=this.getFramePainter();return i?i.revertAxis(t,e):0}let n=this.getPadPainter(),r="y"==t?1-e/n.getPadHeight():e/n.getPadWidth(),s=i||!n?null:n.getRootPad(!0);return s&&("y"==t?(r=s.fY1+r*(s.fY2-s.fY1),s.fLogy&&(r=Math.pow(10,r))):(r=s.fX1+r*(s.fX2-s.fX1),s.fLogx&&(r=Math.pow(10,r)))),r}getFrameSvg(){let t=this.getLayerSvg("primitives_layer");if(t.empty())return t;let e=t.node().firstChild;for(;e;){let t=Ii(e);if(t.classed("root_frame"))return t;e=e.nextSibling}return Ii(null)}getFramePainter(){let t=this.getPadPainter();return t?t.getFramePainter():null}getMainPainter(t){let e=this._main_painter;if(!e){let i=this.getPadPainter();e=i?i.getMainPainter():this.getTopPainter(),e||(e=null),t||(this._main_painter=e)}return e}isMainPainter(){return this===this.getMainPainter()}setAsMainPainter(t){let e=this.getPadPainter();e?e.setMainPainter(this,t):this.setTopPainter()}addToPadPrimitives(t){void 0!==t&&this.setPadName(t);let e=this.getPadPainter(t);return!(!e||e===this)&&(e.painters.indexOf(this)<0&&e.painters.push(this),!this.rstyle&&e.next_rstyle&&(this.rstyle=e.next_rstyle),!0)}removeFromPadPrimitives(){let t=this.getPadPainter();if(!t||t===this)return!1;let e=t.painters.indexOf(this);return e>=0&&t.painters.splice(e,1),!0}createAttMarker(t){t&&"object"==typeof t?void 0!==t.fMarkerColor&&void 0!==t.fMarkerStyle&&void 0!==t.fMarkerSize&&(t={attr:t,std:!1}):t={std:!0},void 0===t.std&&(t.std=!0),void 0===t.painter&&(t.painter=this);let e=t.std?this.markeratt:null;return e?e.changed&&!t.force||e.setArgs(t):e=new ql(t),t.std&&(this.markeratt=e),e}createAttLine(t){t&&"object"==typeof t?void 0!==t.fLineColor&&void 0!==t.fLineStyle&&void 0!==t.fLineWidth&&(t={attr:t,std:!1}):t={std:!0},void 0===t.std&&(t.std=!0),void 0===t.painter&&(t.painter=this);let e=t.std?this.lineatt:null;return e?e.changed&&!t.force||e.setArgs(t):e=new Hl(t),t.std&&(this.lineatt=e),e}createAttFill(t){t&&"object"==typeof t?t._typename&&void 0!==t.fFillColor&&void 0!==t.fFillStyle&&(t={attr:t,std:!1}):t={std:!0},void 0===t.std&&(t.std=!0);let e=t.std?this.fillatt:null;return t.svg||(t.svg=this.getCanvSvg()),void 0===t.painter&&(t.painter=this),e?e.changed&&!t.force||e.setArgs(t):e=new Ul(t),t.std&&(this.fillatt=e),e}forEachPainter(t,e){let i=this.getPadPainter();if(i)i.forEachPainterInPad(t,e);else{let i=this.getTopPainter();i&&"pads"!==e&&t(i)}}interactiveRedraw(t,e,i){let n,r;return"string"==typeof e&&0!=e.indexOf("exec:")&&(n=e),"pad"==t?r=this.redrawPad(n):!1!==t&&(r=this.redraw(n)),q(r)||(r=Promise.resolve(!1)),r.then((()=>{let t=this.getCanvPainter();return t&&"function"==typeof t.producePadEvent&&t.producePadEvent("redraw",this.getPadPainter(),this,null,i),t&&"function"==typeof t.processChanges&&t.processChanges(e,this,i),this}))}redrawPad(t){let e=this.getPadPainter();return e?e.redrawPad(t):Promise.resolve(!1)}executeMenuCommand(t){return"Inspect"==t.fName&&this.showInspector()}submitCanvExec(t,e){if(!t||"string"!=typeof t)return;let i=this.getCanvPainter();i&&"function"==typeof i.submitExec&&i.submitExec(this,t,e)}deleteAttr(){delete this.lineatt,delete this.fillatt,delete this.markeratt}showInspector(){return!1}fillContextMenu(t){let e=this.getObjectHint();return this.getObject()&&"_typename"in this.getObject()&&(e=this.getObject()._typename+"::"+e),t.add("header:"+e),t.addAttributesMenu(this),t.size()>0&&this.showInspector("check")&&t.add("Inspect",this.showInspector),t.size()>0}showObjectStatus(t,e,i,n){let r=this.getCanvPainter();if(r&&"function"!=typeof r.showCanvasStatus&&(r=null),!r&&"function"!=typeof s.showStatus)return!1;if("on"===this.enlargeMain("state"))return!1;if(void 0===t&&void 0===e){let n=this.getObject();if(!n)return;t=this.getItemName()||n.fName,e=n.fTitle||n._typename,i=n._typename}r?r.showCanvasStatus(t,e,i,n):s.showStatus(t,e,i,n)}redraw(){}startTextDrawing(t,e,i,n){if(i||(i=this.draw_g),!i||i.empty())return;let r="font"===e?t:new fl(t,e),s=this.getPadPainter();i.call(r.func),i.property("draw_text_completed",!1).property("all_args",[]).property("text_font",r).property("text_factor",0).property("max_text_width",0).property("max_font_size",n).property("_fast_drawing",!!s&&s._fast_drawing),i.property("_fast_drawing")&&i.property("_font_too_small",n&&n<5||r.size<4)}scaleTextDrawing(t,e){e||(e=this.draw_g),e&&!e.empty()&&t&&t>e.property("text_factor")&&e.property("text_factor",t)}_checkAllTextDrawing(t,e,i){let n=t.property("all_args"),r=0;if(n||(console.log("Text drawing is finished - why calling _checkAllTextDrawing?????"),n=[]),n.forEach((t=>{t.ready||r++})),r>0)return void("function"==typeof e&&(t.node().textResolveFunc=e,t.node().try_optimize=i));t.property("all_args",null);let s=t.property("text_factor"),a=t.property("text_font"),o=t.property("max_font_size"),l=a.size,h=!1,d=!0;s>0&&(s<.9||s>1)&&(a.size=Math.max(1,Math.floor(a.size/s))),o&&a.size>o&&(a.size=o),a.size!=l&&(t.call(a.func),l=a.size),n.forEach((t=>{if(t.mj_node&&t.applyAttributesToMathJax){let e=t.mj_node.select("svg");t.applyAttributesToMathJax(this,t.mj_node,e,t,l,s),delete t.mj_node,d=!1}else t.txt_g&&(d=!1)})),e||(e=t.node().textResolveFunc,i=t.node().try_optimize,delete t.node().textResolveFunc,delete t.node().try_optimize);let u=i&&d?[]:null;n.forEach((t=>{let e,i,n=1;if(t.txt_node)e=t.txt_node,delete t.txt_node,i=!0,null!==u&&u.push(e);else{if(!t.txt_g)return;e=t.txt_g,delete t.txt_g,i=!1}if(e.attr("visibility",null),h=!0,t.width&&("middle"==t.align[0]?t.x+=t.width/2:"end"==t.align[0]&&(t.x+=t.width)),t.height&&(0===t.align[1].indexOf("bottom")?t.y+=t.height:"middle"==t.align[1]&&(t.y+=t.height/2)),t.dx=t.dy=0,i)c()?t.scale&&s>0&&(t.box.width*=1/s,t.box.height*=1/s):t.plain||t.fast||(t.box=il(e,"bbox")),t.plain?(e.attr("text-anchor",t.align[0]),"top"==t.align[1]?e.attr("dy",".8em"):"middle"==t.align[1]&&(c()?e.attr("dy",".4em"):e.attr("dominant-baseline","middle"))):(e.attr("text-anchor","start"),t.dx=("middle"==t.align[0]?-.5:"end"==t.align[0]?-1:0)*t.box.width,t.dy=("top"==t.align[1]?t.top_shift||1:"middle"==t.align[1]?t.mid_shift||.5:0)*t.box.height);else if(t.text_rect){let e=t.text_rect;n=s>0&&Math.abs(1-s)>.01?1/s:1,t.dx=("middle"==t.align[0]?-.5:"end"==t.align[0]?-1:0)*e.width*n,"top"==t.align[1]?t.dy=-e.y1*n:"bottom"==t.align[1]?t.dy=-e.y2*n:"middle"==t.align[1]&&(t.dy=-.5*(e.y1+e.y2)*n)}else console.error("text rect not calcualted - please check code");t.rotate||(t.x+=t.dx,t.y+=t.dy,t.dx=t.dy=0);let r="";t.y?r=`translate(${Math.round(t.x)},${Math.round(t.y)})`:t.x&&(r=`translate(${Math.round(t.x)})`),t.rotate&&(r+=` rotate(${Math.round(t.rotate)})`),1!==n&&(r+=` scale(${n.toFixed(3)})`),t.dy?r+=` translate(${Math.round(t.dx)},${Math.round(t.dy)})`:t.dx&&(r+=` translate(${Math.round(t.dx)})`),r&&e.attr("transform",r)})),h||a.clearFont(t),null!==u&&u.length>1&&["fill","text-anchor"].forEach((e=>{let i=u[0].attr(e);u.forEach((t=>{let n=t.attr(e);n&&n===i||(i=void 0)})),i&&(t.attr(e,i),u.forEach((t=>{t.attr(e,null)})))})),e&&e(this)}_postprocessDrawText(t,e){return t.box=c()||m.ApproxTextSize||t.fast?t.text_rect||{height:1.2*t.font_size,width:t.text.length*t.font_size*t.font.aver_width}:il(e,"bbox"),e.attr("visibility","hidden"),t.box.width>t.draw_g.property("max_text_width")&&t.draw_g.property("max_text_width",t.box.width),t.scale&&this.scaleTextDrawing(Math.max(1.05*t.box.width/t.width,1*t.box.height/t.height),t.draw_g),t.result_width=t.box.width,t.result_height=t.box.height,"function"==typeof t.post_process&&t.post_process(this),t.box.width}drawText(t){if(t.text||(t.text=""),t.draw_g=t.draw_g||this.draw_g,!t.draw_g||t.draw_g.empty())return;let e=t.draw_g.property("text_font");t.font=e,e&&(e.color&&!t.color&&(t.color=e.color),e.align&&!t.align&&(t.align=e.align),e.angle&&!t.rotate&&(t.rotate=e.angle));let i=["start","middle"];if("string"==typeof t.align?(i=t.align.split(";"),1==i.length&&i.push("middle")):"number"==typeof t.align?(t.align/10>=3?i[0]="end":t.align/10>=2&&(i[0]="middle"),t.align%10==0?i[1]="bottom":t.align%10==1?i[1]="bottom-base":t.align%10==3&&(i[1]="top")):t.align&&"object"==typeof t.align&&2==t.align.length&&(i=t.align),void 0===t.latex&&(t.latex=1),t.align=i,t.x=t.x||0,t.y=t.y||0,t.scale=t.width&&t.height&&!t.font_size,t.width=t.width||0,t.height=t.height||0,t.draw_g.property("_fast_drawing"))if(t.scale){if(t.height<4)return 0}else if(t.font_size){if(t.font_size<4)return 0}else if(t.draw_g.property("_font_too_small"))return 0;t.draw_g.property("all_args").push(t),t.ready=!1;let n=2==t.latex;return 1===t.latex&&(n=m.Latex==f.Latex.AlwaysMathJax||m.Latex==f.Latex.MathJax&&t.text.match(/[#{\\]/g)),!n||t.nomathjax?(t.txt_node=t.draw_g.append("svg:text"),t.color&&t.txt_node.attr("fill",t.color),t.font_size?t.txt_node.attr("font-size",t.font_size):t.font_size=e.size,t.plain=!t.latex||m.Latex==f.Latex.Off||m.Latex==f.Latex.Symbols,t.simple_latex=t.latex&&m.Latex==f.Latex.Symbols,!t.plain||t.simple_latex||t.font&&t.font.isSymbol?(t.simple_latex||(!(r=t.text)||r.indexOf("#")<0&&r.indexOf("{")<0)||t.plain?(t.simple_latex=!0,function(t,e,i){i.plain=!0,i.simple_latex&&(i.text=gl(i.text)),i.font&&i.font.isSymbol?e.text(wl(i.text,i.font.isSymbol)):e.text(i.text)}(0,t.txt_node,t)):(t.txt_node.remove(),delete t.txt_node,t.txt_g=t.draw_g.append("svg:g"),Tl(this,t.txt_g,t)),t.ready=!0,this._postprocessDrawText(t,t.txt_g||t.txt_node),t.draw_g.property("draw_text_completed")&&this._checkAllTextDrawing(t.draw_g),0):(t.plain=!0,t.txt_node.text(t.text),t.ready=!0,this._postprocessDrawText(t,t.txt_node))):(t.mj_node=t.draw_g.append("svg:g").attr("visibility","hidden"),Dl(this,t.mj_node,t).then((()=>{t.ready=!0,t.draw_g.property("draw_text_completed")&&this._checkAllTextDrawing(t.draw_g)})),0);var r}finishTextDrawing(t,e){return t||(t=this.draw_g),!t||t.empty()?Promise.resolve(!1):(t.property("draw_text_completed",!0),new Promise((i=>{this._checkAllTextDrawing(t,i,e)})))}configureUserContextMenu(t){t&&"function"==typeof t?this._userContextMenuFunc=t:delete this._userContextMenuFunc}fillObjectExecMenu(t,e){if(this._userContextMenuFunc)return this._userContextMenuFunc(t,e);let i=this.getCanvPainter();if(!this.snapid||!i||i._readonly||!i._websocket)return Promise.resolve(t);function n(e){let i=this.exec_painter||this,n=i.getCanvPainter(),r=i.args_menu_items[parseInt(e)];if(r&&r.fName)if("Show:Editor"!=r.fExec){if((!n||"function"!=typeof n.executeObjectMethod||!n.executeObjectMethod(i,r,i.args_menu_id))&&!i.executeMenuCommand(r)&&i.args_menu_id){if(!r.fArgs)return i.submitCanvExec(r.fExec,i.args_menu_id);r.fClassName=i.getClassName(),(i.args_menu_id.indexOf("#x")>0||i.args_menu_id.indexOf("#y")>0||i.args_menu_id.indexOf("#z")>0)&&(r.fClassName="TAxis"),t.showMethodArgsDialog(r).then((t=>{if(!t)return;if(i.executeMenuCommand(r,t))return;let e=r.fExec.slice(0,r.fExec.length-1)+t+")";n&&n.sendWebsocket("OBJEXEC:"+i.args_menu_id+":"+e)}))}}else n&&"function"==typeof n.activateGed&&n.activateGed(i)}const r=(t,e,i,r)=>{if(this._got_menu)return;this._got_menu=!0,r&&e!==r.fId&&console.error("missmatch between request "+e+" and reply "+r.fId+" identifiers");let s=r?r.fItems:null;if(s&&s.length){let e;t.size()>0&&t.add("separator"),this.args_menu_items=s,this.args_menu_id=r.fId;for(let i=0;i<s.length;++i){let r=s[i];if(r.fClassName&&e&&e!=r.fClassName&&(t.add("endsub:"),e=""),e!=r.fClassName){e=r.fClassName;let i=e.lastIndexOf("::"),n=i>0?e.slice(i+2):e;t.add("sub:"+n.replace(/[<>]/g,"_"))}void 0===r.fChecked||r.fChecked<0?t.add(r.fName,i,n):t.addchk(r.fChecked,r.fName,i,n)}e&&t.add("endsub:")}i(t)};let s=this.snapid;return e&&(s+="#"+e),this._got_menu=!1,t.painter&&(t.painter.exec_painter=t.painter!==this?this:void 0),new Promise((n=>{setTimeout((()=>r(t,s,n)),2e3),i.submitMenuRequest(this,e,s).then((e=>r(t,s,n,e)))}))}configureUserTooltipHandler(t,e){t&&"function"==typeof t?(this._user_tooltip_handler=t,this._user_tooltip_timeout=e||100):(delete this._user_tooltip_handler,delete this._user_tooltip_timeout)}configureUserClickHandler(t){let e=this.getFramePainter();e&&"function"==typeof e.configureUserClickHandler&&e.configureUserClickHandler(t)}configureUserDblclickHandler(t){let e=this.getFramePainter();e&&"function"==typeof e.configureUserDblclickHandler&&e.configureUserDblclickHandler(t)}hasUserTooltip(){return"function"==typeof this._user_tooltip_handler}provideUserTooltip(t){if(!this.hasUserTooltip())return;if(this._user_tooltip_timeout<=0)return this._user_tooltip_handler(t);if(this._user_tooltip_handle&&(clearTimeout(this._user_tooltip_handle),delete this._user_tooltip_handle),!t)return this._user_tooltip_handler(t);let e=t;this._user_tooltip_handle=setTimeout((()=>{delete this._user_tooltip_handle,this._user_tooltip_handler&&this._user_tooltip_handler(e)}),this._user_tooltip_timeout)}provideSpecialDrawArea(t){return t==this._special_draw_area?Promise.resolve(!0):this.getCanvPainter().toggleProjection(t).then((()=>(this._special_draw_area=t,!0)))}drawInSpecialArea(t,e){let i=this.getCanvPainter();return this._special_draw_area&&i&&"function"==typeof i.drawProjection?i.drawProjection(this._special_draw_area,t,e):Promise.resolve(!1)}getToolTip(t){if(!t||void 0===t.clientX||void 0===t.clientY)return null;let e=this.getFrameSvg();if(e.empty())return null;let i=e.select(".main_layer");if(i.empty())return null;let n=qi(t,i.node()),r={touch:!1,x:n[0],y:n[1]};if("function"==typeof this.extractToolTip)return this.extractToolTip(r);r.disabled=!0;let s="function"==typeof this.processTooltipEvent?this.processTooltipEvent(r):null;return s&&s.user_info?s.user_info:s}}function Yl(t,e){let i=new hl(t);return i.txt=e,i.redrawObject=function(t){return this.txt=t,this.drawText(),!0},i.drawText=function(){let t=this.txt._typename&&"TObjString"==this.txt._typename?this.txt.fString:this.txt.value;"string"!=typeof t&&(t="<undefined>");let e=this.txt.mathjax||m.Latex==f.Latex.AlwaysMathJax;if(!e&&!("as_is"in this.txt)){let e=t.split("\n");t="";for(let i=0;i<e.length;++i)t+="<pre style='margin:0'>"+e[i]+"</pre>"}let i=this.selectDom(),n=i.select("div");var r;return n.empty()&&(n=i.append("div").attr("style","max-width:100%;max-height:100%;overflow:auto")),n.html(t),this.setTopPainter(),e&&(r=i.node(),Cl().then((()=>MathJax.typesetPromise(r?[r]:void 0)))),Promise.resolve(this)},i.drawText()}function $l(t){return new Vl(t).getCanvPainter()}function Wl(t){return new Vl(t).getMainPainter(!0)}let Zl=null;function Ql(t){if(t.active){let e=Zl?Zl.getFramePainter():null;e&&e.setFrameActive(!1),Zl=t.pp,e=Zl?Zl.getFramePainter():null,e&&e.setFrameActive(!0)}else Zl===t.pp&&(Zl=null)}function Jl(){return Zl}function Kl(t,e){!0===e?e={force:!0}:"object"!=typeof e&&(e=null);let i=!1;return new Vl(t).forEachPainter((t=>{i||"function"!=typeof t.checkResize||(i=t.checkResize(e))})),i}function th(t){let e=new Vl(t),i=[];return e.forEachPainter((t=>{i.indexOf(t)<0&&i.push(t)})),i.forEach((t=>t.cleanup())),e.selectDom().html(""),i}
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const eh="138",ih=0,nh=1,rh=2,sh=0,ah=1,oh=2,lh=3,hh=100,ch=301,dh=302,uh=306,fh=1e3,mh=1001,ph=1002,gh=1003,_h=1006,xh=1008,yh=1009,Ah=1012,vh=1014,bh=1015,wh=1016,Mh=1020,Th=1023,Sh=1026,Ch=1027,Ph=33776,Eh=33777,kh=33778,Dh=33779,zh=3e3,Oh=3001,Rh=7680,Lh=35044,Bh="300 es",Nh=1035;class Fh{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const Ih=[];for(let t=0;t<256;t++)Ih[t]=(t<16?"0":"")+t.toString(16);let jh=1234567;const qh=Math.PI/180,Uh=180/Math.PI;function Gh(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Ih[255&t]+Ih[t>>8&255]+Ih[t>>16&255]+Ih[t>>24&255]+"-"+Ih[255&e]+Ih[e>>8&255]+"-"+Ih[e>>16&15|64]+Ih[e>>24&255]+"-"+Ih[63&i|128]+Ih[i>>8&255]+"-"+Ih[i>>16&255]+Ih[i>>24&255]+Ih[255&n]+Ih[n>>8&255]+Ih[n>>16&255]+Ih[n>>24&255]).toUpperCase()}function Hh(t,e,i){return Math.max(e,Math.min(i,t))}function Xh(t,e){return(t%e+e)%e}function Vh(t,e,i){return(1-i)*t+i*e}function Yh(t){return 0==(t&t-1)&&0!==t}function $h(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Wh=Object.freeze({__proto__:null,DEG2RAD:qh,RAD2DEG:Uh,generateUUID:Gh,clamp:Hh,euclideanModulo:Xh,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:Vh,damp:function(t,e,i,n){return Vh(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(Xh(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(jh=t%2147483647),jh=16807*jh%2147483647,(jh-1)/2147483646},degToRad:function(t){return t*qh},radToDeg:function(t){return t*Uh},isPowerOfTwo:Yh,ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:$h,setQuaternionFromProperEuler:function(t,e,i,n,r){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),h=s((e+n)/2),c=a((e+n)/2),d=s((e-n)/2),u=a((e-n)/2),f=s((n-e)/2),m=a((n-e)/2);switch(r){case"XYX":t.set(o*c,l*d,l*u,o*h);break;case"YZY":t.set(l*u,o*c,l*d,o*h);break;case"ZXZ":t.set(l*d,l*u,o*c,o*h);break;case"XZX":t.set(o*c,l*m,l*f,o*h);break;case"YXY":t.set(l*f,o*c,l*m,o*h);break;case"ZYZ":t.set(l*m,l*f,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Zh{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Zh.prototype.isVector2=!0;class Qh{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l){const h=this.elements;return h[0]=t,h[1]=n,h[2]=a,h[3]=e,h[4]=r,h[5]=o,h[6]=i,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],h=i[4],c=i[7],d=i[2],u=i[5],f=i[8],m=n[0],p=n[3],g=n[6],_=n[1],x=n[4],y=n[7],A=n[2],v=n[5],b=n[8];return r[0]=s*m+a*_+o*A,r[3]=s*p+a*x+o*v,r[6]=s*g+a*y+o*b,r[1]=l*m+h*_+c*A,r[4]=l*p+h*x+c*v,r[7]=l*g+h*y+c*b,r[2]=d*m+u*_+f*A,r[5]=d*p+u*x+f*v,r[8]=d*g+u*y+f*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8];return e*s*h-e*a*l-i*r*h+i*a*o+n*r*l-n*s*o}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=h*s-a*l,d=a*o-h*r,u=l*r-s*o,f=e*c+i*d+n*u;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const m=1/f;return t[0]=c*m,t[1]=(n*l-h*i)*m,t[2]=(a*i-n*s)*m,t[3]=d*m,t[4]=(h*e-n*o)*m,t[5]=(n*r-a*e)*m,t[6]=u*m,t[7]=(i*o-l*e)*m,t[8]=(s*e-i*r)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],a=n[6],o=n[1],l=n[4],h=n[7];return n[0]=e*r+i*o,n[3]=e*s+i*l,n[6]=e*a+i*h,n[1]=-i*r+e*o,n[4]=-i*s+e*l,n[7]=-i*a+e*h,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function Jh(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}function Kh(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}Qh.prototype.isMatrix3=!0;const tc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ec={h:0,s:0,l:0},ic={h:0,s:0,l:0};function nc(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function rc(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function sc(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class ac{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=Xh(t,1),e=Hh(e,0,1),i=Hh(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=nc(r,n,t+1/3),this.g=nc(r,n,t),this.b=nc(r,n,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=tc[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=rc(t.r),this.g=rc(t.g),this.b=rc(t.b),this}copyLinearToSRGB(t){return this.r=sc(t.r),this.g=sc(t.g),this.b=sc(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),s=Math.min(e,i,n);let a,o;const l=(s+r)/2;if(s===r)a=0,o=0;else{const t=r-s;switch(o=l<=.5?t/(r+s):t/(2-r-s),r){case e:a=(i-n)/t+(i<n?6:0);break;case i:a=(n-e)/t+2;break;case n:a=(e-i)/t+4}a/=6}return t.h=a,t.s=o,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(ec),ec.h+=t,ec.s+=e,ec.l+=i,this.setHSL(ec.h,ec.s,ec.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(ec),t.getHSL(ic);const i=Vh(ec.h,ic.h,e),n=Vh(ec.s,ic.s,e),r=Vh(ec.l,ic.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let oc;ac.NAMES=tc,ac.prototype.isColor=!0,ac.prototype.r=1,ac.prototype.g=1,ac.prototype.b=1;class lc{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===oc&&(oc=Kh("canvas")),oc.width=t.width,oc.height=t.height;const i=oc.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=oc}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Kh("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*rc(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*rc(e[t]/255)):e[t]=rc(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class hc{constructor(t=null){this.uuid=Gh(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(cc(n[e].image)):t.push(cc(n[e]))}else t=cc(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function cc(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?lc.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}hc.prototype.isSource=!0;let dc=0;class uc extends Fh{constructor(t=uc.DEFAULT_IMAGE,e=uc.DEFAULT_MAPPING,i=1001,n=1001,r=1006,s=1008,a=1023,o=1009,l=1,h=3e3){super(),Object.defineProperty(this,"id",{value:dc++}),this.uuid=Gh(),this.name="",this.source=new hc(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Zh(0,0),this.repeat=new Zh(1,1),this.center=new Zh(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Qh,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case fh:t.x=t.x-Math.floor(t.x);break;case mh:t.x=t.x<0?0:1;break;case ph:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case fh:t.y=t.y-Math.floor(t.y);break;case mh:t.y=t.y<0?0:1;break;case ph:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}uc.DEFAULT_IMAGE=null,uc.DEFAULT_MAPPING=300,uc.prototype.isTexture=!0;class fc{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,a=.1,o=t.elements,l=o[0],h=o[4],c=o[8],d=o[1],u=o[5],f=o[9],m=o[2],p=o[6],g=o[10];if(Math.abs(h-d)<s&&Math.abs(c-m)<s&&Math.abs(f-p)<s){if(Math.abs(h+d)<a&&Math.abs(c+m)<a&&Math.abs(f+p)<a&&Math.abs(l+u+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(u+1)/2,_=(g+1)/2,x=(h+d)/4,y=(c+m)/4,A=(f+p)/4;return t>o&&t>_?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=x/i,r=y/i):o>_?o<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(o),i=x/n,r=A/n):_<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=y/r,n=A/r),this.set(i,n,r,e),this}let _=Math.sqrt((p-f)*(p-f)+(c-m)*(c-m)+(d-h)*(d-h));return Math.abs(_)<.001&&(_=1),this.x=(p-f)/_,this.y=(c-m)/_,this.z=(d-h)/_,this.w=Math.acos((l+u+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}fc.prototype.isVector4=!0;class mc extends Fh{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new fc(0,0,t,e),this.scissorTest=!1,this.viewport=new fc(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new uc(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:_h,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}mc.prototype.isWebGLRenderTarget=!0;class pc{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,a){let o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const d=r[s+0],u=r[s+1],f=r[s+2],m=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=d,t[e+1]=u,t[e+2]=f,void(t[e+3]=m);if(c!==m||o!==d||l!==u||h!==f){let t=1-a;const e=o*d+l*u+h*f+c*m,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*t+d*r,l=l*t+u*r,h=h*t+f*r,c=c*t+m*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],h=i[n+3],c=r[s],d=r[s+1],u=r[s+2],f=r[s+3];return t[e]=a*f+h*c+o*u-l*d,t[e+1]=o*f+h*d+l*c-a*u,t[e+2]=l*f+h*u+a*d-o*c,t[e+3]=h*f-a*c-o*d-l*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(n/2),c=a(r/2),d=o(i/2),u=o(n/2),f=o(r/2);switch(s){case"XYZ":this._x=d*h*c+l*u*f,this._y=l*u*c-d*h*f,this._z=l*h*f+d*u*c,this._w=l*h*c-d*u*f;break;case"YXZ":this._x=d*h*c+l*u*f,this._y=l*u*c-d*h*f,this._z=l*h*f-d*u*c,this._w=l*h*c+d*u*f;break;case"ZXY":this._x=d*h*c-l*u*f,this._y=l*u*c+d*h*f,this._z=l*h*f+d*u*c,this._w=l*h*c-d*u*f;break;case"ZYX":this._x=d*h*c-l*u*f,this._y=l*u*c+d*h*f,this._z=l*h*f-d*u*c,this._w=l*h*c+d*u*f;break;case"YZX":this._x=d*h*c+l*u*f,this._y=l*u*c+d*h*f,this._z=l*h*f-d*u*c,this._w=l*h*c-d*u*f;break;case"XZY":this._x=d*h*c-l*u*f,this._y=l*u*c-d*h*f,this._z=l*h*f+d*u*c,this._w=l*h*c+d*u*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],d=i+a+c;if(d>0){const t=.5/Math.sqrt(d+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>a&&i>c){const t=2*Math.sqrt(1+i-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(a>c){const t=2*Math.sqrt(1+a-i-c);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-i-a);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Hh(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+s*a+n*l-r*o,this._y=n*h+s*o+r*a-i*l,this._z=r*h+s*l+i*o-n*a,this._w=s*h-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,d=Math.sin(e*h)/l;return this._w=s*c+this._w*d,this._x=i*c+this._x*d,this._y=n*c+this._y*d,this._z=r*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}pc.prototype.isQuaternion=!0;class gc{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(xc.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(xc.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,h=o*i+a*e-r*n,c=o*n+r*i-s*e,d=-r*e-s*i-a*n;return this.x=l*o+d*-r+h*-a-c*-s,this.y=h*o+d*-s+c*-r-l*-a,this.z=c*o+d*-a+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return _c.copy(this).projectOnVector(t),this.sub(_c)}reflect(t){return this.sub(_c.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Hh(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}gc.prototype.isVector3=!0;const _c=new gc,xc=new pc;class yc{constructor(t=new gc(1/0,1/0,1/0),e=new gc(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],h=t[o+1],c=t[o+2];l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),h=t.getY(o),c=t.getZ(o);l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=vc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)vc.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(vc)}else null===i.boundingBox&&i.computeBoundingBox(),bc.copy(i.boundingBox),bc.applyMatrix4(t.matrixWorld),this.union(bc);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,vc),vc.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ec),kc.subVectors(this.max,Ec),wc.subVectors(t.a,Ec),Mc.subVectors(t.b,Ec),Tc.subVectors(t.c,Ec),Sc.subVectors(Mc,wc),Cc.subVectors(Tc,Mc),Pc.subVectors(wc,Tc);let e=[0,-Sc.z,Sc.y,0,-Cc.z,Cc.y,0,-Pc.z,Pc.y,Sc.z,0,-Sc.x,Cc.z,0,-Cc.x,Pc.z,0,-Pc.x,-Sc.y,Sc.x,0,-Cc.y,Cc.x,0,-Pc.y,Pc.x,0];return!!Oc(e,wc,Mc,Tc,kc)&&(e=[1,0,0,0,1,0,0,0,1],!!Oc(e,wc,Mc,Tc,kc)&&(Dc.crossVectors(Sc,Cc),e=[Dc.x,Dc.y,Dc.z],Oc(e,wc,Mc,Tc,kc)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return vc.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(vc).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Ac[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ac[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ac[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ac[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ac[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ac[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ac[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ac[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ac)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}yc.prototype.isBox3=!0;const Ac=[new gc,new gc,new gc,new gc,new gc,new gc,new gc,new gc],vc=new gc,bc=new yc,wc=new gc,Mc=new gc,Tc=new gc,Sc=new gc,Cc=new gc,Pc=new gc,Ec=new gc,kc=new gc,Dc=new gc,zc=new gc;function Oc(t,e,i,n,r){for(let s=0,a=t.length-3;s<=a;s+=3){zc.fromArray(t,s);const a=r.x*Math.abs(zc.x)+r.y*Math.abs(zc.y)+r.z*Math.abs(zc.z),o=e.dot(zc),l=i.dot(zc),h=n.dot(zc);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}const Rc=new yc,Lc=new gc,Bc=new gc,Nc=new gc;class Fc{constructor(t=new gc,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):Rc.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Nc.subVectors(t,this.center);const e=Nc.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(Nc.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return!0===this.center.equals(t.center)?Bc.set(0,0,1).multiplyScalar(t.radius):Bc.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Lc.copy(t.center).add(Bc)),this.expandByPoint(Lc.copy(t.center).sub(Bc)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ic=new gc,jc=new gc,qc=new Qh;class Uc{constructor(t=new gc(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Ic.subVectors(i,e).cross(jc.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(Ic),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||qc.getNormalMatrix(t),n=this.coplanarPoint(Ic).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Uc.prototype.isPlane=!0;const Gc=new Fc,Hc=new gc;class Xc{constructor(t=new Uc,e=new Uc,i=new Uc,n=new Uc,r=new Uc,s=new Uc){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],h=i[6],c=i[7],d=i[8],u=i[9],f=i[10],m=i[11],p=i[12],g=i[13],_=i[14],x=i[15];return e[0].setComponents(a-n,c-o,m-d,x-p).normalize(),e[1].setComponents(a+n,c+o,m+d,x+p).normalize(),e[2].setComponents(a+r,c+l,m+u,x+g).normalize(),e[3].setComponents(a-r,c-l,m-u,x-g).normalize(),e[4].setComponents(a-s,c-h,m-f,x-_).normalize(),e[5].setComponents(a+s,c+h,m+f,x+_).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Gc.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Gc)}intersectsSprite(t){return Gc.center.set(0,0,0),Gc.radius=.7071067811865476,Gc.applyMatrix4(t.matrixWorld),this.intersectsSphere(Gc)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Hc.x=n.normal.x>0?t.max.x:t.min.x,Hc.y=n.normal.y>0?t.max.y:t.min.y,Hc.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Hc)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class Vc{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l,h,c,d,u,f,m,p){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=d,g[3]=u,g[7]=f,g[11]=m,g[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Vc).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/Yc.setFromMatrixColumn(t,0).length(),r=1/Yc.setFromMatrixColumn(t,1).length(),s=1/Yc.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t+r*a,e[4]=n*a-i,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-a,e[2]=i*a-n,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t-r*a,e[4]=-s*c,e[8]=n+i*a,e[1]=i+n*a,e[5]=s*h,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=r-t*c,e[8]=n*c+i,e[1]=c,e[5]=s*h,e[9]=-a*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-r*c}else if("XZY"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=a*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Wc,t,Zc)}lookAt(t,e,i){const n=this.elements;return Kc.subVectors(t,e),0===Kc.lengthSq()&&(Kc.z=1),Kc.normalize(),Qc.crossVectors(i,Kc),0===Qc.lengthSq()&&(1===Math.abs(i.z)?Kc.x+=1e-4:Kc.z+=1e-4,Kc.normalize(),Qc.crossVectors(i,Kc)),Qc.normalize(),Jc.crossVectors(Kc,Qc),n[0]=Qc.x,n[4]=Jc.x,n[8]=Kc.x,n[1]=Qc.y,n[5]=Jc.y,n[9]=Kc.y,n[2]=Qc.z,n[6]=Jc.z,n[10]=Kc.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],h=i[1],c=i[5],d=i[9],u=i[13],f=i[2],m=i[6],p=i[10],g=i[14],_=i[3],x=i[7],y=i[11],A=i[15],v=n[0],b=n[4],w=n[8],M=n[12],T=n[1],S=n[5],C=n[9],P=n[13],E=n[2],k=n[6],D=n[10],z=n[14],O=n[3],R=n[7],L=n[11],B=n[15];return r[0]=s*v+a*T+o*E+l*O,r[4]=s*b+a*S+o*k+l*R,r[8]=s*w+a*C+o*D+l*L,r[12]=s*M+a*P+o*z+l*B,r[1]=h*v+c*T+d*E+u*O,r[5]=h*b+c*S+d*k+u*R,r[9]=h*w+c*C+d*D+u*L,r[13]=h*M+c*P+d*z+u*B,r[2]=f*v+m*T+p*E+g*O,r[6]=f*b+m*S+p*k+g*R,r[10]=f*w+m*C+p*D+g*L,r[14]=f*M+m*P+p*z+g*B,r[3]=_*v+x*T+y*E+A*O,r[7]=_*b+x*S+y*k+A*R,r[11]=_*w+x*C+y*D+A*L,r[15]=_*M+x*P+y*z+A*B,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],d=t[10],u=t[14];return t[3]*(+r*o*c-n*l*c-r*a*d+i*l*d+n*a*u-i*o*u)+t[7]*(+e*o*u-e*l*d+r*s*d-n*s*u+n*l*h-r*o*h)+t[11]*(+e*l*c-e*a*u-r*s*c+i*s*u+r*a*h-i*l*h)+t[15]*(-n*a*h-e*o*c+e*a*d+n*s*c-i*s*d+i*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],d=t[10],u=t[11],f=t[12],m=t[13],p=t[14],g=t[15],_=c*p*l-m*d*l+m*o*u-a*p*u-c*o*g+a*d*g,x=f*d*l-h*p*l-f*o*u+s*p*u+h*o*g-s*d*g,y=h*m*l-f*c*l+f*a*u-s*m*u-h*a*g+s*c*g,A=f*c*o-h*m*o-f*a*d+s*m*d+h*a*p-s*c*p,v=e*_+i*x+n*y+r*A;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/v;return t[0]=_*b,t[1]=(m*d*r-c*p*r-m*n*u+i*p*u+c*n*g-i*d*g)*b,t[2]=(a*p*r-m*o*r+m*n*l-i*p*l-a*n*g+i*o*g)*b,t[3]=(c*o*r-a*d*r-c*n*l+i*d*l+a*n*u-i*o*u)*b,t[4]=x*b,t[5]=(h*p*r-f*d*r+f*n*u-e*p*u-h*n*g+e*d*g)*b,t[6]=(f*o*r-s*p*r-f*n*l+e*p*l+s*n*g-e*o*g)*b,t[7]=(s*d*r-h*o*r+h*n*l-e*d*l-s*n*u+e*o*u)*b,t[8]=y*b,t[9]=(f*c*r-h*m*r-f*i*u+e*m*u+h*i*g-e*c*g)*b,t[10]=(s*m*r-f*a*r+f*i*l-e*m*l-s*i*g+e*a*g)*b,t[11]=(h*a*r-s*c*r-h*i*l+e*c*l+s*i*u-e*a*u)*b,t[12]=A*b,t[13]=(h*m*n-f*c*n+f*i*d-e*m*d-h*i*p+e*c*p)*b,t[14]=(f*a*n-s*m*n-f*i*o+e*m*o+s*i*p-e*a*p)*b,t[15]=(s*c*n-h*a*n+h*i*o-e*c*o-s*i*d+e*a*d)*b,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,h=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,h*a+i,h*o-n*s,0,l*o-n*a,h*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,h=s+s,c=a+a,d=r*l,u=r*h,f=r*c,m=s*h,p=s*c,g=a*c,_=o*l,x=o*h,y=o*c,A=i.x,v=i.y,b=i.z;return n[0]=(1-(m+g))*A,n[1]=(u+y)*A,n[2]=(f-x)*A,n[3]=0,n[4]=(u-y)*v,n[5]=(1-(d+g))*v,n[6]=(p+_)*v,n[7]=0,n[8]=(f+x)*b,n[9]=(p-_)*b,n[10]=(1-(d+m))*b,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=Yc.set(n[0],n[1],n[2]).length();const s=Yc.set(n[4],n[5],n[6]).length(),a=Yc.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],$c.copy(this);const o=1/r,l=1/s,h=1/a;return $c.elements[0]*=o,$c.elements[1]*=o,$c.elements[2]*=o,$c.elements[4]*=l,$c.elements[5]*=l,$c.elements[6]*=l,$c.elements[8]*=h,$c.elements[9]*=h,$c.elements[10]*=h,e.setFromRotationMatrix($c),i.x=r,i.y=s,i.z=a,this}makePerspective(t,e,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),d=-(s+r)/(s-r),u=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=u,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s){const a=this.elements,o=1/(e-t),l=1/(i-n),h=1/(s-r),c=(e+t)*o,d=(i+n)*l,u=(s+r)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-u,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}Vc.prototype.isMatrix4=!0;const Yc=new gc,$c=new Vc,Wc=new gc(0,0,0),Zc=new gc(1,1,1),Qc=new gc,Jc=new gc,Kc=new gc;function td(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function ed(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,n){const r=e.array,s=e.usage,a=t.createBuffer();let o;if(t.bindBuffer(n,a),t.bufferData(n,r,s),e.onUploadCallback(),r instanceof Float32Array)o=t.FLOAT;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=t.HALF_FLOAT}else o=t.UNSIGNED_SHORT;else if(r instanceof Int16Array)o=t.SHORT;else if(r instanceof Uint32Array)o=t.UNSIGNED_INT;else if(r instanceof Int32Array)o=t.INT;else if(r instanceof Int8Array)o=t.BYTE;else if(r instanceof Uint8Array)o=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=t.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,n,r){const s=n.array,a=n.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,e,r),s.version=e.version)}}}const id=new gc,nd=new Zh;class rd{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=Lh,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new ac),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Zh),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new gc),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new fc),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)nd.fromBufferAttribute(this,e),nd.applyMatrix3(t),this.setXY(e,nd.x,nd.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)id.fromBufferAttribute(this,e),id.applyMatrix3(t),this.setXYZ(e,id.x,id.y,id.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)id.x=this.getX(e),id.y=this.getY(e),id.z=this.getZ(e),id.applyMatrix4(t),this.setXYZ(e,id.x,id.y,id.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)id.x=this.getX(e),id.y=this.getY(e),id.z=this.getZ(e),id.applyNormalMatrix(t),this.setXYZ(e,id.x,id.y,id.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)id.x=this.getX(e),id.y=this.getY(e),id.z=this.getZ(e),id.transformDirection(t),this.setXYZ(e,id.x,id.y,id.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Lh&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}rd.prototype.isBufferAttribute=!0;class sd extends rd{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class ad extends rd{constructor(t,e,i){super(new Uint32Array(t),e,i)}}(class extends rd{constructor(t,e,i){super(new Uint16Array(t),e,i)}}).prototype.isFloat16BufferAttribute=!0;class od extends rd{constructor(t,e,i){super(new Float32Array(t),e,i)}}const ld=new Vc,hd=new pc;class cd{constructor(t=0,e=0,i=0,n=cd.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],h=n[9],c=n[2],d=n[6],u=n[10];switch(e){case"XYZ":this._y=Math.asin(Hh(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,u),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Hh(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,u),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(Hh(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,u),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Hh(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Hh(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-Hh(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return ld.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ld,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return hd.setFromEuler(this),this.setFromQuaternion(hd,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}cd.prototype.isEuler=!0,cd.DefaultOrder="XYZ",cd.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class dd{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let ud=0;const fd=new gc,md=new pc,pd=new Vc,gd=new gc,_d=new gc,xd=new gc,yd=new pc,Ad=new gc(1,0,0),vd=new gc(0,1,0),bd=new gc(0,0,1),wd={type:"added"},Md={type:"removed"};class Td extends Fh{constructor(){super(),Object.defineProperty(this,"id",{value:ud++}),this.uuid=Gh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Td.DefaultUp.clone();const t=new gc,e=new cd,i=new pc,n=new gc(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Vc},normalMatrix:{value:new Qh}}),this.matrix=new Vc,this.matrixWorld=new Vc,this.matrixAutoUpdate=Td.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new dd,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return md.setFromAxisAngle(t,e),this.quaternion.multiply(md),this}rotateOnWorldAxis(t,e){return md.setFromAxisAngle(t,e),this.quaternion.premultiply(md),this}rotateX(t){return this.rotateOnAxis(Ad,t)}rotateY(t){return this.rotateOnAxis(vd,t)}rotateZ(t){return this.rotateOnAxis(bd,t)}translateOnAxis(t,e){return fd.copy(t).applyQuaternion(this.quaternion),this.position.add(fd.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Ad,t)}translateY(t){return this.translateOnAxis(vd,t)}translateZ(t){return this.translateOnAxis(bd,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(pd.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?gd.copy(t):gd.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),_d.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pd.lookAt(_d,gd,this.up):pd.lookAt(gd,_d,this.up),this.quaternion.setFromRotationMatrix(pd),n&&(pd.extractRotation(n.matrixWorld),md.setFromRotationMatrix(pd),this.quaternion.premultiply(md.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(wd)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Md)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Md)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),pd.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),pd.multiply(t.parent.matrixWorld)),t.applyMatrix4(pd),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_d,t,xd),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_d,yd,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),h=s(t.animations),c=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),h.length>0&&(i.animations=h),c.length>0&&(i.nodes=c)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Td.DefaultUp=new gc(0,1,0),Td.DefaultMatrixAutoUpdate=!0,Td.prototype.isObject3D=!0;let Sd=0;const Cd=new Vc,Pd=new Td,Ed=new gc,kd=new yc,Dd=new yc,zd=new gc;class Od extends Fh{constructor(){super(),Object.defineProperty(this,"id",{value:Sd++}),this.uuid=Gh(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Jh(t)?ad:sd)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Qh).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Cd.makeRotationFromQuaternion(t),this.applyMatrix4(Cd),this}rotateX(t){return Cd.makeRotationX(t),this.applyMatrix4(Cd),this}rotateY(t){return Cd.makeRotationY(t),this.applyMatrix4(Cd),this}rotateZ(t){return Cd.makeRotationZ(t),this.applyMatrix4(Cd),this}translate(t,e,i){return Cd.makeTranslation(t,e,i),this.applyMatrix4(Cd),this}scale(t,e,i){return Cd.makeScale(t,e,i),this.applyMatrix4(Cd),this}lookAt(t){return Pd.lookAt(t),Pd.updateMatrix(),this.applyMatrix4(Pd.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ed).negate(),this.translate(Ed.x,Ed.y,Ed.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new od(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new yc);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new gc(-1/0,-1/0,-1/0),new gc(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];kd.setFromBufferAttribute(i),this.morphTargetsRelative?(zd.addVectors(this.boundingBox.min,kd.min),this.boundingBox.expandByPoint(zd),zd.addVectors(this.boundingBox.max,kd.max),this.boundingBox.expandByPoint(zd)):(this.boundingBox.expandByPoint(kd.min),this.boundingBox.expandByPoint(kd.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Fc);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new gc,1/0);if(t){const i=this.boundingSphere.center;if(kd.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Dd.setFromBufferAttribute(i),this.morphTargetsRelative?(zd.addVectors(kd.min,Dd.min),kd.expandByPoint(zd),zd.addVectors(kd.max,Dd.max),kd.expandByPoint(zd)):(kd.expandByPoint(Dd.min),kd.expandByPoint(Dd.max))}kd.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)zd.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(zd));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)zd.fromBufferAttribute(s,e),a&&(Ed.fromBufferAttribute(t,e),zd.add(Ed)),n=Math.max(n,i.distanceToSquared(zd))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,a=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new rd(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],h=[];for(let t=0;t<a;t++)l[t]=new gc,h[t]=new gc;const c=new gc,d=new gc,u=new gc,f=new Zh,m=new Zh,p=new Zh,g=new gc,_=new gc;function x(t,e,i){c.fromArray(n,3*t),d.fromArray(n,3*e),u.fromArray(n,3*i),f.fromArray(s,2*t),m.fromArray(s,2*e),p.fromArray(s,2*i),d.sub(c),u.sub(c),m.sub(f),p.sub(f);const r=1/(m.x*p.y-p.x*m.y);isFinite(r)&&(g.copy(d).multiplyScalar(p.y).addScaledVector(u,-m.y).multiplyScalar(r),_.copy(u).multiplyScalar(m.x).addScaledVector(d,-p.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),h[t].add(_),h[e].add(_),h[i].add(_))}let y=this.groups;0===y.length&&(y=[{start:0,count:i.length}]);for(let t=0,e=y.length;t<e;++t){const e=y[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)x(i[t+0],i[t+1],i[t+2])}const A=new gc,v=new gc,b=new gc,w=new gc;function M(t){b.fromArray(r,3*t),w.copy(b);const e=l[t];A.copy(e),A.sub(b.multiplyScalar(b.dot(e))).normalize(),v.crossVectors(w,e);const i=v.dot(h[t])<0?-1:1;o[4*t]=A.x,o[4*t+1]=A.y,o[4*t+2]=A.z,o[4*t+3]=i}for(let t=0,e=y.length;t<e;++t){const e=y[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)M(i[t+0]),M(i[t+1]),M(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new rd(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new gc,r=new gc,s=new gc,a=new gc,o=new gc,l=new gc,h=new gc,c=new gc;if(t)for(let d=0,u=t.count;d<u;d+=3){const u=t.getX(d+0),f=t.getX(d+1),m=t.getX(d+2);n.fromBufferAttribute(e,u),r.fromBufferAttribute(e,f),s.fromBufferAttribute(e,m),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),a.fromBufferAttribute(i,u),o.fromBufferAttribute(i,f),l.fromBufferAttribute(i,m),a.add(h),o.add(h),l.add(h),i.setXYZ(u,a.x,a.y,a.z),i.setXYZ(f,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),i.setXYZ(t+0,h.x,h.y,h.z),i.setXYZ(t+1,h.x,h.y,h.z),i.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,s=t.attributes[n],a=s.array,o=s.itemSize*e,l=Math.min(a.length,r.length-o);for(let t=0,e=o;t<l;t++,e++)r[e]=a[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)zd.fromBufferAttribute(t,e),zd.normalize(),t.setXYZ(e,zd.x,zd.y,zd.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[o++]=i[a++]}return new rd(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Od,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],a=r[n];for(let e=0,n=a.length;e<n;e++){const n=t(a[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Od.prototype.isBufferGeometry=!0;class Rd extends Od{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],h=[],c=[];let d=0,u=0;function f(t,e,i,n,r,s,f,m,p,g,_){const x=s/p,y=f/g,A=s/2,v=f/2,b=m/2,w=p+1,M=g+1;let T=0,S=0;const C=new gc;for(let s=0;s<M;s++){const a=s*y-v;for(let o=0;o<w;o++){const d=o*x-A;C[t]=d*n,C[e]=a*r,C[i]=b,l.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[i]=m>0?1:-1,h.push(C.x,C.y,C.z),c.push(o/p),c.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<p;e++){const i=d+e+w*t,n=d+e+w*(t+1),r=d+(e+1)+w*(t+1),s=d+(e+1)+w*t;o.push(i,n,s),o.push(n,r,s),S+=6}a.addGroup(u,S,_),u+=S,d+=T}f("z","y","x",-1,-1,i,e,t,s,r,0),f("z","y","x",1,-1,i,e,-t,s,r,1),f("x","z","y",1,1,t,i,e,n,s,2),f("x","z","y",1,-1,t,i,-e,n,s,3),f("x","y","z",1,-1,t,e,i,n,r,4),f("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new od(l,3)),this.setAttribute("normal",new od(h,3)),this.setAttribute("uv",new od(c,2))}static fromJSON(t){return new Rd(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}class Ld extends Od{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,a=Math.floor(i),o=Math.floor(n),l=a+1,h=o+1,c=t/a,d=e/o,u=[],f=[],m=[],p=[];for(let t=0;t<h;t++){const e=t*d-s;for(let i=0;i<l;i++){const n=i*c-r;f.push(n,-e,0),m.push(0,0,1),p.push(i/a),p.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;u.push(i,n,s),u.push(n,r,s)}this.setIndex(u),this.setAttribute("position",new od(f,3)),this.setAttribute("normal",new od(m,3)),this.setAttribute("uv",new od(p,2))}static fromJSON(t){return new Ld(t.width,t.height,t.widthSegments,t.heightSegments)}}let Bd=0;class Nd extends Fh{constructor(){super(),Object.defineProperty(this,"id",{value:Bd++}),this.uuid=Gh(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=hh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rh,this.stencilZFail=Rh,this.stencilZPass=Rh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}function Fd(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function Id(t){const e={};for(let i=0;i<t.length;i++){const n=Fd(t[i]);for(const t in n)e[t]=n[t]}return e}Nd.prototype.isMaterial=!0,Nd.fromType=function(){return null};const jd={clone:Fd,merge:Id};class qd extends Nd{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Fd(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}qd.prototype.isShaderMaterial=!0;const Ud=new gc,Gd=new gc,Hd=new gc,Xd=new gc,Vd=new gc,Yd=new gc,$d=new gc;class Wd{constructor(t=new gc,e=new gc(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ud)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Ud.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ud.copy(this.direction).multiplyScalar(e).add(this.origin),Ud.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Gd.copy(t).add(e).multiplyScalar(.5),Hd.copy(e).sub(t).normalize(),Xd.copy(this.origin).sub(Gd);const r=.5*t.distanceTo(e),s=-this.direction.dot(Hd),a=Xd.dot(this.direction),o=-Xd.dot(Hd),l=Xd.lengthSq(),h=Math.abs(1-s*s);let c,d,u,f;if(h>0)if(c=s*o-a,d=s*a-o,f=r*h,c>=0)if(d>=-f)if(d<=f){const t=1/h;c*=t,d*=t,u=c*(c+s*d+2*a)+d*(s*c+d+2*o)+l}else d=r,c=Math.max(0,-(s*d+a)),u=-c*c+d*(d+2*o)+l;else d=-r,c=Math.max(0,-(s*d+a)),u=-c*c+d*(d+2*o)+l;else d<=-f?(c=Math.max(0,-(-s*r+a)),d=c>0?-r:Math.min(Math.max(-r,-o),r),u=-c*c+d*(d+2*o)+l):d<=f?(c=0,d=Math.min(Math.max(-r,-o),r),u=d*(d+2*o)+l):(c=Math.max(0,-(s*r+a)),d=c>0?r:Math.min(Math.max(-r,-o),r),u=-c*c+d*(d+2*o)+l);else d=s>0?-r:r,c=Math.max(0,-(s*d+a)),u=-c*c+d*(d+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(Hd).multiplyScalar(d).add(Gd),u}intersectSphere(t,e){Ud.subVectors(t.center,this.origin);const i=Ud.dot(this.direction),n=Ud.dot(Ud)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,a,o;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,d=this.origin;return l>=0?(i=(t.min.x-d.x)*l,n=(t.max.x-d.x)*l):(i=(t.max.x-d.x)*l,n=(t.min.x-d.x)*l),h>=0?(r=(t.min.y-d.y)*h,s=(t.max.y-d.y)*h):(r=(t.max.y-d.y)*h,s=(t.min.y-d.y)*h),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),c>=0?(a=(t.min.z-d.z)*c,o=(t.max.z-d.z)*c):(a=(t.max.z-d.z)*c,o=(t.min.z-d.z)*c),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Ud)}intersectTriangle(t,e,i,n,r){Vd.subVectors(e,t),Yd.subVectors(i,t),$d.crossVectors(Vd,Yd);let s,a=this.direction.dot($d);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Xd.subVectors(this.origin,t);const o=s*this.direction.dot(Yd.crossVectors(Xd,Yd));if(o<0)return null;const l=s*this.direction.dot(Vd.cross(Xd));if(l<0)return null;if(o+l>a)return null;const h=-s*Xd.dot($d);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}const Zd=new gc,Qd=new gc,Jd=new gc,Kd=new gc,tu=new gc,eu=new gc,iu=new gc,nu=new gc,ru=new gc,su=new gc;class au{constructor(t=new gc,e=new gc,i=new gc){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Zd.subVectors(t,e),n.cross(Zd);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){Zd.subVectors(n,e),Qd.subVectors(i,e),Jd.subVectors(t,e);const s=Zd.dot(Zd),a=Zd.dot(Qd),o=Zd.dot(Jd),l=Qd.dot(Qd),h=Qd.dot(Jd),c=s*l-a*a;if(0===c)return r.set(-2,-1,-1);const d=1/c,u=(l*o-a*h)*d,f=(s*h-a*o)*d;return r.set(1-u-f,f,u)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Kd),Kd.x>=0&&Kd.y>=0&&Kd.x+Kd.y<=1}static getUV(t,e,i,n,r,s,a,o){return this.getBarycoord(t,e,i,n,Kd),o.set(0,0),o.addScaledVector(r,Kd.x),o.addScaledVector(s,Kd.y),o.addScaledVector(a,Kd.z),o}static isFrontFacing(t,e,i,n){return Zd.subVectors(i,e),Qd.subVectors(t,e),Zd.cross(Qd).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Zd.subVectors(this.c,this.b),Qd.subVectors(this.a,this.b),.5*Zd.cross(Qd).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return au.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return au.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return au.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return au.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return au.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,a;tu.subVectors(n,i),eu.subVectors(r,i),nu.subVectors(t,i);const o=tu.dot(nu),l=eu.dot(nu);if(o<=0&&l<=0)return e.copy(i);ru.subVectors(t,n);const h=tu.dot(ru),c=eu.dot(ru);if(h>=0&&c<=h)return e.copy(n);const d=o*c-h*l;if(d<=0&&o>=0&&h<=0)return s=o/(o-h),e.copy(i).addScaledVector(tu,s);su.subVectors(t,r);const u=tu.dot(su),f=eu.dot(su);if(f>=0&&u<=f)return e.copy(r);const m=u*l-o*f;if(m<=0&&l>=0&&f<=0)return a=l/(l-f),e.copy(i).addScaledVector(eu,a);const p=h*f-u*c;if(p<=0&&c-h>=0&&u-f>=0)return iu.subVectors(r,n),a=(c-h)/(c-h+(u-f)),e.copy(n).addScaledVector(iu,a);const g=1/(p+m+d);return s=m*g,a=d*g,e.copy(i).addScaledVector(tu,s).addScaledVector(eu,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}class ou extends Nd{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new ac(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}ou.prototype.isMeshBasicMaterial=!0;const lu=new Vc,hu=new Wd,cu=new Fc,du=new gc,uu=new gc,fu=new gc,mu=new gc,pu=new gc,gu=new gc,_u=new gc,xu=new gc,yu=new gc,Au=new Zh,vu=new Zh,bu=new Zh,wu=new gc,Mu=new gc;class Tu extends Td{constructor(t=new Od,e=new ou){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),cu.copy(i.boundingSphere),cu.applyMatrix4(r),!1===t.ray.intersectsSphere(cu))return;if(lu.copy(r).invert(),hu.copy(t.ray).applyMatrix4(lu),null!==i.boundingBox&&!1===hu.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position,o=i.morphAttributes.position,l=i.morphTargetsRelative,h=i.attributes.uv,c=i.attributes.uv2,d=i.groups,u=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,f=d.length;i<f;i++){const f=d[i],m=n[f.materialIndex];for(let i=Math.max(f.start,u.start),n=Math.min(r.count,Math.min(f.start+f.count,u.start+u.count));i<n;i+=3){const n=r.getX(i),d=r.getX(i+1),u=r.getX(i+2);s=Su(this,m,t,hu,a,o,l,h,c,n,d,u),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=f.materialIndex,e.push(s))}}else{for(let i=Math.max(0,u.start),d=Math.min(r.count,u.start+u.count);i<d;i+=3){const d=r.getX(i),u=r.getX(i+1),f=r.getX(i+2);s=Su(this,n,t,hu,a,o,l,h,c,d,u,f),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}else if(void 0!==a)if(Array.isArray(n))for(let i=0,r=d.length;i<r;i++){const r=d[i],f=n[r.materialIndex];for(let i=Math.max(r.start,u.start),n=Math.min(a.count,Math.min(r.start+r.count,u.start+u.count));i<n;i+=3){s=Su(this,f,t,hu,a,o,l,h,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,u.start),r=Math.min(a.count,u.start+u.count);i<r;i+=3){s=Su(this,n,t,hu,a,o,l,h,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Su(t,e,i,n,r,s,a,o,l,h,c,d){du.fromBufferAttribute(r,h),uu.fromBufferAttribute(r,c),fu.fromBufferAttribute(r,d);const u=t.morphTargetInfluences;if(s&&u){_u.set(0,0,0),xu.set(0,0,0),yu.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=u[t],i=s[t];0!==e&&(mu.fromBufferAttribute(i,h),pu.fromBufferAttribute(i,c),gu.fromBufferAttribute(i,d),a?(_u.addScaledVector(mu,e),xu.addScaledVector(pu,e),yu.addScaledVector(gu,e)):(_u.addScaledVector(mu.sub(du),e),xu.addScaledVector(pu.sub(uu),e),yu.addScaledVector(gu.sub(fu),e)))}du.add(_u),uu.add(xu),fu.add(yu)}t.isSkinnedMesh&&(t.boneTransform(h,du),t.boneTransform(c,uu),t.boneTransform(d,fu));const f=function(t,e,i,n,r,s,a,o){let l;if(l=1===e.side?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,2!==e.side,o),null===l)return null;Mu.copy(o),Mu.applyMatrix4(t.matrixWorld);const h=i.ray.origin.distanceTo(Mu);return h<i.near||h>i.far?null:{distance:h,point:Mu.clone(),object:t}}(t,e,i,n,du,uu,fu,wu);if(f){o&&(Au.fromBufferAttribute(o,h),vu.fromBufferAttribute(o,c),bu.fromBufferAttribute(o,d),f.uv=au.getUV(wu,du,uu,fu,Au,vu,bu,new Zh)),l&&(Au.fromBufferAttribute(l,h),vu.fromBufferAttribute(l,c),bu.fromBufferAttribute(l,d),f.uv2=au.getUV(wu,du,uu,fu,Au,vu,bu,new Zh));const t={a:h,b:c,c:d,normal:new gc,materialIndex:0};au.getNormal(du,uu,fu,t.normal),f.face=t}return f}Tu.prototype.isMesh=!0;const Cu={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tfloat texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Pu={common:{diffuse:{value:new ac(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Qh},uv2Transform:{value:new Qh},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Zh(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ac(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ac(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Qh}},sprite:{diffuse:{value:new ac(16777215)},opacity:{value:1},center:{value:new Zh(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Qh}}},Eu={basic:{uniforms:Id([Pu.common,Pu.specularmap,Pu.envmap,Pu.aomap,Pu.lightmap,Pu.fog]),vertexShader:Cu.meshbasic_vert,fragmentShader:Cu.meshbasic_frag},lambert:{uniforms:Id([Pu.common,Pu.specularmap,Pu.envmap,Pu.aomap,Pu.lightmap,Pu.emissivemap,Pu.fog,Pu.lights,{emissive:{value:new ac(0)}}]),vertexShader:Cu.meshlambert_vert,fragmentShader:Cu.meshlambert_frag},phong:{uniforms:Id([Pu.common,Pu.specularmap,Pu.envmap,Pu.aomap,Pu.lightmap,Pu.emissivemap,Pu.bumpmap,Pu.normalmap,Pu.displacementmap,Pu.fog,Pu.lights,{emissive:{value:new ac(0)},specular:{value:new ac(1118481)},shininess:{value:30}}]),vertexShader:Cu.meshphong_vert,fragmentShader:Cu.meshphong_frag},standard:{uniforms:Id([Pu.common,Pu.envmap,Pu.aomap,Pu.lightmap,Pu.emissivemap,Pu.bumpmap,Pu.normalmap,Pu.displacementmap,Pu.roughnessmap,Pu.metalnessmap,Pu.fog,Pu.lights,{emissive:{value:new ac(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Cu.meshphysical_vert,fragmentShader:Cu.meshphysical_frag},toon:{uniforms:Id([Pu.common,Pu.aomap,Pu.lightmap,Pu.emissivemap,Pu.bumpmap,Pu.normalmap,Pu.displacementmap,Pu.gradientmap,Pu.fog,Pu.lights,{emissive:{value:new ac(0)}}]),vertexShader:Cu.meshtoon_vert,fragmentShader:Cu.meshtoon_frag},matcap:{uniforms:Id([Pu.common,Pu.bumpmap,Pu.normalmap,Pu.displacementmap,Pu.fog,{matcap:{value:null}}]),vertexShader:Cu.meshmatcap_vert,fragmentShader:Cu.meshmatcap_frag},points:{uniforms:Id([Pu.points,Pu.fog]),vertexShader:Cu.points_vert,fragmentShader:Cu.points_frag},dashed:{uniforms:Id([Pu.common,Pu.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Cu.linedashed_vert,fragmentShader:Cu.linedashed_frag},depth:{uniforms:Id([Pu.common,Pu.displacementmap]),vertexShader:Cu.depth_vert,fragmentShader:Cu.depth_frag},normal:{uniforms:Id([Pu.common,Pu.bumpmap,Pu.normalmap,Pu.displacementmap,{opacity:{value:1}}]),vertexShader:Cu.meshnormal_vert,fragmentShader:Cu.meshnormal_frag},sprite:{uniforms:Id([Pu.sprite,Pu.fog]),vertexShader:Cu.sprite_vert,fragmentShader:Cu.sprite_frag},background:{uniforms:{uvTransform:{value:new Qh},t2D:{value:null}},vertexShader:Cu.background_vert,fragmentShader:Cu.background_frag},cube:{uniforms:Id([Pu.envmap,{opacity:{value:1}}]),vertexShader:Cu.cube_vert,fragmentShader:Cu.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Cu.equirect_vert,fragmentShader:Cu.equirect_frag},distanceRGBA:{uniforms:Id([Pu.common,Pu.displacementmap,{referencePosition:{value:new gc},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Cu.distanceRGBA_vert,fragmentShader:Cu.distanceRGBA_frag},shadow:{uniforms:Id([Pu.lights,Pu.fog,{color:{value:new ac(0)},opacity:{value:1}}]),vertexShader:Cu.shadow_vert,fragmentShader:Cu.shadow_frag}};function ku(t,e,i,n,r,s){const a=new ac(0);let o,l,h=!0===r?0:1,c=null,d=0,u=null;function f(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),h=e,f(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,f(a,h)},render:function(i,r){let s=!1,m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=e.get(m));const p=t.xr,g=p.getSession&&p.getSession();g&&"additive"===g.environmentBlendMode&&(m=null),null===m?f(a,h):m&&m.isColor&&(f(m,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===uh)?(void 0===l&&(l=new Tu(new Rd(1,1,1),new qd({name:"BackgroundCubeMaterial",uniforms:Fd(Eu.cube.uniforms),vertexShader:Eu.cube.vertexShader,fragmentShader:Eu.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,c===m&&d===m.version&&u===t.toneMapping||(l.material.needsUpdate=!0,c=m,d=m.version,u=t.toneMapping),i.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new Tu(new Ld(2,2),new qd({name:"BackgroundMaterial",uniforms:Fd(Eu.background.uniforms),vertexShader:Eu.background.vertexShader,fragmentShader:Eu.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),c===m&&d===m.version&&u===t.toneMapping||(o.material.needsUpdate=!0,c=m,d=m.version,u=t.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function Du(t,e,i,n){const r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=u(null);let h=l;function c(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function u(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function f(){const t=h.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){p(t,0)}function p(i,r){const s=h.newAttributes,a=h.enabledAttributes,o=h.attributeDivisors;if(s[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r}}function g(){const e=h.newAttributes,i=h.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function _(e,i,r,s,a,o){!0!==n.isWebGL2||r!==t.INT&&r!==t.UNSIGNED_INT?t.vertexAttribPointer(e,i,r,s,a,o):t.vertexAttribIPointer(e,i,r,a,o)}function x(){y(),h!==l&&(h=l,c(h.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,x,y){let A=!1;if(a){const e=function(e,i,r){const a=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let h=l[i.id];void 0===h&&(h={},l[i.id]=h);let c=h[a];void 0===c&&(c=u(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),h[a]=c);return c}(x,d,l);h!==e&&(h=e,c(h.object)),A=function(t,e){const i=h.attributes,n=t.attributes;let r=0;for(const t in n){const e=i[t],s=n[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;r++}return h.attributesNum!==r||h.index!==e}(x,y),A&&function(t,e){const i={},n=t.attributes;let r=0;for(const t in n){const e=n[t],s={};s.attribute=e,e.data&&(s.data=e.data),i[t]=s,r++}h.attributes=i,h.attributesNum=r,h.index=e}(x,y)}else{const t=!0===l.wireframe;h.geometry===x.id&&h.program===d.id&&h.wireframe===t||(h.geometry=x.id,h.program=d.id,h.wireframe=t,A=!0)}!0===r.isInstancedMesh&&(A=!0),null!==y&&i.update(y,t.ELEMENT_ARRAY_BUFFER),A&&(!function(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=o.attributes,h=a.getAttributes(),c=s.defaultAttributeValues;for(const e in h){const n=h[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,a=s.itemSize,l=i.get(s);if(void 0===l)continue;const h=l.buffer,c=l.type,d=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,u=s.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)p(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<n.locationSize;t++)_(n.location+t,a/n.locationSize,c,e,l*d,(u+a/n.locationSize*t)*d)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)p(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<n.locationSize;t++)_(n.location+t,a/n.locationSize,c,e,a*d,a/n.locationSize*t*d)}}else if(void 0!==c){const i=c[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}g()}(r,l,d,x),null!==y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(y).buffer))},reset:x,resetDefaultState:y,dispose:function(){x();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)d(n[t].object),delete n[t];delete i[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:g}}function zu(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,h;if(r)l=t,h="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](s,n,a,o),i.update(a,s,o)}}function Ou(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||e.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_TEXTURE_SIZE),f=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),m=t.getParameter(t.MAX_VERTEX_ATTRIBS),p=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),_=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),x=d>0,y=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:d,maxTextureSize:u,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:p,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:x,floatFragmentTextures:y,floatVertexTextures:x&&y,maxSamples:s?t.getParameter(t.MAX_SAMPLES):0}}function Ru(t){const e=this;let i=null,n=0,r=!1,s=!1;const a=new Uc,o=new Qh,l={value:null,needsUpdate:!1};function h(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,i,n,r){const s=null!==t?t.length:0;let h=null;if(0!==s){if(h=l.value,!0!==r||null===h){const e=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===h||h.length<e)&&(h=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(h,i),h[i+3]=a.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const a=0!==t.length||e||0!==n||r;return r=e,i=c(t,s,0),n=t.length,a},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,h()},this.setState=function(e,a,o){const d=e.clippingPlanes,u=e.clipIntersection,f=e.clipShadows,m=t.get(e);if(!r||null===d||0===d.length||s&&!f)s?c(null):h();else{const t=s?0:n,e=4*t;let r=m.clippingState||null;l.value=r,r=c(d,a,e,o);for(let t=0;t!==e;++t)r[t]=i[t];m.clippingState=r,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=t}}}Eu.physical={uniforms:Id([Eu.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Zh(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new ac(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Zh},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ac(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ac(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Cu.meshphysical_vert,fragmentShader:Cu.meshphysical_frag};class Lu extends Td{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Vc,this.projectionMatrix=new Vc,this.projectionMatrixInverse=new Vc}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Lu.prototype.isCamera=!0;class Bu extends Lu{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Uh*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*qh*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Uh*Math.atan(Math.tan(.5*qh*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*qh*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/a,n*=s.width/t,i*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Bu.prototype.isPerspectiveCamera=!0;const Nu=90;class Fu extends Td{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new Bu(Nu,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new gc(1,0,0)),this.add(n);const r=new Bu(Nu,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new gc(-1,0,0)),this.add(r);const s=new Bu(Nu,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new gc(0,1,0)),this.add(s);const a=new Bu(Nu,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new gc(0,-1,0)),this.add(a);const o=new Bu(Nu,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new gc(0,0,1)),this.add(o);const l=new Bu(Nu,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new gc(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,a,o,l]=this.children,h=t.xr.enabled,c=t.getRenderTarget();t.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.xr.enabled=h,i.texture.needsPMREMUpdate=!0}}class Iu extends uc{constructor(t,e,i,n,r,s,a,o,l,h){super(t=void 0!==t?t:[],e=void 0!==e?e:ch,i,n,r,s,a,o,l,h),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Iu.prototype.isCubeTexture=!0;class ju extends mc{constructor(t,e={}){super(t,t,e);const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new Iu(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:_h}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=Th,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Rd(5,5,5),r=new qd({name:"CubemapFromEquirect",uniforms:Fd(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const s=new Tu(n,r),a=e.minFilter;e.minFilter===xh&&(e.minFilter=_h);return new Fu(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}function qu(t){let e=new WeakMap;function i(t,e){return 303===e?t.mapping=ch:304===e&&(t.mapping=dh),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(303===s||304===s){if(e.has(r)){return i(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new ju(s.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}ju.prototype.isWebGLCubeRenderTarget=!0;class Uu extends Lu{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,a=n+e,o=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Uu.prototype.isOrthographicCamera=!0;const Gu=[.125,.215,.35,.446,.526,.582],Hu=20,Xu=new Uu,Vu=new ac;let Yu=null;const $u=(1+Math.sqrt(5))/2,Wu=1/$u,Zu=[new gc(1,1,1),new gc(-1,1,1),new gc(1,1,-1),new gc(-1,1,-1),new gc(0,$u,Wu),new gc(0,$u,-Wu),new gc(Wu,0,$u),new gc(-Wu,0,$u),new gc($u,Wu,0),new gc(-$u,Wu,0)];class Qu{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Yu=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=ef(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=tf(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Yu),t.scissorTest=!1,Ku(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===ch||t.mapping===dh?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Yu=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize-32,i={magFilter:_h,minFilter:_h,generateMipmaps:!1,type:wh,format:Th,encoding:zh,depthBuffer:!1},n=Ju(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ju(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let r=t;const s=t-4+1+Gu.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);i.push(s);let o=1/s;a>t-4?o=Gu[a-t+4-1]:0===a&&(o=0),n.push(o);const l=1/(s-1),h=-l/2,c=1+l/2,d=[h,h,c,h,c,c,h,h,c,c,h,c],u=6,f=6,m=3,p=2,g=1,_=new Float32Array(m*f*u),x=new Float32Array(p*f*u),y=new Float32Array(g*f*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];_.set(n,m*f*t),x.set(d,p*f*t);const r=[t,t,t,t,t,t];y.set(r,g*f*t)}const A=new Od;A.setAttribute("position",new rd(_,m)),A.setAttribute("uv",new rd(x,p)),A.setAttribute("faceIndex",new rd(y,g)),e.push(A),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(Hu),r=new gc(0,1,0);return new qd({name:"SphericalGaussianBlur",defines:{n:Hu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:nf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new Tu(this._lodPlanes[0],t);this._renderer.compile(e,Xu)}_sceneToCubeUV(t,e,i,n){const r=new Bu(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.toneMapping;o.getClearColor(Vu),o.toneMapping=0,o.autoClear=!1;const c=new ou({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Tu(new Rd,c);let u=!1;const f=t.background;f?f.isColor&&(c.color.copy(f),t.background=null,u=!0):(c.color.copy(Vu),u=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(r.up.set(0,s[e],0),r.lookAt(a[e],0,0)):1===i?(r.up.set(0,0,s[e]),r.lookAt(0,a[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,a[e]));const l=this._cubeSize;Ku(n,i*l,e>2?l:0,l,l),o.setRenderTarget(n),u&&o.render(d,r),o.render(t,r)}d.geometry.dispose(),d.material.dispose(),o.toneMapping=h,o.autoClear=l,t.background=f}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===ch||t.mapping===dh;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=ef()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=tf());const r=n?this._cubemapMaterial:this._equirectMaterial,s=new Tu(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const a=this._cubeSize;Ku(e,0,0,3*a,2*a),i.setRenderTarget(e),i.render(s,Xu)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=Zu[(e-1)%Zu.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new Tu(this._lodPlanes[n],l),c=l.uniforms,d=this._sizeLods[i]-1,u=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,f=r/u,m=isFinite(r)?1+Math.floor(3*f):Hu;m>Hu&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const p=[];let g=0;for(let t=0;t<Hu;++t){const e=t/f,i=Math.exp(-e*e/2);p.push(i),0===t?g+=i:t<m&&(g+=2*i)}for(let t=0;t<p.length;t++)p[t]=p[t]/g;c.envMap.value=t.texture,c.samples.value=m,c.weights.value=p,c.latitudinal.value="latitudinal"===s,a&&(c.poleAxis.value=a);const{_lodMax:_}=this;c.dTheta.value=u,c.mipInt.value=_-i;const x=this._sizeLods[n];Ku(e,3*x*(n>_-4?n-_+4:0),4*(this._cubeSize-x),3*x,2*x),o.setRenderTarget(e),o.render(h,Xu)}}function Ju(t,e,i){const n=new mc(t,e,i);return n.texture.mapping=uh,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Ku(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function tf(){return new qd({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:nf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function ef(){return new qd({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:nf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function nf(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function rf(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=303===s||304===s,o=s===ch||s===dh;if(a||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=e.get(r);return null===i&&(i=new Qu(t)),n=a?i.fromEquirectangular(r,n):i.fromCubemap(r,n),e.set(r,n),n.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(a&&s&&s.height>0||o&&s&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(s)){null===i&&(i=new Qu(t));const s=a?i.fromEquirectangular(r):i.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function sf(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function af(t,e,i,n){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){const i=[],n=t.index,r=t.attributes.position;let a=0;if(null!==n){const t=n.array;a=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;a=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const o=new(Jh(i)?ad:sd)(i,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,i.memory.geometries++),e},update:function(i){const n=i.attributes;for(const i in n)e.update(n[i],t.ARRAY_BUFFER);const r=i.morphAttributes;for(const i in r){const n=r[i];for(let i=0,r=n.length;i<r;i++)e.update(n[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return s.get(t)}}}function of(t,e,i,n){const r=n.isWebGL2;let s,a,o;this.setMode=function(t){s=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(s,n,a,e*o),i.update(n,s,1)},this.renderInstances=function(n,l,h){if(0===h)return;let c,d;if(r)c=t,d="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[d](s,l,a,n*o,h),i.update(l,s,h)}}function lf(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,n,r){switch(e.calls++,n){case t.TRIANGLES:e.triangles+=r*(i/3);break;case t.LINES:e.lines+=r*(i/2);break;case t.LINE_STRIP:e.lines+=r*(i-1);break;case t.LINE_LOOP:e.lines+=r*i;break;case t.POINTS:e.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}class hf extends uc{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=gh,this.minFilter=gh,this.wrapR=mh,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}function cf(t,e){return t[0]-e[0]}function df(t,e){return Math.abs(e[1])-Math.abs(t[1])}function uf(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function ff(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,a=new fc,o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function(l,h,c,d){const u=l.morphTargetInfluences;if(!0===e.isWebGL2){const f=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=void 0!==f?f.length:0;let p=s.get(h);if(void 0===p||p.count!==m){void 0!==p&&p.texture.dispose();const x=void 0!==h.morphAttributes.position,y=void 0!==h.morphAttributes.normal,A=void 0!==h.morphAttributes.color,v=h.morphAttributes.position||[],b=h.morphAttributes.normal||[],w=h.morphAttributes.color||[];let M=0;!0===x&&(M=1),!0===y&&(M=2),!0===A&&(M=3);let T=h.attributes.position.count*M,S=1;T>e.maxTextureSize&&(S=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const C=new Float32Array(T*S*4*m),P=new hf(C,T,S,m);P.format=Th,P.type=bh,P.needsUpdate=!0;const E=4*M;for(let D=0;D<m;D++){const z=v[D],O=b[D],R=w[D],L=T*S*4*D;for(let B=0;B<z.count;B++){const N=B*E;!0===x&&(a.fromBufferAttribute(z,B),!0===z.normalized&&uf(a,z),C[L+N+0]=a.x,C[L+N+1]=a.y,C[L+N+2]=a.z,C[L+N+3]=0),!0===y&&(a.fromBufferAttribute(O,B),!0===O.normalized&&uf(a,O),C[L+N+4]=a.x,C[L+N+5]=a.y,C[L+N+6]=a.z,C[L+N+7]=0),!0===A&&(a.fromBufferAttribute(R,B),!0===R.normalized&&uf(a,O),C[L+N+8]=a.x,C[L+N+9]=a.y,C[L+N+10]=a.z,C[L+N+11]=4===R.itemSize?a.w:1)}}function k(){P.dispose(),s.delete(h),h.removeEventListener("dispose",k)}p={count:m,texture:P,size:new Zh(T,S)},s.set(h,p),h.addEventListener("dispose",k)}let g=0;for(let F=0;F<u.length;F++)g+=u[F];const _=h.morphTargetsRelative?1:1-g;d.getUniforms().setValue(t,"morphTargetBaseInfluence",_),d.getUniforms().setValue(t,"morphTargetInfluences",u),d.getUniforms().setValue(t,"morphTargetsTexture",p.texture,i),d.getUniforms().setValue(t,"morphTargetsTextureSize",p.size)}else{const I=void 0===u?0:u.length;let j=n[h.id];if(void 0===j||j.length!==I){j=[];for(let X=0;X<I;X++)j[X]=[X,0];n[h.id]=j}for(let V=0;V<I;V++){const Y=j[V];Y[0]=V,Y[1]=u[V]}j.sort(df);for(let $=0;$<8;$++)$<I&&j[$][1]?(o[$][0]=j[$][0],o[$][1]=j[$][1]):(o[$][0]=Number.MAX_SAFE_INTEGER,o[$][1]=0);o.sort(cf);const q=h.morphAttributes.position,U=h.morphAttributes.normal;let G=0;for(let W=0;W<8;W++){const Z=o[W],Q=Z[0],J=Z[1];Q!==Number.MAX_SAFE_INTEGER&&J?(q&&h.getAttribute("morphTarget"+W)!==q[Q]&&h.setAttribute("morphTarget"+W,q[Q]),U&&h.getAttribute("morphNormal"+W)!==U[Q]&&h.setAttribute("morphNormal"+W,U[Q]),r[W]=J,G+=J):(q&&!0===h.hasAttribute("morphTarget"+W)&&h.deleteAttribute("morphTarget"+W),U&&!0===h.hasAttribute("morphNormal"+W)&&h.deleteAttribute("morphNormal"+W),r[W]=0)}const H=h.morphTargetsRelative?1:1-G;d.getUniforms().setValue(t,"morphTargetBaseInfluence",H),d.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function mf(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(a){const o=n.render.frame,l=a.geometry,h=e.get(a,l);return r.get(h)!==o&&(e.update(h),r.set(h,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),i.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&i.update(a.instanceColor,t.ARRAY_BUFFER)),h},dispose:function(){r=new WeakMap}}}hf.prototype.isDataArrayTexture=!0;class pf extends uc{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=gh,this.minFilter=gh,this.wrapR=mh,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}pf.prototype.isData3DTexture=!0;const gf=new uc,_f=new hf,xf=new pf,yf=new Iu,Af=[],vf=[],bf=new Float32Array(16),wf=new Float32Array(9),Mf=new Float32Array(4);function Tf(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=Af[r];if(void 0===s&&(s=new Float32Array(r),Af[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function Sf(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Cf(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function Pf(t,e){let i=vf[e];void 0===i&&(i=new Int32Array(e),vf[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function Ef(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function kf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Sf(i,e))return;t.uniform2fv(this.addr,e),Cf(i,e)}}function Df(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Sf(i,e))return;t.uniform3fv(this.addr,e),Cf(i,e)}}function zf(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Sf(i,e))return;t.uniform4fv(this.addr,e),Cf(i,e)}}function Of(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Sf(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Cf(i,e)}else{if(Sf(i,n))return;Mf.set(n),t.uniformMatrix2fv(this.addr,!1,Mf),Cf(i,n)}}function Rf(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Sf(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Cf(i,e)}else{if(Sf(i,n))return;wf.set(n),t.uniformMatrix3fv(this.addr,!1,wf),Cf(i,n)}}function Lf(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Sf(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Cf(i,e)}else{if(Sf(i,n))return;bf.set(n),t.uniformMatrix4fv(this.addr,!1,bf),Cf(i,n)}}function Bf(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Nf(t,e){const i=this.cache;Sf(i,e)||(t.uniform2iv(this.addr,e),Cf(i,e))}function Ff(t,e){const i=this.cache;Sf(i,e)||(t.uniform3iv(this.addr,e),Cf(i,e))}function If(t,e){const i=this.cache;Sf(i,e)||(t.uniform4iv(this.addr,e),Cf(i,e))}function jf(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function qf(t,e){const i=this.cache;Sf(i,e)||(t.uniform2uiv(this.addr,e),Cf(i,e))}function Uf(t,e){const i=this.cache;Sf(i,e)||(t.uniform3uiv(this.addr,e),Cf(i,e))}function Gf(t,e){const i=this.cache;Sf(i,e)||(t.uniform4uiv(this.addr,e),Cf(i,e))}function Hf(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||gf,r)}function Xf(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||xf,r)}function Vf(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||yf,r)}function Yf(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||_f,r)}function $f(t,e){t.uniform1fv(this.addr,e)}function Wf(t,e){const i=Tf(e,this.size,2);t.uniform2fv(this.addr,i)}function Zf(t,e){const i=Tf(e,this.size,3);t.uniform3fv(this.addr,i)}function Qf(t,e){const i=Tf(e,this.size,4);t.uniform4fv(this.addr,i)}function Jf(t,e){const i=Tf(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Kf(t,e){const i=Tf(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function tm(t,e){const i=Tf(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function em(t,e){t.uniform1iv(this.addr,e)}function im(t,e){t.uniform2iv(this.addr,e)}function nm(t,e){t.uniform3iv(this.addr,e)}function rm(t,e){t.uniform4iv(this.addr,e)}function sm(t,e){t.uniform1uiv(this.addr,e)}function am(t,e){t.uniform2uiv(this.addr,e)}function om(t,e){t.uniform3uiv(this.addr,e)}function lm(t,e){t.uniform4uiv(this.addr,e)}function hm(t,e,i){const n=e.length,r=Pf(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2D(e[t]||gf,r[t])}function cm(t,e,i){const n=e.length,r=Pf(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture3D(e[t]||xf,r[t])}function dm(t,e,i){const n=e.length,r=Pf(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTextureCube(e[t]||yf,r[t])}function um(t,e,i){const n=e.length,r=Pf(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||_f,r[t])}function fm(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Ef;case 35664:return kf;case 35665:return Df;case 35666:return zf;case 35674:return Of;case 35675:return Rf;case 35676:return Lf;case 5124:case 35670:return Bf;case 35667:case 35671:return Nf;case 35668:case 35672:return Ff;case 35669:case 35673:return If;case 5125:return jf;case 36294:return qf;case 36295:return Uf;case 36296:return Gf;case 35678:case 36198:case 36298:case 36306:case 35682:return Hf;case 35679:case 36299:case 36307:return Xf;case 35680:case 36300:case 36308:case 36293:return Vf;case 36289:case 36303:case 36311:case 36292:return Yf}}(e.type)}function mm(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return $f;case 35664:return Wf;case 35665:return Zf;case 35666:return Qf;case 35674:return Jf;case 35675:return Kf;case 35676:return tm;case 5124:case 35670:return em;case 35667:case 35671:return im;case 35668:case 35672:return nm;case 35669:case 35673:return rm;case 5125:return sm;case 36294:return am;case 36295:return om;case 36296:return lm;case 35678:case 36198:case 36298:case 36306:case 35682:return hm;case 35679:case 36299:case 36307:return cm;case 35680:case 36300:case 36308:case 36293:return dm;case 36289:case 36303:case 36311:case 36292:return um}}(e.type)}function pm(t){this.id=t,this.seq=[],this.map={}}mm.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Cf(e,t)},pm.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}};const gm=/(\w+)(\])?(\[|\.)?/g;function _m(t,e){t.seq.push(e),t.map[e.id]=e}function xm(t,e,i){const n=t.name,r=n.length;for(gm.lastIndex=0;;){const s=gm.exec(n),a=gm.lastIndex;let o=s[1];const l="]"===s[2],h=s[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===r){_m(i,void 0===h?new fm(o,t,e):new mm(o,t,e));break}{let t=i.map[o];void 0===t&&(t=new pm(o),_m(i,t)),i=t}}}function ym(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);xm(i,t.getUniformLocation(e,i.name),this)}}function Am(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}ym.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},ym.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},ym.upload=function(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}},ym.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let vm=0;function bm(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();return n&&""===r?"":i.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function wm(t,e){const i=function(t){switch(t){case zh:return["Linear","( value )"];case Oh:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Mm(t,e){let i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Tm(t){return""!==t}function Sm(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Cm(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Pm=/^[ \t]*#include +<([\w\d./]+)>/gm;function Em(t){return t.replace(Pm,km)}function km(t,e){const i=Cu[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return Em(i)}const Dm=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,zm=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Om(t){return t.replace(zm,Lm).replace(Dm,Rm)}function Rm(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Lm(t,e,i,n)}function Lm(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Bm(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Nm(t,e,i,n){const r=t.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),h=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case ch:case dh:e="ENVMAP_TYPE_CUBE";break;case uh:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),c=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case dh:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(i),d=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),u=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e/32+1)+3,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),f=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Tm).join("\n")}(i),m=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(s),p=r.createProgram();let g,_,x=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=[m].filter(Tm).join("\n"),g.length>0&&(g+="\n"),_=[f,m].filter(Tm).join("\n"),_.length>0&&(_+="\n")):(g=[Bm(i),"#define SHADER_NAME "+i.shaderName,m,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Tm).join("\n"),_=[f,Bm(i),"#define SHADER_NAME "+i.shaderName,m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+c:"",i.envMap?"#define "+d:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Cu.tonemapping_pars_fragment:"",0!==i.toneMapping?Mm("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Cu.encodings_pars_fragment,wm("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Tm).join("\n")),a=Em(a),a=Sm(a,i),a=Cm(a,i),o=Em(o),o=Sm(o,i),o=Cm(o,i),a=Om(a),o=Om(o),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(x="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["#define varying in",i.glslVersion===Bh?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Bh?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const y=x+g+a,A=x+_+o,v=Am(r,r.VERTEX_SHADER,y),b=Am(r,r.FRAGMENT_SHADER,A);if(r.attachShader(p,v),r.attachShader(p,b),void 0!==i.index0AttributeName?r.bindAttribLocation(p,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(p,0,"position"),r.linkProgram(p),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(p).trim(),e=r.getShaderInfoLog(v).trim(),i=r.getShaderInfoLog(b).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(p,r.LINK_STATUS)){n=!1;const e=bm(r,v,"vertex"),i=bm(r,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(p,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:g},fragmentShader:{log:i,prefix:_}})}let w,M;return r.deleteShader(v),r.deleteShader(b),this.getUniforms=function(){return void 0===w&&(w=new ym(r,p)),w},this.getAttributes=function(){return void 0===M&&(M=function(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let a=1;n.type===t.FLOAT_MAT2&&(a=2),n.type===t.FLOAT_MAT3&&(a=3),n.type===t.FLOAT_MAT4&&(a=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:a}}return i}(r,p)),M},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(p),this.program=void 0},this.name=i.shaderName,this.id=vm++,this.cacheKey=e,this.usedTimes=1,this.program=p,this.vertexShader=v,this.fragmentShader=b,this}let Fm=0;class Im{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const i=new jm;e.set(t,i)}return e.get(t)}}class jm{constructor(){this.id=Fm++,this.usedTimes=0}}function qm(t,e,i,n,r,s,a){const o=new dd,l=new Im,h=[],c=r.isWebGL2,d=r.logarithmicDepthBuffer,u=r.floatVertexTextures,f=r.maxVertexUniforms,m=r.vertexTextures;let p=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,o,h,_,x){const y=_.fog,A=x.geometry,v=s.isMeshStandardMaterial?_.environment:null,b=(s.isMeshStandardMaterial?i:e).get(s.envMap||v),w=!b||b.mapping!==uh&&307!==b.mapping?null:b.image.height,M=g[s.type],T=x.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(u)return 1024;{const t=f,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(x):0;null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const S=A.morphAttributes.position||A.morphAttributes.normal||A.morphAttributes.color,C=void 0!==S?S.length:0;let P,E,k,D,z=0;if(void 0!==A.morphAttributes.position&&(z=1),void 0!==A.morphAttributes.normal&&(z=2),void 0!==A.morphAttributes.color&&(z=3),M){const t=Eu[M];P=t.vertexShader,E=t.fragmentShader}else P=s.vertexShader,E=s.fragmentShader,l.update(s),k=l.getVertexShaderID(s),D=l.getFragmentShaderID(s);const O=t.getRenderTarget(),R=s.alphaTest>0,L=s.clearcoat>0;return{isWebGL2:c,shaderID:M,shaderName:s.type,vertexShader:P,fragmentShader:E,defines:s.defines,customVertexShaderID:k,customFragmentShaderID:D,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:m,outputEncoding:null===O?t.outputEncoding:!0===O.isXRRenderTarget?O.texture.encoding:zh,map:!!s.map,matcap:!!s.matcap,envMap:!!b,envMapMode:b&&b.mapping,envMapCubeUVHeight:w,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===Oh,clearcoat:L,clearcoatMap:L&&!!s.clearcoatMap,clearcoatRoughnessMap:L&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:L&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:R,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!A.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!A.attributes.color&&4===A.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!y,useFog:s.fog,fogExp2:y&&y.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===x.isSkinnedMesh&&T>0,maxBones:T,useVertexTexture:u,morphTargets:void 0!==A.morphAttributes.position,morphNormals:void 0!==A.morphAttributes.normal,morphColors:void 0!==A.morphAttributes.color,morphTargetsCount:C,morphTextureStride:z,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.maxBones),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection)}(i,e),function(t,e){o.disableAll(),e.isWebGL2&&o.enable(0);e.supportsVertexTextures&&o.enable(1);e.instancing&&o.enable(2);e.instancingColor&&o.enable(3);e.map&&o.enable(4);e.matcap&&o.enable(5);e.envMap&&o.enable(6);e.lightMap&&o.enable(7);e.aoMap&&o.enable(8);e.emissiveMap&&o.enable(9);e.bumpMap&&o.enable(10);e.normalMap&&o.enable(11);e.objectSpaceNormalMap&&o.enable(12);e.tangentSpaceNormalMap&&o.enable(13);e.clearcoat&&o.enable(14);e.clearcoatMap&&o.enable(15);e.clearcoatRoughnessMap&&o.enable(16);e.clearcoatNormalMap&&o.enable(17);e.displacementMap&&o.enable(18);e.specularMap&&o.enable(19);e.roughnessMap&&o.enable(20);e.metalnessMap&&o.enable(21);e.gradientMap&&o.enable(22);e.alphaMap&&o.enable(23);e.alphaTest&&o.enable(24);e.vertexColors&&o.enable(25);e.vertexAlphas&&o.enable(26);e.vertexUvs&&o.enable(27);e.vertexTangents&&o.enable(28);e.uvsVertexOnly&&o.enable(29);e.fog&&o.enable(30);t.push(o.mask),o.disableAll(),e.useFog&&o.enable(0);e.flatShading&&o.enable(1);e.logarithmicDepthBuffer&&o.enable(2);e.skinning&&o.enable(3);e.useVertexTexture&&o.enable(4);e.morphTargets&&o.enable(5);e.morphNormals&&o.enable(6);e.morphColors&&o.enable(7);e.premultipliedAlpha&&o.enable(8);e.shadowMapEnabled&&o.enable(9);e.physicallyCorrectLights&&o.enable(10);e.doubleSided&&o.enable(11);e.flipSided&&o.enable(12);e.depthPacking&&o.enable(13);e.dithering&&o.enable(14);e.specularIntensityMap&&o.enable(15);e.specularColorMap&&o.enable(16);e.transmission&&o.enable(17);e.transmissionMap&&o.enable(18);e.thicknessMap&&o.enable(19);e.sheen&&o.enable(20);e.sheenColorMap&&o.enable(21);e.sheenRoughnessMap&&o.enable(22);e.decodeVideoTexture&&o.enable(23);e.opaque&&o.enable(24);t.push(o.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=g[t.type];let i;if(e){const t=Eu[e];i=jd.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Nm(t,i,e,s),h.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:h,dispose:function(){l.dispose()}}}function Um(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Gm(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Hm(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Xm(){const t=[];let e=0;const i=[],n=[],r=[];function s(i,n,r,s,a,o){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:a,group:o},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,a,o,l,h){const c=s(t,e,a,o,l,h);a.transmission>0?n.push(c):!0===a.transparent?r.push(c):i.push(c)},unshift:function(t,e,a,o,l,h){const c=s(t,e,a,o,l,h);a.transmission>0?n.unshift(c):!0===a.transparent?r.unshift(c):i.unshift(c)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Gm),n.length>1&&n.sort(e||Hm),r.length>1&&r.sort(e||Hm)}}}function Vm(){let t=new WeakMap;return{get:function(e,i){let n;return!1===t.has(e)?(n=new Xm,t.set(e,[n])):i>=t.get(e).length?(n=new Xm,t.get(e).push(n)):n=t.get(e)[i],n},dispose:function(){t=new WeakMap}}}function Ym(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new gc,color:new ac};break;case"SpotLight":i={position:new gc,direction:new gc,color:new ac,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new gc,color:new ac,distance:0,decay:0};break;case"HemisphereLight":i={direction:new gc,skyColor:new ac,groundColor:new ac};break;case"RectAreaLight":i={color:new ac,position:new gc,halfWidth:new gc,halfHeight:new gc}}return t[e.id]=i,i}}}let $m=0;function Wm(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Zm(t,e){const i=new Ym,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zh};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zh,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new gc);const s=new gc,a=new Vc,o=new Vc;return{setup:function(s,a){let o=0,l=0,h=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,d=0,u=0,f=0,m=0,p=0,g=0,_=0;s.sort(Wm);const x=!0!==a?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],a=e.color,y=e.intensity,A=e.distance,v=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*y*x,l+=a.g*y*x,h+=a.b*y*x;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],y);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*x),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=v,r.directionalShadowMatrix[c]=e.shadow.matrix,p++}r.directional[c]=t,c++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(y*x),t.distance=A,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[u]=i,r.spotShadowMap[u]=v,r.spotShadowMatrix[u]=e.shadow.matrix,_++}r.spot[u]=t,u++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(a).multiplyScalar(y),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[f]=t,f++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*x),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[d]=i,r.pointShadowMap[d]=v,r.pointShadowMatrix[d]=e.shadow.matrix,g++}r.point[d]=t,d++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(y*x),t.groundColor.copy(e.groundColor).multiplyScalar(y*x),r.hemi[m]=t,m++}}f>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Pu.LTC_FLOAT_1,r.rectAreaLTC2=Pu.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Pu.LTC_HALF_1,r.rectAreaLTC2=Pu.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=h;const y=r.hash;y.directionalLength===c&&y.pointLength===d&&y.spotLength===u&&y.rectAreaLength===f&&y.hemiLength===m&&y.numDirectionalShadows===p&&y.numPointShadows===g&&y.numSpotShadows===_||(r.directional.length=c,r.spot.length=u,r.rectArea.length=f,r.point.length=d,r.hemi.length=m,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=_,y.directionalLength=c,y.pointLength=d,y.spotLength=u,y.rectAreaLength=f,y.hemiLength=m,y.numDirectionalShadows=p,y.numPointShadows=g,y.numSpotShadows=_,r.version=$m++)},setupView:function(t,e){let i=0,n=0,l=0,h=0,c=0;const d=e.matrixWorldInverse;for(let e=0,u=t.length;e<u;e++){const u=t[e];if(u.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(u.matrixWorld),s.setFromMatrixPosition(u.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(d),i++}else if(u.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(d),t.direction.setFromMatrixPosition(u.matrixWorld),s.setFromMatrixPosition(u.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(d),l++}else if(u.isRectAreaLight){const t=r.rectArea[h];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(d),o.identity(),a.copy(u.matrixWorld),a.premultiply(d),o.extractRotation(a),t.halfWidth.set(.5*u.width,0,0),t.halfHeight.set(0,.5*u.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),h++}else if(u.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(d),n++}else if(u.isHemisphereLight){const t=r.hemi[c];t.direction.setFromMatrixPosition(u.matrixWorld),t.direction.transformDirection(d),t.direction.normalize(),c++}}},state:r}}function Qm(t,e){const i=new Zm(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function Jm(t,e){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new Qm(t,e),i.set(n,[s])):r>=i.get(n).length?(s=new Qm(t,e),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class Km extends Nd{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Km.prototype.isMeshDepthMaterial=!0;class tp extends Nd{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new gc,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}tp.prototype.isMeshDistanceMaterial=!0;function ep(t,e,i){let n=new Xc;const r=new Zh,s=new Zh,a=new fc,o=new Km({depthPacking:3201}),l=new tp,h={},c=i.maxTextureSize,d={0:1,1:0,2:2},u=new qd({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zh},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=u.clone();f.defines.HORIZONTAL_PASS=1;const m=new Od;m.setAttribute("position",new rd(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const p=new Tu(m,u),g=this;function _(i,n){const r=e.update(p);u.defines.VSM_SAMPLES!==i.blurSamples&&(u.defines.VSM_SAMPLES=i.blurSamples,f.defines.VSM_SAMPLES=i.blurSamples,u.needsUpdate=!0,f.needsUpdate=!0),u.uniforms.shadow_pass.value=i.map.texture,u.uniforms.resolution.value=i.mapSize,u.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,u,p,null),f.uniforms.shadow_pass.value=i.mapPass.texture,f.uniforms.resolution.value=i.mapSize,f.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,f,p,null)}function x(e,i,n,r,s,a){let c=null;const u=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(c=void 0!==u?u:!0===n.isPointLight?l:o,t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=c.uuid,e=i.uuid;let n=h[t];void 0===n&&(n={},h[t]=n);let r=n[e];void 0===r&&(r=c.clone(),n[e]=r),c=r}return c.visible=i.visible,c.wireframe=i.wireframe,c.side=3===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],c.alphaMap=i.alphaMap,c.alphaTest=i.alphaTest,c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.displacementMap=i.displacementMap,c.displacementScale=i.displacementScale,c.displacementBias=i.displacementBias,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===n.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(n.matrixWorld),c.nearDistance=r,c.farDistance=s),c}function y(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===o)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],c=r[h.materialIndex];if(c&&c.visible){const e=x(i,c,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,h)}}}else if(r.visible){const e=x(i,r,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)y(l[t],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),u=t.state;u.setBlending(0),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let l=0,h=e.length;l<h;l++){const h=e[l],d=h.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;r.copy(d.mapSize);const f=d.getFrameExtents();if(r.multiply(f),s.copy(d.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/f.x),r.x=s.x*f.x,d.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/f.y),r.y=s.y*f.y,d.mapSize.y=s.y)),null===d.map&&!d.isPointLightShadow&&3===this.type){const t={minFilter:_h,magFilter:_h,format:Th};d.map=new mc(r.x,r.y,t),d.map.texture.name=h.name+".shadowMap",d.mapPass=new mc(r.x,r.y,t),d.camera.updateProjectionMatrix()}if(null===d.map){const t={minFilter:gh,magFilter:gh,format:Th};d.map=new mc(r.x,r.y,t),d.map.texture.name=h.name+".shadowMap",d.camera.updateProjectionMatrix()}t.setRenderTarget(d.map),t.clear();const m=d.getViewportCount();for(let t=0;t<m;t++){const e=d.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),u.viewport(a),d.updateMatrices(h,t),n=d.getFrustum(),y(i,o,d.camera,h,this.type)}d.isPointLightShadow||3!==this.type||_(d,o),d.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,h,d)}}function ip(t,e,i){const n=i.isWebGL2;const r=new function(){let e=!1;const i=new fc;let n=null;const r=new fc(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,a,o){!0===o&&(e*=a,n*=a,s*=a),i.set(e,n,s,a),!1===r.equals(i)&&(t.clearColor(e,n,s,a),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},s=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(e){e?F(t.DEPTH_TEST):I(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},a=new function(){let e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null;return{setTest:function(i){e||(i?F(t.STENCIL_TEST):I(t.STENCIL_TEST))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){n===e&&r===i&&s===a||(t.stencilFunc(e,i,a),n=e,r=i,s=a)},setOp:function(e,i,n){a===e&&o===i&&l===n||(t.stencilOp(e,i,n),a=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null}}};let o={},l={},h=new WeakMap,c=[],d=null,u=!1,f=null,m=null,p=null,g=null,_=null,x=null,y=null,A=!1,v=null,b=null,w=null,M=null,T=null;const S=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let C=!1,P=0;const E=t.getParameter(t.VERSION);-1!==E.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(E)[1]),C=P>=1):-1!==E.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(E)[1]),C=P>=2);let k=null,D={};const z=t.getParameter(t.SCISSOR_BOX),O=t.getParameter(t.VIEWPORT),R=(new fc).fromArray(z),L=(new fc).fromArray(O);function B(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let e=0;e<n;e++)t.texImage2D(i+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return s}const N={};function F(e){!0!==o[e]&&(t.enable(e),o[e]=!0)}function I(e){!1!==o[e]&&(t.disable(e),o[e]=!1)}N[t.TEXTURE_2D]=B(t.TEXTURE_2D,t.TEXTURE_2D,1),N[t.TEXTURE_CUBE_MAP]=B(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),r.setClear(0,0,0,1),s.setClear(1),a.setClear(0),F(t.DEPTH_TEST),s.setFunc(3),G(!1),H(1),F(t.CULL_FACE),U(0);const j={[hh]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};if(n)j[103]=t.MIN,j[104]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(j[103]=t.MIN_EXT,j[104]=t.MAX_EXT)}const q={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,204:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,205:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA};function U(e,i,n,r,s,a,o,l){if(0!==e){if(!1===u&&(F(t.BLEND),u=!0),5===e)s=s||i,a=a||n,o=o||r,i===m&&s===_||(t.blendEquationSeparate(j[i],j[s]),m=i,_=s),n===p&&r===g&&a===x&&o===y||(t.blendFuncSeparate(q[n],q[r],q[a],q[o]),p=n,g=r,x=a,y=o),f=e,A=null;else if(e!==f||l!==A){if(m===hh&&_===hh||(t.blendEquation(t.FUNC_ADD),m=hh,_=hh),l)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}p=null,g=null,x=null,y=null,f=e,A=l}}else!0===u&&(I(t.BLEND),u=!1)}function G(e){v!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),v=e)}function H(e){0!==e?(F(t.CULL_FACE),e!==b&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):I(t.CULL_FACE),b=e}function X(e,i,n){e?(F(t.POLYGON_OFFSET_FILL),M===i&&T===n||(t.polygonOffset(i,n),M=i,T=n)):I(t.POLYGON_OFFSET_FILL)}function V(e){void 0===e&&(e=t.TEXTURE0+S-1),k!==e&&(t.activeTexture(e),k=e)}return{buffers:{color:r,depth:s,stencil:a},enable:F,disable:I,bindFramebuffer:function(e,i){return l[e]!==i&&(t.bindFramebuffer(e,i),l[e]=i,n&&(e===t.DRAW_FRAMEBUFFER&&(l[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(l[t.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(n,r){let s=c,a=!1;if(n)if(s=h.get(r),void 0===s&&(s=[],h.set(r,s)),n.isWebGLMultipleRenderTargets){const e=n.texture;if(s.length!==e.length||s[0]!==t.COLOR_ATTACHMENT0){for(let i=0,n=e.length;i<n;i++)s[i]=t.COLOR_ATTACHMENT0+i;s.length=e.length,a=!0}}else s[0]!==t.COLOR_ATTACHMENT0&&(s[0]=t.COLOR_ATTACHMENT0,a=!0);else s[0]!==t.BACK&&(s[0]=t.BACK,a=!0);a&&(i.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return d!==e&&(t.useProgram(e),d=e,!0)},setBlending:U,setMaterial:function(e,i){2===e.side?I(t.CULL_FACE):F(t.CULL_FACE);let n=1===e.side;i&&(n=!n),G(n),1===e.blending&&!1===e.transparent?U(0):U(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const o=e.stencilWrite;a.setTest(o),o&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),X(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?F(t.SAMPLE_ALPHA_TO_COVERAGE):I(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:G,setCullFace:H,setLineWidth:function(e){e!==w&&(C&&t.lineWidth(e),w=e)},setPolygonOffset:X,setScissorTest:function(e){e?F(t.SCISSOR_TEST):I(t.SCISSOR_TEST)},activeTexture:V,bindTexture:function(e,i){null===k&&V();let n=D[k];void 0===n&&(n={type:void 0,texture:void 0},D[k]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||N[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=D[k];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===R.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),R.copy(e))},viewport:function(e){!1===L.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),L.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===n&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),o={},k=null,D={},l={},h=new WeakMap,c=[],d=null,u=!1,f=null,m=null,p=null,g=null,_=null,x=null,y=null,A=!1,v=null,b=null,w=null,M=null,T=null,R.set(0,0,t.canvas.width,t.canvas.height),L.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),a.reset()}}}function np(t,e,i,n,r,s,a){const o=r.isWebGL2,l=r.maxTextures,h=r.maxCubemapSize,c=r.maxTextureSize,d=r.maxSamples,u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=new WeakMap;let m;const p=new WeakMap;let g=!1;try{g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function _(t,e){return g?new OffscreenCanvas(t,e):Kh("canvas")}function x(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?$h:Math.floor,s=n(r*t.width),a=n(r*t.height);void 0===m&&(m=_(s,a));const o=i?_(s,a):m;o.width=s,o.height=a;return o.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return Yh(t.width)&&Yh(t.height)}function A(t,e){return t.generateMipmaps&&e&&t.minFilter!==gh&&t.minFilter!==_h}function v(e){t.generateMipmap(e)}function b(i,n,r,s,a=!1){if(!1===o)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return n===t.RED&&(r===t.FLOAT&&(l=t.R32F),r===t.HALF_FLOAT&&(l=t.R16F),r===t.UNSIGNED_BYTE&&(l=t.R8)),n===t.RG&&(r===t.FLOAT&&(l=t.RG32F),r===t.HALF_FLOAT&&(l=t.RG16F),r===t.UNSIGNED_BYTE&&(l=t.RG8)),n===t.RGBA&&(r===t.FLOAT&&(l=t.RGBA32F),r===t.HALF_FLOAT&&(l=t.RGBA16F),r===t.UNSIGNED_BYTE&&(l=s===Oh&&!1===a?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1)),l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l}function w(t,e,i){return!0===A(t,i)||t.isFramebufferTexture&&t.minFilter!==gh&&t.minFilter!==_h?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function M(e){return e===gh||1004===e||1005===e?t.NEAREST:t.LINEAR}function T(t){const e=t.target;e.removeEventListener("dispose",T),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,r=p.get(i);if(r){const n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&C(t),0===Object.keys(r).length&&p.delete(i)}n.remove(t)}(e),e.isVideoTexture&&f.delete(e)}function S(e){const i=e.target;i.removeEventListener("dispose",S),function(e){const i=e.texture,r=n.get(e),s=n.get(i);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function C(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const r=e.source;delete p.get(r)[i.__cacheKey],a.memory.textures--}let P=0;function E(e,r){const s=n.get(e);if(e.isVideoTexture&&function(t){const e=a.render.frame;f.get(t)!==e&&(f.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void R(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D,s.__webglTexture)}const k={[fh]:t.REPEAT,[mh]:t.CLAMP_TO_EDGE,[ph]:t.MIRRORED_REPEAT},D={[gh]:t.NEAREST,1004:t.NEAREST_MIPMAP_NEAREST,1005:t.NEAREST_MIPMAP_LINEAR,[_h]:t.LINEAR,1007:t.LINEAR_MIPMAP_NEAREST,[xh]:t.LINEAR_MIPMAP_LINEAR};function z(i,s,a){if(a?(t.texParameteri(i,t.TEXTURE_WRAP_S,k[s.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,k[s.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,k[s.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,D[s.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,D[s.minFilter])):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),s.wrapS===mh&&s.wrapT===mh||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,t.TEXTURE_MAG_FILTER,M(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,M(s.minFilter)),s.minFilter!==gh&&s.minFilter!==_h&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(s.type===bh&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===wh&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function O(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",T));const r=i.source;let s=p.get(r);void 0===s&&(s={},p.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(i);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&C(i)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return n}function R(e,n,r){let a=t.TEXTURE_2D;n.isDataArrayTexture&&(a=t.TEXTURE_2D_ARRAY),n.isData3DTexture&&(a=t.TEXTURE_3D);const l=O(e,n),h=n.source;if(i.activeTexture(t.TEXTURE0+r),i.bindTexture(a,e.__webglTexture),h.version!==h.__currentVersion||!0===l){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const r=function(t){return!o&&(t.wrapS!==mh||t.wrapT!==mh||t.minFilter!==gh&&t.minFilter!==_h)}(n)&&!1===y(n.image);let l=x(n.image,r,!1,c);l=j(n,l);const d=y(l)||o,u=s.convert(n.format,n.encoding);let f,m=s.convert(n.type),p=b(n.internalFormat,u,m,n.encoding,n.isVideoTexture);z(a,n,d);const g=n.mipmaps,_=o&&!0!==n.isVideoTexture,M=void 0===e.__version,T=w(n,l,d);if(n.isDepthTexture)p=t.DEPTH_COMPONENT,o?p=n.type===bh?t.DEPTH_COMPONENT32F:n.type===vh?t.DEPTH_COMPONENT24:n.type===Mh?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:n.type===bh&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Sh&&p===t.DEPTH_COMPONENT&&n.type!==Ah&&n.type!==vh&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Ah,m=s.convert(n.type)),n.format===Ch&&p===t.DEPTH_COMPONENT&&(p=t.DEPTH_STENCIL,n.type!==Mh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Mh,m=s.convert(n.type))),_&&M?i.texStorage2D(t.TEXTURE_2D,1,p,l.width,l.height):i.texImage2D(t.TEXTURE_2D,0,p,l.width,l.height,0,u,m,null);else if(n.isDataTexture)if(g.length>0&&d){_&&M&&i.texStorage2D(t.TEXTURE_2D,T,p,g[0].width,g[0].height);for(let e=0,n=g.length;e<n;e++)f=g[e],_?i.texSubImage2D(t.TEXTURE_2D,e,0,0,f.width,f.height,u,m,f.data):i.texImage2D(t.TEXTURE_2D,e,p,f.width,f.height,0,u,m,f.data);n.generateMipmaps=!1}else _?(M&&i.texStorage2D(t.TEXTURE_2D,T,p,l.width,l.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,l.width,l.height,u,m,l.data)):i.texImage2D(t.TEXTURE_2D,0,p,l.width,l.height,0,u,m,l.data);else if(n.isCompressedTexture){_&&M&&i.texStorage2D(t.TEXTURE_2D,T,p,g[0].width,g[0].height);for(let e=0,r=g.length;e<r;e++)f=g[e],n.format!==Th?null!==u?_?i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,f.width,f.height,u,f.data):i.compressedTexImage2D(t.TEXTURE_2D,e,p,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_?i.texSubImage2D(t.TEXTURE_2D,e,0,0,f.width,f.height,u,m,f.data):i.texImage2D(t.TEXTURE_2D,e,p,f.width,f.height,0,u,m,f.data)}else if(n.isDataArrayTexture)_?(M&&i.texStorage3D(t.TEXTURE_2D_ARRAY,T,p,l.width,l.height,l.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,l.width,l.height,l.depth,u,m,l.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,p,l.width,l.height,l.depth,0,u,m,l.data);else if(n.isData3DTexture)_?(M&&i.texStorage3D(t.TEXTURE_3D,T,p,l.width,l.height,l.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,l.width,l.height,l.depth,u,m,l.data)):i.texImage3D(t.TEXTURE_3D,0,p,l.width,l.height,l.depth,0,u,m,l.data);else if(n.isFramebufferTexture)_&&M?i.texStorage2D(t.TEXTURE_2D,T,p,l.width,l.height):i.texImage2D(t.TEXTURE_2D,0,p,l.width,l.height,0,u,m,null);else if(g.length>0&&d){_&&M&&i.texStorage2D(t.TEXTURE_2D,T,p,g[0].width,g[0].height);for(let e=0,n=g.length;e<n;e++)f=g[e],_?i.texSubImage2D(t.TEXTURE_2D,e,0,0,u,m,f):i.texImage2D(t.TEXTURE_2D,e,p,u,m,f);n.generateMipmaps=!1}else _?(M&&i.texStorage2D(t.TEXTURE_2D,T,p,l.width,l.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,u,m,l)):i.texImage2D(t.TEXTURE_2D,0,p,u,m,l);A(n,d)&&v(a),h.__currentVersion=h.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}function L(e,r,a,o,l){const h=s.convert(a.format,a.encoding),c=s.convert(a.type),d=b(a.internalFormat,h,c,a.encoding);n.get(r).__hasExternalTextures||(l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,0,d,r.width,r.height,r.depth,0,h,c,null):i.texImage2D(l,0,d,r.width,r.height,0,h,c,null)),i.bindFramebuffer(t.FRAMEBUFFER,e),I(r)?u.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,o,l,n.get(a).__webglTexture,0,F(r)):t.framebufferTexture2D(t.FRAMEBUFFER,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(t.FRAMEBUFFER,null)}function B(e,i,n){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer){let r=t.DEPTH_COMPONENT16;if(n||I(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===bh?r=t.DEPTH_COMPONENT32F:e.type===vh&&(r=t.DEPTH_COMPONENT24));const n=F(i);I(i)?u.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,n,r,i.width,i.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,n,r,i.width,i.height)}else t.renderbufferStorage(t.RENDERBUFFER,r,i.width,i.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(i.depthBuffer&&i.stencilBuffer){const r=F(i);n&&!1===I(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,i.width,i.height):I(i)?u.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(e.format,e.encoding),a=s.convert(e.type),o=b(e.internalFormat,r,a,e.encoding),l=F(i);n&&!1===I(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,l,o,i.width,i.height):I(i)?u.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,l,o,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,o,i.width,i.height)}t.bindRenderbuffer(t.RENDERBUFFER,null)}function N(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,a=F(r);if(r.depthTexture.format===Sh)I(r)?u.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==Ch)throw new Error("Unknown depthTexture format");I(r)?u.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),B(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),B(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function F(t){return Math.min(d,t.samples)}function I(t){const i=n.get(t);return o&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function j(t,i){const n=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===Nh||n!==zh&&(n===Oh?!1===o?!0===e.has("EXT_sRGB")&&r===Th?(t.format=Nh,t.minFilter=_h,t.generateMipmaps=!1):i=lc.sRGBToLinear(i):r===Th&&s===yh||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){const t=P;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),P+=1,t},this.resetTextureUnits=function(){P=0},this.setTexture2D=E,this.setTexture2DArray=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?R(s,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture))},this.setTexture3D=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?R(s,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_3D,s.__webglTexture))},this.setTextureCube=function(e,r){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;const a=O(e,n),l=n.source;if(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture),l.version!==l.__currentVersion||!0===a){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const r=n.isCompressedTexture||n.image[0].isCompressedTexture,a=n.image[0]&&n.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=r||a?a?n.image[t].image:n.image[t]:x(n.image[t],!1,!0,h),c[t]=j(n,c[t]);const d=c[0],u=y(d)||o,f=s.convert(n.format,n.encoding),m=s.convert(n.type),p=b(n.internalFormat,f,m,n.encoding),g=o&&!0!==n.isVideoTexture,_=void 0===e.__version;let M,T=w(n,d,u);if(z(t.TEXTURE_CUBE_MAP,n,u),r){g&&_&&i.texStorage2D(t.TEXTURE_CUBE_MAP,T,p,d.width,d.height);for(let e=0;e<6;e++){M=c[e].mipmaps;for(let r=0;r<M.length;r++){const s=M[r];n.format!==Th?null!==f?g?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,f,s.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,p,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,f,m,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,p,s.width,s.height,0,f,m,s.data)}}}else{M=n.mipmaps,g&&_&&(M.length>0&&T++,i.texStorage2D(t.TEXTURE_CUBE_MAP,T,p,c[0].width,c[0].height));for(let e=0;e<6;e++)if(a){g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,c[e].width,c[e].height,f,m,c[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,p,c[e].width,c[e].height,0,f,m,c[e].data);for(let n=0;n<M.length;n++){const r=M[n].image[e].image;g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,r.width,r.height,f,m,r.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,p,r.width,r.height,0,f,m,r.data)}}else{g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f,m,c[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,p,f,m,c[e]);for(let n=0;n<M.length;n++){const r=M[n];g?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,f,m,r.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,p,f,m,r.image[e])}}}A(n,u)&&v(t.TEXTURE_CUBE_MAP),l.__currentVersion=l.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}(a,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture))},this.rebindTextures=function(e,i,r){const s=n.get(e);void 0!==i&&L(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),void 0!==r&&N(e)},this.setupRenderTarget=function(e){const l=e.texture,h=n.get(e),c=n.get(l);e.addEventListener("dispose",S),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=l.version,a.memory.textures++);const d=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultipleRenderTargets,f=y(e)||o;if(d){h.__webglFramebuffer=[];for(let e=0;e<6;e++)h.__webglFramebuffer[e]=t.createFramebuffer()}else if(h.__webglFramebuffer=t.createFramebuffer(),u)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(o&&e.samples>0&&!1===I(e)){h.__webglMultisampledFramebuffer=t.createFramebuffer(),h.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,h.__webglColorRenderbuffer);const n=s.convert(l.format,l.encoding),r=s.convert(l.type),a=b(l.internalFormat,n,r,l.encoding),o=F(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,a,e.width,e.height),i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h.__webglColorRenderbuffer),t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(h.__webglDepthRenderbuffer=t.createRenderbuffer(),B(h.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}if(d){i.bindTexture(t.TEXTURE_CUBE_MAP,c.__webglTexture),z(t.TEXTURE_CUBE_MAP,l,f);for(let i=0;i<6;i++)L(h.__webglFramebuffer[i],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i);A(l,f)&&v(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(u){const r=e.texture;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=n.get(a);i.bindTexture(t.TEXTURE_2D,o.__webglTexture),z(t.TEXTURE_2D,a,f),L(h.__webglFramebuffer,e,a,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D),A(a,f)&&v(t.TEXTURE_2D)}i.unbindTexture()}else{let n=t.TEXTURE_2D;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(o?n=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(n,c.__webglTexture),z(n,l,f),L(h.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,n),A(l,f)&&v(n),i.unbindTexture()}e.depthBuffer&&N(e)},this.updateRenderTargetMipmap=function(e){const r=y(e)||o,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,o=s.length;a<o;a++){const o=s[a];if(A(o,r)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=n.get(o).__webglTexture;i.bindTexture(r,s),v(r),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(o&&e.samples>0&&!1===I(e)){const r=e.width,s=e.height;let a=t.COLOR_BUFFER_BIT;const o=[t.COLOR_ATTACHMENT0],l=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;e.depthBuffer&&o.push(l);const h=n.get(e),c=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;!1===c&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),i.bindFramebuffer(t.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer),!0===c&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[l]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[l])),t.blitFramebuffer(0,0,r,s,0,0,r,s,a,t.NEAREST),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,o),i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=L,this.useMultisampledRTT=I}function rp(t,e,i){const n=i.isWebGL2;return{convert:function(i,r=null){let s;if(i===yh)return t.UNSIGNED_BYTE;if(1017===i)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return t.BYTE;if(1011===i)return t.SHORT;if(i===Ah)return t.UNSIGNED_SHORT;if(1013===i)return t.INT;if(i===vh)return t.UNSIGNED_INT;if(i===bh)return t.FLOAT;if(i===wh)return n?t.HALF_FLOAT:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===i)return t.ALPHA;if(i===Th)return t.RGBA;if(1024===i)return t.LUMINANCE;if(1025===i)return t.LUMINANCE_ALPHA;if(i===Sh)return t.DEPTH_COMPONENT;if(i===Ch)return t.DEPTH_STENCIL;if(1028===i)return t.RED;if(1022===i)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),t.RGBA;if(i===Nh)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===i)return t.RED_INTEGER;if(1030===i)return t.RG;if(1031===i)return t.RG_INTEGER;if(1033===i)return t.RGBA_INTEGER;if(i===Ph||i===Eh||i===kh||i===Dh)if(r===Oh){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===Ph)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Eh)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===kh)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Dh)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===Ph)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Eh)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===kh)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Dh)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===i||35841===i||35842===i||35843===i){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===i)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===i||37496===i){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(37492===i)return r===Oh?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return r===Oh?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===i){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(36492===i)return r===Oh?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===Mh?n?t.UNSIGNED_INT_24_8:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class sp extends Bu{constructor(t=[]){super(),this.cameras=t}}sp.prototype.isArrayCamera=!0;class ap extends Td{constructor(){super(),this.type="Group"}}ap.prototype.isGroup=!0;const op={type:"move"};class lp{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ap,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ap,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new gc,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new gc),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ap,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new gc,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new gc),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(op))),l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new ap;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,h=.005;l.inputState.pinching&&a>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class hp extends uc{constructor(t,e,i,n,r,s,a,o,l,h){if((h=void 0!==h?h:Sh)!==Sh&&h!==Ch)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===Sh&&(i=Ah),void 0===i&&h===Ch&&(i=Mh),super(null,n,r,s,a,o,h,i,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:gh,this.minFilter=void 0!==o?o:gh,this.flipY=!1,this.generateMipmaps=!1}}hp.prototype.isDepthTexture=!0;class cp extends Fh{constructor(t,e){super();const i=this;let n=null,r=1,s=null,a="local-floor",o=null,l=null,h=null,c=null,d=null;const u=e.getContextAttributes();let f=null,m=null;const p=[],g=new Map,_=new Bu;_.layers.enable(1),_.viewport=new fc;const x=new Bu;x.layers.enable(2),x.viewport=new fc;const y=[_,x],A=new sp;A.layers.enable(1),A.layers.enable(2);let v=null,b=null;function w(t){const e=g.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function M(){g.forEach((function(t,e){t.disconnect(e)})),g.clear(),v=null,b=null,t.setRenderTarget(f),c=null,h=null,l=null,n=null,m=null,k.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function T(t){const e=n.inputSources;for(let t=0;t<p.length;t++)g.set(e[t],p[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=g.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),g.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=g.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=p[t];return void 0===e&&(e=new lp,p[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=p[t];return void 0===e&&(e=new lp,p[t]=e),e.getGripSpace()},this.getHand=function(t){let e=p[t];return void 0===e&&(e=new lp,p[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==h?h:c},this.getBinding=function(){return l},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(o){if(n=o,null!==n){if(f=t.getRenderTarget(),n.addEventListener("select",w),n.addEventListener("selectstart",w),n.addEventListener("selectend",w),n.addEventListener("squeeze",w),n.addEventListener("squeezestart",w),n.addEventListener("squeezeend",w),n.addEventListener("end",M),n.addEventListener("inputsourceschange",T),!0!==u.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||u.antialias,alpha:u.alpha,depth:u.depth,stencil:u.stencil,framebufferScaleFactor:r};c=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:c}),m=new mc(c.framebufferWidth,c.framebufferHeight,{format:Th,type:yh,encoding:t.outputEncoding})}else{let i=null,s=null,a=null;u.depth&&(a=u.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=u.stencil?Ch:Sh,s=u.stencil?Mh:Ah);const o={colorFormat:t.outputEncoding===Oh?e.SRGB8_ALPHA8:e.RGBA8,depthFormat:a,scaleFactor:r};l=new XRWebGLBinding(n,e),h=l.createProjectionLayer(o),n.updateRenderState({layers:[h]}),m=new mc(h.textureWidth,h.textureHeight,{format:Th,type:yh,depthTexture:new hp(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:u.stencil,encoding:t.outputEncoding,samples:u.antialias?4:0});t.properties.get(m).__ignoreDepthValues=h.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),s=await n.requestReferenceSpace(a),k.setContext(n),k.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const S=new gc,C=new gc;function P(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;A.near=x.near=_.near=t.near,A.far=x.far=_.far=t.far,v===A.near&&b===A.far||(n.updateRenderState({depthNear:A.near,depthFar:A.far}),v=A.near,b=A.far);const e=t.parent,i=A.cameras;P(A,e);for(let t=0;t<i.length;t++)P(i[t],e);A.matrixWorld.decompose(A.position,A.quaternion,A.scale),t.position.copy(A.position),t.quaternion.copy(A.quaternion),t.scale.copy(A.scale),t.matrix.copy(A.matrix),t.matrixWorld.copy(A.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){S.setFromMatrixPosition(e.matrixWorld),C.setFromMatrixPosition(i.matrixWorld);const n=S.distanceTo(C),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],d=(s[8]+1)/s[0],u=a*c,f=a*d,m=n/(-c+d),p=m*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(p),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+m,_=o+m,x=u-p,y=f+(n-p),A=l*o/_*g,v=h*o/_*g;t.projectionMatrix.makePerspective(x,y,A,v,g,_)}(A,_,x):A.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return A},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==c?c.fixedFoveation:void 0},this.setFoveation=function(t){null!==h&&(h.fixedFoveation=t),null!==c&&void 0!==c.fixedFoveation&&(c.fixedFoveation=t)};let E=null;const k=new td;k.setAnimationLoop((function(e,i){if(o=i.getViewerPose(s),d=i,null!==o){const e=o.views;null!==c&&(t.setRenderTargetFramebuffer(m,c.framebuffer),t.setRenderTarget(m));let i=!1;e.length!==A.cameras.length&&(A.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let s=null;if(null!==c)s=c.getViewport(r);else{const e=l.getViewSubImage(h,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(m,e.colorTexture,h.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}const a=y[n];a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&A.matrix.copy(a.matrix),!0===i&&A.cameras.push(a)}}const r=n.inputSources;for(let t=0;t<p.length;t++){const e=p[t],n=r[t];e.update(n,i,s)}E&&E(e,i),d=null})),this.setAnimationLoop=function(t){E=t},this.dispose=function(){}}}function dp(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const n=t.get(i).envMap;let r,s;n&&(e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias);t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,s,a){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e,n){i(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,a):i(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,s):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function up(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=Kh("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,o=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let c;c=void 0!==t.context?i.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let d=null,u=null;const f=[],m=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=zh,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const p=this;let g=!1,_=0,x=0,y=null,A=-1,v=null;const b=new fc,w=new fc;let M=null,T=e.width,S=e.height,C=1,P=null,E=null;const k=new fc(0,0,T,S),D=new fc(0,0,T,S);let z=!1;const O=new Xc;let R=!1,L=!1,B=null;const N=new Vc,F=new Zh,I=new gc,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===y?C:1}let U,G,H,X,V,Y,$,W,Z,Q,J,K,tt,et,it,nt,rt,st,at,ot,lt,ht,ct,dt=i;function ut(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r138"),e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",gt,!1),null===dt){const e=["webgl2","webgl","experimental-webgl"];if(!0===p.isWebGL1Renderer&&e.shift(),dt=ut(e,t),null===dt)throw ut(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===dt.getShaderPrecisionFormat&&(dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ft(){U=new sf(dt),G=new Ou(dt,U,t),U.init(G),ht=new rp(dt,U,G),H=new ip(dt,U,G),X=new lf(dt),V=new Um,Y=new np(dt,U,H,V,G,ht,X),$=new qu(p),W=new rf(p),Z=new ed(dt,G),ct=new Du(dt,U,Z,G),Q=new af(dt,Z,X,ct),J=new mf(dt,Q,Z,X),at=new ff(dt,G,Y),nt=new Ru(V),K=new qm(p,$,W,U,G,ct,nt),tt=new dp(V),et=new Vm,it=new Jm(U,G),st=new ku(p,$,H,J,c,a),rt=new ep(p,J,G),ot=new zu(dt,U,X,G),lt=new of(dt,U,X,G),X.programs=K.programs,p.capabilities=G,p.extensions=U,p.properties=V,p.renderLists=et,p.shadowMap=rt,p.state=H,p.info=X}ft();const mt=new cp(p,dt);function pt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function gt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const t=X.autoReset,e=rt.enabled,i=rt.autoUpdate,n=rt.needsUpdate,r=rt.type;ft(),X.autoReset=t,rt.enabled=e,rt.autoUpdate=i,rt.needsUpdate=n,rt.type=r}function _t(t){const e=t.target;e.removeEventListener("dispose",_t),function(t){(function(t){const e=V.get(t).programs;void 0!==e&&(e.forEach((function(t){K.releaseProgram(t)})),t.isShaderMaterial&&K.releaseShaderCache(t))})(t),V.remove(t)}(e)}this.xr=mt,this.getContext=function(){return dt},this.getContextAttributes=function(){return dt.getContextAttributes()},this.forceContextLoss=function(){const t=U.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=U.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(t){void 0!==t&&(C=t,this.setSize(T,S,!1))},this.getSize=function(t){return t.set(T,S)},this.setSize=function(t,i,n){mt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,S=i,e.width=Math.floor(t*C),e.height=Math.floor(i*C),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(T*C,S*C).floor()},this.setDrawingBufferSize=function(t,i,n){T=t,S=i,C=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(b)},this.getViewport=function(t){return t.copy(k)},this.setViewport=function(t,e,i,n){t.isVector4?k.set(t.x,t.y,t.z,t.w):k.set(t,e,i,n),H.viewport(b.copy(k).multiplyScalar(C).floor())},this.getScissor=function(t){return t.copy(D)},this.setScissor=function(t,e,i,n){t.isVector4?D.set(t.x,t.y,t.z,t.w):D.set(t,e,i,n),H.scissor(w.copy(D).multiplyScalar(C).floor())},this.getScissorTest=function(){return z},this.setScissorTest=function(t){H.setScissorTest(z=t)},this.setOpaqueSort=function(t){P=t},this.setTransparentSort=function(t){E=t},this.getClearColor=function(t){return t.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor.apply(st,arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha.apply(st,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;t&&(n|=dt.COLOR_BUFFER_BIT),e&&(n|=dt.DEPTH_BUFFER_BIT),i&&(n|=dt.STENCIL_BUFFER_BIT),dt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",gt,!1),et.dispose(),it.dispose(),V.dispose(),$.dispose(),W.dispose(),J.dispose(),ct.dispose(),K.dispose(),mt.dispose(),mt.removeEventListener("sessionstart",yt),mt.removeEventListener("sessionend",At),B&&(B.dispose(),B=null),vt.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=j);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,i,n,r){!0!==e.isScene&&(e=j);Y.resetTextureUnits();const s=e.fog,a=n.isMeshStandardMaterial?e.environment:null,o=null===y?p.outputEncoding:!0===y.isXRRenderTarget?y.texture.encoding:zh,l=(n.isMeshStandardMaterial?W:$).get(n.envMap||a),h=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!n.normalMap&&!!i.attributes.tangent,d=!!i.morphAttributes.position,f=!!i.morphAttributes.normal,m=!!i.morphAttributes.color,g=n.toneMapped?p.toneMapping:0,_=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,x=void 0!==_?_.length:0,b=V.get(n),w=u.state.lights;if(!0===R&&(!0===L||t!==v)){const e=t===v&&n.id===A;nt.setState(n,t,e)}let M=!1;n.version===b.__version?b.needsLights&&b.lightsStateVersion!==w.state.version||b.outputEncoding!==o||r.isInstancedMesh&&!1===b.instancing?M=!0:r.isInstancedMesh||!0!==b.instancing?r.isSkinnedMesh&&!1===b.skinning?M=!0:r.isSkinnedMesh||!0!==b.skinning?b.envMap!==l||n.fog&&b.fog!==s?M=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===nt.numPlanes&&b.numIntersection===nt.numIntersection?(b.vertexAlphas!==h||b.vertexTangents!==c||b.morphTargets!==d||b.morphNormals!==f||b.morphColors!==m||b.toneMapping!==g||!0===G.isWebGL2&&b.morphTargetsCount!==x)&&(M=!0):M=!0:M=!0:M=!0:(M=!0,b.__version=n.version);let T=b.currentProgram;!0===M&&(T=St(n,e,r));let P=!1,E=!1,k=!1;const D=T.getUniforms(),z=b.uniforms;H.useProgram(T.program)&&(P=!0,E=!0,k=!0);n.id!==A&&(A=n.id,E=!0);if(P||v!==t){if(D.setValue(dt,"projectionMatrix",t.projectionMatrix),G.logarithmicDepthBuffer&&D.setValue(dt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),v!==t&&(v=t,E=!0,k=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=D.map.cameraPosition;void 0!==e&&e.setValue(dt,I.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&D.setValue(dt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&D.setValue(dt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){D.setOptional(dt,r,"bindMatrix"),D.setOptional(dt,r,"bindMatrixInverse");const t=r.skeleton;t&&(G.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),D.setValue(dt,"boneTexture",t.boneTexture,Y),D.setValue(dt,"boneTextureSize",t.boneTextureSize)):D.setOptional(dt,t,"boneMatrices"))}const O=i.morphAttributes;(void 0!==O.position||void 0!==O.normal||void 0!==O.color&&!0===G.isWebGL2)&&at.update(r,i,n,T);(E||b.receiveShadow!==r.receiveShadow)&&(b.receiveShadow=r.receiveShadow,D.setValue(dt,"receiveShadow",r.receiveShadow));E&&(D.setValue(dt,"toneMappingExposure",p.toneMappingExposure),b.needsLights&&(F=k,(N=z).ambientLightColor.needsUpdate=F,N.lightProbe.needsUpdate=F,N.directionalLights.needsUpdate=F,N.directionalLightShadows.needsUpdate=F,N.pointLights.needsUpdate=F,N.pointLightShadows.needsUpdate=F,N.spotLights.needsUpdate=F,N.spotLightShadows.needsUpdate=F,N.rectAreaLights.needsUpdate=F,N.hemisphereLights.needsUpdate=F),s&&n.fog&&tt.refreshFogUniforms(z,s),tt.refreshMaterialUniforms(z,n,C,S,B),ym.upload(dt,b.uniformsList,z,Y));var N,F;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ym.upload(dt,b.uniformsList,z,Y),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&D.setValue(dt,"center",r.center);return D.setValue(dt,"modelViewMatrix",r.modelViewMatrix),D.setValue(dt,"normalMatrix",r.normalMatrix),D.setValue(dt,"modelMatrix",r.matrixWorld),T}(t,e,i,n,r);H.setMaterial(n,a);let l=i.index;const h=i.attributes.position;if(null===l){if(void 0===h||0===h.count)return}else if(0===l.count)return;let c,d=1;!0===n.wireframe&&(l=Q.getWireframeAttribute(i),d=2),ct.setup(r,n,o,i,l);let f=ot;null!==l&&(c=Z.get(l),f=lt,f.setIndex(c));const m=null!==l?l.count:h.count,g=i.drawRange.start*d,_=i.drawRange.count*d,x=null!==s?s.start*d:0,b=null!==s?s.count*d:1/0,w=Math.max(g,x),M=Math.min(m,g+_,x+b)-1,T=Math.max(0,M-w+1);if(0!==T){if(r.isMesh)!0===n.wireframe?(H.setLineWidth(n.wireframeLinewidth*q()),f.setMode(dt.LINES)):f.setMode(dt.TRIANGLES);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),H.setLineWidth(t*q()),r.isLineSegments?f.setMode(dt.LINES):r.isLineLoop?f.setMode(dt.LINE_LOOP):f.setMode(dt.LINE_STRIP)}else r.isPoints?f.setMode(dt.POINTS):r.isSprite&&f.setMode(dt.TRIANGLES);if(r.isInstancedMesh)f.renderInstances(w,T,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);f.renderInstances(w,T,t)}else f.render(w,T)}},this.compile=function(t,e){u=it.get(t),u.init(),m.push(u),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(u.pushLight(t),t.castShadow&&u.pushShadow(t))})),u.setupLights(p.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){St(i[n],t,e)}else St(i,t,e)})),m.pop(),u=null};let xt=null;function yt(){vt.stop()}function At(){vt.start()}const vt=new td;function bt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)u.pushLight(t),t.castShadow&&u.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||O.intersectsSprite(t)){n&&I.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N);const e=J.update(t),r=t.material;r.visible&&d.push(t,e,r,i,I.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==X.render.frame&&(t.skeleton.update(),t.skeleton.frame=X.render.frame),!t.frustumCulled||O.intersectsObject(t))){n&&I.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N);const e=J.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,a=n.length;s<a;s++){const a=n[s],o=r[a.materialIndex];o&&o.visible&&d.push(t,e,o,i,I.z,a)}}else r.visible&&d.push(t,e,r,i,I.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)bt(r[t],e,i,n)}function wt(t,e,i,n){const r=t.opaque,a=t.transmissive,o=t.transparent;u.setupLightsView(i),a.length>0&&function(t,e,i){const n=G.isWebGL2;null===B&&(B=new mc(1,1,{generateMipmaps:!0,type:null!==ht.convert(wh)?wh:yh,minFilter:xh,samples:n&&!0===s?4:0}));p.getDrawingBufferSize(F),n?B.setSize(F.x,F.y):B.setSize($h(F.x),$h(F.y));const r=p.getRenderTarget();p.setRenderTarget(B),p.clear();const a=p.toneMapping;p.toneMapping=0,Mt(t,e,i),p.toneMapping=a,Y.updateMultisampleRenderTarget(B),Y.updateRenderTargetMipmap(B),p.setRenderTarget(r)}(r,e,i),n&&H.viewport(b.copy(n)),r.length>0&&Mt(r,e,i),a.length>0&&Mt(a,e,i),o.length>0&&Mt(o,e,i),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1)}function Mt(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===n?s.material:n,h=s.group;a.layers.test(i.layers)&&Tt(a,e,i,o,l,h)}}function Tt(t,e,i,n,r,s){t.onBeforeRender(p,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(p,e,i,n,t,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,p.renderBufferDirect(i,e,n,r,t,s),r.side=0,r.needsUpdate=!0,p.renderBufferDirect(i,e,n,r,t,s),r.side=2):p.renderBufferDirect(i,e,n,r,t,s),t.onAfterRender(p,e,i,n,r,s)}function St(t,e,i){!0!==e.isScene&&(e=j);const n=V.get(t),r=u.state.lights,s=u.state.shadowsArray,a=r.state.version,o=K.getParameters(t,r.state,s,e,i),l=K.getProgramCacheKey(o);let h=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?W:$).get(t.envMap||n.environment),void 0===h&&(t.addEventListener("dispose",_t),h=new Map,n.programs=h);let c=h.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===a)return Ct(t,o),c}else o.uniforms=K.getUniforms(t),t.onBuild(i,o,p),t.onBeforeCompile(o,p),c=K.acquireProgram(o,l),h.set(l,c),n.uniforms=o.uniforms;const d=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(d.clippingPlanes=nt.uniform),Ct(t,o),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotShadowMatrix.value=r.state.spotShadowMatrix,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix);const f=c.getUniforms(),m=ym.seqWithValue(f.seq,d);return n.currentProgram=c,n.uniformsList=m,c}function Ct(t,e){const i=V.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}vt.setAnimationLoop((function(t){xt&&xt(t)})),"undefined"!=typeof window&&vt.setContext(window),this.setAnimationLoop=function(t){xt=t,mt.setAnimationLoop(t),null===t?vt.stop():vt.start()},mt.addEventListener("sessionstart",yt),mt.addEventListener("sessionend",At),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===mt.enabled&&!0===mt.isPresenting&&(!0===mt.cameraAutoUpdate&&mt.updateCamera(e),e=mt.getCamera()),!0===t.isScene&&t.onBeforeRender(p,t,e,y),u=it.get(t,m.length),u.init(),m.push(u),N.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),O.setFromProjectionMatrix(N),L=this.localClippingEnabled,R=nt.init(this.clippingPlanes,L,e),d=et.get(t,f.length),d.init(),f.push(d),bt(t,e,0,p.sortObjects),d.finish(),!0===p.sortObjects&&d.sort(P,E),!0===R&&nt.beginShadows();const i=u.state.shadowsArray;if(rt.render(i,t,e),!0===R&&nt.endShadows(),!0===this.info.autoReset&&this.info.reset(),st.render(d,t),u.setupLights(p.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];wt(d,t,n,n.viewport)}}else wt(d,t,e);null!==y&&(Y.updateMultisampleRenderTarget(y),Y.updateRenderTargetMipmap(y)),!0===t.isScene&&t.onAfterRender(p,t,e),ct.resetDefaultState(),A=-1,v=null,m.pop(),u=m.length>0?m[m.length-1]:null,f.pop(),d=f.length>0?f[f.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(t,e,i){V.get(t.texture).__webglTexture=e,V.get(t.depthTexture).__webglTexture=i;const n=V.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===U.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=V.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){y=t,_=e,x=i;let n=!0;if(t){const e=V.get(t);void 0!==e.__useDefaultFramebuffer?(H.bindFramebuffer(dt.FRAMEBUFFER,null),n=!1):void 0===e.__webglFramebuffer?Y.setupRenderTarget(t):e.__hasExternalTextures&&Y.rebindTextures(t,V.get(t.texture).__webglTexture,V.get(t.depthTexture).__webglTexture)}let r=null,s=!1,a=!1;if(t){const i=t.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(a=!0);const n=V.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],s=!0):r=G.isWebGL2&&t.samples>0&&!1===Y.useMultisampledRTT(t)?V.get(t).__webglMultisampledFramebuffer:n,b.copy(t.viewport),w.copy(t.scissor),M=t.scissorTest}else b.copy(k).multiplyScalar(C).floor(),w.copy(D).multiplyScalar(C).floor(),M=z;if(H.bindFramebuffer(dt.FRAMEBUFFER,r)&&G.drawBuffers&&n&&H.drawBuffers(t,r),H.viewport(b),H.scissor(w),H.setScissorTest(M),s){const n=V.get(t.texture);dt.framebufferTexture2D(dt.FRAMEBUFFER,dt.COLOR_ATTACHMENT0,dt.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.__webglTexture,i)}else if(a){const n=V.get(t.texture),r=e||0;dt.framebufferTextureLayer(dt.FRAMEBUFFER,dt.COLOR_ATTACHMENT0,n.__webglTexture,i||0,r)}A=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=V.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){H.bindFramebuffer(dt.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==Th&&ht.convert(o)!==dt.getParameter(dt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===wh&&(U.has("EXT_color_buffer_half_float")||G.isWebGL2&&U.has("EXT_color_buffer_float"));if(!(l===yh||ht.convert(l)===dt.getParameter(dt.IMPLEMENTATION_COLOR_READ_TYPE)||l===bh&&(G.isWebGL2||U.has("OES_texture_float")||U.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");dt.checkFramebufferStatus(dt.FRAMEBUFFER)===dt.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&dt.readPixels(e,i,n,r,ht.convert(o),ht.convert(l),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==y?V.get(y).__webglFramebuffer:null;H.bindFramebuffer(dt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);Y.setTexture2D(e,0),dt.copyTexSubImage2D(dt.TEXTURE_2D,i,0,0,t.x,t.y,r,s),H.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,a=ht.convert(i.format),o=ht.convert(i.type);Y.setTexture2D(i,0),dt.pixelStorei(dt.UNPACK_FLIP_Y_WEBGL,i.flipY),dt.pixelStorei(dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),dt.pixelStorei(dt.UNPACK_ALIGNMENT,i.unpackAlignment),e.isDataTexture?dt.texSubImage2D(dt.TEXTURE_2D,n,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?dt.compressedTexSubImage2D(dt.TEXTURE_2D,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):dt.texSubImage2D(dt.TEXTURE_2D,n,t.x,t.y,a,o,e.image),0===n&&i.generateMipmaps&&dt.generateMipmap(dt.TEXTURE_2D),H.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(p.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=ht.convert(n.format),h=ht.convert(n.type);let c;if(n.isData3DTexture)Y.setTexture3D(n,0),c=dt.TEXTURE_3D;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Y.setTexture2DArray(n,0),c=dt.TEXTURE_2D_ARRAY}dt.pixelStorei(dt.UNPACK_FLIP_Y_WEBGL,n.flipY),dt.pixelStorei(dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),dt.pixelStorei(dt.UNPACK_ALIGNMENT,n.unpackAlignment);const d=dt.getParameter(dt.UNPACK_ROW_LENGTH),u=dt.getParameter(dt.UNPACK_IMAGE_HEIGHT),f=dt.getParameter(dt.UNPACK_SKIP_PIXELS),m=dt.getParameter(dt.UNPACK_SKIP_ROWS),g=dt.getParameter(dt.UNPACK_SKIP_IMAGES),_=i.isCompressedTexture?i.mipmaps[0]:i.image;dt.pixelStorei(dt.UNPACK_ROW_LENGTH,_.width),dt.pixelStorei(dt.UNPACK_IMAGE_HEIGHT,_.height),dt.pixelStorei(dt.UNPACK_SKIP_PIXELS,t.min.x),dt.pixelStorei(dt.UNPACK_SKIP_ROWS,t.min.y),dt.pixelStorei(dt.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?dt.texSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,h,_.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),dt.compressedTexSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,_.data)):dt.texSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,h,_),dt.pixelStorei(dt.UNPACK_ROW_LENGTH,d),dt.pixelStorei(dt.UNPACK_IMAGE_HEIGHT,u),dt.pixelStorei(dt.UNPACK_SKIP_PIXELS,f),dt.pixelStorei(dt.UNPACK_SKIP_ROWS,m),dt.pixelStorei(dt.UNPACK_SKIP_IMAGES,g),0===r&&n.generateMipmaps&&dt.generateMipmap(c),H.unbindTexture()},this.initTexture=function(t){Y.setTexture2D(t,0),H.unbindTexture()},this.resetState=function(){_=0,x=0,y=null,H.reset(),ct.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}up.prototype.isWebGLRenderer=!0;class fp{constructor(t,e=1,i=1e3){this.name="",this.color=new ac(t),this.near=e,this.far=i}clone(){return new fp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}fp.prototype.isFog=!0;class mp extends Td{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}mp.prototype.isScene=!0;class pp extends Nd{constructor(t){super(),this.type="LineBasicMaterial",this.color=new ac(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}pp.prototype.isLineBasicMaterial=!0;const gp=new gc,_p=new gc,xp=new Vc,yp=new Wd,Ap=new Fc;class vp extends Td{constructor(t=new Od,e=new pp){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)gp.fromBufferAttribute(e,t-1),_p.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=gp.distanceTo(_p);t.setAttribute("lineDistance",new od(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ap.copy(i.boundingSphere),Ap.applyMatrix4(n),Ap.radius+=r,!1===t.ray.intersectsSphere(Ap))return;xp.copy(n).invert(),yp.copy(t.ray).applyMatrix4(xp);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new gc,h=new gc,c=new gc,d=new gc,u=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){for(let i=Math.max(0,s.start),a=Math.min(n.count,s.start+s.count)-1;i<a;i+=u){const s=n.getX(i),a=n.getX(i+1);l.fromBufferAttribute(r,s),h.fromBufferAttribute(r,a);if(yp.distanceSqToSegment(l,h,d,c)>o)continue;d.applyMatrix4(this.matrixWorld);const u=t.ray.origin.distanceTo(d);u<t.near||u>t.far||e.push({distance:u,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=u){l.fromBufferAttribute(r,i),h.fromBufferAttribute(r,i+1);if(yp.distanceSqToSegment(l,h,d,c)>o)continue;d.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(d);n<t.near||n>t.far||e.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}vp.prototype.isLine=!0;const bp=new gc,wp=new gc;class Mp extends vp{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)bp.fromBufferAttribute(e,t),wp.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+bp.distanceTo(wp);t.setAttribute("lineDistance",new od(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Mp.prototype.isLineSegments=!0;(class extends vp{constructor(t,e){super(t,e),this.type="LineLoop"}}).prototype.isLineLoop=!0;class Tp extends Nd{constructor(t){super(),this.type="PointsMaterial",this.color=new ac(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}Tp.prototype.isPointsMaterial=!0;const Sp=new Vc,Cp=new Wd,Pp=new Fc,Ep=new gc;class kp extends Td{constructor(t=new Od,e=new Tp){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Pp.copy(i.boundingSphere),Pp.applyMatrix4(n),Pp.radius+=r,!1===t.ray.intersectsSphere(Pp))return;Sp.copy(n).invert(),Cp.copy(t.ray).applyMatrix4(Sp);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position;if(null!==r){for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);Ep.fromBufferAttribute(a,s),Dp(Ep,s,o,n,t,e,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(a.count,s.start+s.count);i<r;i++)Ep.fromBufferAttribute(a,i),Dp(Ep,i,o,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Dp(t,e,i,n,r,s,a){const o=Cp.distanceSqToPoint(t);if(o<i){const i=new gc;Cp.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:a})}}kp.prototype.isPoints=!0;class zp extends uc{constructor(t=null,e=1,i=1,n,r,s,a,o,l=1003,h=1003,c,d){super(null,s,a,o,l,h,n,r,c,d),this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}zp.prototype.isDataTexture=!0;class Op extends uc{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.needsUpdate=!0}}Op.prototype.isCanvasTexture=!0;class Rp extends Od{constructor(t=1,e=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const r=[],s=[],a=[],o=[],l=new gc,h=new Zh;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,c=3;r<=e;r++,c+=3){const d=i+r/e*n;l.x=t*Math.cos(d),l.y=t*Math.sin(d),s.push(l.x,l.y,l.z),a.push(0,0,1),h.x=(s[c]/t+1)/2,h.y=(s[c+1]/t+1)/2,o.push(h.x,h.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new od(s,3)),this.setAttribute("normal",new od(a,3)),this.setAttribute("uv",new od(o,2))}static fromJSON(t){return new Rp(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Lp extends Od{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;n=Math.floor(n),r=Math.floor(r);const h=[],c=[],d=[],u=[];let f=0;const m=[],p=i/2;let g=0;function _(i){const r=f,s=new Zh,m=new gc;let _=0;const x=!0===i?t:e,y=!0===i?1:-1;for(let t=1;t<=n;t++)c.push(0,p*y,0),d.push(0,y,0),u.push(.5,.5),f++;const A=f;for(let t=0;t<=n;t++){const e=t/n*o+a,i=Math.cos(e),r=Math.sin(e);m.x=x*r,m.y=p*y,m.z=x*i,c.push(m.x,m.y,m.z),d.push(0,y,0),s.x=.5*i+.5,s.y=.5*r*y+.5,u.push(s.x,s.y),f++}for(let t=0;t<n;t++){const e=r+t,n=A+t;!0===i?h.push(n,n+1,e):h.push(n+1,n,e),_+=3}l.addGroup(g,_,!0===i?1:2),g+=_}!function(){const s=new gc,_=new gc;let x=0;const y=(e-t)/i;for(let l=0;l<=r;l++){const h=[],g=l/r,x=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*o+a,l=Math.sin(r),m=Math.cos(r);_.x=x*l,_.y=-g*i+p,_.z=x*m,c.push(_.x,_.y,_.z),s.set(l,y,m).normalize(),d.push(s.x,s.y,s.z),u.push(e,1-g),h.push(f++)}m.push(h)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=m[e][t],n=m[e+1][t],r=m[e+1][t+1],s=m[e][t+1];h.push(i,n,s),h.push(n,r,s),x+=6}l.addGroup(g,x,0),g+=x}(),!1===s&&(t>0&&_(!0),e>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new od(c,3)),this.setAttribute("normal",new od(d,3)),this.setAttribute("uv",new od(u,2))}static fromJSON(t){return new Lp(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Bp extends Od{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const r=[],s=[];function a(t,e,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const a=t.clone().lerp(i,n/r),o=e.clone().lerp(i,n/r),l=r-n;for(let t=0;t<=l;t++)s[n][t]=0===t&&n===r?a:a.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(o(s[t][i+1]),o(s[t+1][i]),o(s[t][i])):(o(s[t][i+1]),o(s[t+1][i+1]),o(s[t+1][i]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function h(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new gc,n=new gc,r=new gc;for(let s=0;s<e.length;s+=3)l(e[s+0],i),l(e[s+1],n),l(e[s+2],r),a(i,n,r,t)}(n),function(t){const e=new gc;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new gc;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=c(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(n,1-a)}var e;(function(){const t=new gc,e=new gc,i=new gc,n=new gc,a=new Zh,o=new Zh,l=new Zh;for(let d=0,u=0;d<r.length;d+=9,u+=6){t.set(r[d+0],r[d+1],r[d+2]),e.set(r[d+3],r[d+4],r[d+5]),i.set(r[d+6],r[d+7],r[d+8]),a.set(s[u+0],s[u+1]),o.set(s[u+2],s[u+3]),l.set(s[u+4],s[u+5]),n.copy(t).add(e).add(i).divideScalar(3);const f=c(n);h(a,u+0,t,f),h(o,u+2,e,f),h(l,u+4,i,f)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),a=Math.min(e,i,n);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new od(r,3)),this.setAttribute("normal",new od(r.slice(),3)),this.setAttribute("uv",new od(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new Bp(t.vertices,t.indices,t.radius,t.details)}}new gc,new gc,new gc,new au;class Np{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let a,o=0,l=r-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),a=i[n]-s,a<0)o=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const h=i[n];return(n+(s-h)/(i[n+1]-h))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),a=this.getPoint(r),o=e||(s.isVector2?new Zh:new gc);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new gc,n=[],r=[],s=[],a=new gc,o=new Vc;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new gc)}r[0]=new gc,s[0]=new gc;let l=Number.MAX_VALUE;const h=Math.abs(n[0].x),c=Math.abs(n[0].y),d=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),d<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(n[e-1],n[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(Hh(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(Hh(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Fp extends Np{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const i=e||new Zh,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Fp.prototype.isEllipseCurve=!0;class Ip extends Fp{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.type="ArcCurve"}}function jp(){let t=0,e=0,i=0,n=0;function r(r,s,a,o){t=r,e=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,a,o){let l=(e-t)/s-(i-t)/(s+a)+(i-e)/a,h=(i-e)/a-(n-e)/(a+o)+(n-i)/o;l*=a,h*=a,r(e,i,l,h)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}Ip.prototype.isArcCurve=!0;const qp=new gc,Up=new jp,Gp=new jp,Hp=new jp;class Xp extends Np{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new gc){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?a=n[(l-1)%r]:(qp.subVectors(n[0],n[1]).add(n[0]),a=qp);const c=n[l%r],d=n[(l+1)%r];if(this.closed||l+2<r?o=n[(l+2)%r]:(qp.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=qp),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(d),t),n=Math.pow(d.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),Up.initNonuniformCatmullRom(a.x,c.x,d.x,o.x,e,i,n),Gp.initNonuniformCatmullRom(a.y,c.y,d.y,o.y,e,i,n),Hp.initNonuniformCatmullRom(a.z,c.z,d.z,o.z,e,i,n)}else"catmullrom"===this.curveType&&(Up.initCatmullRom(a.x,c.x,d.x,o.x,this.tension),Gp.initCatmullRom(a.y,c.y,d.y,o.y,this.tension),Hp.initCatmullRom(a.z,c.z,d.z,o.z,this.tension));return i.set(Up.calc(h),Gp.calc(h),Hp.calc(h)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new gc).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Vp(t,e,i,n,r){const s=.5*(n-e),a=.5*(r-i),o=t*t;return(2*i-2*n+s+a)*(t*o)+(-3*i+3*n-2*s-a)*o+s*t+i}function Yp(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function $p(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}Xp.prototype.isCatmullRomCurve3=!0;class Wp extends Np{constructor(t=new Zh,e=new Zh,i=new Zh,n=new Zh){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Zh){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set($p(t,n.x,r.x,s.x,a.x),$p(t,n.y,r.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Wp.prototype.isCubicBezierCurve=!0;class Zp extends Np{constructor(t=new gc,e=new gc,i=new gc,n=new gc){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new gc){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set($p(t,n.x,r.x,s.x,a.x),$p(t,n.y,r.y,s.y,a.y),$p(t,n.z,r.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Zp.prototype.isCubicBezierCurve3=!0;class Qp extends Np{constructor(t=new Zh,e=new Zh){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Zh){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Zh;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Qp.prototype.isLineCurve=!0;class Jp extends Np{constructor(t=new Zh,e=new Zh,i=new Zh){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Zh){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Yp(t,n.x,r.x,s.x),Yp(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Jp.prototype.isQuadraticBezierCurve=!0;class Kp extends Np{constructor(t=new gc,e=new gc,i=new gc){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new gc){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Yp(t,n.x,r.x,s.x),Yp(t,n.y,r.y,s.y),Yp(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Kp.prototype.isQuadraticBezierCurve3=!0;class tg extends Np{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Zh){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],h=n[s>n.length-2?n.length-1:s+1],c=n[s>n.length-3?n.length-1:s+2];return i.set(Vp(a,o.x,l.x,h.x,c.x),Vp(a,o.y,l.y,h.y,c.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Zh).fromArray(i))}return this}}tg.prototype.isSplineCurve=!0;var eg=Object.freeze({__proto__:null,ArcCurve:Ip,CatmullRomCurve3:Xp,CubicBezierCurve:Wp,CubicBezierCurve3:Zp,EllipseCurve:Fp,LineCurve:Qp,LineCurve3:class extends Np{constructor(t=new gc,e=new gc){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new gc){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:Jp,QuadraticBezierCurve3:Kp,SplineCurve:tg});class ig extends Np{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Qp(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const n=o[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new eg[i.type]).fromJSON(i))}return this}}class ng extends ig{constructor(t){super(),this.type="Path",this.currentPoint=new Zh,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new Qp(this.currentPoint.clone(),new Zh(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new Jp(this.currentPoint.clone(),new Zh(t,e),new Zh(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const a=new Wp(this.currentPoint.clone(),new Zh(t,e),new Zh(i,n),new Zh(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new tg(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,a,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,n,r,s,a,o),this}absellipse(t,e,i,n,r,s,a,o){const l=new Fp(t,e,i,n,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class rg extends ng{constructor(t){super(t),this.uuid=Gh(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new ng).fromJSON(i))}return this}}const sg=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=ag(t,0,r,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,h,c,d,u,f;if(n&&(s=function(t,e,i,n){const r=[];let s,a,o,l,h;for(s=0,a=e.length;s<a;s++)o=e[s]*n,l=s<a-1?e[s+1]*n:t.length,h=ag(t,o,l,n,!1),h===h.next&&(h.steiner=!0),r.push(_g(h));for(r.sort(fg),s=0;s<r.length;s++)mg(r[s],i),i=og(i,i.next);return i}(t,e,s,i)),t.length>80*i){o=h=t[0],l=c=t[1];for(let e=i;e<r;e+=i)d=t[e],u=t[e+1],d<o&&(o=d),u<l&&(l=u),d>h&&(h=d),u>c&&(c=u);f=Math.max(h-o,c-l),f=0!==f?1/f:0}return lg(s,a,i,o,l,f),a};function ag(t,e,i,n,r){let s,a;if(r===function(t,e,i,n){let r=0;for(let s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)a=Cg(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=Cg(s,t[s],t[s+1],a);return a&&vg(a,a.next)&&(Pg(a),a=a.next),a}function og(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!vg(n,n.next)&&0!==Ag(n.prev,n,n.next))n=n.next;else{if(Pg(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function lg(t,e,i,n,r,s,a){if(!t)return;!a&&s&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=gg(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,a,o,l,h=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ,n);e++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(a>1)}(r)}(t,n,r,s);let o,l,h=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?cg(t,n,r,s):hg(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),Pg(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?lg(t=dg(og(t),e,i),e,i,n,r,s,2):2===a&&ug(t,e,i,n,r,s):lg(og(t),e,i,n,r,s,1);break}}function hg(t){const e=t.prev,i=t,n=t.next;if(Ag(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(xg(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Ag(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function cg(t,e,i,n){const r=t.prev,s=t,a=t.next;if(Ag(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,h=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,c=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,d=gg(o,l,e,i,n),u=gg(h,c,e,i,n);let f=t.prevZ,m=t.nextZ;for(;f&&f.z>=d&&m&&m.z<=u;){if(f!==t.prev&&f!==t.next&&xg(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&Ag(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,m!==t.prev&&m!==t.next&&xg(r.x,r.y,s.x,s.y,a.x,a.y,m.x,m.y)&&Ag(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;f&&f.z>=d;){if(f!==t.prev&&f!==t.next&&xg(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&Ag(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;m&&m.z<=u;){if(m!==t.prev&&m!==t.next&&xg(r.x,r.y,s.x,s.y,a.x,a.y,m.x,m.y)&&Ag(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function dg(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!vg(r,s)&&bg(r,n,n.next,s)&&Tg(r,s)&&Tg(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),Pg(n),Pg(n.next),n=t=s),n=n.next}while(n!==t);return og(n)}function ug(t,e,i,n,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&yg(a,t)){let o=Sg(a,t);return a=og(a,a.next),o=og(o,o.next),lg(a,e,i,n,r,s),void lg(o,e,i,n,r,s)}t=t.next}a=a.next}while(a!==t)}function fg(t,e){return t.x-e.x}function mg(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let s,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>a){if(a=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===a)return s;const o=s,l=s.x,h=s.y;let c,d=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&xg(r<h?n:a,r,l,h,r<h?a:n,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(n-i.x),Tg(i,t)&&(c<d||c===d&&(i.x>s.x||i.x===s.x&&pg(s,i)))&&(s=i,d=c)),i=i.next}while(i!==o);return s}(t,e),e){const i=Sg(e,t);og(e,e.next),og(i,i.next)}}function pg(t,e){return Ag(t.prev,t,e.prev)<0&&Ag(e.next,t,t.next)<0}function gg(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _g(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function xg(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function yg(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&bg(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Tg(t,e)&&Tg(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Ag(t.prev,t,e.prev)||Ag(t,e.prev,e))||vg(t,e)&&Ag(t.prev,t,t.next)>0&&Ag(e.prev,e,e.next)>0)}function Ag(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function vg(t,e){return t.x===e.x&&t.y===e.y}function bg(t,e,i,n){const r=Mg(Ag(t,e,i)),s=Mg(Ag(t,e,n)),a=Mg(Ag(i,n,t)),o=Mg(Ag(i,n,e));return r!==s&&a!==o||(!(0!==r||!wg(t,i,e))||(!(0!==s||!wg(t,n,e))||(!(0!==a||!wg(i,t,n))||!(0!==o||!wg(i,e,n)))))}function wg(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Mg(t){return t>0?1:t<0?-1:0}function Tg(t,e){return Ag(t.prev,t,t.next)<0?Ag(t,e,t.next)>=0&&Ag(t,t.prev,e)>=0:Ag(t,e,t.prev)<0||Ag(t,t.next,e)<0}function Sg(t,e){const i=new Eg(t.i,t.x,t.y),n=new Eg(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function Cg(t,e,i,n){const r=new Eg(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Pg(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Eg(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class kg{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return kg.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];Dg(t),zg(i,t);let s=t.length;e.forEach(Dg);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,zg(i,e[t]);const a=sg(i,n);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function Dg(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function zg(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class Og extends Od{constructor(t=new rg([new Zh(.5,.5),new Zh(-.5,.5),new Zh(-.5,-.5),new Zh(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++){s(t[e])}function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,d=void 0!==e.bevelSize?e.bevelSize:c-.1,u=void 0!==e.bevelOffset?e.bevelOffset:0,f=void 0!==e.bevelSegments?e.bevelSegments:3;const m=e.extrudePath,p=void 0!==e.UVGenerator?e.UVGenerator:Rg;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,_,x,y,A,v=!1;m&&(g=m.getSpacedPoints(o),v=!0,h=!1,_=m.computeFrenetFrames(o,!1),x=new gc,y=new gc,A=new gc),h||(f=0,c=0,d=0,u=0);const b=t.extractPoints(a);let w=b.shape;const M=b.holes;if(!kg.isClockWise(w)){w=w.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];kg.isClockWise(e)&&(M[t]=e.reverse())}}const T=kg.triangulateShape(w,M),S=w;for(let t=0,e=M.length;t<e;t++){const e=M[t];w=w.concat(e)}function C(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const P=w.length,E=T.length;function k(t,e,i){let n,r,s;const a=t.x-e.x,o=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=a*a+o*o,d=a*h-o*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(c),u=Math.sqrt(l*l+h*h),f=e.x-o/d,m=e.y+a/d,p=((i.x-h/u-f)*h-(i.y+l/u-m)*l)/(a*h-o*l);n=f+a*p-t.x,r=m+o*p-t.y;const g=n*n+r*r;if(g<=2)return new Zh(n,r);s=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(h)&&(t=!0),t?(n=-o,r=a,s=Math.sqrt(c)):(n=a,r=o,s=Math.sqrt(c/2))}return new Zh(n/s,r/s)}const D=[];for(let t=0,e=S.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),D[t]=k(S[t],S[i],S[n]);const z=[];let O,R=D.concat();for(let t=0,e=M.length;t<e;t++){const e=M[t];O=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),O[t]=k(e[t],e[n],e[r]);z.push(O),R=R.concat(O)}for(let t=0;t<f;t++){const e=t/f,i=c*Math.cos(e*Math.PI/2),n=d*Math.sin(e*Math.PI/2)+u;for(let t=0,e=S.length;t<e;t++){const e=C(S[t],D[t],n);N(e.x,e.y,-i)}for(let t=0,e=M.length;t<e;t++){const e=M[t];O=z[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],O[t],n);N(r.x,r.y,-i)}}}const L=d+u;for(let t=0;t<P;t++){const e=h?C(w[t],R[t],L):w[t];v?(y.copy(_.normals[0]).multiplyScalar(e.x),x.copy(_.binormals[0]).multiplyScalar(e.y),A.copy(g[0]).add(y).add(x),N(A.x,A.y,A.z)):N(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<P;e++){const i=h?C(w[e],R[e],L):w[e];v?(y.copy(_.normals[t]).multiplyScalar(i.x),x.copy(_.binormals[t]).multiplyScalar(i.y),A.copy(g[t]).add(y).add(x),N(A.x,A.y,A.z)):N(i.x,i.y,l/o*t)}for(let t=f-1;t>=0;t--){const e=t/f,i=c*Math.cos(e*Math.PI/2),n=d*Math.sin(e*Math.PI/2)+u;for(let t=0,e=S.length;t<e;t++){const e=C(S[t],D[t],n);N(e.x,e.y,l+i)}for(let t=0,e=M.length;t<e;t++){const e=M[t];O=z[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],O[t],n);v?N(r.x,r.y+g[o-1].y,g[o-1].x+i):N(r.x,r.y,l+i)}}}function B(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=o+2*f;t<i;t++){const i=P*t,s=P*(t+1);I(e+n+i,e+r+i,e+r+s,e+n+s)}}}function N(t,e,i){s.push(t),s.push(e),s.push(i)}function F(t,e,r){j(t),j(e),j(r);const s=n.length/3,a=p.generateTopUV(i,n,s-3,s-2,s-1);q(a[0]),q(a[1]),q(a[2])}function I(t,e,r,s){j(t),j(e),j(s),j(e),j(r),j(s);const a=n.length/3,o=p.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);q(o[0]),q(o[1]),q(o[3]),q(o[1]),q(o[2]),q(o[3])}function j(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function q(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(h){let t=0,e=P*t;for(let t=0;t<E;t++){const i=T[t];F(i[2]+e,i[1]+e,i[0]+e)}t=o+2*f,e=P*t;for(let t=0;t<E;t++){const i=T[t];F(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<E;t++){const e=T[t];F(e[2],e[1],e[0])}for(let t=0;t<E;t++){const e=T[t];F(e[0]+P*o,e[1]+P*o,e[2]+P*o)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;B(S,e),e+=S.length;for(let t=0,i=M.length;t<i;t++){const i=M[t];B(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new od(n,3)),this.setAttribute("uv",new od(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new eg[n.type]).fromJSON(n)),new Og(i,t.options)}}const Rg={generateTopUV:function(t,e,i,n,r){const s=e[3*i],a=e[3*i+1],o=e[3*n],l=e[3*n+1],h=e[3*r],c=e[3*r+1];return[new Zh(s,a),new Zh(o,l),new Zh(h,c)]},generateSideWallUV:function(t,e,i,n,r,s){const a=e[3*i],o=e[3*i+1],l=e[3*i+2],h=e[3*n],c=e[3*n+1],d=e[3*n+2],u=e[3*r],f=e[3*r+1],m=e[3*r+2],p=e[3*s],g=e[3*s+1],_=e[3*s+2];return Math.abs(o-c)<Math.abs(a-h)?[new Zh(a,1-l),new Zh(h,1-d),new Zh(u,1-m),new Zh(p,1-_)]:[new Zh(o,1-l),new Zh(c,1-d),new Zh(f,1-m),new Zh(g,1-_)]}};class Lg extends Bp{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Lg(t.radius,t.detail)}}class Bg extends Od{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const o=Math.min(s+a,Math.PI);let l=0;const h=[],c=new gc,d=new gc,u=[],f=[],m=[],p=[];for(let u=0;u<=i;u++){const g=[],_=u/i;let x=0;0==u&&0==s?x=.5/e:u==i&&o==Math.PI&&(x=-.5/e);for(let i=0;i<=e;i++){const o=i/e;c.x=-t*Math.cos(n+o*r)*Math.sin(s+_*a),c.y=t*Math.cos(s+_*a),c.z=t*Math.sin(n+o*r)*Math.sin(s+_*a),f.push(c.x,c.y,c.z),d.copy(c).normalize(),m.push(d.x,d.y,d.z),p.push(o+x,1-_),g.push(l++)}h.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=h[t][n+1],r=h[t][n],a=h[t+1][n],l=h[t+1][n+1];(0!==t||s>0)&&u.push(e,r,l),(t!==i-1||o<Math.PI)&&u.push(r,a,l)}this.setIndex(u),this.setAttribute("position",new od(f,3)),this.setAttribute("normal",new od(m,3)),this.setAttribute("uv",new od(p,2))}static fromJSON(t){return new Bg(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Ng extends Od{constructor(t=1,e=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],a=[],o=[],l=[],h=new gc,c=new gc,d=new gc;for(let s=0;s<=i;s++)for(let u=0;u<=n;u++){const f=u/n*r,m=s/i*Math.PI*2;c.x=(t+e*Math.cos(m))*Math.cos(f),c.y=(t+e*Math.cos(m))*Math.sin(f),c.z=e*Math.sin(m),a.push(c.x,c.y,c.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),d.subVectors(c,h).normalize(),o.push(d.x,d.y,d.z),l.push(u/n),l.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,a=(n+1)*(t-1)+e,o=(n+1)*t+e;s.push(i,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new od(a,3)),this.setAttribute("normal",new od(o,3)),this.setAttribute("uv",new od(l,2))}static fromJSON(t){return new Ng(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Fg extends Od{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,n=new gc,r=new gc;if(null!==t.index){const s=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],h=l.start;for(let t=h,o=h+l.count;t<o;t+=3)for(let o=0;o<3;o++){const l=a.getX(t+o),h=a.getX(t+(o+1)%3);n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,h),!0===Ig(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,a=s.count/3;t<a;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;n.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===Ig(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new od(e,3))}}}function Ig(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}class jg extends Nd{constructor(t){super(),this.type="ShadowMaterial",this.color=new ac(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}jg.prototype.isShadowMaterial=!0;class qg extends Nd{constructor(t){super(),this.type="SpriteMaterial",this.color=new ac(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}qg.prototype.isSpriteMaterial=!0;class Ug extends qd{constructor(t){super(t),this.type="RawShaderMaterial"}}Ug.prototype.isRawShaderMaterial=!0;class Gg extends Nd{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ac(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ac(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Zh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Gg.prototype.isMeshStandardMaterial=!0;class Hg extends Gg{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Zh(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Hh(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new ac(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ac(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ac(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}Hg.prototype.isMeshPhysicalMaterial=!0;class Xg extends Nd{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new ac(16777215),this.specular=new ac(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ac(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Zh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Xg.prototype.isMeshPhongMaterial=!0;class Vg extends Nd{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ac(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ac(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Zh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Vg.prototype.isMeshToonMaterial=!0;class Yg extends Nd{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Zh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}Yg.prototype.isMeshNormalMaterial=!0;class $g extends Nd{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new ac(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ac(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}$g.prototype.isMeshLambertMaterial=!0;class Wg extends Nd{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ac(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Zh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}Wg.prototype.isMeshMatcapMaterial=!0;class Zg extends pp{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Zg.prototype.isLineDashedMaterial=!0;const Qg={ShadowMaterial:jg,SpriteMaterial:qg,RawShaderMaterial:Ug,ShaderMaterial:qd,PointsMaterial:Tp,MeshPhysicalMaterial:Hg,MeshStandardMaterial:Gg,MeshPhongMaterial:Xg,MeshToonMaterial:Vg,MeshNormalMaterial:Yg,MeshLambertMaterial:$g,MeshDepthMaterial:Km,MeshDistanceMaterial:tp,MeshBasicMaterial:ou,MeshMatcapMaterial:Wg,LineDashedMaterial:Zg,LineBasicMaterial:pp,Material:Nd};Nd.fromType=function(t){return new Qg[t]};const Jg={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};const Kg=new class{constructor(t,e,i){const n=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===s&&void 0!==n.onStart&&n.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,o),a===o&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}};class t_{constructor(t){this.manager=void 0!==t?t:Kg,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}(class extends uc{constructor(t,e,i,n,r,s,a,o,l,h,c,d){super(null,s,a,o,l,h,n,r,c,d),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0;class e_ extends t_{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Jg.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=Kh("img");function o(){h(),Jg.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){h(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class i_ extends t_{constructor(t){super(t)}load(t,e,i,n){const r=new uc,s=new e_(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class n_ extends rd{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}n_.prototype.isInstancedBufferAttribute=!0;const r_=new Vc,s_=new Vc,a_=[],o_=new Tu;(class extends Tu{constructor(t,e,i){super(t,e),this.instanceMatrix=new n_(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(o_.geometry=this.geometry,o_.material=this.material,void 0!==o_.material)for(let r=0;r<n;r++){this.getMatrixAt(r,r_),s_.multiplyMatrices(i,r_),o_.matrixWorld=s_,o_.raycast(t,a_);for(let t=0,i=a_.length;t<i;t++){const i=a_[t];i.instanceId=r,i.object=this,e.push(i)}a_.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new n_(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class l_{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Lh,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Gh()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Gh()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Gh()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}l_.prototype.isInterleavedBuffer=!0;const h_=new gc;class c_{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)h_.x=this.getX(e),h_.y=this.getY(e),h_.z=this.getZ(e),h_.applyMatrix4(t),this.setXYZ(e,h_.x,h_.y,h_.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)h_.x=this.getX(e),h_.y=this.getY(e),h_.z=this.getZ(e),h_.applyNormalMatrix(t),this.setXYZ(e,h_.x,h_.y,h_.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)h_.x=this.getX(e),h_.y=this.getY(e),h_.z=this.getZ(e),h_.transformDirection(t),this.setXYZ(e,h_.x,h_.y,h_.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new rd(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new c_(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}let d_;c_.prototype.isInterleavedBufferAttribute=!0;const u_=new gc,f_=new gc,m_=new gc,p_=new Zh,g_=new Zh,__=new Vc,x_=new gc,y_=new gc,A_=new gc,v_=new Zh,b_=new Zh,w_=new Zh;function M_(t,e,i,n,r,s){p_.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(g_.x=s*p_.x-r*p_.y,g_.y=r*p_.x+s*p_.y):g_.copy(p_),t.copy(e),t.x+=g_.x,t.y+=g_.y,t.applyMatrix4(__)}(class extends Td{constructor(t){if(super(),this.type="Sprite",void 0===d_){d_=new Od;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new l_(t,5);d_.setIndex([0,1,2,0,2,3]),d_.setAttribute("position",new c_(e,3,0,!1)),d_.setAttribute("uv",new c_(e,2,3,!1))}this.geometry=d_,this.material=void 0!==t?t:new qg,this.center=new Zh(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),f_.setFromMatrixScale(this.matrixWorld),__.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),m_.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&f_.multiplyScalar(-m_.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;M_(x_.set(-.5,-.5,0),m_,s,f_,n,r),M_(y_.set(.5,-.5,0),m_,s,f_,n,r),M_(A_.set(.5,.5,0),m_,s,f_,n,r),v_.set(0,0),b_.set(1,0),w_.set(1,1);let a=t.ray.intersectTriangle(x_,y_,A_,!1,u_);if(null===a&&(M_(y_.set(-.5,.5,0),m_,s,f_,n,r),b_.set(0,1),a=t.ray.intersectTriangle(x_,A_,y_,!1,u_),null===a))return;const o=t.ray.origin.distanceTo(u_);o<t.near||o>t.far||e.push({distance:o,point:u_.clone(),uv:au.getUV(u_,x_,y_,A_,v_,b_,w_,new Zh),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}).prototype.isSprite=!0;const T_=new gc,S_=new fc,C_=new fc,P_=new gc,E_=new Vc;(class extends Tu{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Vc,this.bindMatrixInverse=new Vc}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new fc,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;S_.fromBufferAttribute(n.attributes.skinIndex,t),C_.fromBufferAttribute(n.attributes.skinWeight,t),T_.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=C_.getComponent(t);if(0!==n){const r=S_.getComponent(t);E_.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(P_.copy(T_).applyMatrix4(E_),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}).prototype.isSkinnedMesh=!0;(class extends Td{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;class k_ extends Td{constructor(t,e=1){super(),this.type="Light",this.color=new ac(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}k_.prototype.isLight=!0;class D_ extends k_{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(Td.DefaultUp),this.updateMatrix(),this.groundColor=new ac(e)}copy(t){return k_.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}D_.prototype.isHemisphereLight=!0;const z_=new Vc,O_=new gc,R_=new gc;class L_{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Zh(512,512),this.map=null,this.mapPass=null,this.matrix=new Vc,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Xc,this._frameExtents=new Zh(1,1),this._viewportCount=1,this._viewports=[new fc(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;O_.setFromMatrixPosition(t.matrixWorld),e.position.copy(O_),R_.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(R_),e.updateMatrixWorld(),z_.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(z_),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class B_ extends L_{constructor(){super(new Bu(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*Uh*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}B_.prototype.isSpotLightShadow=!0;(class extends k_{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(Td.DefaultUp),this.updateMatrix(),this.target=new Td,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new B_}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isSpotLight=!0;const N_=new Vc,F_=new gc,I_=new gc;class j_ extends L_{constructor(){super(new Bu(90,1,.5,500)),this._frameExtents=new Zh(4,2),this._viewportCount=6,this._viewports=[new fc(2,1,1,1),new fc(0,1,1,1),new fc(3,1,1,1),new fc(1,1,1,1),new fc(3,0,1,1),new fc(1,0,1,1)],this._cubeDirections=[new gc(1,0,0),new gc(-1,0,0),new gc(0,0,1),new gc(0,0,-1),new gc(0,1,0),new gc(0,-1,0)],this._cubeUps=[new gc(0,1,0),new gc(0,1,0),new gc(0,1,0),new gc(0,1,0),new gc(0,0,1),new gc(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),F_.setFromMatrixPosition(t.matrixWorld),i.position.copy(F_),I_.copy(i.position),I_.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(I_),i.updateMatrixWorld(),n.makeTranslation(-F_.x,-F_.y,-F_.z),N_.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(N_)}}j_.prototype.isPointLightShadow=!0;class q_ extends k_{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new j_}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}q_.prototype.isPointLight=!0;class U_ extends L_{constructor(){super(new Uu(-5,5,5,-5,.5,500))}}U_.prototype.isDirectionalLightShadow=!0;(class extends k_{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Td.DefaultUp),this.updateMatrix(),this.target=new Td,this.shadow=new U_}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isDirectionalLight=!0;class G_ extends k_{constructor(t,e){super(t,e),this.type="AmbientLight"}}G_.prototype.isAmbientLight=!0;(class extends k_{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}).prototype.isRectAreaLight=!0;class H_{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new gc)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}H_.prototype.isSphericalHarmonics3=!0;class X_ extends k_{constructor(t=new H_,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}X_.prototype.isLightProbe=!0;(class extends Od{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}).prototype.isInstancedBufferGeometry=!0;(class extends t_{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Jg.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){Jg.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}).prototype.isImageBitmapLoader=!0;(class extends X_{constructor(t,e,i=1){super(void 0,i);const n=(new ac).set(t),r=(new ac).set(e),s=new gc(n.r,n.g,n.b),a=new gc(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0;(class extends X_{constructor(t,e=1){super(void 0,e);const i=(new ac).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;(class extends l_{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;class V_{constructor(t,e,i=0,n=1/0){this.ray=new Wd(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new dd,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return $_(t,this,i,e),i.sort(Y_),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)$_(t[n],this,i,e);return i.sort(Y_),i}}function Y_(t,e){return t.distance-e.distance}function $_(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)$_(n[t],e,i,!0)}}class W_{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Z_(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Z_();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Z_(){return("undefined"==typeof performance?Date:performance).now()}class Q_{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Hh(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const J_=new Zh;class K_{constructor(t=new Zh(1/0,1/0),e=new Zh(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=J_.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return J_.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}K_.prototype.isBox2=!0;const tx=new gc,ex=new gc;class ix{constructor(t=new gc,e=new gc){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){tx.subVectors(t,this.start),ex.subVectors(this.end,this.start);const i=ex.dot(ex);let n=ex.dot(tx)/i;return e&&(n=Hh(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class nx extends Mp{constructor(t=10,e=10,i=4473924,n=8947848){i=new ac(i),n=new ac(n);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let t=0,h=0,c=-a;t<=e;t++,c+=s){o.push(-a,0,c,a,0,c),o.push(c,0,-a,c,0,a);const e=t===r?i:n;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const h=new Od;h.setAttribute("position",new od(o,3)),h.setAttribute("color",new od(l,3));super(h,new pp({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const rx=new yc;class sx extends Mp{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Od;r.setIndex(new rd(i,1)),r.setAttribute("position",new rd(n,3)),super(r,new pp({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&rx.setFromObject(this.object),rx.isEmpty())return;const e=rx.min,i=rx.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return Mp.prototype.copy.call(this,t),this.object=t.object,this}}class ax extends Mp{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Od;i.setAttribute("position",new od(e,3)),i.setAttribute("color",new od([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new pp({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new ac,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ox{constructor(){this.type="ShapePath",this.color=new ac,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new ng,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new rg;r.curves=n.curves,e.push(r)}return e}function n(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],a=e[s],o=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],o=-o,a=e[r],l=-l),t.y<i.y||t.y>a.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-o*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(a.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=a.x)return!0}}return n}const r=kg.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return i(s);let a,o,l;const h=[];if(1===s.length)return o=s[0],l=new rg,l.curves=o.curves,h.push(l),h;let c=!r(s[0].getPoints());c=t?!c:c;const d=[],u=[];let f,m,p=[],g=0;u[g]=void 0,p[g]=[];for(let e=0,i=s.length;e<i;e++)o=s[e],f=o.getPoints(),a=r(f),a=t?!a:a,a?(!c&&u[g]&&g++,u[g]={s:new rg,p:f},u[g].s.curves=o.curves,c&&g++,p[g]=[]):p[g].push({h:o,p:f[0]});if(!u[0])return i(s);if(u.length>1){let t=!1,e=0;for(let t=0,e=u.length;t<e;t++)d[t]=[];for(let i=0,r=u.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<u.length;r++)n(a.p,u[r].p)&&(i!==r&&e++,o?(o=!1,d[r].push(a)):t=!0);o&&d[i].push(a)}}e>0&&!1===t&&(p=d)}for(let t=0,e=u.length;t<e;t++){l=u[t].s,h.push(l),m=p[t];for(let t=0,e=m.length;t<e;t++)l.holes.push(m[t].h)}return h}}const lx=new Float32Array(1);new Int32Array(lx.buffer);class hx extends Og{constructor(t,e={}){const i=e.font;if(void 0===i)super();else{const n=i.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(n,e)}this.type="TextGeometry"}}var cx={0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},"ο":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"¦":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},"Τ":{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},"Π":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},"ΐ":{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"²":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"–":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},"Κ":{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},"ƒ":{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},"ό":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"»":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"©":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},"ώ":{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"«":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"∙":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"ÿ":{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},"µ":{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},"Ι":{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},"Ύ":{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"’":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"Ν":{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},"ς":{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},"Ψ":{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},"ι":{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},"Ά":{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},"ε":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},"Δ":{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"‰":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"—":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},"ρ":{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},"¯":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},"Η":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"Α":{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"…":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"ν":{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"¶":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},"β":{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},"Μ":{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},"Ό":{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"Ή":{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"•":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"¥":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},"γ":{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},"α":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"­":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"Χ":{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"†":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"°":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},"Ξ":{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "}," ":{x_min:0,x_max:0,ha:853},"Ϋ":{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},"”":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},"Ί":{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},"Β":{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},"υ":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},"χ":{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},"ί":{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},"Ζ":{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"¨":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"‹":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"„":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},"δ":{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},"έ":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},"ω":{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"´":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"±":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"ϋ":{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"§":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},"Ω":{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},"ύ":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"™":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},"ή":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},"Θ":{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"®":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},"Ε":{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"³":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},"σ":{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},"ζ":{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},"θ":{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},"Ο":{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},"Γ":{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},"Έ":{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"Ώ":{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},"Ϊ":{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"½":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},"Ρ":{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"ª":{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"΅":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},"Φ":{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"⁋":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},"Σ":{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},"›":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"£":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"¬":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},"λ":{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},"τ":{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},"ξ":{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},"Λ":{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},"ΰ":{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"·":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"Υ":{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},"μ":{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"φ":{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"“":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},"‘":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},"ϊ":{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},"π":{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},"ά":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"¤":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},"κ":{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"‡":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},"ψ":{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},"η":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},dx="normal",ux="normal",fx={yMin:-334,xMin:-111,yMax:1189,xMax:1672},mx={postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) Μagenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"Μagenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',manufacturer_name:"Μagenta ltd",font_sub_family_name:"Regular"},px="Helvetiker",gx={glyphs:cx,cssFontWeight:dx,ascender:1189,underlinePosition:-100,cssFontStyle:ux,boundingBox:fx,resolution:1e3,original_font_information:mx,descender:-334,familyName:px,lineHeight:1522,underlineThickness:50},_x=Object.freeze({__proto__:null,glyphs:cx,cssFontWeight:dx,ascender:1189,underlinePosition:-100,cssFontStyle:ux,boundingBox:fx,resolution:1e3,original_font_information:mx,descender:-334,familyName:px,lineHeight:1522,underlineThickness:50,default:gx});class xx{constructor(t){this.type="Font",this.data=t}generateShapes(t,e=100){const i=[],n=function(t,e,i){const n=Array.from(t),r=e/i.resolution,s=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,a=[];let o=0,l=0;for(let t=0;t<n.length;t++){const e=n[t];if("\n"===e)o=0,l-=s;else{const t=yx(e,r,o,l,i);o+=t.offsetX,a.push(t.path)}}return a}(t,e,this.data);for(let t=0,e=n.length;t<e;t++)Array.prototype.push.apply(i,n[t].toShapes());return i}}function yx(t,e,i,n,r){const s=r.glyphs[t]||r.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");const a=new ox;let o,l,h,c,d,u,f,m;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=t.length;r<s;){switch(t[r++]){case"m":o=t[r++]*e+i,l=t[r++]*e+n,a.moveTo(o,l);break;case"l":o=t[r++]*e+i,l=t[r++]*e+n,a.lineTo(o,l);break;case"q":h=t[r++]*e+i,c=t[r++]*e+n,d=t[r++]*e+i,u=t[r++]*e+n,a.quadraticCurveTo(d,u,h,c);break;case"b":h=t[r++]*e+i,c=t[r++]*e+n,d=t[r++]*e+i,u=t[r++]*e+n,f=t[r++]*e+i,m=t[r++]*e+n,a.bezierCurveTo(d,u,f,m,h,c)}}}return{offsetX:s.ha*e,path:a}}xx.prototype.isFont=!0;const Ax={type:"change"},vx={type:"start"},bx={type:"end"};class wx extends Fh{constructor(t,e){super(),void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new gc,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ih,MIDDLE:nh,RIGHT:rh},this.touches={ONE:sh,TWO:oh},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",G),this._domElementKeyEvents=t},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Ax),i.update(),r=n.NONE},this.resetOrthoPanZoom=function(){h.set(0,0,0),i.object.zoom=1,i.object.updateProjectionMatrix(),c=!0},this.update=function(){const e=new gc,d=(new pc).setFromUnitVectors(t.up,new gc(0,1,0)),u=d.clone().invert(),f=new gc,m=new pc,p=2*Math.PI;return function(){const t=i.object.position;e.copy(t).sub(i.target),e.applyQuaternion(d),a.setFromVector3(e),i.autoRotate&&r===n.NONE&&w(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(a.theta+=o.theta*i.dampingFactor,a.phi+=o.phi*i.dampingFactor):(a.theta+=o.theta,a.phi+=o.phi);let g=i.minAzimuthAngle,_=i.maxAzimuthAngle;return isFinite(g)&&isFinite(_)&&(g<-Math.PI?g+=p:g>Math.PI&&(g-=p),_<-Math.PI?_+=p:_>Math.PI&&(_-=p),a.theta=g<=_?Math.max(g,Math.min(_,a.theta)):a.theta>(g+_)/2?Math.max(g,a.theta):Math.min(_,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),!0===i.enableDamping?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),e.setFromSpherical(a),e.applyQuaternion(u),t.copy(i.target).add(e),i.object.lookAt(i.target),!0===i.enableDamping?(o.theta*=1-i.dampingFactor,o.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(o.set(0,0,0),h.set(0,0,0)),l=1,!!(c||f.distanceToSquared(i.object.position)>s||8*(1-m.dot(i.object.quaternion))>s)&&(i.dispatchEvent(Ax),f.copy(i.object.position),m.copy(i.object.quaternion),c=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",H),i.domElement.removeEventListener("pointerdown",F),i.domElement.removeEventListener("pointercancel",q),i.domElement.removeEventListener("wheel",U),i.domElement.removeEventListener("pointermove",I),i.domElement.removeEventListener("pointerup",j),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",G)};const i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=n.NONE;const s=1e-6,a=new Q_,o=new Q_;let l=1;const h=new gc;let c=!1;const d=new Zh,u=new Zh,f=new Zh,m=new Zh,p=new Zh,g=new Zh,_=new Zh,x=new Zh,y=new Zh,A=[],v={};function b(){return Math.pow(.95,i.zoomSpeed)}function w(t){o.theta-=t}function M(t){o.phi-=t}const T=function(){const t=new gc;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),h.add(t)}}(),S=function(){const t=new gc;return function(e,n){!0===i.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(i.object.up,t)),t.multiplyScalar(e),h.add(t)}}(),C=function(){const t=new gc;return function(e,n){const r=i.domElement;if(i.object.isPerspectiveCamera){const s=i.object.position;t.copy(s).sub(i.target);let a=t.length();a*=Math.tan(i.object.fov/2*Math.PI/180),T(2*e*a/r.clientHeight,i.object.matrix),S(2*n*a/r.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(T(e*(i.object.right-i.object.left)/i.object.zoom/r.clientWidth,i.object.matrix),S(n*(i.object.top-i.object.bottom)/i.object.zoom/r.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function P(t){i.object.isPerspectiveCamera?l/=t:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*t)),i.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function E(t){i.object.isPerspectiveCamera?l*=t:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/t)),i.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function k(t){d.set(t.clientX,t.clientY)}function D(t){m.set(t.clientX,t.clientY)}function z(){if(1===A.length)d.set(A[0].pageX,A[0].pageY);else{const t=.5*(A[0].pageX+A[1].pageX),e=.5*(A[0].pageY+A[1].pageY);d.set(t,e)}}function O(){if(1===A.length)m.set(A[0].pageX,A[0].pageY);else{const t=.5*(A[0].pageX+A[1].pageX),e=.5*(A[0].pageY+A[1].pageY);m.set(t,e)}}function R(){const t=A[0].pageX-A[1].pageX,e=A[0].pageY-A[1].pageY,i=Math.sqrt(t*t+e*e);_.set(0,i)}function L(t){if(1==A.length)u.set(t.pageX,t.pageY);else{const e=Y(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);u.set(i,n)}f.subVectors(u,d).multiplyScalar(i.rotateSpeed);const e=i.domElement;w(2*Math.PI*f.x/e.clientHeight),M(2*Math.PI*f.y/e.clientHeight),d.copy(u)}function B(t){if(1===A.length)p.set(t.pageX,t.pageY);else{const e=Y(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);p.set(i,n)}g.subVectors(p,m).multiplyScalar(i.panSpeed),C(g.x,g.y),m.copy(p)}function N(t){const e=Y(t),n=t.pageX-e.x,r=t.pageY-e.y,s=Math.sqrt(n*n+r*r);x.set(0,s),y.set(0,Math.pow(x.y/_.y,i.zoomSpeed)),P(y.y),_.copy(x)}function F(t){!1!==i.enabled&&(0===A.length&&(i.domElement.setPointerCapture(t.pointerId),i.domElement.addEventListener("pointermove",I),i.domElement.addEventListener("pointerup",j)),function(t){A.push(t)}(t),"touch"===t.pointerType?function(t){switch(V(t),A.length){case 1:switch(i.touches.ONE){case sh:if(!1===i.enableRotate)return;z(),r=n.TOUCH_ROTATE;break;case ah:if(!1===i.enablePan)return;O(),r=n.TOUCH_PAN;break;default:r=n.NONE}break;case 2:switch(i.touches.TWO){case oh:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&R(),i.enablePan&&O(),r=n.TOUCH_DOLLY_PAN;break;case lh:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&R(),i.enableRotate&&z(),r=n.TOUCH_DOLLY_ROTATE;break;default:r=n.NONE}break;default:r=n.NONE}r!==n.NONE&&i.dispatchEvent(vx)}(t):function(t){let e;switch(t.button){case 0:e=i.mouseButtons.LEFT;break;case 1:e=i.mouseButtons.MIDDLE;break;case 2:e=i.mouseButtons.RIGHT;break;default:e=-1}switch(e){case nh:if(!1===i.enableZoom)return;!function(t){_.set(t.clientX,t.clientY)}(t),r=n.DOLLY;break;case ih:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enablePan)return;D(t),r=n.PAN}else{if(!1===i.enableRotate)return;k(t),r=n.ROTATE}break;case rh:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enableRotate)return;k(t),r=n.ROTATE}else{if(!1===i.enablePan)return;D(t),r=n.PAN}break;default:r=n.NONE}r!==n.NONE&&i.dispatchEvent(vx)}(t))}function I(t){!1!==i.enabled&&("touch"===t.pointerType?function(t){switch(V(t),r){case n.TOUCH_ROTATE:if(!1===i.enableRotate)return;L(t),i.update();break;case n.TOUCH_PAN:if(!1===i.enablePan)return;B(t),i.update();break;case n.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(t){i.enableZoom&&N(t),i.enablePan&&B(t)}(t),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(t){i.enableZoom&&N(t),i.enableRotate&&L(t)}(t),i.update();break;default:r=n.NONE}}(t):function(t){if(!1===i.enabled)return;switch(r){case n.ROTATE:if(!1===i.enableRotate)return;!function(t){u.set(t.clientX,t.clientY),f.subVectors(u,d).multiplyScalar(i.rotateSpeed);const e=i.domElement;w(2*Math.PI*f.x/e.clientHeight),M(2*Math.PI*f.y/e.clientHeight),d.copy(u),i.update()}(t);break;case n.DOLLY:if(!1===i.enableZoom)return;!function(t){x.set(t.clientX,t.clientY),y.subVectors(x,_),y.y>0?P(b()):y.y<0&&E(b()),_.copy(x),i.update()}(t);break;case n.PAN:if(!1===i.enablePan)return;!function(t){p.set(t.clientX,t.clientY),g.subVectors(p,m).multiplyScalar(i.panSpeed),C(g.x,g.y),m.copy(p),i.update()}(t)}}(t))}function j(t){X(t),0===A.length&&(i.domElement.releasePointerCapture(t.pointerId),i.domElement.removeEventListener("pointermove",I),i.domElement.removeEventListener("pointerup",j)),i.dispatchEvent(bx),r=n.NONE}function q(t){X(t)}function U(t){!1!==i.enabled&&!1!==i.enableZoom&&r===n.NONE&&(t.preventDefault(),i.dispatchEvent(vx),function(t){t.deltaY<0?E(b()):t.deltaY>0&&P(b()),i.update()}(t),i.dispatchEvent(bx))}function G(t){!1!==i.enabled&&!1!==i.enablePan&&function(t){let e=!1;switch(t.code){case i.keys.UP:C(0,i.keyPanSpeed),e=!0;break;case i.keys.BOTTOM:C(0,-i.keyPanSpeed),e=!0;break;case i.keys.LEFT:C(i.keyPanSpeed,0),e=!0;break;case i.keys.RIGHT:C(-i.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),i.update())}(t)}function H(t){!1!==i.enabled&&t.preventDefault()}function X(t){delete v[t.pointerId];for(let e=0;e<A.length;e++)if(A[e].pointerId==t.pointerId)return void A.splice(e,1)}function V(t){let e=v[t.pointerId];void 0===e&&(e=new Zh,v[t.pointerId]=e),e.set(t.pageX,t.pageY)}function Y(t){const e=t.pointerId===A[0].pointerId?A[1]:A[0];return v[e.pointerId]}i.domElement.addEventListener("contextmenu",H),i.domElement.addEventListener("pointerdown",F),i.domElement.addEventListener("pointercancel",q),i.domElement.addEventListener("wheel",U,{passive:!1}),this.update()}}const Mx=new V_,Tx=new gc,Sx=new gc,Cx=new pc,Px={X:new gc(1,0,0),Y:new gc(0,1,0),Z:new gc(0,0,1)},Ex={type:"change"},kx={type:"mouseDown"},Dx={type:"mouseUp",mode:null},zx={type:"objectChange"};class Ox extends Td{constructor(t,e){super(),void 0===e&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const i=new ty;this._gizmo=i,this.add(i);const n=new ey;this._plane=n,this.add(n);const r=this;function s(t,e){let s=e;Object.defineProperty(r,t,{get:function(){return void 0!==s?s:e},set:function(e){s!==e&&(s=e,n[t]=e,i[t]=e,r.dispatchEvent({type:t+"-changed",value:e}),r.dispatchEvent(Ex))}}),r[t]=e,n[t]=e,i[t]=e}s("camera",t),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0);const a=new gc,o=new gc,l=new pc,h=new pc,c=new gc,d=new pc,u=new gc,f=new gc,m=new gc,p=new gc;s("worldPosition",a),s("worldPositionStart",o),s("worldQuaternion",l),s("worldQuaternionStart",h),s("cameraPosition",c),s("cameraQuaternion",d),s("pointStart",u),s("pointEnd",f),s("rotationAxis",m),s("rotationAngle",0),s("eye",p),this._offset=new gc,this._startNorm=new gc,this._endNorm=new gc,this._cameraScale=new gc,this._parentPosition=new gc,this._parentQuaternion=new pc,this._parentQuaternionInv=new pc,this._parentScale=new gc,this._worldScaleStart=new gc,this._worldQuaternionInv=new pc,this._worldScale=new gc,this._positionStart=new gc,this._quaternionStart=new pc,this._scaleStart=new gc,this._getPointer=Rx.bind(this),this._onPointerDown=Bx.bind(this),this._onPointerHover=Lx.bind(this),this._onPointerMove=Nx.bind(this),this._onPointerUp=Fx.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(void 0===this.object||!0===this.dragging)return;Mx.setFromCamera(t,this.camera);const e=Ix(this._gizmo.picker[this.mode],Mx);this.axis=e?e.object.name:null}pointerDown(t){if(void 0!==this.object&&!0!==this.dragging&&0===t.button&&null!==this.axis){Mx.setFromCamera(t,this.camera);const e=Ix(this._plane,Mx,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,kx.mode=this.mode,this.dispatchEvent(kx)}}pointerMove(t){const e=this.axis,i=this.mode,n=this.object;let r=this.space;if("scale"===i?r="local":"E"!==e&&"XYZE"!==e&&"XYZ"!==e||(r="world"),void 0===n||null===e||!1===this.dragging||-1!==t.button)return;Mx.setFromCamera(t,this.camera);const s=Ix(this._plane,Mx,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===r&&"XYZ"!==e&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===e.indexOf("X")&&(this._offset.x=0),-1===e.indexOf("Y")&&(this._offset.y=0),-1===e.indexOf("Z")&&(this._offset.z=0),"local"===r&&"XYZ"!==e?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===r&&(n.position.applyQuaternion(Cx.copy(this._quaternionStart).invert()),-1!==e.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),"world"===r&&(n.parent&&n.position.add(Tx.setFromMatrixPosition(n.parent.matrixWorld)),-1!==e.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(Tx.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==e.search("XYZ")){let t=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(t*=-1),Sx.set(t,t,t)}else Tx.copy(this.pointStart),Sx.copy(this.pointEnd),Tx.applyQuaternion(this._worldQuaternionInv),Sx.applyQuaternion(this._worldQuaternionInv),Sx.divide(Tx),-1===e.search("X")&&(Sx.x=1),-1===e.search("Y")&&(Sx.y=1),-1===e.search("Z")&&(Sx.z=1);n.scale.copy(this._scaleStart).multiply(Sx),this.scaleSnap&&(-1!==e.search("X")&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);const t=20/this.worldPosition.distanceTo(Tx.setFromMatrixPosition(this.camera.matrixWorld));"E"===e?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===e?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Tx.copy(this.rotationAxis).cross(this.eye))*t):"X"!==e&&"Y"!==e&&"Z"!==e||(this.rotationAxis.copy(Px[e]),Tx.copy(Px[e]),"local"===r&&Tx.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Tx.cross(this.eye).normalize())*t),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===r&&"E"!==e&&"XYZE"!==e?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(Cx.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(Cx.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ex),this.dispatchEvent(zx)}}pointerUp(t){0===t.button&&(this.dragging&&null!==this.axis&&(Dx.mode=this.mode,this.dispatchEvent(Dx)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ex),this.dispatchEvent(zx),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Mx}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function Rx(t){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:t.button};{const e=this.domElement.getBoundingClientRect();return{x:(t.clientX-e.left)/e.width*2-1,y:-(t.clientY-e.top)/e.height*2+1,button:t.button}}}function Lx(t){if(this.enabled)switch(t.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(t))}}function Bx(t){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(t)),this.pointerDown(this._getPointer(t)))}function Nx(t){this.enabled&&this.pointerMove(this._getPointer(t))}function Fx(t){this.enabled&&(this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(t)))}function Ix(t,e,i){const n=e.intersectObject(t,!0);for(let t=0;t<n.length;t++)if(n[t].object.visible||i)return n[t];return!1}Ox.prototype.isTransformControls=!0;const jx=new cd,qx=new gc(0,1,0),Ux=new gc(0,0,0),Gx=new Vc,Hx=new pc,Xx=new pc,Vx=new gc,Yx=new Vc,$x=new gc(1,0,0),Wx=new gc(0,1,0),Zx=new gc(0,0,1),Qx=new gc,Jx=new gc,Kx=new gc;class ty extends Td{constructor(){super(),this.type="TransformControlsGizmo";const t=new ou({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new pp({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=t.clone();i.opacity=.15;const n=e.clone();n.opacity=.5;const r=t.clone();r.color.setHex(16711680);const s=t.clone();s.color.setHex(65280);const a=t.clone();a.color.setHex(255);const o=t.clone();o.color.setHex(16711680),o.opacity=.5;const l=t.clone();l.color.setHex(65280),l.opacity=.5;const h=t.clone();h.color.setHex(255),h.opacity=.5;const c=t.clone();c.opacity=.25;const d=t.clone();d.color.setHex(16776960),d.opacity=.25;t.clone().color.setHex(16776960);const u=t.clone();u.color.setHex(7895160);const f=new Lp(0,.04,.1,12);f.translate(0,.05,0);const m=new Rd(.08,.08,.08);m.translate(0,.04,0);const p=new Od;p.setAttribute("position",new od([0,0,0,1,0,0],3));const g=new Lp(.0075,.0075,.5,3);function _(t,e){const i=new Ng(t,.0075,3,64,e*Math.PI*2);return i.rotateY(Math.PI/2),i.rotateX(Math.PI/2),i}g.translate(0,.25,0);const x={X:[[new Tu(f,r),[.5,0,0],[0,0,-Math.PI/2]],[new Tu(f,r),[-.5,0,0],[0,0,Math.PI/2]],[new Tu(g,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Tu(f,s),[0,.5,0]],[new Tu(f,s),[0,-.5,0],[Math.PI,0,0]],[new Tu(g,s)]],Z:[[new Tu(f,a),[0,0,.5],[Math.PI/2,0,0]],[new Tu(f,a),[0,0,-.5],[-Math.PI/2,0,0]],[new Tu(g,a),null,[Math.PI/2,0,0]]],XYZ:[[new Tu(new Lg(.1,0),c.clone()),[0,0,0]]],XY:[[new Tu(new Rd(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new Tu(new Rd(.15,.15,.01),o.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Tu(new Rd(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},y={X:[[new Tu(new Lp(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Tu(new Lp(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Tu(new Lp(.2,0,.6,4),i),[0,.3,0]],[new Tu(new Lp(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Tu(new Lp(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Tu(new Lp(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Tu(new Lg(.2,0),i)]],XY:[[new Tu(new Rd(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Tu(new Rd(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Tu(new Rd(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},A={START:[[new Tu(new Lg(.01,2),n),null,null,null,"helper"]],END:[[new Tu(new Lg(.01,2),n),null,null,null,"helper"]],DELTA:[[new vp(function(){const t=new Od;return t.setAttribute("position",new od([0,0,0,1,1,1],3)),t}(),n),null,null,null,"helper"]],X:[[new vp(p,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new vp(p,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new vp(p,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},v={XYZE:[[new Tu(_(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new Tu(_(.5,.5),r)]],Y:[[new Tu(_(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new Tu(_(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new Tu(_(.75,1),d),null,[0,Math.PI/2,0]]]},b={AXIS:[[new vp(p,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},w={XYZE:[[new Tu(new Bg(.25,10,8),i)]],X:[[new Tu(new Ng(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Tu(new Ng(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Tu(new Ng(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Tu(new Ng(.75,.1,2,24),i)]]},M={X:[[new Tu(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new Tu(g,r),[0,0,0],[0,0,-Math.PI/2]],[new Tu(m,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Tu(m,s),[0,.5,0]],[new Tu(g,s)],[new Tu(m,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Tu(m,a),[0,0,.5],[Math.PI/2,0,0]],[new Tu(g,a),[0,0,0],[Math.PI/2,0,0]],[new Tu(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Tu(new Rd(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new Tu(new Rd(.15,.15,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Tu(new Rd(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Tu(new Rd(.1,.1,.1),c.clone())]]},T={X:[[new Tu(new Lp(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Tu(new Lp(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Tu(new Lp(.2,0,.6,4),i),[0,.3,0]],[new Tu(new Lp(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Tu(new Lp(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Tu(new Lp(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Tu(new Rd(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Tu(new Rd(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Tu(new Rd(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Tu(new Rd(.2,.2,.2),i),[0,0,0]]]},S={X:[[new vp(p,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new vp(p,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new vp(p,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function C(t){const e=new Td;for(const i in t)for(let n=t[i].length;n--;){const r=t[i][n][0].clone(),s=t[i][n][1],a=t[i][n][2],o=t[i][n][3],l=t[i][n][4];r.name=i,r.tag=l,s&&r.position.set(s[0],s[1],s[2]),a&&r.rotation.set(a[0],a[1],a[2]),o&&r.scale.set(o[0],o[1],o[2]),r.updateMatrix();const h=r.geometry.clone();h.applyMatrix4(r.matrix),r.geometry=h,r.renderOrder=1/0,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),e.add(r)}return e}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(x)),this.add(this.gizmo.rotate=C(v)),this.add(this.gizmo.scale=C(M)),this.add(this.picker.translate=C(y)),this.add(this.picker.rotate=C(w)),this.add(this.picker.scale=C(T)),this.add(this.helper.translate=C(A)),this.add(this.helper.rotate=C(b)),this.add(this.helper.scale=C(S)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:Xx;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let t=0;t<i.length;t++){const n=i[t];let r;if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),r=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),"helper"!==n.tag){if(n.quaternion.copy(e),"translate"===this.mode||"scale"===this.mode){const t=.99,i=.2;"X"===n.name&&Math.abs(qx.copy($x).applyQuaternion(e).dot(this.eye))>t&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&Math.abs(qx.copy(Wx).applyQuaternion(e).dot(this.eye))>t&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&Math.abs(qx.copy(Zx).applyQuaternion(e).dot(this.eye))>t&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(qx.copy(Zx).applyQuaternion(e).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(qx.copy($x).applyQuaternion(e).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(qx.copy(Wx).applyQuaternion(e).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)}else"rotate"===this.mode&&(Hx.copy(e),qx.copy(this.eye).applyQuaternion(Cx.copy(e).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(Gx.lookAt(this.eye,Ux,Wx)),"X"===n.name&&(Cx.setFromAxisAngle($x,Math.atan2(-qx.y,qx.z)),Cx.multiplyQuaternions(Hx,Cx),n.quaternion.copy(Cx)),"Y"===n.name&&(Cx.setFromAxisAngle(Wx,Math.atan2(qx.x,qx.z)),Cx.multiplyQuaternions(Hx,Cx),n.quaternion.copy(Cx)),"Z"===n.name&&(Cx.setFromAxisAngle(Zx,Math.atan2(qx.y,qx.x)),Cx.multiplyQuaternions(Hx,Cx),n.quaternion.copy(Cx)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some((function(t){return n.name===t})))&&(n.material.color.setHex(16776960),n.material.opacity=1)}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(Cx.setFromEuler(jx.set(0,0,0)),n.quaternion.copy(e).multiply(Cx),Math.abs(qx.copy($x).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(Cx.setFromEuler(jx.set(0,0,Math.PI/2)),n.quaternion.copy(e).multiply(Cx),Math.abs(qx.copy(Wx).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(Cx.setFromEuler(jx.set(0,Math.PI/2,0)),n.quaternion.copy(e).multiply(Cx),Math.abs(qx.copy(Zx).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(Cx.setFromEuler(jx.set(0,Math.PI/2,0)),qx.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(Gx.lookAt(Ux,qx,Wx)),n.quaternion.multiply(Cx),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),Tx.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Tx.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(Tx),n.visible=this.dragging):(n.quaternion.copy(e),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}super.updateMatrixWorld(t)}}ty.prototype.isTransformControlsGizmo=!0;class ey extends Tu{constructor(){super(new Ld(1e5,1e5,2,2),new ou({visible:!1,wireframe:!0,side:2,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),Qx.copy($x).applyQuaternion("local"===e?this.worldQuaternion:Xx),Jx.copy(Wx).applyQuaternion("local"===e?this.worldQuaternion:Xx),Kx.copy(Zx).applyQuaternion("local"===e?this.worldQuaternion:Xx),qx.copy(Jx),this.mode){case"translate":case"scale":switch(this.axis){case"X":qx.copy(this.eye).cross(Qx),Vx.copy(Qx).cross(qx);break;case"Y":qx.copy(this.eye).cross(Jx),Vx.copy(Jx).cross(qx);break;case"Z":qx.copy(this.eye).cross(Kx),Vx.copy(Kx).cross(qx);break;case"XY":Vx.copy(Kx);break;case"YZ":Vx.copy(Qx);break;case"XZ":qx.copy(Kx),Vx.copy(Jx);break;case"XYZ":case"E":Vx.set(0,0,0)}break;default:Vx.set(0,0,0)}0===Vx.length()?this.quaternion.copy(this.cameraQuaternion):(Yx.lookAt(Tx.set(0,0,0),Vx,qx),this.quaternion.setFromRotationMatrix(Yx)),super.updateMatrixWorld(t)}}ey.prototype.isTransformControlsPlane=!0;const iy={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};class ny{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const ry=new Uu(-1,1,1,-1,0,1),sy=new Od;sy.setAttribute("position",new od([-1,3,0,-1,-1,0,3,-1,0],3)),sy.setAttribute("uv",new od([0,2,0,0,2,0],2));class ay{constructor(t){this._mesh=new Tu(sy,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,ry)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class oy extends ny{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof qd?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=jd.clone(t.uniforms),this.material=new qd({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new ay(this.material)}render(t,e,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class ly extends ny{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,i){const n=t.getContext(),r=t.state;let s,a;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(s=0,a=1):(s=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),r.buffers.stencil.setFunc(n.ALWAYS,s,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),t.setRenderTarget(i),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(n.EQUAL,1,4294967295),r.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),r.buffers.stencil.setLocked(!0)}}class hy extends ny{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class cy{constructor(t,e){if(this.renderer=t,void 0===e){const i={minFilter:_h,magFilter:_h,format:Th},n=t.getSize(new Zh);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(e=new mc(this._width*this._pixelRatio,this._height*this._pixelRatio,i)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===iy&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===oy&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new oy(iy),this.clock=new W_}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let i=!1;for(let e=0,n=this.passes.length;e<n;e++){const n=this.passes[e];if(!1!==n.enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),n.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),n.needsSwap){if(i){const e=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),i.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==ly&&(n instanceof ly?i=!0:n instanceof hy&&(i=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new Zh);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(i,n)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new Uu(-1,1,1,-1,0,1);const dy=new Od;dy.setAttribute("position",new od([-1,3,0,-1,-1,0,3,-1,0],3)),dy.setAttribute("uv",new od([0,2,0,0,2,0],2));class uy extends ny{constructor(t,e,i,n,r){super(),this.scene=t,this.camera=e,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new ac}render(t,e,i){const n=t.autoClear;let r,s;t.autoClear=!1,void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),t.autoClear=n}}const fy={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Zh},cameraProjectionMatrix:{value:new Vc},cameraInverseProjectionMatrix:{value:new Vc},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tNormal;\n\t\tuniform sampler2D tDepth;\n\t\tuniform sampler2D tNoise;\n\n\t\tuniform vec3 kernel[ KERNEL_SIZE ];\n\n\t\tuniform vec2 resolution;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float kernelRadius;\n\t\tuniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference\n\t\tuniform float maxDistance; // avoid the influence of fragments which are too far away\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t}\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec2 screenPosition ) {\n\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tfloat viewZ = getViewZ( depth );\n\n\t\t\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n\t\t\tvec3 viewNormal = getViewNormal( vUv );\n\n\t\t\tvec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n\t\t\tvec3 random = vec3( texture2D( tNoise, vUv * noiseScale ).r );\n\n\t\t\t// compute matrix used to reorient a kernel vector\n\n\t\t\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n\t\t\tvec3 bitangent = cross( viewNormal, tangent );\n\t\t\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n\n\t\t float occlusion = 0.0;\n\n\t\t for ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n\n\t\t\t\tvec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space\n\t\t\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point\n\n\t\t\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC\n\t\t\t\tsamplePointNDC /= samplePointNDC.w;\n\n\t\t\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates\n\n\t\t\t\tfloat realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture\n\t\t\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value\n\t\t\t\tfloat delta = sampleDepth - realDepth;\n\n\t\t\t\tif ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion\n\n\t\t\t\t\tocclusion += 1.0;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n\n\t\t}"},my={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n\n\t\t}"},py={uniforms:{tDiffuse:{value:null},resolution:{value:new Zh}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\t\t\tfloat result = 0.0;\n\n\t\t\tfor ( int i = - 2; i <= 2; i ++ ) {\n\n\t\t\t\tfor ( int j = - 2; j <= 2; j ++ ) {\n\n\t\t\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n\t\t\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n\n\t\t}"};class gy{constructor(t=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(t,e,i){return t[0]*e+t[1]*i}dot3(t,e,i,n){return t[0]*e+t[1]*i+t[2]*n}dot4(t,e,i,n,r){return t[0]*e+t[1]*i+t[2]*n+t[3]*r}noise(t,e){let i,n,r;const s=(t+e)*(.5*(Math.sqrt(3)-1)),a=Math.floor(t+s),o=Math.floor(e+s),l=(3-Math.sqrt(3))/6,h=(a+o)*l,c=t-(a-h),d=e-(o-h);let u,f;c>d?(u=1,f=0):(u=0,f=1);const m=c-u+l,p=d-f+l,g=c-1+2*l,_=d-1+2*l,x=255&a,y=255&o,A=this.perm[x+this.perm[y]]%12,v=this.perm[x+u+this.perm[y+f]]%12,b=this.perm[x+1+this.perm[y+1]]%12;let w=.5-c*c-d*d;w<0?i=0:(w*=w,i=w*w*this.dot(this.grad3[A],c,d));let M=.5-m*m-p*p;M<0?n=0:(M*=M,n=M*M*this.dot(this.grad3[v],m,p));let T=.5-g*g-_*_;return T<0?r=0:(T*=T,r=T*T*this.dot(this.grad3[b],g,_)),70*(i+n+r)}noise3d(t,e,i){let n,r,s,a;const o=(t+e+i)*(1/3),l=Math.floor(t+o),h=Math.floor(e+o),c=Math.floor(i+o),d=1/6,u=(l+h+c)*d,f=t-(l-u),m=e-(h-u),p=i-(c-u);let g,_,x,y,A,v;f>=m?m>=p?(g=1,_=0,x=0,y=1,A=1,v=0):f>=p?(g=1,_=0,x=0,y=1,A=0,v=1):(g=0,_=0,x=1,y=1,A=0,v=1):m<p?(g=0,_=0,x=1,y=0,A=1,v=1):f<p?(g=0,_=1,x=0,y=0,A=1,v=1):(g=0,_=1,x=0,y=1,A=1,v=0);const b=f-g+d,w=m-_+d,M=p-x+d,T=f-y+2*d,S=m-A+2*d,C=p-v+2*d,P=f-1+.5,E=m-1+.5,k=p-1+.5,D=255&l,z=255&h,O=255&c,R=this.perm[D+this.perm[z+this.perm[O]]]%12,L=this.perm[D+g+this.perm[z+_+this.perm[O+x]]]%12,B=this.perm[D+y+this.perm[z+A+this.perm[O+v]]]%12,N=this.perm[D+1+this.perm[z+1+this.perm[O+1]]]%12;let F=.6-f*f-m*m-p*p;F<0?n=0:(F*=F,n=F*F*this.dot3(this.grad3[R],f,m,p));let I=.6-b*b-w*w-M*M;I<0?r=0:(I*=I,r=I*I*this.dot3(this.grad3[L],b,w,M));let j=.6-T*T-S*S-C*C;j<0?s=0:(j*=j,s=j*j*this.dot3(this.grad3[B],T,S,C));let q=.6-P*P-E*E-k*k;return q<0?a=0:(q*=q,a=q*q*this.dot3(this.grad3[N],P,E,k)),32*(n+r+s+a)}noise4d(t,e,i,n){const r=this.grad4,s=this.simplex,a=this.perm,o=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let h,c,d,u,f;const m=(t+e+i+n)*o,p=Math.floor(t+m),g=Math.floor(e+m),_=Math.floor(i+m),x=Math.floor(n+m),y=(p+g+_+x)*l,A=t-(p-y),v=e-(g-y),b=i-(_-y),w=n-(x-y),M=(A>v?32:0)+(A>b?16:0)+(v>b?8:0)+(A>w?4:0)+(v>w?2:0)+(b>w?1:0),T=s[M][0]>=3?1:0,S=s[M][1]>=3?1:0,C=s[M][2]>=3?1:0,P=s[M][3]>=3?1:0,E=s[M][0]>=2?1:0,k=s[M][1]>=2?1:0,D=s[M][2]>=2?1:0,z=s[M][3]>=2?1:0,O=s[M][0]>=1?1:0,R=s[M][1]>=1?1:0,L=s[M][2]>=1?1:0,B=s[M][3]>=1?1:0,N=A-T+l,F=v-S+l,I=b-C+l,j=w-P+l,q=A-E+2*l,U=v-k+2*l,G=b-D+2*l,H=w-z+2*l,X=A-O+3*l,V=v-R+3*l,Y=b-L+3*l,$=w-B+3*l,W=A-1+4*l,Z=v-1+4*l,Q=b-1+4*l,J=w-1+4*l,K=255&p,tt=255&g,et=255&_,it=255&x,nt=a[K+a[tt+a[et+a[it]]]]%32,rt=a[K+T+a[tt+S+a[et+C+a[it+P]]]]%32,st=a[K+E+a[tt+k+a[et+D+a[it+z]]]]%32,at=a[K+O+a[tt+R+a[et+L+a[it+B]]]]%32,ot=a[K+1+a[tt+1+a[et+1+a[it+1]]]]%32;let lt=.6-A*A-v*v-b*b-w*w;lt<0?h=0:(lt*=lt,h=lt*lt*this.dot4(r[nt],A,v,b,w));let ht=.6-N*N-F*F-I*I-j*j;ht<0?c=0:(ht*=ht,c=ht*ht*this.dot4(r[rt],N,F,I,j));let ct=.6-q*q-U*U-G*G-H*H;ct<0?d=0:(ct*=ct,d=ct*ct*this.dot4(r[st],q,U,G,H));let dt=.6-X*X-V*V-Y*Y-$*$;dt<0?u=0:(dt*=dt,u=dt*dt*this.dot4(r[at],X,V,Y,$));let ut=.6-W*W-Z*Z-Q*Q-J*J;return ut<0?f=0:(ut*=ut,f=ut*ut*this.dot4(r[ot],W,Z,Q,J)),27*(h+c+d+u+f)}}class _y extends ny{constructor(t,e,i,n){super(),this.width=void 0!==i?i:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=e,this.scene=t,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(),this.generateRandomKernelRotations();const r=new hp;r.format=Ch,r.type=Mh,this.beautyRenderTarget=new mc(this.width,this.height),this.normalRenderTarget=new mc(this.width,this.height,{minFilter:gh,magFilter:gh,depthTexture:r}),this.ssaoRenderTarget=new mc(this.width,this.height),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===fy&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new qd({defines:Object.assign({},fy.defines),uniforms:jd.clone(fy.uniforms),vertexShader:fy.vertexShader,fragmentShader:fy.fragmentShader,blending:0}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new Yg,this.normalMaterial.blending=0,this.blurMaterial=new qd({defines:Object.assign({},py.defines),uniforms:jd.clone(py.uniforms),vertexShader:py.vertexShader,fragmentShader:py.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new qd({defines:Object.assign({},my.defines),uniforms:jd.clone(my.uniforms),vertexShader:my.vertexShader,fragmentShader:my.fragmentShader,blending:0}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new qd({uniforms:jd.clone(iy.uniforms),vertexShader:iy.vertexShader,fragmentShader:iy.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:208,blendDst:200,blendEquation:hh,blendSrcAlpha:206,blendDstAlpha:200,blendEquationAlpha:hh}),this.fsQuad=new ay(null),this.originalClearColor=new ac}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,e){switch(!1===t.capabilities.isWebGL2&&(this.noiseTexture.format=1024),t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(t,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.output){case _y.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case _y.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case _y.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case _y.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:e);break;case _y.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case _y.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=5,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(t,e,i,n,r){t.getClearColor(this.originalClearColor);const s=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,null!=n&&(t.setClearColor(n),t.setClearAlpha(r||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderOverride(t,e,i,n,r){t.getClearColor(this.originalClearColor);const s=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(i),t.autoClear=!1,n=e.clearColor||n,r=e.clearAlpha||r,null!=n&&(t.setClearColor(n),t.setClearAlpha(r||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}setSize(t,e){this.width=t,this.height=e,this.beautyRenderTarget.setSize(t,e),this.ssaoRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.ssaoMaterial.uniforms.resolution.value.set(t,e),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e)}generateSampleKernel(){const t=this.kernelSize,e=this.kernel;for(let i=0;i<t;i++){const n=new gc;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();let r=i/t;r=Vh(.1,1,r*r),n.multiplyScalar(r),e.push(n)}}generateRandomKernelRotations(){void 0===gy&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");const t=new gy,e=new Float32Array(16);for(let i=0;i<16;i++){const n=2*Math.random()-1,r=2*Math.random()-1,s=0;e[i]=t.noise3d(n,r,s)}this.noiseTexture=new zp(e,4,4,1028,bh),this.noiseTexture.wrapS=fh,this.noiseTexture.wrapT=fh,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse((function(t){e.set(t,t.visible),(t.isPoints||t.isLine)&&(t.visible=!1)}))}restoreVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse((function(t){const i=e.get(t);t.visible=i})),e.clear()}}_y.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5};const xy={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new ac(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class yy extends ny{constructor(t,e,i,n){super(),this.strength=void 0!==e?e:1,this.radius=i,this.threshold=n,this.resolution=void 0!==t?new Zh(t.x,t.y):new Zh(256,256),this.clearColor=new ac(0,0,0);const r={minFilter:_h,magFilter:_h,format:Th};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let s=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new mc(s,a,r),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let t=0;t<this.nMips;t++){const e=new mc(s,a,r);e.texture.name="UnrealBloomPass.h"+t,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const i=new mc(s,a,r);i.texture.name="UnrealBloomPass.v"+t,i.texture.generateMipmaps=!1,this.renderTargetsVertical.push(i),s=Math.round(s/2),a=Math.round(a/2)}void 0===xy&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const o=xy;this.highPassUniforms=jd.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new qd({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];s=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let t=0;t<this.nMips;t++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[t])),this.separableBlurMaterials[t].uniforms.texSize.value=new Zh(s,a),s=Math.round(s/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new gc(1,1,1),new gc(1,1,1),new gc(1,1,1),new gc(1,1,1),new gc(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===iy&&console.error("THREE.UnrealBloomPass relies on CopyShader");const h=iy;this.copyUniforms=jd.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new qd({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new ac,this.oldClearAlpha=1,this.basic=new ou,this.fsQuad=new ay(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()}setSize(t,e){let i=Math.round(t/2),n=Math.round(e/2);this.renderTargetBright.setSize(i,n);for(let t=0;t<this.nMips;t++)this.renderTargetsHorizontal[t].setSize(i,n),this.renderTargetsVertical[t].setSize(i,n),this.separableBlurMaterials[t].uniforms.texSize.value=new Zh(i,n),i=Math.round(i/2),n=Math.round(n/2)}render(t,e,i,n,r){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const s=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),r&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let a=this.renderTargetBright;for(let e=0;e<this.nMips;e++)this.fsQuad.material=this.separableBlurMaterials[e],this.separableBlurMaterials[e].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[e].uniforms.direction.value=yy.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[e]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[e].uniforms.colorTexture.value=this.renderTargetsHorizontal[e].texture,this.separableBlurMaterials[e].uniforms.direction.value=yy.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[e]),t.clear(),this.fsQuad.render(t),a=this.renderTargetsVertical[e];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(i),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=s}getSeperableBlurMaterial(t){return new qd({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new Zh(.5,.5)},direction:{value:new Zh(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(t){return new qd({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}yy.BlurDirectionX=new Zh(1,0),yy.BlurDirectionY=new Zh(0,1);class Ay{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class vy{constructor(){this.id=0,this.v1=new by,this.v2=new by,this.v3=new by,this.normalModel=new gc,this.vertexNormalsModel=[new gc,new gc,new gc],this.vertexNormalsLength=0,this.color=new ac,this.material=null,this.uvs=[new Zh,new Zh,new Zh],this.z=0,this.renderOrder=0}}class by{constructor(){this.position=new gc,this.positionWorld=new gc,this.positionScreen=new fc,this.visible=!0}copy(t){this.positionWorld.copy(t.positionWorld),this.positionScreen.copy(t.positionScreen)}}class wy{constructor(){this.id=0,this.v1=new by,this.v2=new by,this.vertexColors=[new ac,new ac],this.material=null,this.z=0,this.renderOrder=0}}class My{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new Zh,this.material=null,this.renderOrder=0}}class Ty{constructor(){let t,e,i,n,r,s,a,o,l,h,c,d=0,u=0,f=0,m=0,p=0;const g={objects:[],lights:[],elements:[]},_=new gc,x=new fc,y=new yc(new gc(-1,-1,-1),new gc(1,1,1)),A=new yc,v=new Array(3),b=new Vc,w=new Vc,M=new Vc,T=new Xc,S=[],C=[],P=[],E=[],k=[];this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};const D=new function(){const t=[],e=[],s=[];let l=null;const h=new Qh;function d(t){const e=t.position,i=t.positionWorld,n=t.positionScreen;i.copy(e).applyMatrix4(c),n.copy(i).applyMatrix4(w);const r=1/n.w;n.x*=r,n.y*=r,n.z*=r,t.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1}function f(t,e,i){return!0===t.visible||!0===e.visible||!0===i.visible||(v[0]=t.positionScreen,v[1]=e.positionScreen,v[2]=i.positionScreen,y.intersectsBox(A.setFromPoints(v)))}function p(t,e,i){return(i.positionScreen.x-t.positionScreen.x)*(e.positionScreen.y-t.positionScreen.y)-(i.positionScreen.y-t.positionScreen.y)*(e.positionScreen.x-t.positionScreen.x)<0}return{setObject:function(i){l=i,h.getNormalMatrix(l.matrixWorld),t.length=0,e.length=0,s.length=0},projectVertex:d,checkTriangleVisibility:f,checkBackfaceCulling:p,pushVertex:function(t,e,r){i=function(){if(n===u){const t=new by;return C.push(t),u++,n++,t}return C[n++]}(),i.position.set(t,e,r),d(i)},pushNormal:function(e,i,n){t.push(e,i,n)},pushColor:function(t,i,n){e.push(t,i,n)},pushUv:function(t,e){s.push(t,e)},pushLine:function(t,i){const n=C[t],r=C[i];n.positionScreen.copy(n.position).applyMatrix4(M),r.positionScreen.copy(r.position).applyMatrix4(M),!0===function(t,e){let i=0,n=1;const r=t.z+t.w,s=e.z+e.w,a=-t.z+t.w,o=-e.z+e.w;return r>=0&&s>=0&&a>=0&&o>=0||!(r<0&&s<0||a<0&&o<0)&&(r<0?i=Math.max(i,r/(r-s)):s<0&&(n=Math.min(n,r/(r-s))),a<0?i=Math.max(i,a/(a-o)):o<0&&(n=Math.min(n,a/(a-o))),!(n<i)&&(t.lerp(e,i),e.lerp(t,1-n),!0))}(n.positionScreen,r.positionScreen)&&(n.positionScreen.multiplyScalar(1/n.positionScreen.w),r.positionScreen.multiplyScalar(1/r.positionScreen.w),a=function(){if(o===m){const t=new wy;return E.push(t),m++,o++,t}return E[o++]}(),a.id=l.id,a.v1.copy(n),a.v2.copy(r),a.z=Math.max(n.positionScreen.z,r.positionScreen.z),a.renderOrder=l.renderOrder,a.material=l.material,l.material.vertexColors&&(a.vertexColors[0].fromArray(e,3*t),a.vertexColors[1].fromArray(e,3*i)),g.elements.push(a))},pushTriangle:function(i,n,a,o){const c=C[i],d=C[n],u=C[a];if(!1!==f(c,d,u)&&(2===o.side||!0===p(c,d,u))){r=L(),r.id=l.id,r.v1.copy(c),r.v2.copy(d),r.v3.copy(u),r.z=(c.positionScreen.z+d.positionScreen.z+u.positionScreen.z)/3,r.renderOrder=l.renderOrder,_.subVectors(u.position,d.position),x.subVectors(c.position,d.position),_.cross(x),r.normalModel.copy(_),r.normalModel.applyMatrix3(h).normalize();for(let e=0;e<3;e++){const i=r.vertexNormalsModel[e];i.fromArray(t,3*arguments[e]),i.applyMatrix3(h).normalize();r.uvs[e].fromArray(s,2*arguments[e])}r.vertexNormalsLength=3,r.material=o,o.vertexColors&&r.color.fromArray(e,3*i),g.elements.push(r)}}}};function z(t){if(!1===t.visible)return;if(t.isLight)g.lights.push(t);else if(t.isMesh||t.isLine||t.isPoints){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===T.intersectsObject(t))return;O(t)}else if(t.isSprite){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===T.intersectsSprite(t))return;O(t)}const e=t.children;for(let t=0,i=e.length;t<i;t++)z(e[t])}function O(i){t=function(){if(e===d){const t=new Ay;return S.push(t),d++,e++,t}return S[e++]}(),t.id=i.id,t.object=i,_.setFromMatrixPosition(i.matrixWorld),_.applyMatrix4(w),t.z=_.z,t.renderOrder=i.renderOrder,g.objects.push(t)}function R(t,e,i){const n=1/t.w;t.z*=n,t.z>=-1&&t.z<=1&&(l=function(){if(h===p){const t=new My;return k.push(t),p++,h++,t}return k[h++]}(),l.id=e.id,l.x=t.x*n,l.y=t.y*n,l.z=t.z,l.renderOrder=e.renderOrder,l.object=e,l.rotation=e.rotation,l.scale.x=e.scale.x*Math.abs(l.x-(t.x+i.projectionMatrix.elements[0])/(t.w+i.projectionMatrix.elements[12])),l.scale.y=e.scale.y*Math.abs(l.y-(t.y+i.projectionMatrix.elements[5])/(t.w+i.projectionMatrix.elements[13])),l.material=e.material,g.elements.push(l))}function L(){if(s===f){const t=new vy;return P.push(t),f++,s++,t}return P[s++]}function B(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id!==e.id?t.id-e.id:0}this.projectScene=function(t,i,r,a){s=0,o=0,h=0,g.elements.length=0,!0===t.autoUpdate&&t.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),b.copy(i.matrixWorldInverse),w.multiplyMatrices(i.projectionMatrix,b),T.setFromProjectionMatrix(w),e=0,g.objects.length=0,g.lights.length=0,z(t),!0===r&&g.objects.sort(B);const l=g.objects;for(let t=0,e=l.length;t<e;t++){const e=l[t].object,r=e.geometry;if(D.setObject(e),c=e.matrixWorld,n=0,e.isMesh){if(r.isBufferGeometry){let t=e.material;const i=Array.isArray(t),n=r.attributes,s=r.groups;if(void 0===n.position)continue;const a=n.position.array;for(let t=0,i=a.length;t<i;t+=3){let i=a[t],n=a[t+1],s=a[t+2];const o=r.morphAttributes.position;if(void 0!==o){const l=r.morphTargetsRelative,h=e.morphTargetInfluences;for(let e=0,r=o.length;e<r;e++){const r=h[e];if(0===r)continue;const c=o[e];l?(i+=c.getX(t/3)*r,n+=c.getY(t/3)*r,s+=c.getZ(t/3)*r):(i+=(c.getX(t/3)-a[t])*r,n+=(c.getY(t/3)-a[t+1])*r,s+=(c.getZ(t/3)-a[t+2])*r)}}D.pushVertex(i,n,s)}if(void 0!==n.normal){const t=n.normal.array;for(let e=0,i=t.length;e<i;e+=3)D.pushNormal(t[e],t[e+1],t[e+2])}if(void 0!==n.color){const t=n.color.array;for(let e=0,i=t.length;e<i;e+=3)D.pushColor(t[e],t[e+1],t[e+2])}if(void 0!==n.uv){const t=n.uv.array;for(let e=0,i=t.length;e<i;e+=2)D.pushUv(t[e],t[e+1])}if(null!==r.index){const n=r.index.array;if(s.length>0)for(let r=0;r<s.length;r++){const a=s[r];if(t=!0===i?e.material[a.materialIndex]:e.material,void 0!==t)for(let e=a.start,i=a.start+a.count;e<i;e+=3)D.pushTriangle(n[e],n[e+1],n[e+2],t)}else for(let e=0,i=n.length;e<i;e+=3)D.pushTriangle(n[e],n[e+1],n[e+2],t)}else if(s.length>0)for(let n=0;n<s.length;n++){const r=s[n];if(t=!0===i?e.material[r.materialIndex]:e.material,void 0!==t)for(let e=r.start,i=r.start+r.count;e<i;e+=3)D.pushTriangle(e,e+1,e+2,t)}else for(let e=0,i=a.length/3;e<i;e+=3)D.pushTriangle(e,e+1,e+2,t)}else if(r.isGeometry)return void console.error("THREE.Projector no longer supports Geometry. Use THREE.BufferGeometry instead.")}else if(e.isLine){if(M.multiplyMatrices(w,c),r.isBufferGeometry){const t=r.attributes;if(void 0!==t.position){const i=t.position.array;for(let t=0,e=i.length;t<e;t+=3)D.pushVertex(i[t],i[t+1],i[t+2]);if(void 0!==t.color){const e=t.color.array;for(let t=0,i=e.length;t<i;t+=3)D.pushColor(e[t],e[t+1],e[t+2])}if(null!==r.index){const t=r.index.array;for(let e=0,i=t.length;e<i;e+=2)D.pushLine(t[e],t[e+1])}else{const t=e.isLineSegments?2:1;for(let e=0,n=i.length/3-1;e<n;e+=t)D.pushLine(e,e+1)}}}else if(r.isGeometry)return void console.error("THREE.Projector no longer supports Geometry. Use THREE.BufferGeometry instead.")}else if(e.isPoints){if(M.multiplyMatrices(w,c),r.isGeometry)return void console.error("THREE.Projector no longer supports Geometry. Use THREE.BufferGeometry instead.");if(r.isBufferGeometry){const t=r.attributes;if(void 0!==t.position){const n=t.position.array;for(let t=0,r=n.length;t<r;t+=3)x.set(n[t],n[t+1],n[t+2],1),x.applyMatrix4(M),R(x,e,i)}}}else e.isSprite&&(e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),x.set(c.elements[12],c.elements[13],c.elements[14],1),x.applyMatrix4(w),R(x,e,i))}return!0===a&&g.elements.sort(B),g}}}(class extends Td{constructor(t){super(),this.node=t}}).prototype.isSVGObject=!0;class Sy{constructor(){let t,e,i,n,r,s,a,o,l,h,c,d,u,f=0,m=null,p=1;const g=this,_=new K_,x=new K_,y=new ac,A=new ac,v=new ac,b=new ac,w=new ac,M=new ac,T=new gc,S=new gc,C=new gc,P=new Qh,E=new Vc,k=new Vc,D=[],z=new Ty,O=document.createElementNS("http://www.w3.org/2000/svg","svg");function R(){for(f=0;O.childNodes.length>0;)O.removeChild(O.childNodes[0])}function L(t){return null!==m?t.toFixed(m):t}function B(t,e,i){let n=e.scale.x*s,r=e.scale.y*a;i.isPointsMaterial&&(n*=i.size,r*=i.size);const o="M"+L(t.x-.5*n)+","+L(t.y-.5*r)+"h"+L(n)+"v"+L(r)+"h"+L(-n)+"z";let l="";(i.isSpriteMaterial||i.isPointsMaterial)&&(l="fill:"+i.color.getStyle()+";fill-opacity:"+i.opacity),j(l,o)}function N(t,e,i){const n="M"+L(t.positionScreen.x)+","+L(t.positionScreen.y)+"L"+L(e.positionScreen.x)+","+L(e.positionScreen.y);if(i.isLineBasicMaterial){let t="fill:none;stroke:"+i.color.getStyle()+";stroke-opacity:"+i.opacity+";stroke-width:"+i.linewidth+";stroke-linecap:"+i.linecap;i.isLineDashedMaterial&&(t=t+";stroke-dasharray:"+i.dashSize+","+i.gapSize),j(t,n)}}function F(t,e,n,r,s){g.info.render.vertices+=3,g.info.render.faces++;const a="M"+L(t.positionScreen.x)+","+L(t.positionScreen.y)+"L"+L(e.positionScreen.x)+","+L(e.positionScreen.y)+"L"+L(n.positionScreen.x)+","+L(n.positionScreen.y)+"z";let o="";s.isMeshBasicMaterial?(y.copy(s.color),s.vertexColors&&y.multiply(r.color)):s.isMeshLambertMaterial||s.isMeshPhongMaterial||s.isMeshStandardMaterial?(A.copy(s.color),s.vertexColors&&A.multiply(r.color),y.copy(v),S.copy(t.positionWorld).add(e.positionWorld).add(n.positionWorld).divideScalar(3),function(t,e,i,n){for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.color;if(s.isDirectionalLight){const t=T.setFromMatrixPosition(s.matrixWorld).normalize();let e=i.dot(t);if(e<=0)continue;e*=s.intensity,n.r+=a.r*e,n.g+=a.g*e,n.b+=a.b*e}else if(s.isPointLight){const t=T.setFromMatrixPosition(s.matrixWorld);let r=i.dot(T.subVectors(t,e).normalize());if(r<=0)continue;if(r*=0==s.distance?1:1-Math.min(e.distanceTo(t)/s.distance,1),0==r)continue;r*=s.intensity,n.r+=a.r*r,n.g+=a.g*r,n.b+=a.b*r}}}(i,S,r.normalModel,y),y.multiply(A).add(s.emissive)):s.isMeshNormalMaterial&&(C.copy(r.normalModel).applyMatrix3(P).normalize(),y.setRGB(C.x,C.y,C.z).multiplyScalar(.5).addScalar(.5)),o=s.wireframe?"fill:none;stroke:"+y.getStyle()+";stroke-opacity:"+s.opacity+";stroke-width:"+s.wireframeLinewidth+";stroke-linecap:"+s.wireframeLinecap+";stroke-linejoin:"+s.wireframeLinejoin:"fill:"+y.getStyle()+";fill-opacity:"+s.opacity,j(o,a)}function I(t,e,i){let n=e.x-t.x,r=e.y-t.y;const s=n*n+r*r;if(0===s)return;const a=i/Math.sqrt(s);n*=a,r*=a,e.x+=n,e.y+=r,t.x-=n,t.y-=r}function j(t,e){u===t?d+=e:(q(),u=t,d=e)}function q(){d&&(c=function(t){if(null==D[t])return D[t]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==p&&D[t].setAttribute("shape-rendering","crispEdges"),D[t];return D[t]}(f++),c.setAttribute("d",d),c.setAttribute("style",u),O.appendChild(c)),d="",u=""}this.domElement=O,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(t){switch(t){case"high":p=1;break;case"low":p=0}},this.setClearColor=function(t){M.set(t)},this.setPixelRatio=function(){},this.setSize=function(t,e){n=t,r=e,s=n/2,a=r/2,O.setAttribute("viewBox",-s+" "+-a+" "+n+" "+r),O.setAttribute("width",n),O.setAttribute("height",r),_.min.set(-s,-a),_.max.set(s,a)},this.getSize=function(){return{width:n,height:r}},this.setPrecision=function(t){m=t},this.clear=function(){R(),O.style.backgroundColor=M.getStyle()},this.render=function(n,r){if(r instanceof Lu==!1)return void console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");const c=n.background;c&&c.isColor?(R(),O.style.backgroundColor=c.getStyle()):!0===this.autoClear&&this.clear(),g.info.render.vertices=0,g.info.render.faces=0,E.copy(r.matrixWorldInverse),k.multiplyMatrices(r.projectionMatrix,E),t=z.projectScene(n,r,this.sortObjects,this.sortElements),e=t.elements,i=t.lights,P.getNormalMatrix(r.matrixWorldInverse),function(t){v.setRGB(0,0,0),b.setRGB(0,0,0),w.setRGB(0,0,0);for(let e=0,i=t.length;e<i;e++){const i=t[e],n=i.color;i.isAmbientLight?(v.r+=n.r,v.g+=n.g,v.b+=n.b):i.isDirectionalLight?(b.r+=n.r,b.g+=n.g,b.b+=n.b):i.isPointLight&&(w.r+=n.r,w.g+=n.g,w.b+=n.b)}}(i),d="",u="";for(let t=0,i=e.length;t<i;t++){const i=e[t],n=i.material;if(void 0!==n&&0!==n.opacity)if(x.makeEmpty(),i instanceof My)o=i,o.x*=s,o.y*=-a,B(o,i,n);else if(i instanceof wy)o=i.v1,l=i.v2,o.positionScreen.x*=s,o.positionScreen.y*=-a,l.positionScreen.x*=s,l.positionScreen.y*=-a,x.setFromPoints([o.positionScreen,l.positionScreen]),!0===_.intersectsBox(x)&&N(o,l,n);else if(i instanceof vy){if(o=i.v1,l=i.v2,h=i.v3,o.positionScreen.z<-1||o.positionScreen.z>1)continue;if(l.positionScreen.z<-1||l.positionScreen.z>1)continue;if(h.positionScreen.z<-1||h.positionScreen.z>1)continue;o.positionScreen.x*=s,o.positionScreen.y*=-a,l.positionScreen.x*=s,l.positionScreen.y*=-a,h.positionScreen.x*=s,h.positionScreen.y*=-a,this.overdraw>0&&(I(o.positionScreen,l.positionScreen,this.overdraw),I(l.positionScreen,h.positionScreen,this.overdraw),I(h.positionScreen,o.positionScreen,this.overdraw)),x.setFromPoints([o.positionScreen,l.positionScreen,h.positionScreen]),!0===_.intersectsBox(x)&&F(o,l,h,i,n)}}q(),n.traverseVisible((function(t){if(t.isSVGObject){if(T.setFromMatrixPosition(t.matrixWorld),T.applyMatrix4(k),T.z<-1||T.z>1)return;const e=T.x*s,i=-T.y*a,n=t.node;n.setAttribute("transform","translate("+e+","+i+")"),O.appendChild(n)}}))}}}let Cy=_x;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:eh}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=eh);const Py={kDecimals:y(7),kTickPlus:y(9),kTickMinus:y(10),kAxisRange:y(11),kCenterTitle:y(12),kCenterLabels:y(14),kRotateTitle:y(15),kPalette:y(16),kNoExponent:y(17),kLabelsHori:y(18),kLabelsVert:y(19),kLabelsDown:y(20),kLabelsUp:y(21),kIsInteger:y(22),kMoreLogLabels:y(23),kOppositeTitle:y(32)};function Ey(t,e){return t<.5?e?"%S.%L":"%H:%M:%S.%L":t<30?e?"%Mm%S":"%H:%M:%S":(t/=60)<30?e?"%Hh%M":"%d/%m %H:%M":(t/=60)<12?e?"%d-%Hh":"%d/%m/%y %Hh":(t/=24)<15.218425?e?"%d/%m":"%d/%m/%y":(t/=30.43685)<6?"%d/%m/%y":(t/=12)<2?e?"%m/%y":"%d/%m/%y":"%Y"}const ky={initAxisPainter(){this.name="yaxis",this.kind="normal",this.func=null,this.order=0,this.full_min=0,this.full_max=1,this.scale_min=0,this.scale_max=1,this.ticks=[]},cleanupAxisPainter(){this.ticks=[],delete this.format,delete this.func,delete this.tfunc1,delete this.tfunc2,delete this.gr},assignFrameMembers(t,e){t["gr"+e]=this.gr,t["log"+e]=this.log,t["scale_"+e+"min"]=this.scale_min,t["scale_"+e+"max"]=this.scale_max},convertDate(t){return new Date(this.timeoffset+1e3*t)},revertPoint(t){let e=this.func.invert(t);return"time"==this.kind?(e-this.timeoffset)/1e3:e},formatTime(t,e){return e?this.tfunc1(t):this.tfunc2(t)},formatLog(t,e,i){let n=parseFloat(t),r=Math.round(n);if(!e)return r===n&&Math.abs(r)<1e9?r.toString():rl(n,i||p.fStatFormat);if(n<=0)return null;let s=Math.log10(n),a=this.logbase;return 10!==a&&(s/=Math.log10(a)),this.moreloglabels||Math.abs(s-Math.round(s))<.001?this.noexp||2==e?s<0?n.toFixed(Math.round(.5-s)):n.toFixed(0):this.formatExp(a,Math.floor(s+.01),n):null},formatNormal(t,e,i){let n=parseFloat(t);return e&&this.order&&(n/=Math.pow(10,this.order)),n===Math.round(n)?Math.abs(n)<1e9?n.toFixed(0):n.toExponential(4):e?this.ndig>10?n.toExponential(this.ndig-11):n.toFixed(this.ndig):rl(n,i||p.fStatFormat)},formatExp(t,e,i){let n="";if(i&&0!=(i=Math.round(i/Math.pow(t,e)))&&1!=i&&(n=i.toString()+(m.Latex?"#times":"x")),Math.abs(t-Math.exp(1))<.001?n+="e":n+=t.toString(),m.Latex>f.Latex.Symbols)return n+"^{"+e+"}";const r={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻"};let s=e.toString();for(let t=0;t<s.length;++t)n+=r[s[t]];return n},axisAsText(t,e){return"time"==this.kind&&(t=this.convertDate(t)),this.format?this.format(t,!1,e):t.toPrecision(4)},poduceLogTicks(t,e){const i=t=>{let e=0,i=0;for(let n=1;n<t.length;++n){let r=t[n]-t[n-1];e+=r,i+=r*r}let n=e/(t.length-1),r=i/(t.length-1)-n*n;return r<=0||!(Math.abs(n)<1e-100)&&Math.sqrt(r)/n<1e-6};let n=t.ticks(e);for(;e>4&&i(n);)e=Math.round(.8*e),n=t.ticks(e);if(e<5&&i(n)&&this.logbase&&10!=this.logbase){let t=[];n.forEach((e=>{let i=Math.log10(e)/Math.log10(this.logbase);Math.abs(Math.round(i)-i)<.01&&t.push(e)})),t.length>0&&(n=t)}return n},produceTicks(t,e){if(!this.noticksopt){let i=t*(e||1);if(this.log)return this.poduceLogTicks(this.func,i);let n=this.func.domain();const r=t=>t.length<=i||!(t.length>i+1)&&(t[0]===n[0]||t[i]===n[1]);let s=this.func.ticks(i);if(e||r(s))return s;let a=this.func.ticks(Math.round(.7*i));return a.length>2&&r(a)?a:s}let i=this.func.domain(),n=[];e&&(t=(t-1)*e);for(let e=0;e<=t;++e)n.push((i[0]*(t-e)+i[1]*e)/t);return n},analyzeWheelEvent(t,e,i,n){i||(i={});let r=0,s=1,a=1;if("dleft"in i&&(s=i.dleft,r=1),"dright"in i&&(a=i.dright,r=1),i.delta?r=i.delta:t&&(r=t.wheelDelta?-t.wheelDelta:t.deltaY||t.detail),!r||n&&i.ignore)return;r=r<0?-.2:.2,s*=r,a*=r;let o=i.min=this.scale_min,l=i.max=this.scale_max,h=this.full_min,c=this.full_max;if(i.min===i.max&&r<0&&(i.min=h,i.max=c),!(i.min>=i.max)){if(i.reverse&&(e=1-e),e>0&&e<1){if(this.log){let t=i.min>0?Math.log10(i.max/i.min):2;t>10?t=10:t<.01&&(t=.01),i.min=i.min/Math.pow(10,t*s*e),i.max=i.max*Math.pow(10,t*a*(1-e))}else if(s!==-a||i.reverse){let t=i.max-i.min,n=t;s>0&&(t=1.001*t/(1-s)),i.min+=-s*e*t,a>0&&(n=1.001*n/(1-a)),i.max-=-a*(1-e)*n}else{let t=(i.max-i.min)*a*e;Math.round(i.max)===i.max&&Math.round(i.min)===i.min&&Math.abs(t)>1&&(t=Math.round(t)),i.min+t<h?t=h-i.min:i.max+t>c&&(t=c-i.max),0!=t?(i.min+=t,i.max+=t):(delete i.min,delete i.max)}i.min>=i.max?i.min=i.max=void 0:s!==a?(i.min<h&&o===h||i.max>c&&l===c)&&(i.min=i.max=void 0):(i.min<h&&(i.min=h),i.max>c&&(i.max=c))}else i.min=i.max=void 0;return i.changed=void 0!==i.min&&void 0!==i.max,i}}};class Dy extends Vl{constructor(t,e,i){super(t,e),Object.assign(this,ky),this.initAxisPainter(),this.embedded=i,this.invert_side=!1,this.lbls_both_sides=!1}cleanup(){this.cleanupAxisPainter(),super.cleanup()}getAxisType(){return"TAxis"}configureAxis(t,e,i,n,r,s,a,o){this.name=t,this.full_min=e,this.full_max=i,this.kind="normal",this.vertical=s,this.log=o.log||0,this.symlog=o.symlog||!1,this.reverse=o.reverse||!1,this.swap_side=o.swap_side||!1,this.fixed_ticks=o.fixed_ticks||null,this.max_tick_size=o.max_tick_size||0;let l=this.getObject();if(o.time_scale||l.fTimeDisplay?(this.kind="time",this.timeoffset=function(t){let e=7889184e5;if(!t)return e;let i=t.fTimeFormat.indexOf("%F");if(i<0)return 1e3*p.fTimeOffset;let n=t.fTimeFormat.slice(i+2);if(0==n.indexOf("1995-01-01 00:00:00s0"))return e;if("0"==n||""==n)return 0;const r=(t,e,i)=>{let r=n.indexOf(t);if(r<0)return e;let s=parseInt(n.slice(0,r));return n=n.slice(r+1),!Number.isInteger(s)||s<e||s>i?e:s},s=r("-",1970,2300),a=r("-",1,12)-1,o=r(" ",1,31),l=r(":",0,23),h=r(":",0,59),c=r("s",0,59),d=r(" ",0,999),u=new Date(Date.UTC(s,a,o,l,h,c,d));let f=u.getTime();if(n=n.toUpperCase(),0==n.indexOf("GMT")&&(f+=6e4*u.getTimezoneOffset(),n=n.slice(4).trim(),n.length>3)){let t=0,e=1e3;"-"==n[0]&&(t=1,e=-1e3),f-=e*(3600*parseInt(n.slice(t,t+2))+60*parseInt(n.slice(t+2,t+4)))}return f}(l)):this.kind=l.fLabels?"labels":"normal","time"==this.kind)this.func=Da().domain([this.convertDate(n),this.convertDate(r)]);else if(this.log){if(this.logbase=2===this.log?2:10,r<=0&&(r=1),n<=0&&l&&!o.logcheckmin)for(let t=0;t<l.fNbins&&!((n=Math.max(n,l.GetBinLowEdge(t+1)))>0);++t);n<=0&&o.log_min_nz&&(n=o.log_min_nz),(n<=0||n>=r)&&(n=r*(o.logminfactor||1e-4)),this.func=mr().base(2==this.log?2:10).domain([n,r])}else if(this.symlog){let t=Math.max(Math.abs(n),Math.abs(r));Number.isInteger(this.symlog)&&this.symlog>0?t*=Math.pow(10,-1*this.symlog):t*=.01,this.func=xr().constant(t).domain([n,r])}else this.func=sr().domain([n,r]);if(this.vertical^this.reverse){let t=a[0];a[0]=a[1],a[1]=t}this.func.range(a),this.scale_min=n,this.scale_max=r,"time"==this.kind?this.gr=t=>this.func(this.convertDate(t)):this.log?this.gr=t=>t<this.scale_min?this.vertical?this.func.range()[0]+5:-5:this.func(t):this.gr=this.func;let h=l&&"TGaxis"===l._typename;delete this.format;let c=508;h?c=l.fNdiv:l&&(c=Math.max(l.fNdivisions,4)),this.nticks=c%100,this.nticks2=(c%1e4-this.nticks)/100,this.nticks3=Math.floor(c/1e4),l&&!h&&this.nticks>20&&(this.nticks=20);let d=Math.abs(this.func.range()[1]-this.func.range()[0]);if(d<=0&&(d=100),"time"==this.kind){this.nticks>8&&(this.nticks=8);let t=this.scale_max-this.scale_min,e=l.fTimeFormat.indexOf("%F"),i=e>=0?l.fTimeFormat.slice(0,e):l.fTimeFormat,n=Ey(t/d,!1);(0==i.length||t<.1*(this.full_max-this.full_min))&&(i=Ey(t/this.nticks,!0)),this.tfunc1=this.tfunc2=os(i),n!==i&&(this.tfunc2=os(n)),this.format=this.formatTime}else if(this.log)this.nticks2>1&&(this.nticks*=this.nticks2,this.nticks2=1),this.noexp=!!l&&l.TestBit(Py.kNoExponent),this.scale_max<300&&this.scale_min>.3&&(this.noexp=!0),this.moreloglabels=!!l&&l.TestBit(Py.kMoreLogLabels),this.format=this.formatLog;else if("labels"==this.kind){this.nticks=50;let t=this.scale_max-this.scale_min;this.nticks>t&&(this.nticks=Math.round(t)),this.regular_labels=!0,l&&l.fNbins&&l.fLabels&&(l.fNbins==Math.round(l.fXmax-l.fXmin)&&0==l.fXmin&&l.fXmax==l.fNbins||(this.regular_labels=!1)),this.nticks2=1,this.format=this.formatLabels}else this.order=0,this.ndig=0,this.format=this.formatNormal}getScaleMin(){return this.func?this.func.domain()[0]:0}getScaleMax(){return this.func?this.func.domain()[1]:0}formatLabels(t){let e=parseFloat(t),i=this.getObject();if(e=this.regular_labels?Math.floor(e):Math.round((e-i.fXmin)/(i.fXmax-i.fXmin)*i.fNbins),e<0||e>=i.fNbins)return null;for(let t=0;t<i.fLabels.arr.length;++t){let n=i.fLabels.arr[t];if(n.fUniqueID===e+1)return n.fString}return null}createTicks(t,e,i,n){i&&this.nticks&&"normal"==this.kind&&(this.noticksopt=!0);let r,s={nminor:0,nmiddle:0,nmajor:0,func:this.func};if(this.fixed_ticks)r=[],this.fixed_ticks.forEach((t=>{t>=this.scale_min&&t<=this.scale_max&&r.push(t)}));else if("labels"!=this.kind||this.regular_labels)r=this.produceTicks(this.nticks);else{r=[],s.lbl_pos=[];let t=this.getObject();for(let e=0;e<t.fNbins;++e){let i=t.fXmin+e/t.fNbins*(t.fXmax-t.fXmin);i>=this.scale_min&&i<this.scale_max&&(s.lbl_pos.push(i),i>this.scale_min&&r.push(i))}}if(s.minor=s.middle=s.major=r,t){let t=s.major,e=1e-5*(this.scale_max-this.scale_min);return t[0]>this.scale_min+e&&t.unshift(this.scale_min),t[t.length-1]<this.scale_max-e&&t.push(this.scale_max),t}if(this.nticks2>1&&(!this.log||10===this.logbase)&&!this.fixed_ticks){s.minor=s.middle=this.produceTicks(s.major.length,this.nticks2);let t=Math.abs(this.func.range()[1]-this.func.range()[0]);s.middle.length<=s.major.length||s.middle.length>t/3.5?s.minor=s.middle=s.major:this.nticks3>1&&!this.log&&(s.minor=this.produceTicks(s.middle.length,this.nticks3),(s.minor.length<=s.middle.length||s.minor.length>t/1.7)&&(s.minor=s.middle))}if(s.reset=function(){this.nminor=this.nmiddle=this.nmajor=0},s.next=function(t){return!(this.nminor>=this.minor.length)&&(this.tick=this.minor[this.nminor++],this.grpos=this.func(this.tick),t&&(this.grpos=Math.round(this.grpos)),this.kind=3,this.nmiddle<this.middle.length&&Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))<1&&(this.nmiddle++,this.kind=2),this.nmajor<this.major.length&&Math.abs(this.grpos-this.func(this.major[this.nmajor]))<1&&(this.nmajor++,this.kind=1),!0)},s.last_major=function(){return 1===this.kind&&this.nmajor==this.major.length},s.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])},this.order=0,this.ndig=0,"normal"==this.kind&&!this.log&&s.major.length>0){let t=0,i=0,r=!1;if(!e){let e=Math.max(Math.abs(s.major[0]),Math.abs(s.major[s.major.length-1])),n=Math.min(Math.abs(s.major[0]),Math.abs(s.major[s.major.length-1])),a=e>0?3*Math.round(Math.log10(e)/3):0,o=n>0?3*Math.round(Math.log10(n)/3):0;r=e<2e4,(e||n)&&(t=Math.max(a,o)+3,i=Math.min(a,o)-3)}let a=0,o=this.ndig,l=1e10;for(let e=i;e<=t;e+=3){if(r&&3===e)continue;this.order=e,this.ndig=0;let t=[],i=0,n=0;for(;i<s.major.length;){let e=this.format(s.major[i],!0);if(t.indexOf(e)<0)t.push(e),n+=e.length,i++;else{if(++this.ndig>15)break;t=[],i=0,n=0}}!e&&this.ndig<4&&(n-=2*s.major.length+3),n<l&&(l=n,a=this.order,o=this.ndig)}this.order=a,this.ndig=o,n&&(this.order&&console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable"),this.ndig&&console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required"),this.ndig=0,this.order=0)}return s}isCenteredLabels(){if("labels"===this.kind)return!0;if(this.log)return!1;let t=this.getObject();return t&&t.TestBit(Py.kCenterLabels)}addTitleDrag(t,e,i,n,r){if(!m.MoveResize||l())return;let s,a,o,h,c,d,u,f=null,p=Ki().subject(Object);p.on("start",(i=>{i.sourceEvent.preventDefault(),i.sourceEvent.stopPropagation();let l=t.node().getBBox(),m=this.getObject(),p=e?l.height:l.width,g=m.TestBit(Py.kOppositeTitle);o=s=t.property("shift_x"),h=a=t.property("shift_y"),c=e?s>0:a>0,d=e?[r,r/2,0]:[0,r/2,r];let _=e?-p/2:p/2;"middle"==this.title_align?(d[0]+=_,d[2]-=_):"begin"==this.title_align?(d[1]-=_,d[2]-=2*_):(d[0]+=2*_,d[1]+=_),u=m.TestBit(Py.kCenterTitle)?1:n^g?0:2,d[u]=e?a:s,f=t.append("rect").classed("zoom",!0).attr("x",l.x).attr("y",l.y).attr("width",l.width).attr("height",l.height).style("cursor","move")})).on("drag",(i=>{if(!f)return;i.sourceEvent.preventDefault(),i.sourceEvent.stopPropagation(),s+=i.dx,a+=i.dy;let n,r,l=e?a:s,m=0;for(let t=1;t<3;++t)Math.abs(l-d[t])<Math.abs(l-d[m])&&(m=t);e?(n=s,r=d[m]):(r=a,n=d[m]),c===(e?n>0:r>0)&&(o=n,h=r,u=m,t.attr("transform","translate("+o+","+h+")"))})).on("end",(n=>{if(!f)return;n.sourceEvent.preventDefault(),n.sourceEvent.stopPropagation(),t.property("shift_x",o).property("shift_y",h);let r=this.getObject(),s=Py;const a=(t,e)=>{r.TestBit(t)!=e&&r.InvertBit(t)};r.fTitleOffset=(e?o:h)/i,1==u?(a(s.kCenterTitle,!0),a(s.kOppositeTitle,!1)):0==u?(a(s.kCenterTitle,!1),a(s.kOppositeTitle,!0)):(a(s.kCenterTitle,!1),a(s.kOppositeTitle,!1)),f.remove(),f=null})),t.style("cursor","move").call(p)}produceTicksPath(t,e,i,n,r,s){let a="",o="",l=0,h=0;for(this.ticks=[];t.next(!0);){let s=Math.round(i/4),c=0;t.kind<3&&(s=Math.round(i/2)),1==t.kind&&(null!==this.format(t.tick,!0)&&(s=i),this.ticks.push(t.grpos)),n>0?c=-s:e<0&&(c=-s,s=0),0==a.length?(a=this.vertical?`M${s},${t.grpos}`:`M${t.grpos},${-s}`,o=this.vertical?`M${r-s},${t.grpos}`:`M${t.grpos},${r+s}`):(a+=this.vertical?`m${s-h},${t.grpos-l}`:`m${t.grpos-l},${h-s}`,o+=this.vertical?`m${h-s},${t.grpos-l}`:`m${t.grpos-l},${s-h}`),a+=this.vertical?"h"+(c-s):"v"+(s-c),o+=this.vertical?"h"+(s-c):"v"+(c-s),l=t.grpos,h=c}return 0!==r&&(a+=o),s?a:""}findLabelModifier(t,e,i){if(!t.fModLabs)return null;for(let n=0;n<t.fModLabs.arr.length;++n){let r=t.fModLabs.arr[n];if(r.fLabNum===e+1)return r;if(r.fLabNum<0&&e===i+r.fLabNum)return r}return null}drawLabels(t,e,i,n,r,s,a,o,l,h,c){let d=this.getColor(e.fLabelColor),u=this.isCenteredLabels(),f=e.TestBit(Py.kLabelsVert),m=1,p=0,g=0,_=[t.append("svg:g").attr("class","axis_labels")],x=r.lbl_pos||r.major,y=!1,A=0;function v(t){let e=this.result_width;if(A=Math.max(A,e),e&&(!t.vertical&&!f||t.vertical&&f)&&!t.log){let t=.45*this.gap_before+.45*this.gap_after;this.gap_before?this.gap_after||(t=.9*this.gap_before):t=.9*this.gap_after,m=Math.min(m,t/e)}else t.vertical&&c&&this.normal_side&&c-o>20&&e>c-o&&(m=Math.min(m,(c-o)/e));m>1e-4&&m<.7&&!t.vertical&&!f&&p>5&&1==_.length&&(y=!0);let i=m*(y?3:1);i>1e-4&&i<1&&(g=1/i,t.scaleTextDrawing(g,_[0]))}this.lbls_both_sides&&_.push(t.append("svg:g").attr("class","axis_labels").attr("transform",this.vertical?`translate(${i})`:`translate(0,${-n})`));const b=new fl(e.fLabelFont,a);for(let t=0;t<_.length;++t){t>0&&(s=-s);let r=0,c=this.vertical?-o*s:(o+2)*s+h*l;this.startTextDrawing(b,"font",_[t]);for(let o=0;o<x.length;++o){let l=this.format(x[o],!0);if(null===l)continue;let h=this.findLabelModifier(e,o,x.length);if(h&&0==h.fTextSize)continue;h&&h.fLabText&&(l=h.fLabText);let g={text:l,color:d,latex:1,draw_g:_[t],normal_side:0==t},y=Math.round(this.func(x[o]));if(h&&h.fTextColor>0&&(g.color=this.getColor(h.fTextColor)),g.gap_before=o>0?Math.abs(Math.round(y-this.func(x[o-1]))):0,g.gap_after=o<x.length-1?Math.abs(Math.round(this.func(x[o+1])-y)):0,u){let t=g.gap_after||g.gap_before;if(y=Math.round(y-(this.vertical?.5*t:-.5*t)),y<-5||y>(this.vertical?n:i)+5)continue}if(p=Math.max(p,l.length),this.vertical?(g.x=c,g.y=y,g.align=f?s<0?23:20:s<0?12:32):(g.x=y,g.y=c,g.align=f?s<0?12:32:s<0?20:23),f&&(g.rotate=270),0==t&&(g.post_process=v),this.drawText(g),r&&y!=r&&(this.vertical&&!f||!this.vertical&&f)){let t=Math.abs(y-r);m=Math.min(m,.9*t/a)}r=y}this.order&&this.drawText({color:d,x:this.vertical?5*s:i+5,y:this.has_obstacle?c:this.vertical?-3:-3*s,align:this.vertical?s<0?30:10:this.has_obstacle^s<0?13:10,latex:1,text:"#times"+this.formatExp(10,this.order),draw_g:_[t]})}return this.finishTextDrawing(_[0],!0).then((()=>{if(_.length>1)return g&&this.scaleTextDrawing(g,_[1]),this.finishTextDrawing(_[1],!0)})).then((()=>(y&&_[0].selectAll("text").each((function(){let t=Ii(this),e=t.attr("transform");t.attr("transform",e+" rotate(25)").style("text-anchor","start")})),b&&(a=b.size),[a,A])))}drawAxis(t,e,i,n,r,s,a,o){let h,c,d=this.getObject(),u="",f=d&&"TGaxis"===d._typename,p=t,g=!0,_=this.getPadPainter(),x=_?_.getPadWidth():10,y=_?_.getPadHeight():10,A=this.vertical,v=this.swap_side||!1;r?this.invert_side&&(r=-r):r=0,f?(this.createAttLine({attr:d}),g=0!=d.fLineColor,u=d.fChopt,h=d.fTickSize,c=A?1.7*i:.6*e):(this.createAttLine({color:d.fAxisColor,width:1,style:1}),u=A^this.invert_side?"-S":"+S",h=d.fTickLength,c=A?x:y),this.lineatt.not_standard=!0,f&&"zaxis"!==this.name||(p=t.select("."+this.name+"_container"),p.empty()?p=t.append("svg:g").attr("class",this.name+"_container"):p.selectAll("*").remove());let b="";g&&(b="M0,0"+(A?`v${i}`:`h${e}`),0!==r&&(b+=A?`M${r},0v${i}`:`M0,${r}h${e}`)),p.attr("transform",n||null);let w=1,M=0,T=Math.min(x,y),S=u.indexOf("+")>=0,C=u.indexOf("-")>=0,P=u.indexOf("S")>=0,E=u.indexOf("U")>=0||this.optionUnlab,k=u.indexOf("N")>=0,D=u.indexOf("I")>=0,z=d.TestBit(Py.kNoExponent);T<=0&&(T=1e-4),f&&d.TestBit(Py.kTickPlus)&&(S=!0),f&&d.TestBit(Py.kTickMinus)&&(C=!0),S&&C?(w=1,M=1):C?w=v^A?1:-1:S&&(w=v^A?-1:1),h=Math.round((P?h:.03)*c),this.max_tick_size&&h>this.max_tick_size&&(h=this.max_tick_size);const O=this.createTicks(!1,z,k,D);b+=this.produceTicksPath(O,w,h,M,r,g&&!s&&!this.disable_ticks),s||!b||this.lineatt.empty()||p.append("svg:path").attr("d",b).call(this.lineatt.func);let R=Math.round(d.fLabelSize<1?d.fLabelSize*T:d.fLabelSize),L=Math.round(Math.abs(d.fLabelOffset)*T);(R<=0||Math.abs(d.fLabelOffset)>1.1)&&(E=!0);let B=0,N=0,F=null,I=null,j=0,q=Promise.resolve([R,0]),U=0;return s||E||(q=this.drawLabels(p,d,e,i,O,w,R,L,h,M,a)),q.then((t=>{if(U=t[1],m.Zooming&&!this.disable_zooming&&!l()){let n=Math.max(t[0],5),r=p.append("svg:rect").attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair");if(A){let t=(U||2*n)+3;r.attr("x",w>0?-t:0).attr("y",0).attr("width",t).attr("height",i)}else r.attr("x",0).attr("y",w>0?0:-n-3).attr("width",e).attr("height",n+3)}if(this.position=0,o){let t=p.node(),e=this.getPadSvg().node();if(t&&e&&t.getBoundingClientRect&&e.getBoundingClientRect){let i=t.getBoundingClientRect(),n=e.getBoundingClientRect();this.position=i.left-n.left}t&&!e&&console.warn("Why PAD element missing when search for position")}if(!d.fTitle||s)return!0;F=p.append("svg:g").attr("class","axis_title"),j=d.fTitleSize>=1?d.fTitleSize:Math.round(d.fTitleSize*T);let n=1.6*(d.fTitleSize<1?d.fTitleSize:d.fTitleSize/(T||10)),r=d.TestBit(Py.kCenterTitle),a=d.TestBit(Py.kOppositeTitle),c=d.TestBit(Py.kRotateTitle)?-1:1,u=this.getColor(f?d.fTextColor:d.fTitleColor);this.startTextDrawing(d.fTitleFont,j,F);let g=v^a,_=c<0^g;if(this.title_align=r?"middle":_?"begin":"end",A){if(n*=-w*x,B=Math.round(n*d.fTitleOffset),"zaxis"==this.name&&f&&"getBoundingClientRect"in p.node()){let t=p.node().getBoundingClientRect();B<t.width-h&&(B=Math.round(t.width-h))}N=Math.round(r?i/2:g?i:0),this.drawText({align:this.title_align+";middle",rotate:c<0?90:270,text:d.fTitle,color:u,draw_g:F})}else n*=w*y,B=Math.round(r?e/2:g?0:e),N=Math.round(n*d.fTitleOffset),this.drawText({align:this.title_align+";middle",rotate:c<0?180:0,text:d.fTitle,color:u,draw_g:F});return A&&0==d.fTitleOffset&&"getBoundingClientRect"in p.node()&&(I=p.node().getBoundingClientRect()),this.addTitleDrag(F,A,n,v,A?i:e),this.finishTextDrawing(F)})).then((()=>{if(F){if(I){let t=F.node().getBoundingClientRect();B=I.left!=I.right&&t.left!=t.right?w>0?Math.round(I.left-t.right-.3*j):Math.round(I.right-t.left+.3*j):-1*Math.round((w>0?L+U:0)+.7*j)}F.attr("transform",`translate(${B},${N})`).property("shift_x",B).property("shift_y",N)}return this}))}convertTo(t){let e=this.getObject(),i=this.axisToSvg("x",e.fX1),n=this.axisToSvg("y",e.fY1),r=this.axisToSvg("x",e.fX2),s=this.axisToSvg("y",e.fY2);if("ndc"==t){let t=this.getPadPainter().getPadWidth(),a=this.getPadPainter().getPadHeight();e.fX1=i/t,e.fX2=r/t,e.fY1=(a-n)/a,e.fY2=(a-s)/a,this.use_ndc=!0}else if("frame"==t){let t=this.getFramePainter().getFrameRect();e.fX1=(i-t.x)/t.width,e.fX2=(r-t.x)/t.width,e.fY1=(n-t.y)/t.height,e.fY2=(s-t.y)/t.height,this.bind_frame=!0}}redraw(){let t,e,i,n,r=this.getObject();if(this.bind_frame){let s=this.getFramePainter().getFrameRect();t=Math.round(s.x+r.fX1*s.width),i=Math.round(s.x+r.fX2*s.width),e=Math.round(s.y+r.fY1*s.height),n=Math.round(s.y+r.fY2*s.height)}else t=this.axisToSvg("x",r.fX1,this.use_ndc),e=this.axisToSvg("y",r.fY1,this.use_ndc),i=this.axisToSvg("x",r.fX2,this.use_ndc),n=this.axisToSvg("y",r.fY2,this.use_ndc);let s=i-t,a=e-n,o=Math.abs(s)<Math.abs(a),l=o?a:s,h=!1,c=r.fWmin,d=r.fWmax;return l<0&&(h=!0,l=-l,o?n=e:t=i),this.configureAxis(o?"yaxis":"xaxis",c,d,c,d,o,[0,l],{time_scale:r.fChopt.indexOf("t")>=0,log:r.fChopt.indexOf("G")>=0?1:0,reverse:h,swap_side:h}),this.createG(),this.drawAxis(this.getG(),Math.abs(s),Math.abs(a),`translate(${t},${n})`)}}const zy=new xx(Cy);function Oy(t,e,i){if(t){void 0!==i&&(globalThis.docuemnt=i);let t=new Sy;return t.setPrecision(e),t}const n=";stroke-opacity:1;stroke-width:1;stroke-linecap:round",r=";fill-opacity:1";let s={svg_attr:{},svg_style:{},path_attr:{},accPath:"",createElementNS:function(t,e){return"path"==e?{_wrapper:this,setAttribute:function(t,e){if("style"==t&&e){let t=e.indexOf(n);t>=0&&t==e.length-n.length&&(e=e.slice(0,e.length-n.length));let i=e.indexOf(r);i>=0&&i==e.length-r.length&&(e=e.slice(0,e.length-r.length))}this._wrapper.path_attr[t]=e}}:"svg"!=e?(console.error("not supported element for SVGRenderer",e),null):{_wrapper:this,childNodes:[],style:this.svg_style,setAttribute:function(t,e){this._wrapper.svg_attr[t]=e},appendChild:function(t){this._wrapper.accPath+='<path style="'+this._wrapper.path_attr.style+'" d="'+this._wrapper.path_attr.d+'"/>',this._wrapper.path_attr={}},removeChild:function(t){this.childNodes=[]}}}},a=globalThis.document;globalThis.document=s;let o=new Sy;return globalThis.document=a,o.doc_wrapper=s,o.originalRender=o.render,o.render=function(t,e){let i=globalThis.document;globalThis.document=this.doc_wrapper,this.originalRender(t,e),globalThis.document=i},o.clearHTML=function(){this.doc_wrapper.accPath=""},o.makeOuterHTML=function(){let t=this.doc_wrapper,e=' viewBox="'+t.svg_attr.viewBox+'" width="'+t.svg_attr.width+'" height="'+t.svg_attr.height+'"',i="";return t.svg_style.backgroundColor&&(i=' style="background:'+t.svg_style.backgroundColor+'"'),'<svg xmlns="http://www.w3.org/2000/svg"'+e+i+">"+t.accPath+"</svg>"},o.setPrecision(e),o}function Ry(t){t||(t=l()?m.Render3DBatch:m.Render3D);let e=f.Render3D;return t==e.Default&&(t=l()?e.WebGLImage:e.WebGL),l()&&t==e.WebGL&&(t=e.WebGLImage),t}let Ly={access3dKind(t){let e=this.getPadSvg();if(e.empty())return-1;let i=e.property("can3d");return void 0!==t&&e.property("can3d",t),null==i?-1:i},getSizeFor3d(t,e){void 0===t&&(t=(t=Ry())!==f.Render3D.WebGL?f.Embed3D.EmbedSVG:m.Embed3D!=f.Embed3D.Default?m.Embed3D:d.isFirefox||d.chromeVersion>95?f.Embed3D.Embed:f.Embed3D.Overlay);let i=this.getPadSvg(),n="draw3d_"+(this.getPadName()||"canvas");if(i.empty()){let t=il(this.selectDom());return t.height<10&&t.width>10&&(t.height=Math.round(.66*t.width),this.selectDom().style("height",t.height+"px")),t.x=0,t.y=0,t.clname=n,t.can3d=-1,t}let r,s=this.getFramePainter(),a=this.getPadPainter();if(s&&s.mode3d&&t>0)r=s.getFrameRect();else{let e=t>0?i:this.getCanvSvg();r={x:0,y:0,width:e.property("draw_width"),height:e.property("draw_height")},isNaN(r.width)||isNaN(r.height)?(r.width=a.getPadWidth(),r.height=a.getPadHeight()):s&&!s.mode3d&&(e=this.getFrameSvg(),r.x=e.property("draw_x"),r.y=e.property("draw_y"))}r.clname=n,r.can3d=t;let o=a?a.getPadRect():null;if(o){let t=Math.round(.07*r.width),e=Math.round(.05*r.height);r.x=Math.max(0,r.x-t),r.y=Math.max(0,r.y-e),r.width=Math.min(r.width+2*t,o.width-r.x),r.height=Math.min(r.height+2*e,o.height-r.y)}return 1===t&&(r=nl(this.getPadSvg(),r)),r},clear3dCanvas(){let t=this.access3dKind(null);if(t<0){let e=this.selectDom().node(),i=e?e.firstChild:null;return i&&!i.$jsroot&&(i=i.nextSibling),i&&i.$jsroot&&(delete i.painter,e.removeChild(i)),t}let e=this.getSizeFor3d(t);if(0===e.can3d)Ii(this.getCanvSvg().node().nextSibling).remove(),this.getCanvSvg().style("display",null);else{if(this.getPadSvg().empty())return;this.apply3dSize(e).remove(),this.getFrameSvg().style("display",null)}return t},add3dCanvas(t,e,i){if(e&&!(t.can3d<-1))if(-1!==t.can3d)if(t.can3d>0&&!i&&(t.can3d=f.Embed3D.EmbedSVG),this.access3dKind(t.can3d),0===t.can3d)this.getCanvSvg().style("display","none"),this.getCanvSvg().node().parentNode.appendChild(e);else{if(this.getPadSvg().empty())return;this.getFrameSvg().style("display","none"),this.apply3dSize(t).attr("title","").node().appendChild(e)}else{let t=this.selectDom().node();null!==t&&(t.appendChild(e),e.painter=this,e.$jsroot=!0)}},apply3dSize(t,e){if(t.can3d<0)return Ii(null);let i;if(t.can3d>1){if(i=this.getLayerSvg(t.clname),e)return i;let n=this.getPadSvg();t.can3d===f.Embed3D.EmbedSVG?(i.empty()&&(i=n.insert("g",".primitives_layer").attr("class",t.clname)),i.attr("transform",`translate(${t.x},${t.y})`)):(i.empty()&&(i=n.insert("foreignObject",".primitives_layer").attr("class",t.clname)),i.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height).attr("viewBox",`0 0 ${t.width} ${t.height}`).attr("preserveAspectRatio","xMidYMid"))}else{let n=this.getCanvSvg().node().parentNode;if(i=Ii(n).select("."+t.clname),e)return i;this.getCanvSvg().property("redraw_by_resize",!0),i.empty()&&(i=Ii(n).append("div").attr("class",t.clname).style("user-select","none"));let r=n.getBoundingClientRect();for(;n;){if(n===document){n=null;break}try{if("static"!==getComputedStyle(n).position)break}catch(t){break}n=n.parentNode}let s=n?n.getBoundingClientRect():{top:0,left:0},a=Math.round(r.left-s.left),o=Math.round(r.top-s.top);i.style("position","absolute").style("left",t.x+a+"px").style("top",t.y+o+"px").style("width",t.width+"px").style("height",t.height+"px")}return i}};function By(t){Object.assign(t,Ly)}function Ny(t,e,i,n){let r=f.Render3D;i=Ry(i),n||(n={antialias:!0,alpha:!0});let a,o=!1,h=g();if(i==r.WebGL)a=new up(n);else if(i==r.SVG)a=Oy(!1,0,h),l()?o=!0:a.jsroot_dom=h.createElementNS("http://www.w3.org/2000/svg","svg");else if(c()){n.canvas=undefined.createCanvas(t,e),n.canvas.addEventListener=function(){},n.canvas.removeEventListener=function(){},n.canvas.style={};let i=undefined(t,e,{preserveDrawingBuffer:!0});if(!i)throw Error("Fail to create headless-gl");n.context=i,i.canvas=n.canvas,a=new up(n),a.jsroot_output=new mc(t,e),a.setRenderTarget(a.jsroot_output),o=!0}else a=new up(n),a.jsroot_dom=h.createElementNS("http://www.w3.org/2000/svg","image"),Ii(a.jsroot_dom).attr("width",t).attr("height",e);return o?(s.svg_3ds||(s.svg_3ds=[]),a.workaround_id=s.svg_3ds.length,s.svg_3ds[a.workaround_id]="<svg></svg>",a.jsroot_dom=h.createElementNS("http://www.w3.org/2000/svg","path"),a.jsroot_dom.setAttribute("jsroot_svg_workaround",a.workaround_id)):a.jsroot_dom||(a.jsroot_dom=a.domElement),a.setSize(t,e),a.jsroot_render3d=i,a.setJSROOTSize=function(t,e){if(this.jsroot_render3d===f.Render3D.WebGLImage&&!l()&&!c())return Ii(this.jsroot_dom).attr("width",t).attr("height",e)},a}function Fy(t){if(t)if(c()){let e="function"==typeof t.getContext?t.getContext():null,i=e?e.getExtension("STACKGL_destroy_context"):null;i&&i.destroy()}else d.isChrome&&"function"==typeof t.forceContextLoss&&t.forceContextLoss(),"function"==typeof t.dispose&&t.dispose()}function Iy(t){t.clearHTML&&t.clearHTML()}function jy(t){let e=f.Render3D;if(t.jsroot_render3d!=e.WebGL)if(t.jsroot_render3d==e.SVG)if(l())s.svg_3ds[t.workaround_id]=t.makeOuterHTML();else{let e=t.jsroot_dom.parentNode;e&&(e.innerHTML=t.makeOuterHTML(),t.jsroot_dom=e.firstChild)}else if(c()){let e=t.domElement,i=e.getContext("2d"),n=new Uint8Array(4*e.width*e.height);t.readRenderTargetPixels(t.jsroot_output,0,0,e.width,e.height,n);let r,a,o=0,l=4*(e.height-1)*e.width;for(;o<l;){for(r=0;r<4*e.width;++r)a=n[o+r],n[o+r]=n[l+r],n[l+r]=a;o+=4*e.width,l-=4*e.width}let h=i.createImageData(e.width,e.height);h.data.set(n),i.putImageData(h,0,0);let c=e.toDataURL("image/png"),d='<image width="'+e.width+'" height="'+e.height+'" xlink:href="'+c+'"></image>';s.svg_3ds[t.workaround_id]=d}else{let e=t.domElement.toDataURL("image/png");Ii(t.jsroot_dom).attr("xlink:href",e)}}s.processSvgWorkarounds=function(t,e){if(!s.svg_3ds)return t;for(let e=0;e<s.svg_3ds.length;++e)t=t.replace(`<path jsroot_svg_workaround="${e}"></path>`,s.svg_3ds[e]);return e||(s.svg_3ds=void 0),t};class qy{constructor(t,e){this.tt=null,this.cont=null,this.lastlbl="",this.parent=t||document.body,this.canvas=e,this.abspos=!t}checkParent(t){t&&this.parent!==t&&(this.hide(),this.parent=t)}extract_pos(t){if("object"==typeof t&&void 0!==t.u&&void 0!==t.l)return t;let e={u:0,l:0};return this.abspos?(e.l=t.pageX,e.u=t.pageY):(e.l=t.offsetX,e.u=t.offsetY),e}pos(t){if(!this.tt)return;let e=this.extract_pos(t);if(!this.abspos){let t=this.parent.getBoundingClientRect(),i=this.canvas.getBoundingClientRect();void 0!==t.left&&void 0!==i.left&&(e.l+=i.left-t.left),void 0!==t.top&&void 0!==i.top&&(e.u+=i.top-t.top),e.l+this.tt.offsetWidth+3>=this.parent.offsetWidth&&(e.l=this.parent.offsetWidth-this.tt.offsetWidth-3),e.u+this.tt.offsetHeight+15>=this.parent.offsetHeight&&(e.u=this.parent.offsetHeight-this.tt.offsetHeight-15);let n=this.parent;for(;n;){let t=getComputedStyle(n);if(!t||"static"!==t.position)break;if(!n.parentNode||1!=n.parentNode.nodeType)break;n=n.parentNode}if(n&&n!==this.parent){let i=n.getBoundingClientRect();e.l+=t.left-i.left,e.u+=t.top-i.top}}this.tt.style.top=e.u+15+"px",this.tt.style.left=e.l+3+"px"}show(t){if(!t||""===t)return this.hide();if("object"==typeof t&&(t.lines||t.line)){if(t.only_status)return this.hide();if(t.line)t=t.line;else{let e=t.lines[0];for(let i=1;i<t.lines.length;++i)e+="<br/>"+t.lines[i];t=e}}null===this.tt&&(this.tt=document.createElement("div"),this.tt.setAttribute("style","opacity: 1; filter: alpha(opacity=1); position: absolute; display: block; overflow: hidden; z-index: 101;"),this.cont=document.createElement("div"),this.cont.setAttribute("style","display: block; padding: 2px 12px 3px 7px; margin-left: 5px; font-size: 11px; background: #777; color: #fff;"),this.tt.appendChild(this.cont),this.parent.appendChild(this.tt)),this.lastlbl!==t&&(this.cont.innerHTML=t,this.lastlbl=t,this.tt.style.width="auto")}hide(){null!==this.tt&&this.parent.removeChild(this.tt),this.tt=null,this.lastlbl=""}}function Uy(t,e,i,n,r){let s=null,a=m.Zooming&&m.ZoomMouse,o="function"==typeof t.processMouseClick;function l(t){if(s){if(s.mouse_zoom_mesh)return t.stopImmediatePropagation(),void t.stopPropagation();if(!(void 0!==t.button&&0!==t.button||void 0!==t.buttons&&1!==t.buttons))return s.enable_zoom&&(s.mouse_zoom_mesh=s.detectZoomMesh(t),s.mouse_zoom_mesh)?(t.stopImmediatePropagation(),void t.stopPropagation()):void(s.enable_select&&(s.mouse_select_pnt=s.getMousePos(t,{})))}}function h(t){if(s){if(s.mouse_zoom_mesh&&s.mouse_zoom_mesh.point2&&s.painter.get3dZoomCoord){let t=s.mouse_zoom_mesh.object.zoom,e=s.painter.get3dZoomCoord(s.mouse_zoom_mesh.point,t),i=s.painter.get3dZoomCoord(s.mouse_zoom_mesh.point2,t);if(e>i){let t=e;e=i,i=t}"z"===t&&s.mouse_zoom_mesh.object.use_y_for_z&&(t="y"),e<i&&s.painter.zoom(t,e,i)&&(s.mouse_zoom_mesh=null)}if(s.enable_zoom&&s.removeZoomMesh(),s.enable_select&&s.mouse_select_pnt){let e=s.getMousePos(t,{}),i=e.x==s.mouse_select_pnt.x&&e.y==s.mouse_select_pnt.y;if(delete s.mouse_select_pnt,i){let i=s.getMouseIntersects(e);s.painter.processMouseClick(e,i,t)}}}}function c(t){if(!s)return;if(function(t){return!(!t||void 0===t.renderer)&&void 0!==t.render_tmout}(s.painter)||s.mouse_zoom_mesh)return t.preventDefault(),t.stopPropagation(),void t.stopImmediatePropagation();let e=s.detectZoomMesh(t);if(e&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),s.painter&&"function"==typeof s.painter.analyzeMouseWheelEvent)){let i=e.object.zoom,n=e.point[i],r={name:i,ignore:!1};switch(i){case"x":n=(n+s.painter.size_x3d)/2/s.painter.size_x3d;break;case"y":n=(n+s.painter.size_y3d)/2/s.painter.size_y3d;break;case"z":n=n/2/s.painter.size_z3d}s.painter.analyzeMouseWheelEvent(t,r,n,!1),"z"===i&&e.object.use_y_for_z&&(i="y"),s.painter.zoom(i,r.min,r.max)}}return m.Zooming&&m.ZoomWheel&&n.domElement.addEventListener("wheel",c),(a||o)&&(n.domElement.addEventListener("pointerdown",l),n.domElement.addEventListener("pointerup",h)),s=new wx(e,n.domElement),s.enableDamping=!1,s.dampingFactor=1,s.enableZoom=!0,s.enableKeys=m.HandleKeys,r&&(s.target.copy(r),s.target0.copy(r),s.update()),s.tooltip=new qy(t.selectDom().node(),n.domElement),s.painter=t,s.camera=e,s.scene=i,s.renderer=n,s.raycaster=new V_,s.raycaster.params.Line.threshold=10,s.raycaster.params.Points.threshold=5,s.mouse_zoom_mesh=null,s.block_ctxt=!1,s.block_mousemove=!1,s.cursor_changed=!1,s.control_changed=!1,s.control_active=!1,s.mouse_ctxt={x:0,y:0,on:!1},s.enable_zoom=a,s.enable_select=o,s.cleanup=function(){m.Zooming&&m.ZoomWheel&&this.domElement.removeEventListener("wheel",c),(this.enable_zoom||this.enable_select)&&(this.domElement.removeEventListener("pointerdown",l),this.domElement.removeEventListener("pointerup",h)),this.domElement.removeEventListener("click",this.lstn_click),this.domElement.removeEventListener("dblclick",this.lstn_dblclick),this.domElement.removeEventListener("contextmenu",this.lstn_contextmenu),this.domElement.removeEventListener("mousemove",this.lstn_mousemove),this.domElement.removeEventListener("mouseleave",this.lstn_mouseleave),this.dispose(),this.tooltip.hide(),delete this.tooltip,delete this.painter,delete this.camera,delete this.scene,delete this.renderer,delete this.raycaster,delete this.mouse_zoom_mesh},s.HideTooltip=function(){this.tooltip.hide()},s.getMousePos=function(t,e){return e.x="offsetX"in t?t.offsetX:t.layerX,e.y="offsetY"in t?t.offsetY:t.layerY,e.clientX=t.clientX,e.clientY=t.clientY,e},s.getOriginDirectionIntersects=function(t,e){this.raycaster.set(t,e);let i=this.raycaster.intersectObjects(this.scene.children,!0);return"function"==typeof this.painter.filterIntersects&&(i=this.painter.filterIntersects(i)),i},s.getMouseIntersects=function(t){if(!this.renderer)return[];let e=this.renderer instanceof up?this.renderer.getSize(new Zh):this.renderer.domElement,i={x:t.x/e.width*2-1,y:-t.y/e.height*2+1};this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.raycaster.setFromCamera(i,this.camera);let n=this.raycaster.intersectObjects(this.scene.children,!0);return"function"==typeof this.painter.filterIntersects&&(n=this.painter.filterIntersects(n)),n},s.detectZoomMesh=function(t){let e=this.getMousePos(t,{}),i=this.getMouseIntersects(e);if(i)for(let t=0;t<i.length;++t)if(i[t].object.zoom)return i[t];return null},s.getInfoAtMousePosition=function(t){let e=this.getMouseIntersects(t),i=null,n=null;for(let t=0;t<e.length;++t)if(e[t].object.tooltip){i=e[t].object.tooltip(e[t]),n=e[t].object.painter;break}if(i&&n)return{obj:n.getObject(),name:n.getObject().fName,bin:i.bin,cont:i.value,binx:i.ix,biny:i.iy,binz:i.iz,grx:(i.x1+i.x2)/2,gry:(i.y1+i.y2)/2,grz:(i.z1+i.z2)/2}},s.processDblClick=function(t){let e=this.detectZoomMesh(t);if(e&&this.painter)return void this.painter.unzoom(e.object.use_y_for_z?"y":e.object.zoom);let i=this.painter?this.painter.getFramePainter():null;if(i&&"function"==typeof i._dblclick_handler){let e=this.getInfoAtMousePosition(this.getMousePos(t,{}));if(e)return void i._dblclick_handler(e)}this.reset()},s.changeEvent=function(){this.mouse_ctxt.on=!1,this.painter.render3D(0),this.control_changed=!0},s.startEvent=function(){this.control_active=!0,this.block_ctxt=!1,this.mouse_ctxt.on=!1,this.tooltip.hide()},s.endEvent=function(){this.control_active=!1,this.mouse_ctxt.on&&(this.mouse_ctxt.on=!1,this.contextMenu(this.mouse_ctxt,this.getMouseIntersects(this.mouse_ctxt))),this.control_changed=!1},s.mainProcessContextMenu=function(t){t.preventDefault(),this.getMousePos(t,this.mouse_ctxt),this.control_active?this.mouse_ctxt.on=!0:this.block_ctxt?this.block_ctxt=!1:this.contextMenu(this.mouse_ctxt,this.getMouseIntersects(this.mouse_ctxt))},s.contextMenu=function(){},s.setTooltipEnabled=function(t){this.block_mousemove=!t,!1===t&&(this.tooltip.hide(),this.removeZoomMesh())},s.removeZoomMesh=function(){this.mouse_zoom_mesh&&this.mouse_zoom_mesh.object.showSelection()&&this.painter.render3D(),this.mouse_zoom_mesh=null},s.mainProcessMouseMove=function(t){if(this.painter&&(this.control_active&&t.buttons&&2&t.buttons&&(this.block_ctxt=!0),!this.control_active&&!this.block_mousemove&&this.processMouseMove)){if(this.mouse_zoom_mesh){let e=this.detectZoomMesh(t),i=null;return i=e&&e.object===this.mouse_zoom_mesh.object?e.point:this.mouse_zoom_mesh.object.globalIntersect(this.raycaster),i&&(this.mouse_zoom_mesh.point2=i),i&&this.painter.enable_highlight&&this.mouse_zoom_mesh.object.showSelection(this.mouse_zoom_mesh.point,i)&&this.painter.render3D(0),void this.tooltip.hide()}t.preventDefault(),this.tmout_mouse=this.getMousePos(t,{}),this.tmout_ttpos=this.tooltip?this.tooltip.extract_pos(t):null,this.tmout_handle&&(clearTimeout(this.tmout_handle),delete this.tmout_handle),this.mouse_tmout?this.tmout_handle=setTimeout((()=>this.delayedProcessMouseMove()),this.mouse_tmout):this.delayedProcessMouseMove()}},s.delayedProcessMouseMove=function(){if(delete this.tmout_handle,!this.painter)return;let t=this.tmout_mouse,e=this.getMouseIntersects(t),i=this.processMouseMove(e);if(i){let e="",n="",r="",s="";t&&(r=t.x.toFixed(0)+","+t.y.toFixed(0)),"string"==typeof i?s=i:(e=i.name,n=i.title,i.line?s=i.line:i.lines&&(s=i.lines.slice(1).join(" "),e=i.lines[0])),this.painter.showObjectStatus(e,n,s,r)}if(this.cursor_changed=!1,i&&this.painter&&this.painter.isTooltipAllowed())this.tooltip.checkParent(this.painter.selectDom().node()),this.tooltip.show(i,t),this.tooltip.pos(this.tmout_ttpos);else if(this.tooltip.hide(),e)for(let t=0;t<e.length;++t)e[t].object.zoom&&(this.cursor_changed=!0);document.body.style.cursor=this.cursor_changed?"pointer":"auto"},s.mainProcessMouseLeave=function(){this.painter&&(this.tmout_handle&&(clearTimeout(this.tmout_handle),delete this.tmout_handle),this.tooltip.hide(),"function"==typeof this.processMouseLeave&&this.processMouseLeave(),this.cursor_changed&&(document.body.style.cursor="auto",this.cursor_changed=!1))},s.mainProcessDblClick=function(t){this.single_click_tm&&(clearTimeout(this.single_click_tm),delete this.single_click_tm),this.processDblClick(t)},s.processClick=function(t,e){if(delete this.single_click_tm,1==e){let e=this.painter?this.painter.getFramePainter():null;if(e&&"function"==typeof e._click_handler){let i=this.getInfoAtMousePosition(t);if(i)return void e._click_handler(i)}}if(2==e&&"function"==typeof this.processSingleClick){let e=this.getMouseIntersects(t);this.processSingleClick(e)}},s.lstn_click=function(t){if(2==t.detail)return;this.single_click_tm&&(clearTimeout(this.single_click_tm),delete this.single_click_tm);let e=0,i=this.painter?this.painter.getFramePainter():null;i&&"function"==typeof i._click_handler?e=1:this.processSingleClick&&this.painter&&this.painter.options&&this.painter.options.mouse_click&&(e=2),e&&(this.single_click_tm=setTimeout(this.processClick.bind(this,this.getMousePos(t,{}),e),300))}.bind(s),s.addEventListener("change",(()=>s.changeEvent())),s.addEventListener("start",(()=>s.startEvent())),s.addEventListener("end",(()=>s.endEvent())),s.lstn_contextmenu=t=>s.mainProcessContextMenu(t),s.lstn_dblclick=t=>s.mainProcessDblClick(t),s.lstn_mousemove=t=>s.mainProcessMouseMove(t),s.lstn_mouseleave=()=>s.mainProcessMouseLeave(),n.domElement.addEventListener("click",s.lstn_click),n.domElement.addEventListener("dblclick",s.lstn_dblclick),n.domElement.addEventListener("contextmenu",s.lstn_contextmenu),n.domElement.addEventListener("mousemove",s.lstn_mousemove),n.domElement.addEventListener("mouseleave",s.lstn_mouseleave),s}function Gy(t,e){if(t){if(t.children)for(let e=0;e<t.children.length;e++)Gy(t.children[e]);e?t.children=[]:(t.children=void 0,t.geometry&&(t.geometry.dispose(),t.geometry=void 0),t.material&&(t.material.map&&(t.material.map.dispose(),t.material.map=void 0),t.material.dispose(),t.material=void 0),delete t.painter,delete t.bins_index,delete t.tooltip,delete t.stack,delete t.drawn_highlight,t=void 0)}}function Hy(t,e,i,n=!1){let r=new Od;if(r.setAttribute("position",t instanceof Float32Array?new rd(t,3):new od(t,3)),i&&r.setIndex(new rd(i,1)),e.isLineDashedMaterial){let e=new gc,n=new gc,s=0,a=null;if(i){a=new Float32Array(i.length);for(let r=0;r<i.length;r+=2){let o=i[r],l=i[r+1];e.set(t[o],t[o+1],t[o+2]),n.set(t[l],t[l+1],t[l+2]),a[r]=s,s+=n.distanceTo(e),a[r+1]=s}}else{a=new Float32Array(t.length/3);for(let i=0;i<t.length;i+=6)e.set(t[i],t[i+1],t[i+2]),n.set(t[i+3],t[i+4],t[i+5]),a[i/3]=s,s+=n.distanceTo(e),a[i/3+1]=s}r.setAttribute("lineDistance",new rd(a,1))}return n?r:new Mp(r,e)}const Xy={Vertices:[new gc(1,1,1),new gc(1,1,0),new gc(1,0,1),new gc(1,0,0),new gc(0,1,0),new gc(0,1,1),new gc(0,0,0),new gc(0,0,1)],Indexes:[0,2,1,2,3,1,4,6,5,6,7,5,4,5,1,5,0,1,7,6,2,6,3,2,5,7,0,7,2,0,1,3,4,3,6,4],Normals:[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],Segments:[0,2,2,7,7,5,5,0,1,3,3,6,6,4,4,1,1,0,3,2,6,7,4,5]};Xy.MeshSegments=function(){let t=Xy,e=new Int32Array(t.Segments.length);for(let i=0;i<e.length;++i)for(let n=0;n<t.Indexes.length;++n)if(t.Segments[i]===t.Indexes[n]){e[i]=n;break}return e}();class Vy{constructor(t,e,i){this.webgl=void 0===e||e,this.scale=i||1,this.pos=new Float32Array(3*t),this.geom=new Od,this.geom.setAttribute("position",new rd(this.pos,3)),this.indx=0}addPoint(t,e,i){this.pos[this.indx]=t,this.pos[this.indx+1]=e,this.pos[this.indx+2]=i,this.indx+=3}createPoints(t){"object"!=typeof t&&(t={color:t}),t.color||(t.color="black");let e=1;t.style?1===t.style?e=.3:6===t.style?e=.5:7===t.style&&(e=.7):e=1.1;let i=i=>{let n={size:3*this.scale*e};i?(n.map=i,n.transparent=!0):n.color=t.color||"black";let r=new kp(this.geom,new Tp(n));return r.nvertex=1,r};if(1!==e){let t=i();return this.noPromise?t:Promise.resolve(t)}let n,r=new ql({style:t.style,color:t.color,size:7}),s=r.fill?1:7,a=`<svg width="64" height="64" xmlns="http://www.w3.org/2000/svg"><path d="${r.create(32,32)}" style="stroke: ${r.getStrokeColor()}; stroke-width: ${s}; fill: ${r.getFillColor()}"></path></svg>`,o="data:image/svg+xml;charset=utf8,"+(c()?a:encodeURIComponent(a));if(c())n=Promise.resolve().then((function(){return Gw})).then((t=>t.default.loadImage(o).then((e=>{const i=t.default.createCanvas(64,64);return i.getContext("2d").drawImage(e,0,0,64,64),new Op(i)}))));else{if(this.noPromise)return i((new i_).load(o));n=new Promise(((t,e)=>{(new i_).load(o,(e=>t(e)),void 0,(()=>e()))}))}return n.then(i)}}function Yy(t,e,i=!1){if(!t||!e)return null;let n,r,s;"string"==typeof e||i?(n=t.v7EvalColor(e+"color","black"),r=parseInt(t.v7EvalAttr(e+"style",0)),s=parseInt(t.v7EvalAttr(e+"width",1))):(n=t.getColor(e.fLineColor),r=e.fLineStyle,s=e.fLineWidth);let a,o=r?Xl(r):"",l=o?o.split(","):[];return a=l&&l.length>=2?new Zg({color:n,dashSize:parseInt(l[0]),gapSize:parseInt(l[1])}):new pp({color:n}),s&&s>1&&(a.linewidth=s),a}function $y(t,e,i,n){let r;if(e&&e.children)for(let t=0;t<e.children.length&&(r=e.children[t],!r.axis_draw);++t)r=void 0;if(!r)return;if(!t)return void e.remove(r);i=!!i,n=!!n;let s=1,a=t.position;a.x<0&&a.y>=0&&(s=2),a.x>=0&&a.y>=0&&(s=3),a.x>=0&&a.y<0&&(s=4);let o=(t,e)=>(t<=s&&(t+=4),t>s&&t<s+e);for(let t=0;t<r.children.length;++t){let e=r.children[t];if(e.grid)e.visible=n&&o(e.grid,3);else if(e.zid)e.visible=o(e.zid,2);else if(e.xyid)e.visible=o(e.xyid,3);else if(e.xyboxid){let t=5,r=0;n&&!i?(t=3,r=-2):i&&!n?t=3:i||n||(t=e.bottom?3:0),e.visible=o(e.xyboxid+r,t),!e.visible&&e.bottom&&n&&(e.visible=o(e.xyboxid,3))}else if(e.zboxid){let t=2,r=0;i&&n?t=5:n&&!i?t=4:!n&&i&&(r=-2,t=4),e.visible=o(e.zboxid+r,t)}}}function Wy(t,e){let i=t.getPadPainter().getRootPad(!0),n=Math.max(.75*t.size_x3d,t.size_z3d),r=Math.max(.75*t.size_y3d,t.size_z3d);if(e&&(n===r?t.camera.position.set(-1.6*n,-3.5*r,1.4*t.size_z3d):n>r?t.camera.position.set(-2*n,-3.5*r,1.4*t.size_z3d):t.camera.position.set(-3.5*n,-2*r,1.4*t.size_z3d)),i&&(e||!t.zoomChangedInteractive())&&Number.isFinite(i.fTheta)&&Number.isFinite(i.fPhi)&&(i.fTheta!==t.camera_Theta||i.fPhi!==t.camera_Phi)){t.camera_Phi=i.fPhi,t.camera_Theta=i.fTheta,n=3*Math.max(t.size_x3d,t.size_z3d),r=3*Math.max(t.size_y3d,t.size_z3d);let s=(270-i.fPhi)/180*Math.PI,a=(i.fTheta-10)/180*Math.PI;t.camera.position.set(n*Math.cos(s)*Math.cos(a),r*Math.sin(s)*Math.cos(a),t.size_z3d+.5*(n+r)*Math.sin(a)),e=!0}e&&t.camera.lookAt(t.lookat)}function Zy(t,e,i){if(-1===t){if(!this.mode3d)return;return this.clear3dCanvas?($y(null,this.toplevel),this.clear3dCanvas(),Gy(this.scene),this.control&&this.control.cleanup(),Fy(this.renderer),delete this.size_x3d,delete this.size_y3d,delete this.size_z3d,delete this.tooltip_mesh,delete this.scene,delete this.toplevel,delete this.camera,delete this.pointLight,delete this.renderer,delete this.control,this.render_tmout&&(clearTimeout(this.render_tmout),delete this.render_tmout),void(this.mode3d=!1)):void console.error("Strange, why mode3d is configured!!!!",this.mode3d)}if(this.mode3d=!0,"toplevel"in this){this.scene.remove(this.toplevel),Gy(this.toplevel),delete this.tooltip_mesh,delete this.toplevel,this.control&&this.control.HideTooltip();let t=new Td;return this.scene.add(t),this.toplevel=t,this.resize3D(),Wy(this,!1),Promise.resolve(!0)}t=Ry(t),By(this);let n=this.getSizeFor3d(void 0,t);if(this.size_z3d=100,this.size_x3d=this.size_y3d=n.height>10&&n.width>10?Math.round(n.width/n.height*this.size_z3d):this.size_z3d,e&&(this.size_x3d*=e),i&&(this.size_y3d*=i),this.scene=new mp,this.toplevel=new Td,this.scene.add(this.toplevel),this.scene_width=n.width,this.scene_height=n.height,this.camera=new Bu(45,this.scene_width/this.scene_height,1,40*this.size_z3d),this.camera_Phi=30,this.camera_Theta=30,this.pointLight=new q_(16777215,1),this.camera.add(this.pointLight),this.pointLight.position.set(this.size_x3d/2,this.size_y3d/2,this.size_z3d/2),this.lookat=new gc(0,0,.8*this.size_z3d),this.camera.up=new gc(0,0,1),this.scene.add(this.camera),Wy(this,!0),this.renderer=Ny(this.scene_width,this.scene_height,t),this.webgl=t===f.Render3D.WebGL,this.add3dCanvas(n,this.renderer.jsroot_dom,this.webgl),this.first_render_tm=0,this.enable_highlight=!1,l()||!this.webgl)return;this.control=Uy(this,this.camera,this.scene,this.renderer,this.lookat);let r=this,s=this.getMainPainter();this.control.processMouseMove=function(t){let e=null,i=null,n=null;for(let r=0;r<t.length;++r)if(t[r].object.tooltip){if(e=t[r].object.tooltip(t[r]),e){i=t[r].object;break}}else t[r].object.zoom&&!n&&(n=t[r].object);if(e&&!e.use_itself){let t=1e-4*r.size_x3d,i=1e-4*r.size_y3d,n=1e-4*r.size_z3d;(e.x1>e.x2||e.y1>e.y2||e.z1>e.z2)&&console.warn("check 3D hints coordinates"),e.x1-=t,e.x2+=t,e.y1-=i,e.y2+=i,e.z1-=n,e.z2+=n}if(r.highlightBin3D(e,i),!e&&n&&r.get3dZoomCoord){let t=n.globalIntersect(this.raycaster),e=n.zoom,i=r.get3dZoomCoord(t,e);return"z"===e&&n.use_y_for_z&&(e="y"),{name:e,title:"axis object",line:e+" : "+r.axisAsText(e,i),only_status:!0}}return e&&e.lines?e:""},this.control.processMouseLeave=function(){r.highlightBin3D(null)},this.control.contextMenu=function(t,e){let i="painter",n=s;if(e)for(let t=0;t<e.length;++t){let r=e[t].object;if(r.zoom){i=r.zoom,n=null;break}if(r.painter&&"function"==typeof r.painter.fillContextMenu){n=r.painter;break}}let r=s.getFramePainter();r&&r.showContextMenu&&r.showContextMenu(i,t,n)}}function Qy(t){if(-1111===t){let t=g(),e=Oy(!1,0,t);if(e.setSize(this.scene_width,this.scene_height),e.render(this.scene,this.camera),e.makeOuterHTML){let i=t.createElement("div");return i.innerHTML=e.makeOuterHTML(),i.childNodes[0]}return e.domElement}if(void 0===t&&(t=5),t>0&&!this.usesvg&&!l())return void(this.render_tmout||(this.render_tmout=setTimeout((()=>this.render3D(0)),t)));if(this.render_tmout&&(clearTimeout(this.render_tmout),delete this.render_tmout),!this.renderer)return;Iy(this.renderer);let e=new Date;this.opt3d||(this.opt3d={FrontBox:!0,BackBox:!0}),$y(this.camera,this.toplevel,this.opt3d.FrontBox,this.opt3d.BackBox),this.renderer.render(this.scene,this.camera),jy(this.renderer);let i=new Date;0===this.first_render_tm&&(this.first_render_tm=i.getTime()-e.getTime(),this.enable_highlight=this.first_render_tm<1200&&this.isTooltipAllowed(),console.log(`three.js r138, first render tm = ${this.first_render_tm}`))}function Jy(){let t=this.getSizeFor3d(this.access3dKind());return this.apply3dSize(t),(this.scene_width!==t.width||this.scene_height!==t.height)&&(!(t.width<10||t.height<10)&&(this.scene_width=t.width,this.scene_height=t.height,this.camera.aspect=this.scene_width/this.scene_height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.scene_width,this.scene_height),this.renderer.setJSROOTSize&&this.renderer.setJSROOTSize(this.scene_width,this.scene_height),!0))}function Ky(t,e){let i=!1,n=null,r=!0,s=!t||void 0===t.x1||!this.enable_highlight,a=this.getMainPainter();if(!a||a.provideUserTooltip&&a.hasUserTooltip()||(a=null),this.tooltip_selfmesh&&(r=this.tooltip_selfmesh!==e,this.tooltip_selfmesh.material.color=this.tooltip_selfmesh.save_color,delete this.tooltip_selfmesh,i=!0),this.tooltip_mesh&&(n=this.tooltip_mesh,this.toplevel.remove(this.tooltip_mesh),delete this.tooltip_mesh,i=!0),s)return i&&this.render3D(),void(i&&a&&a.provideUserTooltip(null));if(t.use_itself)e.save_color=e.material.color,e.material.color=new ac(t.color),this.tooltip_selfmesh=e,i=r;else{i=!0;const e=Xy.Indexes,r=Xy.Normals,s=Xy.Vertices,a=new ac(t.color?t.color:16711680),o=t.opacity||1;let l,h;if(n)l=n.geometry.attributes.position.array,n.geometry.attributes.position.needsUpdate=!0,n.material.color=a,n.material.opacity=o;else{l=new Float32Array(3*e.length),h=new Float32Array(3*e.length);const t=new Od;t.setAttribute("position",new rd(l,3)),t.setAttribute("normal",new rd(h,3));const i=new ou({color:a,opacity:o,vertexColors:!1});n=new Tu(t,i)}t.x1===t.x2&&console.warn("same tip X",t.x1,t.x2),t.y1===t.y2&&console.warn("same tip Y",t.y1,t.y2),t.z1===t.z2&&(t.z2=t.z1+1e-4);for(let i=0,n=-3;i<e.length;++i){let a=s[e[i]];l[3*i]=t.x1+a.x*(t.x2-t.x1),l[3*i+1]=t.y1+a.y*(t.y2-t.y1),l[3*i+2]=t.z1+a.z*(t.z2-t.z1),h&&(i%6==0&&(n+=3),h[3*i]=r[n],h[3*i+1]=r[n+1],h[3*i+2]=r[n+2])}this.tooltip_mesh=n,this.toplevel.add(n)}i&&this.render3D(),i&&t.$painter&&"function"==typeof t.$painter.redrawProjection&&t.$painter.redrawProjection(t.ix-1,t.ix,t.iy-1,t.iy),i&&a&&a.getObject()&&a.provideUserTooltip({obj:a.getObject(),name:a.getObject().fName,bin:t.bin,cont:t.value,binx:t.ix,biny:t.iy,binz:t.iz,grx:(t.x1+t.x2)/2,gry:(t.y1+t.y2)/2,grz:(t.z1+t.z2)/2})}function tA(t){this.opt3d=t}function eA(t,e,i){i||(i={});let n=-this.size_x3d,r=this.size_x3d,s=-this.size_y3d,a=this.size_y3d,o=0,l=2*this.size_z3d,h=Math.round(.05*this.size_z3d),c=i.v7?null:this.getPadPainter().getRootPad(!0),d=this.xmin,u=this.xmax,f=this.ymin,m=this.ymax,p=this.zmin,g=this.zmax,_=!1,x=!1;this.size_z3d||(n=this.xmin,r=this.xmax,s=this.ymin,a=this.ymax,o=this.zmin,l=this.zmax,h=.05*(l-o)),"zoom_xmin"in this&&"zoom_xmax"in this&&this.zoom_xmin!==this.zoom_xmax&&(d=this.zoom_xmin,u=this.zoom_xmax),"zoom_ymin"in this&&"zoom_ymax"in this&&this.zoom_ymin!==this.zoom_ymax&&(f=this.zoom_ymin,m=this.zoom_ymax,_=!0),"zoom_zmin"in this&&"zoom_zmax"in this&&this.zoom_zmin!==this.zoom_zmax&&(p=this.zoom_zmin,g=this.zoom_zmax,x=!0),i.use_y_for_z&&(this.zmin=this.ymin,this.zmax=this.ymax,p=f,g=m,x=_,f=0,m=1),this.lego_zmin=p,this.lego_zmax=g,void 0===i.zmult||x||(g*=i.zmult),this.x_handle=new e(null,this.xaxis),i.v7&&(this.x_handle.setPadName(this.getPadName()),this.x_handle.snapid=this.snapid),this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,d,u,!1,[n,r],{log:c?c.fLogx:0}),this.x_handle.assignFrameMembers(this,"x"),this.y_handle=new e(null,this.yaxis),i.v7&&(this.y_handle.setPadName(this.getPadName()),this.y_handle.snapid=this.snapid),this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,f,m,!1,[s,a],{log:c&&!i.use_y_for_z?c.fLogy:0}),this.y_handle.assignFrameMembers(this,"y"),this.z_handle=new e(null,this.zaxis),i.v7&&(this.z_handle.setPadName(this.getPadName()),this.z_handle.snapid=this.snapid),this.z_handle.configureAxis("zaxis",this.zmin,this.zmax,p,g,!1,[o,l],{log:c?c.fLogz:0}),this.z_handle.assignFrameMembers(this,"z"),this.setRootPadRange(c,!0);let y=new ou({color:0,vertexColors:!1}),A=new pp({color:0,vertexColors:!1}),v=.5*h,b=[],w=1,M=this.x_handle.createTicks(!1,!0),T=this.y_handle.createTicks(!1,!0),S=this.z_handle.createTicks(!1,!0),C=new Td;C.axis_draw=!0,t.add(C);let P=[],E=0,k=this.xaxis;for(;M.next();){let t=M.grpos,e=1===M.kind,n=this.x_handle.format(M.tick,2);if(M.last_major()?k&&k.fTitle||(n="x"):null===n&&(e=!1,n=""),e&&n&&n.length>0&&i.draw){let e=new hx(n,{font:zy,size:h,height:0,curveSegments:5});e.computeBoundingBox();let i=e.boundingBox.max.x-e.boundingBox.min.x,r=e.boundingBox.max.y-e.boundingBox.min.y;if(e.center=!0,E=Math.max(E,r),e.grx=t,b.push(e),!M.last_major()){let n=M.next_major_grpos()-t;i>0&&(w=Math.min(w,.9*n/i)),this.x_handle.isCenteredLabels()&&(e.grx+=n/2)}}P.push(t,0,0,t,e?-v:.6*-v,0)}if(k&&k.fTitle&&i.draw){const t=new hx(gl(k.fTitle),{font:zy,size:h,height:0,curveSegments:5});t.computeBoundingBox(),t.center=!i.v7&&k.TestBit(Py.kCenterTitle),t.gry=2,t.grx=(n+r)/2,b.push(t)}this.get3dZoomCoord=function(t,e){let i=t[e],n=this[`scale_${e}min`],r=this[`scale_${e}max`];switch(e){case"x":i=(i+this.size_x3d)/2/this.size_x3d;break;case"y":i=(i+this.size_y3d)/2/this.size_y3d;break;case"z":i=i/2/this.size_z3d}return i=this["log"+e]?Math.exp(Math.log(n)+i*(Math.log(r)-Math.log(n))):n+i*(r-n),i};const D=(t,e,i)=>{let n,r=new Od;n="z"===t?new Float32Array([0,0,0,4*v,0,2*e,4*v,0,0,0,0,0,0,0,2*e,4*v,0,2*e]):new Float32Array([-e,0,0,e,4*-v,0,e,0,0,-e,0,0,-e,4*-v,0,e,4*-v,0]),r.setAttribute("position",new rd(n,3)),r.computeVertexNormals();let s=new ou({transparent:!0,vertexColors:!1,side:2,opacity:0}),a=new Tu(r,s);return a.zoom=t,a.size_3d=e,a.use_y_for_z=i,"y"==t&&a.rotateZ(Math.PI/2).rotateX(Math.PI),a.v1=new gc(n[0],n[1],n[2]),a.v2=new gc(n[6],n[7],n[8]),a.v3=new gc(n[3],n[4],n[5]),a.globalIntersect=function(t){if(!this.v1||!this.v2||!this.v3)return;let e=new Uc;e.setFromCoplanarPoints(this.v1,this.v2,this.v3),e.applyMatrix4(this.matrixWorld);let i=t.ray.origin.clone(),n=i.clone().addScaledVector(t.ray.direction,1e10),r=e.intersectLine(new ix(i,n),new gc);if(!r)return;let s=-this.size_3d,a=this.size_3d;return"z"===this.zoom&&(s=0,a=2*this.size_3d),r[this.zoom]<s?r[this.zoom]=s:r[this.zoom]>a&&(r[this.zoom]=a),r},a.showSelection=function(t,e){let i,n=this.children?this.children[0]:null,r=this.zoom;if(!t||!e)return n&&(this.remove(n),Gy(n)),n;if(!this.geometry)return!1;if(n)i=n.geometry;else{i=this.geometry.clone();let t=i.getAttribute("position").array;"z"===r?t[6]=t[3]=t[15]=v:t[4]=t[16]=t[13]=-v,n=new Tu(i,new ou({color:65280,side:2,vertexColors:!1})),this.add(n)}let s=i.getAttribute("position").array;return"z"==r?(s[2]=s[11]=s[8]=t[r],s[5]=s[17]=s[14]=e[r]):(s[0]=s[9]=s[12]=t[r],s[6]=s[3]=s[15]=e[r]),i.getAttribute("position").needsUpdate=!0,!0},a};let z,O=new Td;O.position.set(0,s,o),O.rotation.x=1/4*Math.PI,O.xyid=2,i.draw&&(z=Hy(P,A),O.add(z)),b.forEach((t=>{let e=t.boundingBox.max.x-t.boundingBox.min.x,i=t.center?t.grx-e/2:r-e,n=new Vc;n.set(w,0,0,i,0,w,0,(-E*w-1.5*v)*(t.gry||1),0,0,1,0,0,0,0,1);let s=new Tu(t,y);s.applyMatrix4(n),O.add(s)})),i.zoom&&O.add(D("x",this.size_x3d)),C.add(O),O=new Td,O.position.set(0,a,o),O.rotation.x=3/4*Math.PI,i.draw&&O.add(new Mp(z.geometry,A)),b.forEach((t=>{let e=t.boundingBox.max.x-t.boundingBox.min.x,i=t.center?t.grx+e/2:r,n=new Vc;n.set(-w,0,0,i,0,w,0,(-E*w-1.5*v)*(t.gry||1),0,0,-1,0,0,0,0,1);let s=new Tu(t,y);s.applyMatrix4(n),O.add(s)})),O.xyid=4,i.zoom&&O.add(D("x",this.size_x3d)),C.add(O),b=[],w=1,E=0,P=[];let R=this.yaxis;for(;T.next();){let t=T.grpos,e=1===T.kind,n=this.y_handle.format(T.tick,2);if(T.last_major()?R&&R.fTitle||(n="y"):null===n&&(e=!1,n=""),e&&i.draw){const e=new hx(n,{font:zy,size:h,height:0,curveSegments:5});e.computeBoundingBox();let i=e.boundingBox.max.x-e.boundingBox.min.x,r=e.boundingBox.max.y-e.boundingBox.min.y;if(e.center=!0,E=Math.max(E,r),e.gry=t,b.push(e),!T.last_major()){let n=T.next_major_grpos()-t;i>0&&(w=Math.min(w,.9*n/i)),this.y_handle.isCenteredLabels()&&(e.gry+=n/2)}}P.push(0,t,0,e?-v:.6*-v,t,0)}if(R&&R.fTitle&&i.draw){const t=new hx(gl(R.fTitle),{font:zy,size:h,height:0,curveSegments:5});t.computeBoundingBox(),t.center=!i.v7&&R.TestBit(Py.kCenterTitle),t.grx=2,t.gry=(s+a)/2,b.push(t)}if(!i.use_y_for_z){let t,e=new Td;e.position.set(n,0,o),e.rotation.y=-1/4*Math.PI,i.draw&&(t=Hy(P,A),e.add(t)),b.forEach((t=>{let i=t.boundingBox.max.x-t.boundingBox.min.x,n=t.center?t.gry+i/2:a,r=new Vc;r.set(0,w,0,(-E*w-1.5*v)*(t.grx||1),-w,0,0,n,0,0,1,0,0,0,0,1);let s=new Tu(t,y);s.applyMatrix4(r),e.add(s)})),e.xyid=3,i.zoom&&e.add(D("y",this.size_y3d)),C.add(e),e=new Td,e.position.set(r,0,o),e.rotation.y=-3/4*Math.PI,i.draw&&e.add(new Mp(t.geometry,A)),b.forEach((t=>{let i=t.boundingBox.max.x-t.boundingBox.min.x,n=t.center?t.gry-i/2:a-i,r=new Vc;r.set(0,w,0,(-E*w-1.5*v)*(t.grx||1),w,0,0,n,0,0,-1,0,0,0,0,1);let s=new Tu(t,y);s.applyMatrix4(r),e.add(s)})),e.xyid=1,i.zoom&&e.add(D("y",this.size_y3d)),C.add(e)}b=[],w=1,P=[];let L=null,B=null,N=null,F=this.zaxis,I=0;for(this.size_z3d&&(L=[],B=[]);S.next();){let t=S.grpos,e=1==S.kind,o=this.z_handle.format(S.tick,2);if(null===o&&(e=!1,o=""),e&&o&&i.draw){let e=new hx(o,{font:zy,size:h,height:0,curveSegments:5});e.computeBoundingBox();let i=e.boundingBox.max.x-e.boundingBox.min.x,n=e.boundingBox.max.y-e.boundingBox.min.y;e.translate(-i,-n/2,0),e.grz=t,b.push(e),null!==N&&n>0&&(w=Math.min(w,.9*(t-N)/n)),I=Math.max(I,i),N=t}L&&e&&L.push(n,0,t,r,0,t),B&&e&&B.push(0,s,t,0,a,t),P.push(0,0,t,e?v:.6*v,0,t)}if(L&&L.length>0){const t=new Zg({color:0,dashSize:2,gapSize:2}),e=Hy(L,t);e.position.set(0,a,0),e.grid=2,e.visible=!1,C.add(e);const i=new Mp(e.geometry,t);i.position.set(0,s,0),i.grid=4,i.visible=!1,C.add(i)}if(B&&B.length>0){const t=new Zg({color:0,dashSize:2,gapSize:2}),e=Hy(B,t);e.position.set(r,0,0),e.grid=3,e.visible=!1,C.add(e);const i=new Mp(e.geometry,t);i.position.set(n,0,0),i.grid=1,i.visible=!1,C.add(i)}let j=[],q=i.draw?Hy(P,A):null;for(let t=0;t<4;++t){if(j.push(new Td),b.forEach((e=>{let i=new Vc;i.set(-w,0,0,2*v,0,0,1,0,0,w,0,e.grz);let n=new Tu(e,y);n.applyMatrix4(i),j[t].add(n)})),F&&F.fTitle&&i.draw){let e=new hx(gl(F.fTitle),{font:zy,size:h,height:0,curveSegments:5});e.computeBoundingBox();let n=e.boundingBox.max.x-e.boundingBox.min.x,r=!i.v7&&F.TestBit(Py.kCenterTitle)?(l+o-n)/2:l-n;e.rotateZ(Math.PI/2);let s=new Vc;s.set(-w,0,0,3*v+I,0,0,1,0,0,w,0,r);let a=new Tu(e,y);a.applyMatrix4(s),j[t].add(a)}i.draw&&q&&j[t].add(0==t?q:new Mp(q.geometry,A)),i.zoom&&j[t].add(D("z",this.size_z3d,i.use_y_for_z)),j[t].zid=t+2,C.add(j[t])}j[0].position.set(n,a,0),j[0].rotation.z=3/4*Math.PI,j[1].position.set(r,a,0),j[1].rotation.z=1/4*Math.PI,j[2].position.set(r,s,0),j[2].rotation.z=-1/4*Math.PI,j[3].position.set(n,s,0),j[3].rotation.z=-3/4*Math.PI;let U=Hy([n,0,0,r,0,0],A,null,!0);for(let t=0;t<2;++t){let e=new Mp(U,A);e.position.set(0,s,0===t?o:l),e.xyboxid=2,e.bottom=0==t,C.add(e),e=new Mp(U,A),e.position.set(0,a,0===t?o:l),e.xyboxid=4,e.bottom=0==t,C.add(e)}let G=Hy([0,s,0,0,a,0],A,null,!0);for(let t=0;t<2;++t){let e=new Mp(G,A);e.position.set(n,0,0===t?o:l),e.xyboxid=3,e.bottom=0==t,C.add(e),e=new Mp(G,A),e.position.set(r,0,0===t?o:l),e.xyboxid=1,e.bottom=0==t,C.add(e)}let H=Hy([0,0,o,0,0,l],A,null,!0);for(let t=0;t<4;++t){let e=new Mp(H,A);e.zboxid=j[t].zid,e.position.copy(j[t].position),C.add(e)}}function iA(t){Object.assign(t,{create3DScene:Zy,render3D:Qy,resize3D:Jy,highlightBin3D:Ky,set3DOptions:tA,drawXYZ:eA})}function nA(t,e=!1){if(!t.draw_content)return;const i=Xy.Vertices,n=Xy.Indexes,r=Xy.Normals,s=Xy.Segments,a=[0,1,1,2,2,3,3,0],o=[new gc(0,0,0),new gc(0,1,0),new gc(1,1,0),new gc(1,0,0)],l=t.getFramePainter(),h=t.prepareDraw({rounding:!1,use3d:!0,extra:1}),c=h.i1,d=h.i2,u=h.j1,f=h.j2,m=t.getHisto(),p=m?m.$baseh:null,g=11===t.options.Lego||13===t.options.Lego,_=m.getBin(d,f)<65535;if(c>=d||u>=f)return;let x,y,A,v,b,w,M,T,S,C,P,E,k,D,z,O=l.z_handle.getScaleMin(),R=l.z_handle.getScaleMax();const L=(e,i,n)=>{if(E=m.getBinContent(e+1,i+1),P=p?p.getBinContent(e+1,i+1):!1!==t.options.BaseLine?t.options.BaseLine:t.options.Zero?O:0,E<P){let t=P;P=E,E=t}return!(P>=y||E<x)&&(k=E===x||P>=E,!k||n>0||!p&&(!!(t.options.Zero||O>0)||t._show_empty_bins))};let B=[O,R],N=null;if(12===t.options.Lego||14===t.options.Lego)if(e)N=l.getHistPalette(),t.createContour(l,N,{full_z_range:!0}),B=N.getContour(),O=B[0],R=B[B.length-1];else{B=t.createContour(m.fContour?m.fContour.length:20,l.lego_zmin,l.lego_zmax).arr,N=t.getHistPalette()}for(let s=0;s<B.length-1;++s){x=B[s],y=B[s+1],N&&s==B.length-2&&y<R&&(y=R);let a=0,o=0,p=0,b=0,w=l.grz(x),F=l.grz(y);for(A=c;A<d;++A)for(v=u;v<f;++v)L(A,v,s)&&(D=!k&&s>0,z=!k&&E>y&&s<B.length-2,p+=k?12:n.length,D&&(p-=6),z&&(p-=6),g&&!k&&(p-=12,b+=12));const I=new Float32Array(3*p),j=new Float32Array(3*p),q=_?new Uint16Array(p/3):new Uint32Array(p/3),U=0===b?null:new Float32Array(3*b),G=0===b?null:new Float32Array(3*b),H=0===b?null:_?new Uint16Array(b/3):new Uint32Array(b/3);let X,V,Y,$=0,W=0;for(A=c;A<d;++A)for(M=h.grx[A]+h.xbar1*(h.grx[A+1]-h.grx[A]),T=h.grx[A]+h.xbar2*(h.grx[A+1]-h.grx[A]),v=u;v<f;++v){if(!L(A,v,s))continue;D=!k&&s>0,z=!k&&E>y&&s<B.length-2,S=h.gry[v]+h.ybar1*(h.gry[v+1]-h.gry[v]),C=h.gry[v]+h.ybar2*(h.gry[v+1]-h.gry[v]),a=P<=x?w:l.grz(P),o=E>y?F:l.grz(E),Y=0,V=0,k&&(Y+=12,V+=24);let t=n.length,e=m.getBin(A+1,v+1);for(D&&(t-=6);V<t;)X=i[n[V]],g&&V<12?(U[W]=M+X.x*(T-M),U[W+1]=S+X.y*(C-S),U[W+2]=a+X.z*(o-a),G[W]=r[Y],G[W+1]=r[Y+1],G[W+2]=r[Y+2],W%9==0&&(H[W/9]=e),W+=3):(I[$]=M+X.x*(T-M),I[$+1]=S+X.y*(C-S),I[$+2]=a+X.z*(o-a),j[$]=r[Y],j[$+1]=r[Y+1],j[$+2]=r[Y+2],$%9==0&&(q[$/9]=e),$+=3),++V,V%6==0&&(Y+=3,z&&V===n.length-12&&(V+=6,Y+=3))}let Z=new Od;Z.setAttribute("position",new rd(I,3)),Z.setAttribute("normal",new rd(j,3));let Q=e?3:m.fFillColor,J=t.getColor(Q);N?J=e?N.getColor(s):N.calcColor(s,B.length):(1===t.options.Lego||Q<2)&&(Q=1,J="white");let K=new ou({color:J,vertexColors:!1}),tt=new Tu(Z,K);if(tt.face_to_bins_index=q,tt.painter=t,tt.zmin=O,tt.zmax=R,tt.baseline=!1!==t.options.BaseLine?t.options.BaseLine:t.options.Zero?O:0,tt.tip_color=3===Q?16711680:65280,tt.handle=h,tt.tooltip=function(t){if(!Number.isInteger(t.faceIndex))return console.error("faceIndex not provided, three.js version 138"),null;if(t.faceIndex<0||t.faceIndex>=this.face_to_bins_index.length)return null;const e=this.painter,i=this.handle,n=e.getFramePainter(),r=e.getHisto(),s=e.get3DToolTip(this.face_to_bins_index[t.faceIndex]);s.x1=Math.max(-n.size_x3d,i.grx[s.ix-1]+i.xbar1*(i.grx[s.ix]-i.grx[s.ix-1])),s.x2=Math.min(n.size_x3d,i.grx[s.ix-1]+i.xbar2*(i.grx[s.ix]-i.grx[s.ix-1])),s.y1=Math.max(-n.size_y3d,i.gry[s.iy-1]+i.ybar1*(i.gry[s.iy]-i.gry[s.iy-1])),s.y2=Math.min(n.size_y3d,i.gry[s.iy-1]+i.ybar2*(i.gry[s.iy]-i.gry[s.iy-1]));let a=this.baseline,o=s.value;if(r.$baseh&&(a=r.$baseh.getBinContent(s.ix,s.iy)),o<a){let t=a;a=o,o=t}return s.z1=n.grz(Math.max(this.zmin,a)),s.z2=n.grz(Math.min(this.zmax,o)),s.color=this.tip_color,e.is_projection&&2==e.getDimension()&&(s.$painter=e),s},l.toplevel.add(tt),b>0){const e=new Od;e.setAttribute("position",new rd(U,3)),e.setAttribute("normal",new rd(G,3));const i=new ac(Q<2?16711680:ut(J).darker(.5).toString()),n=new ou({color:i,vertexColors:!1}),r=new Tu(e,n);r.face_to_bins_index=H,r.painter=t,r.handle=tt.handle,r.tooltip=tt.tooltip,r.zmin=tt.zmin,r.zmax=tt.zmax,r.baseline=tt.baseline,r.tip_color=tt.tip_color,l.toplevel.add(r)}}if(t.options.Lego>12)return;let F=0,I=0;for(y=R,x=O,A=c;A<d;++A)for(v=u;v<f;++v)L(A,v,0)&&(F+=k?o.length:i.length,I+=k?a.length:s.length);const j=F<=65520;j||(F=3*I);const q=new Float32Array(3*F),U=j?new Uint16Array(I):null,G=l.grz(O),H=l.grz(R);let X=0,V=0,Y=0,$=0;for(A=c;A<d;++A)for(M=h.grx[A]+h.xbar1*(h.grx[A+1]-h.grx[A]),T=h.grx[A]+h.xbar2*(h.grx[A+1]-h.grx[A]),v=u;v<f;++v){if(!L(A,v,0))continue;S=h.gry[v]+h.ybar1*(h.gry[v+1]-h.gry[v]),C=h.gry[v]+h.ybar2*(h.gry[v+1]-h.gry[v]),X=P<=O?G:l.grz(P),V=E>R?H:l.grz(E);const t=k?a:s,e=k?o:i;if(j){for(b=0;b<t.length;++b)U[$++]=Y/3+t[b];for(b=0;b<e.length;++b)w=e[b],q[Y]=M+w.x*(T-M),q[Y+1]=S+w.y*(C-S),q[Y+2]=X+w.z*(V-X),Y+=3}else for(b=0;b<t.length;++b)w=e[t[b]],q[Y]=M+w.x*(T-M),q[Y+1]=S+w.y*(C-S),q[Y+2]=X+w.z*(V-X),Y+=3}const W=e?t.v7EvalColor("line_color","lightblue"):t.getColor(m.fLineColor),Z=Hy(q,new pp({color:new ac(W),linewidth:e?t.v7EvalAttr("line_width",1):m.fLineWidth}),j?U:null);l.toplevel.add(Z)}function rA(t,e=!1){const i=t.getFramePainter(),n=t.getHisto(),r=t.prepareDraw({rounding:!1,use3d:!0,extra:1}),s=i.z_handle.getScaleMin(),a=i.z_handle.getScaleMax();let o,l,h,c,d,u,f,m,p,g,_,x=0,y=null,A=null,v=0;for(let e=0;e<2;++e){for(o=r.i1;o<r.i2;++o)for(u=r.grx[o],m=r.grx[o+1],l=r.j1;l<r.j2;++l)c=n.getBinContent(o+1,l+1),c<s||c>a||(c!==s||t.options.Zero||s>0||t._show_empty_bins)&&(0!==e?(h=n.getBin(o+1,l+1),d=n.getBinError(h),A[v/18]=h,f=r.gry[l],p=r.gry[l+1],g=i.grz(c-d<s?s:c-d),_=i.grz(c+d>a?a:c+d),y[v]=u,y[v+3]=m,y[v+1]=y[v+4]=(f+p)/2,y[v+2]=y[v+5]=(g+_)/2,v+=6,y[v]=y[v+3]=(u+m)/2,y[v+1]=f,y[v+4]=p,y[v+2]=y[v+5]=(g+_)/2,v+=6,y[v]=y[v+3]=(u+m)/2,y[v+1]=y[v+4]=(f+p)/2,y[v+2]=g,y[v+5]=_,v+=6):x+=3);if(0===e){if(0===x)return;y=new Float32Array(6*x),A=new Int32Array(x/3)}}const b=e?t.v7EvalColor("line_color","lightblue"):t.getColor(n.fLineColor),w=Hy(y,new pp({color:new ac(b),linewidth:e?t.v7EvalAttr("line_width",1):n.fLineWidth}));w.painter=t,w.intersect_index=A,w.zmin=s,w.zmax=a,w.tip_color=3===n.fLineColor?16711680:65280,w.tooltip=function(t){if(!Number.isInteger(t.index))return console.error("segment index not provided, three.js version 138"),null;let e=Math.floor(t.index/6);if(e<0||e>=this.intersect_index.length)return null;let i=this.painter,n=i.getHisto(),r=i.getFramePainter(),s=i.get3DToolTip(this.intersect_index[e]);return s.x1=Math.max(-r.size_x3d,r.grx(n.fXaxis.GetBinLowEdge(s.ix))),s.x2=Math.min(r.size_x3d,r.grx(n.fXaxis.GetBinLowEdge(s.ix+1))),s.y1=Math.max(-r.size_y3d,r.gry(n.fYaxis.GetBinLowEdge(s.iy))),s.y2=Math.min(r.size_y3d,r.gry(n.fYaxis.GetBinLowEdge(s.iy+1))),s.z1=r.grz(s.value-s.error<this.zmin?this.zmin:s.value-s.error),s.z2=r.grz(s.value+s.error>this.zmax?this.zmax:s.value+s.error),s.color=this.tip_color,s},i.toplevel.add(w)}function sA(t,e=!1,i=!1){let n=t.getFramePainter(),r=t.prepareDraw({rounding:!1,use3d:!0,extra:100,middle:0}),s=t.getHisto(),a=t.getContourLevels(),o=t.getHistPalette(),l=2*n.size_z3d,h=[];t.buildContour(r,a,o,((t,i,r,s,o,c)=>{if(!(o-s<3||e&&(l=n.grz(a[c]),l<0||l>2*n.size_z3d)))for(let t=s;t<o;++t)h.push(i[t],r[t],l),h.push(i[t+1],r[t+1],l)}));let c=Hy(h,Yy(t,i?"line_":s));n.toplevel.add(c)}function aA(t,e=!1){let i,n,r,s,a,o,l,h,c,d,u=t.getHisto(),f=t.getFramePainter(),m=t.prepareDraw({rounding:!1,use3d:!0,extra:1,middle:.5}),p=f.z_handle.getScaleMin(),g=f.logz?t=>t<p?-.1:f.grz(t):f.grz;if(m.i2-m.i1<2||m.j2-m.j1<2)return;let _=null,x=null,y=!0,A=!1,v=!1,b=null;if(e){let e=0;switch(t.options.Surf){case 11:e=2;break;case 12:case 15:case 17:e=2,y=!1;break;case 14:y=!1,v=!0;break;case 16:e=1,A=!0,y=!1;break;default:_=f.z_handle.createTicks(!0),A=!0}e>0&&(b=f.getHistPalette(),2==e&&t.createContour(f,b,{full_z_range:!0}),_=b.getContour())}else switch(t.options.Surf){case 11:_=t.getContourLevels(),b=t.getHistPalette();break;case 12:case 15:case 17:_=t.getContourLevels(),b=t.getHistPalette(),y=!1;break;case 14:y=!1,v=!0;break;case 16:_=t.getContourLevels(),A=!0,y=!1;break;default:_=f.z_handle.createTicks(!0),A=!0}if(_){x=new Float32Array(_.length);for(let t=0;t<_.length;++t)x[t]=g(_[t])}else x=[0,2*f.size_z3d];let w,M=[],T=[],S=[],C=0,P=null,E=0,k=0,D=null,z=0,O=[];function R(t,e,i){return t<e?-1:t>i?1:0}function L(t,e,i,n,r,s){if(!y)return;let a=R(i,0,2*f.size_z3d),o=R(s,0,2*f.size_z3d);if(a!==o||0===a){if(!w)return++C;if(0!==a){let o=s-i;t=n-(n-t)/o*(s-(i=a<0?0:2*f.size_z3d)),e=r-(r-e)/o*(s-i)}if(0!==o){let a=i-s;n=t-(t-n)/a*(i-(s=o<0?0:2*f.size_z3d)),r=e-(e-r)/a*(i-s)}P[E]=t,P[E+1]=e,P[E+2]=i,E+=3,P[E]=n,P[E+1]=r,P[E+2]=s,E+=3}}let B=new Float32Array(18),N=0,F=0,I=new Float32Array(6),j=0;function q(t,e,i,n,r,s,a,o){N>=B.length&&console.log("more than 6 points???");let l=(a-i)/(s-i),h=3;0!==F&&Math.abs(l)<Math.abs(F)&&(B[N]=B[N-3],B[N+1]=B[N-2],B[N+2]=B[N-1],N-=3,h=6),B[N]=t+l*(n-t),B[N+1]=e+l*(r-e),B[N+2]=a,o&&D&&(I[j]=B[N],I[j+1]=B[N+1],I[j+2]=B[N+2],j+=3),N+=h,F=l}function U(t,e,i){let n=8*((e-m.i1)*(m.j2-m.j1)+(i-m.j1));if(O[n]>=0)return console.error("More than 8 vertexes for the bin");let r=n+8+O[n];O[n]--,O[r]=t}function G(t){for(let e=m.i1;e<m.i2;++e)for(let i=m.j1;i<m.j2;++i){let n=8*((e-m.i1)*(m.j2-m.j1)+(i-m.j1));if(-1===O[n])continue;let r=O[n]>=0?n:n+9+O[n],s=n+8,a=0,o=0,l=0;for(let e=r;e<s;++e){let i=O[e];if(i<0)return console.error("FAILURE in NORMALS RECALCULATIONS");a+=t[i],o+=t[i+1],l+=t[i+2]}a/=s-r,o/=s-r,l/=s-r;for(let e=r;e<s;++e){let i=O[e];t[i]=a,t[i+1]=o,t[i+2]=l}}}function H(t,e,r,s,a,o,l,h,c,d){for(let u=1;u<x.length;++u){let f=R(r,x[u-1],x[u]),m=R(o,x[u-1],x[u]),p=R(c,x[u-1],x[u]),g=f+m+p;if(3===g)continue;if(-3===g)return;if(!w){let t=Math.abs(m-f)+Math.abs(p-m)+Math.abs(f-p);0===f&&++t,0===m&&++t,0===p&&++t,1!==t&&2!==t||console.error("FOND npnts",t),t>2&&(void 0===M[u]&&(M[u]=0),M[u]+=t-2),!(f>0||m>0||p>0)||f===m&&m===p&&p===f||++k;continue}if(j=0,N=0,0===f&&(B[N]=t,B[N+1]=e,B[N+2]=r,N+=3),f!==m&&(F=0,(f<0||m<0)&&q(t,e,r,s,a,o,x[u-1]),(f>0||m>0)&&q(t,e,r,s,a,o,x[u],!0)),0===m&&(B[N]=s,B[N+1]=a,B[N+2]=o,N+=3),m!==p&&(F=0,(m<0||p<0)&&q(s,a,o,l,h,c,x[u-1]),(m>0||p>0)&&q(s,a,o,l,h,c,x[u],!0)),0===p&&(B[N]=l,B[N+1]=h,B[N+2]=c,N+=3),p!==f&&(F=0,(p<0||f<0)&&q(l,h,c,t,e,r,x[u-1]),(p>0||f>0)&&q(l,h,c,t,e,r,x[u],!0)),0===N)continue;if(N<9){console.log("found less than 3 points",N/3);continue}if(D&&6===j){for(let t=0;t<6;++t)D[z+t]=I[t];z+=6}let _=T[u],y=S[u];v&&9===N&&(U(y,i,n),U(y+3,i+1,d?n+1:n),U(y+6,d?i:i+1,n+1));for(let t=3;t<N-3;t+=3)_[y]=B[0],_[y+1]=B[1],_[y+2]=B[2],y+=3,_[y]=B[t],_[y+1]=B[t+1],_[y+2]=B[t+2],y+=3,_[y]=B[t+3],_[y+1]=B[t+4],_[y+2]=B[t+5],y+=3;S[u]=y}}for(v&&(O=new Int32Array((m.i2-m.i1)*(m.j2-m.j1)*8).fill(-1)),w=0;w<2;++w){if(w){for(let t=1;t<x.length;++t)M[t]&&(T[t]=new Float32Array(9*M[t]),S[t]=0);y&&C>0&&(P=new Float32Array(6*C)),A&&k>0&&(D=new Float32Array(6*k))}for(i=m.i1;i<m.i2-1;++i)for(r=m.grx[i],a=m.grx[i+1],n=m.j1;n<m.j2-1;++n)s=m.gry[n],o=m.gry[n+1],l=g(u.getBinContent(i+1,n+1)),h=g(u.getBinContent(i+1,n+2)),c=g(u.getBinContent(i+2,n+1)),d=g(u.getBinContent(i+2,n+2)),H(r,s,l,a,o,d,r,o,h,!0),H(r,s,l,a,s,c,a,o,d,!1),L(r,o,h,r,s,l),L(r,s,l,a,s,c),i===m.i2-2&&L(a,s,c,a,o,d),n===m.j2-2&&L(r,o,h,a,o,d)}for(let i=1;i<x.length;++i)if(T[i]){S[i]!==9*M[i]&&console.error("SURF faces missmatch lvl",i,"faces",M[i],"index",S[i],"check",9*M[i]-S[i]);let n,r,s=new Od;s.setAttribute("position",new rd(T[i],3)),s.computeVertexNormals(),v&&1===i&&G(s.getAttribute("normal").array),e?n=b?b.getColor(i-1):t.getColor(5):b?n=b.calcColor(i,x.length):(n=u.fFillColor>1?t.getColor(u.fFillColor):"white",14===t.options.Surf&&u.fFillColor<2&&(n=t.getColor(48))),r=14===t.options.Surf?new $g({color:n,side:2,vertexColors:!1}):new ou({color:n,side:2,vertexColors:!1});let a=new Tu(s,r);f.toplevel.add(a),a.painter=t}if(P){6*C!==E&&console.error("SURF lines mismmatch nsegm",C," lindx",E,"difference",6*C-E);const e=t.getColor(u.fLineColor),i=new pp({color:new ac(e),linewidth:u.fLineWidth}),n=Hy(P,i);n.painter=t,f.toplevel.add(n)}if(D){6*k!==z&&console.error("SURF grid draw mismatch ngridsegm",k,"gindx",z,"diff",6*k-z);const e=1===t.options.Surf?new Zg({color:0,dashSize:2,gapSize:2}):new pp({color:new ac(t.getColor(u.fLineColor))}),i=Hy(D,e);i.painter=t,f.toplevel.add(i)}if(17===t.options.Surf&&sA(t,!1,e),13===t.options.Surf){m=t.prepareDraw({rounding:!1,use3d:!0,extra:100,middle:0});let e=t.getContourLevels(),i=t.getHistPalette(),n=-1,r=2*f.size_z3d;t.buildContour(m,e,i,((e,s,a,o,l)=>{if(s[l]===s[o]&&a[l]===a[o]&&l--,l-o<3)return;let h=[];for(let t=o;t<=l;++t)t!==o&&s[t]===s[t-1]&&a[t]===a[t-1]||h.push(new Zh(s[t],a[t]));if(h.length<3)return;const c=kg.triangulateShape(h,[]);if(!c||0===c.length)return;(n<0||n!==e)&&(n=e,r+=1e-4*f.size_z3d);const d=new Float32Array(9*c.length),u=new Float32Array(9*c.length);let m=0;for(let t=0;t<c.length;++t){let e=c[t];for(let t=0;t<3;++t){let i=h[e[t]];d[m]=i.x,d[m+1]=i.y,d[m+2]=r,u[m]=0,u[m+1]=0,u[m+2]=1,m+=3}}const p=new Od;p.setAttribute("position",new rd(d,3)),p.setAttribute("normal",new rd(u,3));const g=new ou({color:i.getColor(e),side:2,opacity:.5,vertexColors:!1}),_=new Tu(p,g);_.painter=t,f.toplevel.add(_)}))}}const oA=11102230246251565e-32,lA=-708.3964185322641,hA=709.782712893384,cA=108.11685576785767,dA=4503599627370496,uA=2220446049250313e-31,fA=1.4142135623730951,mA=3.141592653589793;function pA(t,e,i){if(0==i)return e[0];let n=e[0];for(let r=1;r<=i;++r)n=n*t+e[r];return n}function gA(t,e,i){if(0==i)return e[0];let n=t+e[0];for(let r=1;r<i;++r)n=n*t+e[r];return n}function _A(t){let e,i,n,r,s;const a=[-1378.2515256912086,-38801.631513463784,-331612.9927388712,-1162370.974927623,-1721737.0082083966,-853555.6642457654],o=[-351.81570143652345,-17064.210665188115,-220528.59055385445,-1139334.4436798252,-2532523.0717758294,-2018891.4143353277];if(t>=Number.MAX_VALUE||t==Number.POSITIVE_INFINITY)return Number.POSITIVE_INFINITY;if(t<-34)return i=-t,r=_A(i),e=Math.floor(i),e==i?Number.POSITIVE_INFINITY:(s=i-e,s>.5&&(e+=1,s=e-i),s=i*Math.sin(Math.PI*s),s<1e-300?Number.POSITIVE_INFINITY:(s=Math.log(Math.PI)-Math.log(s)-r,s));if(t<13){for(s=1,e=0,n=t;n>=3;)e-=1,n=t+e,s*=n;for(;n<2;){if(n<1e-300)return Number.POSITIVE_INFINITY;s/=n,e+=1,n=t+e}return s<0&&(s=-s),2==n?Math.log(s):(e-=2,e=(t+=e)*pA(t,a,5)/gA(t,o,6),Math.log(s)+e)}return t>2556348e299?Number.POSITIVE_INFINITY:(i=(t-.5)*Math.log(t)-t+.9189385332046728,t>1e8||(e=1/(t*t),i+=t>=1e3?((.0007936507936507937*e-.002777777777777778)*e+.08333333333333333)/t:pA(e,[.0008116141674705085,-.0005950619042843014,.0007936503404577169,-.002777777777300997,.08333333333333319],4)/t),i)}function xA(t){let e,i,n;const r=Math.sqrt(2*Math.PI);return i=1/t,i=1+i*pA(i,[.0007873113957930937,-.00022954996161337813,-.0026813261780578124,.0034722222160545866,.08333333333334822],4),e=Math.exp(t),t>cA?(n=Math.pow(t,.5*t-.25),e=n*(n/e)):e=Math.pow(t,t-.5)/e,e=r*e*i,e}function yA(t){const e=[2.461969814735305e-10,.5641895648310689,7.463210564422699,48.63719709856814,196.5208329560771,526.4451949954773,934.5285271719576,1027.5518868951572,557.5353353693994],i=[13.228195115474499,86.70721408859897,354.9377788878199,975.7085017432055,1823.9091668790973,2246.3376081871097,1656.6630919416134,557.5353408177277],n=[.5641895835477551,1.275366707599781,5.019050422511805,6.160210979930536,7.4097426995044895,2.9788666537210022],r=[2.2605286322011726,9.396035249380015,12.048953980809666,17.08144507475659,9.608968090632859,3.369076451000815];let s,a,o,l,h;return o=t<0?-t:t,o<1?1-AA(t):(h=-t*t,h<-hA?t<0?2:0:(h=Math.exp(h),o<8?(s=pA(o,e,8),a=gA(o,i,8)):(s=pA(o,n,5),a=gA(o,r,6)),l=h*s/a,t<0&&(l=2-l),0==l?t<0?2:0:l))}function AA(t){if(Math.abs(t)>1)return 1-yA(t);let e=t*t;return t*pA(e,[9.604973739870516,90.02601972038427,2232.005345946843,7003.325141128051,55592.30130103949],4)/gA(e,[33.56171416475031,521.3579497801527,4594.323829709801,22629.000061389095,49267.39426086359],5)}function vA(t,e,i=0){let n=(t-i)/(e*fA);return n>1?.5*yA(n):.5*(1-AA(n))}function bA(t,e,i=0){let n=(t-i)/(e*fA);return n<-1?yA(-n):.5*(1+AA(n))}function wA(t,e,i,n=0){if(t-n<=0)return 0;let r=(Math.log(t-n)-e)/i;return 1/((t-n)*Math.abs(i)*Math.sqrt(2*mA))*Math.exp(-r*r/2)}function MA(t){let e,i,n,r,s=1;if(t>=Number.MAX_VALUE)return t;if(i=Math.abs(t),i>33){if(t<0){if(e=Math.floor(i),e==i)return Number.POSITIVE_INFINITY;if(r=Math.round(e),0==(1&r)&&(s=-1),n=i-e,n>.5&&(e+=1,n=i-e),n=i*Math.sin(Math.PI*n),0==n)return s>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;n=Math.abs(n),n=Math.PI/(n*xA(i))}else n=xA(t);return s*n}for(n=1;t>=3;)n*=t-=1;let a=!1;for(;t<0&&!a;)t>-1e-9?a=!0:(n/=t,t+=1);for(;t<2&&!a;)t<1e-9?a=!0:(n/=t,t+=1);if(a)return 0==t?Number.POSITIVE_INFINITY:n/((1+.5772156649015329*t)*t);if(2==t)return n;return e=pA(t-=2,[.00016011952247675185,.0011913514700658638,.010421379756176158,.04763678004571372,.20744822764843598,.4942148268014971,1],6),i=pA(t,[-23158187332412014e-21,.0005396055804933034,-.004456419138517973,.011813978522206043,.035823639860549865,-.23459179571824335,.0714304917030273,1],7),n*e/i}function TA(t){if(t<=0)return Number.NEGATIVE_INFINITY;if(t>=1)return Number.POSITIVE_INFINITY;const e=[1.9544885833814176,4.676279128988815,86.36024213908905,-225.46268785411937,200.26021238006066,-82.03722561683334,15.90562251262117,-1.1833162112133],i=.1353352832366127;let n,r,s,a,o,l=1,h=t;return h>1-i&&(h=1-h,l=0),h>i?(h-=.5,s=h*h,n=h+h*(s*pA(s,[-59.96335010141079,98.00107541859997,-56.67628574690703,13.931260938727968,-1.2391658386738125],4)/gA(s,e,8)),n*=2.5066282746310007,n):(n=Math.sqrt(-2*Math.log(h)),a=n-Math.log(n)/n,r=1/n,o=n<8?r*pA(r,[4.0554489230596245,31.525109459989388,57.16281922464213,44.08050738932008,14.684956192885803,2.1866330685079025,-.1402560791713545,-.03504246268278482,-.0008574567851546854],8)/gA(r,[15.779988325646675,45.39076351288792,41.3172038254672,15.04253856929075,2.504649462083094,-.14218292285478779,-.03808064076915783,-.0009332594808954574],8):r*pA(r,[3.2377489177694603,6.915228890689842,3.9388102529247444,1.3330346081580755,.20148538954917908,.012371663481782003,.00030158155350823543,26580697468673755e-22,6.239745391849833e-9],8)/gA(r,[6.02427039364742,3.6798356385616087,1.3770209948908132,.21623699359449663,.013420400608854318,.00032801446468212774,28924786474538068e-22,6.790194080099813e-9],8),n=a-o,0!=l&&(n=-n),n)}function SA(t,e){return e*TA(t)}function CA(t,e){if(t<=0)return 0;if(e<=0)return 1;if(e<1||e<t)return 1-PA(t,e);let i=t*Math.log(e)-e-_A(t);if(i<-hA)return 0;i=Math.exp(i);let n,r,s,a,o,l=1-t,h=e+l+1,c=0,d=1,u=e,f=e+1,m=h*e,p=f/m;do{c+=1,l+=1,h+=2,n=l*c,a=f*h-d*n,o=m*h-u*n,o?(r=a/o,s=Math.abs((p-r)/r),p=r):s=1,d=f,f=a,u=m,m=o,Math.abs(a)>dA&&(d*=uA,f*=uA,u*=uA,m*=uA)}while(s>oA);return p*i}function PA(t,e){if(t<=0)return 1;if(e<=0)return 0;if(e>1&&e>t)return 1-CA(t,e);let i=t*Math.log(e)-e-_A(t);if(i<-hA)return 0;i=Math.exp(i);let n=t,r=1,s=1;do{n+=1,r*=e/n,s+=r}while(r/s>oA);return s*i/t}function EA(t,e){if(t<=0)return console.error("igami : Wrong domain for parameter a (must be > 0)"),0;if(e<=0)return Number.POSITIVE_INFINITY;if(e>=1)return 0;const i=Number.MAX_VALUE;let n,r,s,a,o,l,h=i,c=0,d=0,u=1,f=5*oA;for(s=1/(9*t),r=1-s-TA(e)*Math.sqrt(s),n=t*r*r*r,a=_A(t),o=0;o<10&&!(n>h||n<c)&&(r=CA(t,n),!(r<d||r>u))&&(r<e?(h=n,d=r):(c=n,u=r),s=(t-1)*Math.log(n)-n-a,!(s<-hA));++o){if(s=-Math.exp(s),s=(r-e)/s,Math.abs(s/n)<oA)return n;n-=s}if(s=.0625,h==i)for(n<=0&&(n=1);h==i;){if(n*=1+s,r=CA(t,n),r<e){h=n,d=r;break}s+=s}for(s=.5,l=0,o=0;o<400&&(n=c+s*(h-c),r=CA(t,n),a=(h-c)/(c+h),!(Math.abs(a)<f))&&(a=(r-e)/e,!(Math.abs(a)<f))&&!(n<=0);++o)r>=e?(c=n,u=r,l<0?(l=0,s=.5):s=l>1?.5*s+.5:(e-d)/(u-d),l+=1):(h=n,d=r,l>0?(l=0,s=.5):l<-1?s*=.5:s=(e-d)/(u-d),l-=1);return n}function kA(t,e,i){if(void 0===i&&(i=0),e<=0)return 0;const n=(t-i)/e;let r,s,a,o;const l=[.4259894875,-.124976255,.039842437,-.006298287635,.001511162253],h=[1,-.3388260629,.09594393323,-.01608042283,.003778942063],c=[.1788541609,.1173957403,.01488850518,-.001394989411,.0001283617211],d=[1,.7428795082,.3153932961,.06694219548,.008790609714],u=[.1788544503,.09359161662,.006325387654,6611667319e-14,-2031049101e-15],f=[1,.6097809921,.2560616665,.04746722384,.006957301675],m=[.9874054407,118.6723273,849.279436,-743.7792444,427.0262186],p=[1,106.8615961,337.6496214,2016.712389,1597.063511],g=[1.003675074,167.5702434,4789.711289,21217.86767,-22324.9491],_=[1,156.9424537,3745.310488,9834.698876,66924.28357],x=[1.000827619,664.9143136,62972.92665,475554.6998,-5743609.109],y=[1,651.4101098,56974.73333,165917.4725,-2815759.939],A=[.04166666667,-.01996527778,.02709538966],v=[-1.84556867,-4.284640743];if(n<-5.5){if(r=Math.exp(n+1),r<1e-10)return 0;s=Math.exp(-1/r),a=Math.sqrt(r),o=s/a*.3989422803*(1+(A[0]+(A[1]+A[2]*r)*r)*r)}else n<-1?(r=Math.exp(-n-1),o=Math.exp(-r)*Math.sqrt(r)*(l[0]+(l[1]+(l[2]+(l[3]+l[4]*n)*n)*n)*n)/(h[0]+(h[1]+(h[2]+(h[3]+h[4]*n)*n)*n)*n)):n<1?o=(c[0]+(c[1]+(c[2]+(c[3]+c[4]*n)*n)*n)*n)/(d[0]+(d[1]+(d[2]+(d[3]+d[4]*n)*n)*n)*n):n<5?o=(u[0]+(u[1]+(u[2]+(u[3]+u[4]*n)*n)*n)*n)/(f[0]+(f[1]+(f[2]+(f[3]+f[4]*n)*n)*n)*n):n<12?(r=1/n,o=r*r*(m[0]+(m[1]+(m[2]+(m[3]+m[4]*r)*r)*r)*r)/(p[0]+(p[1]+(p[2]+(p[3]+p[4]*r)*r)*r)*r)):n<50?(r=1/n,o=r*r*(g[0]+(g[1]+(g[2]+(g[3]+g[4]*r)*r)*r)*r)/(_[0]+(_[1]+(_[2]+(_[3]+_[4]*r)*r)*r)*r)):n<300?(r=1/n,o=r*r*(x[0]+(x[1]+(x[2]+(x[3]+x[4]*r)*r)*r)*r)/(y[0]+(y[1]+(y[2]+(y[3]+y[4]*r)*r)*r)*r)):(r=1/(n-n*Math.log(n)/(n+1)),o=r*r*(1+(v[0]+v[1]*r)*r));return o/e}function DA(t,e,i,n){if(i<=0)return 0;const r=kA((t-e)/i,1,0);return n?r/i:r}function zA(t,e){return CA(t,e)}function OA(t,e){return PA(t,e)}function RA(t){return _A(t)}function LA(t,e,i){if(t<0||t>1)return 0;if(0==t){if(e<1)return Number.POSITIVE_INFINITY;if(e>1)return 0;if(1==e)return i}if(1==t){if(i<1)return Number.POSITIVE_INFINITY;if(i>1)return 0;if(1==i)return e}return Math.exp(RA(e+i)-RA(e)-RA(i)+Math.log(t)*(e-1)+Math.log1p(-t)*(i-1))}function BA(t,e,i){return void 0===i&&(i=0),zA(.5*e,.5*(t-i))}function NA(t,e,i){let n,r,s,a,o,l,h,c;for(c=1/t,s=(1-e)*i,a=s/(t+1),l=a,r=s,o=2,n=0,h=oA*c;Math.abs(a)>h;)s=(o-e)*i/o,r*=s,a=r/(t+o),n+=a,o+=1;return n+=l,n+=c,s=t*Math.log(i),t+e<cA&&Math.abs(s)<hA?(r=MA(t+e)/(MA(t)*MA(e)),n=n*r*Math.pow(i,t)):(r=_A(t+e)-_A(t)-_A(e)+s+Math.log(n),n=r<lA?0:Math.exp(r)),n}function FA(t,e,i){let n,r,s,a,o,l,h,c;return t<=0||e<=0||i<=0?0:i>=1?1:(c=0,l=1-i,i>t/(t+e)?(c=1,n=e,r=t,o=i,a=l):(n=t,r=e,o=l,a=i),1==c&&r*a<=1&&a<=.95?s=NA(n,r,a):(h=a*(n+r-2)-(n-1),l=h<0?function(t,e,i){let n,r,s,a,o,l,h,c,d,u,f,m,p,g,_,x,y,A,v,b;c=t,d=t+e,u=t,f=t+1,m=1,p=e-1,g=f,_=t+2,a=0,h=1,s=1,l=1,A=1,x=1,b=0,v=3*oA;do{if(n=-i*c*d/(u*f),r=s+a*n,o=l+h*n,a=s,s=r,h=l,l=o,n=i*m*p/(g*_),r=s+a*n,o=l+h*n,a=s,s=r,h=l,l=o,0!=o&&(x=r/o),0!=x?(y=Math.abs((A-x)/x),A=x):y=1,y<33306690738754696e-32)break;c+=1,d+=1,u+=2,f+=2,m+=1,p-=1,g+=2,_+=2,Math.abs(o)+Math.abs(r)>dA&&(a*=uA,s*=uA,h*=uA,l*=uA),(Math.abs(o)<uA||Math.abs(r)<uA)&&(a*=dA,s*=dA,h*=dA,l*=dA)}while(++b<300);return A}(n,r,a):function(t,e,i){let n,r,s,a,o,l,h,c,d,u,f,m,p,g,_,x,y,A,v,b,w;c=t,d=e-1,u=t,f=t+1,m=1,p=t+e,g=t+1,_=t+2,a=0,h=1,s=1,l=1,v=i/(1-i),A=1,x=1,w=0,b=3*oA;do{if(n=-v*c*d/(u*f),r=s+a*n,o=l+h*n,a=s,s=r,h=l,l=o,n=v*m*p/(g*_),r=s+a*n,o=l+h*n,a=s,s=r,h=l,l=o,0!=o&&(x=r/o),0!=x?(y=Math.abs((A-x)/x),A=x):y=1,y<33306690738754696e-32)break;c+=1,d-=1,u+=2,f+=2,m+=1,p+=1,g+=2,_+=2,Math.abs(o)+Math.abs(r)>dA&&(a*=uA,s*=uA,h*=uA,l*=uA),(Math.abs(o)<uA||Math.abs(r)<uA)&&(a*=dA,s*=dA,h*=dA,l*=dA)}while(++w<300);return A}(n,r,a)/o,h=n*Math.log(a),s=r*Math.log(o),n+r<cA&&Math.abs(h)<hA&&Math.abs(s)<hA?(s=Math.pow(o,r),s*=Math.pow(a,n),s/=n,s*=l,s*=MA(n+r)/(MA(n)*MA(r))):(h+=s+_A(n+r)-_A(n)-_A(r),h+=Math.log(l/n),s=h<lA?0:Math.exp(h))),1==c&&(s=s<=oA?1-oA:1-s),s)}function IA(t,e,i){let n,r,s,a,o,l,h,c,d,u,f,m,p,g,_,x,y,A,v,b=!0;if(t<=0)return 0;if(e<=0)return 0;const w=()=>(y&&(l=l<=oA?1-oA:1-l),l);if(x=0,i<=0)return 0;if(i>=1)return 1;if(h=0,p=0,c=1,g=1,v=0,t<=1||e<=1)m=1e-6,y=0,n=t,r=e,s=i,l=n/(n+r),o=FA(n,r,l);else{if(m=1e-4,u=-TA(i),i>.5?(y=1,n=e,r=t,s=1-i,u=-u):(y=0,n=t,r=e,s=i),d=(u*u-3)/6,l=2/(1/(2*n-1)+1/(2*r-1)),a=u*Math.sqrt(l+d)/l-(1/(2*r-1)-1/(2*n-1))*(d+5/6-2/(3*l)),a*=2,a<lA)return l=0,w();l=n/(n+r*Math.exp(a)),o=FA(n,r,l),u=(o-s)/s,Math.abs(u)<.2&&(b=!1)}let M=1e3;for(;M-- >0;){for(;b;){for(A=0,f=.5,x=0;x<100;x++){if(0!=x){if(l=h+f*(c-h),1==l&&(l=1-oA),0==l&&(f=.5,l=h+f*(c-h),0==l))return w();if(o=FA(n,r,l),u=(c-h)/(c+h),Math.abs(u)<m)break;if(u=(o-s)/s,Math.abs(u)<m)break}if(o<s){if(h=l,p=o,A<0?(A=0,f=.5):f=A>3?1-(1-f)*(1-f):A>1?.5*f+.5:(s-o)/(g-p),A+=1,h>.75){1==y?(y=0,n=t,r=e,s=i):(y=1,n=e,r=t,s=1-i),l=1-l,o=FA(n,r,l),h=0,p=0,c=1,g=1;continue}}else{if(c=l,1==y&&c<oA)return l=0,w();g=o,A>0?(A=0,f=.5):A<-3?f*=f:A<-1?f*=.5:f=(o-s)/(g-p),A-=1}}if(h>=1)return l=1-oA,w();if(l<=0)return l=0,w();break}if(b=!0,v)return w();for(v=1,d=_A(n+r)-_A(n)-_A(r),x=0;x<8&&(0!=x&&(o=FA(n,r,l)),o<p?(l=h,o=p):o>g?(l=c,o=g):o<s?(h=l,p=o):(c=l,g=o),1!=l&&0!=l);x++){if(a=(n-1)*Math.log(l)+(r-1)*Math.log(1-l)+d,a<lA)return w();if(a>hA)break;if(a=Math.exp(a),a=(o-s)/a,_=l-a,_<=h&&(o=(l-h)/(c-h),_=h+.5*o*(l-h),_<=0))break;if(_>=c&&(o=(c-l)/(c-h),_=c-.5*o*(c-l),_>=1))break;if(l=_,Math.abs(a/l)<128*oA)return w()}m=256*oA}return w()}function jA(t,e,i){return FA(e,i,t)}const qA=jA;function UA(t,e,i){return IA(e,i,t)}function GA(t,e,i){return jA(1-t,i,e)}function HA(t,e,i,n=0){return t-n<0?0:t-n==0?1==e?1/i:0:1==e?Math.exp(-(t-n)/i)/i:Math.exp((e-1)*Math.log((t-n)/i)-(t-n)/i-RA(e))/i}function XA(t,e,i,n=0){return e<0||i<0?Number.NaN:t-n<0?0:Math.exp(e/2*Math.log(e)+i/2*Math.log(i)+RA((e+i)/2)-RA(e/2)-RA(i/2)+(e/2-1)*Math.log(t-n)-(e+i)/2*Math.log(i+e*(t-n)))}function VA(t,e,i,n=0){if(e<0||i<0)return Number.NaN;return i/(i+e*(t-n))>.9&&e>1&&i>1?1-YA(t,e,i,n):jA(i/(i+e*(t-n)),.5*i,.5*e)}function YA(t,e,i,n=0){if(e<0||i<0)return Number.NaN;let r=e*(t-n)/(i+e*(t-n));return r>.9&&e>1&&i>1?1-VA(t,e,i,n):jA(r,.5*e,.5*i)}function $A(t,e){return e<=0?0:t<=0?t<0?0:1:BA(t,e,0)}function WA(t,e){return Math.exp(RA(t)+RA(e)-RA(t+e))}function ZA(t,e,i){return t.GetParValue(i+0)*Math.exp(-.5*Math.pow((e-t.GetParValue(i+1))/t.GetParValue(i+2),2))}function QA(t,e,i,n,r=0){if(n<0)return 0;let s=(t-r)/n;e<0&&(s=-s);let a=Math.abs(e);if(s>-a)return Math.exp(-.5*s*s);let o=i/a,l=o/(o-a-s);return Math.exp(-.5*a*a)*Math.pow(l,i)}function JA(t,e,i,n,r=0){if(0==n)return 0;if(0==e)return 0;let s=1==i,a=(t-r)/n;e<0&&(a=-a);let o=Math.abs(e),l=0,h=0;const c=Math.sqrt(mA/2),d=Math.sqrt(2*mA),u=1/Math.sqrt(2);if(a<=-o){let t=Math.pow(i/o,i)*Math.exp(-.5*e*e),n=i/o-o;if(s)h=-t*Math.log(i/o)+t*Math.log(n-a);else{h=i/o*(1/(i-1))*Math.exp(-e*e/2)-t/(i-1)*Math.pow(n-a,1-i)}l=c*(1+AA(o*u))}else l=vA(a,1),l*=d,h=0;return n*(l+h)}function KA(t,e,i){let n=0,r=0,s=2*e;for(let e=t;e>=1;e--){let t=n;n=s*n-r+i[e],r=t}return e*n-r+i[0]}function tv(t,e,i,n){let r=(1-i)/2;return n?e==t?1:UA(1-r,e+1,t-e):0==e?0:UA(r,e,t-e+1)}function ev(t,e,i,n){if(0==t)return n?1:0;let r=e/t,s=SA(1-(1-i)/2,Math.sqrt(r*(1-r)/t));return n?r+s>1?1:r+s:r-s<0?0:r-s}function iv(t,e,i,n){if(0==t)return n?1:0;let r=e/t,s=SA(1-(1-i)/2,1),a=(e+.5*s*s)/(t+s*s),o=s/(t+s*s)*Math.sqrt(t*r*(1-r)+s*s/4);return n?a+o>1?1:a+o:a-o<0?0:a-o}function nv(t,e,i,n){let r=SA(1-(1-i)/2,1),s=(e+.5*r*r)/(t+r*r),a=r*Math.sqrt(s*(1-s)/(t+r*r));return n?s+a>1?1:s+a:s-a<0?0:s-a}function rv(t,e,i,n){const r=(1-i)/2;let s=0,a=1,o=0;if(e>0&&e<1){let r=rv(t,0,i,n);return o=(rv(t,1,i,n)-r)*e+r,o}for(;Math.abs(a-s)>1e-9;){o=(s+a)/2;let i=.5*LA(o,e+1,t-e+1)/(t+1);e-1>=0&&(i+=GA(o,e,t-e+1)),i>(n?r:1-r)?s=o:a=o}return o}function sv(t,e,i,n,r,s){let a=e+r,o=t-e+s;return n?a>0&&o>0?UA((1+i)/2,a,o):1:a>0&&o>0?UA((1-i)/2,a,o):0}function av(t,e){if(e)return sv;switch(t){case 0:return tv;case 1:return ev;case 2:return iv;case 3:return nv;case 4:return console.log("Feldman-Cousins interval kFFC not supported; using kFCP"),tv;case 8:return rv}return console.log(`Not recognized stat option ${t}, using kFCP`),tv}var ov=Object.freeze({__proto__:null,gamma:MA,tgamma:MA,Gamma:MA,Polynomialeval:pA,Polynomial1eval:gA,stirf:xA,gamma_pdf:HA,ndtri:TA,normal_quantile:SA,normal_quantile_c:function(t,e){return-e*TA(t)},lognormal_cdf_c:function(t,e,i,n){void 0===n&&(n=0);let r=(Math.log(t-n)-e)/(i*fA);return r>1?.5*yA(r):.5*(1-AA(r))},lognormal_cdf:function(t,e,i,n=0){let r=(Math.log(t-n)-e)/(i*fA);return r<-1?.5*yA(-r):.5*(1+AA(r))},igami:EA,igamc:CA,igam:PA,lgam:_A,lgamma:RA,erfc:yA,erf:AA,beta_pdf:LA,inc_beta:jA,BetaIncomplete:qA,pseries:NA,incbet:FA,incbi:IA,beta_quantile:UA,chisquared_cdf_c:BA,beta:function(t,e){return Math.exp(RA(t)+RA(e)-RA(t+e))},inc_gamma:OA,inc_gamma_c:zA,landau_pdf:kA,beta_cdf_c:GA,Landau:DA,fdistribution_pdf:XA,FDist:XA,fdistribution_cdf:YA,FDistI:YA,fdistribution_cdf_c:VA,normal_cdf_c:vA,gaussian_cdf_c:vA,normal_cdf:bA,gaussian_cdf:bA,lognormal_pdf:wA,normal_pdf:function(t,e=1,i=0){let n=(t-i)/e;return 1/(Math.sqrt(2*mA)*Math.abs(e))*Math.exp(-n*n/2)},crystalball_function:QA,crystalball_pdf:function(t,e,i,n,r=0){if(n<0)return 0;if(i<=1)return Number.NaN;let s=Math.abs(e);return 1/(n*(i/s*1/(i-1)*Math.exp(-e*e/2)+Math.sqrt(mA/2)*(1+AA(s/Math.sqrt(2)))))*QA(t,e,i,n,r)},crystalball_cdf:function(t,e,i,n,r=0){if(i<=1)return Number.NaN;let s=Math.abs(e),a=n*(i/s*1/(i-1)*Math.exp(-e*e/2)+Math.sqrt(mA/2)*(1+AA(s/Math.sqrt(2)))),o=JA(t,e,i,n,r);return e>0?1-o/a:o/a},crystalball_cdf_c:function(t,e,i,n,r=0){if(i<=1)return Number.NaN;let s=Math.abs(e),a=n*(i/s*1/(i-1)*Math.exp(-e*e/2)+Math.sqrt(mA/2)*(1+AA(s/Math.sqrt(2)))),o=JA(t,e,i,n,r);return e>0?o/a:1-o/a},chisquared_cdf:function(t,e,i=0){return OA(.5*e,.5*(t-i))},gamma_quantile_c:function(t,e,i){return i*EA(e,t)},gamma_quantile:function(t,e,i){return i*EA(e,1-t)},breitwigner_cdf_c:function(t,e,i=0){return.5-Math.atan(2*(t-i)/e)/mA},breitwigner_cdf:function(t,e,i=0){return.5+Math.atan(2*(t-i)/e)/mA},cauchy_cdf_c:function(t,e,i=0){return.5-Math.atan((t-i)/e)/mA},cauchy_cdf:function(t,e,i=0){return.5+Math.atan((t-i)/e)/mA},cauchy_pdf:function(t,e=1,i=0){return e/(mA*((t-i)*(t-i)+e*e))},gaussian_pdf:function(t,e=1,i=0){let n=(t-i)/e;return 1/(Math.sqrt(2*mA)*Math.abs(e))*Math.exp(-n*n/2)},tdistribution_cdf_c:function(t,e,i=0){let n=t-i,r=n>0?1:-1;return.5-.5*jA(n*n/(e+n*n),.5,.5*e)*r},tdistribution_cdf:function(t,e,i=0){let n=t-i,r=n>0?1:-1;return.5+.5*jA(n*n/(e+n*n),.5,.5*e)*r},tdistribution_pdf:function(t,e,i=0){return Math.exp(RA((e+1)/2)-RA(e/2))/Math.sqrt(mA*e)*Math.pow(1+(t-i)*(t-i)/e,-(e+1)/2)},exponential_cdf_c:function(t,e,i=0){return t-i<0?1:Math.exp(-e*(t-i))},exponential_cdf:function(t,e,i=0){return t-i<0?0:-Math.expm1(-e*(t-i))},chisquared_pdf:function(t,e,i){return void 0===i&&(i=0),t-i<0?0:t==i&&0==e/2-1?.5:Math.exp((e/2-1)*Math.log((t-i)/2)-(t-i)/2-RA(e/2))/2},Beta:WA,GammaDist:function(t,e,i=0,n=1){return t<i||e<=0||n<=0?0:HA(t,e,n,i)},LaplaceDist:function(t,e=0,i=1){return Math.exp(-Math.abs((t-e)/i))/(2*i)},LaplaceDistI:function(t,e=0,i=1){return t<=e?.5*Math.exp(-Math.abs((t-e)/i)):1-.5*Math.exp(-Math.abs((t-e)/i))},LogNormal:function(t,e,i=0,n=1){return t<i||e<=0||n<=0?0:wA(t,Math.log(n),e,i)},Student:function(t,e){if(e<1)return 0;let i=e,n=.5*i,r=n+.5,s=Math.sqrt(i*Math.PI)*MA(n)*Math.pow(1+t*t/i,r);return MA(r)/s},StudentI:function(t,e){let i=e;return t>0?1-.5*qA(i/(i+t*t),.5*i,.5):.5*qA(i/(i+t*t),.5*i,.5)},gaus:ZA,gausn:function(t,e,i){return ZA(t,e,i)/(Math.sqrt(2*Math.PI)*t.GetParValue(i+2))},gausxy:function(t,e,i,n){return t.GetParValue(n+0)*Math.exp(-.5*Math.pow((e-t.GetParValue(n+1))/t.GetParValue(n+2),2))*Math.exp(-.5*Math.pow((i-t.GetParValue(n+3))/t.GetParValue(n+4),2))},expo:function(t,e,i){return Math.exp(t.GetParValue(i+0)+t.GetParValue(i+1)*e)},Prob:$A,Gaus:function(t,e,i){return Math.exp(-.5*Math.pow((t-e)/i,2))},BreitWigner:function(t,e,i){return i/((t-e)*(t-e)+i*i/4)/2/Math.PI},BetaDist:function(t,e,i){if(t<0||t>1||e<=0||i<=0)return 0;let n=WA(e,i);return Math.pow(t,e-1)*Math.pow(1-t,i-1)/n},BetaDistI:function(t,e,i){return t<0||t>1||e<=0||i<=0?0:qA(t,e,i)},landau:function(t,e,i){return DA(e,t.GetParValue(i+1),t.GetParValue(i+2),!1)},landaun:function(t,e,i){return DA(e,t.GetParValue(i+1),t.GetParValue(i+2),!0)},ChebyshevN:KA,Chebyshev1:function(t,e,i){return e+i*t},Chebyshev2:function(t,e,i,n){return e+i*t+n*(2*t*t-1)},Chebyshev3:function(t,...e){return KA(3,t,e)},Chebyshev4:function(t,...e){return KA(4,t,e)},Chebyshev5:function(t,...e){return KA(5,t,e)},Chebyshev6:function(t,...e){return KA(6,t,e)},Chebyshev7:function(t,...e){return KA(7,t,e)},Chebyshev8:function(t,...e){return KA(8,t,e)},Chebyshev9:function(t,...e){return KA(9,t,e)},Chebyshev10:function(t,...e){return KA(10,t,e)},getTEfficiencyBoundaryFunc:av});function lv(t,e){if(l()||"undefined"==typeof document)return;let i="jsroot_progressbox",n=Ii("#"+i);if(!m.ProgressBox)return n.remove();0!=arguments.length&&t?(n.empty()&&(n=Ii(document.body).append("div").attr("id",i).attr("style","position: fixed; min-width: 100px; height: auto; overflow: visible; z-index: 101; border: 1px solid #999; background: #F8F8F8; left: 10px; bottom: 10px;"),n.append("p")),n.property("with_timeout",!1),"string"==typeof t?n.select("p").html(t):(n.html(""),n.node().appendChild(t)),gv("#jsroot_progressbox p { font-size: 10px; margin-left: 10px; margin-right: 10px; margin-top: 3px; margin-bottom: 3px; }",n.node()),Number.isFinite(e)&&e>0&&(n.property("with_timeout",!0),setTimeout((()=>lv("",-1)),e))):(-1!==e||!n.empty()&&n.property("with_timeout"))&&n.remove()}function hv(){window&&(window.close(),window.open("","_self").close())}function cv(t,e){if(!t||0==t.length)return void(e.rejectFunc&&(e.rejectFunc(Error("openui5 was not possible to load")),e.rejectFunc=null));let i=t.shift();0==i.indexOf("roothandler")&&i.indexOf("://")<0&&(i=i.replace(/\:\//g,"://"));let n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("id","sap-ui-bootstrap"),n.setAttribute("src",i+"resources/sap-ui-core.js"),n.setAttribute("data-sap-ui-libs",e.openui5libs??"sap.m, sap.ui.layout, sap.ui.unified, sap.ui.commons"),n.setAttribute("data-sap-ui-theme",e.openui5theme||"sap_belize"),n.setAttribute("data-sap-ui-compatVersion","edge"),n.setAttribute("data-sap-ui-preload","async"),n.setAttribute("data-sap-ui-evt-oninit","completeUI5Loading()"),n.onerror=function(){n.parentNode.removeChild(n),cv(t,e)},n.onload=function(){console.log("Load openui5 from "+i)},document.head.appendChild(n)}function dv(e){if("object"==typeof sap)return Promise.resolve(sap);e||(e={});let i=t.source_dir.replace(/jsrootsys/g,"rootui5sys");i==t.source_dir&&(i=window.location.port&&window.location.pathname.indexOf("/win")>=0&&(!e.openui5src||"nojsroot"==e.openui5src||"jsroot"==e.openui5src)?window.location.origin+window.location.pathname+"../rootui5sys/":void 0);let n=[],r="https://openui5.hana.ondemand.com/1.98.0/",s=i?i+"distribution/":"";if("string"==typeof e.openui5src)switch(e.openui5src){case"nodefault":r="";break;case"default":n.push(r),r="";break;case"nojsroot":break;case"jsroot":n.push(s),s="";break;default:n.push(e.openui5src)}return s&&n.indexOf(s)<0&&n.push(s),r&&n.indexOf(r)<0&&n.push(r),new Promise(((r,s)=>{e.resolveFunc=r,e.rejectFunc=s,globalThis.completeUI5Loading=function(){sap.ui.loader.config({paths:{jsroot:t.source_dir,rootui5:i}}),e.resolveFunc&&(e.resolveFunc(sap),e.resolveFunc=null)},cv(n,e)}))}const uv={camera:{path:"M 152.00,304.00c0.00,57.438, 46.562,104.00, 104.00,104.00s 104.00-46.562, 104.00-104.00s-46.562-104.00-104.00-104.00S 152.00,246.562, 152.00,304.00z M 480.00,128.00L 368.00,128.00 c-8.00-32.00-16.00-64.00-48.00-64.00L 192.00,64.00 c-32.00,0.00-40.00,32.00-48.00,64.00L 32.00,128.00 c-17.60,0.00-32.00,14.40-32.00,32.00l0.00,288.00 c0.00,17.60, 14.40,32.00, 32.00,32.00l 448.00,0.00 c 17.60,0.00, 32.00-14.40, 32.00-32.00L 512.00,160.00 C 512.00,142.40, 497.60,128.00, 480.00,128.00z M 256.00,446.00c-78.425,0.00-142.00-63.574-142.00-142.00c0.00-78.425, 63.575-142.00, 142.00-142.00c 78.426,0.00, 142.00,63.575, 142.00,142.00 C 398.00,382.426, 334.427,446.00, 256.00,446.00z M 480.00,224.00l-64.00,0.00 l0.00-32.00 l 64.00,0.00 L 480.00,224.00 z"},disk:{path:"M384,0H128H32C14.336,0,0,14.336,0,32v448c0,17.656,14.336,32,32,32h448c17.656,0,32-14.344,32-32V96L416,0H384z M352,160   V32h32v128c0,17.664-14.344,32-32,32H160c-17.664,0-32-14.336-32-32V32h128v128H352z M96,288c0-17.656,14.336-32,32-32h256   c17.656,0,32,14.344,32,32v192H96V288z"},question:{path:"M256,512c141.375,0,256-114.625,256-256S397.375,0,256,0S0,114.625,0,256S114.625,512,256,512z M256,64   c63.719,0,128,36.484,128,118.016c0,47.453-23.531,84.516-69.891,110.016C300.672,299.422,288,314.047,288,320   c0,17.656-14.344,32-32,32c-17.664,0-32-14.344-32-32c0-40.609,37.25-71.938,59.266-84.031   C315.625,218.109,320,198.656,320,182.016C320,135.008,279.906,128,256,128c-30.812,0-64,20.227-64,64.672   c0,17.664-14.336,32-32,32s-32-14.336-32-32C128,109.086,193.953,64,256,64z M256,449.406c-18.211,0-32.961-14.75-32.961-32.969   c0-18.188,14.75-32.953,32.961-32.953c18.219,0,32.969,14.766,32.969,32.953C288.969,434.656,274.219,449.406,256,449.406z"},undo:{path:"M450.159,48.042c8.791,9.032,16.983,18.898,24.59,29.604c7.594,10.706,14.146,22.207,19.668,34.489  c5.509,12.296,9.82,25.269,12.92,38.938c3.113,13.669,4.663,27.834,4.663,42.499c0,14.256-1.511,28.863-4.532,43.822  c-3.009,14.952-7.997,30.217-14.953,45.795c-6.955,15.577-16.202,31.52-27.755,47.826s-25.88,32.9-42.942,49.807  c-5.51,5.444-11.787,11.67-18.834,18.651c-7.033,6.98-14.496,14.366-22.39,22.168c-7.88,7.802-15.955,15.825-24.187,24.069  c-8.258,8.231-16.333,16.203-24.252,23.888c-18.3,18.13-37.354,37.016-57.191,56.65l-56.84-57.445  c19.596-19.472,38.54-38.279,56.84-56.41c7.75-7.685,15.772-15.604,24.108-23.757s16.438-16.163,24.33-24.057  c7.894-7.893,15.356-15.33,22.402-22.312c7.034-6.98,13.312-13.193,18.821-18.651c22.351-22.402,39.165-44.648,50.471-66.738  c11.279-22.09,16.932-43.567,16.932-64.446c0-15.785-3.217-31.005-9.638-45.671c-6.422-14.665-16.229-28.504-29.437-41.529  c-3.282-3.282-7.358-6.395-12.217-9.325c-4.871-2.938-10.381-5.503-16.516-7.697c-6.121-2.201-12.815-3.992-20.058-5.373  c-7.242-1.374-14.9-2.064-23.002-2.064c-8.218,0-16.802,0.834-25.788,2.507c-8.961,1.674-18.053,4.429-27.222,8.271  c-9.189,3.842-18.456,8.869-27.808,15.089c-9.358,6.219-18.521,13.819-27.502,22.793l-59.92,60.271l93.797,94.058H0V40.91  l93.27,91.597l60.181-60.532c13.376-15.018,27.222-27.248,41.536-36.697c14.308-9.443,28.608-16.776,42.89-21.992  c14.288-5.223,28.505-8.74,42.623-10.557C294.645,0.905,308.189,0,321.162,0c13.429,0,26.389,1.185,38.84,3.562  c12.478,2.377,24.2,5.718,35.192,10.029c11.006,4.311,21.126,9.404,30.374,15.265C434.79,34.724,442.995,41.119,450.159,48.042z"},arrow_right:{path:"M30.796,226.318h377.533L294.938,339.682c-11.899,11.906-11.899,31.184,0,43.084c11.887,11.899,31.19,11.893,43.077,0  l165.393-165.386c5.725-5.712,8.924-13.453,8.924-21.539c0-8.092-3.213-15.84-8.924-21.551L338.016,8.925  C332.065,2.975,324.278,0,316.478,0c-7.802,0-15.603,2.968-21.539,8.918c-11.899,11.906-11.899,31.184,0,43.084l113.391,113.384  H30.796c-16.822,0-30.463,13.645-30.463,30.463C0.333,212.674,13.974,226.318,30.796,226.318z"},arrow_up:{path:"M295.505,629.446V135.957l148.193,148.206c15.555,15.559,40.753,15.559,56.308,0c15.555-15.538,15.546-40.767,0-56.304  L283.83,11.662C276.372,4.204,266.236,0,255.68,0c-10.568,0-20.705,4.204-28.172,11.662L11.333,227.859  c-7.777,7.777-11.666,17.965-11.666,28.158c0,10.192,3.88,20.385,11.657,28.158c15.563,15.555,40.762,15.555,56.317,0  l148.201-148.219v493.489c0,21.993,17.837,39.82,39.82,39.82C277.669,669.267,295.505,651.439,295.505,629.446z"},arrow_diag:{path:"M279.875,511.994c-1.292,0-2.607-0.102-3.924-0.312c-10.944-1.771-19.333-10.676-20.457-21.71L233.97,278.348  L22.345,256.823c-11.029-1.119-19.928-9.51-21.698-20.461c-1.776-10.944,4.031-21.716,14.145-26.262L477.792,2.149  c9.282-4.163,20.167-2.165,27.355,5.024c7.201,7.189,9.199,18.086,5.024,27.356L302.22,497.527  C298.224,506.426,289.397,511.994,279.875,511.994z M118.277,217.332l140.534,14.294c11.567,1.178,20.718,10.335,21.878,21.896  l14.294,140.519l144.09-320.792L118.277,217.332z"},auto_zoom:{path:"M505.441,242.47l-78.303-78.291c-9.18-9.177-24.048-9.171-33.216,0c-9.169,9.172-9.169,24.045,0.006,33.217l38.193,38.188  H280.088V80.194l38.188,38.199c4.587,4.584,10.596,6.881,16.605,6.881c6.003,0,12.018-2.297,16.605-6.875  c9.174-9.172,9.174-24.039,0.011-33.217L273.219,6.881C268.803,2.471,262.834,0,256.596,0c-6.229,0-12.202,2.471-16.605,6.881  l-78.296,78.302c-9.178,9.172-9.178,24.045,0,33.217c9.177,9.171,24.051,9.171,33.21,0l38.205-38.205v155.4H80.521l38.2-38.188  c9.177-9.171,9.177-24.039,0.005-33.216c-9.171-9.172-24.039-9.178-33.216,0L7.208,242.464c-4.404,4.403-6.881,10.381-6.881,16.611  c0,6.227,2.477,12.207,6.881,16.61l78.302,78.291c4.587,4.581,10.599,6.875,16.605,6.875c6.006,0,12.023-2.294,16.61-6.881  c9.172-9.174,9.172-24.036-0.005-33.211l-38.205-38.199h152.593v152.063l-38.199-38.211c-9.171-9.18-24.039-9.18-33.216-0.022  c-9.178,9.18-9.178,24.059-0.006,33.222l78.284,78.302c4.41,4.404,10.382,6.881,16.611,6.881c6.233,0,12.208-2.477,16.611-6.881  l78.302-78.296c9.181-9.18,9.181-24.048,0-33.205c-9.174-9.174-24.054-9.174-33.21,0l-38.199,38.188v-152.04h152.051l-38.205,38.199  c-9.18,9.175-9.18,24.037-0.005,33.211c4.587,4.587,10.596,6.881,16.604,6.881c6.01,0,12.024-2.294,16.605-6.875l78.303-78.285  c4.403-4.403,6.887-10.378,6.887-16.611C512.328,252.851,509.845,246.873,505.441,242.47z"},statbox:{path:"M28.782,56.902H483.88c15.707,0,28.451-12.74,28.451-28.451C512.331,12.741,499.599,0,483.885,0H28.782   C13.074,0,0.331,12.741,0.331,28.451C0.331,44.162,13.074,56.902,28.782,56.902zM483.885,136.845H28.782c-15.708,0-28.451,12.741-28.451,28.451c0,15.711,12.744,28.451,28.451,28.451H483.88   c15.707,0,28.451-12.74,28.451-28.451C512.331,149.586,499.599,136.845,483.885,136.845zM483.885,273.275H28.782c-15.708,0-28.451,12.731-28.451,28.452c0,15.707,12.744,28.451,28.451,28.451H483.88   c15.707,0,28.451-12.744,28.451-28.451C512.337,286.007,499.599,273.275,483.885,273.275zM256.065,409.704H30.492c-15.708,0-28.451,12.731-28.451,28.451c0,15.707,12.744,28.451,28.451,28.451h225.585   c15.707,0,28.451-12.744,28.451-28.451C284.516,422.436,271.785,409.704,256.065,409.704z"},circle:{path:"M256,256 m-150,0 a150,150 0 1,0 300,0 a150,150 0 1,0 -300,0"},three_circles:{path:"M256,85 m-70,0 a70,70 0 1,0 140,0 a70,70 0 1,0 -140,0  M256,255 m-70,0 a70,70 0 1,0 140,0 a70,70 0 1,0 -140,0  M256,425 m-70,0 a70,70 0 1,0 140,0 a70,70 0 1,0 -140,0 "},diamand:{path:"M256,0L384,256L256,511L128,256z"},rect:{path:"M80,80h352v352h-352z"},cross:{path:"M80,40l176,176l176,-176l40,40l-176,176l176,176l-40,40l-176,-176l-176,176l-40,-40l176,-176l-176,-176z"},vrgoggles:{size:"245.82 141.73",path:"M175.56,111.37c-22.52,0-40.77-18.84-40.77-42.07S153,27.24,175.56,27.24s40.77,18.84,40.77,42.07S198.08,111.37,175.56,111.37ZM26.84,69.31c0-23.23,18.25-42.07,40.77-42.07s40.77,18.84,40.77,42.07-18.26,42.07-40.77,42.07S26.84,92.54,26.84,69.31ZM27.27,0C11.54,0,0,12.34,0,28.58V110.9c0,16.24,11.54,30.83,27.27,30.83H99.57c2.17,0,4.19-1.83,5.4-3.7L116.47,118a8,8,0,0,1,12.52-.18l11.51,20.34c1.2,1.86,3.22,3.61,5.39,3.61h72.29c15.74,0,27.63-14.6,27.63-30.83V28.58C245.82,12.34,233.93,0,218.19,0H27.27Z"},th2colorz:{recs:[{x:128,y:486,w:256,h:26,f:"rgb(38,62,168)"},{y:461,f:"rgb(22,82,205)"},{y:435,f:"rgb(16,100,220)"},{y:410,f:"rgb(18,114,217)"},{y:384,f:"rgb(20,129,214)"},{y:358,f:"rgb(14,143,209)"},{y:333,f:"rgb(9,157,204)"},{y:307,f:"rgb(13,167,195)"},{y:282,f:"rgb(30,175,179)"},{y:256,f:"rgb(46,183,164)"},{y:230,f:"rgb(82,186,146)"},{y:205,f:"rgb(116,189,129)"},{y:179,f:"rgb(149,190,113)"},{y:154,f:"rgb(179,189,101)"},{y:128,f:"rgb(209,187,89)"},{y:102,f:"rgb(226,192,75)"},{y:77,f:"rgb(244,198,59)"},{y:51,f:"rgb(253,210,43)"},{y:26,f:"rgb(251,230,29)"},{y:0,f:"rgb(249,249,15)"}]},th2color:{recs:[{x:0,y:256,w:13,h:39,f:"rgb(38,62,168)"},{x:13,y:371,w:39,h:39},{y:294,h:39},{y:256,h:39},{y:218,h:39},{x:51,y:410,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:90,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294},{y:256,h:39,f:"rgb(16,100,220)"},{y:218,h:39},{y:179,h:39,f:"rgb(22,82,205)"},{y:141,h:39},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:0,h:27},{x:128,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294,f:"rgb(20,129,214)"},{y:256,h:39,f:"rgb(9,157,204)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(20,129,214)"},{y:141,h:39,f:"rgb(16,100,220)"},{y:102,h:39,f:"rgb(22,82,205)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{y:0,h:27},{x:166,y:486,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(82,186,146)"},{y:256,h:39,f:"rgb(179,189,101)"},{y:218,h:39,f:"rgb(116,189,129)"},{y:179,h:39,f:"rgb(82,186,146)"},{y:141,h:39,f:"rgb(14,143,209)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:205,y:486,w:39,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(16,100,220)"},{y:333,h:39,f:"rgb(9,157,204)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(244,198,59)"},{y:218,h:39},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(13,167,195)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(22,82,205)"},{y:26,h:39,f:"rgb(38,62,168)"},{x:243,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(30,175,179)"},{y:294,f:"rgb(209,187,89)"},{y:256,h:39,f:"rgb(251,230,29)"},{y:218,h:39,f:"rgb(249,249,15)"},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(30,175,179)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:282,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(14,143,209)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(226,192,75)"},{y:218,h:39,f:"rgb(244,198,59)"},{y:179,h:39,f:"rgb(149,190,113)"},{y:141,h:39,f:"rgb(9,157,204)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:320,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(46,183,164)"},{y:256,h:39},{y:218,h:39,f:"rgb(82,186,146)"},{y:179,h:39,f:"rgb(9,157,204)"},{y:141,h:39,f:"rgb(20,129,214)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:358,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39},{y:294,f:"rgb(16,100,220)"},{y:256,h:39,f:"rgb(20,129,214)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(18,114,217)"},{y:141,h:39,f:"rgb(22,82,205)"},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:26,h:39},{x:397,y:448,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294,f:"rgb(22,82,205)"},{y:256,h:39},{y:218,h:39},{y:179,h:39,f:"rgb(38,62,168)"},{y:141,h:39},{y:102,h:39},{y:64},{y:26,h:39},{x:435,y:410,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:474,y:256,h:39},{y:179,h:39}]},th2draw3d:{path:"M172.768,0H51.726C23.202,0,0.002,23.194,0.002,51.712v89.918c0,28.512,23.2,51.718,51.724,51.718h121.042   c28.518,0,51.724-23.2,51.724-51.718V51.712C224.486,23.194,201.286,0,172.768,0z M177.512,141.63c0,2.611-2.124,4.745-4.75,4.745   H51.726c-2.626,0-4.751-2.134-4.751-4.745V51.712c0-2.614,2.125-4.739,4.751-4.739h121.042c2.62,0,4.75,2.125,4.75,4.739 L177.512,141.63L177.512,141.63z M460.293,0H339.237c-28.521,0-51.721,23.194-51.721,51.712v89.918c0,28.512,23.2,51.718,51.721,51.718h121.045   c28.521,0,51.721-23.2,51.721-51.718V51.712C512.002,23.194,488.802,0,460.293,0z M465.03,141.63c0,2.611-2.122,4.745-4.748,4.745   H339.237c-2.614,0-4.747-2.128-4.747-4.745V51.712c0-2.614,2.133-4.739,4.747-4.739h121.045c2.626,0,4.748,2.125,4.748,4.739 V141.63z M172.768,256.149H51.726c-28.524,0-51.724,23.205-51.724,51.726v89.915c0,28.504,23.2,51.715,51.724,51.715h121.042   c28.518,0,51.724-23.199,51.724-51.715v-89.915C224.486,279.354,201.286,256.149,172.768,256.149z M177.512,397.784   c0,2.615-2.124,4.736-4.75,4.736H51.726c-2.626-0.006-4.751-2.121-4.751-4.736v-89.909c0-2.626,2.125-4.753,4.751-4.753h121.042 c2.62,0,4.75,2.116,4.75,4.753L177.512,397.784L177.512,397.784z M460.293,256.149H339.237c-28.521,0-51.721,23.199-51.721,51.726v89.915c0,28.504,23.2,51.715,51.721,51.715h121.045   c28.521,0,51.721-23.199,51.721-51.715v-89.915C512.002,279.354,488.802,256.149,460.293,256.149z M465.03,397.784   c0,2.615-2.122,4.736-4.748,4.736H339.237c-2.614,0-4.747-2.121-4.747-4.736v-89.909c0-2.626,2.121-4.753,4.747-4.753h121.045 c2.615,0,4.748,2.116,4.748,4.753V397.784z"},createSVG(t,e,i,n){gv(".jsroot_svg_toolbar_btn { fill: steelblue; cursor: pointer; opacity: 0.3; } .jsroot_svg_toolbar_btn:hover { opacity: 1.0; }",t.node());let r=t.append("svg:svg").attr("class","jsroot_svg_toolbar_btn").attr("width",i+"px").attr("height",i+"px").attr("viewBox","0 0 512 512").style("overflow","hidden");if("recs"in e){let t={};for(let i=0;i<e.recs.length;++i)Object.assign(t,e.recs[i]),r.append("rect").attr("x",t.x).attr("y",t.y).attr("width",t.w).attr("height",t.h).style("fill",t.f)}else r.append("svg:path").attr("d",e.path);return r.append("svg:rect").attr("x",0).attr("y",0).attr("width",512).attr("height",512).style("opacity",0).style("fill","none").style("pointer-events","visibleFill").append("svg:title").text(n),r}};function fv(t,e){if(!t||l()||"undefined"==typeof window)return;let i=null,n=e||300;function r(){if(i=null,document.body.style.cursor="wait","function"==typeof t)t();else if(t&&"object"==typeof t&&"function"==typeof t.checkResize)t.checkResize();else{let e=new hl(t).selectDom();if(!e.empty()){let t=e.property("mdi");t&&"function"==typeof t.checkMDIResize?t.checkMDIResize():Kl(e.node())}}document.body.style.cursor="auto"}n<20&&(n=20),window.addEventListener("resize",(()=>{null!==i&&clearTimeout(i),i=setTimeout(r,n)}))}function mv(t){return"buttons"in t?2===t.buttons:"which"in t?3===t.which:"button"in t&&2===t.button}function pv(t,e){if(void 0===e&&(e=!0),!m.MoveResize||l()||!t.draw_g)return;if(!e){if(t.draw_g.property("assigned_move")){let e=Ki().subject(Object);e.on("start",null).on("drag",null).on("end",null),t.draw_g.style("cursor",null).property("assigned_move",null).call(e)}return}if(t.draw_g.property("assigned_move"))return;let i=Ki().subject(Object),n=!0,r=!1;i.on("start",function(t){if(r=!!this.moveEnabled&&!this.moveEnabled(),r)return;if(mv(t.sourceEvent))return;t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation();let e=qi(t,this.draw_g.node());n=!0,this.moveStart&&this.moveStart(e[0],e[1])}.bind(t)).on("drag",function(t){r||(t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation(),n=!1,this.moveDrag&&this.moveDrag(t.dx,t.dy))}.bind(t)).on("end",function(t){if(r)return;t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation(),this.moveEnd&&this.moveEnd(n);let e=this.getPadPainter();e&&e.selectObjectPainter(this)}.bind(t)),t.draw_g.style("cursor","move").property("assigned_move",!0).call(i)}function gv(t,e){if(l()||!t||"undefined"==typeof document)return!0;let i=(e||document).getElementsByTagName("style");for(let e=0;e<i.length;++e)if(i[e].innerHTML==t)return!0;let n=document.createElement("style");return n.innerHTML=t,(e||document.head).appendChild(n),!0}function _v(t,e){let i=-1,n=Rl();if("string"==typeof t){if(t&&"none"!=t){for(let e=1;e<n.length;++e)if(n[e]==t){i=e;break}}else i=0;i<0&&0==t.indexOf("rgb")&&(i=9999)}else Number.isInteger(t)&&n[t]&&(i=t,t=n[i]);if(i<0)return"";if(i>=50){let e=lt(t);i=`TColor::GetColor(${e.r},${e.g},${e.b})`}return`exec:${e}(${i})`}class xv{constructor(t,e,i){this.painter=t,this.menuname=e,i&&"object"==typeof i&&void 0!==i.clientX&&void 0!==i.clientY&&(this.show_evnt={clientX:i.clientX,clientY:i.clientY}),this.remove_handler=()=>this.remove(),this.element=null,this.cnt=0}load(){return Promise.resolve(this)}getEventPosition(){return this.show_evnt}add(){throw Error("add() method has to be implemented in the menu")}size(){return this.cnt}remove(){null!==this.element&&(this.element.remove(),this.resolveFunc&&(this.resolveFunc(),delete this.resolveFunc),document.body.removeEventListener("click",this.remove_handler)),this.element=null}show(){throw Error("show() method has to be implemented in the menu class")}addchk(t,e,i,n){let r=n;"function"==typeof i&&(n=i,r=t=>n("1"==t),i=t?"0":"1"),this.add((t?"chk:":"unk:")+e,i,r)}addDrawMenu(t,e,i){if(!e||!e.length)return;let n=!1;if(0==t.indexOf("nosub:")&&(n=!0,t=t.slice(6)),1===e.length)return"inspect"===e[0]&&(t=t.replace("Draw","Inspect")),void this.add(t,e[0],i);n||this.add("sub:"+t,e[0],i);for(let r=0;r<e.length;++r){let s=e[r];""==s&&(s=this._use_plain_text?"<dflt>":"&lt;dflt&gt;");let a=r+1;if(e.length>5&&s.length>0)for(;a<e.length&&0==e[a].indexOf(s);)a++;if(n&&(s=t+" "+s),a<r+2)this.add(s,e[r],i);else{this.add("sub:"+s,e[r],i);for(let t=r+1;t<a;++t)this.add(e[t],e[t],i);this.add("endsub:"),r=a-1}}n||this.add("endsub:")}addColorMenu(t,e,i,n){if(void 0===e)return;let r="string"!=typeof e;this.add("sub:"+t,(()=>{this.input("Enter color "+(r?"(only id number)":"(name or id)"),e,r?"int":"text",r?0:void 0,r?9999:void 0).then((t=>{let e=parseInt(t);if(Number.isInteger(e)&&Fl(e))t=Fl(e);else if(r)return;i(r?e:t)}))}));for(let t=-1;t<11;++t){if(t<0&&r)continue;if(10==t&&1!==n)continue;let s=t<0?"none":Fl(t);0==t&&1==n&&(s="none");let a="<svg width='100' height='18' style='margin:0px;background-color:"+s+"'><text x='4' y='12' style='font-size:12px' fill='"+(1==t?"white":"black")+"'>"+s+"</text></svg>";this.addchk(e==(r?t:s),a,r?t:s,(t=>i(r?parseInt(t):t)))}this.add("endsub:")}addSizeMenu(t,e,i,n,r,s){if(void 0!==r){this.add("sub:"+t,(()=>{let e=r.toFixed(4);n>=.1&&(e=r.toFixed(2)),n>=1&&(e=r.toFixed(0)),this.input("Enter value of "+t,e,n>=1?"int":"float").then(s)}));for(let t=e;t<=i;t+=n){let e=t.toFixed(2);n>=.1&&(e=t.toFixed(1)),n>=1&&(e=t.toFixed(0)),this.addchk(Math.abs(r-t)<n/2,e,t,(t=>s(n>=1?parseInt(t):parseFloat(t))))}this.add("endsub:")}}addPaletteMenu(t,e){const i=(i,n,r)=>this.addchk(i===t||r,"<nobr>"+n+"</nobr>",i,e);this.add("sub:Palette",(()=>this.input("Enter palette code [1..113]",t,"int",1,113).then(e))),i(50,"ROOT 5",t>=10&&t<51),i(51,"Deep Sea"),i(52,"Grayscale",t>0&&t<10),i(53,"Dark body radiator"),i(54,"Two-color hue"),i(55,"Rainbow"),i(56,"Inverted dark body radiator"),i(57,"Bird",t>113),i(58,"Cubehelix"),i(59,"Green Red Violet"),i(60,"Blue Red Yellow"),i(61,"Ocean"),i(62,"Color Printable On Grey"),i(63,"Alpine"),i(64,"Aquamarine"),i(65,"Army"),i(66,"Atlantic"),this.add("endsub:")}addRebinMenu(t){this.add("sub:Rebin",(()=>{this.input("Enter rebin value",2,"int",2).then(t)}));for(let e=2;e<=7;e++)this.add(e.toString(),e,(e=>t(parseInt(e))));this.add("endsub:")}addSelectMenu(t,e,i,n){let r="number"==typeof i;this.add("sub:"+t);for(let t=0;t<e.length;++t)this.addchk(r?t==i:e[t]==i,e[t],r?t:e[t],(t=>n(r?Number.parseInt(t):t)));this.add("endsub:")}addRColorMenu(t,e,i){let n=["default","black","white","red","green","blue","yellow","magenta","cyan"];this.add("sub:"+t,(()=>{this.input("Enter color name - empty string will reset color",e).then(i)}));let r="black";for(let t=0;t<n.length;++t){let s=n[t],a=!1,o="";t>0?(o="background-color:"+s,r="white"==s?"black":"white","string"==typeof e&&e&&"auto"!=e&&"["!=e[0]&&(a=ut(e).toString()==ut(s).toString())):a=!e;let l=`<svg width='100' height='18' style='margin:0px;${o}'><text x='4' y='12' style='font-size:12px' fill='${r}'>${s}</text></svg>`;this.addchk(a,l,s,(t=>i("default"==t?null:t)))}this.add("endsub:")}addRAttrTextItems(t,e,i){e||(e={}),this.addRColorMenu("color",t.color,(t=>i({name:"color",value:t}))),t.scaled?this.addSizeMenu("size",.01,.1,.01,t.size/t.scale,(t=>i({name:"size",value:t}))):this.addSizeMenu("size",6,20,2,t.size,(t=>i({name:"size",value:t}))),this.addSelectMenu("family",["Arial","Times New Roman","Courier New","Symbol"],t.name,(t=>i({name:"font_family",value:t}))),this.addSelectMenu("style",["normal","italic","oblique"],t.style||"normal",(t=>i({name:"font_style",value:"normal"==t?null:t}))),this.addSelectMenu("weight",["normal","lighter","bold","bolder"],t.weight||"normal",(t=>i({name:"font_weight",value:"normal"==t?null:t}))),e.noalign||this.add("align"),e.noangle||this.add("angle")}addTextAttributesMenu(t,e){let i=t.getObject();if(!i||!("fTextColor"in i))return;this.add("sub:"+(e||"Text")),this.addColorMenu("color",i.fTextColor,(e=>{i.fTextColor=e,t.interactiveRedraw(!0,_v(e,"SetTextColor"))}));let n=[11,12,13,21,22,23,31,32,33];this.add("sub:align");for(let e=0;e<n.length;++e)this.addchk(n[e]==i.fTextAlign,n[e],n[e],function(t){this.getObject().fTextAlign=parseInt(t),this.interactiveRedraw(!0,"exec:SetTextAlign("+t+")")}.bind(t));this.add("endsub:"),this.add("sub:font");for(let e=1;e<16;++e)this.addchk(e==Math.floor(i.fTextFont/10),e,e,function(t){this.getObject().fTextFont=10*parseInt(t)+2,this.interactiveRedraw(!0,"exec:SetTextFont("+this.getObject().fTextFont+")")}.bind(t));this.add("endsub:"),this.add("endsub:")}addAttributesMenu(t,e){if(e||(e=""),t.lineatt&&t.lineatt.used){this.add("sub:"+e+"Line att"),this.addSizeMenu("width",1,10,1,t.lineatt.width,(e=>{t.lineatt.change(void 0,e),t.interactiveRedraw(!0,`exec:SetLineWidth(${e})`)})),this.addColorMenu("color",t.lineatt.color,(e=>{t.lineatt.change(e),t.interactiveRedraw(!0,_v(e,"SetLineColor"))})),this.add("sub:style",(()=>{this.input("Enter line style id (1-solid)",t.lineatt.style,"int",1,11).then((e=>{Xl(e)&&(t.lineatt.change(void 0,void 0,e),t.interactiveRedraw(!0,`exec:SetLineStyle(${e})`))}))}));for(let e=1;e<11;++e){let i="<svg width='100' height='18'><text x='1' y='12' style='font-size:12px'>"+e+"</text><line x1='30' y1='8' x2='100' y2='8' stroke='black' stroke-width='3' stroke-dasharray='"+Xl(e)+"'></line></svg>";this.addchk(t.lineatt.style==e,i,e,(e=>{t.lineatt.change(void 0,void 0,parseInt(e)),t.interactiveRedraw(!0,`exec:SetLineStyle(${e})`)}))}if(this.add("endsub:"),this.add("endsub:"),"excl_side"in t.lineatt&&0!==t.lineatt.excl_side){this.add("sub:Exclusion"),this.add("sub:side");for(let e=-1;e<=1;++e)this.addchk(t.lineatt.excl_side==e,e,e,function(t){this.lineatt.changeExcl(parseInt(t)),this.interactiveRedraw()}.bind(t));this.add("endsub:"),this.addSizeMenu("width",10,100,10,t.lineatt.excl_width,(e=>{t.lineatt.changeExcl(void 0,e),t.interactiveRedraw()})),this.add("endsub:")}}if(t.fillatt&&t.fillatt.used){this.add("sub:"+e+"Fill att"),this.addColorMenu("color",t.fillatt.colorindx,(e=>{t.fillatt.change(e,void 0,t.getCanvSvg()),t.interactiveRedraw(!0,_v(e,"SetFillColor"))}),t.fillatt.kind),this.add("sub:style",(()=>{this.input("Enter fill style id (1001-solid, 3000..3010)",t.fillatt.pattern,"int",0,4e3).then((e=>{e<0||e>4e3||(t.fillatt.change(void 0,e,t.getCanvSvg()),t.interactiveRedraw(!0,"exec:SetFillStyle("+e+")"))}))}));let i=[1,1001,3001,3002,3003,3004,3005,3006,3007,3010,3021,3022];for(let e=0;e<i.length;++e){let n=t.createAttFill({std:!1,pattern:i[e],color:t.fillatt.colorindx||1}),r="<svg width='100' height='18'><text x='1' y='12' style='font-size:12px'>"+i[e].toString()+"</text><rect x='40' y='0' width='60' height='18' stroke='none' fill='"+n.getFillColor()+"'></rect></svg>";this.addchk(t.fillatt.pattern==i[e],r,i[e],(e=>{t.fillatt.change(void 0,parseInt(e),t.getCanvSvg()),t.interactiveRedraw(!0,`exec:SetFillStyle(${e})`)}))}this.add("endsub:"),this.add("endsub:")}if(t.markeratt&&t.markeratt.used){this.add("sub:"+e+"Marker att"),this.addColorMenu("color",t.markeratt.color,(e=>{t.markeratt.change(e),t.interactiveRedraw(!0,_v(e,"SetMarkerColor"))})),this.addSizeMenu("size",.5,6,.5,t.markeratt.size,(e=>{t.markeratt.change(void 0,void 0,e),t.interactiveRedraw(!0,`exec:SetMarkerSize(${e})`)})),this.add("sub:style");let i=[1,2,3,4,5,6,7,8,21,22,23,24,25,26,27,28,29,30,31,32,33,34];for(let e=0;e<i.length;++e){let n=new ql({style:i[e],color:t.markeratt.color,size:1.7}),r="<svg width='60' height='18'><text x='1' y='12' style='font-size:12px'>"+i[e].toString()+"</text><path stroke='black' fill='"+(n.fill?"black":"none")+"' d='"+n.create(40,8)+"'></path></svg>";this.addchk(t.markeratt.style==i[e],r,i[e],function(t){this.markeratt.change(void 0,parseInt(t)),this.interactiveRedraw(!0,"exec:SetMarkerStyle("+t+")")}.bind(t))}this.add("endsub:"),this.add("endsub:")}}addTAxisMenu(t,e,i,n){this.add("Divisions",(()=>this.input("Set Ndivisions",i.fNdivisions,"int",0).then((t=>{i.fNdivisions=t,e.interactiveRedraw("pad",`exec:SetNdivisions(${t})`,n)})))),this.add("sub:Labels"),this.addchk(i.TestBit(t.kCenterLabels),"Center",(r=>{i.InvertBit(t.kCenterLabels),e.interactiveRedraw("pad",`exec:CenterLabels(${r})`,n)})),this.addchk(i.TestBit(t.kLabelsVert),"Rotate",(r=>{i.InvertBit(t.kLabelsVert),e.interactiveRedraw("pad",`exec:SetBit(TAxis::kLabelsVert,${r})`,n)})),this.addColorMenu("Color",i.fLabelColor,(t=>{i.fLabelColor=t,e.interactiveRedraw("pad",_v(t,"SetLabelColor"),n)})),this.addSizeMenu("Offset",0,.1,.01,i.fLabelOffset,(t=>{i.fLabelOffset=t,e.interactiveRedraw("pad",`exec:SetLabelOffset(${t})`,n)})),this.addSizeMenu("Size",.02,.11,.01,i.fLabelSize,(t=>{i.fLabelSize=t,e.interactiveRedraw("pad",`exec:SetLabelSize(${t})`,n)})),this.add("endsub:"),this.add("sub:Title"),this.add("SetTitle",(()=>{this.input("Enter axis title",i.fTitle).then((t=>{i.fTitle=t,e.interactiveRedraw("pad",`exec:SetTitle("${t}")`,n)}))})),this.addchk(i.TestBit(t.kCenterTitle),"Center",(r=>{i.InvertBit(t.kCenterTitle),e.interactiveRedraw("pad",`exec:CenterTitle(${r})`,n)})),this.addchk(i.TestBit(t.kOppositeTitle),"Opposite",(()=>{i.InvertBit(t.kOppositeTitle),e.redrawPad()})),this.addchk(i.TestBit(t.kRotateTitle),"Rotate",(r=>{i.InvertBit(t.kRotateTitle),e.interactiveRedraw("pad",`exec:RotateTitle(${r})`,n)})),this.addColorMenu("Color",i.fTitleColor,(t=>{i.fTitleColor=t,e.interactiveRedraw("pad",_v(t,"SetTitleColor"),n)})),this.addSizeMenu("Offset",0,3,.2,i.fTitleOffset,(t=>{i.fTitleOffset=t,e.interactiveRedraw("pad",`exec:SetTitleOffset(${t})`,n)})),this.addSizeMenu("Size",.02,.11,.01,i.fTitleSize,(t=>{i.fTitleSize=t,e.interactiveRedraw("pad",`exec:SetTitleSize(${t})`,n)})),this.add("endsub:"),this.add("sub:Ticks"),"TGaxis"==i._typename?(this.addColorMenu("Color",i.fLineColor,(t=>{i.fLineColor=t,e.interactiveRedraw("pad")})),this.addSizeMenu("Size",-.05,.055,.01,i.fTickSize,(t=>{i.fTickSize=t,e.interactiveRedraw("pad")}))):(this.addColorMenu("Color",i.fAxisColor,(t=>{i.fAxisColor=t,e.interactiveRedraw("pad",_v(t,"SetAxisColor"),n)})),this.addSizeMenu("Size",-.05,.055,.01,i.fTickLength,(t=>{i.fTickLength=t,e.interactiveRedraw("pad",`exec:SetTickLength(${t})`,n)}))),this.add("endsub:")}runModal(){throw Error("runModal() must be reimplemented")}info(t,e){return this.runModal(t,`<p>${e}</p>`,{height:120,width:400,resizable:!0})}confirm(t,e){return this.runModal(t,e,{btns:!0,height:120,width:400}).then((t=>!!t))}input(t,e,i,n,r){i||(i="text");let s="";null==e&&(e=""),"int"==i&&(void 0!==n&&(s+=` min="${n}"`),void 0!==r&&(s+=` max="${r}"`));let a=`<form><fieldset style="padding:0; border:0"><input type="${"int"==i?"number":"text"}" value="${e}" ${s} style="width:98%;display:block" class="jsroot_dlginp"/></fieldset></form>`;return new Promise((e=>{this.runModal(t,a,{btns:!0,height:150,width:400}).then((t=>{if(!t)return;let n=t.querySelector(".jsroot_dlginp").value;"float"==i?(n=parseFloat(n),Number.isFinite(n)&&e(n)):"int"==i?(n=parseInt(n),Number.isInteger(n)&&e(n)):e(n)}))}))}showMethodArgsDialog(t){let e=this.menuname+"_dialog",i='<form> <fieldset style="padding:0; border:0">';for(let n=0;n<t.fArgs.length;++n){let r=t.fArgs[n];r.fValue=r.fDefault,'""'==r.fValue&&(r.fValue=""),i+=`<label for="${e}_inp${n}">${r.fName}</label>\n                          <input type="text" tabindex="${n+1}" id="${e}_inp${n}" value="${r.fValue}" style="width:100%;display:block"/>`}return i+="</fieldset></form>",new Promise((n=>{this.runModal(t.fClassName+"::"+t.fName,i,{btns:!0,height:100+60*t.fArgs.length,width:400,resizable:!0}).then((i=>{if(!i)return;let r="";for(let n=0;n<t.fArgs.length;++n){let s=t.fArgs[n],a=i.querySelector(`#${e}_inp${n}`).value;""===a&&(a=s.fDefault),"Option_t*"!=s.fTitle&&"const char*"!=s.fTitle||(a||(a='""'),'"'!=a[0]&&(a='"'+a),'"'!=a[a.length-1]&&(a+='"')),r+=(n>0?",":"")+a}n(r)}))}))}showCommandArgsDialog(t,e){let i=this.menuname+"_dialog",n='<form> <fieldset style="padding:0; border:0">';for(let t=0;t<e.length;++t)n+=`<label for="${i}_inp${t}">arg${t+1}</label>\n                          <input type="text" id="${i}_inp${t}" value="${e[t]}" style="width:100%;display:block"/>`;return n+="</fieldset></form>",new Promise((r=>{this.runModal("Arguments for command "+t,n,{btns:!0,height:110+60*e.length,width:400,resizable:!0}).then((t=>{if(!t)return r(null);let n=[];for(let r=0;r<e.length;++r)n.push(t.querySelector(`#${i}_inp${r}`).value);r(n)}))}))}}class yv extends xv{constructor(t,e,i){super(t,e,i),this.code=[],this._use_plain_text=!0,this.stack=[this.code]}load(){return Promise.resolve(this)}add(t,e,i,n){let r=this.stack[this.stack.length-1];if("separator"==t)return r.push({divider:!0});if(0==t.indexOf("header:"))return r.push({text:t.slice(7),header:!0});if("endsub:"==t)return this.stack.pop();"function"==typeof e&&(n=i,i=e,e=t);let s={};r.push(s),0==t.indexOf("sub:")&&(t=t.slice(4),s.sub=[],this.stack.push(s.sub)),0==t.indexOf("chk:")?(s.checked=!0,t=t.slice(4)):0==t.indexOf("unk:")&&(s.checked=!1,t=t.slice(4)),s.text=t,s.title=n,s.arg=e,s.func=i}size(){return this.code.length}_buildContextmenu(t,e,i,n){let r=document.createElement("div");if(r.className="jsroot_ctxt_container",n===document.body){let t=document.getElementsByClassName("jsroot_ctxt_container");for(;t.length>0;)t[0].parentNode.removeChild(t[0]);r.style.position="fixed",r.style.left=e+"px",r.style.top=i+"px"}else r.style.left=-n.offsetLeft+n.offsetWidth+"px";let s=!1;t.forEach((t=>{void 0!==t.checked&&(s=!0)})),t.forEach((t=>{if(t.divider){let t=document.createElement("hr");return t.className="jsroot_ctxt_divider",void r.appendChild(t)}let e=document.createElement("div");if(e.style.position="relative",r.appendChild(e),t.header)return e.className="jsroot_ctxt_header",void(e.innerHTML=t.text);let i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.className="jsroot_ctxt_item",i.style.display="flex",i.style.justifyContent="space-between",i.style.cursor="pointer",t.title&&i.setAttribute("title",t.title),e.appendChild(i),t.text||(t.text="item");let n=document.createElement("div");if(n.className="jsroot_ctxt_text",t.text.indexOf("<svg")>=0)n.innerHTML=t.text;else{if(s){let e=document.createElement("span");e.innerHTML=t.checked?"✓":"",e.style.display="inline-block",e.style.width="1em",n.appendChild(e)}let e=document.createElement("span");0==t.text.indexOf("<nobr>")?e.textContent=t.text.slice(6,t.text.length-7):e.textContent=t.text,n.appendChild(e)}if(i.appendChild(n),t.hasOwnProperty("extraText")||t.sub){let e=document.createElement("span");e.className="jsroot_ctxt_extraText jsroot_ctxt_text",e.textContent=t.sub?"▶":t.extraText,i.appendChild(e)}i.addEventListener("mouseenter",(()=>{r.childNodes.forEach((t=>{t.classList.contains("jsroot_ctxt_focus")&&(t.removeChild(t.getElementsByClassName("jsroot_ctxt_container")[0]),t.classList.remove("jsroot_ctxt_focus"))}))})),t.sub&&i.addEventListener("mouseenter",(()=>{e.classList.add("jsroot_ctxt_focus"),this._buildContextmenu(t.sub,0,0,e)})),t.func&&e.addEventListener("click",(e=>{(this.painter?t.func.bind(this.painter):t.func)(t.arg),e.stopPropagation(),this.remove()}))})),n.appendChild(r);let a=document.documentElement.clientWidth,o=document.documentElement.clientHeight;if(n===document.body)e+r.offsetWidth>a&&(r.style.left=a-r.offsetWidth+"px"),r.offsetHeight>o?(r.style.top=0,r.style.overflowY="scroll",r.style.overflowX="hidden",r.style.height=o+"px"):i+r.offsetHeight>o&&(r.style.top=o-r.offsetHeight+"px");else{let t=n.getBoundingClientRect(),e=r.getBoundingClientRect();e.left+e.width>a&&(r.style.left=-n.offsetLeft-e.width+"px"),e.height>o?(r.style.top=-e.top+"px",r.style.overflowY="scroll",r.style.overflowX="hidden",r.style.height=o+"px"):e.height<o&&e.height>o/2?e.top-o/2>=0?r.style.top=-e.top-e.height+o+"px":r.style.top=-e.top+"px":e.top+e.height>o&&(r.style.top=-e.height+t.height+"px")}return r}show(t){this.remove(),!t&&this.show_evnt&&(t=this.show_evnt),document.body.addEventListener("click",this.remove_handler);let e=document.getElementById(this.menuname);return e&&e.remove(),this.element=this._buildContextmenu(this.code,t.clientX+window.pageXOffset,t.clientY+window.pageYOffset,document.body),gv("\n.jsroot_ctxt_container {\n   position: absolute;\n   top: 0;\n   user-select: none;\n   z-index: 100000;\n   background-color: rgb(250, 250, 250);\n   margin: 0;\n   padding: 0px;\n   width: auto;\n   min-width: 100px;\n   box-shadow: 0px 0px 10px rgb(0, 0, 0, 0.2);\n   border: 3px solid rgb(215, 215, 215);\n   font-family: Arial, helvetica, sans-serif, serif;\n   font-size: 13px;\n   color: rgb(0, 0, 0, 0.8);\n}\n\n.jsroot_ctxt_divider {\n   width: 85%;\n   margin: 3px auto;\n   border: 1px solid rgb(0, 0, 0, 0.15);\n}\n\n.jsroot_ctxt_header {\n   background-color: lightblue;\n   padding: 3px 7px;\n   font-weight: bold;\n   border-bottom: 1px;\n}\n\n.jsroot_ctxt_text {\n   margin: 0;\n   padding: 3px 7px;\n   pointer-events: none;\n   white-space: nowrap;\n}\n\n.jsroot_ctxt_extraText {\n   margin: 0;\n   padding: 3px 7px;\n   color: rgb(0, 0, 0, 0.6);\n}\n\n.jsroot_ctxt_focus {\n   background-color: rgb(220, 220, 220);\n}\n\n.jsroot_ctxt_item:hover {\n   background-color: rgb(235, 235, 235);\n}",this.element),this.element.setAttribute("id",this.menuname),Promise.resolve(this)}runModal(t,e,i){i||(i={});let n=this.menuname+"_dialog";Ii("#"+n).remove(),Ii("#"+n+"_block").remove();let r=Ii("body").append("div").attr("id",n+"_block").attr("class","jsroot_dialog_block"),s=Ii("body").append("div").attr("id",n).attr("class","jsroot_dialog").style("width",(i.width||450)+"px").attr("tabindex","0").html(`<div class="jsroot_dialog_body">\n            <div class="jsroot_dialog_header">${t}</div>\n            <div class="jsroot_dialog_content">${e}</div>\n            <div class="jsroot_dialog_footer">\n               <button class="jsroot_dialog_button">Ok</button>\n               ${i.btns?'<button class="jsroot_dialog_button">Cancel</button>':""}\n           </div>\n          </div>`);return gv("\n.jsroot_dialog_block {\n   z-index: 100000;\n   position: absolute;\n   top: 0;\n   left: 0;\n   right: 0;\n   bottom: 0;\n   opacity: 0.2;\n   background-color: white;\n}\n\n.jsroot_dialog {\n   z-index: 100001;\n   position: absolute;\n   left: 50%;\n   top: 50%;\n}\n\n.jsroot_dialog_body {\n   position: relative;\n   left: -50%;\n   top: -50%;\n   border: solid green 3px;\n   padding: 5px;\n   display: flex;\n   flex-flow: column;\n   background-color: white;\n}\n\n.jsroot_dialog_header {\n   flex: 0 1 auto;\n   padding: 5px;\n}\n\n.jsroot_dialog_content {\n   flex: 1 1 auto;\n   padding: 5px;\n}\n\n.jsroot_dialog_footer {\n   flex: 0 1 auto;\n   padding: 5px;\n}\n\n.jsroot_dialog_button {\n   float: right;\n   margin-right: 1em;\n}",s.node()),new Promise((t=>{s.on("keyup",(e=>{13!=e.keyCode&&27!=e.keyCode||(e.preventDefault(),e.stopPropagation(),t(13==e.keyCode?s.node():null),s.remove(),r.remove())})),s.on("keydown",(t=>{13!=t.keyCode&&27!=t.keyCode||(t.preventDefault(),t.stopPropagation())})),s.selectAll(".jsroot_dialog_button").on("click",(e=>{t(i.btns&&"Ok"==Ii(e.target).text()?s.node():null),s.remove(),r.remove()}));let e=s.select(".jsroot_dialog_content").select("input");e.empty()&&(e=s.select(".jsroot_dialog_footer").select("button")),e.empty()||e.node().focus()}))}}class Av extends xv{constructor(t,e,i){super(t,e,i),this.code="",this.funcs={},this.lvl=0}loadBS(e){let i="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/";return(s.bs_path?Promise.resolve(!0):x(t.source_dir+"style/bootstrap.min.css").then((()=>{s.bs_path=t.source_dir+"scripts/"})).catch((()=>(s.bs_path=i+"js/",x(i+"css/bootstrap.min.css"))))).then((()=>!e||"undefined"!=typeof bootstrap||x(s.bs_path+"bootstrap.bundle.min.js")))}load(){return this.loadBS().then((()=>this))}add(t,e,i,n){if("separator"==t)return void(this.code+='<hr class="dropdown-divider">');if(0==t.indexOf("header:"))return void(this.code+=`<h6 class="dropdown-header">${t.slice(7)}</h6>`);let r=!1,s="",a="dropdown-item btn-sm",o="";if("endsub:"==t)return this.lvl--,this.code+="</li>",void(this.code+="</ul>");0==t.indexOf("sub:")&&(t=t.slice(4),r=!0),"function"==typeof e&&(i=e,e=t),0==t.indexOf("chk:")?(o="✓",t=t.slice(4)):0==t.indexOf("unk:")&&(t=t.slice(4)),n&&(s+=` title="${n}"`),void 0!==e&&(s+=` arg="${e}"`),r&&(s+=' data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"',a+=" dropdown-toggle");let l=`<button id="${this.menuname}${this.cnt}" ${s} class="${a}" type="button"><span style="width:1em;display:inline-block">${o}</span>${t}</button>`;l=r?'<li class="dropend">'+l:"<li>"+l+"</li>",this.code+=l,r&&(this.code+=`<ul class="dropdown-menu" aria-labelledby="${this.menuname}${this.cnt}">`,this.lvl++),"function"==typeof i&&(this.funcs[this.cnt]=i),this.cnt++}show(t){this.remove(),!t&&this.show_evnt&&(t=this.show_evnt),document.body.addEventListener("click",this.remove_handler);let e=document.getElementById(this.menuname);return e&&e.parentNode.removeChild(e),this.loadBS().then((()=>{let e=window.innerWidth,i=window.innerHeight;this.element=document.createElement("div"),this.element.id=this.menuname,this.element.setAttribute("class","dropdown"),this.element.innerHTML=`<ul class="dropdown-menu dropend" style="display:block">${this.code}</ul>`,document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.background="white",this.element.style.display="block",this.element.style.left=t.clientX+window.pageXOffset+"px",this.element.style.top=t.clientY+window.pageYOffset+"px";let n=this,r=this.element.getElementsByClassName("dropdown-item");for(let t=0;t<r.length;t++)r[t].addEventListener("click",(function(){let t=this.getAttribute("arg"),e=this.getAttribute("id").slice(n.menuname.length),i=e?n.funcs[e]:null;n.remove(),"function"==typeof i&&(n.painter?i.bind(n.painter)(t):i(t))}));let s=this.element.getElementsByClassName("dropdown-toggle");for(let t=0;t<s.length;t++)s[t].addEventListener("mouseenter",(function(){let t=this.nextElementSibling;t.style.display="block"==t.style.display?"none":"block",t.style.left=this.scrollWidth+"px";let n=t.getBoundingClientRect();n.bottom>i&&(t.style.top=i-n.bottom-5+"px"),n.right>e&&(t.style.left=-n.width+"px")})),s[t].addEventListener("mouseleave",(function(){let t=this.nextElementSibling;t.was_entered=!1,setTimeout((function(){t.was_entered||(t.style.display="none")}),200)}));let a=this.element.getElementsByClassName("dropdown-menu");for(let t=0;t<a.length;t++)a[t].addEventListener("mouseenter",(function(){this.was_entered=!0}));let o=null,l=null,h=this.element.firstChild.getBoundingClientRect();return t.clientX+h.width>e&&(o=e-h.width-10),t.clientY+h.height>i&&(l=i-h.height-10),null!==o&&(this.element.style.left=(o>0?o:0)+window.pageXOffset+"px"),null!==l&&(this.element.style.top=(l>0?l:0)+window.pageYOffset+"px"),new Promise((t=>{this.resolveFunc=t}))}))}runModal(t,e,i){i||(i={});let n=this.menuname+"_dialog",r=document.getElementById(n);return r&&r.remove(),this.loadBS(!0).then((()=>{let r=document.createElement("div");r.setAttribute("id",n),r.setAttribute("class","modal fade"),r.setAttribute("role","dialog"),r.setAttribute("tabindex","-1"),r.setAttribute("aria-hidden","true");let s=i.btns?'<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>':"";return r.innerHTML=`<div class="modal-dialog">\n              <div class="modal-content">\n               <div class="modal-header">\n                <h5 class="modal-title">${t}</h5>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n               </div>\n               <div class="modal-body">\n                  ${e}\n               </div>\n               <div class="modal-footer">\n                  ${s}\n                  <button type="button" class="btn btn-primary jsroot_okbtn" data-bs-dismiss="modal">Ok</button>\n               </div>\n              </div>\n             </div>`,document.body.appendChild(r),new bootstrap.Modal(r,{keyboard:!0,backdrop:"static"}).show(),new Promise((t=>{let e=!1;r.querySelector(".jsroot_okbtn").addEventListener("click",(()=>{e=!0})),r.addEventListener("hidden.bs.modal",(()=>{e&&t(r),r.remove()}))}))}))}}function vv(t,e,i){return(m.Bootstrap?new Av(e,i||"root_ctx_menu",t):new yv(e,i||"root_ctx_menu",t)).load()}function bv(t){let e=document.getElementById(t||"root_ctx_menu");return!!e&&(e.parentNode.removeChild(e),!0)}function wv(t,e){if(!t)return;let i=t.getFramePainter();i&&"function"==typeof i.setTooltipEnabled&&(i.setTooltipEnabled(e),i.processFrameTooltipEvent(null)),t.control&&"function"==typeof t.control.setTooltipEnabled&&t.control.setTooltipEnabled(e)}function Mv(t,e){if(!m.MoveResize||l())return;let i=t,n=null,r=i.getPadPainter();if(r&&r._fast_drawing)return;function s(t,i){function n(e,n){let r="js_"+e.replace(/[-]/g,"_"),s=t.select("."+r);s.empty()&&(s=t.append("path").classed(r,!0)),s.style("opacity",0).style("cursor",e).attr("d",n),i&&s.call(i)}n("nw-resize","M2,2h15v-5h-20v20h5Z"),n("ne-resize",`M${e.width-2},2h-15v-5h20v20h-5 Z`),n("sw-resize",`M2,${e.height-2}h15v5h-20v-20h5Z`),n("se-resize",`M${e.width-2},${e.height-2}h-15v5h20v-20h-5Z`),e.no_change_x||(n("w-resize",`M-3,18h5v${Math.max(0,e.height-36)}h-5Z`),n("e-resize",`M${e.width+3},18h-5v${Math.max(0,e.height-36)}h5Z`)),e.no_change_y||(n("n-resize",`M18,-3v5h${Math.max(0,e.width-36)}v-5Z`),n("s-resize",`M18,${e.height+3}v-5h${Math.max(0,e.width-36)}v5Z`))}const a=(t,a,o,l)=>{if(n.style("cursor","auto"),!i.draw_g)return n.remove(),n=null,!1;let h=e.x,c=e.y;e.minwidth&&o<e.minwidth&&(o=e.minwidth),e.minheight&&l<e.minheight&&(l=e.minheight);let d=o!==e.width||l!==e.height,u=t!==h||a!==c;if(e.x=t,e.y=a,e.width=o,e.height=l,i.draw_g.attr("transform",`translate(${t},${a})`),n.remove(),n=null,wv(i,!0),s(i.draw_g),(d||u)&&(d&&"resize"in e&&e.resize(o,l),u&&"move"in e&&e.move(t,a,t-oldxx,a-c),d||u)){if("obj"in e){let i=r.getPadRect();e.obj.fX1NDC=t/i.width,e.obj.fX2NDC=(t+o)/i.width,e.obj.fY1NDC=1-(a+l)/i.height,e.obj.fY2NDC=1-a/i.height,e.obj.modified_NDC=!0}"redraw"in e&&e.redraw(e)}return d||u};let o=Ki().subject(Object);o.on("start",(function(t){if(mv(t.sourceEvent))return;bv(),wv(i,!1),t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation();let s=r.getPadRect(),a={x:e.x,y:e.y,width:e.width,height:e.height,acc_x1:e.x,acc_y1:e.y,pad_w:s.width-e.width,pad_h:s.height-e.height,drag_tm:new Date,path:`v${e.height}h${e.width}v${-e.height}z`};n=Ii(i.draw_g.node().parentNode).append("path").classed("zoom",!0).attr("d",`M${a.acc_x1},${a.acc_y1}${a.path}`).style("cursor","move").style("pointer-events","none").property("drag_handle",a)})).on("drag",(function(t){if(!n)return;t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation();let i=n.property("drag_handle");e.no_change_x||(i.acc_x1+=t.dx),e.no_change_y||(i.acc_y1+=t.dy),i.x=Math.min(Math.max(i.acc_x1,0),i.pad_w),i.y=Math.min(Math.max(i.acc_y1,0),i.pad_h),n.attr("d",`M${i.x},${i.y}${i.path}`)})).on("end",(function(t){if(!n)return;t.sourceEvent.preventDefault();let r=n.property("drag_handle");if(!1===a(r.x,r.y,e.width,e.height)){let t=(new Date).getTime()-r.drag_tm.getTime();if(e.ctxmenu&&t>600&&i.showContextMenu){let t=resize_se.node().getBoundingClientRect();i.showContextMenu("main",{clientX:t.left,clientY:t.top})}else if(e.canselect&&t<=600){let t=i.getPadPainter();t&&t.selectObjectPainter(i)}}}));let h=Ki().subject(Object);h.on("start",(function(t){if(mv(t.sourceEvent))return;t.sourceEvent.stopPropagation(),t.sourceEvent.preventDefault(),wv(i,!1);let s=r.getPadRect(),a={x:e.x,y:e.y,width:e.width,height:e.height,acc_x1:e.x,acc_y1:e.y,pad_w:s.width,pad_h:s.height};a.acc_x2=a.acc_x1+e.width,a.acc_y2=a.acc_y1+e.height,n=Ii(i.draw_g.node().parentNode).append("rect").classed("zoom",!0).style("cursor",Ii(this).style("cursor")).attr("x",a.acc_x1).attr("y",a.acc_y1).attr("width",a.acc_x2-a.acc_x1).attr("height",a.acc_y2-a.acc_y1).property("drag_handle",a)})).on("drag",(function(t){if(!n)return;t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation();let i=n.property("drag_handle"),r=t.dx,s=t.dy,a=Ii(this);e.no_change_x&&(r=0),e.no_change_y&&(s=0),a.classed("js_nw_resize")?(i.acc_x1+=r,i.acc_y1+=s):a.classed("js_ne_resize")?(i.acc_x2+=r,i.acc_y1+=s):a.classed("js_sw_resize")?(i.acc_x1+=r,i.acc_y2+=s):a.classed("js_se_resize")?(i.acc_x2+=r,i.acc_y2+=s):a.classed("js_w_resize")?i.acc_x1+=r:a.classed("js_n_resize")?i.acc_y1+=s:a.classed("js_e_resize")?i.acc_x2+=r:a.classed("js_s_resize")&&(i.acc_y2+=s);let o=Math.max(0,i.acc_x1),l=Math.min(i.acc_x2,i.pad_w),h=Math.max(0,i.acc_y1),c=Math.min(i.acc_y2,i.pad_h);i.x=Math.min(o,l),i.y=Math.min(h,c),i.width=Math.abs(l-o),i.height=Math.abs(c-h),n.attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height)})).on("end",(function(t){if(!n)return;t.sourceEvent.preventDefault();let e=n.property("drag_handle");a(e.x,e.y,e.width,e.height)})),e.only_resize||i.draw_g.style("cursor","move").call(o),e.only_move||s(i.draw_g,h)}const Tv={hints_layer(){let t=this.getCanvPainter();return t?t.getLayerSvg("info_layer"):Ii(null)},isTooltipShown(){if(!this.tooltip_enabled||!this.isTooltipAllowed())return!1;let t=this.hints_layer().select(".objects_hints");return!t.empty()&&t.property("hints_pad")==this.getPadName()},setTooltipEnabled(t){void 0!==t&&(this.tooltip_enabled=t)},processFrameTooltipEvent(t,e){if(t&&t.handler){let i=this.draw_g?this.draw_g.select(".main_layer"):null;if(!i||i.empty())t=null;else if(t.touch&&e){let n=Ui(e,i.node());t=n&&1==n.length?{touch:!0,x:n[0][0],y:n[0][1]}:null}else if(e){let n=qi(e,i.node());t={touch:!1,x:n[0],y:n[1]}}}let i=[],n=0,r=0,s=0,a=0,o=!1,l=11,h=this.getFrameRect(),c=this.getPadPainter(),d=c.getPadWidth(),u=new fl(160,l),f=!this.isTooltipAllowed()||!this.tooltip_enabled;t&&f&&(t.disabled=!0),t&&(t.painters=!0),c&&(i=c.processPadTooltipEvent(t)),t&&t.touch&&(l=15);for(let t=0;t<i.length;++t){let e=i[t];if(e)if(e.painter&&void 0!==e.user_info&&e.painter.provideUserTooltip(e.user_info),e.lines&&0!==e.lines.length){for(let n=0;n<t;++n){let r=i[n],s=!1;if(r&&r.lines.length===e.lines.length){for(let t=0;t<e.lines.length&&!s;++t)r.lines[t]!==e.lines[t]&&(s=!0);if(!s){i[t]=null;break}}}if(i[t]){n++,e.exact&&r++;for(let t=0;t<e.lines.length;++t)s=Math.max(s,e.lines[t].length);e.height=Math.round(e.lines.length*l*1.2+6-l*(1.2-1)),void 0!==e.color1&&"none"!==e.color1&&(0!==a&&a!==e.color1&&(o=!0),a=e.color1)}}else i[t]=null}let p=this.hints_layer(),g=p.select(".objects_hints"),_="",x="",y="",A=null,v=1e10,b=null,w=n>15,M=t?Math.round(t.x)+","+Math.round(t.y):"";for(let e=0;e<(i?i.length:0);++e){if(!i[e])continue;if(A||(A=i[e]),i[e].exact&&r<2&&(!A||!A.exact)){A=i[e];break}if(!t||void 0===i[e].x||void 0===i[e].y)continue;let n=(t.x-i[e].x)*(t.x-i[e].x)+(t.y-i[e].y)*(t.y-i[e].y);n<v&&(v=n,b=i[e])}if(A&&A.exact||!(v<400)||(A=b),A&&(x=A.lines&&A.lines.length>1?A.lines[0]:A.name,_=A.title||"",y=A.line,!y&&A.lines&&(y=A.lines.slice(1).join(" "))),this.showObjectStatus(x,_,y,M),!t||f||0===i.length||0===s||w&&!b)return void g.remove();g.empty()&&(g=p.append("svg:g").attr("class","objects_hints").style("pointer-events","none"));let T={x:0,y:0},S=h.transform||"";c.iscan||(T=nl(this.getPadSvg(),T),S="translate("+T.x+","+T.y+") "+S),g.attr("transform",S).property("last_point",t).property("hints_pad",this.getPadName());let C=g.property("viewmode")||"",P=0,E=t.x+h.hint_delta_x;if(w||1==n)C="single",E+=15;else{let t=.5,e=.5;"left"==C?e=.7:"right"==C&&(t=.3),E<=t*h.width?(C="left",E=20):E>=e*h.width?(C="right",E=h.width-60):E=g.property("startx")}C!==g.property("viewmode")&&(g.property("viewmode",C),g.selectAll("*").remove());let k=10,D=10,z=-1111,O=-1111,R=-T.y,L=this.getCanvPainter(),B=L.getPadHeight()-h.y-T.y;const N=t=>{for(let e=0;e<i.length&&t<B;++e){let n=i[e];n&&(n.y>=t-5&&n.y<=t+n.height+5&&(t=n.y+10,e=-1))}return t};for(let e=0;e<i.length;++e){let r=i[e],s=g.select(".painter_hint_"+e);if(w&&r!==b&&(r=null),null===r){s.remove();continue}let a=s.empty();a&&(s=g.append("svg:svg").attr("class","painter_hint_"+e).attr("opacity",0).style("overflow","hidden").style("pointer-events","none")),"single"==C?k=t.touch?t.y-r.height-5:Math.min(t.y+15,B-r.height-3)+h.hint_delta_y:(D=N(D),-1111===z&&-1111===O&&(z=O=r.x),z=Math.min(z,r.x),O=Math.min(O,r.x)),s.attr("x",E).attr("y",k).property("curry",k).property("gapy",D),k+=r.height+5,D+=r.height+5,a||s.selectAll("*").remove(),s.attr("width",60).attr("height",r.height);let c=s.append("rect").attr("x",0).attr("y",0).attr("width",60).attr("height",r.height).style("fill","lightgrey").style("pointer-events","none");if(n>1){let t=o?r.color1:r.color2;t&&"none"!==t&&c.style("stroke",t)}c.attr("stroke-width",r.exact?3:1);for(let t=0;t<(r.lines?r.lines.length:0);t++)if(null!==r.lines[t]){let e=il(s.append("svg:text").attr("text-anchor","start").attr("x",3).attr("y",3+t*l*1.2).attr("dy",".8em").style("fill","black").style("pointer-events","none").call(u.func).text(r.lines[t]),"bbox");P=Math.max(P,e.width)}a&&(m.TooltipAnimation>0?s.transition().duration(m.TooltipAnimation).attrTween("opacity",(function(){return function(t){return t<.8?"0":5*(t-.8)}})):s.attr("opacity",1))}P+=6;let F=g.selectAll("svg");if("right"==C&&E+P>h.width-20&&(E=h.width-P-20,F.attr("x",E)),"single"==C&&E+P>d-h.x&&E>P+20&&(E-=P+20,F.attr("x",E)),"single"!==C&&D<B&&D!==k)z<=E+P+5&&O>=E-5&&F.attr("y",(function(){return Ii(this).property("gapy")}));else if("single"!==C&&k>B){let t=Math.max(B-k-10,R);t<0&&F.attr("y",(function(){return Ii(this).property("curry")+t}))}P>10&&F.attr("width",P).select("rect").attr("width",P),g.property("startx",E),L._highlight_connect&&"function"==typeof L.processHighlightConnect&&L.processHighlightConnect(i)},assign(t){Object.assign(t,this,{tooltip_enabled:!0})}},Sv={addBasicInteractivity(){Tv.assign(this),this._frame_rotate||this._frame_fixpos||Mv(this,{obj:this,x:this._frame_x,y:this._frame_y,width:this.getFrameWidth(),height:this.getFrameHeight(),only_resize:!0,minwidth:20,minheight:20,redraw:()=>this.sizeChanged()}),gv("\n.jsroot rect.h1bin { stroke: #4572A7; fill: #4572A7; opacity: 0; }\n.jsroot rect.zoom { stroke: steelblue; fill-opacity: 0.1; }\n.jsroot path.zoom { stroke: steelblue; fill-opacity: 0.1; }\n.jsroot svg:not(:root) { overflow: hidden; }",this.draw_g.node());let t=this.draw_g.select(".main_layer");t.style("pointer-events","visibleFill").property("handlers_set",0);let e=this.getPadPainter(),i=e&&e._fast_drawing?0:1;if(t.property("handlers_set")!=i){let e=i?this.processFrameTooltipEvent.bind(this,null):null,n=i?this.processFrameTooltipEvent.bind(this,{handler:!0,touch:!1}):null;if(t.property("handlers_set",i).on("mouseenter",n).on("mousemove",n).on("mouseleave",e),d.touches){let n=i?this.processFrameTooltipEvent.bind(this,{handler:!0,touch:!0}):null;t.on("touchstart",n).on("touchmove",n).on("touchend",e).on("touchcancel",e)}}t.attr("x",0).attr("y",0).attr("width",this.getFrameWidth()).attr("height",this.getFrameHeight());let n=this.hints_layer().select(".objects_hints");!n.empty()&&this.isTooltipAllowed()&&n.property("hints_pad")==this.getPadName()&&setTimeout(this.processFrameTooltipEvent.bind(this,n.property("last_point"),null),10)},addFrameInteractivity(t){let e=this.getPadPainter(),i=this.getFrameSvg();if(e&&e._fast_drawing||i.empty())return Promise.resolve(this);if(t){let t=i.selectAll(".x2axis_container"),e=i.selectAll(".y2axis_container");return m.ContextMenu&&(t.on("contextmenu",(t=>this.showContextMenu("x2",t))),e.on("contextmenu",(t=>this.showContextMenu("y2",t)))),t.on("mousemove",(t=>this.showAxisStatus("x2",t))),e.on("mousemove",(t=>this.showAxisStatus("y2",t))),Promise.resolve(this)}let n=i.selectAll(".xaxis_container"),r=i.selectAll(".yaxis_container");return this.can_zoom_x=this.can_zoom_y=m.Zooming,e&&e.options&&(e.options.NoZoomX&&(this.can_zoom_x=!1),e.options.NoZoomY&&(this.can_zoom_y=!1)),i.property("interactive_set")||(this.addFrameKeysHandler(),this.last_touch=new Date(0),this.zoom_kind=0,this.zoom_rect=null,this.zoom_origin=null,this.zoom_curr=null,this.touch_cnt=0),m.Zooming&&!this.projection&&(m.ZoomMouse&&(i.on("mousedown",this.startRectSel.bind(this)),i.on("dblclick",this.mouseDoubleClick.bind(this))),m.ZoomWheel&&i.on("wheel",this.mouseWheel.bind(this))),d.touches&&(m.Zooming&&m.ZoomTouch&&!this.projection||m.ContextMenu)&&i.on("touchstart",this.startTouchZoom.bind(this)),m.ContextMenu&&(d.touches&&(n.on("touchstart",this.startTouchMenu.bind(this,"x")),r.on("touchstart",this.startTouchMenu.bind(this,"y"))),i.on("contextmenu",(t=>this.showContextMenu("",t))),n.on("contextmenu",(t=>this.showContextMenu("x",t))),r.on("contextmenu",(t=>this.showContextMenu("y",t)))),n.on("mousemove",(t=>this.showAxisStatus("x",t))),r.on("mousemove",(t=>this.showAxisStatus("y",t))),i.property("interactive_set",!0),Promise.resolve(this)},addFrameKeysHandler(){this.keys_handler||"undefined"==typeof window||(this.keys_handler=t=>this.processKeyPress(t),window.addEventListener("keydown",this.keys_handler,!1))},processKeyPress(t){let e=this.selectDom();if(!m.HandleKeys||e.empty()||!1===this.enabledKeys)return;let i="";switch(t.keyCode){case 33:i="PageUp";break;case 34:i="PageDown";break;case 37:i="ArrowLeft";break;case 38:i="ArrowUp";break;case 39:i="ArrowRight";break;case 40:i="ArrowDown";break;case 42:i="PrintScreen";break;case 106:i="*";break;default:return!1}let n=this.getPadPainter();if(Jl()!==n)return;t.shiftKey&&(i="Shift "+i),t.altKey&&(i="Alt "+i),t.ctrlKey&&(i="Ctrl "+i);let r={name:"x",dleft:0,dright:0};switch(i){case"ArrowLeft":r.dleft=-1,r.dright=1;break;case"ArrowRight":r.dleft=1,r.dright=-1;break;case"Ctrl ArrowLeft":r.dleft=r.dright=-1;break;case"Ctrl ArrowRight":r.dleft=r.dright=1;break;case"ArrowUp":r.name="y",r.dleft=1,r.dright=-1;break;case"ArrowDown":r.name="y",r.dleft=-1,r.dright=1;break;case"Ctrl ArrowUp":r.name="y",r.dleft=r.dright=1;break;case"Ctrl ArrowDown":r.name="y",r.dleft=r.dright=-1}if(r.dleft||r.dright){if(!m.Zooming)return!1;if(this.mode3d&&0!==i.indexOf("Ctrl"))return!1;this.analyzeMouseWheelEvent(null,r,.5),this.zoom(r.name,r.min,r.max),r.changed&&this.zoomChangedInteractive(r.name,!0),t.stopPropagation(),t.preventDefault()}else{let e=n&&n.findPadButton?n.findPadButton(i):"";e&&(n.clickPadButton(e),t.stopPropagation(),t.preventDefault())}return!0},processFrameClick(t,e){let i=this.getPadPainter();if(!i)return;t.painters=!0,t.disabled=!0;let n,r=i.processPadTooltipEvent(t),s=null;for(let t=0;t<r.length&&!s;++t)r[t]&&r[t].exact&&(s=r[t]);if(s){let i=e?this._dblclick_handler:this._click_handler;i&&(n=i(s.user_info,t))}return e||i.selectObjectPainter(s?s.painter:this,{x:t.x+(this._frame_x||0),y:t.y+(this._frame_y||0)}),n},startRectSel(t){if(this.zoom_kind>100)return;if(1!==(t.which||t.button))return;t.preventDefault();let e=qi(t,this.getFrameSvg().node());this.clearInteractiveElements();let i=this.getFrameWidth(),n=this.getFrameHeight();this.zoom_lastpos=e,this.zoom_curr=[Math.max(0,Math.min(i,e[0])),Math.max(0,Math.min(n,e[1]))],this.zoom_origin=[0,0],this.zoom_second=!1,e[0]<0||e[0]>i?(this.zoom_second=e[0]>i&&this.y2_handle,this.zoom_kind=3,this.zoom_origin[1]=this.zoom_curr[1],this.zoom_curr[0]=i,this.zoom_curr[1]+=1):e[1]<0||e[1]>n?(this.zoom_second=e[1]<0&&this.x2_handle,this.zoom_kind=2,this.zoom_origin[0]=this.zoom_curr[0],this.zoom_curr[0]+=1,this.zoom_curr[1]=n):(this.zoom_kind=1,this.zoom_origin[0]=this.zoom_curr[0],this.zoom_origin[1]=this.zoom_curr[1]),Ii(window).on("mousemove.zoomRect",this.moveRectSel.bind(this)).on("mouseup.zoomRect",this.endRectSel.bind(this),!0),this.zoom_rect=null,wv(this,!1),t.stopPropagation(),1!=this.zoom_kind&&setTimeout((()=>this.startLabelsMove()),500)},startLabelsMove(){if(this.zoom_rect)return;let t=2==this.zoom_kind?this.x_handle:this.y_handle;t&&"function"==typeof t.processLabelsMove&&this.zoom_lastpos&&t.processLabelsMove("start",this.zoom_lastpos)&&(this.zoom_labels=t)},moveRectSel(t){if(0==this.zoom_kind||this.zoom_kind>100)return;t.preventDefault();let e=qi(t,this.getFrameSvg().node());if(this.zoom_labels)return this.zoom_labels.processLabelsMove("move",e);switch(this.zoom_lastpos[0]=e[0],this.zoom_lastpos[1]=e[1],e[0]=Math.max(0,Math.min(this.getFrameWidth(),e[0])),e[1]=Math.max(0,Math.min(this.getFrameHeight(),e[1])),this.zoom_kind){case 1:this.zoom_curr[0]=e[0],this.zoom_curr[1]=e[1];break;case 2:this.zoom_curr[0]=e[0];break;case 3:this.zoom_curr[1]=e[1]}let i=Math.min(this.zoom_origin[0],this.zoom_curr[0]),n=Math.min(this.zoom_origin[1],this.zoom_curr[1]),r=Math.abs(this.zoom_curr[0]-this.zoom_origin[0]),s=Math.abs(this.zoom_curr[1]-this.zoom_origin[1]);if(!this.zoom_rect){if(1!=this.zoom_kind&&(r<2||s<2))return;this.zoom_rect=this.getFrameSvg().append("rect").attr("class","zoom").style("pointer-events","none")}this.zoom_rect.attr("x",i).attr("y",n).attr("width",r).attr("height",s)},endRectSel(t){if(0==this.zoom_kind||this.zoom_kind>100)return;t.preventDefault(),Ii(window).on("mousemove.zoomRect",null).on("mouseup.zoomRect",null);let e=qi(t,this.getFrameSvg().node()),i=this.zoom_kind;if(this.zoom_labels)this.zoom_labels.processLabelsMove("stop",e);else{let t=[this.can_zoom_x,this.can_zoom_y];switch(e[0]=Math.max(0,Math.min(this.getFrameWidth(),e[0])),e[1]=Math.max(0,Math.min(this.getFrameHeight(),e[1])),this.zoom_kind){case 1:this.zoom_curr[0]=e[0],this.zoom_curr[1]=e[1];break;case 2:this.zoom_curr[0]=e[0],t[1]=!1;break;case 3:this.zoom_curr[1]=e[1],t[0]=!1}let n,r,s,a,o=!1,l=this.swap_xy?1:0,h=1-l,c="x",d="y";t[l]&&Math.abs(this.zoom_curr[l]-this.zoom_origin[l])>10&&(this.zoom_second&&2==this.zoom_kind&&(c="x2"),n=Math.min(this.revertAxis(c,this.zoom_origin[l]),this.revertAxis(c,this.zoom_curr[l])),r=Math.max(this.revertAxis(c,this.zoom_origin[l]),this.revertAxis(c,this.zoom_curr[l])),o=!0),t[h]&&Math.abs(this.zoom_curr[h]-this.zoom_origin[h])>10&&(this.zoom_second&&3==this.zoom_kind&&(d="y2"),s=Math.min(this.revertAxis(d,this.zoom_origin[h]),this.revertAxis(d,this.zoom_curr[h])),a=Math.max(this.revertAxis(d,this.zoom_origin[h]),this.revertAxis(d,this.zoom_curr[h])),o=!0),"x2"==c?(this.zoomChangedInteractive(c,!0),this.zoomSingle(c,n,r),i=0):"y2"==d?(this.zoomChangedInteractive(d,!0),this.zoomSingle(d,s,a),i=0):o&&(this.zoomChangedInteractive("x",!0),this.zoomChangedInteractive("y",!0),this.zoom(n,r,s,a),i=0)}let n=1===i?{x:this.zoom_origin[0],y:this.zoom_origin[1]}:null;switch(this.clearInteractiveElements(),i){case 1:this.processFrameClick(n);break;case 2:{let t=this.getPadPainter();t&&t.selectObjectPainter(this,null,"xaxis");break}case 3:{let t=this.getPadPainter();t&&t.selectObjectPainter(this,null,"yaxis");break}}},mouseDoubleClick(t){t.preventDefault();let e=qi(t,this.getFrameSvg().node()),i=this.getFrameWidth(),n=this.getFrameHeight();this.clearInteractiveElements();let r=e[0]>=0&&e[0]<=i,s=e[1]>=0&&e[1]<=n;if(r&&s&&this._dblclick_handler&&this.processFrameClick({x:e[0],y:e[1]},!0))return;let a=(this.can_zoom_x?"x":"")+(this.can_zoom_y?"y":"")+"z";if(r){if(!s){if(!this.can_zoom_x)return;a=this.swap_xy?"y":"x",e[1]<0&&this[a+"2_handle"]&&(a+="2")}}else{if(!this.can_zoom_y)return;a=this.swap_xy?"x":"y",e[0]>i&&this[a+"2_handle"]&&(a+="2")}this.unzoom(a).then((t=>{if(t)return;let i=this.getPadPainter(),n=this.getFrameRect();i&&i.selectObjectPainter(i,{x:e[0]+n.x,y:e[1]+n.y,dbl:!0})}))},startTouchZoom(t){if(0!=this.zoom_kind)return t.preventDefault(),void t.stopPropagation();let e=Ui(t,this.getFrameSvg().node());if(this.touch_cnt+=1,1==e.length){let i=new Date,n=i.getTime()-this.last_touch.getTime();this.last_touch=i,n<300&&this.zoom_curr&&Math.abs(this.zoom_curr[0]-e[0][0])<30&&Math.abs(this.zoom_curr[1]-e[0][1])<30?(t.preventDefault(),t.stopPropagation(),this.clearInteractiveElements(),this.unzoom("xyz"),this.last_touch=new Date(0),this.getFrameSvg().on("touchcancel",null).on("touchend",null,!0)):m.ContextMenu&&(this.zoom_curr=e[0],this.getFrameSvg().on("touchcancel",this.endTouchSel.bind(this)).on("touchend",this.endTouchSel.bind(this)),t.preventDefault(),t.stopPropagation())}if(2!=e.length||!m.Zooming||!m.ZoomTouch)return;t.preventDefault(),t.stopPropagation(),this.clearInteractiveElements(),this.getFrameSvg().on("touchcancel",null).on("touchend",null);let i=e[0],n=e[1],r=this.getFrameWidth(),s=this.getFrameHeight();this.zoom_curr=[Math.min(i[0],n[0]),Math.min(i[1],n[1])],this.zoom_origin=[Math.max(i[0],n[0]),Math.max(i[1],n[1])],this.zoom_second=!1,this.zoom_curr[0]<0||this.zoom_curr[0]>r?(this.zoom_second=this.zoom_curr[0]>r&&this.y2_handle,this.zoom_kind=103,this.zoom_curr[0]=0,this.zoom_origin[0]=r):this.zoom_origin[1]>s||this.zoom_origin[1]<0?(this.zoom_second=this.zoom_origin[1]<0&&this.x2_handle,this.zoom_kind=102,this.zoom_curr[1]=0,this.zoom_origin[1]=s):this.zoom_kind=101,wv(this,!1),this.zoom_rect=this.getFrameSvg().append("rect").attr("class","zoom").attr("id","zoomRect").attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]),Ii(window).on("touchmove.zoomRect",this.moveTouchZoom.bind(this)).on("touchcancel.zoomRect",this.endTouchZoom.bind(this)).on("touchend.zoomRect",this.endTouchZoom.bind(this))},moveTouchZoom(t){if(this.zoom_kind<100)return;t.preventDefault();let e=Ui(t,this.getFrameSvg().node());if(2!=e.length)return this.clearInteractiveElements();let i=e[0],n=e[1];103!=this.zoom_kind&&(this.zoom_curr[0]=Math.min(i[0],n[0]),this.zoom_origin[0]=Math.max(i[0],n[0])),102!=this.zoom_kind&&(this.zoom_curr[1]=Math.min(i[1],n[1]),this.zoom_origin[1]=Math.max(i[1],n[1])),this.zoom_rect.attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]),(this.zoom_origin[0]-this.zoom_curr[0]>10||this.zoom_origin[1]-this.zoom_curr[1]>10)&&wv(this,!1),t.stopPropagation()},endTouchZoom(t){if(this.getFrameSvg().on("touchcancel",null).on("touchend",null),0===this.zoom_kind){t.preventDefault();let e=(new Date).getTime()-this.last_touch.getTime();e>500&&e<2e3&&!this.isTooltipShown()?(this.showContextMenu("main",{clientX:this.zoom_curr[0],clientY:this.zoom_curr[1]}),this.last_touch=new Date(0)):this.clearInteractiveElements()}if(this.zoom_kind<100)return;t.preventDefault(),Ii(window).on("touchmove.zoomRect",null).on("touchend.zoomRect",null).on("touchcancel.zoomRect",null);let e,i,n,r,s=!1,a=this.swap_xy?1:0,o=1-a,l=[!0,!0],h="x",c="y";102===this.zoom_kind&&(l[1]=!1),103===this.zoom_kind&&(l[0]=!1),l[a]&&Math.abs(this.zoom_curr[a]-this.zoom_origin[a])>10&&(this.zoom_second&&102==this.zoom_kind&&(h="x2"),e=Math.min(this.revertAxis(h,this.zoom_origin[a]),this.revertAxis(h,this.zoom_curr[a])),i=Math.max(this.revertAxis(h,this.zoom_origin[a]),this.revertAxis(h,this.zoom_curr[a])),s=!0),l[o]&&Math.abs(this.zoom_curr[o]-this.zoom_origin[o])>10&&(this.zoom_second&&103==this.zoom_kind&&(c="y2"),n=Math.min(this.revertAxis(c,this.zoom_origin[o]),this.revertAxis(c,this.zoom_curr[o])),r=Math.max(this.revertAxis(c,this.zoom_origin[o]),this.revertAxis(c,this.zoom_curr[o])),s=!0),this.clearInteractiveElements(),this.last_touch=new Date(0),"x2"==h?(this.zoomChangedInteractive(h,!0),this.zoomSingle(h,e,i)):"y2"==c?(this.zoomChangedInteractive(c,!0),this.zoomSingle(c,n,r)):s&&(this.zoomChangedInteractive("x",!0),this.zoomChangedInteractive("y",!0),this.zoom(e,i,n,r)),t.stopPropagation()},analyzeMouseWheelEvent(t,e,i,n,r){let s=r?this[e.name+"2_handle"]:null;if(s)return e.second=Object.assign({},e),s.analyzeWheelEvent(t,i,e.second,n);let a=this[e.name+"_handle"];if(a)return a.analyzeWheelEvent(t,i,e,n);console.error("Fail to analyze zooming event for ",e.name)},isAllowedDefaultYZooming(){if(this.self_drawaxes)return!0;let t=this.getPadPainter();if(t&&t.painters)for(let e=0;e<t.painters.length;++e){let i=t.painters[e];if(i&&void 0!==i.wheel_zoomy)return i.wheel_zoomy}return!1},mouseWheel(t){t.stopPropagation(),t.preventDefault(),this.clearInteractiveElements();let e={name:"x",reverse:this.reverse_x},i={name:"y",reverse:this.reverse_y,ignore:!this.isAllowedDefaultYZooming()},n=qi(t,this.getFrameSvg().node()),r=this.getFrameWidth(),s=this.getFrameHeight();this.can_zoom_x&&this.analyzeMouseWheelEvent(t,this.swap_xy?i:e,n[0]/r,n[1]>=0&&n[1]<=s,n[1]<0),this.can_zoom_y&&this.analyzeMouseWheelEvent(t,this.swap_xy?e:i,1-n[1]/s,n[0]>=0&&n[0]<=r,n[0]>r),this.zoom(e.min,e.max,i.min,i.max),e.changed&&this.zoomChangedInteractive("x",!0),i.changed&&this.zoomChangedInteractive("y",!0),e.second&&(this.zoomSingle("x2",e.second.min,e.second.max),e.second.changed&&this.zoomChangedInteractive("x2",!0)),i.second&&(this.zoomSingle("y2",i.second.min,i.second.max),i.second.changed&&this.zoomChangedInteractive("y2",!0))},showContextMenu(t,e,i){if("zoom_kind"in this&&this.zoom_kind>100)return;let n=this,r=null,s=!1,a=null;if(e.stopPropagation)if(e.preventDefault(),e.stopPropagation(),"painter"==t&&i)n=i,t="";else if(t)this.v7_frame||"x"!=t&&"y"!=t&&"z"!=t||(r=this.getMainPainter());else{let i=qi(e,this.getFrameSvg().node()),r=Ui(e,this.getFrameSvg().node()),o=this.getPadPainter(),l=null,h=null;if(a=this,1===r.length?l={x:r[0][0],y:r[0][1],touch:!0}:2===i.length&&(l={x:i[0],y:i[1],touch:!1}),null!==l&&null!==o){l.painters=!0;let t=o.processPadTooltipEvent(l),e=1e3;for(let i=0;i<t.length;++i)if(t[i]&&t[i].menu){let n="menu_dist"in t[i]?t[i].menu_dist:7;n<e&&(h=t[i].painter,e=n)}}h?n=h:t="frame",l&&(s=l.x>0&&l.x<20&&l.y>0&&l.y<20),a.setLastEventPos(l)}else"painter"==t&&i&&(n=i,t="");r||(r=n),n&&n.fillContextMenu&&(this.clearInteractiveElements(),vv(e,n).then((e=>{let n=e.painter.fillContextMenu(e,t,i);a&&(!n||s&&"frame"!==t)&&(n=a.fillContextMenu(e)),n&&r.fillObjectExecMenu(e,t).then((t=>{wv(t.painter,!1),t.show().then((()=>wv(t.painter,!0)))}))})))},startTouchMenu(t,e){let i=Ui(e,this.getFrameSvg().node());if(1!=i.length)return;t&&""!=t||(t="main");let n="touch_"+t;e.sourceEvent.preventDefault(),e.sourceEvent.stopPropagation(),this[n]={dt:new Date,pos:i[0]};let r=this.endTouchMenu.bind(this,t);this.getFrameSvg().on("touchcancel",r).on("touchend",r)},endTouchMenu(t,e){let i="touch_"+t;if(!(i in this))return;e.sourceEvent.preventDefault(),e.sourceEvent.stopPropagation();let n=(new Date).getTime()-this[i].dt.getTime();if(this.getFrameSvg().on("touchcancel",null).on("touchend",null),n>500){let e=this.getFrameSvg().node().getBoundingClientRect();this.showContextMenu(t,{clientX:e.left+this[i].pos[0],clientY:e.top+this[i].pos[1]})}delete this[i]},clearInteractiveElements(){bv(),this.zoom_kind=0,this.zoom_rect&&(this.zoom_rect.remove(),delete this.zoom_rect),delete this.zoom_curr,delete this.zoom_origin,delete this.zoom_lastpos,delete this.zoom_labels,wv(this,!0)},assign(t){Object.assign(t,this)}};class Cv extends Vl{constructor(t,e){super(t,e&&e.$dummy?null:e),this.zoom_kind=0,this.mode3d=!1,this.shrink_frame_left=0,this.xmin=this.xmax=0,this.ymin=this.ymax=0,this.ranges_set=!1,this.axes_drawn=!1,this.keys_handler=null,this.projection=0}getFramePainter(){return this}is_root6(){return!0}getObject(t){return"xaxis"===t?this.xaxis:"yaxis"===t?this.yaxis:super.getObject()}setFrameActive(t){this.enabledKeys=!(!t||!m.HandleKeys),this.control&&(this.control.enableKeys=this.enabledKeys)}shrinkFrame(t,e){this.fX1NDC+=t,this.fX2NDC-=e}setLastEventPos(t){this.fLastEventPnt=t}getLastEventPos(){return this.fLastEventPnt}getProjectionFunc(){switch(this.projection){case 1:return(t,e)=>{const i=Math.PI/180,n=t/2*i,r=e*i,s=Math.sqrt(2),a=2*s/Math.PI,o=Math.cos(r),l=Math.sqrt(1+o*Math.cos(n));return{x:o*Math.sin(n)*2*s/l/a/i,y:Math.sin(r)*s/l/a/i}};case 2:return(t,e)=>({x:t,y:Math.log(Math.tan((Math.PI/2+e/180*Math.PI)/2))});case 3:return(t,e)=>({x:t*Math.cos(e/180*Math.PI),y:e});case 4:return(t,e)=>({x:t*(2*Math.cos(2*e/180*Math.PI/3)-1),y:180*Math.sin(e/180*Math.PI/3)})}}recalculateRange(t){this.projection=t||0,2==this.projection&&(this.scale_ymin<=-90||this.scale_ymax>=90)&&(console.warn("Mercator Projection","Latitude out of range",this.scale_ymin,this.scale_ymax),this.projection=0);let e=this.getProjectionFunc();if(!e)return;let i=[e(this.scale_xmin,this.scale_ymin),e(this.scale_xmin,this.scale_ymax),e(this.scale_xmax,this.scale_ymax),e(this.scale_xmax,this.scale_ymin)];this.scale_xmin<0&&this.scale_xmax>0&&(i.push(e(0,this.scale_ymin)),i.push(e(0,this.scale_ymax))),this.scale_ymin<0&&this.scale_ymax>0&&(i.push(e(this.scale_xmin,0)),i.push(e(this.scale_xmax,0))),this.original_xmin=this.scale_xmin,this.original_xmax=this.scale_xmax,this.original_ymin=this.scale_ymin,this.original_ymax=this.scale_ymax,this.scale_xmin=this.scale_xmax=i[0].x,this.scale_ymin=this.scale_ymax=i[0].y;for(let t=1;t<i.length;++t)this.scale_xmin=Math.min(this.scale_xmin,i[t].x),this.scale_xmax=Math.max(this.scale_xmax,i[t].x),this.scale_ymin=Math.min(this.scale_ymin,i[t].y),this.scale_ymax=Math.max(this.scale_ymax,i[t].y)}setAxesRanges(t,e,i,n,r,s,a,o,l){this.ranges_set=!0,this.xaxis=t,this.xmin=e,this.xmax=i,this.yaxis=n,this.ymin=r,this.ymax=s,this.zaxis=a,this.zmin=o,this.zmax=l}setAxes2Ranges(t,e,i,n,r,s,a,o){t&&(this.x2axis=e,this.x2min=i,this.x2max=n),r&&(this.y2axis=s,this.y2min=a,this.y2max=o)}getAxis(t){switch(t){case"x":return this.xaxis;case"y":return this.yaxis;case"z":return this.zaxis;case"x2":return this.x2axis;case"y2":return this.y2axis}return null}applyPadUserRange(t,e){if(!t)return;let i=t["fU"+e+"min"],n=t["fU"+e+"max"],r=1e-7;if("x"==e){if(Math.abs(t.fX1)>r||Math.abs(t.fX2-1)>r){let e=t.fX2-t.fX1;i=t.fX1+e*t.fLeftMargin,n=t.fX2-e*t.fRightMargin}}else if(Math.abs(t.fY1)>r||Math.abs(t.fY2-1)>r){let e=t.fY2-t.fY1;i=t.fY1+e*t.fBottomMargin,n=t.fY2-e*t.fTopMargin}if(i>=n||Math.abs(i)<r&&Math.abs(n-1)<r)return;t["fLog"+e]>0&&(i=Math.exp(i*Math.log(10)),n=Math.exp(n*Math.log(10)));let s=e;this.swap_xy&&(s="x"==e?"y":"x");let a="scale_"+s+"min",o="scale_"+s+"max";r=1e-7*(this[o]-this[a]),(Math.abs(i-this[a])>r||Math.abs(n-this[o])>r)&&(this["zoom_"+s+"min"]=i,this["zoom_"+s+"max"]=n)}createXY(t){this.cleanXY(),t||(t={ndim:1}),this.swap_xy=t.swap_xy||!1,this.reverse_x=t.reverse_x||!1,this.reverse_y=t.reverse_y||!1,this.logx=this.logy=0;let e=this.getFrameWidth(),i=this.getFrameHeight(),n=this.getPadPainter().getRootPad();if(this.scale_xmin=this.xmin,this.scale_xmax=this.xmax,this.scale_ymin=this.ymin,this.scale_ymax=this.ymax,t.extra_y_space){(this.swap_xy?n.fLogx:n.fLogy)&&this.scale_ymax>0?this.scale_ymax=Math.exp(1.1*Math.log(this.scale_ymax)):this.scale_ymax+=.1*(this.scale_ymax-this.scale_ymin)}if(t.check_pad_range){const e=t=>{if(this.zoomChangedInteractive(t))return;this[`zoom_${t}min`]=this[`zoom_${t}max`]=0;const e=this.getAxis(t);e&&e.TestBit(Py.kAxisRange)&&e.fFirst!==e.fLast&&(e.fFirst>1||e.fLast<e.fNbins)&&(this[`zoom_${t}min`]=e.fFirst>1?e.GetBinLowEdge(e.fFirst):e.fXmin,this[`zoom_${t}max`]=e.fLast<e.fNbins?e.GetBinLowEdge(e.fLast+1):e.fXmax,e.InvertBit(Py.kAxisRange),e.fFirst=1,e.fLast=e.fNbins)};if(e("x"),t.ndim>1&&e("y"),t.ndim>2&&e("z"),"pad_range"===t.check_pad_range){let t=this.getCanvPainter();t&&t.online_canvas||(this.applyPadUserRange(n,"x"),this.applyPadUserRange(n,"y"))}}t.zoom_ymin==t.zoom_ymax||this.zoom_ymin!=this.zoom_ymax||this.zoomChangedInteractive("y")||(this.zoom_ymin=t.zoom_ymin,this.zoom_ymax=t.zoom_ymax),this.zoom_xmin!=this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax),this.zoom_ymin!=this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax),this.recalculateRange(t.Proj),this.x_handle=new Dy(this.getDom(),this.xaxis,!0),this.x_handle.setPadName(this.getPadName()),this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,this.scale_xmax,this.swap_xy,this.swap_xy?[0,i]:[0,e],{reverse:this.reverse_x,log:this.swap_xy?n.fLogy:n.fLogx,symlog:this.swap_xy?t.symlog_y:t.symlog_x,logcheckmin:this.swap_xy,logminfactor:1e-4}),this.x_handle.assignFrameMembers(this,"x"),this.y_handle=new Dy(this.getDom(),this.yaxis,!0),this.y_handle.setPadName(this.getPadName()),this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!this.swap_xy,this.swap_xy?[0,e]:[0,i],{reverse:this.reverse_y,log:this.swap_xy?n.fLogx:n.fLogy,symlog:this.swap_xy?t.symlog_x:t.symlog_y,logcheckmin:t.ndim<2||this.swap_xy,log_min_nz:t.ymin_nz&&t.ymin_nz<.01*this.ymax?.3*t.ymin_nz:0,logminfactor:3e-4}),this.y_handle.assignFrameMembers(this,"y"),this.setRootPadRange(n)}createXY2(t){t||(t={}),this.reverse_x2=t.reverse_x||!1,this.reverse_y2=t.reverse_y||!1,this.logx2=this.logy2=0;let e=this.getFrameWidth(),i=this.getFrameHeight(),n=this.getPadPainter().getRootPad();if(t.second_x&&(this.scale_x2min=this.x2min,this.scale_x2max=this.x2max),t.second_y&&(this.scale_y2min=this.y2min,this.scale_y2max=this.y2max),t.extra_y_space&&t.second_y){(this.swap_xy?n.fLogx:n.fLogy)&&this.scale_y2max>0?this.scale_y2max=Math.exp(1.1*Math.log(this.scale_y2max)):this.scale_y2max+=.1*(this.scale_y2max-this.scale_y2min)}this.zoom_x2min!=this.zoom_x2max&&t.second_x&&(this.scale_x2min=this.zoom_x2min,this.scale_x2max=this.zoom_x2max),this.zoom_y2min!=this.zoom_y2max&&t.second_y&&(this.scale_y2min=this.zoom_y2min,this.scale_y2max=this.zoom_y2max),t.second_x&&(this.x2_handle=new Dy(this.getDom(),this.x2axis,!0),this.x2_handle.setPadName(this.getPadName()),this.x2_handle.configureAxis("x2axis",this.x2min,this.x2max,this.scale_x2min,this.scale_x2max,this.swap_xy,this.swap_xy?[0,i]:[0,e],{reverse:this.reverse_x2,log:this.swap_xy?n.fLogy:n.fLogx,logcheckmin:this.swap_xy,logminfactor:1e-4}),this.x2_handle.assignFrameMembers(this,"x2")),t.second_y&&(this.y2_handle=new Dy(this.getDom(),this.y2axis,!0),this.y2_handle.setPadName(this.getPadName()),this.y2_handle.configureAxis("y2axis",this.y2min,this.y2max,this.scale_y2min,this.scale_y2max,!this.swap_xy,this.swap_xy?[0,e]:[0,i],{reverse:this.reverse_y2,log:this.swap_xy?n.fLogx:n.fLogy,logcheckmin:t.ndim<2||this.swap_xy,log_min_nz:t.ymin_nz&&t.ymin_nz<.01*this.y2max?.3*t.ymin_nz:0,logminfactor:3e-4}),this.y2_handle.assignFrameMembers(this,"y2"))}getGrFuncs(t,e){let i=t&&this.grx2,n=e&&this.gry2;return i||n?{use_x2:i,grx:i?this.grx2:this.grx,logx:this.logx,x_handle:i?this.x2_handle:this.x_handle,scale_xmin:i?this.scale_x2min:this.scale_xmin,scale_xmax:i?this.scale_x2max:this.scale_xmax,use_y2:n,gry:n?this.gry2:this.gry,logy:this.logy,y_handle:n?this.y2_handle:this.y_handle,scale_ymin:n?this.scale_y2min:this.scale_ymin,scale_ymax:n?this.scale_y2max:this.scale_ymax,swap_xy:this.swap_xy,fp:this,revertAxis:function(t,e){return"x"==t&&this.use_x2&&(t="x2"),"y"==t&&this.use_y2&&(t="y2"),this.fp.revertAxis(t,e)},axisAsText:function(t,e){return"x"==t&&this.use_x2&&(t="x2"),"y"==t&&this.use_y2&&(t="y2"),this.fp.axisAsText(t,e)}}:this}setRootPadRange(t,e){if(!t||!this.ranges_set)return;e?(t.fUxmin=t.fUymin=-.9,t.fUxmax=t.fUymax=.9):(t.fLogx=this.swap_xy?this.logy:this.logx,t.fUxmin=t.fLogx?Math.log10(this.scale_xmin):this.scale_xmin,t.fUxmax=t.fLogx?Math.log10(this.scale_xmax):this.scale_xmax,t.fLogy=this.swap_xy?this.logx:this.logy,t.fUymin=t.fLogy?Math.log10(this.scale_ymin):this.scale_ymin,t.fUymax=t.fLogy?Math.log10(this.scale_ymax):this.scale_ymax);let i=t.fUxmax-t.fUxmin,n=1-t.fLeftMargin-t.fRightMargin,r=t.fUymax-t.fUymin,s=1-t.fBottomMargin-t.fTopMargin;n<=0&&(n=.01),s<=0&&(s=.01),t.fX1=t.fUxmin-i/n*t.fLeftMargin,t.fX2=t.fUxmax+i/n*t.fRightMargin,t.fY1=t.fUymin-r/s*t.fBottomMargin,t.fY2=t.fUymax+r/s*t.fTopMargin}drawGrids(){let t=this.getFrameSvg().select(".grid_layer");t.selectAll(".xgrid").remove(),t.selectAll(".ygrid").remove();let e=this.getPadPainter(),i=e?e.getRootPad(!0):null,n=this.getFrameHeight(),r=this.getFrameWidth(),s=p.fGridStyle;if(i&&i.fGridx&&this.x_handle){let e="";for(let t=0;t<this.x_handle.ticks.length;++t)this.swap_xy?e+=`M0,${this.x_handle.ticks[t]}h${r}`:e+=`M${this.x_handle.ticks[t]},0v${n}`;let i=p.fGridColor>0?p.fGridColor:this.getAxis("x")?this.getAxis("x").fAxisColor:1,a=this.getColor(i)||"black";e.length>0&&t.append("svg:path").attr("class","xgrid").attr("d",e).style("stroke",a).style("stroke-width",p.fGridWidth).style("stroke-dasharray",Xl(s))}if(i&&i.fGridy&&this.y_handle){let e="";for(let t=0;t<this.y_handle.ticks.length;++t)this.swap_xy?e+=`M${this.y_handle.ticks[t]},0v${n}`:e+=`M0,${this.y_handle.ticks[t]}h${r}`;let i=p.fGridColor>0?p.fGridColor:this.getAxis("y")?this.getAxis("y").fAxisColor:1,a=this.getColor(i)||"black";e.length>0&&t.append("svg:path").attr("class","ygrid").attr("d",e).style("stroke",a).style("stroke-width",p.fGridWidth).style("stroke-dasharray",Xl(s))}}axisAsText(t,e){let i=this[t+"_handle"];return i?i.axisAsText(e,m[t.toUpperCase()+"ValuesFormat"]):e.toPrecision(4)}hasDrawnAxes(t,e){return!t&&!e&&this.axes_drawn}drawAxes(t,e,i,n,r,s){if(this.cleanAxesDrawings(),this.xmin==this.xmax||this.ymin==this.ymax)return Promise.resolve(!1);void 0===n&&(n=0);let a=this.getFrameSvg().select(".axis_layer"),o=this.getFrameWidth(),l=this.getFrameHeight(),h=this.getPadPainter().getRootPad(!0);this.x_handle.invert_side=n>=10,this.x_handle.lbls_both_sides=!this.x_handle.invert_side&&h&&h.fTickx>1,this.x_handle.has_obstacle=r,this.y_handle.invert_side=n%10==1,this.y_handle.lbls_both_sides=!this.y_handle.invert_side&&h&&h.fTicky>1,this.y_handle.has_obstacle=s;let c=this.swap_xy?this.y_handle:this.x_handle,d=this.swap_xy?this.x_handle:this.y_handle;if(!e||!i){let t=this.getPadPainter();t&&t._fast_drawing&&(e=i=!0)}let u=Promise.resolve(!0);if(!e||!i){let n=!t&&m.CanAdjustFrame,r=c.drawAxis(a,o,l,c.invert_side?void 0:`translate(0,${l})`,h&&h.fTickx?-l:0,e,void 0,!1),s=d.drawAxis(a,o,l,d.invert_side?`translate(${o})`:void 0,h&&h.fTicky?o:0,i,d.invert_side?0:this._frame_x,n);u=Promise.all([r,s]).then((()=>{if(this.drawGrids(),!n)return;let t=0,e=d.position;return-.2*o<e&&e<0?(t=-e/o+.001,this.shrink_frame_left+=t):e>0&&e<.3*o&&this.shrink_frame_left>0&&e/o>this.shrink_frame_left&&(t=-this.shrink_frame_left,this.shrink_frame_left=0),t?(this.shrinkFrame(t,0),this.redraw().then((()=>this.drawAxes(!0)))):void 0}))}return u.then((()=>(t||(this.axes_drawn=!0),!0)))}drawAxes2(t,e){let i=this.getFrameSvg().select(".axis_layer"),n=this.getFrameWidth(),r=this.getFrameHeight(),s=this.getPadPainter().getRootPad(!0);t&&(this.x2_handle.invert_side=!0,this.x2_handle.lbls_both_sides=!1,this.x2_handle.has_obstacle=!1),e&&(this.y2_handle.invert_side=!0,this.y2_handle.lbls_both_sides=!1);let a,o,l=this.swap_xy?this.y2_handle:this.x2_handle,h=this.swap_xy?this.x2_handle:this.y2_handle;if(l||h){let t=this.getPadPainter();t&&t._fast_drawing&&(l=h=null)}return l&&(a=l.drawAxis(i,n,r,l.invert_side?void 0:`translate(0,${r})`,s&&s.fTickx?-r:0,!1,void 0,!1)),h&&(o=h.drawAxis(i,n,r,h.invert_side?`translate(${n})`:void 0,s&&s.fTicky?n:0,!1,h.invert_side?0:this._frame_x,!1)),Promise.all([a,o])}updateAttributes(t){let e=this.getPadPainter(),i=e?e.getRootPad(!0):null,n=this.getObject();(void 0===this.fX1NDC||t&&!this.modified_NDC)&&(i?Object.assign(this,{fX1NDC:i.fLeftMargin,fX2NDC:1-i.fRightMargin,fY1NDC:i.fBottomMargin,fY2NDC:1-i.fTopMargin}):Object.assign(this,m.FrameNDC)),void 0===this.fillatt&&(n?this.createAttFill({attr:n}):i&&i.fFrameFillColor?this.createAttFill({pattern:i.fFrameFillStyle,color:i.fFrameFillColor}):i?this.createAttFill({attr:i}):this.createAttFill({pattern:1001,color:0}),!n&&this.fillatt.empty()&&e&&e.iscan&&this.fillatt.setSolidColor("white")),!n&&i&&void 0!==i.fFrameLineColor?this.createAttLine({color:i.fFrameLineColor,width:i.fFrameLineWidth,style:i.fFrameLineStyle}):this.createAttLine({attr:n,color:"black"})}sizeChanged(){let t=this.getPadPainter(),e=t?t.getRootPad(!0):null;e&&(e.fLeftMargin=this.fX1NDC,e.fRightMargin=1-this.fX2NDC,e.fBottomMargin=this.fY1NDC,e.fTopMargin=1-this.fY2NDC,this.setRootPadRange(e)),this.interactiveRedraw("pad","frame")}cleanXY(){delete this.grx,delete this.gry,delete this.grz,this.x_handle&&(this.x_handle.cleanup(),delete this.x_handle),this.y_handle&&(this.y_handle.cleanup(),delete this.y_handle),this.z_handle&&(this.z_handle.cleanup(),delete this.z_handle),delete this.grx2,delete this.gry2,this.x2_handle&&(this.x2_handle.cleanup(),delete this.x2_handle),this.y2_handle&&(this.y2_handle.cleanup(),delete this.y2_handle)}cleanAxesDrawings(){this.x_handle&&this.x_handle.removeG(),this.y_handle&&this.y_handle.removeG(),this.z_handle&&this.z_handle.removeG(),this.x2_handle&&this.x2_handle.removeG(),this.y2_handle&&this.y2_handle.removeG();let t=this.getG();t&&(t.select(".grid_layer").selectAll("*").remove(),t.select(".axis_layer").selectAll("*").remove()),this.axes_drawn=!1}cleanFrameDrawings(){"function"==typeof this.create3DScene&&this.create3DScene(-1),this.cleanAxesDrawings(),this.cleanXY(),this.ranges_set=!1,this.xmin=this.xmax=0,this.ymin=this.ymax=0,this.zmin=this.zmax=0,this.zoom_xmin=this.zoom_xmax=0,this.zoom_ymin=this.zoom_ymax=0,this.zoom_zmin=this.zoom_zmax=0,this.scale_xmin=this.scale_xmax=0,this.scale_ymin=this.scale_ymax=0,this.scale_zmin=this.scale_zmax=0,this.draw_g&&(this.draw_g.select(".main_layer").selectAll("*").remove(),this.draw_g.select(".upper_layer").selectAll("*").remove()),this.xaxis=null,this.yaxis=null,this.zaxis=null,this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null),this.draw_g.remove()),delete this.draw_g,this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null)}cleanup(){this.cleanFrameDrawings(),delete this._click_handler,delete this._dblclick_handler,delete this.enabledKeys;let t=this.getPadPainter();t&&t.frame_painter_ref===this&&delete t.frame_painter_ref,super.cleanup()}redraw(){let t=this.getPadPainter();t&&(t.frame_painter_ref=this),this.updateAttributes();let e,i,n,r=t?t.getPadRect():{width:10,height:10},s=Math.round(r.width*this.fX1NDC),a=Math.round(r.width*(this.fX2NDC-this.fX1NDC)),o=Math.round(r.height*(1-this.fY2NDC)),h=Math.round(r.height*(this.fY2NDC-this.fY1NDC)),c=!1,d=!1;if(t&&t.options&&(t.options.RotateFrame&&(c=!0),t.options.FixFrame&&(d=!0)),c){e=`rotate(-90,${s},${o}) translate(${s-h},${o})`;let t=a;a=h,h=t}else e=`translate(${s},${o})`;return this._frame_x=s,this._frame_y=o,this._frame_width=a,this._frame_height=h,this._frame_rotate=c,this._frame_fixpos=d,this.mode3d||(this.draw_g=this.getFrameSvg(),this.draw_g.empty()?(this.draw_g=this.getLayerSvg("primitives_layer").append("svg:g").attr("class","root_frame"),l()||this.draw_g.append("svg:title").text(""),i=this.draw_g.append("svg:path"),this.draw_g.append("svg:g").attr("class","grid_layer"),n=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden"),this.draw_g.append("svg:g").attr("class","axis_layer"),this.draw_g.append("svg:g").attr("class","upper_layer")):(i=this.draw_g.select("path"),n=this.draw_g.select(".main_layer")),this.axes_drawn=!1,this.draw_g.attr("transform",e),i.attr("d",`M0,0H${a}V${h}H0Z`).call(this.fillatt.func).call(this.lineatt.func),n.attr("width",a).attr("height",h).attr("viewBox",`0 0 ${a} ${h}`),l()||(i.style("pointer-events","visibleFill"),Sv.assign(this),this.addBasicInteractivity())),this}changeAxisLog(t,e){let i=this.getPadPainter(),n=i?i.getRootPad(!0):null;if(!n)return;i._interactively_changed=!0;let r="fLog"+t;if(!n[r]){this.swap_xy&&"x"===t?t="y":this.swap_xy&&"y"===t&&(t="x");let e=this[t+"_handle"];if(e&&"labels"===e.kind)return}"toggle"!=e&&void 0!==e||(e=n[r]?0:1),n[r]=e,this.interactiveRedraw("pad","log"+t)}toggleAxisLog(t){this.changeAxisLog(t,"toggle")}fillContextMenu(t,e,i){let n=this.getMainPainter(),r=this.getPadPainter(),s=r?r.getRootPad(!0):null;if("x"==e||"y"==e||"z"==e||"x2"==e||"y2"==e){let r=i||this[e+"axis"];if(t.add("header: "+e.toUpperCase()+" axis"),t.add("Unzoom",(()=>this.unzoom(e))),s&&(t.add("sub:SetLog "+e[0]),t.addchk(0==s["fLog"+e[0]],"linear",(()=>this.changeAxisLog(e[0],0))),t.addchk(1==s["fLog"+e[0]],"log",(()=>this.changeAxisLog(e[0],1))),t.addchk(2==s["fLog"+e[0]],"log2",(()=>this.changeAxisLog(e[0],2))),t.add("endsub:")),t.addchk(r.TestBit(Py.kMoreLogLabels),"More log",(()=>{r.InvertBit(Py.kMoreLogLabels),this.redrawPad()})),t.addchk(r.TestBit(Py.kNoExponent),"No exponent",(()=>{r.InvertBit(Py.kNoExponent),this.redrawPad()})),"z"===e&&n&&n.options&&n.options.Zscale&&"function"==typeof n.fillPaletteMenu&&n.fillPaletteMenu(t),r){let i=this[e+"_handle"];i&&"labels"==i.kind&&r.fNbins>20&&t.add("Find label",(()=>t.input("Label id").then((t=>{if(t)for(let n=0;n<r.fNbins;++n){if(i.formatLabels(n)==t)return this.zoom(e,Math.max(0,n-4),Math.min(r.fNbins,n+5))}})))),t.addTAxisMenu(Py,n||this,r,e)}return!0}const a=0==t.size();return a?t.add("header:Frame"):t.add("separator"),this.zoom_xmin!==this.zoom_xmax&&t.add("Unzoom X",(()=>this.unzoom("x"))),this.zoom_ymin!==this.zoom_ymax&&t.add("Unzoom Y",(()=>this.unzoom("y"))),this.zoom_zmin!==this.zoom_zmax&&t.add("Unzoom Z",(()=>this.unzoom("z"))),this.zoom_x2min!==this.zoom_x2max&&t.add("Unzoom X2",(()=>this.unzoom("x2"))),this.zoom_y2min!==this.zoom_y2max&&t.add("Unzoom Y2",(()=>this.unzoom("y2"))),t.add("Unzoom all",(()=>this.unzoom("all"))),s&&(t.addchk(s.fLogx,"SetLogx",(()=>this.toggleAxisLog("x"))),t.addchk(s.fLogy,"SetLogy",(()=>this.toggleAxisLog("y"))),n&&"function"==typeof n.getDimension&&n.getDimension()>1&&t.addchk(s.fLogz,"SetLogz",(()=>this.toggleAxisLog("z"))),t.add("separator")),t.addchk(this.isTooltipAllowed(),"Show tooltips",(()=>this.setTooltipAllowed("toggle"))),t.addAttributesMenu(this,a?"":"Frame "),t.add("separator"),t.add("Save as frame.png",(()=>r.saveAs("png","frame","frame.png"))),t.add("Save as frame.svg",(()=>r.saveAs("svg","frame","frame.svg"))),!0}fillWebObjectOptions(t){if(!t){if(!this.snapid)return null;t={_typename:"TWebObjectOptions",snapid:this.snapid.toString(),opt:this.getDrawOpt(),fcust:"",fopt:[]}}return t.fcust="frame",t.fopt=[this.scale_xmin||0,this.scale_ymin||0,this.scale_xmax||0,this.scale_ymax||0],t}getFrameWidth(){return this._frame_width||0}getFrameHeight(){return this._frame_height||0}getFrameRect(){return{x:this._frame_x||0,y:this._frame_y||0,width:this.getFrameWidth(),height:this.getFrameHeight(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}}configureUserClickHandler(t){this._click_handler=t&&"function"==typeof t?t:null}configureUserDblclickHandler(t){this._dblclick_handler=t&&"function"==typeof t?t:null}zoom(t,e,i,n,r,s){if(this.projection)return Promise.resolve(!1);"x"===t?(t=e,e=i,i=void 0):"y"===t?(n=i,i=e,t=e=void 0):"z"===t&&(r=e,s=i,t=e=i=void 0);let a=t!==e,o=i!==n,l=r!==s,h=!1,c=!1,d=!1;if(a){let i=0;t<=this.xmin&&(t=this.xmin,i++),e>=this.xmax&&(e=this.xmax,i++),2===i&&(a=!1,h=!0)}else h=t===e&&0===t;if(o){let t=0;i<=this.ymin&&(i=this.ymin,t++),n>=this.ymax&&(n=this.ymax,t++),2===t&&(o=!1,c=!0)}else c=i===n&&0===i;if(l){let t=0;r<=this.zmin&&(r=this.zmin,t++),s>=this.zmax&&(s=this.zmax,t++),2===t&&(l=!1,d=!0)}else d=r===s&&0===r;let u=!1;if((a||o||l)&&this.forEachPainter((h=>{"function"==typeof h.canZoomInside&&(a&&h.canZoomInside("x",t,e)&&(this.zoom_xmin=t,this.zoom_xmax=e,u=!0,a=!1),o&&h.canZoomInside("y",i,n)&&(this.zoom_ymin=i,this.zoom_ymax=n,u=!0,o=!1),l&&h.canZoomInside("z",r,s)&&(this.zoom_zmin=r,this.zoom_zmax=s,u=!0,l=!1))})),(h||c||d)&&(h&&(this.zoom_xmin!==this.zoom_xmax&&(u=!0),this.zoom_xmin=this.zoom_xmax=0),c&&(this.zoom_ymin!==this.zoom_ymax&&(u=!0),this.zoom_ymin=this.zoom_ymax=0),d&&(this.zoom_zmin!==this.zoom_zmax&&(u=!0),this.zoom_zmin=this.zoom_zmax=0),!u)){let t=this.getPadPainter();t&&t.painters&&t.painters.forEach((t=>{t&&"function"==typeof t.unzoomUserRange&&t.unzoomUserRange(h,c,d)&&(u=!0)}))}return u?this.interactiveRedraw("pad","zoom").then((()=>!0)):Promise.resolve(!1)}zoomSingle(t,e,i){if(this.projection||!this[t+"_handle"])return Promise.resolve(!1);let n=e!==i,r=!1;if(n){let s=0;e<=this[t+"min"]&&(e=this[t+"min"],s++),i>=this[t+"max"]&&(i=this[t+"max"],s++),2===s&&(n=!1,r=!0)}else r=e===i&&0===e;let s=!1;return n&&this.forEachPainter((r=>{"function"==typeof r.canZoomInside&&n&&r.canZoomInside(t[0],e,i)&&(this["zoom_"+t+"min"]=e,this["zoom_"+t+"max"]=i,s=!0,n=!1)})),r&&(this["zoom_"+t+"min"]!==this["zoom_"+t+"max"]&&(s=!0),this["zoom_"+t+"min"]=this["zoom_"+t+"max"]=0),s?this.interactiveRedraw("pad","zoom").then((()=>!0)):Promise.resolve(!1)}isAxisZoomed(t){return this["zoom_"+t+"min"]!==this["zoom_"+t+"max"]}unzoom(t,e,i){return"all"==t?this.unzoom("x2").then((()=>this.unzoom("y2"))).then((()=>this.unzoom("xyz"))):"x2"==t||"y2"==t?this.zoomSingle(t,0,0).then((e=>(e&&this.zoomChangedInteractive(t,"unzoom"),e))):(void 0===t?t=e=i=!0:"string"==typeof t&&(i=t.indexOf("z")>=0,e=t.indexOf("y")>=0,t=t.indexOf("x")>=0),this.zoom(t?0:void 0,t?0:void 0,e?0:void 0,e?0:void 0,i?0:void 0,i?0:void 0).then((n=>(n&&t&&this.zoomChangedInteractive("x","unzoom"),n&&e&&this.zoomChangedInteractive("y","unzoom"),n&&i&&this.zoomChangedInteractive("z","unzoom"),n))))}zoomChangedInteractive(t,e){if("reset"==t)return void(this.zoom_changed_x=this.zoom_changed_y=this.zoom_changed_z=void 0);if(!t||"any"==t)return this.zoom_changed_x||this.zoom_changed_y||this.zoom_changed_z;if("x"!==t&&"y"!==t&&"z"!==t)return;let i="zoom_changed_"+t;if(void 0===e)return this[i];"unzoom"!==e?e&&(this[i]=!0):this[i]?delete this[i]:this[i]=!0}revertAxis(t,e){let i=this[t+"_handle"];return i?i.revertPoint(e):0}showAxisStatus(t,e){let i=this.getAxis(t),n=t,r="TAxis",s=qi(e,this.getFrameSvg().node()),a="x"==t?0:1;i&&(n=i.fName,r=i.fTitle||"TAxis object for "+t),this.swap_xy&&(a=1-a);let o=this.revertAxis(t,s[a]);this.showObjectStatus(n,r,t+" : "+this.axisAsText(t,o),s[0]+","+s[1])}addKeysHandler(){l()||(Sv.assign(this),this.addFrameKeysHandler())}addInteractivity(t){return!(l()||!m.Zooming&&!m.ContextMenu)&&(Sv.assign(this),this.addFrameInteractivity(t))}}class Pv extends hl{constructor(t){super(),this.frameid=t,"$batch$"!=t&&(this.setDom(t),this.selectDom().property("mdi",this)),this.cleanupFrame=th,this.active_frame_title=""}setInitFrame(t){this.initFrame=t,this.forEachFrame((e=>t(e)))}beforeCreateFrame(t){this.active_frame_title=t}afterCreateFrame(t){return"function"==typeof this.initFrame&&this.initFrame(t),t}forEachFrame(t,e){console.warn(`forEachFrame not implemented in MDIDisplay ${typeof t} ${e}`)}forEachPainter(t,e){this.forEachFrame((e=>{new Vl(e).forEachPainter((i=>t(i,e)))}),e)}numDraw(){let t=0;return this.forEachFrame((()=>++t)),t}findFrame(t,e){let i=null;return this.forEachFrame((e=>{Ii(e).attr("frame_title")==t&&(i=e)})),!i&&e&&(i=this.createFrame(t)),i}activateFrame(t){this.active_frame_title=Ii(t).attr("frame_title")}getActiveFrame(){return this.findFrame(this.active_frame_title)}checkMDIResize(t,e){let i=null;this.forEachPainter(((n,r)=>{if((!t||Ii(r).attr("id")==t)&&null!==n.getItemName()&&"function"==typeof n.checkResize){if(i===r)return;n.checkResize(e),i=r}}))}cleanup(){this.active_frame_title="",this.forEachFrame(this.cleanupFrame),this.selectDom().html("").property("mdi",null)}}class Ev extends Pv{constructor(t,e,i){super(t),this.framecnt=0,this.getcnt=0,this.groups=[],this.vertical=e&&"v"==e[0],this.use_separarators=!e||e.indexOf("x")<0,this.simple_layout=!1;let n=this.selectDom();if(n.style("overflow","hidden"),"simple"===e)return this.simple_layout=!0,this.use_separarators=!1,void(this.framecnt=1);let r,s,a=2;if(0==e.indexOf("grid")||i){e=i?e+"x"+i:e.slice(4).trim(),this.use_separarators=!1,"i"===e[0]&&(this.use_separarators=!0,e=e.slice(1));let t,n,s=e.indexOf("x");if(s>0?(n=parseInt(e.slice(s+1)),t=parseInt(e.slice(0,s))):t=n=parseInt(e),Number.isInteger(t)||(t=3),Number.isInteger(n)||(n=3),n>1)this.vertical=!0,a=n,t>1&&(r=new Array(a).fill(t));else{if(!(t>1))return this.simple_layout=!0,this.use_separarators=!1,void(this.framecnt=1);this.vertical=!1,a=t}e=""}if(e&&e.indexOf("_")>0){let t=parseInt(e.slice(e.indexOf("_")+1),10);if(Number.isInteger(t)&&t>10)for(e=e.slice(0,e.indexOf("_")),s=[];t>0;)s.unshift(Math.max(t%10,1)),t=Math.round((t-s[0])/10),0===s[0]&&(s[0]=1)}if(e=e?parseInt(e.replace(/^\D+/g,""),10):0,Number.isInteger(e)&&e>1)if(e<10)a=e;else{for(r=[];e>0;)r.unshift(e%10),e=Math.round((e-r[0])/10),0==r[0]&&(r[0]=1);a=r.length}s&&s.length!==a&&(s=void 0),this.simple_layout||(gv('\n.jsroot_vline:after {\n    content:"";\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 50%;\n    border-left: 1px dotted #ff0000;\n}\n.jsroot_hline:after {\n    content:"";\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 50%;\n    border-top: 1px dotted #ff0000;\n}\n.jsroot_separator {\n   pointer-events: all;\n   border: 0;\n   margin: 0;\n   padding: 0;\n}\n',n.node()),this.createGroup(this,n,a,r,s))}createGroup(t,e,i,n,r){r||(r=new Array(i));let s=0,a=0;for(let t=0;t<i;++t)s+=r[t]||1;for(let t=0;t<i;++t)r[t]=Math.round(100*(r[t]||1)/s),a+=r[t],t==i-1&&(r[t]+=100-a);for(let s=0;s<i;++s){let i={id:s,drawid:-1,position:0,size:r[s]};s>0&&(i.position=t.groups[s-1].position+t.groups[s-1].size),i.position0=i.position,(!n||!n[s]||n[s]<2)&&(i.drawid=this.framecnt++),t.groups.push(i);let a=e.append("div").attr("groupid",i.id);t.vertical?a.style("float","bottom").style("height",i.size+"%").style("width","100%"):a.style("float","left").style("width",i.size+"%").style("height","100%"),i.drawid>=0?(a.classed("jsroot_newgrid",!0),"string"==typeof this.frameid&&a.attr("id",this.frameid+"_"+i.drawid)):a.style("display","flex").style("flex-direction",t.vertical?"row":"column"),n&&n[s]>1&&(i.vertical=!t.vertical,i.groups=[],a.style("overflow","hidden"),this.createGroup(i,a,n[s]))}if(this.use_separarators&&this.createSeparator)for(let n=1;n<i;++n)this.createSeparator(t,e,t.groups[n])}handleSeparator(t,e){let i=Ii(t),n=t.parentNode,r=i.property("handle"),s=i.property("separator_id"),a=r.groups[s];const o=t=>{let e=n.firstChild;for(;e;){if(e.getAttribute("groupid")==t)return Ii(e);e=e.nextSibling}return Ii(n).select(`[groupid='${t}']`)},l=t=>{let e=r.vertical?"height":"width",i=r.groups[t].size+"%";o(t).style(e,i).selectAll(".jsroot_separator").style(e,i)},h=t=>{let e=o(t);e.classed("jsroot_newgrid")||(e=e.select(".jsroot_newgrid")),e.each((function(){Kl(this)}))};if("start"==e)return a.startpos=a.position,void(a.acc_drag=0);if("end"==e)return void(Math.abs(a.startpos-a.position)>=.5&&(h(s-1),h(s)));let c;"restore"==e?c=a.position0:r.vertical?(a.acc_drag+=e.dy,c=a.startpos+(a.acc_drag+2)/n.clientHeight*100):(a.acc_drag+=e.dx,c=a.startpos+(a.acc_drag+2)/n.clientWidth*100);let d=a.position-c;Math.abs(d)<.3||Math.min(r.groups[s-1].size-d,a.size+d)<3||(r.groups[s-1].size-=d,a.size+=d,a.position=c,i.style(r.vertical?"top":"left",`calc(${c}% - 2px)`),l(s-1),l(s),"restore"==e&&(h(s-1),h(s)))}createSeparator(t,e,i){let n=e.append("div");n.classed("jsroot_separator",!0).classed(t.vertical?"jsroot_hline":"jsroot_vline",!0).property("handle",t).property("separator_id",i.id).style("position","absolute").style(t.vertical?"top":"left",`calc(${i.position}% - 2px)`).style(t.vertical?"width":"height",(t.size||100)+"%").style(t.vertical?"height":"width","5px").style("cursor",t.vertical?"ns-resize":"ew-resize");let r=this,s=Ki().on("start",(function(){r.handleSeparator(this,"start")})).on("drag",(function(t){r.handleSeparator(this,t)})).on("end",(function(){r.handleSeparator(this,"end")}));n.call(s).on("dblclick",(function(){r.handleSeparator(this,"restore")})),d.touches&&!e.on("touchmove")&&e.on("touchmove",(function(){}))}forEachFrame(t){this.simple_layout?t(this.getGridFrame()):this.selectDom().selectAll(".jsroot_newgrid").each((function(){t(this)}))}getActiveFrame(){if(this.simple_layout)return this.getGridFrame();let t=super.getActiveFrame();return t||(this.forEachFrame((e=>{t||(t=e)})),t)}numGridFrames(){return this.framecnt}getGridFrame(t){if(this.simple_layout)return this.selectDom("origin").node();let e=null;return this.selectDom().selectAll(".jsroot_newgrid").each((function(){0==t--&&(e=this)})),e}createFrame(t){this.beforeCreateFrame(t);let e=null,i=this.framecnt||2;for(;!e&&i--;)e=this.getGridFrame(this.getcnt),!this.simple_layout&&this.framecnt&&(this.getcnt=(this.getcnt+1)%this.framecnt),Ii(e).classed("jsroot_fixed_frame")&&(e=null);return e&&(this.cleanupFrame(e),Ii(e).attr("frame_title",t)),this.afterCreateFrame(e)}}class kv extends Pv{constructor(t){super(t),this.cnt=0,this.selectDom().on("contextmenu",(t=>this.showContextMenu(t))).style("overflow","auto")}cleanup(){this.selectDom().style("overflow",null).on("contextmenu",null),this.cnt=0,super.cleanup()}forEachFrame(t,e){if("function"!=typeof t)return;let i=this;this.selectDom().select(".jsroot_flex_top").selectAll(".jsroot_flex_draw").each((function(){e&&"min"==i.getFrameState(this)||t(this)}))}getActiveFrame(){let t=super.getActiveFrame();return t&&"min"!=Ii(t.parentNode).property("state")||(t=null,this.forEachFrame((e=>{t=e}),!0)),t}activateFrame(t){if("first"===t||"last"===t){let e=null;this.forEachFrame((i=>{"last"!=t&&e||(e=i)}),!0),t=e}if(!t)return;if("jsroot_flex_draw"!=t.getAttribute("class"))return;if(this.getActiveFrame()===t)return;super.activateFrame(t);let e=t.parentNode;e.parentNode.append(e),"min"!=this.getFrameState(t)&&(Ql({pp:$l(t),active:!0}),Kl(t))}getFrameState(t){return Ii(t.parentNode).property("state")}getFrameRect(t){if("max"==this.getFrameState(t)){let t=this.selectDom().select(".jsroot_flex_top");return{x:0,y:0,w:t.node().clientWidth,h:t.node().clientHeight}}let e=Ii(t.parentNode),i=e.style("left"),n=e.style("top");return{x:parseInt(i.slice(0,i.length-2)),y:parseInt(n.slice(0,n.length-2)),w:e.node().clientWidth,h:e.node().clientHeight}}changeFrameState(t,e,i){let n=Ii(t.parentNode),r=n.property("state"),s=this.selectDom().select(".jsroot_flex_top");if(r==e)return!1;switch("normal"==r&&n.property("original_style",n.attr("style")),s.style("overflow",null),e){case"min":n.style("height","auto").style("width","auto"),n.select(".jsroot_flex_draw").style("display","none");break;case"max":n.style("height","100%").style("width","100%").style("left","").style("top",""),n.select(".jsroot_flex_draw").style("display",null),s.style("overflow","hidden");break;default:n.select(".jsroot_flex_draw").style("display",null),n.attr("style",n.property("original_style"))}if(n.select(".jsroot_flex_header").selectAll("button").each((function(t){let i=Ii(this);"minimize"==t.t&&"min"==e||"maximize"==t.t&&"max"==e?i.html("&#x259E;").attr("title","restore"):i.html(t.n).attr("title",t.t)})),n.property("state",e),n.select(".jsroot_flex_resize").style("display","normal"==e?null:"none"),"min"==e){const e=this.getFrameRect(t),i=this.selectDom().select(".jsroot_flex_top"),r=i.node().clientWidth,s=i.node().clientHeight,a=[],o=4,l=(t,e)=>t.x<=e.x&&t.x+t.w>=e.x||e.x<=t.x&&e.x+e.w>=t.x,h=(t,e)=>t.y<=e.y&&t.y+t.h>=e.y||e.y<=t.y&&e.y+e.h>=t.y;this.forEachFrame((e=>{e!==t&&"min"==this.getFrameState(e)&&a.push(this.getFrameRect(e))})),e.y=s;do{e.x=o,e.y-=e.h+o;let t=o,i=!1;a.forEach((n=>{h(n,e)&&(t=Math.max(t,n.x+n.w+o),l(n,e)&&(i=!0))})),i&&(e.x=t)}while(e.x+e.w>r-o&&e.y>0);e.y<0&&(e.x=o,e.y=s-e.h-o),n.style("left",e.x+"px").style("top",e.y+"px")}else i||Kl(t);return!0}_clickButton(t){let e=Ii(t).datum(),i=Ii(t.parentNode.parentNode),n=i.select(".jsroot_flex_draw").node();if("close"==e.t)return this.cleanupFrame(n),i.remove(),void this.activateFrame("last");let r,s=i.property("state");r="maximize"==e.t?"max"==s?"normal":"max":"min"==s?"normal":"min",this.changeFrameState(n,r)&&this.activateFrame("min"!=r?n:"last")}createFrame(t){this.beforeCreateFrame(t);let e=this,i=this.selectDom(),n=i.select(".jsroot_flex_top");0==this.cnt&&gv("\n.jsroot_flex_top {\n   overflow: auto;\n   position: relative;\n   height: 100%;\n   width: 100%;\n}\n\n.jsroot_flex_btn {\n   float: right;\n   padding: 0;\n   width: 1.4em;\n   text-align: center;\n   font-size: 10px;\n   margin-top: 2px;\n   margin-right: 4px;\n}\n\n.jsroot_flex_header {\n   height: 23px;\n   overflow: hidden;\n   background-color: lightblue;\n}\n\n.jsroot_flex_header p {\n   margin: 1px;\n   float: left;\n   font-size: 14px;\n   padding-left: 5px;\n}\n\n.jsroot_flex_draw {\n   overflow: hidden;\n   width: 100%;\n   height: calc(100% - 24px);\n}\n\n.jsroot_flex_frame {\n   border: 1px solid black;\n   box-shadow: 1px 1px 2px 2px #aaa;\n   background: white;\n}\n\n.jsroot_flex_resize {\n   position: absolute;\n   right: 2px;\n   bottom: 2px;\n   overflow: hidden;\n   cursor: nwse-resize;\n}\n\n.jsroot_flex_resizable_helper {\n   border: 2px dotted #00F;\n}",i.node()),n.empty()&&(n=i.append("div").classed("jsroot_flex_top",!0));let r=n.node().clientWidth,s=n.node().clientHeight,a=n.append("div");a.html(`<div class="jsroot_flex_header"><p>${t}</p></div>\n                 <div id="${this.frameid}_cont${this.cnt}" class="jsroot_flex_draw"></div>\n                 <div class="jsroot_flex_resize">&#x25FF;</div>`),a.attr("class","jsroot_flex_frame").style("position","absolute").style("left",Math.round(r*(this.cnt%5)/10)+"px").style("top",Math.round(s*(this.cnt%5)/10)+"px").style("width",Math.round(.58*r)+"px").style("height",Math.round(.58*s)+"px").property("state","normal").select(".jsroot_flex_header").on("click",(function(){e.activateFrame(Ii(this.parentNode).select(".jsroot_flex_draw").node())})).selectAll("button").data([{n:"&#x2715;",t:"close"},{n:"&#x2594;",t:"maximize"},{n:"&#x2581;",t:"minimize"}]).enter().append("button").attr("type","button").attr("class","jsroot_flex_btn").attr("title",(t=>t.t)).html((t=>t.n)).on("click",(function(){e._clickButton(this)}));let o=null,l=null,h=!1,c=Ki().subject(Object),d=[];c.on("start",(function(t){if("button"==t.sourceEvent.target.type)return e._clickButton(t.sourceEvent.target);if(mv(t.sourceEvent))return;let i=Ii(this.parentNode);i.classed("jsroot_flex_frame")&&"max"!=i.property("state")&&(h=!Ii(this).classed("jsroot_flex_resize"),(h||"min"!=i.property("state"))&&(e.activateFrame(i.select(".jsroot_flex_draw").node()),l=n.append("div").classed("jsroot_flex_resizable_helper",!0),l.attr("style",i.attr("style")),"min"==i.property("state")&&l.style("width",i.node().clientWidth+"px").style("height",i.node().clientHeight+"px"),t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation(),o=i,d=[]))})).on("drag",(function(t){if(!l)return;t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation();let e=(t,e,i)=>{if(t>=d.length){let i=l.style(e);d[t]=parseInt(i.slice(0,i.length-2))}d[t]+=i,l.style(e,Math.max(0,d[t])+"px")};h?(e(0,"left",t.dx),e(1,"top",t.dy)):(e(0,"width",t.dx),e(1,"height",t.dy))})).on("end",(function(t){l&&(t.sourceEvent.preventDefault(),t.sourceEvent.stopPropagation(),h?(o.style("left",l.style("left")),o.style("top",l.style("top"))):(o.style("width",l.style("width")),o.style("height",l.style("height"))),l.remove(),l=null,h||Kl(o.select(".jsroot_flex_draw").node()))})),a.select(".jsroot_flex_header").call(c),a.select(".jsroot_flex_resize").call(c);let u=a.select(".jsroot_flex_draw").attr("frame_title",t).property("frame_cnt",this.cnt++).node();return this.afterCreateFrame(u)}minimizeAll(){this.forEachFrame((t=>this.changeFrameState(t,"min")))}closeAllFrames(){let t=[];this.forEachFrame((e=>t.push(e))),t.forEach((t=>{this.cleanupFrame(t),Ii(t.parentNode).remove()}))}sortFrames(t){let e=[];if(this.forEachFrame((t=>{let i=this.getFrameState(t);"min"!=i&&("max"==i&&this.changeFrameState(t,"normal",!0),e.push(t))})),0==e.length)return;let i=this.selectDom(),n=i.node().clientWidth,r=i.node().clientHeight,s=Math.min(40,Math.round(.4*n/e.length)),a=Math.min(40,Math.round(.4*r/e.length)),o=Math.ceil(Math.sqrt(e.length)),l=o;o>1&&o*(o-1)>=e.length&&(n>r?l--:o--),e.forEach(((e,i)=>{let h=Ii(e.parentNode);"cascade"==t?h.style("left",i*s+"px").style("top",i*a+"px").style("width",Math.round(.58*n)+"px").style("height",Math.round(.58*r)+"px"):h.style("left",Math.round(n/o*(i%o))+"px").style("top",Math.round(r/l*((i-i%o)/o))+"px").style("width",Math.round(n/o-4)+"px").style("height",Math.round(r/l-4)+"px"),Kl(e)}))}showContextMenu(t){if("jsroot_flex_top"!=t.target.getAttribute("class")||0==this.numDraw())return;t.preventDefault();let e=[];this.forEachFrame((t=>e.push(t)));let i=this.getActiveFrame();e.sort(((t,e)=>Ii(t).property("frame_cnt")<Ii(e).property("frame_cnt")?-1:1)),vv(t,this).then((t=>{t.add("header:Flex"),t.add("Cascade",(()=>this.sortFrames("cascade"))),t.add("Tile",(()=>this.sortFrames("tile"))),t.add("Minimize all",(()=>this.minimizeAll())),t.add("Close all",(()=>this.closeAllFrames())),t.add("separator"),e.forEach(((n,r)=>t.addchk(n===i,("min"==this.getFrameState(n)?"[min] ":"")+Ii(n).attr("frame_title"),r,(t=>{let i=e[t];"min"==this.getFrameState(i)&&this.changeFrameState(i,"normal"),this.activateFrame(i)})))),t.show()}))}}class Dv extends Pv{constructor(t,e,i){super("$batch$"),this.frames=[],this.width=t||1200,this.height=e||800,this.jsdom_body=i||Ii("body")}forEachFrame(t){this.frames.forEach(t)}createFrame(t){this.beforeCreateFrame(t);let e=this.jsdom_body.append("div").style("visible","hidden").attr("width",this.width).attr("height",this.height).style("width",this.width+"px").style("height",this.height+"px").attr("id","jsroot_batch_"+this.frames.length).attr("frame_title",t);return 0==this.frames.length&&(s.svg_3ds=void 0),this.frames.push(e.node()),this.afterCreateFrame(e.node())}numFrames(){return this.frames.length}makeJSON(t,e){let i=this.frames[t];if(!i)return;let n=Ii(i).property("_json_object_");return n?(Ii(i).property("_json_object_",null),T(n,e)):void 0}makeSVG(t){let e=this.frames[t];if(!e)return;let i=Ii(e),n=s.svg_3ds&&s.processSvgWorkarounds;i.select("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("width",this.width).attr("height",this.height).attr("title",null).attr("style",null).attr("class",null).attr("x",null).attr("y",null);let r=i.html();return n&&(r=s.processSvgWorkarounds(r,t!=this.frames.length-1)),r=ll(r),i.remove(),r}}class zv{constructor(t,e,i){this.gui_div=t,this.hpainter=e,this.objpainter=i,this.browser_kind=null}main(){return Ii("#"+this.gui_div)}drawing_divid(){return this.gui_div+"_drawing"}checkResize(){this.hpainter&&"function"==typeof this.hpainter.checkResize?this.hpainter.checkResize():this.objpainter&&"function"==typeof this.objpainter.checkResize&&this.objpainter.checkResize(!0)}create(t){let e=this.main();e.append("div").attr("id",this.drawing_divid()).classed("jsroot_draw_area",!0).style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0),t&&e.append("div").classed("jsroot_browser",!0),gv("\n.jsroot_browser {\n   pointer-events: none;\n   position: absolute;\n   left: 0;\n   top: 0;\n   bottom: 0;\n   right:0;\n   margin: 0;\n   border: 0;\n   overflow: hidden;\n}\n.jsroot_draw_area {\n   background-color: #E6E6FA;\n   overflow: hidden;\n   margin: 0;\n   border: 0;\n}\n.jsroot_browser_title {\n   font-family: Verdana;\n   font-size: 20px;\n}\n.jsroot_browser_btns {\n   pointer-events: all;\n   opacity: 0;\n   display:flex;\n   flex-direction: column;\n}\n.jsroot_browser_btns:hover {\n   opacity: 0.3;\n}\n.jsroot_browser_area {\n   background-color: #E6E6FA;\n   font-size: 12px;\n   font-family: Verdana;\n   pointer-events: all;\n   box-sizing: initial;\n}\n.jsroot_browser_area p {\n   margin-top: 5px;\n   margin-bottom: 5px;\n   white-space: nowrap;\n}\n.jsroot_browser_hierarchy {\n   flex: 1;\n   margin-top: 2px;\n}\n.jsroot_status_area {\n   background-color: #E6E6FA;\n   overflow: hidden;\n   font-size: 12px;\n   font-family: Verdana;\n   pointer-events: all;\n}\n.jsroot_float_browser {\n   border: solid 3px white;\n}\n.jsroot_browser_resize {\n   position: absolute;\n   right: 3px;\n   bottom: 3px;\n   margin-bottom: 0px;\n   margin-right: 0px;\n   opacity: 0.5;\n   cursor: se-resize;\n}\n.jsroot_separator {\n   pointer-events: all;\n   border: 0;\n   margin: 0;\n   padding: 0;\n}\n.jsroot_h_separator {\n   cursor: ns-resize;\n   background-color: azure;\n}\n.jsroot_v_separator {\n   cursor: ew-resize;\n   background-color: azure;\n}\n.jsroot_status_label {\n   margin: 3px;\n   margin-left: 5px;\n   font-size: 14px;\n   vertical-align: middle;\n   white-space: nowrap;\n}\n",e.node())}createBrowserBtns(){let t=this.main().select(".jsroot_browser");if(t.empty())return;let e=t.append("div").classed("jsroot_browser_btns",!0).classed("jsroot",!0);return e.style("position","absolute").style("left","7px").style("top","7px"),d.touches&&e.style("opacity","0.2"),e}removeBrowserBtns(){this.main().select(".jsroot_browser").select(".jsroot_browser_btns").remove()}setBrowserContent(t){let e=Ii("#"+this.gui_div+" .jsroot_browser");e.empty()||e.insert("div",".jsroot_browser_btns").classed("jsroot_browser_area",!0).style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("width","250px").style("overflow","hidden").style("padding-left","5px").style("display","flex").style("flex-direction","column").html("<p class='jsroot_browser_title'>title</p><div class='jsroot_browser_resize' style='display:none'>&#9727</div>"+t)}hasContent(){let t=Ii("#"+this.gui_div+" .jsroot_browser");return!t.empty()&&!t.select(".jsroot_browser_area").empty()}deleteContent(){let t=Ii("#"+this.gui_div+" .jsroot_browser");t.empty()||(this.createStatusLine(0,"delete"),this.toggleBrowserVisisbility(!0),t.selectAll("*").remove(),delete this.browser_visible,delete this.browser_kind,this.checkResize())}hasStatus(){return!Ii("#"+this.gui_div+" .jsroot_browser").empty()&&!Ii("#"+(this.gui_div+"_status")).empty()}setBrowserTitle(t){let e=Ii("#"+this.gui_div+" .jsroot_browser");e.empty()||e.select(".jsroot_browser_title").text(t).style("cursor","flex"==this.browser_kind?"move":null)}toggleKind(t){"changing"!==this.browser_visible&&(t===this.browser_kind?this.toggleBrowserVisisbility():this.toggleBrowserKind(t))}createStatusLine(t,e){let i=Ii("#"+this.gui_div+" .jsroot_browser");if(i.empty())return Promise.resolve("");let n=this.gui_div+"_status",r=Ii("#"+n),a=!r.empty();if("toggle"===e?e=!a:"delete"===e?(e=!1,t=0,delete this.status_layout):void 0===e&&(e=!0,this.status_layout="app"),a){if(!0===e)return Promise.resolve(n);return i.select(".jsroot_h_separator").remove(),r.remove(),"app"!==this.status_layout&&delete this.status_layout,this.status_handler&&s.showStatus===this.status_handler&&(delete s.showStatus,delete this.status_handler),this.adjustSeparators(null,0,!0),Promise.resolve("")}if(!1===e)return Promise.resolve("");let o=Ii("#"+this.gui_div+"_drawing").style("left");i.insert("div",".jsroot_browser_area").attr("id",n).classed("jsroot_status_area",!0).style("position","absolute").style("left",o).style("height","20px").style("bottom",0).style("right",0).style("margin",0).style("border",0);let l=i.insert("div",".jsroot_browser_area").classed("jsroot_separator",!0).classed("jsroot_h_separator",!0).style("position","absolute").style("left",o).style("right",0).style("bottom","20px").style("height","5px"),h=Ki().on("start",(()=>{this._hsepar_move=this._hsepar_position,l.style("background-color","grey")})).on("drag",(t=>{this._hsepar_move-=t.dy,this.adjustSeparators(null,Math.max(5,Math.round(this._hsepar_move)))})).on("end",(()=>{delete this._hsepar_move,l.style("background-color",null),this.checkResize()}));if(l.call(h),d.touches&&!i.on("touchmove")&&i.on("touchmove",(function(){})),t&&"string"!=typeof t||(t=this.last_hsepar_height||20),this.adjustSeparators(null,t,!0),"app"==this.status_layout)return Promise.resolve(n);this.status_layout=new Ev(n,"horizx4_1213");let c=["object name","object title","mouse coordinates","object info"];for(let t=0;t<4;++t)Ii(this.status_layout.getGridFrame(t)).attr("title",c[t]).style("overflow","hidden").append("label").attr("class","jsroot_status_label");return s.showStatus=this.status_handler=this.showStatus.bind(this),Promise.resolve(n)}adjustSeparators(t,e,i,n){if(!this.gui_div)return;let r=Ii("#"+this.gui_div+" .jsroot_browser");if(null===e&&n&&!r.select(".jsroot_h_separator").empty()&&(e="string"==typeof(e=r.select(".jsroot_h_separator").style("bottom"))&&e.length>2&&e.indexOf("px")==e.length-2?e.slice(0,e.length-2):null),null!==e){e=parseInt(e);let t=r.select(".jsroot_h_separator"),i=0;if(!t.empty()){e<5&&(e=5);let n=r.node().clientHeight-5;n>0&&(e<0&&(e+=n),e>n&&(e=n)),this.last_hsepar_height=e,t.style("bottom",e+"px").style("height","5px"),Ii("#"+this.gui_div+"_status").style("height",e+"px"),i=e+5+"px"}this._hsepar_position=e,Ii("#"+this.gui_div+"_drawing").style("bottom",i)}null!==t&&((t=parseInt(t))<50&&(t=50),this._vsepar_position=t,r.select(".jsroot_browser_area").style("width",t-5+"px"),Ii("#"+this.gui_div+"_drawing").style("left",t+5+"px"),r.select(".jsroot_h_separator").style("left",t+5+"px"),Ii("#"+this.gui_div+"_status").style("left",t+5+"px"),r.select(".jsroot_v_separator").style("left",t+"px").style("width","5px")),i&&this.checkResize()}showStatus(){if(!this.status_layout)return;let t=0;for(let e=0;e<4;++e){let i=this.status_layout.getGridFrame(e).querySelector("label");t=Math.max(t,i.clientHeight),i.innerHTML=arguments[e]||""}this.status_layout.first_check||(this.status_layout.first_check=!0,t>5&&(t>this.last_hsepar_height||t<this.last_hsepar_height+5)&&this.adjustSeparators(null,t,!0))}toggleBrowserVisisbility(t){if(!this.gui_div||"string"==typeof this.browser_visible)return;let e=Ii("#"+this.gui_div+" .jsroot_browser"),i=e.select(".jsroot_browser_area");if(i.empty())return;let n=e.select(".jsroot_v_separator"),r=Ii("#"+this.gui_div+"_drawing"),s=i.property("last_left"),a=i.property("last_vsepar"),o=i.property("last_drawing");if(this.browser_visible){i.property("last_left",i.style("left")),n.empty()||(i.property("last_vsepar",n.style("left")),i.property("last_drawing",r.style("left"))),s=-i.node().clientWidth-10+"px";let t=e.node().clientWidth;n.empty()&&i.node().offsetLeft>t/2&&(s=t+10+"px"),a="-10px",o="0px"}else{if(t)return;i.property("last_left",null).property("last_vsepar",null).property("last_drawing",null)}let l=!this.browser_visible,h=t?0:700;this.browser_visible="changing",i.transition().style("left",s).duration(h).on("end",(()=>{t||(this.browser_visible=l,l&&this.setButtonsPosition())})),l||e.select(".jsroot_browser_btns").transition().style("left","7px").style("top","7px").duration(h),n.empty()||(n.transition().style("left",a).duration(h),r.transition().style("left",o).duration(h).on("end",this.checkResize.bind(this))),this.status_layout&&"fix"==this.browser_kind&&(e.select(".jsroot_h_separator").transition().style("left",o).duration(h),e.select(".jsroot_status_area").transition().style("left",o).duration(h))}adjustBrowserSize(t){if(!this.gui_div||"float"!==this.browser_kind)return;let e=Ii("#"+this.gui_div+" .jsroot_browser");if(e.empty())return;let i=e.select(".jsroot_browser_area"),n=e.select(".jsroot_browser_hierarchy"),r=Ii(n.node().firstChild);if(t)return void(i.node().parentNode.clientHeight-10<i.node().clientHeight&&i.style("bottom","0px").style("top","0px"));if(r.empty())return;let s=n.node().clientHeight,a=r.node().clientHeight;void 0!==a&&a<.7*s&&i.style("bottom","")}setButtonsPosition(){if(!this.gui_div)return;let t=Ii("#"+this.gui_div+" .jsroot_browser"),e=t.select(".jsroot_browser_btns"),i=7,n=7;if(!e.empty()){if(this.browser_visible){let e=t.select(".jsroot_browser_area");i=e.node().offsetTop+7,n=e.node().offsetLeft-t.node().offsetLeft+e.node().clientWidth-27}e.style("left",n+"px").style("top",i+"px")}}toggleBrowserKind(t){if(!this.gui_div)return Promise.resolve(null);if(!t){if(!this.browser_kind)return Promise.resolve(null);t="float"===this.browser_kind?"fix":"float"}let e=Ii("#"+this.gui_div+" .jsroot_browser"),i=e.select(".jsroot_browser_area");if("float"===this.browser_kind?i.style("bottom","0px").style("top","0px").style("width","").style("height","").classed("jsroot_float_browser",!1):"fix"===this.browser_kind&&(e.select(".jsroot_v_separator").remove(),i.style("left","0px"),Ii("#"+this.gui_div+"_drawing").style("left","0px"),e.select(".jsroot_h_separator").style("left","0px"),Ii("#"+this.gui_div+"_status").style("left","0px"),this.checkResize()),this.browser_kind=t,this.browser_visible=!0,e.select(".jsroot_browser_resize").style("display","float"===t?null:"none"),e.select(".jsroot_browser_title").style("cursor","float"===t?"move":null),"float"===t){i.style("bottom","40px").classed("jsroot_float_browser",!0);let t=Ki().on("start",(()=>{let t=i.style("left"),n=i.style("top");this._float_left=parseInt(t.slice(0,t.length-2)),this._float_top=parseInt(n.slice(0,n.length-2)),this._max_left=e.node().clientWidth-i.node().offsetWidth-1,this._max_top=e.node().clientHeight-i.node().offsetHeight-1})).filter((t=>e.select(".jsroot_browser_title").node()===t.target)).on("drag",(t=>{this._float_left+=t.dx,this._float_top+=t.dy,i.style("left",Math.min(Math.max(0,this._float_left),this._max_left)+"px").style("top",Math.min(Math.max(0,this._float_top),this._max_top)+"px"),this.setButtonsPosition()})),n=Ki().on("start",(()=>{let t=i.style("width");this._float_width=parseInt(t.slice(0,t.length-2)),this._float_height=i.node().clientHeight,this._max_width=e.node().clientWidth-i.node().offsetLeft-1,this._max_height=e.node().clientHeight-i.node().offsetTop-1})).on("drag",(t=>{this._float_width+=t.dx,this._float_height+=t.dy,i.style("width",Math.min(Math.max(100,this._float_width),this._max_width)+"px").style("height",Math.min(Math.max(100,this._float_height),this._max_height)+"px"),this.setButtonsPosition()}));e.call(t),e.select(".jsroot_browser_resize").call(n),this.adjustBrowserSize()}else{i.style("left",0).style("top",0).style("bottom",0).style("height",null);let t=e.append("div").classed("jsroot_separator",!0).classed("jsroot_v_separator",!0).style("position","absolute").style("top",0).style("bottom",0),n=Ki().on("start",(()=>{this._vsepar_move=this._vsepar_position,t.style("background-color","grey")})).on("drag",(t=>{this._vsepar_move+=t.dx,this.setButtonsPosition(),this.adjustSeparators(Math.round(this._vsepar_move),null)})).on("end",(()=>{delete this._vsepar_move,t.style("background-color",null),this.checkResize()}));t.call(n),d.touches&&!e.on("touchmove")&&e.on("touchmove",(function(){})),this.adjustSeparators(250,null,!0,!0)}return this.setButtonsPosition(),Promise.resolve(this)}}function Ov(t,e){return Math.round((e||1)*(t.iscan||!t.has_canvas?16:12))}function Rv(t,e){let i=t.getLayerSvg("btns_layer",t.this_pad_name),n=i.select("[name='Toggle']");if(n.empty())return;let r=n.property("buttons_state");n.property("timout_handler")&&("timeout"!==e&&clearTimeout(n.property("timout_handler")),n.property("timout_handler",null));let s=!1;switch(e){case"enable":s=!0;break;case"enterbtn":return;case"timeout":s=!1;break;case"toggle":r=!r,n.property("buttons_state",r),s=r;break;case"disable":case"leavebtn":return void(r||n.property("timout_handler",setTimeout((()=>Rv(t,"timeout")),1200)))}i.selectAll("svg").each((function(){this!==n.node()&&Ii(this).style("display",s?"":"none")}))}let Lv={alignButtons(t,e,i){let n,r,s=Ov(this,1.25),a=(t.property("nextx")||0)+s;t.property("vertical")?(n=t.property("leftside")?2:e-s,r=i-a):(n=t.property("leftside")?2:e-a,r=i-s),t.attr("transform","translate("+n+","+r+")")},findPadButton(t){let e=this.getLayerSvg("btns_layer",this.this_pad_name),i="";return e.empty()||e.selectAll("svg").each((function(){Ii(this).attr("key")===t&&(i=Ii(this).attr("name"))})),i},removePadButtons(){let t=this.getLayerSvg("btns_layer",this.this_pad_name);t.empty()||(t.selectAll("*").remove(),t.property("nextx",null))},showPadButtons(){let t=this.getLayerSvg("btns_layer",this.this_pad_name);if(t.empty())return;if(t.selectAll("*").remove(),!this._buttons)return;let e,i=this.iscan||!this.has_canvas,n=t.property("leftside")?Ov(this,1.25):0;if(this._fast_drawing)e=uv.createSVG(t,uv.circle,Ov(this),"enlargePad"),e.attr("name","Enlarge").attr("x",0).attr("y",0).on("click",(t=>this.clickPadButton("enlargePad",t)));else{e=uv.createSVG(t,uv.rect,Ov(this),"Toggle tool buttons"),e.attr("name","Toggle").attr("x",0).attr("y",0).property("buttons_state","popup"!==m.ToolBar).on("click",(()=>Rv(this,"toggle"))).on("mouseenter",(()=>Rv(this,"enable"))).on("mouseleave",(()=>Rv(this,"disable")));for(let r=0;r<this._buttons.length;++r){let s=this._buttons[r],a=s.btn;"string"==typeof a&&(a=uv[a]),a||(a=uv.circle);let o=uv.createSVG(t,a,Ov(this),s.tooltip+(i?"":" on pad "+this.this_pad_name)+(s.keyname?" (keyshortcut "+s.keyname+")":""));t.property("vertical")?o.attr("x",0).attr("y",n):o.attr("x",n).attr("y",0),o.attr("name",s.funcname).style("display",e.property("buttons_state")?"":"none").on("mouseenter",(()=>Rv(this,"enterbtn"))).on("mouseleave",(()=>Rv(this,"leavebtn"))),s.keyname&&o.attr("key",s.keyname),o.on("click",(t=>this.clickPadButton(s.funcname,t))),n+=Ov(this,1.25)}}t.property("nextx",n),this.alignButtons(t,this.getPadWidth(),this.getPadHeight()),t.property("vertical")?e.attr("y",n):t.property("leftside")||e.attr("x",n)},assign(t){Object.assign(t,this)}};const Bv=1,Nv=2,Fv=3,Iv=4,jv=5;class qv extends Vl{constructor(t,e,i){if(super(t,e),this.pad=e,this.iscan=i,this.this_pad_name="",!this.iscan&&null!==e&&"fName"in e){this.this_pad_name=e.fName.replace(" ","_"),new RegExp("^[A-Za-z][A-Za-z0-9_]*$").test(this.this_pad_name)||(this.this_pad_name="jsroot_pad_"+s.id_counter++)}this.painters=[],this.has_canvas=!0,this.forEachPainter=this.forEachPainterInPad}isRoot6(){return!0}svg_this_pad(){return this.getPadSvg(this.this_pad_name)}getMainPainter(){return this.main_painter_ref||null}setMainPainter(t,e){this.main_painter_ref&&!e||(this.main_painter_ref=t)}cleanup(){this._doing_draw&&console.error("pad drawing is not completed when cleanup is called"),this.painters.forEach((t=>t.cleanup()));let t=this.svg_this_pad();t.empty()||(t.property("pad_painter",null),this.iscan||t.remove()),delete this.main_painter_ref,delete this.frame_painter_ref,delete this.pads_cache,delete this.custom_palette,delete this._pad_x,delete this._pad_y,delete this._pad_width,delete this._pad_height,delete this._doing_draw,delete this._interactively_changed,this.painters=[],this.pad=null,this.this_pad_name=void 0,this.has_canvas=!1,Ql({pp:this,active:!1}),super.cleanup()}getFramePainter(){return this.frame_painter_ref}getPadWidth(){return this._pad_width||0}getPadHeight(){return this._pad_height||0}getPadRect(){return{x:this._pad_x||0,y:this._pad_y||0,width:this.getPadWidth(),height:this.getPadHeight()}}getFrameRect(){let t=this.getFramePainter();if(t)return t.getFrameRect();let e=this.getPadWidth(),i=this.getPadHeight(),n={};return this.pad?(n.szx=Math.round(Math.max(0,.5-Math.max(this.pad.fLeftMargin,this.pad.fRightMargin))*e),n.szy=Math.round(Math.max(0,.5-Math.max(this.pad.fBottomMargin,this.pad.fTopMargin))*i)):(n.szx=Math.round(.5*e),n.szy=Math.round(.5*i)),n.width=2*n.szx,n.height=2*n.szy,n.x=Math.round(e/2-n.szx),n.y=Math.round(i/2-n.szy),n.hint_delta_x=n.szx,n.hint_delta_y=n.szy,n.transform=`translate(${n.x},${n.y})`,n}getRootPad(t){return void 0===t||t?this.pad:null}cleanPrimitives(t){if(t&&"function"==typeof t)for(let e=this.painters.length-1;e>=0;--e)t(this.painters[e])&&(this.painters[e].cleanup(),this.painters.splice(e,1))}getCustomPalette(){if(this.custom_palette)return this.custom_palette;return this.getCanvPainter()?.custom_palette}getNumPainters(){return this.painters.length}forEachPainterInPad(t,e){e||(e="all"),"objects"!=e&&t(this);for(let i=0;i<this.painters.length;++i){let n=this.painters[i];"function"==typeof n.forEachPainterInPad?"objects"!=e&&n.forEachPainterInPad(t,e):"pads"!=e&&t(n)}}registerForPadEvents(t){this.pad_events_receiver=t}producePadEvent(t,e,i,n,r){"select"==t&&"function"==typeof this.selectActivePad&&this.selectActivePad(e,i,n),this.pad_events_receiver&&this.pad_events_receiver({what:t,padpainter:e,painter:i,position:n,place:r})}selectObjectPainter(t,e,i){let n=this.iscan||!this.has_canvas,r=n?this:this.getCanvPainter();void 0===t&&(t=this),e&&!n&&(e=nl(this.svg_this_pad(),e)),Ql({pp:this,active:!0}),r&&r.producePadEvent("select",this,t,e,i)}drawActiveBorder(t,e){if(void 0!==e){if(this.is_active_pad===e)return;this.is_active_pad=e}if(void 0===this.is_active_pad)return;t||(t=this.iscan?this.getCanvSvg().select(".canvas_fillrect"):this.svg_this_pad().select(".root_pad_border"));let i=this.is_active_pad?new Hl({style:1,width:1,color:"red"}):this.lineatt;i||(i=new Hl({color:"none"})),t.call(i.func)}createCanvasSvg(t,e){let i,n,r=null,s=null,a=null;if(t>0){if(this._fixed_size)return t>1;if(s=this.getCanvSvg(),s.empty())return!1;if(r=s.property("height_factor"),a=this.testMainResize(t,null,r),!a.changed)return!1;l()||(i=this.getLayerSvg("btns_layer",this.this_pad_name)),n=s.select(".canvas_fillrect")}else{let t=this.selectDom();"static"==t.style("position")&&t.style("position","relative"),s=t.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("current_pad","").property("redraw_by_resize",!1),this.setTopPainter(),l()?(s.attr("xmlns","http://www.w3.org/2000/svg"),s.attr("xmlns:xlink","http://www.w3.org/1999/xlink")):this.online_canvas||s.append("svg:title").text("ROOT canvas"),(!l()||this.pad.fFillStyle>0)&&(n=s.append("svg:path").attr("class","canvas_fillrect")),l()||n.style("pointer-events","visibleFill").on("dblclick",(t=>this.enlargePad(t))).on("click",(()=>this.selectObjectPainter())).on("mouseenter",(()=>this.showObjectStatus())).on("contextmenu",m.ContextMenu?t=>this.padContextMenu(t):null),s.append("svg:g").attr("class","primitives_layer"),s.append("svg:g").attr("class","info_layer"),l()||(i=s.append("svg:g").attr("class","btns_layer").property("leftside","left"==m.ToolBarSide).property("vertical",m.ToolBarVert)),r=.66,this.pad?.fCw&&this.pad?.fCh&&this.pad?.fCw>0&&(r=this.pad.fCh/this.pad.fCw,(r<.1||r>10)&&(r=.66)),this._fixed_size?(t.style("overflow","auto"),a={width:this.pad.fCw,height:this.pad.fCh},a.width&&a.height||(a=il(t))):a=this.testMainResize(2,e,r)}return this.createAttFill({attr:this.pad}),a.width<=5||a.height<=5?(s.style("display","none"),console.warn(`Hide canvas while geometry too small w=${a.width} h=${a.height}`),a.width=200,a.height=100):s.style("display",null),this._fixed_size?s.attr("x",0).attr("y",0).attr("width",a.width).attr("height",a.height).style("position","absolute"):s.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",0).style("top",0).style("right",0).style("bottom",0),s.attr("viewBox",`0 0 ${a.width} ${a.height}`).attr("preserveAspectRatio","none").property("height_factor",r).property("draw_x",0).property("draw_y",0).property("draw_width",a.width).property("draw_height",a.height),this._pad_x=0,this._pad_y=0,this._pad_width=a.width,this._pad_height=a.height,n&&(n.attr("d",`M0,0H${a.width}V${a.height}H0Z`).call(this.fillatt.func),this.drawActiveBorder(n)),this._fast_drawing=m.SmallPad&&(a.width<m.SmallPad.width||a.height<m.SmallPad.height),this.alignButtons&&i&&this.alignButtons(i,a.width,a.height),!0}enlargePad(t){t&&(t.preventDefault(),t.stopPropagation());let e=this.getCanvSvg(),i=e.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(i||this.hasObjectsToDraw()||this.painters))i?i===this.pad?(this.enlargeMain(!1),e.property("pad_enlarged",null)):console.error("missmatch with pad double click events"):(this.enlargeMain(!0,!0),e.property("pad_enlarged",this.pad));else{if(this._fixed_size)return;if(!this.enlargeMain("toggle"))return;"off"==this.enlargeMain("state")&&e.property("pad_enlarged",null)}let n=this._fast_drawing;this.checkResize(!0),this._fast_drawing!=n&&this.showPadButtons()}createPadSvg(t){if(!this.has_canvas)return this.createCanvasSvg(t?2:0),!0;let e=this.getCanvSvg(),i=e.property("draw_width"),n=e.property("draw_height"),r=e.property("pad_enlarged"),s=!(this.pad_draw_disabled||r&&r!==this.pad),a=Math.round(this.pad.fAbsWNDC*i),o=Math.round(this.pad.fAbsHNDC*n),h=Math.round(this.pad.fAbsXlowNDC*i),c=Math.round(n*(1-this.pad.fAbsYlowNDC))-o,d=null,u=null,p=null;return r===this.pad&&(a=i,o=n,h=c=0),t?(d=this.svg_this_pad(),u=d.select(".root_pad_border"),l()||(p=this.getLayerSvg("btns_layer",this.this_pad_name))):(d=e.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this),l()||d.append("svg:title").text("subpad "+this.this_pad_name),(!l()||this.pad.fFillStyle>0||this.pad.fLineStyle>0&&this.pad.fLineColor>0)&&(u=d.append("svg:path").attr("class","root_pad_border")),l()||u.style("pointer-events","visibleFill").on("dblclick",(t=>this.enlargePad(t))).on("click",(()=>this.selectObjectPainter())).on("mouseenter",(()=>this.showObjectStatus())).on("contextmenu",m.ContextMenu?t=>this.padContextMenu(t):null),d.append("svg:g").attr("class","primitives_layer"),l()||(p=d.append("svg:g").attr("class","btns_layer").property("leftside","left"!=m.ToolBarSide).property("vertical",m.ToolBarVert))),this.createAttFill({attr:this.pad}),this.createAttLine({attr:this.pad,color0:0==this.pad.fBorderMode?"none":""}),d.style("display",s?null:"none").attr("viewBox",`0 0 ${a} ${o}`).attr("preserveAspectRatio","none").attr("x",h).attr("y",c).attr("width",a).attr("height",o).property("draw_x",h).property("draw_y",c).property("draw_width",a).property("draw_height",o),this._pad_x=h,this._pad_y=c,this._pad_width=a,this._pad_height=o,u&&(u.attr("d",`M0,0H${a}V${o}H0Z`).call(this.fillatt.func).call(this.lineatt.func),this.drawActiveBorder(u)),this._fast_drawing=m.SmallPad&&(a<m.SmallPad.width||o<m.SmallPad.height),d.property("can3d")===f.Embed3D.Overlay&&this.selectDom().select(".draw3d_"+this.this_pad_name).style("display",s?"":"none"),this.alignButtons&&p&&this.alignButtons(p,a,o),s}disablePadDrawing(){this.pad_draw_disabled||!this.has_canvas||this.iscan||(this.pad_draw_disabled=!0,this.createPadSvg(!0))}checkSpecial(t){if(!t)return!1;if("TStyle"==t._typename)return Object.assign(p,t),!0;if("TObjArray"==t._typename&&"ListOfColors"==t.name){if(this.options&&this.options.CreatePalette){let e=[];for(let i=t.arr.length-this.options.CreatePalette;i<t.arr.length;++i){let n=Ll(t.arr[i]);if(!n){console.log("Fail to create color for palette"),e=null;break}e.push(n)}e&&(this.custom_palette=new Il(e))}return this.options&&!this.options.GlobalColors||Nl(t),this.options&&this.options.LocalColors&&(this.root_colors=Bl(null,t)),!0}if("TObjArray"==t._typename&&"CurrentColorPalette"==t.name){let e=[],i=!1;for(let n=0;n<t.arr.length;++n){let r=t.arr[n];r&&"TColor"==r._typename?e[n]=Ll(r):(console.log("Missing color with index "+n),i=!0)}return this.options&&(i||this.options.IgnorePalette)||(this.custom_palette=new Il(e)),!0}return!1}checkSpecialsInPrimitives(t){let e=t?.fPrimitives;if(e)for(let t=0;t<e.arr.length;++t)this.checkSpecial(e.arr[t])&&(e.arr.splice(t,1),e.opt.splice(t,1),t--)}findInPrimitives(t,e){let i=this.pad?.fPrimitives?.arr;return i?i.find((i=>i.fName==t&&(!e||i.typename==e))):null}findPainterFor(t,e,i){return this.painters.find((n=>{let r=n.getObject();if(r){if(t&&r===t)return!0;if((e||i)&&!(e&&r.fName!==e||i&&r._typename!==i))return!0}}))}hasObjectsToDraw(){let t=this.pad?.fPrimitives?.arr;return!(!t||!t.find((t=>"TPad"!=t._typename)))}syncDraw(t){let e={kind:t||"redraw"};return void 0===this._doing_draw?(this._doing_draw=[e],Promise.resolve(!0)):!(!0!==e.kind&&this._doing_draw.findIndex(((t,i)=>i>0&&t.kind==e.kind))>0)&&(this._doing_draw.push(e),new Promise((t=>{e.func=t})))}doingDraw(){return void 0!==this._doing_draw}confirmDraw(){if(void 0===this._doing_draw)return console.warn("failure, should not happen");if(this._doing_draw.shift(),0==this._doing_draw.length)delete this._doing_draw;else{let t=this._doing_draw[0];t.func&&(t.func(),delete t.func)}}drawObject(){return console.log("Not possible to draw object without loading of draw.mjs"),Promise.resolve(null)}drawPrimitives(t){if(void 0===t)return this.iscan&&(this._start_tm=(new Date).getTime()),this._num_primitives=this.pad?.fPrimitives?.arr?.length||0,this.syncDraw(!0).then((()=>this.drawPrimitives(0)));if(t>=this._num_primitives){if(this._start_tm){let t=(new Date).getTime()-this._start_tm;t>1e3&&console.log(`Canvas ${this.pad?.fName||"---"} drawing took ${(.001*t).toFixed(2)}s`),delete this._start_tm}return this.confirmDraw(),Promise.resolve()}return this.drawObject(this.getDom(),this.pad.fPrimitives.arr[t],this.pad.fPrimitives.opt[t]).then((e=>(e&&"object"==typeof e&&(e._primitive=!0),this.drawPrimitives(t+1))))}divide(t,e){if(!e){let i=t;if(i<2)return Promise.resolve(this);(t=e=Math.round(Math.sqrt(i)))*e<i&&(t+=1)}if(t*e<2)return Promise.resolve(this);let i=1/e,n=1/t,r=0,s=[];for(let a=0;a<e;a++){let e=1-a*i-.01,o=e-i+.02;if(o<0&&(o=0),!(o>e))for(let i=0;i<t;i++){let t=i*n+.01,a=t+n-.02;if(t>a)continue;r++;let l=k("TPad");l.fName=l.fTitle=this.pad.fName+"_"+r,l.fNumber=r,this.iscan?(l.fAbsWNDC=a-t,l.fAbsHNDC=e-o,l.fAbsXlowNDC=t,l.fAbsYlowNDC=o):(l.fAbsWNDC=(a-t)*this.pad.fAbsWNDC,l.fAbsHNDC=(e-o)*this.pad.fAbsHNDC,l.fAbsXlowNDC=this.pad.fAbsXlowNDC+t*this.pad.fAbsWNDC,l.fAbsYlowNDC=this.pad.fAbsYlowNDC+o*this.pad.fAbsWNDC),s.push(l)}}const a=()=>0==s.length?Promise.resolve(this):this.drawObject(this.getDom(),s.shift()).then(a);return a()}getSubPadPainter(t){for(let e=0;e<this.painters.length;++e){let i=this.painters[e];if(i.pad&&"function"==typeof i.forEachPainterInPad&&i.pad.fNumber===t)return i}return null}processPadTooltipEvent(t){let e=[],i=[];return null!==this.painters&&this.painters.forEach((t=>{"function"==typeof t.processTooltipEvent&&e.push(t)})),t&&(t.nproc=e.length),e.forEach((e=>{let n=e.processTooltipEvent(t);n||(n={user_info:null}),i.push(n),t&&t.painters&&(n.painter=e)})),i}fillContextMenu(t){if(this.pad?t.add("header: "+this.pad._typename+"::"+this.pad.fName):t.add("header: Canvas"),t.addchk(this.isTooltipAllowed(),"Show tooltips",(()=>this.setTooltipAllowed("toggle"))),!this._websocket){function i(t){this.pad[t.slice(1)]=parseInt(t[0]),this.interactiveRedraw("pad",t.slice(1))}t.addchk(this.pad.fGridx,"Grid x",(this.pad.fGridx?"0":"1")+"fGridx",i),t.addchk(this.pad.fGridy,"Grid y",(this.pad.fGridy?"0":"1")+"fGridy",i),t.add("sub:Ticks x"),t.addchk(0==this.pad.fTickx,"normal","0fTickx",i),t.addchk(1==this.pad.fTickx,"ticks on both sides","1fTickx",i),t.addchk(2==this.pad.fTickx,"labels on both sides","2fTickx",i),t.add("endsub:"),t.add("sub:Ticks y"),t.addchk(0==this.pad.fTicky,"normal","0fTicky",i),t.addchk(1==this.pad.fTicky,"ticks on both sides","1fTicky",i),t.addchk(2==this.pad.fTicky,"labels on both sides","2fTicky",i),t.add("endsub:"),t.addAttributesMenu(this)}t.add("separator"),"function"==typeof this.hasMenuBar&&"function"==typeof this.actiavteMenuBar&&t.addchk(this.hasMenuBar(),"Menu bar",(t=>this.actiavteMenuBar(t))),"function"==typeof this.hasEventStatus&&"function"==typeof this.activateStatusBar&&t.addchk(this.hasEventStatus(),"Event status",(()=>this.activateStatusBar("toggle"))),(this.enlargeMain()||this.has_canvas&&this.hasObjectsToDraw())&&t.addchk("on"==this.enlargeMain("state"),"Enlarge "+(this.iscan?"canvas":"pad"),(()=>this.enlargePad()));let e=this.this_pad_name;return 0===e.length&&(e=this.iscan?"canvas":"pad"),t.add("Save as "+e+".png",e+".png",(()=>this.saveAs("png",!1))),t.add("Save as "+e+".svg",e+".svg",(()=>this.saveAs("svg",!1))),!0}padContextMenu(t){if(t.stopPropagation){let e=qi(t,this.svg_this_pad().node());if(e&&2==e.length&&e[0]>=0&&e[0]<10&&e[1]>=0&&e[1]<10)return;t.stopPropagation(),t.preventDefault();let i=this.getFramePainter();i&&i.setLastEventPos()}vv(t,this).then((t=>(this.fillContextMenu(t),this.fillObjectExecMenu(t,"")))).then((t=>t.show()))}redrawPad(t){let e=this.syncDraw(t);if(!1===e)return console.log("Prevent redrawing",this.pad.fName),Promise.resolve(!1);let i=!0,n=e=>{for(;e<this.painters.length;){let r=this.painters[e++],s=0;if((i||r.this_pad_name)&&(s=r.redraw(t)),q(s))return s.then((()=>n(e)))}return Promise.resolve(!0)};return e.then((()=>(this.iscan?this.createCanvasSvg(2):i=this.createPadSvg(!0),n(0)))).then((()=>{if(this.confirmDraw(),Jl()===this){let t=this.getCanvPainter();t&&t.producePadEvent("padredraw",this)}return!0}))}redraw(t){this.redrawPad(t)}needRedrawByResize(){let t=this.svg_this_pad();return!t.empty()&&t.property("can3d")===f.Embed3D.Overlay||this.painters.findIndex((t=>{if("function"==typeof t.needRedrawByResize)return t.needRedrawByResize()}))>=0}checkCanvasResize(t,e){if(!this.iscan&&this.has_canvas)return!1;let i=this.syncDraw("canvas_resize");if(!1===i)return!1;!0!==t&&!1!==t||(e=t,t=null),t&&"object"==typeof t&&t.force&&(e=!0),e||(e=this.needRedrawByResize());let n=!1,r=t=>{if(!n||t>=this.painters.length)return this.confirmDraw(),n;let i=this.painters[t].redraw(e?"redraw":"resize");return q(i)||(i=Promise.resolve()),i.then((()=>r(t+1)))};return i.then((()=>(n=this.createCanvasSvg(e?2:1,t),r(0))))}updateObject(t){if(!t)return!1;this.pad.fBits=t.fBits,this.pad.fTitle=t.fTitle,this.pad.fGridx=t.fGridx,this.pad.fGridy=t.fGridy,this.pad.fTickx=t.fTickx,this.pad.fTicky=t.fTicky,this.pad.fLogx=t.fLogx,this.pad.fLogy=t.fLogy,this.pad.fLogz=t.fLogz,this.pad.fUxmin=t.fUxmin,this.pad.fUxmax=t.fUxmax,this.pad.fUymin=t.fUymin,this.pad.fUymax=t.fUymax,this.pad.fX1=t.fX1,this.pad.fX2=t.fX2,this.pad.fY1=t.fY1,this.pad.fY2=t.fY2,this.pad.fLeftMargin=t.fLeftMargin,this.pad.fRightMargin=t.fRightMargin,this.pad.fBottomMargin=t.fBottomMargin,this.pad.fTopMargin=t.fTopMargin,this.pad.fFillColor=t.fFillColor,this.pad.fFillStyle=t.fFillStyle,this.pad.fLineColor=t.fLineColor,this.pad.fLineStyle=t.fLineStyle,this.pad.fLineWidth=t.fLineWidth,this.pad.fPhi=t.fPhi,this.pad.fTheta=t.fTheta,this.iscan&&this.checkSpecialsInPrimitives(t);let e=this.getFramePainter();if(e&&e.updateAttributes(!e.modified_NDC),!t.fPrimitives)return!1;let i=!1,n=0;for(let e=0;e<t.fPrimitives.arr.length;++e)for(;n<this.painters.length;){let r=this.painters[n++];if(r._primitive){r.updateObject(t.fPrimitives.arr[e])&&(i=!0);break}}return i}addObjectPainter(t,e,i){if(t&&e&&e[i]&&void 0===t.snapid){let n=this.painters.indexOf(t);n<0&&this.painters.push(t),"function"==typeof t.setSnapId?t.setSnapId(e[i].fObjectID):t.snapid=e[i].fObjectID,t.$primary&&n>0&&this.painters[n-1].$secondary&&(this.painters[n-1].snapid=t.snapid+"#hist",console.log("ASSIGN SECONDARY HIST ID",this.painters[n-1].snapid))}}drawNextSnap(t,e){if(void 0===e&&(e=-1,this._snaps_map={},this._num_primitives=t?t.length:0),++e,!t||e>=t.length)return delete this._snaps_map,Promise.resolve(this);let i=t[e],n=i.fObjectID,r=this._snaps_map[n],s=null;r?r++:r=1,this._snaps_map[n]=r;for(let t=0;t<this.painters.length;++t)if(this.painters[t].snapid===n&&0==--r){s=this.painters[t];break}if(s){if(i.fKind===Fv)return s.redrawPadSnap(i).then((()=>this.drawNextSnap(t,e)));let n;return i.fKind===Bv?s.updateObject(i.fSnapshot,i.fOption)&&(n=s.redraw()):i.fKind===Nv&&s.updateObject(i.fSnapshot)&&(n=s.redraw()),q(n)||(n=Promise.resolve(!0)),n.then((()=>this.drawNextSnap(t,e)))}if(i.fKind===jv)return Object.assign(p,i.fSnapshot),this.drawNextSnap(t,e);if(i.fKind===Iv){let n=[],r=i.fSnapshot.fOper.split(";");for(let t=0;t<r.length;++t){let e=r[t],i=e.indexOf(":");i>0?n[parseInt(e.slice(0,i))]=lt("rgb("+e.slice(i+1)+")").formatHex():(i=e.indexOf("="),n[parseInt(e.slice(0,i))]=lt("rgba("+e.slice(i+1)+")").formatHex())}if(this.options&&!this.options.GlobalColors||Nl(n),this.options&&this.options.LocalColors&&(this.root_colors=Bl(null,n)),i.fSnapshot.fBuf&&(!this.options||!this.options.IgnorePalette)){let t=[];for(let e=0;e<i.fSnapshot.fBuf.length;++e)t[e]=n[Math.round(i.fSnapshot.fBuf[e])];this.custom_palette=new Il(t)}return this.drawNextSnap(t,e)}if(i.fKind===Fv){let n=i.fSnapshot;n.fPrimitives=null;let r=new qv(this.getDom(),n,!1);r.decodeOptions(i.fOption),r.addToPadPrimitives(this.this_pad_name),r.snapid=i.fObjectID,r.createPadSvg(),r.matchObjectType("TPad")&&i.fPrimitives.length>0&&r.addPadButtons(!0);let s=r.selectCurrentPad(r.this_pad_name);return r.drawNextSnap(i.fPrimitives).then((()=>(r.selectCurrentPad(s),this.drawNextSnap(t,e))))}return i.fKind===Bv||i.fKind===Nv?this.drawObject(this.getDom(),i.fSnapshot,i.fOption).then((i=>(this.addObjectPainter(i,t,e),this.drawNextSnap(t,e)))):this.drawNextSnap(t,e)}findSnap(t){if(this.snapid===t)return this;if(!this.painters)return null;for(let e=0;e<this.painters.length;++e){let i=this.painters[e];if("function"==typeof i.findSnap?i=i.findSnap(t):i.snapid!==t&&(i=null),i)return i}return null}redrawPadSnap(t){if(!t||!t.fPrimitives)return Promise.resolve(this);this.is_active_pad=!!t.fActive,this._readonly=void 0===t.fReadOnly||t.fReadOnly;let e=t.fSnapshot;if(e.fPrimitives=null,void 0===this.snapid){this.snapid=t.fObjectID,this.draw_object=e,this.pad=e,!this.batch_mode||e.fCw&&e.fCh||(e.fCw=900,e.fCh=700),e.fCw&&e.fCh||(this._fixed_size=!1);let i=this.selectDom().attr("id");this.batch_mode||this.use_openui||this.brlayout||!i||"string"!=typeof i||(this.brlayout=new zv(i,null,this),this.brlayout.create(i,!0),this.setDom(this.brlayout.drawing_divid()),fv(this.brlayout)),this.createCanvasSvg(0),this.batch_mode||this.addPadButtons(!0),void 0!==t.fHighlightConnect&&(this._highlight_connect=t.fHighlightConnect);let n=Promise.resolve(!0);if("string"==typeof t.fScripts&&t.fScripts){let e="";0==t.fScripts.indexOf("load:")?e=t.fScripts.slice(5).split(";"):0==t.fScripts.indexOf("assert:")&&(e=t.fScripts.slice(7)),n=e?x(e):_(t.fScripts)}return n.then((()=>this.drawNextSnap(t.fPrimitives)))}this.updateObject(e),this.iscan?this.createCanvasSvg(2):this.createPadSvg(!0);const i=(t,e,i,n)=>{let r=t.find((t=>{if(void 0!==t.snapid&&t.matchObjectType(i)&&(!n||t.getObject()&&t.getObject().fName===n))return!0}));if(!r)return;let s=e.find((t=>{if(1===t.fKind&&t.fSnapshot&&t.fSnapshot._typename===i&&(!n||t.fSnapshot.fName===n))return!0}));s&&r.snapid!==s.fObjectID&&(r.snapid=s.fObjectID)};i(this.painters,t.fPrimitives,"TFrame"),i(this.painters,t.fPrimitives,"TPaveText","title");let n=!1,r=!1;for(let e=0;e<this.painters.length;++e){let i=this.painters[e];if(void 0!==i.snapid&&!i.$secondary){for(let e=0;e<t.fPrimitives.length;++e)if(t.fPrimitives[e].fObjectID===i.snapid){i=null,n=!0;break}i&&(this.painters.splice(e--,1),i.cleanup(),r=!0)}}if(r&&delete this.pads_cache,!n){let t=this.getFramePainter();this.painters.forEach((e=>{t!==e&&e.cleanup()})),delete this.main_painter_ref,this.painters=[],t&&(this.painters.push(t),t.cleanFrameDrawings(),t.redraw()),this.removePadButtons&&this.removePadButtons(),this.addPadButtons(!0)}let s=this.selectCurrentPad(this.this_pad_name);return this.drawNextSnap(t.fPrimitives).then((()=>{let t=[];return this.painters.forEach((e=>{if(void 0===e.snapid||e.$secondary){let i=e.redraw();q(i)&&t.push(i)}})),Promise.all(t)})).then((()=>{if(this.selectCurrentPad(s),Jl()===this){let t=this.getCanvPainter();t&&t.producePadEvent("padredraw",this)}return this}))}createImage(t){return"pdf"==t?Promise.resolve(btoa("dummy PDF file")):"png"==t||"jpeg"==t||"svg"==t?this.produceImage(!0,t).then((e=>{if(!e||"svg"==t)return e;let i=e.indexOf("base64,");return i>0?e.slice(i+7):""})):Promise.resolve("")}getWebPadOptions(t){let e=void 0===t,i=null,n=!0;return e&&this._readonly?"":("only_this"===t&&(e=!0,n=!1),e&&(t=[]),this.snapid&&(i={_typename:"TWebPadOptions",snapid:this.snapid.toString(),active:!!this.is_active_pad,bits:0,primitives:[],logx:this.pad.fLogx,logy:this.pad.fLogy,logz:this.pad.fLogz,gridx:this.pad.fGridx,gridy:this.pad.fGridy,tickx:this.pad.fTickx,ticky:this.pad.fTicky,mleft:this.pad.fLeftMargin,mright:this.pad.fRightMargin,mtop:this.pad.fTopMargin,mbottom:this.pad.fBottomMargin,zx1:0,zx2:0,zy1:0,zy2:0,zz1:0,zz2:0},this.iscan&&(i.bits=this.getStatusBits()),this.getPadRanges(i)?t.push(i):console.log("fail to get ranges for pad "+this.pad.fName)),this.painters.forEach((e=>{if("function"==typeof e.getWebPadOptions)n&&e.getWebPadOptions(t);else if(e.snapid){let t={_typename:"TWebObjectOptions",snapid:e.snapid.toString(),opt:e.getDrawOpt(),fcust:"",fopt:[]};"function"==typeof e.fillWebObjectOptions&&(t=e.fillWebObjectOptions(t)),i.primitives.push(t)}})),e?T(t):void 0)}getPadRanges(t){if(!t)return!1;let e=this.getFramePainter(),i=this.svg_this_pad();if(t.ranges=!(!e||!e.ranges_set),t.ux1=t.px1=t.ranges?e.scale_xmin:0,t.uy1=t.py1=t.ranges?e.scale_ymin:0,t.ux2=t.px2=t.ranges?e.scale_xmax:0,t.uy2=t.py2=t.ranges?e.scale_ymax:0,e&&(e.zoom_xmin!==e.zoom_xmax&&(t.zx1=e.zoom_xmin,t.zx2=e.zoom_xmax),e.zoom_ymin!==e.zoom_ymax&&(t.zy1=e.zoom_ymin,t.zy2=e.zoom_ymax),e.zoom_zmin!==e.zoom_zmax&&(t.zz1=e.zoom_zmin,t.zz2=e.zoom_zmax)),!t.ranges||i.empty())return!0;const n=t=>t,r=[n,Math.log10,t=>Math.log10(t)/Math.log10(2)],s=[n,t=>Math.pow(10,t),t=>Math.pow(2,t)],a=(t,e,i)=>Math.abs(e-t)<1e-10*Math.abs(i)?e:t;let o=r[e.logx],l=s[e.logx],h=(o(e.scale_xmax)-o(e.scale_xmin))/i.property("draw_width"),c=o(e.scale_xmin)-h*i.property("draw_x"),d=c+h*i.property("draw_width");t.ux1=a(l(c),t.ux1,t.px2-t.px1),t.ux2=a(l(d),t.ux2,t.px2-t.px1),o=r[e.logy],l=s[e.logy],h=(o(e.scale_ymax)-o(e.scale_ymin))/i.property("draw_height");let u=o(e.scale_ymax)+h*i.property("draw_y"),f=u-h*i.property("draw_height");return t.uy1=a(l(f),t.uy1,t.py2-t.py1),t.uy2=a(l(u),t.uy2,t.py2-t.py1),!0}itemContextMenu(t){let e=this.svg_this_pad().node().getBoundingClientRect(),i={clientX:e.left+10,clientY:e.top+10};if("pad"==t)return setTimeout((()=>this.padContextMenu(i)),50);let n,r=null;switch(t){case"xaxis":case"yaxis":case"zaxis":r=this.getFramePainter(),n=t[0];break;case"frame":r=this.getFramePainter();break;default:{let e=parseInt(t);Number.isInteger(e)&&(r=this.painters[e])}}r&&"function"==typeof r.fillContextMenu&&vv(i,r).then((t=>{r.fillContextMenu(t,n)&&setTimeout((()=>t.show()),50)}))}saveAs(t,e,i){i||(0===(i=this.this_pad_name).length&&(i=this.iscan?"canvas":"pad"),i+="."+t),this.produceImage(e,t).then((e=>{let n=document.createElement("a");n.download=i,n.href="svg"!=t?e:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e),document.body.appendChild(n),n.addEventListener("click",(()=>n.parentNode.removeChild(n))),n.click()}))}produceImage(t,e){let i="frame"===t,n=i?this.getFrameSvg():t?this.getCanvSvg():this.svg_this_pad();if(n.empty())return Promise.resolve("");let r=t&&!i?this.getCanvPainter():this,a=[],o=null;r.forEachPainterInPad((t=>{if(t.is_active_pad&&!o&&(o=t,o.drawActiveBorder(null,!1)),i)return;let e={prnt:t.svg_this_pad()};a.push(e);let n=t.getLayerSvg("btns_layer",t.this_pad_name);e.btns_node=n.node(),e.btns_node&&(e.btns_prnt=e.btns_node.parentNode,e.btns_next=e.btns_node.nextSibling,n.remove());let r=t.getFramePainter();if(!r||"function"!=typeof r.render3D||"function"!=typeof r.access3dKind)return;let s=r.access3dKind();if(s!==f.Embed3D.Overlay&&s!==f.Embed3D.Embed)return;let l=r.getSizeFor3d(f.Embed3D.Embed),h=r.renderer.domElement;r.render3D(0);let c=h.toDataURL("image/png");s===f.Embed3D.Embed&&(e.foreign=e.prnt.select("."+l.clname),e.foreign.remove());let d=r.getFrameSvg();e.frame_node=d.node(),e.frame_node&&(e.frame_next=e.frame_node.nextSibling,d.remove()),e.img=e.prnt.insert("image",".primitives_layer").attr("x",l.x).attr("y",l.y).attr("width",h.width).attr("height",h.height).attr("href",c)}),"pads");let l=()=>{o&&o.drawActiveBorder(null,!0);for(let t=0;t<a.length;++t){let e=a[t];e.img&&e.img.remove();let i=e.prnt.select(".primitives_layer");e.foreign&&e.prnt.node().insertBefore(e.foreign.node(),i.node()),e.frame_node&&i.node().insertBefore(e.frame_node,e.frame_next),e.btns_node&&e.btns_prnt.insertBefore(e.btns_node,e.btns_next)}},h=n.property("draw_width"),c=n.property("draw_height");if(i){let t=this.getFramePainter();h=t.getFrameWidth(),c=t.getFrameHeight()}let d='<svg width="'+h+'" height="'+c+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+n.node().innerHTML+"</svg>";if(s.processSvgWorkarounds&&(d=s.processSvgWorkarounds(d)),d=ll(d),"svg"==e)return l(),Promise.resolve(d);let u=new Image;return new Promise((t=>{var i;u.onload=function(){let i=document.createElement("canvas");i.width=u.width,i.height=u.height,i.getContext("2d").drawImage(u,0,0),l(),t(i.toDataURL("image/"+e))},u.onerror=function(e){console.log("IMAGE ERROR",e),l(),t(null)},u.src="data:image/svg+xml;base64,"+window.btoa((i='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+d,i=(i=encodeURIComponent(i)).replace(/%([0-9A-F]{2})/g,((t,e)=>{let i=String.fromCharCode("0x"+e);return"%"===i?"%25":i})),decodeURIComponent(i)))}))}clickPadButton(t,e){if("CanvasSnapShot"==t)return this.saveAs("png",!0);if("enlargePad"==t)return this.enlargePad();if("PadSnapShot"==t)return this.saveAs("png",!1);if("PadContextMenus"==t){if(e&&(e.preventDefault(),e.stopPropagation()),bv())return;return void vv(e,this).then((t=>{t.add("header:Menus"),this.iscan?t.add("Canvas","pad",this.itemContextMenu):t.add("Pad","pad",this.itemContextMenu),this.getFramePainter()&&t.add("Frame","frame",this.itemContextMenu);let e=this.getMainPainter();if(e&&(t.add("X axis","xaxis",this.itemContextMenu),t.add("Y axis","yaxis",this.itemContextMenu),"function"==typeof e.getDimension&&e.getDimension()>1&&t.add("Z axis","zaxis",this.itemContextMenu)),this.painters&&this.painters.length>0){t.add("separator");let e=[];this.painters.forEach(((i,n)=>{let r=i?i.getObject():null;if(!r||e.indexOf(r)>=0)return;if(i.$secondary)return;let s="_typename"in r?r._typename+"::":"";"fName"in r&&(s+=r.fName),s.length||(s="item"+n),t.add(s,n,this.itemContextMenu)}))}t.show()}))}let i=!1;this.painters.forEach((e=>{"function"==typeof e.clickPadButton&&e.clickPadButton(t),i||"function"!=typeof e.clickButton||(i=e.clickButton(t))}))}addPadButton(t,e,i,n){if(!m.ToolBar||l()||this.batch_mode)return;this._buttons||(this._buttons=[]);for(let t=0;t<this._buttons.length;++t)if(this._buttons[t].funcname==i)return;if(this._buttons.push({btn:t,tooltip:e,funcname:i,keyname:n}),!(this.iscan||!this.has_canvas)&&0!=i.indexOf("Pad")&&"enlargePad"!==i){let n=this.getCanvPainter();n&&n!==this&&n.addPadButton(t,e,i)}}showPadButtons(){this._buttons&&(Lv.assign(this),this.showPadButtons())}addPadButtons(t){this.addPadButton("camera","Create PNG",this.iscan?"CanvasSnapShot":"PadSnapShot","Ctrl PrintScreen"),m.ContextMenu&&this.addPadButton("question","Access context menus","PadContextMenus"),(!this.iscan&&this.has_canvas&&this.hasObjectsToDraw()||this.enlargeMain("verify"))&&this.addPadButton("circle","Enlarge canvas","enlargePad"),t&&this.brlayout&&(this.addPadButton("diamand","Toggle Ged","ToggleGed"),this.addPadButton("three_circles","Toggle Status","ToggleStatus"))}decodeOptions(t){let e=this.getObject();if(!e)return;let i=new sl(t);this.options||(this.options={}),Object.assign(this.options,{GlobalColors:!0,LocalColors:!1,CreatePalette:0,IgnorePalette:!1,RotateFrame:!1,FixFrame:!1}),(i.check("NOCOLORS")||i.check("NOCOL"))&&(this.options.GlobalColors=this.options.LocalColors=!1),(i.check("LCOLORS")||i.check("LCOL"))&&(this.options.GlobalColors=!1,this.options.LocalColors=!0),(i.check("NOPALETTE")||i.check("NOPAL"))&&(this.options.IgnorePalette=!0),i.check("ROTATE")&&(this.options.RotateFrame=!0),i.check("FIXFRAME")&&(this.options.FixFrame=!0),i.check("CP",!0)&&(this.options.CreatePalette=i.partAsInt(0,0)),i.check("NOZOOMX")&&(this.options.NoZoomX=!0),i.check("NOZOOMY")&&(this.options.NoZoomY=!0),i.check("NOMARGINS")&&(e.fLeftMargin=e.fRightMargin=e.fBottomMargin=e.fTopMargin=0),i.check("WHITE")&&(e.fFillColor=0),i.check("LOG2X")&&(e.fLogx=2,e.fUxmin=0,e.fUxmax=1,e.fX1=0,e.fX2=1),i.check("LOGX")&&(e.fLogx=1,e.fUxmin=0,e.fUxmax=1,e.fX1=0,e.fX2=1),i.check("LOG2Y")&&(e.fLogy=2,e.fUymin=0,e.fUymax=1,e.fY1=0,e.fY2=1),i.check("LOGY")&&(e.fLogy=1,e.fUymin=0,e.fUymax=1,e.fY1=0,e.fY2=1),i.check("LOG2Z")&&(e.fLogz=2),i.check("LOGZ")&&(e.fLogz=1),i.check("LOG2")&&(e.fLogx=e.fLogy=e.fLogz=2),i.check("LOG")&&(e.fLogx=e.fLogy=e.fLogz=1),i.check("GRIDX")&&(e.fGridx=1),i.check("GRIDY")&&(e.fGridy=1),i.check("GRID")&&(e.fGridx=e.fGridy=1),i.check("TICKX")&&(e.fTickx=1),i.check("TICKY")&&(e.fTicky=1),i.check("TICK")&&(e.fTickx=e.fTicky=1),i.check("OTX")&&(e.$OTX=!0),i.check("OTY")&&(e.$OTY=!0),i.check("CTX")&&(e.$CTX=!0),i.check("CTY")&&(e.$CTY=!0),i.check("RX")&&(e.$RX=!0),i.check("RY")&&(e.$RY=!0),this.storeDrawOpt(t)}static draw(t,e,i){let n=new qv(t,e,!1);n.decodeOptions(i),n.getCanvSvg().empty()?(n.has_canvas=!1,n.this_pad_name="",n.setTopPainter()):n.addToPadPrimitives(n.pad_name),n.createPadSvg(),!n.matchObjectType("TPad")||n.has_canvas&&!n.hasObjectsToDraw()||n.addPadButtons();let r=n.has_canvas?n.selectCurrentPad(n.this_pad_name):void 0;return Ql({pp:n,active:!0}),n.drawPrimitives().then((()=>(n.showPadButtons(),n.selectCurrentPad(r),n)))}}var Uv=Object.freeze({__proto__:null,TPadPainter:qv,PadButtonsHandler:Lv});function Gv(t,e,i){let n=new Cv(t,e);return n.addToPadPrimitives(),"3d"==i&&(n.mode3d=!0),n.redraw()}const Hv={kShowEventStatus:y(15),kAutoExec:y(16),kMenuBar:y(17),kShowToolBar:y(18),kShowEditor:y(19),kMoveOpaque:y(20),kResizeOpaque:y(21),kIsGrayscale:y(22),kShowToolTips:y(23)};class Xv extends qv{constructor(t,e){super(t,e,!0),this._websocket=null,this.tooltip_allowed=m.Tooltip}cleanup(){this._changed_layout&&this.setLayoutKind("simple"),delete this._changed_layout,super.cleanup()}getLayoutKind(){let t=this.selectDom("origin");return(t.empty()?"":t.property("layout"))||"simple"}setLayoutKind(t,e){let i=this.selectDom("origin");i.empty()||(t||(t="simple"),i.property("layout",t),i.property("layout_selector","simple"!=t&&e?e:null),this._changed_layout="simple"!==t)}changeLayout(t,e){if(this.getLayoutKind()==t)return Promise.resolve(!0);let i=this.selectDom("origin"),n=i.select(".side_panel"),r=this.selectDom(),s=[];for(;r.node().firstChild;)s.push(r.node().removeChild(r.node().firstChild));if(n.empty()||th(n.node()),this.setLayoutKind("simple"),i.html(""),"simple"==t){r=i;for(let t=0;t<s.length;++t)r.node().appendChild(s[t]);this.setLayoutKind(t)}else{let a=new Ev(i.node(),t);null==e&&(e=0==t.indexOf("vert")?0:1),r=Ii(a.getGridFrame(e)),n=Ii(a.getGridFrame(1-e)),r.classed("central_panel",!0).style("position","relative"),n.classed("side_panel",!0).style("position","relative");for(let t=0;t<s.length;++t)r.node().appendChild(s[t]);this.setLayoutKind(t,".central_panel"),i.property("mdi",null)}return Kl(r.node()),Promise.resolve(!0)}toggleProjection(t){if(delete this.proj_painter,t&&(this.proj_painter=1),this.showUI5ProjectionArea)return this.showUI5ProjectionArea(t);let e,i="simple";switch(t){case"X":case"bottom":i="vert2_31",e=0;break;case"Y":case"left":i="horiz2_13",e=1;break;case"top":i="vert2_13",e=1;break;case"right":i="horiz2_31",e=0}return this.changeLayout(i,e)}drawProjection(t,e,i){if(this.proj_painter)if(void 0===i&&(i="hist"),1===this.proj_painter){let n,r=k("TCanvas"),s=this.pad,a=this.getFramePainter();"X"==t?(r.fLeftMargin=s.fLeftMargin,r.fRightMargin=s.fRightMargin,r.fLogx=a.logx,r.fUxmin=a.logx?Math.log10(a.scale_xmin):a.scale_xmin,r.fUxmax=a.logx?Math.log10(a.scale_xmax):a.scale_xmax,n="fixframe"):"Y"==t&&(r.fBottomMargin=s.fBottomMargin,r.fTopMargin=s.fTopMargin,r.fLogx=a.logy,r.fUxmin=a.logy?Math.log10(a.scale_ymin):a.scale_ymin,r.fUxmax=a.logy?Math.log10(a.scale_ymax):a.scale_ymax,n="rotate"),r.fPrimitives.Add(e,i),(this.drawInUI5ProjectionArea?this.drawInUI5ProjectionArea(r,n):this.drawInSidePanel(r,n)).then((t=>{this.proj_painter=t}))}else{let t=this.proj_painter.getMainPainter();t&&t.updateObject(e,i),this.proj_painter.redrawPad()}}testUI5(){return!!this.use_openui&&(console.warn("full ui5 should be used - not loaded yet? Please check!!"),!0)}drawInSidePanel(t,e){let i=this.selectDom("origin").select(".side_panel");return i.empty()?Promise.resolve(null):this.drawObject(i.node(),t,e)}showMessage(t){this.testUI5()||lv(t,7e3)}saveCanvasAsFile(t){let e=t.indexOf(".");this.createImage(t.slice(e+1)).then((e=>this.sendWebsocket("SAVE:"+t+":"+e)))}sendSaveCommand(t){this.sendWebsocket("PRODUCE:"+t)}submitMenuRequest(t,e,i){return new Promise((t=>{this._getmenu_callback=t,this.sendWebsocket("GETMENU:"+i)}))}submitExec(t,e,i){!this._readonly&&t&&(i||(i=t.snapid),i&&"string"==typeof i&&this.sendWebsocket("OBJEXEC:"+i+":"+e))}sendWebsocket(t){this._websocket&&(this._websocket.canSend()?this._websocket.send(t):console.warn("DROP SEND: "+t))}closeWebsocket(t){this._websocket&&(this._websocket.close(t),this._websocket.cleanup(),delete this._websocket)}useWebsocket(t){this.closeWebsocket(),this._websocket=t,this._websocket.setReceiver(this),this._websocket.connect()}onWebsocketOpened(){}onWebsocketClosed(){this.embed_canvas||hv()}onWebsocketMsg(t,e){if(console.log("GET MSG len:"+e.length+" "+e.slice(0,60)),"CLOSE"==e)this.onWebsocketClosed(),this.closeWebsocket(!0);else if("SNAP6:"==e.slice(0,6)){let i=w(e.slice(6));this.syncDraw(!0).then((()=>this.redrawPadSnap(i))).then((()=>{this.completeCanvasSnapDrawing();let e=this.getWebPadOptions();e&&(e=":"+e),t.send("READY6:"+i.fVersion+e),this.confirmDraw()}))}else if("MENU:"==e.slice(0,5)){let t=w(e.slice(5));"function"==typeof this._getmenu_callback&&(this._getmenu_callback(t),delete this._getmenu_callback)}else if("CMD:"==e.slice(0,4)){let i=(e=e.slice(4)).indexOf(":"),n=e.slice(0,i),r=e.slice(i+1),s="REPLY:"+n+":";"SVG"==r||"PNG"==r||"JPEG"==r?this.createImage(r.toLowerCase()).then((e=>t.send(s+e))):(console.log("Unrecognized command "+r),t.send(s))}else if("DXPROJ:"==e.slice(0,7)||"DYPROJ:"==e.slice(0,7)){let t=e[1],i=w(e.slice(7));this.drawProjection(t,i)}else if("SHOW:"==e.slice(0,5)){let t=e.slice(5),i="1"==t[t.length-1];this.showSection(t.slice(0,t.length-2),i)}else if("EDIT:"==e.slice(0,5)){let t=this.findSnap(e.slice(5));console.log("GET EDIT "+e.slice(5)+" found "+!!t),t&&this.showSection("Editor",!0).then((()=>this.producePadEvent("select",t.getPadPainter(),t)))}else console.log("unrecognized msg "+e)}clickPadButton(t,e){return"ToggleGed"==t?this.activateGed(this,null,"toggle"):"ToggleStatus"==t?this.activateStatusBar("toggle"):void super.clickPadButton(t,e)}hasEventStatus(){return!this.testUI5()&&(!!this.brlayout&&this.brlayout.hasStatus())}activateStatusBar(t){this.testUI5()||(this.brlayout&&this.brlayout.createStatusLine(23,t),this.processChanges("sbits",this))}hasGed(){return!this.testUI5()&&(!!this.brlayout&&this.brlayout.hasContent())}removeGed(){this.testUI5()||(this.registerForPadEvents(null),this.ged_view&&(this.ged_view.getController().cleanupGed(),this.ged_view.destroy(),delete this.ged_view),this.brlayout&&this.brlayout.deleteContent(),this.processChanges("sbits",this))}activateGed(t,e,i){if(this.testUI5()||!this.brlayout)return Promise.resolve(!1);if(this.brlayout.hasContent()){if("toggle"===i||!1===i)this.removeGed();else{let e=t?t.getPadPainter():null;e&&e.selectObjectPainter(t)}return Promise.resolve(!0)}if(!1===i)return Promise.resolve(!1);let n=this.brlayout.createBrowserBtns();return uv.createSVG(n,uv.diamand,15,"toggle fix-pos mode").style("margin","3px").on("click",(()=>this.brlayout.toggleKind("fix"))),uv.createSVG(n,uv.circle,15,"toggle float mode").style("margin","3px").on("click",(()=>this.brlayout.toggleKind("float"))),uv.createSVG(n,uv.cross,15,"delete GED").style("margin","3px").on("click",(()=>this.removeGed())),this.brlayout.setBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>"),this.brlayout.setBrowserTitle("GED"),this.brlayout.toggleBrowserKind(e||"float"),new Promise((e=>{dv().then((i=>{Ii("#ged_placeholder").text(""),i.ui.define(["sap/ui/model/json/JSONModel","sap/ui/core/mvc/XMLView"],((i,n)=>{let r=new i({handle:null});n.create({viewName:"rootui5.canv.view.Ged"}).then((i=>{i.setModel(r),i.placeAt("ged_placeholder"),this.ged_view=i,this.registerForPadEvents(i.getController().padEventsReceiver.bind(i.getController()));let n=t?t.getPadPainter():null;n&&n.selectObjectPainter(t),this.processChanges("sbits",this),e(!0)}))}))}))}))}showSection(t,e){if(this.testUI5())return Promise.resolve(!1);switch(console.log("Show section "+t+" flag = "+e),t){case"Menu":case"ToolBar":break;case"StatusBar":this.activateStatusBar(e);break;case"Editor":return this.activateGed(this,null,!!e);case"ToolTips":this.setTooltipAllowed(e)}return Promise.resolve(!0)}completeCanvasSnapDrawing(){this.pad&&(document&&!this.embed_canvas&&this._websocket&&(document.title=this.pad.fTitle),this._all_sections_showed||(this._all_sections_showed=!0,this.showSection("Menu",this.pad.TestBit(Hv.kMenuBar)),this.showSection("StatusBar",this.pad.TestBit(Hv.kShowEventStatus)),this.showSection("ToolBar",this.pad.TestBit(Hv.kShowToolBar)),this.showSection("Editor",this.pad.TestBit(Hv.kShowEditor)),this.showSection("ToolTips",this.pad.TestBit(Hv.kShowToolTips)||this._highlight_connect)))}processHighlightConnect(t){if(!t||0==t.length||!this._highlight_connect||!this._websocket||this.doingDraw()||!this._websocket.canSend(2))return;let e=t[0]||t[1];if(!(e&&e.painter&&e.painter.snapid&&e.user_info))return;let i=e.painter.getPadPainter()||this;if(!i.snapid)return;let n=[i.snapid,e.painter.snapid,"0","0"];void 0!==e.user_info.binx&&void 0!==e.user_info.biny?(n[2]=e.user_info.binx.toString(),n[3]=e.user_info.biny.toString()):void 0!==e.user_info.bin&&(n[2]=e.user_info.bin.toString());let r=JSON.stringify(n);this._last_highlight_msg!=r&&(this._last_highlight_msg=r,this.sendWebsocket("HIGHLIGHT:"+r))}processChanges(t,e,i){if(!this._websocket||this._readonly||!this._websocket.canSend(2)||"string"!=typeof t)return;let n="";switch(e||(e=this),t){case"sbits":n="STATUSBITS:"+this.getStatusBits();break;case"frame":case"zoom":e.getWebPadOptions||(e=e.getPadPainter()),"function"==typeof e.getWebPadOptions&&(n="OPTIONS6:"+e.getWebPadOptions("only_this"));break;case"pave_moved":if(e.fillWebObjectOptions){let t=e.fillWebObjectOptions();t&&(n="PRIMIT6:"+T(t))}break;default:"exec:"==t.slice(0,5)&&e&&e.snapid?(console.log("Call exec",e.snapid),n="PRIMIT6:"+T({_typename:"TWebObjectOptions",snapid:e.snapid.toString()+(i?"#"+i:""),opt:t.slice(5),fcust:"exec",fopt:[]})):console.log("UNPROCESSED CHANGES",t)}n&&(console.log("Sending "+n.length+"  "+n.slice(0,40)),this._websocket.send(n))}selectActivePad(t,e,i){if(void 0===this.snapid||!t)return;let n=null,r=!1;void 0!==t.snapid&&this._websocket&&(n={_typename:"TWebPadClick",padid:t.snapid.toString(),objid:"",x:-1,y:-1,dbl:!1}),t.is_active_pad||(r=!0,this.forEachPainterInPad((e=>e.drawActiveBorder(null,e===t)),"pads")),e&&void 0!==e.snapid&&n&&(r=!0,n.objid=e.snapid.toString()),i&&n&&(r=!0,n.x=Math.round(i.x||0),n.y=Math.round(i.y||0),i.dbl&&(n.dbl=!0)),n&&r&&this.sendWebsocket("PADCLICKED:"+T(n))}getStatusBits(){let t=0;return this.hasEventStatus()&&(t|=Hv.kShowEventStatus),this.hasGed()&&(t|=Hv.kShowEditor),this.isTooltipAllowed()&&(t|=Hv.kShowToolTips),this.use_openui&&(t|=Hv.kMenuBar),t}produceJSON(){let t=this.getObject(),e=0==t.fFillStyle;e&&(t.fFillStyle=1001),this.normal_canvas||this.forEachPainterInPad((e=>{if(e.$secondary)return;let i=e.getObject();i&&i._typename&&t.fPrimitives.Add(i,e.getDrawOpt())}),"objects");let i=T(t);return e&&(t.fFillStyle=0),this.normal_canvas||t.fPrimitives.Clear(),i}static draw(t,e,i){let n=!e;n&&(e=k("TCanvas"));let r=new Xv(t,e);if(r.checkSpecialsInPrimitives(e),!n&&e.fCw&&e.fCh&&!l()){let t=r.selectDom().node().getBoundingClientRect();!t.height&&t.width>.1*e.fCw&&(r.selectDom().style("width",e.fCw+"px").style("height",e.fCh+"px"),r._fixed_size=!0)}return r.decodeOptions(i),r.normal_canvas=!n,r.createCanvasSvg(0),r.addPadButtons(),n&&i.indexOf("noframe")<0&&Gv(t,null),Ql({pp:r,active:!0}),r.drawPrimitives().then((()=>(r.showPadButtons(),r)))}}function Vv(t,e){if(!t)return Promise.reject(Error("Painter not provided in ensureTCanvas"));let i=t.getCanvSvg(),n=!1===e||"3d"==e?"noframe":"",r=Promise.resolve(!0);return i.empty()&&(r=Xv.draw(t.getDom(),null,n)),r.then((()=>(!1!==e&&t.getFrameSvg().select(".main_layer").empty()&&!t.getFramePainter()&&Gv(t.getDom(),null,e),t.addToPadPrimitives(),t)))}var Yv=Object.freeze({__proto__:null,ensureTCanvas:Vv,drawTPadSnapshot:function(t,e){let i=k("TCanvas"),n=new Xv(t,i);return n.normal_canvas=!1,n.addPadButtons(),n.syncDraw(!0).then((()=>n.redrawPadSnap(e))).then((()=>(n.confirmDraw(),n.showPadButtons(),n)))},drawTGaxis:function(t,e,i){let n=new Dy(t,e,!1);return n.disable_zooming=!0,Vv(n,!1).then((()=>(i&&n.convertTo(i),n.redraw()))).then((()=>n))},drawTFrame:function(t,e,i){let n=new Cv(t,e);return Vv(n,!1).then((()=>("3d"==i&&(n.mode3d=!0),n.redraw())))},TPadPainter:qv,TCanvasPainter:Xv});class $v extends Vl{constructor(t,e){super(t,e),this.Enabled=!0,this.UseContextMenu=!0,this.UseTextColor=!1}drawPave(t){if(this.UseTextColor=!1,!this.Enabled)return this.removeG(),Promise.resolve(this);let e=this.getObject(),i=e.fOption.toUpperCase(),n=this.getFramePainter();if(0===e.fInit){this.stored=Object.assign({},e),e.fInit=1;let r=this.getPadPainter().getRootPad(!0);if("TPaletteAxis"!=e._typename||e.fX1||e.fX2||e.fY1||e.fY2?i.indexOf("NDC")>=0?(e.fX1NDC=e.fX1,e.fX2NDC=e.fX2,e.fY1NDC=e.fY1,e.fY2NDC=e.fY2):r&&0==r.fX1&&1==r.fX2&&0==r.fY1&&1==r.fY2&&"string"==typeof t&&t.indexOf("postpone")>=0?(e.fInit=0,e.fX1NDC=e.fY1NDC=.99,e.fX2NDC=e.fY2NDC=1):r?(r.fLogx&&(e.fX1>0&&(e.fX1=Math.log10(e.fX1)),e.fX2>0&&(e.fX2=Math.log10(e.fX2))),r.fLogy&&(e.fY1>0&&(e.fY1=Math.log10(e.fY1)),e.fY2>0&&(e.fY2=Math.log10(e.fY2))),e.fX1NDC=(e.fX1-r.fX1)/(r.fX2-r.fX1),e.fY1NDC=(e.fY1-r.fY1)/(r.fY2-r.fY1),e.fX2NDC=(e.fX2-r.fX1)/(r.fX2-r.fX1),e.fY2NDC=(e.fY2-r.fY1)/(r.fY2-r.fY1)):(e.fX1NDC=e.fY1NDC=.1,e.fX2NDC=e.fY2NDC=.9):n?(e.fX1NDC=n.fX2NDC+.01,e.fX2NDC=Math.min(.96,n.fX2NDC+.06),e.fY1NDC=n.fY1NDC,e.fY2NDC=n.fY2NDC):(e.fX2NDC=.8,e.fX1NDC=.9,e.fY1NDC=.1,e.fY2NDC=.9),e.fX1NDC==e.fX2NDC&&e.fY1NDC==e.fY2NDC&&"TLegend"==e._typename){e.fX1NDC=Math.max(r?r.fLeftMargin:0,e.fX2NDC-.3),e.fX2NDC=Math.min(e.fX1NDC+.3,r?1-r.fRightMargin:1);let t=Math.max(e.fPrimitives?.05*e.fPrimitives.arr.length:0,.2);e.fY2NDC=Math.min(r?1-r.fTopMargin:1,e.fY1NDC+t),e.fY1NDC=Math.max(e.fY2NDC-t,r?r.fBottomMargin:0)}}let r=this.getPadPainter().getPadRect(),s=e.fBorderSize,a=i.indexOf("L")>=0?-1:i.indexOf("R")>=0?1:0,o=i.indexOf("T")>=0?-1:i.indexOf("B")>=0?1:0;this.createG(),this._pave_x=Math.round(e.fX1NDC*r.width),this._pave_y=Math.round((1-e.fY2NDC)*r.height);let h,c=Math.round((e.fX2NDC-e.fX1NDC)*r.width),u=Math.round((e.fY2NDC-e.fY1NDC)*r.height);if(this.draw_g.attr("transform",`translate(${this._pave_x},${this._pave_y})`),this.createAttLine({attr:e,width:s>0?e.fLineWidth:0}),this.createAttFill({attr:e}),"TDiamond"==e._typename){let i=Math.round(u/2),n=Math.round(c/2),r=`l${n},${-i}l${n},${i}l${-n},${i}z`;s>1&&e.fShadowColor>0&&(a||o)&&!this.fillatt.empty()&&this.draw_g.append("svg:path").attr("d","M0,"+(i+s)+r).style("fill",this.getColor(e.fShadowColor)).style("stroke",this.getColor(e.fShadowColor)).style("stroke-width","1px"),this.draw_g.append("svg:path").attr("d","M0,"+i+r).call(this.fillatt.func).call(this.lineatt.func);let l=this.draw_g.append("svg:g").attr("transform",`translate(${Math.round(c/4)},${Math.round(u/4)})`);return this.drawPaveText(n,i,t,l)}if(s>1&&e.fShadowColor>0&&!e.fNpaves&&(a||o)){let t="",i=this.getColor(e.fShadowColor);t=this.fillatt.empty()?a<0&&o<0?`M0,0v${u-s}h${-s}v${-u}h${c}v${s}`:`M0,${u}v${s-u}h${-s}v${u}h${c}v${-s}`:`M${a*s},${o*s}v${u}h${c}v${-u}`,this.draw_g.append("svg:path").attr("d",t+"z").style("fill",i).style("stroke",i).style("stroke-width","1px")}if(e.fNpaves)for(let t=e.fNpaves-1;t>0;--t)this.draw_g.append("svg:path").attr("d",`M${4*a*t},${4*o*t}h${c}v${u}h${-c}z`).call(this.fillatt.func).call(this.lineatt.func);return l()&&this.fillatt.empty()&&this.lineatt.empty()||(h=this.draw_g.append("svg:path").attr("d",`M0,0H${c}V${u}H0Z`).call(this.fillatt.func).call(this.lineatt.func)),(this.paveDrawFunc?this.paveDrawFunc(c,u,t):Promise.resolve(!0)).then((()=>(l()||"TPave"===e._typename||(h.style("pointer-events","visibleFill").on("mouseenter",(()=>this.showObjectStatus())),Mv(this,{obj:e,x:this._pave_x,y:this._pave_y,width:c,height:u,minwidth:10,minheight:20,canselect:!0,redraw:()=>{this.interactiveRedraw(!1,"pave_moved"),this.drawPave()},ctxmenu:d.touches&&m.ContextMenu&&this.UseContextMenu}),this.UseContextMenu&&m.ContextMenu&&this.draw_g.on("contextmenu",(t=>this.paveContextMenu(t))),"TPaletteAxis"==e._typename&&this.interactivePaletteAxis(c,u)),this)))}fillWebObjectOptions(t){if(!t){if(!this.snapid)return null;t={_typename:"TWebObjectOptions",snapid:this.snapid.toString(),opt:this.getDrawOpt(),fcust:"",fopt:[]}}let e=this.getObject();return e&&e.fInit&&(t.fcust="pave",t.fopt=[e.fX1NDC,e.fY1NDC,e.fX2NDC,e.fY2NDC]),t}drawPaveLabel(t,e){this.UseTextColor=!0;let i=this.getObject();return this.startTextDrawing(i.fTextFont,e/1.2),this.drawText({align:i.fTextAlign,width:t,height:e,text:i.fLabel,color:this.getColor(i.fTextColor)}),this.finishTextDrawing()}drawPaveStats(t,e){this.isStats()&&this.fillStatistic();let i=this.getObject(),n=[],r=this.getColor(i.fTextColor),s=0,a=0,o=0;for(let t=0;t<i.fLines.arr.length;++t){let e=i.fLines.arr[t];"TText"!=e._typename&&"TLatex"!=e._typename||n.push(e.fTitle)}let l=n.length;for(let t=0;t<l;++t){let e=n[t];if(t>0&&(o=Math.max(o,e.length)),0==t||e.indexOf("|")<0)continue;0===s&&(s=t);let i=e.split("|");i.length>a&&(a=i.length)}let h=e/l,c=!1,d=i.fMargin*t;if(this.startTextDrawing(i.fTextFont,e/(1.2*l)),this.UseTextColor=!0,1==l)this.drawText({align:i.fTextAlign,width:t,height:e,text:n[0],color:r,latex:1});else for(let e=0;e<l;++e){let i=e*h;if(this.UseTextColor=!0,s&&e>=s){let s=n[e].split("|");for(let e=0;e<s.length;++e)this.drawText({align:"middle",x:t*e/a,y:i,latex:0,width:t/a,height:h,text:s[e],color:r})}else if(n[e].indexOf("=")<0){if(0==e){c=!0;let i=Math.max(o,Math.round((t-2*d)/h/.65));n[e].length>i+5&&(n[e]=n[e].slice(0,i+2)+"...")}this.drawText({align:0==e?"middle":"start",x:d,y:i,width:t-2*d,height:h,text:n[e],color:r})}else{let s=n[e].split("="),a=[];for(let e=0;e<2;++e){let n={align:0==e?"start":"end",x:d,y:i,width:t-2*d,height:h,text:s[e],color:r,_expected_width:t-2*d,_args:a,post_process:function(t){this._args[0].ready&&this._args[1].ready&&t.scaleTextDrawing(1.05*(this._args[0].result_width+this._args[1].result_width)/this._expected_width,t.draw_g)}};a.push(n)}for(let t=0;t<2;++t)this.drawText(a[t])}}let u="";if(i.fBorderSize>0&&c&&(u+=`M0,${Math.round(h)}h${t}`),s>0&&a>1){for(let e=s;e<l;++e)u+=`M0,${Math.round(e*h)}h${t}`;for(let i=0;i<a-1;++i)u+=`M${Math.round(t/a*(i+1))},${Math.round(s*h)}V${e}`}return u&&this.draw_g.append("svg:path").attr("d",u).call(this.lineatt.func),this.finishTextDrawing(void 0,l>1)}drawPaveText(t,e,i,n){let r=this.getObject(),s=this.getColor(r.fTextColor),a=0,o=[],l=this.getPadPainter(),h=l.getPadHeight(),c=!1,d=r.fLabel.length>0,u=[];n||(n=this.draw_g),r.fLines.arr.forEach((t=>{"TText"!=t._typename&&"TLatex"!=t._typename||(a++,(t.fX>0||t.fY>0)&&(c=!0))}));let f=1==a&&l&&l._fast_drawing,m=0;if(r.fLines.arr.forEach((i=>{let l=a>0?Math.round((1-(m-.5)/a)*e):0;switch(i._typename){case"TText":case"TLatex":if(m++,c){let a=i.fX,o=i.fY;a=a>0&&a<1?Math.round(a*t):r.fMargin*t,o=o>0&&o<1?Math.round((1-o)*e):l;let c=i.fTextColor?this.getColor(i.fTextColor):"";c||(c=s,this.UseTextColor=!0);let d=n.append("svg:g");this.startTextDrawing(r.fTextFont,(i.fTextSize||r.fTextSize)*h,d),this.drawText({align:i.fTextAlign||r.fTextAlign,x:a,y:o,text:i.fTitle,color:c,latex:"TText"==i._typename?0:1,draw_g:d,fast:f}),u.push(this.finishTextDrawing(d))}else o.push(i);break;case"TLine":case"TBox":let a=i.fX1,d=i.fX2,p=i.fY1,g=i.fY2;if(0!==a&&(a=Math.round(a*t)),d=d?Math.round(d*t):t,p=p?Math.round((1-p)*e):l,g=g?Math.round((1-g)*e):l,"TLine"==i._typename){let t=new Hl(i);n.append("svg:path").attr("d",`M${a},${p}L${d},${g}`).call(t.func)}else{let t=this.createAttFill(i);n.append("svg:path").attr("d",`M${a},${p}H${d}V${g}H${a}Z`).call(t.func)}}})),!c){let i=e/a,l=r.fMargin*t,c=0;1==a&&r.fTextSize>0&&(c=Math.round(r.fTextSize*h),c<3&&(c=3)),this.startTextDrawing(r.fTextFont,e/(1.2*a),n,c);for(let c=0;c<a;++c){let d=null,u=o[c];1==a?d={x:0,y:0,width:t,height:e}:(d={x:l,y:c*i,width:t-2*l,height:i},u.fTextColor&&(d.color=this.getColor(u.fTextColor)),u.fTextSize&&(d.font_size=Math.round(u.fTextSize*h))),d.align=r.fTextAlign,d.draw_g=n,d.latex="TText"==u._typename?0:1,d.text=u.fTitle,d.fast=f,d.color||(this.UseTextColor=!0,d.color=s),this.drawText(d)}u.push(this.finishTextDrawing(n,a>1))}if(d){let i=Math.round(.25*t),a=Math.round(.02*-e),o=Math.round(.5*t),l=Math.round(.04*e),h=n.append("svg:g");h.append("svg:path").attr("d",`M${i},${a}h${o}v${l}h${-o}z`).call(this.fillatt.func).call(this.lineatt.func),this.startTextDrawing(r.fTextFont,l/1.5,h),this.drawText({align:22,x:i,y:a,width:o,height:l,text:r.fLabel,color:s,draw_g:h}),u.push(this.finishTextDrawing(h)),this.UseTextColor=!0}return Promise.all(u).then((()=>this))}format(t,e){e||(e="stat");let i=this.getObject();switch(e){case"stat":e=i.fStatFormat||p.fStatFormat;break;case"fit":e=i.fFitFormat||p.fFitFormat;break;case"entries":if(Math.abs(t)<1e9&&Math.round(t)==t)return t.toFixed(0);e="14.7g";break;case"last":e=this.lastformat}let n=rl(t,e||"6.4g",!0);return this.lastformat=n[1],n[0]}drawLegend(t,e){let i=this.getObject(),n=i.fPrimitives.arr.length,r=i.fNColumns,s=n;if(r<2)r=1;else for(;(s-1)*r>=n;)s--;const a=t=>!(t.fObject||t.fOption||t.fLabel&&" "!=t.fLabel);if(1==r)for(let t=0;t<n;++t)a(i.fPrimitives.arr[t])&&s--;s<1&&(s=1);let o=this.getColor(i.fTextColor),l=Math.round(t/r),h=Math.round(.03*t/r),c=Math.round(.03*e),d=(e-2*c)/s,u=.9*d,f=0,m=this.getPadPainter(),p=m.getPadHeight(),g=!1,_=-1;i.fTextSize&&p*i.fTextSize>2&&p*i.fTextSize<u&&(u=f=Math.round(p*i.fTextSize)),this.startTextDrawing(i.fTextFont,u,this.draw_g,f);for(let t=0;t<n;++t){let e=i.fPrimitives.arr[t];if(a(e))continue;1==r?++_:_=t;let n=e.fOption.toLowerCase(),s=_%r,u=(_-s)/r,f=s*l,p=f+Math.round(i.fMargin*l),x=Math.round((f+p)/2),y=Math.round(u*d+c),A=Math.round((u+.5)*d+c),v=e,b=e,w=e,M=e.fObject,T=null,S=!1;const C=-1!=n.indexOf("f"),P=-1!=n.indexOf("l"),E=-1!=n.indexOf("e"),k=-1!=n.indexOf("p");if(null!==M&&"object"==typeof M&&("fLineColor"in M&&(w=M),"fFillColor"in M&&(v=M),"fMarkerColor"in M&&(b=M),T=m.findPainterFor(M)),C){let t,e=T&&T.fillatt?T.fillatt:this.createAttFill(v);if(n.indexOf("l")<0&&n.indexOf("e")<0&&n.indexOf("p")<0&&(t=T&&T.lineatt?T.lineatt:new Hl(w),t.empty()&&(t=null)),!e.empty()||t){S=!0;let i=this.draw_g.append("svg:path").attr("d",`M${f+h},${Math.round(y+.1*d)}v${Math.round(.8*d)}h${p-2*h-f}v${-Math.round(.8*d)}z`).call(e.func);t&&i.call(t.func)}}if(P||E){let t=T&&T.lineatt?T.lineatt:new Hl(w);t.empty()||(S=!0,this.draw_g.append("svg:path").attr("d",`M${f+h},${A}H${p-h}`).call(t.func),E&&this.draw_g.append("svg:path").attr("d",`M${x},${Math.round(y+.1*d)}V${Math.round(y+.9*d)}`).call(t.func))}if(k){let t=T&&T.markeratt?T.markeratt:new ql(b);t.empty()||(S=!0,this.draw_g.append("svg:path").attr("d",t.create((f+p)/2,A)).call(t.func))}!S&&T&&T.lineatt&&!T.lineatt.empty()&&this.draw_g.append("svg:path").attr("d",`M${f+h},${Math.round(y+.1*d)}v${Math.round(.8*d)}h${p-2*h-f}v${-Math.round(.8*d)}z`).style("fill","none").call(T.lineatt.func);let D=p;n.length>0?g=!0:g||(D=f+h),e.fLabel&&this.drawText({align:i.fTextAlign,x:D,y:y,width:f+l-D-h,height:d,text:e.fLabel,color:o})}return this.finishTextDrawing()}drawPaletteAxis(t,e,i){let n,r,s=this.getObject(),a=s.fAxis,o="string"==typeof i&&i.indexOf("can_move")>=0,l="string"==typeof i&&i.indexOf("postpone")>=0,h="string"==typeof i&&i.indexOf("cjust")>=0,c=this.getPadPainter().getPadWidth(),d=this.getPadPainter().getPadHeight(),u=this.getPadPainter().getRootPad(!0),f=s.$main_painter||this.getMainPainter(),g=this.getFramePainter(),_=0,x=100,y=f.fContour,A=y?y.getLevels():null,v=f.fPalette,b="";if(this._palette_vertical=s.fX2NDC-s.fX1NDC<s.fY2NDC-s.fY1NDC,a.fTickSize=.6*t/c,y&&g?void 0!==g.zmin&&void 0!==g.zmax&&g.zmin!==g.zmax?(n=g.zmin,r=g.zmax,_=g.zoom_zmin,x=g.zoom_zmax,_===x&&(_=n,x=r)):(_=A[0],x=A[A.length-1]):void 0!==f.gmaxbin&&void 0!==f.gminbin?(_=f.gminbin,x=f.gmaxbin):void 0!==f.hmin&&void 0!==f.hmax&&(_=f.hmin,x=f.hmax),this.draw_g.selectAll("rect").style("fill","white"),void 0!==n&&void 0!==r&&n!=r||(n=_,r=x),this._palette_vertical?(this._swap_side=s.fX2NDC<.5,this.z_handle.configureAxis("zaxis",n,r,_,x,!0,[0,e],{log:u?u.fLogz:0,fixed_ticks:h?A:null,max_tick_size:Math.round(.7*t),swap_side:this._swap_side}),b=this._swap_side?"":`translate(${t})`):(this._swap_side=s.fY1NDC>.5,this.z_handle.configureAxis("zaxis",n,r,_,x,!1,[0,t],{log:u?u.fLogz:0,fixed_ticks:h?A:null,max_tick_size:Math.round(.7*e),swap_side:this._swap_side}),b=this._swap_side?"":`translate(0,${e})`),y&&v&&!l)for(let i=0;i<A.length-1;++i){let n,r=Math.round(this.z_handle.gr(A[i])),s=Math.round(this.z_handle.gr(A[i+1])),a=(A[i]+A[i+1])/2;if(this._palette_vertical){if(s>=e||r<0)continue;r+=1,r>e?(r=e,a=.001*A[i]+.999*A[i+1]):s<0&&(s=0,a=.999*A[i]+.001*A[i+1]),n=`M0,${s}H${t}V${r}H0Z`}else{if(r>=t||s<0)continue;s+=1,s>t?(s=t,a=.999*A[i]+.001*A[i+1]):r<0&&(r=0,a=.001*A[i]+.999*A[i+1]),n=`M${r},0V${e}H${s}V0Z`}let o=y.getPaletteColor(v,a);if(!o)continue;let l=this.draw_g.append("svg:path").attr("d",n).style("fill",o).property("fill0",o).property("fill1",ut(o).darker(.5).formatHex());this.isTooltipAllowed()&&l.on("mouseover",(function(){Ii(this).transition().duration(100).style("fill",Ii(this).property("fill1"))})).on("mouseout",(function(){Ii(this).transition().duration(100).style("fill",Ii(this).property("fill0"))})).append("svg:title").text(A[i].toFixed(2)+" - "+A[i+1].toFixed(2)),m.Zooming&&l.on("dblclick",(()=>this.getFramePainter().unzoom("z")))}else this.draw_g.append("svg:path").attr("d",`M0,0H${t}V${e}H0Z`).style("fill","white");return this.z_handle.drawAxis(this.draw_g,t,e,b).then((()=>{if(o&&"getBoundingClientRect"in this.draw_g.node()){let t=this.draw_g.node().getBoundingClientRect();if(this._palette_vertical){let e=this._pave_x+parseInt(t.width)-Math.round(.995*c)+3;e>0&&(this._pave_x-=e,this.draw_g.attr("transform",`translate(${this._pave_x},${this._pave_y})`),s.fX1NDC-=e/c,s.fX2NDC-=e/c)}else{let e=Math.round((1.05-p.fTitleY)*d)-t.y;e>0&&(this._pave_y+=e,this.draw_g.attr("transform",`translate(${this._pave_x},${this._pave_y})`),s.fY1NDC-=e/d,s.fY2NDC-=e/d)}}return this}))}interactivePaletteAxis(t,e){let i=!1,n=0,r=0,s=null;const a=a=>{if(!i)return;a.preventDefault();let o=qi(a,this.draw_g.node());this._palette_vertical?(r=Math.min(Math.max(o[1],0),e),s.attr("y",Math.min(n,r)).attr("height",Math.abs(r-n))):(r=Math.min(Math.max(o[0],0),t),s.attr("x",Math.min(n,r)).attr("width",Math.abs(r-n)))},o=t=>{if(!i)return;t.preventDefault(),Ii(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),s.remove(),s=null,i=!1;let e=this.z_handle.gr,a=e.invert(n),o=e.invert(r);this.getFramePainter().zoom("z",Math.min(a,o),Math.max(a,o))};m.Zooming&&this.draw_g.selectAll(".axis_zoom").on("mousedown",(l=>{if(i)return;i=!0,l.preventDefault(),l.stopPropagation();let h=qi(l,this.draw_g.node());s=this.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect"),this._palette_vertical?(n=r=h[1],s.attr("x","0").attr("width",t).attr("y",n).attr("height",1)):(n=r=h[0],s.attr("x",n).attr("width",1).attr("y",0).attr("height",e)),Ii(window).on("mousemove.colzoomRect",a).on("mouseup.colzoomRect",o,!0)})).on("dblclick",(()=>this.getFramePainter().unzoom("z"))),m.ZoomWheel&&this.draw_g.on("wheel",(i=>{let n=qi(i,this.draw_g.node()),r=this._palette_vertical?1-n[1]/e:n[0]/t,s=this.z_handle.analyzeWheelEvent(i,r);s&&s.changed&&this.getFramePainter().zoom("z",s.min,s.max)}))}fillContextMenu(t){let e=this.getObject();if(t.add("header: "+e._typename+"::"+e.fName),this.isStats()){function i(i,n){let r=i<10?e.fOptStat:e.fOptFit;r=parseInt(parseInt(r)/parseInt(Math.pow(10,i%10)))%10,t.addchk(r,n,100*r+i,(function(t){let i=t%100<10?e.fOptStat:e.fOptFit,n=parseInt(t/100);i-=(n>0?n:-1)*parseInt(Math.pow(10,t%10)),t%100<10?(e.fOptStat=i,this.interactiveRedraw(!0,`exec:SetOptStat(${i})`)):(e.fOptFit=i,this.interactiveRedraw(!0,`exec:SetOptFit(${i})`))}))}t.add("Default position",(function(){e.fX2NDC=p.fStatX,e.fX1NDC=e.fX2NDC-p.fStatW,e.fY2NDC=p.fStatY,e.fY1NDC=e.fY2NDC-p.fStatH,e.fInit=1,this.interactiveRedraw(!0,"pave_moved")})),t.add("SetStatFormat",(()=>{t.input("Enter StatFormat",e.fStatFormat).then((t=>{t&&(e.fStatFormat=t,this.interactiveRedraw(!0,`exec:SetStatFormat("${t}")`))}))})),t.add("SetFitFormat",(()=>{t.input("Enter FitFormat",e.fFitFormat).then((t=>{t&&(e.fFitFormat=t,this.interactiveRedraw(!0,`exec:SetFitFormat("${t}")`))}))})),t.add("separator"),t.add("sub:SetOptStat",(()=>{t.input("Enter OptStat",e.fOptStat,"int").then((t=>{e.fOptStat=t,this.interactiveRedraw(!0,`exec:SetOptStat(${t}`)}))})),i(0,"Histogram name"),i(1,"Entries"),i(2,"Mean"),i(3,"Std Dev"),i(4,"Underflow"),i(5,"Overflow"),i(6,"Integral"),i(7,"Skewness"),i(8,"Kurtosis"),t.add("endsub:"),t.add("sub:SetOptFit",(()=>{t.input("Enter OptStat",e.fOptFit,"int").then((t=>{e.fOptFit=t,this.interactiveRedraw(!0,`exec:SetOptFit(${t})`)}))})),i(10,"Fit parameters"),i(11,"Par errors"),i(12,"Chi square / NDF"),i(13,"Probability"),t.add("endsub:"),t.add("separator")}else"title"===e.fName&&t.add("Default position",(function(){e.fX1NDC=.28,e.fY1NDC=.94,e.fX2NDC=.72,e.fY2NDC=.99,e.fInit=1,this.interactiveRedraw(!0,"pave_moved")}));return this.UseTextColor&&t.addTextAttributesMenu(this),t.addAttributesMenu(this),t.size()>0&&this.showInspector("check")&&t.add("Inspect",this.showInspector),t.size()>0}paveContextMenu(t){if(this.z_handle){let e=this.getFramePainter();e&&e.showContextMenu&&e.showContextMenu("z",t)}else t.stopPropagation(),t.preventDefault(),vv(t,this).then((t=>(this.fillContextMenu(t),this.fillObjectExecMenu(t,"title")))).then((t=>t.show()))}isStats(){return this.matchObjectType("TPaveStats")}clearPave(){this.getObject().Clear()}addText(t){this.getObject().AddText(t)}fillFunctionStat(t,e){if(!e||!t)return!1;let i=e%10,n=Math.floor(e/10)%10,r=Math.floor(e/100)%10,s=Math.floor(e/1e3)%10;if(r>0&&this.addText("#chi^2 / ndf = "+this.format(t.fChisquare,"fit")+" / "+t.fNDF),s>0&&this.addText("Prob = "+this.format($A(t.fChisquare,t.fNDF))),i>0)for(let e=0;e<t.GetNumPars();++e){let i=t.GetParName(e),r=t.GetParValue(e),s=t.GetParError(e);r=void 0===r?"<not avail>":this.format(Number(r),"fit"),void 0!==s&&(s=this.format(s,"last"),0===Number(s)&&0!=t.GetParError(e)&&(s=this.format(t.GetParError(e),"4.2g"))),n>0&&s?this.addText(i+" = "+r+" #pm "+s):this.addText(i+" = "+r)}return!0}fillStatistic(){let t=this.getPadPainter();if(t&&t._fast_drawing)return!1;let e=this.getObject(),i=e.$main_painter||this.getMainPainter();if("stats"!==e.fName)return!1;if(!i||"function"!=typeof i.fillStatistic)return!1;let n=parseInt(e.fOptStat),r=parseInt(e.fOptFit);if(Number.isInteger(n)||(n=p.fOptStat),Number.isInteger(r)||(r=p.fOptFit),!i.fillStatistic(this,n,r))return!1;let s=e.fLines.arr.length,a=s*p.StatFontSize;return(a<=0||p.StatFont%10==3)&&(a=.25*s*p.StatH,e.fY1NDC=e.fY2NDC-a),!0}isDummyPos(t){return!t||!(t.fInit||t.fX1||t.fX2||t.fY1||t.fY2||t.fX1NDC||t.fX2NDC||t.fY1NDC||t.fY2NDC)}updateObject(t){if(!this.matchObjectType(t))return!1;let e=this.getObject();switch(e.modified_NDC||this.isDummyPos(t)||(this.stored&&!t.fInit&&this.stored.fX1==t.fX1&&this.stored.fX2==t.fX2&&this.stored.fY1==t.fY1&&this.stored.fY2==t.fY2?(this.stored.fX1NDC!=t.fX1NDC&&(e.fX1NDC=t.fX1NDC),this.stored.fX2NDC!=t.fX2NDC&&(e.fX2NDC=t.fX2NDC),this.stored.fY1NDC!=t.fY1NDC&&(e.fY1NDC=t.fY1NDC),this.stored.fY2NDC!=t.fY2NDC&&(e.fY2NDC=t.fY2NDC)):(e.fInit=t.fInit,e.fX1=t.fX1,e.fX2=t.fX2,e.fY1=t.fY1,e.fY2=t.fY2,e.fX1NDC=t.fX1NDC,e.fX2NDC=t.fX2NDC,e.fY1NDC=t.fY1NDC,e.fY2NDC=t.fY2NDC),this.stored=Object.assign({},t)),e.fOption=t.fOption,e.fBorderSize=t.fBorderSize,t._typename){case"TPaveText":return e.fLines=A(t.fLines),!0;case"TPavesText":return e.fLines=A(t.fLines),e.fNpaves=t.fNpaves,!0;case"TPaveLabel":return e.fLabel=t.fLabel,!0;case"TPaveStats":return e.fOptStat=t.fOptStat,e.fOptFit=t.fOptFit,!0;case"TLegend":let i=e.fPrimitives;if(e.fPrimitives=t.fPrimitives,e.fNColumns=t.fNColumns,i&&i.arr&&e.fPrimitives&&e.fPrimitives.arr&&i.arr.length==e.fPrimitives.arr.length)for(let t=0;t<i.arr.length;++t){let n=i.arr[t].fObject,r=e.fPrimitives.arr[t].fObject;n&&r&&n._typename==r._typename&&n.fName==r.fName&&(e.fPrimitives.arr[t].fObject=n)}return!0;case"TPaletteAxis":return e.fBorderSize=1,e.fShadowColor=0,!0}return!1}redraw(){return this.drawPave()}cleanup(){this.z_handle&&(this.z_handle.cleanup(),delete this.z_handle),super.cleanup()}static canDraw(t){let e=t?._typename;return"TPave"==e||"TPaveLabel"==e||"TPaveStats"==e||"TPaveText"==e||"TPavesText"==e||"TDiamond"==e||"TLegend"==e||"TPaletteAxis"==e}static draw(t,e,i){let n=new $v(t,e);return Vv(n,!1).then((()=>{if("title"===e.fName&&"TPaveText"===e._typename){let t=n.getPadPainter().findPainterFor(null,"title");if(t&&t!==n)t.removeFromPadPrimitives(),t.cleanup();else if("postitle"==i||n.isDummyPos(e)){let t=p,i=n.getFramePainter();if(t&&i){let n=t.fTitleX,r=t.fTitleY,s=t.fTitleW,a=t.fTitleH;a||(a=.7*(r-i.fY2NDC)),s||(s=i.fX2NDC-i.fX1NDC),(!Number.isFinite(a)||a<=0)&&(a=.06),(!Number.isFinite(s)||s<=0)&&(s=.44),e.fX1NDC=n-s/2,e.fY1NDC=r-a,e.fX2NDC=n+s/2,e.fY2NDC=r,e.fInit=1}}}else"TPaletteAxis"===e._typename&&(e.fBorderSize=1,e.fShadowColor=0,e.fAxis&&(e.fAxis.fChopt||(e.fAxis.fChopt="+"),e.fAxis.fNdiv||(e.fAxis.fNdiv=12),e.fAxis.fLabelOffset||(e.fAxis.fLabelOffset=.005)),n.z_handle=new Dy(t,e.fAxis,!0),n.z_handle.setPadName(n.getPadName()),n.UseContextMenu=!0);switch(e._typename){case"TPaveLabel":n.paveDrawFunc=n.drawPaveLabel;break;case"TPaveStats":n.paveDrawFunc=n.drawPaveStats,n.$secondary=!0;break;case"TPaveText":case"TPavesText":case"TDiamond":n.paveDrawFunc=n.drawPaveText;break;case"TLegend":n.paveDrawFunc=n.drawLegend;break;case"TPaletteAxis":n.paveDrawFunc=n.drawPaletteAxis}return n.drawPave(i)}))}}function Wv(t,e){let i=Wl(t),n=i?i.getPadPainter():null,r=n?n.getRootPad(!0):null;if(!r)return Promise.resolve(null);let s=k("TLegend");for(let t=0;t<n.painters.length;++t){let i=n.painters[t],r=i.getObject();if(!r)continue;let a=k("TLegendEntry");a.fObject=r,a.fLabel="all"==e?r.fName:i.getItemName(),a.fOption="",a.fLabel&&(i.lineatt&&i.lineatt.used&&(a.fOption+="l"),i.fillatt&&i.fillatt.used&&(a.fOption+="f"),i.markeratt&&i.markeratt.used&&(a.fOption+="m"),a.fOption||(a.fOption="l"),s.fPrimitives.Add(a))}let a=s.fPrimitives.arr.length;return a?(a>8&&(a=8),a*=.1,s.fX1NDC=.4*r.fLeftMargin+.6*(1-r.fRightMargin),s.fY1NDC=(1-a)*(1-r.fTopMargin)+a*r.fBottomMargin,s.fX2NDC=.99-r.fRightMargin,s.fY2NDC=.99-r.fTopMargin,s.fFillStyle=1001,$v.draw(t,s)):void 0}var Zv=Object.freeze({__proto__:null,TPavePainter:$v,produceLegend:Wv});const Qv=1,Jv=2,Kv=3,tb=4,eb=5;function ib(){const t=(t,e,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t),e=(e,i,n)=>{const r=i<.5?i*(1+n):i+n-i*n,s=2*i-r,a=t(s,r,e+1/3),o=t(s,r,e),l=t(s,r,e-1/3);return"#"+zl(a)+zl(o)+zl(l)},i=[];for(let t=0;t<50;++t){const n=(280-5.6*(t+1))/360;i.push(e(n,.5,1))}return new Il(i)}function nb(t){if((t=t||m.Palette)>0&&t<10)return function(){let t=[];for(let e=0;e<50;++e){const i=zl((e+2)/60);t.push("#"+i+i+i)}return new Il(t)}();if(t<51)return ib();t>113&&(t=57);let e,i=[0,.125,.25,.375,.5,.625,.75,.875,1];switch(t){case 51:e=[[0,9,13,17,24,32,27,25,29],[0,0,0,2,37,74,113,160,221],[28,42,59,78,98,129,154,184,221]];break;case 52:e=[[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255]];break;case 53:e=[[0,45,99,156,212,230,237,234,242],[0,0,0,45,101,168,238,238,243],[0,1,1,3,9,8,11,95,230]];break;case 54:e=[[0,22,44,68,93,124,160,192,237],[0,16,41,67,93,125,162,194,241],[97,100,99,99,93,68,44,26,74]];break;case 55:e=[[0,5,15,35,102,196,208,199,110],[0,48,124,192,206,226,97,16,0],[99,142,198,201,90,22,13,8,2]];break;case 56:e=[[242,234,237,230,212,156,99,45,0],[243,238,238,168,101,45,0,0,0],[230,95,11,8,9,3,1,1,0]];break;case 57:e=[[53.091,15.096,19.89,5.916,45.951,135.1755,208.743,253.878,248.982],[42.432,91.7745,128.5455,163.6845,183.039,191.046,186.864,200.481,250.716],[134.9715,221.442,213.8175,201.807,163.8375,118.881,89.2245,50.184,13.7445]];break;case 58:e=[[0,24,2,54,176,236,202,194,255],[0,29,92,129,117,120,176,236,255],[0,68,80,34,57,172,252,245,255]];break;case 59:e=[[13,23,25,63,76,104,137,161,206],[95,67,37,21,0,12,35,52,79],[4,3,2,6,11,22,49,98,208]];break;case 60:e=[[0,61,89,122,143,160,185,204,231],[0,0,0,0,14,37,72,132,235],[0,140,224,144,4,5,6,9,13]];break;case 61:e=[[14,7,2,0,5,11,55,131,229],[105,56,26,1,42,74,131,171,229],[2,21,35,60,92,113,160,185,229]];break;case 62:e=[[0,0,0,70,148,231,235,237,244],[0,0,0,0,0,69,67,216,244],[0,102,228,231,177,124,137,20,244]];break;case 63:e=[[50,56,63,68,93,121,165,192,241],[66,81,91,96,111,128,155,189,241],[97,91,75,65,77,103,143,167,217]];break;case 64:e=[[145,166,167,156,131,114,101,112,132],[158,178,179,181,163,154,144,152,159],[190,199,201,192,176,169,160,166,190]];break;case 65:e=[[93,91,99,108,130,125,132,155,174],[126,124,128,129,131,121,119,153,173],[103,94,87,85,80,85,107,120,146]];break;case 66:e=[[24,40,69,90,104,114,120,132,103],[29,52,94,127,150,162,159,151,101],[29,52,96,132,162,181,184,186,131]];break;case 67:e=[[46,38,61,92,113,121,132,150,191],[46,36,40,69,110,135,131,92,34],[46,80,74,70,81,105,165,211,225]];break;case 68:e=[[0,4,12,30,52,101,142,190,237],[0,40,86,121,140,172,187,213,240],[0,9,14,18,21,23,27,35,101]];break;case 69:e=[[198,206,206,211,198,181,161,171,244],[103,133,150,172,178,174,163,175,244],[49,54,55,66,91,130,184,224,244]];break;case 70:e=[[243,243,240,240,241,239,186,151,129],[0,46,99,149,194,220,183,166,147],[6,8,36,91,169,235,246,240,233]];break;case 71:e=[[22,19,19,25,35,53,88,139,210],[0,32,69,108,135,159,183,198,215],[77,96,110,116,110,100,90,78,70]];break;case 72:e=[[68,116,165,182,189,180,145,111,71],[37,82,135,178,204,225,221,202,147],[16,55,105,147,196,226,232,224,178]];break;case 73:e=[[61,99,136,181,213,225,198,136,24],[149,140,96,83,132,178,190,135,22],[214,203,168,135,110,100,111,113,22]];break;case 74:e=[[76,120,156,183,197,180,162,154,140],[34,35,42,69,102,137,164,188,197],[64,69,78,105,142,177,205,217,198]];break;case 75:e=[[37,102,157,188,196,214,223,235,251],[37,29,25,37,67,91,132,185,251],[37,32,33,45,66,98,137,187,251]];break;case 76:e=[[79,100,119,137,153,172,192,205,250],[63,79,93,103,115,135,167,196,250],[51,59,66,61,62,70,110,160,250]];break;case 77:e=[[43,44,50,66,125,172,178,155,157],[63,63,85,101,138,163,122,51,39],[121,101,58,44,47,55,57,44,43]];break;case 78:e=[[0,41,62,79,90,87,99,140,228],[0,57,81,93,85,70,71,125,228],[95,91,91,82,60,43,44,112,228]];break;case 79:e=[[49,59,72,88,114,141,176,205,222],[78,72,66,57,59,75,106,142,173],[78,55,46,40,39,39,40,41,47]];break;case 80:e=[[243,222,201,185,165,158,166,187,219],[94,108,132,135,125,96,68,51,61],[7,9,12,19,45,89,118,146,118]];break;case 81:e=[[19,44,74,105,137,166,194,206,220],[19,28,40,55,82,110,159,181,220],[19,42,68,96,129,157,188,203,220]];break;case 82:e=[[33,44,70,99,140,165,199,211,216],[38,50,76,105,140,165,191,189,167],[55,67,97,124,140,166,163,129,52]];break;case 83:e=[[0,33,73,124,136,152,159,171,223],[0,43,92,124,134,126,121,144,223],[0,43,68,76,73,64,72,114,223]];break;case 84:e=[[5,18,45,124,193,223,205,128,49],[48,134,207,230,193,113,28,0,7],[6,15,41,121,193,226,208,130,49]];break;case 85:e=[[180,106,104,135,164,188,189,165,144],[72,126,154,184,198,207,205,190,179],[41,120,158,188,194,181,145,100,62]];break;case 86:e=[[57,72,94,117,136,154,174,192,215],[0,33,68,109,140,171,192,196,209],[116,137,173,201,200,201,203,190,187]];break;case 87:e=[[31,71,123,160,210,222,214,199,183],[40,117,171,211,231,220,190,132,65],[234,214,228,222,210,160,105,60,34]];break;case 88:e=[[123,108,109,126,154,172,188,196,218],[184,138,130,133,154,175,188,196,218],[208,130,109,99,110,122,150,171,218]];break;case 89:e=[[105,106,122,143,159,172,176,181,207],[252,197,194,187,174,162,153,136,125],[146,133,144,155,163,167,166,162,174]];break;case 90:e=[[171,141,145,152,154,159,163,158,177],[236,143,100,63,53,55,44,31,6],[59,48,46,44,42,54,82,112,179]];break;case 91:e=[[180,190,209,223,204,228,205,152,91],[93,125,147,172,181,224,233,198,158],[236,218,160,133,114,132,162,220,218]];break;case 92:e=[[225,183,162,135,115,111,119,145,211],[205,177,166,135,124,117,117,132,172],[186,165,155,135,126,130,150,178,226]];break;case 93:e=[[39,43,59,63,80,116,153,177,223],[39,43,59,74,91,114,139,165,223],[39,50,59,70,85,115,151,176,223]];break;case 94:e=[[0,38,60,76,84,89,101,128,204],[0,10,15,23,35,57,83,123,199],[0,11,22,40,63,86,97,94,85]];break;case 95:e=[[94,112,141,165,167,140,91,49,27],[27,46,88,135,166,161,135,97,58],[42,52,81,106,139,158,155,137,116]];break;case 96:e=[[30,49,79,117,135,151,146,138,147],[63,60,72,90,94,94,68,46,16],[18,28,41,56,62,63,50,36,21]];break;case 97:e=[[0,30,63,101,143,152,169,187,230],[0,14,28,42,58,61,67,74,91],[39,26,21,18,15,14,14,13,13]];break;case 98:e=[[149,140,164,179,182,181,131,87,61],[62,70,107,136,144,138,117,87,74],[40,38,45,49,49,49,38,32,34]];break;case 99:e=[[99,112,148,165,179,182,183,183,208],[39,40,57,79,104,127,148,161,198],[15,16,18,33,51,79,103,129,177]];break;case 100:e=[[99,116,154,174,200,196,201,201,230],[0,0,8,32,58,83,119,136,173],[5,6,7,9,9,14,17,19,24]];break;case 101:e=[[82,106,126,141,155,163,142,107,66],[62,44,69,107,135,152,149,132,119],[39,25,31,60,73,68,49,72,188]];break;case 102:e=[[18,29,44,72,116,158,184,208,221],[27,46,71,105,146,177,189,190,183],[39,55,80,108,130,133,124,100,76]];break;case 103:e=[[0,48,119,173,212,224,228,228,245],[0,13,30,47,79,127,167,205,245],[0,68,75,43,16,22,55,128,245]];break;case 104:e=[[34,70,129,187,225,226,216,193,179],[48,91,147,194,226,229,196,110,12],[234,212,216,224,206,110,53,40,29]];break;case 105:e=[[30,55,103,147,174,203,188,151,105],[0,65,138,182,187,175,121,53,9],[191,202,212,208,171,140,97,57,30]];break;case 106:e=[[112,97,113,125,138,159,178,188,225],[16,17,24,37,56,81,110,136,189],[38,35,46,59,78,103,130,152,201]];break;case 107:e=[[18,72,5,23,29,201,200,98,29],[0,0,43,167,211,117,0,0,0],[51,203,177,26,10,9,8,3,0]];break;case 108:e=[[19,42,64,88,118,147,175,187,205],[19,55,89,125,154,169,161,129,70],[19,32,47,70,100,128,145,130,75]];break;case 109:e=[[33,31,42,68,86,111,141,172,227],[255,175,145,106,88,55,15,0,0],[255,205,202,203,208,205,203,206,231]];break;case 110:e=[[0,25,50,79,110,145,181,201,254],[0,16,30,46,63,82,101,124,179],[0,12,21,29,39,49,61,74,103]];break;case 111:e=[[0,13,30,44,72,120,156,200,247],[0,36,84,117,141,153,151,158,247],[0,94,100,82,56,66,76,131,247]];break;case 112:e=[[26,51,43,33,28,35,74,144,246],[9,24,55,87,118,150,180,200,222],[30,96,112,114,112,101,72,35,0]];break;case 113:e=[[0,5,65,97,124,156,189,224,255],[32,54,77,100,123,148,175,203,234],[77,110,107,111,120,119,111,94,70]];break;default:return ib()}const n=e[0],r=e[1],s=e[2],a=[];for(let t=1;t<i.length;t++){const e=Math.round(Math.floor(255*i[t])-Math.floor(255*i[t-1]));for(let i=0;i<e;i++){const o="#"+zl(n[t-1]+i*(n[t]-n[t-1])/e,1)+zl(r[t-1]+i*(r[t]-r[t-1])/e,1)+zl(s[t-1]+i*(s[t]-s[t-1])/e,1);a.push(o)}}return new Il(a)}class rb{constructor(){this.reset()}reset(){Object.assign(this,{Axis:0,RevX:!1,RevY:!1,SymlogX:0,SymlogY:0,Bar:!1,BarStyle:0,Curve:!1,Hist:!0,Line:!1,Fill:!1,Error:!1,ErrorKind:-1,errorX:p.fErrorX,Mark:!1,Same:!1,Scat:!1,ScatCoef:1,Func:!0,Arrow:!1,Box:!1,BoxStyle:0,Text:!1,TextAngle:0,TextKind:"",Char:0,Color:!1,Contour:0,Cjust:!1,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Spec:!1,Pie:!1,List:!1,Zscale:!1,Zvert:!0,PadPalette:!1,Candle:"",Violin:"",Scaled:null,Circular:0,GLBox:0,GLColor:!1,Project:"",System:Qv,AutoColor:!1,NoStat:!1,ForceStat:!1,PadStats:!1,PadTitle:!1,AutoZoom:!1,HighRes:0,Zero:!0,Palette:0,BaseLine:!1,Optimize:m.OptimizeDraw,adjustFrame:!1,Mode3D:!1,x3dscale:1,y3dscale:1,Render3D:f.Render3D.Default,FrontBox:!0,BackBox:!0,_pmc:!1,_plc:!1,_pfc:!1,need_fillcol:!1,minimum:-1111,maximum:-1111,ymin:0,ymax:0})}decode(t,e,i,n,r){this.orginal=t;const s=new sl(t);if(1===e&&i.fSumw2.length>0)for(let t=0;t<i.fSumw2.length;++t)if(i.fSumw2[t]>0){this.Error=!0,this.Hist=!1,this.Zero=!1;break}this.ndim=e||1,this.PadStats=s.check("USE_PAD_STATS"),this.PadPalette=s.check("USE_PAD_PALETTE"),this.PadTitle=s.check("USE_PAD_TITLE"),s.check("PAL",!0)&&(this.Palette=s.partAsInt()),s.check("MINIMUM:",!0)?(this.ominimum=!0,this.minimum=parseFloat(s.part)):(this.ominimum=!1,this.minimum=i.fMinimum),s.check("MAXIMUM:",!0)?(this.omaximum=!0,this.maximum=parseFloat(s.part)):(this.omaximum=!1,this.maximum=i.fMaximum),s.check("HTITLE:",!0)&&(i.fTitle=decodeURIComponent(s.part.toLowerCase())),s.check("XTITLE:",!0)&&(i.fXaxis.fTitle=decodeURIComponent(s.part.toLowerCase())),s.check("YTITLE:",!0)&&(i.fYaxis.fTitle=decodeURIComponent(s.part.toLowerCase())),s.check("ZTITLE:",!0)&&(i.fZaxis.fTitle=decodeURIComponent(s.part.toLowerCase())),s.check("_ADJUST_FRAME_")&&(this.adjustFrame=!0),s.check("NOOPTIMIZE")&&(this.Optimize=0),s.check("OPTIMIZE")&&(this.Optimize=2),s.check("AUTOCOL")&&(this.AutoColor=!0),s.check("AUTOZOOM")&&(this.AutoZoom=!0),s.check("OPTSTAT",!0)&&(this.optstat=s.partAsInt()),s.check("OPTFIT",!0)&&(this.optfit=s.partAsInt()),s.check("NOSTAT")&&(this.NoStat=!0),s.check("STAT")&&(this.ForceStat=!0),s.check("NOTOOLTIP")&&r&&r.setTooltipAllowed(!1),s.check("TOOLTIP")&&r&&r.setTooltipAllowed(!0),s.check("SYMLOGX",!0)&&(this.SymlogX=s.partAsInt(0,3)),s.check("SYMLOGY",!0)&&(this.SymlogY=s.partAsInt(0,3)),s.check("X3DSC",!0)&&(this.x3dscale=s.partAsInt(0,100)/100),s.check("Y3DSC",!0)&&(this.y3dscale=s.partAsInt(0,100)/100);let a=!1,o=!1,l="",h=3==e;s.check("LOGXY")&&(a=o=!0),s.check("LOGX")&&(a=!0),s.check("LOGY")&&(o=!0),a&&n&&(n.fLogx=1,n.fUxmin=0,n.fUxmax=1,n.fX1=0,n.fX2=1),o&&n&&(n.fLogy=1,n.fUymin=0,n.fUymax=1,n.fY1=0,n.fY2=1),s.check("LOGZ")&&n&&(n.fLogz=1),s.check("GRIDXY")&&n&&(n.fGridx=n.fGridy=1),s.check("GRIDX")&&n&&(n.fGridx=1),s.check("GRIDY")&&n&&(n.fGridy=1),s.check("TICKXY")&&n&&(n.fTickx=n.fTicky=1),s.check("TICKX")&&n&&(n.fTickx=1),s.check("TICKY")&&n&&(n.fTicky=1),s.getColor=function(){if(this.color=this.partAsInt(1)-1,this.color>=0)return!0;for(let t=0;t<8;++t)if(Fl(t).toUpperCase()===this.part)return this.color=t,!0;return!1},s.check("FILL_",!0)&&s.getColor()&&(this.histoFillColor=s.color),s.check("LINE_",!0)&&s.getColor()&&(this.histoLineColor=Fl(s.color)),s.check("XAXIS_",!0)&&s.getColor()&&(i.fXaxis.fAxisColor=i.fXaxis.fLabelColor=i.fXaxis.fTitleColor=s.color),s.check("YAXIS_",!0)&&s.getColor()&&(i.fYaxis.fAxisColor=i.fYaxis.fLabelColor=i.fYaxis.fTitleColor=s.color);let c=!!r&&!!r.getMainPainter();s.check("X+")&&(this.AxisPos=10,this.second_x=c),s.check("Y+")&&(this.AxisPos+=1,this.second_y=c),s.check("SAMES")&&(this.Same=!0,this.ForceStat=!0),s.check("SAME")&&(this.Same=!0,this.Func=!0),s.check("SPEC")&&(this.Spec=!0),(s.check("BASE0")||s.check("MIN0")||p.fHistMinimumZero)&&(this.BaseLine=0),s.check("PIE")&&(this.Pie=!0),s.check("CANDLE",!0)&&(this.Candle=s.part),s.check("VIOLIN",!0)&&(this.Violin=s.part,delete this.Candle),s.check("NOSCALED")&&(this.Scaled=!1),s.check("SCALED")&&(this.Scaled=!0),s.check("GLBOX",!0)&&(this.GLBox=10+s.partAsInt()),s.check("GLCOL")&&(this.GLColor=!0),s.check("GL"),(s.check("CIRCULAR",!0)||s.check("CIRC",!0))&&(this.Circular=11,s.part.indexOf("0")>=0&&(this.Circular=10),s.part.indexOf("1")>=0&&(this.Circular=11),s.part.indexOf("2")>=0&&(this.Circular=12)),this.Chord=s.check("CHORD"),s.check("LEGO",!0)&&(this.Lego=1,s.part.indexOf("0")>=0&&(this.Zero=!1),s.part.indexOf("1")>=0&&(this.Lego=11),s.part.indexOf("2")>=0&&(this.Lego=12),s.part.indexOf("3")>=0&&(this.Lego=13),s.part.indexOf("4")>=0&&(this.Lego=14),l=s.part,s.part.indexOf("Z")>=0&&(this.Zscale=!0)),s.check("R3D_",!0)&&(this.Render3D=f.Render3D.fromString(s.part.toLowerCase())),s.check("SURF",!0)&&(this.Surf=s.partAsInt(10,1),l=s.part,s.part.indexOf("Z")>=0&&(this.Zscale=!0)),s.check("TF3",!0)&&(l=s.part),s.check("ISO",!0)&&(l=s.part),s.check("LIST")&&(this.List=!0),s.check("CONT",!0)&&e>1&&(this.Contour=1,s.part.indexOf("Z")>=0&&(this.Zscale=!0),s.part.indexOf("1")>=0?this.Contour=11:s.part.indexOf("2")>=0?this.Contour=12:s.part.indexOf("3")>=0?this.Contour=13:s.part.indexOf("4")>=0&&(this.Contour=14)),s.check("HBAR",!0)?this.BarStyle=20:s.check("BAR",!0)&&(this.BarStyle=10),this.BarStyle>0&&(this.Hist=!1,this.need_fillcol=!0,this.BarStyle+=s.partAsInt()),s.check("ARR")&&(this.Arrow=!0),s.check("BOX",!0)&&(this.BoxStyle=10+s.partAsInt()),this.Box=this.BoxStyle>0,s.check("CJUST")&&(this.Cjust=!0),s.check("COL")&&(this.Color=!0),s.check("CHAR")&&(this.Char=1),s.check("FUNC")&&(this.Func=!0,this.Hist=!1),s.check("AXIS3D")&&(this.Axis=1,this.Lego=1,h=!0),s.check("AXIS")&&(this.Axis=1),s.check("AXIG")&&(this.Axis=2),s.check("TEXT",!0)&&(this.Text=!0,this.Hist=!1,this.TextAngle=Math.min(s.partAsInt(),90),s.part.indexOf("N")>=0&&(this.TextKind="N"),s.part.indexOf("E0")>=0&&(this.TextLine=!0),s.part.indexOf("E")>=0&&(this.TextKind="E")),s.check("SCAT=",!0)&&(this.Scat=!0,this.ScatCoef=parseFloat(s.part),(!Number.isFinite(this.ScatCoef)||this.ScatCoef<=0)&&(this.ScatCoef=1)),s.check("SCAT")&&(this.Scat=!0),s.check("POL")&&(this.System=Jv),s.check("CYL")&&(this.System=Kv),s.check("SPH")&&(this.System=tb),s.check("PSR")&&(this.System=eb),s.check("TRI",!0)&&(this.Color=!1,this.Tri=1,l=s.part,s.part.indexOf("ERR")>=0&&(this.Error=!0)),s.check("AITOFF")&&(this.Proj=1),s.check("MERCATOR")&&(this.Proj=2),s.check("SINUSOIDAL")&&(this.Proj=3),s.check("PARABOLIC")&&(this.Proj=4),this.Proj>0&&(this.Contour=14),s.check("PROJX",!0)&&(this.Project="X"+s.partAsInt(0,1)),s.check("PROJY",!0)&&(this.Project="Y"+s.partAsInt(0,1)),l&&(l.indexOf("FB")>=0&&(this.FrontBox=!1),l.indexOf("BB")>=0&&(this.BackBox=!1)),h&&s.check("FB")&&(this.FrontBox=!1),h&&s.check("BB")&&(this.BackBox=!1),this._pfc=s.check("PFC"),this._plc=s.check("PLC")||this.AutoColor,this._pmc=s.check("PMC"),s.check("L")&&(this.Line=!0,this.Hist=!1,this.Error=!1),s.check("F")&&(this.Fill=!0,this.need_fillcol=!0),s.check("A")&&(this.Axis=-1),(s.check("RX")||n&&n.$RX)&&(this.RevX=!0),(s.check("RY")||n&&n.$RY)&&(this.RevY=!0);let d=(t,e,r)=>{let a=s.check(t);n&&n["$"+t]&&(a=!0,n["$"+t]=void 0),a&&i&&(i[e].TestBit(r)||i[e].InvertBit(r))};d("OTX","fXaxis",Py.kOppositeTitle),d("OTY","fYaxis",Py.kOppositeTitle),d("CTX","fXaxis",Py.kCenterTitle),d("CTY","fYaxis",Py.kCenterTitle),s.check("B1")&&(this.BarStyle=1,this.BaseLine=0,this.Hist=!1,this.need_fillcol=!0),s.check("B")&&(this.BarStyle=1,this.Hist=!1,this.need_fillcol=!0),s.check("C")&&(this.Curve=!0,this.Hist=!1),s.check("][")&&(this.Off=1,this.Hist=!0),s.check("HIST")&&(this.Hist=!0,this.Func=!0,this.Error=!1),this.Bar=this.BarStyle>0,delete this.MarkStyle,s.check("P0")&&(this.Mark=!0,this.Hist=!1,this.Zero=!0),s.check("P")&&(this.Mark=!0,this.Hist=!1,this.Zero=!1),s.check("HZ")&&(this.Zscale=!0,this.Zvert=!1),s.check("Z")&&(this.Zscale=!0),s.check("*")&&(this.Mark=!0,this.MarkStyle=3,this.Hist=!1),s.check("H")&&(this.Hist=!0),s.check("E",!0)&&(this.Error=!0,1==e&&(this.Zero=!1,this.Hist=!1,Number.isInteger(parseInt(s.part[0]))&&(this.ErrorKind=parseInt(s.part[0])),3!==this.ErrorKind&&4!==this.ErrorKind||(this.need_fillcol=!0),0===this.ErrorKind&&(this.Zero=!0),s.part.indexOf("X0")>=0&&(this.errorX=0))),s.check("9")&&(this.HighRes=1),s.check("0")&&(this.Zero=!1),this.Color&&s.check("1")&&(this.Zero=!1),(this.Lego>0||3==e||this.Surf>0||this.Error&&2==e)&&(this.Mode3D=!0)}asString(t,e){let i="";return this.Mode3D?(this.Lego?(i="LEGO",this.Zero||(i+="0"),this.Lego>10&&(i+=this.Lego-10),this.Zscale&&(i+="Z")):this.Surf&&(i="SURF"+(this.Surf-10),this.Zscale&&(i+="Z")),this.FrontBox||(i+="FB"),this.BackBox||(i+="BB"),1!==this.x3dscale&&(i+="_X3DSC"+Math.round(100*this.x3dscale)),1!==this.y3dscale&&(i+="_Y3DSC"+Math.round(100*this.y3dscale))):(this.Scat?i="SCAT":this.Color?(i="COL",this.Zero||(i+="0"),this.Zscale&&(i+=this.Zvert?"Z":"HZ"),this.Axis<0&&(i+="A")):this.Contour?(i="CONT",this.Contour>10&&(i+=this.Contour-10),this.Zscale&&(i+="Z")):this.Bar?i=!1===this.BaseLine?"B":"B1":this.Mark?i=this.Zero?"P0":"P":this.Error?(i="E",this.ErrorKind>=0&&(i+=this.ErrorKind)):this.Line&&(i+="L",this.Fill&&(i+="F")),this.Cjust&&(i+=" CJUST"),this.Text&&(i+="TEXT",this.TextAngle&&(i+=this.TextAngle),i+=this.TextKind)),t&&i&&(this.ForceStat||!0===this.StatEnabled?i+="_STAT":(this.NoStat||!1===this.StatEnabled)&&(i+="_NOSTAT")),t&&e&&i&&(e.fLogx&&(i+="_LOGX"),e.fLogy&&(i+="_LOGY"),e.fLogz&&(i+="_LOGZ"),e.fGridx&&(i+="_GRIDX"),e.fGridy&&(i+="_GRIDY"),e.fTickx&&(i+="_TICKX"),e.fTicky&&(i+="_TICKY")),i}}class sb{constructor(t,e){this.arr=[],this.colzmin=t,this.colzmax=e,this.below_min_indx=-1,this.exact_min_indx=0}getLevels(){return this.arr}createNormal(t,e,i){if(e){this.colzmax<=0&&(this.colzmax=1),this.colzmin<=0&&(this.colzmin=void 0===i||i<=0?1e-4*this.colzmax:i<3||i>100?.3*i:1),this.colzmin>=this.colzmax&&(this.colzmin=1e-4*this.colzmax);let e=Math.log(this.colzmin)/Math.log(10),n=(Math.log(this.colzmax)/Math.log(10)-e)/t;this.arr.push(this.colzmin);for(let i=1;i<t;i++)this.arr.push(Math.exp((e+n*i)*Math.log(10)));this.arr.push(this.colzmax),this.custom=!0}else{this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin));let e=(this.colzmax-this.colzmin)/t;for(let i=0;i<=t;i++)this.arr.push(this.colzmin+e*i)}}createCustom(t){this.custom=!0;for(let e=0;e<t.length;++e)this.arr.push(t[e]);this.colzmax>this.arr[this.arr.length-1]&&this.arr.push(this.colzmax)}configIndicies(t,e){this.below_min_indx=t,this.exact_min_indx=e}getContourIndex(t){if(t<this.colzmin)return this.below_min_indx;if(t===this.colzmin)return this.exact_min_indx;if(!this.custom)return Math.floor(.01+(t-this.colzmin)*(this.arr.length-1)/(this.colzmax-this.colzmin));let e=0,i=this.arr.length-1;if(t<this.arr[0])return-1;if(t>=this.arr[i])return i;for(;e<i-1;){let n=Math.round((e+i)/2);this.arr[n]>t?i=n:e=n}return e}getPaletteColor(t,e){let i=this.getContourIndex(e);if(i<0)return null;let n=t.calcColorIndex(i,this.arr.length);return t.getColor(n)}getPaletteIndex(t,e){let i=this.getContourIndex(e);return i<0?null:t.calcColorIndex(i,this.arr.length)}}const ab={kNoStats:y(9),kUserContour:y(10),kCanRebin:y(11),kLogX:y(15),kIsZoomed:y(16),kNoTitle:y(17),kIsAverage:y(18)};class ob extends Vl{constructor(t,e){super(t,e),this.draw_content=!0,this.nbinsx=0,this.nbinsy=0,this.accept_drops=!0,this.mode3d=!1,this.hist_painter_id=s.id_counter++}getHisto(){return this.getObject()}getAxis(t){let e=this.getObject();if(e)switch(t){case"x":return e.fXaxis;case"y":return e.fYaxis;case"z":return e.fZaxis}return null}isTProfile(){return this.matchObjectType("TProfile")}isTH1K(){return this.matchObjectType("TH1K")}isTH2Poly(){return this.matchObjectType(/^TH2Poly/)||this.matchObjectType(/^TProfile2Poly/)}clear3DScene(){let t=this.getFramePainter();t&&"function"==typeof t.create3DScene&&t.create3DScene(-1),this.mode3d=!1}cleanup(){this.clear3DScene(),delete this.fPalette,delete this.fContour,delete this.options,super.cleanup()}getDimension(){let t=this.getHisto();return t?t._typename.match(/^TH2/)||t._typename.match(/^TProfile2D/)?2:t._typename.match(/^TH3/)?3:this.isTH2Poly()?2:1:0}decodeOptions(t){let e=this.getHisto(),i=this.getDimension(),n=this.getPadPainter(),r=n?n.getRootPad(!0):null;this.options?this.options.reset():this.options=new rb,this.options.decode(t||e.fOption,i,e,r,this),this.storeDrawOpt(t)}copyOptionsFrom(t){if(t===this)return;let e=this.options,i=t.options;e.Mode3D=i.Mode3D,e.Zero=i.Zero,i.Mode3D?(e.Lego=i.Lego,e.Surf=i.Surf):(e.Color=i.Color,e.Contour=i.Contour)}copyOptionsToOthers(){this.forEachPainter((t=>{t!==this&&"function"==typeof t.copyOptionsFrom&&t.copyOptionsFrom(this)}),"objects")}scanContent(){}checkPadRange(t){this.isMainPainter()&&(this.check_pad_range=!t||"pad_range")}createAutoColor(t){if(!t){let e=this.getPadPainter().getRootPad(!0);t=e&&e.fPrimitves?e.fPrimitves.arr.length:5}let e=this._auto_color||0;this._auto_color=e+1;let i=this.getHistPalette();if(i){t<2&&(t=2),e>=t&&(e=t-1);let n=Math.round(e*(i.getLength()-3)/(t-1)),r=i.getColor(n);return this.addColor(r)}return this._auto_color=this._auto_color%8,e+2}createHistDrawAttributes(){let t=this.getHisto();if(this.options._pfc||this.options._plc||this.options._pmc){let e=this.getMainPainter();if(e&&e.createAutoColor){let i=e.createAutoColor();this.options._pfc&&(t.fFillColor=i,delete this.fillatt),this.options._plc&&(t.fLineColor=i,delete this.lineatt),this.options._pmc&&(t.fMarkerColor=i,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1}}this.createAttFill({attr:t,color:this.options.histoFillColor,kind:1}),this.createAttLine({attr:t,color0:this.options.histoLineColor})}setSnapId(t){this.snapid=t,this.getPadPainter().forEachPainterInPad((e=>{if(e.child_painter_id===this.hist_painter_id){let i=e.getObject();i&&i.fName&&(e.snapid=t+"#func_"+i.fName)}}),"objects")}updateObject(t,e){let i=this.getHisto(),n=this.getFramePainter(),r=this.getPadPainter();if(t!==i){if(!this.matchObjectType(t))return!1;let s=r?r.findPainterFor(this.findStat()):null;i.TestBit(ab.kNoStats)!=t.TestBit(ab.kNoStats)&&(i.fBits=t.fBits,s&&(s.Enabled=!i.TestBit(ab.kNoStats))),void 0!==this.snapid&&(i.fName=t.fName),i.fFillColor=t.fFillColor,i.fFillStyle=t.fFillStyle,i.fLineColor=t.fLineColor,i.fLineStyle=t.fLineStyle,i.fLineWidth=t.fLineWidth,i.fEntries=t.fEntries,i.fTsumw=t.fTsumw,i.fTsumwx=t.fTsumwx,i.fTsumwx2=t.fTsumwx2,i.fXaxis.fNbins=t.fXaxis.fNbins,this.getDimension()>1&&(i.fTsumwy=t.fTsumwy,i.fTsumwy2=t.fTsumwy2,i.fTsumwxy=t.fTsumwxy,i.fYaxis.fNbins=t.fYaxis.fNbins,this.getDimension()>2&&(i.fTsumwz=t.fTsumwz,i.fTsumwz2=t.fTsumwz2,i.fTsumwxz=t.fTsumwxz,i.fTsumwyz=t.fTsumwyz,i.fZaxis.fNbins=t.fZaxis.fNbins));const a=(t,e,i)=>{e.fTitle=i.fTitle,e.fLabels=i.fLabels,e.fXmin=i.fXmin,e.fXmax=i.fXmax,e.fTimeDisplay=i.fTimeDisplay,e.fTimeFormat=i.fTimeFormat,e.fAxisColor=i.fAxisColor,e.fLabelColor=i.fLabelColor,e.fLabelFont=i.fLabelFont,e.fLabelOffset=i.fLabelOffset,e.fLabelSize=i.fLabelSize,e.fNdivisions=i.fNdivisions,e.fTickLength=i.fTickLength,e.fTitleColor=i.fTitleColor,e.fTitleFont=i.fTitleFont,e.fTitleOffset=i.fTitleOffset,e.fTitleSize=i.fTitleSize,!this.snapid||n&&n.zoomChangedInteractive(t)||(e.fFirst=i.fFirst,e.fLast=i.fLast,e.fBits=i.fBits)};if(a("x",i.fXaxis,t.fXaxis),a("y",i.fYaxis,t.fYaxis),a("z",i.fZaxis,t.fZaxis),i.fArray=t.fArray,i.fNcells=t.fNcells,i.fTitle=t.fTitle,i.fMinimum=t.fMinimum,i.fMaximum=t.fMaximum,i.fSumw2=t.fSumw2,this.isTProfile()?i.fBinEntries=t.fBinEntries:this.isTH1K()?(i.fNIn=t.fNIn,i.fReady=!1):this.isTH2Poly()&&(i.fBins=t.fBins),this.options.Func){let e=[],n=[],a=this.hist_painter_id;if(r&&r.forEachPainterInPad((t=>{t.child_painter_id===a&&e.push(t)}),"objects"),t.fFunctions)for(let s=0;s<t.fFunctions.arr.length;++s){let a=t.fFunctions.arr[s];if(!a||!a._typename)continue;if(!this.needDrawFunc(i,a))continue;let o=null,l=-1;for(let t=0;t<e.length;++t)if(e[t].matchObjectType(a._typename)&&e[t].getObject().fName===a.fName){o=e[t],l=t;break}!o&&a.fName&&(o=r?r.findPainterFor(null,a.fName,a._typename):null),o?(o.updateObject(a),l>=0&&e.splice(l,1)):n.push(a)}if(s){let t=e.indexOf(s);t>=0&&e.splice(t,1)}if(r&&e.length>0&&r.cleanPrimitives((t=>e.indexOf(t)>=0)),r&&n.length>0){let t=[],e=r.has_canvas?r.selectCurrentPad(r.this_pad_name):void 0;for(let e=0;e<n.length;++e)t.push(r.drawObject(this.getDom(),n[e]));Promise.all(t).then((t=>{for(let e=0;e<t.length;++e)t[e]&&(t[e].child_painter_id=a);r.selectCurrentPad(e)}))}}let o=i.fOption!=t.fOption;i.fOption=t.fOption,(void 0!==e&&this.options.original!==e||o)&&this.decodeOptions(e||i.fOption)}return this.options.ominimum||(this.options.minimum=i.fMinimum),this.options.omaximum||(this.options.maximum=i.fMaximum),!this.snapid&&n&&n.zoomChangedInteractive()||this.checkPadRange(),this.scanContent(),this.histogram_updated=!0,!0}extractAxesProperties(t){const e=t=>{t.fXbins.length>=t.fNbins?(t.regular=!1,t.GetBinCoord=function(t){let e=Math.round(t);if(e<=0)return this.fXmin;if(e>this.fNbins)return this.fXmax;if(e==t)return this.fXbins[e];let i=t<e?e-1:e+1;return this.fXbins[e]*Math.abs(t-i)+this.fXbins[i]*Math.abs(t-e)},t.FindBin=function(t,e){for(let i=1;i<this.fXbins.length;++i)if(t<this.fXbins[i])return Math.floor(i-1+e);return this.fNbins}):(t.regular=!0,t.binwidth=(t.fXmax-t.fXmin)/(t.fNbins||1),t.GetBinCoord=function(t){return this.fXmin+t*this.binwidth},t.FindBin=function(t,e){return Math.floor((t-this.fXmin)/this.binwidth+e)})};this.nbinsx=this.nbinsy=this.nbinsz=0;const i=this.getHisto();this.nbinsx=i.fXaxis.fNbins,this.xmin=i.fXaxis.fXmin,this.xmax=i.fXaxis.fXmax,e(i.fXaxis),this.ymin=i.fYaxis.fXmin,this.ymax=i.fYaxis.fXmax,t>1&&(this.nbinsy=i.fYaxis.fNbins,e(i.fYaxis)),t>2&&(this.nbinsz=i.fZaxis.fNbins,this.zmin=i.fZaxis.fXmin,this.zmax=i.fZaxis.fXmax,e(i.fZaxis))}drawAxes(){let t=this.getFramePainter();if(!t)return Promise.resolve(!1);let e=this.getHisto();if(this.ymin===this.ymax&&(this.ymax+=1),!this.isMainPainter()){let i={second_x:this.options.AxisPos>=10,second_y:this.options.AxisPos%10==1};return!i.second_x&&!i.second_y||t.hasDrawnAxes(i.second_x,i.second_y)?Promise.resolve(!1):(t.setAxes2Ranges(i.second_x,e.fXaxis,this.xmin,this.xmax,i.second_y,e.fYaxis,this.ymin,this.ymax),t.createXY2(i),t.drawAxes2(i.second_x,i.second_y))}if(this.options.adjustFrame){let e=this.getPadPainter().getRootPad();e&&(e.fUxmin<e.fUxmax&&(t.fX1NDC=(this.xmin-e.fUxmin)/(e.fUxmax-e.fUxmin),t.fX2NDC=(this.xmax-e.fUxmin)/(e.fUxmax-e.fUxmin)),e.fUymin<e.fUymax&&(t.fY1NDC=(this.ymin-e.fUymin)/(e.fUymax-e.fUymin),t.fY2NDC=(this.ymax-e.fUymin)/(e.fUymax-e.fUymin)),e.fLeftMargin=t.fX1NDC,e.fRightMargin=1-t.fX2NDC,e.fBottomMargin=t.fY1NDC,e.fTopMargin=1-t.fY2NDC,e.fFrameLineColor=0,e.fFrameLineWidth=0,t.setRootPadRange(e),t.fillatt.setSolidColor("none"),t.redraw()),this.options.adjustFrame=!1}return t.setAxesRanges(e.fXaxis,this.xmin,this.xmax,e.fYaxis,this.ymin,this.ymax,e.fZaxis,0,0),t.createXY({ndim:this.getDimension(),check_pad_range:this.check_pad_range,zoom_ymin:this.zoom_ymin,zoom_ymax:this.zoom_ymax,ymin_nz:this.ymin_nz,swap_xy:this.options.BarStyle>=20,reverse_x:this.options.RevX,reverse_y:this.options.RevY,symlog_x:this.options.SymlogX,symlog_y:this.options.SymlogY,Proj:this.options.Proj,extra_y_space:this.options.Text&&this.options.BarStyle>0}),delete this.check_pad_range,this.options.Same?Promise.resolve(!1):t.drawAxes(!1,this.options.Axis<0,this.options.Axis<0,this.options.AxisPos,this.options.Zscale&&this.options.Zvert,this.options.Zscale&&!this.options.Zvert)}toggleTitle(t){let e=this.getHisto();return!(!this.isMainPainter()||!e)&&("only-check"===t?!e.TestBit(ab.kNoTitle):(e.InvertBit(ab.kNoTitle),void this.drawHistTitle()))}drawHistTitle(){if(!this.isMainPainter()||this.options.Same)return Promise.resolve(this);let t=this.getHisto(),e=p,i=this.getPadPainter(),n=i?i.findPainterFor(null,"title"):null,r=n?n.getObject():null,s=!t.TestBit(ab.kNoTitle)&&e.fOptTitle>0;if(!r&&i&&"function"==typeof i.findInPrimitives&&(r=i.findInPrimitives("title","TPaveText")),r){if(r.Clear(),s&&r.AddText(t.fTitle),n)return n.redraw().then((()=>this))}else if(s&&!n&&t.fTitle&&!this.options.PadTitle)return r=k("TPaveText"),Object.assign(r,{fName:"title",fFillColor:e.fTitleColor,fFillStyle:e.fTitleStyle,fBorderSize:e.fTitleBorderSize,fTextFont:e.fTitleFont,fTextSize:e.fTitleFontSize,fTextColor:e.fTitleTextColor,fTextAlign:e.fTitleAlign}),r.AddText(t.fTitle),$v.draw(this.getDom(),r,"postitle").then((t=>(t&&(t.$secondary=!0),this)));return Promise.resolve(this)}processTitleChange(t){let e=this.getHisto(),i=this.getPadPainter(),n=i?i.findPainterFor(null,"title"):null;return e&&n?"check"===t?!this.isMainPainter()||this.options.Same?null:e:(n.clearPave(),n.addText(e.fTitle),n.redraw(),void this.submitCanvExec('SetTitle("'+e.fTitle+'")')):null}updateStatWebCanvas(){if(!this.snapid)return;let t=this.findStat(),e=this.getPadPainter(),i=e?e.findPainterFor(t):null;i&&!i.snapid&&i.redraw()}findStat(){if(this.options.PadStats){let t=this.getPadPainter(),e=t?t.findPainterFor(null,"stats","TPaveStats"):null;return e?e.getObject():null}return this.findFunction("TPaveStats","stats")}toggleStat(t){let e=this.findStat(),i=this.getPadPainter(),n=null;if(t||(t=""),e)n=i?i.findPainterFor(e):null;else{if(t.indexOf("-check")>0)return!1;e=this.createStat(!0)}if("only-check"==t)return!!n&&n.Enabled;if("fitpar-check"==t)return!!e&&e.fOptFit;if("fitpar-toggle"==t)return!!e&&(e.fOptFit=e.fOptFit?0:1111,n&&n.redraw(),!0);if(n)return n.Enabled=!n.Enabled,this.options.StatEnabled=n.Enabled,n.redraw(),n.Enabled;let r=this.selectCurrentPad(this.getPadName());return $v.draw(this.getDom(),e).then((()=>this.selectCurrentPad(r))),!0}isIgnoreStatsFill(){return!this.getObject()||!this.draw_content&&!this.create_stats&&!this.snapid||this.options.Axis>0}createStat(t){let e=this.getHisto();if(this.options.PadStats||!e)return null;if(!t&&!this.options.ForceStat){if(this.options.NoStat||e.TestBit(ab.kNoStats)||!m.AutoStat)return null;if(this.options.Axis>0||!this.isMainPainter())return null}let i=this.findStat(),n=p,r=this.options.optstat,s=this.options.optfit;return void 0!==r?(i&&(i.fOptStat=r),delete this.options.optstat):r=e.$custom_stat||n.fOptStat,void 0!==s?(i&&(i.fOptFit=s),delete this.options.optfit):s=n.fOptFit,i||r||s?(this.create_stats=!0,i||(i=k("TPaveStats"),Object.assign(i,{fName:"stats",fOptStat:r,fOptFit:s,fBorderSize:1,fX1NDC:n.fStatX-n.fStatW,fY1NDC:n.fStatY-n.fStatH,fX2NDC:n.fStatX,fY2NDC:n.fStatY,fFillColor:n.fStatColor,fFillStyle:n.fStatStyle,fTextAngle:0,fTextSize:n.fStatFontSize,fTextAlign:12,fTextColor:n.fStatTextColor,fTextFont:n.fStatFont}),(e._typename.match(/^TProfile/)||e._typename.match(/^TH2/))&&(i.fY1NDC=.67),i.AddText(e.fName),this.addFunction(i),i)):null}findFunction(t,e){let i=this.getHisto(),n=i&&i.fFunctions?i.fFunctions.arr:null;if(!n)return null;for(let i=0;i<n.length;++i)if((!e||n[i].fName===e)&&n[i]._typename===t)return n[i];return null}addFunction(t,e){let i=this.getHisto();i&&t&&(i.fFunctions||(i.fFunctions=k("TList")),e?i.fFunctions.AddFirst(t):i.fFunctions.Add(t))}needDrawFunc(t,e){return"TPaveText"===e._typename||"TPaveStats"===e._typename?!t.TestBit(ab.kNoStats)&&!this.options.NoStat:"TF1"===e._typename?!e.TestBit(y(9)):"TPaletteAxis"!==e._typename}drawNextFunction(t){let e=this.getHisto();if(!this.options.Func||!e.fFunctions||t>=e.fFunctions.arr.length)return Promise.resolve(!0);let i=e.fFunctions.arr[t],n=e.fFunctions.opt[t],r=this.getPadPainter(),s=!1;return!(r?r.findPainterFor(i):null)&&i&&(s=this.needDrawFunc(e,i)),s?(i.$histo=e,($v.canDraw(i)?$v.draw(this.getDom(),i,n):r.drawObject(this.getDom(),i,n)).then((e=>(e&&"object"==typeof e&&(e.child_painter_id=this.hist_painter_id),this.drawNextFunction(t+1))))):this.drawNextFunction(t+1)}getSelectIndex(t,e,i){let n=0,r=this["nbins"+t]||0,s=this.getAxis(t);this.options.second_x&&"x"==t&&(t="x2"),this.options.second_y&&"y"==t&&(t="y2");let a=this.getFramePainter(),o=a?a["zoom_"+t+"min"]:0,l=a?a["zoom_"+t+"max"]:0;return o!==l&&s?(n="left"==e?s.FindBin(o,i||0):s.FindBin(l,(i||0)+.5),n<0?n=0:n>r&&(n=r)):n="left"==e?0:r,s&&(s.fFirst===s.fLast||!s.TestBit(Py.kAxisRange)||s.fFirst<=1&&s.fLast>=r)&&(s=void 0),"left"==e?(n<0&&(n=0),s&&s.fFirst>1&&n<s.fFirst&&(n=s.fFirst-1)):(n>r&&(n=r),s&&s.fLast<=r&&n>s.fLast&&(n=s.fLast)),n}unzoomUserRange(t,e,i){let n=!1,r=this.getHisto();if(!r)return!1;let s=t=>!(!t||!t.TestBit(Py.kAxisRange))&&(t.fFirst!==t.fLast&&(!(t.fFirst<=1&&t.fLast>=t.fNbins)&&(t.InvertBit(Py.kAxisRange),!0))),a=t=>this.getDimension()===t&&((-1111!==this.options.minimum||-1111!==this.options.maximum)&&(!!this.draw_content&&(this.options.minimum=this.options.maximum=-1111,this.scanContent(!0),!0)));return t&&s(r.fXaxis)&&(n=!0),e&&(s(r.fYaxis)||a(1))&&(n=!0),i&&(s(r.fZaxis)||a(2))&&(n=!0),n}addInteractivity(){let t=this.isMainPainter(),e=this.options.AxisPos>0,i=t||e?this.getFramePainter():null;return i?i.addInteractivity(!t&&e):Promise.resolve(!1)}changeUserRange(t,e){let i=this.getHisto(),n=i?i["f"+e+"axis"]:null;if(!n)return;let r="[1,"+n.fNbins+"]";n.TestBit(Py.kAxisRange)&&(r="["+n.fFirst+","+n.fLast+"]"),t.input(`Enter user range for axis ${e} like [1,${n.fNbins}]`,r).then((t=>{if(!t)return;if(!(t=JSON.parse(t))||2!=t.length)return;let e=parseInt(t[0]),i=parseInt(t[1]);Number.isInteger(e)&&Number.isInteger(i)&&(n.fFirst=e,n.fLast=i,(n.fFirst<n.fLast&&n.fFirst>=1&&n.fLast<=n.fNbins)!=n.TestBit(Py.kAxisRange)&&n.InvertBit(Py.kAxisRange),this.interactiveRedraw())}))}changeValuesRange(t){let e;e=-1111!=this.options.minimum&&-1111!=this.options.maximum?"["+this.options.minimum+","+this.options.maximum+"]":"["+this.gminbin+","+this.gmaxbin+"]",t.input("Enter min/max hist values or empty string to reset",e).then((t=>{(t=t?JSON.parse(t):[])&&"object"==typeof t&&2==t.length&&Number.isFinite(t[0])&&Number.isFinite(t[1])?(this.options.minimum=t[0],this.options.maximum=t[1]):this.options.minimum=this.options.maximum=-1111,this.interactiveRedraw()}))}fillContextMenu(t){let e=this.getHisto(),i=this.getFramePainter();if(e){if(t.add("header:"+e._typename+"::"+e.fName),this.options.Axis<=0&&t.addchk(this.toggleStat("only-check"),"Show statbox",(()=>this.toggleStat())),e.fTitle&&this.isMainPainter()&&t.addchk(this.toggleTitle("only-check"),"Show title",(()=>this.toggleTitle())),this.draw_content&&(1==this.getDimension()?t.add("User range X",(()=>this.changeUserRange(t,"X"))):(t.add("sub:User ranges"),t.add("X",(()=>this.changeUserRange(t,"X"))),t.add("Y",(()=>this.changeUserRange(t,"Y"))),this.getDimension()>2?t.add("Z",(()=>this.changeUserRange(t,"Z"))):t.add("Values",(()=>this.changeValuesRange(t))),t.add("endsub:")),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(t)),this.options.Mode3D){t.size()>0&&t.add("separator");let e=this.getMainPainter()||this;t.addchk(e.isTooltipAllowed(),"Show tooltips",(function(){e.setTooltipAllowed("toggle")})),t.addchk(i.enable_highlight,"Highlight bins",(function(){i.enable_highlight=!i.enable_highlight,!i.enable_highlight&&i.highlightBin3D&&i.mode3d&&i.highlightBin3D(null)})),i&&i.render3D&&(t.addchk(e.options.FrontBox,"Front box",(function(){e.options.FrontBox=!e.options.FrontBox,i.render3D()})),t.addchk(e.options.BackBox,"Back box",(function(){e.options.BackBox=!e.options.BackBox,i.render3D()}))),this.draw_content&&(t.addchk(!this.options.Zero,"Suppress zeros",(function(){this.options.Zero=!this.options.Zero,this.interactiveRedraw("pad")})),12!=this.options.Lego&&14!=this.options.Lego||(t.addchk(this.options.Zscale,"Z scale",(()=>this.toggleColz())),this.fillPaletteMenu&&this.fillPaletteMenu(t))),e.control&&"function"==typeof e.control.reset&&t.add("Reset camera",(function(){e.control.reset()}))}return t.addAttributesMenu(this),this.histogram_updated&&i.zoomChangedInteractive()&&t.add("Let update zoom",(function(){i.zoomChangedInteractive("reset")})),!0}}autoZoom(){}clickButton(t){let e=this.getFramePainter();if(!this.isMainPainter()||!e)return!1;switch(t){case"ToggleZoom":if(e.zoom_xmin!==e.zoom_xmax||e.zoom_ymin!==e.zoom_ymax||e.zoom_zmin!==e.zoom_zmax)return e.unzoom(),e.zoomChangedInteractive("reset"),!0;if(this.draw_content)return this.autoZoom(),!0;break;case"ToggleLogX":e.toggleAxisLog("x");break;case"ToggleLogY":e.toggleAxisLog("y");break;case"ToggleLogZ":e.toggleAxisLog("z");break;case"ToggleStatBox":return this.toggleStat(),!0}return!1}fillToolbar(t){let e=this.getPadPainter();e&&(e.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),e.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),e.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),this.getDimension()>1&&e.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.options.Axis<=0&&e.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t||e.showPadButtons())}get3DToolTip(t){let e=this.getHisto(),i={bin:t,name:e.fName,title:e.fTitle};switch(this.getDimension()){case 1:i.ix=t,i.iy=1,i.value=e.getBinContent(i.ix),i.error=e.getBinError(t),i.lines=this.getBinTooltips(t-1);break;case 2:i.ix=t%(this.nbinsx+2),i.iy=(t-i.ix)/(this.nbinsx+2),i.value=e.getBinContent(i.ix,i.iy),i.error=e.getBinError(t),i.lines=this.getBinTooltips(i.ix-1,i.iy-1);break;case 3:i.ix=t%(this.nbinsx+2),i.iy=(t-i.ix)/(this.nbinsx+2)%(this.nbinsy+2),i.iz=(t-i.ix-i.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),i.value=e.getBinContent(i.ix,i.iy,i.iz),i.error=e.getBinError(t),i.lines=this.getBinTooltips(i.ix-1,i.iy-1,i.iz-1)}return i}createContour(t,e,i,n,r){let s=new sb(e,i);if(r)s.createCustom(r);else{t<2&&(t=p.fNumberContours);let e=this.getPadPainter().getRootPad(!0);s.createNormal(t,e?e.fLogz:0,n)}s.configIndicies(this.options.Zero?-1:0,0!=s.colzmin||!this.options.Zero||this.isTH2Poly()?0:-1);let a=this.getFramePainter();return this.getDimension()<3&&a&&(a.zmin=s.colzmin,a.zmax=s.colzmax),this.fContour=s,s}getContour(t){if(this.fContour&&!t)return this.fContour;let e=this.getMainPainter(),i=this.getFramePainter();if(e&&e!==this&&e.fContour)return this.fContour=e.fContour,this.fContour;let n,r,s=this.getObject(),a=0,o=this.minbin,l=this.maxbin,h=this.minposbin;o===l&&(o=this.gminbin,l=this.gmaxbin,h=this.gminposbin);let c=o,d=l;-1111!==this.options.minimum&&(o=this.options.minimum,c=Math.min(c,o),n=!0),-1111!==this.options.maximum&&(l=this.options.maximum,d=Math.max(d,l),n=!1),o>=l&&(n?l=o+1:o=l-1),i&&i.zoom_zmin!=i.zoom_zmax&&(o=i.zoom_zmin,l=i.zoom_zmax),s.fContour&&s.fContour.length>1&&(s.TestBit(ab.kUserContour)?r=s.fContour:a=s.fContour.length);let u=this.createContour(a,o,l,h,r);return this.getDimension()<3&&i&&(i.zmin=c,i.zmax=d,c!=u.colzmin||d!=u.colzmax?(i.zoom_zmin=u.colzmin,i.zoom_zmax=u.colzmax):i.zoom_zmin=i.zoom_zmax=void 0),u}getContourLevels(){return this.getContour().getLevels()}getHistPalette(t){if(t&&(this.fPalette=null),!this.fPalette&&!this.options.Palette){let t=this.getPadPainter();t&&t.getCustomPalette&&(this.fPalette=t.getCustomPalette())}return this.fPalette||(this.fPalette=nb(this.options.Palette)),this.fPalette}fillPaletteMenu(t){t.addPaletteMenu(this.options.Palette||m.Palette,(t=>{this.options.Palette=parseInt(t),this.getHistPalette(!0),this.redraw()}))}drawColorPalette(t,e,i){let n=this.getMainPainter();if(n!==this&&n&&!1!==n.draw_content)return Promise.resolve(null);let r=this.findFunction("TPaletteAxis"),s=this.getPadPainter(),a=s?s.findPainterFor(r):null;if(this._can_move_colz&&(i=!0,delete this._can_move_colz),a||r||(a=s?s.findPainterFor(void 0,void 0,"TPaletteAxis"):null,a&&(r=a.getObject(),this.addFunction(r,!0))),!t)return a&&(this.options.Zvert=a._palette_vertical,a.Enabled=!1,a.removeG()),Promise.resolve(null);if(r)s&&void 0!==s._palette_vertical&&(this.options.Zvert=s._palette_vertical);else{if(this.options.PadPalette)return Promise.resolve(null);r=k("TPave"),Object.assign(r,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:k("TGaxis"),fX1NDC:.905,fX2NDC:.945,fY1NDC:.1,fY2NDC:.9,fInit:1,$can_move:!0}),this.options.Zvert||Object.assign(r,{fX1NDC:.1,fX2NDC:.9,fY1NDC:.805,fY2NDC:.845});let t=this.getHisto().fZaxis;Object.assign(r.fAxis,{fTitle:t.fTitle,fTitleSize:t.fTitleSize,fChopt:"+",fLineColor:t.fAxisColor,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:t.fLabelSize,fTextAlign:11,fTextColor:t.fLabelColor,fTextFont:t.fLabelFont}),this.addFunction(r,!0),i=!0}let o=this.getFramePainter();i&&o&&r.$can_move&&(this.options.Zvert?(r.fX1NDC>.5?(r.fX2NDC=o.fX2NDC+.005+(r.fX2NDC-r.fX1NDC),r.fX1NDC=o.fX2NDC+.005):(r.fX1NDC=o.fX1NDC-.03-(r.fX2NDC-r.fX1NDC),r.fX2NDC=o.fX1NDC-.03),r.fY1NDC=o.fY1NDC,r.fY2NDC=o.fY2NDC):(r.fX1NDC=o.fX1NDC,r.fX2NDC=o.fX2NDC,r.fY2NDC>.5?(r.fY2NDC=o.fY2NDC+.005+(r.fY2NDC-r.fY1NDC),r.fY1NDC=o.fY2NDC+.005):(r.fY1NDC=o.fY1NDC-.05-(r.fY2NDC-r.fY1NDC),r.fY2NDC=o.fY1NDC-.05))),r.$main_painter=this;let l,h="";if(e&&(h+=";postpone"),i&&!this.do_redraw_palette&&(h+=";can_move"),this.options.Cjust&&(h+=";cjust"),a){if(a.Enabled=!0,e)return Promise.resolve(a);l=a.drawPave(h)}else{let t=this.selectCurrentPad(this.getPadName());l=$v.draw(this.getDom(),r,h).then((e=>{a=e,this.selectCurrentPad(t)}))}return l.then((()=>{a.$secondary=!0,this.options.Zvert=a._palette_vertical,a.redraw=function(){};let t=!1;return i&&o&&!this.do_redraw_palette&&(this.options.Zvert?r.fX1NDC>.5&&o.fX2NDC>r.fX1NDC?(t=!0,o.fX2NDC=r.fX1NDC-.01,o.fX1NDC>o.fX2NDC-.1&&(o.fX1NDC=Math.max(0,o.fX2NDC-.1))):r.fX2NDC<.5&&o.fX1NDC<r.fX2NDC&&(t=!0,o.fX1NDC=r.fX2NDC+.05,o.fX2NDC<o.fX1NDC+.1&&(o.fX2NDC=Math.min(1,o.fX1NDC+.1))):r.fY1NDC>.5&&o.fY2NDC>r.fY1NDC?(t=!0,o.fY2NDC=r.fY1NDC-.01,o.fY1NDC>o.fY2NDC-.1&&(o.fY1NDC=Math.max(0,o.fXYNDC-.1))):r.fY2NDC<.5&&o.fY1NDC<r.fY2NDC&&(t=!0,o.fY1NDC=r.fY2NDC+.05,o.fXYNDC<o.fY1NDC+.1&&(o.fY2NDC=Math.min(1,o.fY1NDC+.1)))),t?(this.do_redraw_palette=!0,o.redraw(),(e?Promise.resolve(!0):this.redraw()).then((()=>(delete this.do_redraw_palette,a)))):a}))}toggleColz(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)return this.options.Zscale=!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!1,!0)}toggleMode3D(){this.options.Mode3D=!this.options.Mode3D,this.options.Mode3D&&(this.options.Surf||this.options.Lego||this.options.Error||(this.nbinsx>=50||this.nbinsy>=50?this.options.Lego=this.options.Color?14:13:this.options.Lego=this.options.Color?12:1,this.options.Zero=!1)),this.copyOptionsToOthers(),this.interactiveRedraw("pad","drawopt")}prepareDraw(t){t||(t={rounding:!0,extra:0,middle:0}),void 0===t.extra&&(t.extra=0),void 0===t.middle&&(t.middle=0);let e,i,n,r,s,a,o=this.getHisto(),l=o.fXaxis,h=o.fYaxis,c=this.getFramePainter(),d=this.getDimension(),u={i1:this.getSelectIndex("x","left",0-t.extra),i2:this.getSelectIndex("x","right",1+t.extra),j1:1===d?0:this.getSelectIndex("y","left",0-t.extra),j2:1===d?1:this.getSelectIndex("y","right",1+t.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};if(u.grx=new Float32Array(u.i2+1),u.gry=new Float32Array(u.j2+1),"number"!=typeof o.fBarOffset||"number"!=typeof o.fBarWidth||!o.fBarOffset&&1e3===o.fBarWidth||(o.fBarOffset<=1e3?u.xbar1=u.ybar1=.001*o.fBarOffset:o.fBarOffset<=3e3?u.xbar1=.001*(o.fBarOffset-2e3):o.fBarOffset<=5e3&&(u.ybar1=.001*(o.fBarOffset-4e3)),o.fBarWidth<=1e3?(u.xbar2=Math.min(1,u.xbar1+.001*o.fBarWidth),u.ybar2=Math.min(1,u.ybar1+.001*o.fBarWidth)):o.fBarWidth<=3e3?u.xbar2=Math.min(1,u.xbar1+.001*(o.fBarWidth-2e3)):o.fBarWidth<=5e3&&(u.ybar2=Math.min(1,u.ybar1+.001*(o.fBarWidth-4e3)))),t.original&&(u.original=!0,u.origx=new Float32Array(u.i2+1),u.origy=new Float32Array(u.j2+1)),t.pixel_density&&(t.rounding=!0),!c)return console.warn("cannot draw histogram without frame"),u;let f=c.getGrFuncs(this.options.second_x,this.options.second_y);for(e=u.i1;e<=u.i2;++e)n=l.GetBinCoord(e+t.middle),f.logx&&n<=0?u.i1=e+1:(u.origx&&(u.origx[e]=n),u.grx[e]=f.grx(n),t.rounding&&(u.grx[e]=Math.round(u.grx[e])),t.use3d&&(u.grx[e]<-c.size_x3d&&(u.i1=e,u.grx[e]=-c.size_x3d),u.grx[e]>c.size_x3d&&(u.i2=e,u.grx[e]=c.size_x3d)));if(1===d)u.gry[0]=f.gry(0),u.gry[1]=f.gry(1);else for(i=u.j1;i<=u.j2;++i)r=h.GetBinCoord(i+t.middle),f.logy&&r<=0?u.j1=i+1:(u.origy&&(u.origy[i]=r),u.gry[i]=f.gry(r),t.rounding&&(u.gry[i]=Math.round(u.gry[i])),t.use3d&&(u.gry[i]<-c.size_y3d&&(u.j1=i,u.gry[i]=-c.size_y3d),u.gry[i]>c.size_y3d&&(u.j2=i,u.gry[i]=c.size_y3d)));for(this.maxbin=this.minbin=this.minposbin=null,e=u.i1;e<u.i2;++e)for(i=u.j1;i<u.j2;++i){if(s=o.getBinContent(e+1,i+1),u.sumz+=s,t.pixel_density){if(a=(u.grx[e+1]-u.grx[e])*(u.gry[i]-u.gry[i+1]),a<=0)continue;u.max=Math.max(u.max,s),s>0&&(s<u.min||0===u.min)&&(u.min=s),s/=a}null===this.maxbin?this.maxbin=this.minbin=s:(this.maxbin=Math.max(this.maxbin,s),this.minbin=Math.min(this.minbin,s)),s>0&&(null===this.minposbin||s<this.minposbin)&&(this.minposbin=s)}return this.fContour=null,u}getAxisBinTip(t,e,i){let n=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),r=n[t+"_handle"],s=e.GetBinLowEdge(i+1);if("labels"===r.kind)return n.axisAsText(t,s);let a=e.GetBinLowEdge(i+2);return"time"===r.kind?n.axisAsText(t,(s+a)/2):"["+n.axisAsText(t,s)+", "+n.axisAsText(t,a)+")"}static _drawHist(t,e){return Vv(t).then((()=>(t.setAsMainPainter(),t.decodeOptions(e),t.isTH2Poly()&&(t.options.Mode3D?t.options.Lego=12:t.options.Color||(t.options.Color=!0)),t.checkPadRange(!t.options.Mode3D&&14!=t.options.Contour),t.scanContent(),t.createStat(),t.callDrawFunc()))).then((()=>t.drawNextFunction(0))).then((()=>{if(!t.Mode3D&&t.options.AutoZoom)return t.autoZoom()})).then((()=>{if(t.options.Project&&!t.mode3d&&t.toggleProjection)return t.toggleProjection(t.options.Project)})).then((()=>(t.fillToolbar(),t)))}}class lb extends ob{convertTH1K(){let t=this.getObject();if(t.fReady)return;let e=t.fArray,i=t.fEntries;t.fNcells=t.fXaxis.fNbins+2,t.fArray=new Float64Array(t.fNcells).fill(0);for(let i=0;i<t.fNIn;++i)t.Fill(e[i]);t.fReady=!0,t.fEntries=i}scanContent(t){t&&!this.nbinsx&&(t=!1),this.isTH1K()&&this.convertTH1K();let e=this.getHisto();t||this.extractAxesProperties(1);let i=this.getSelectIndex("x","left"),n=this.getSelectIndex("x","right");if(t&&i===this.scan_xleft&&n===this.scan_xright)return;this.draw_content=!(this.options.Axis>0),this.scan_xleft=i,this.scan_xright=n;let r,s,a=0,o=0,l=0,h=0,c=!0,d=this.isTProfile();for(let t=0;t<this.nbinsx;++t)r=e.getBinContent(t+1),h+=d?e.fBinEntries[t+1]:r,t<i||t>=n||(r>0&&(0==o||r<o)&&(o=r),c&&(a=l=r,c=!1),s=this.options.Error?e.getBinError(t+1):0,a=Math.min(a,r-s),l=Math.max(l,r+s));h+=d?e.fBinEntries[0]+e.fBinEntries[this.nbinsx+1]:e.getBinContent(0)+e.getBinContent(this.nbinsx+1),this.stat_entries=h,e.fEntries>1&&(this.stat_entries=e.fEntries),this.hmin=a,this.hmax=l,this.ymin_nz=o,(0==this.nbinsx||Math.abs(a)<1e-300&&Math.abs(l)<1e-300)&&(this.draw_content=!1);let u=!1;if(this.draw_content)if(a>=l)0==a?(this.ymin=0,this.ymax=1):a<0?(this.ymin=2*a,this.ymax=0):(this.ymin=0,this.ymax=2*a);else{let t=.05*(l-a);this.ymin=a-t,this.ymin<0&&a>=0&&(this.ymin=0),this.ymax=l+t}a=this.options.minimum,l=this.options.maximum,a===l&&-1111!==a&&(a<0?(a*=2,l=0):(a=0,l*=2,l||(l=1))),-1111==a||-1111==l||this.draw_content?(-1111!=a&&(a<this.ymin?this.ymin=a:u=!0),-1111!=l&&(l>this.ymax?this.ymax=l:u=!0)):(this.ymin=a,this.ymax=l),t||(u&&this.draw_content?(this.zoom_ymin=-1111==a?this.ymin:a,this.zoom_ymax=-1111==l?this.ymax:l):(delete this.zoom_ymin,delete this.zoom_ymax)),this.wheel_zoomy=this.getDimension()>1||!this.draw_content}countStat(t){let e,i=this.isTProfile(),n=this.getHisto(),r=n.fXaxis,s=this.getSelectIndex("x","left"),a=this.getSelectIndex("x","right"),o=0,l=0,h=0,c=0,d=0,u=0,f=0,m=null,p=null,g=this.getFramePainter(),_={name:n.fName,meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};for(e=s;e<a;++e)u=r.GetBinCoord(e+.5),t&&!t(u)||(i?(f=n.fBinEntries[e+1],c+=n.fArray[e+1],d+=n.fSumw2[e+1]):f=n.getBinContent(e+1),(null===m||f>p)&&(m=u,p=f),o+=f,l+=f*u,h+=f*u*u);return!g.isAxisZoomed("x")&&n.fTsumw>0&&(o=n.fTsumw,l=n.fTsumwx,h=n.fTsumwx2),_.integral=o,o>0&&(_.meanx=l/o,_.meany=c/o,_.rmsx=Math.sqrt(Math.abs(h/o-_.meanx*_.meanx)),_.rmsy=Math.sqrt(Math.abs(d/o-_.meany*_.meany))),null!==m&&(_.xmax=m,_.wmax=p),_}fillStatistic(t,e,i){if(this.isIgnoreStatsFill())return!1;let n=this.getHisto(),r=this.countStat(),s=e%10,a=Math.floor(e/10)%10,o=Math.floor(e/100)%10,l=Math.floor(e/1e3)%10,h=Math.floor(e/1e4)%10,c=Math.floor(e/1e5)%10,d=Math.floor(e/1e6)%10,u=Math.floor(e/1e7)%10,f=Math.floor(e/1e8)%10;return t.clearPave(),s>0&&t.addText(r.name),this.isTProfile()?(a>0&&t.addText("Entries = "+t.format(r.entries,"entries")),o>0&&(t.addText("Mean = "+t.format(r.meanx)),t.addText("Mean y = "+t.format(r.meany))),l>0&&(t.addText("Std Dev = "+t.format(r.rmsx)),t.addText("Std Dev y = "+t.format(r.rmsy)))):(a>0&&t.addText("Entries = "+t.format(r.entries,"entries")),o>0&&t.addText("Mean = "+t.format(r.meanx)),l>0&&t.addText("Std Dev = "+t.format(r.rmsx)),h>0&&t.addText("Underflow = "+t.format(n.fArray.length>0?n.fArray[0]:0,"entries")),c>0&&t.addText("Overflow = "+t.format(n.fArray.length>0?n.fArray[n.fArray.length-1]:0,"entries")),d>0&&t.addText("Integral = "+t.format(r.integral,"entries")),u>0&&t.addText("Skew = <not avail>"),f>0&&t.addText("Kurt = <not avail>")),i&&t.fillFunctionStat(this.findFunction("TF1"),i),!0}drawBars(t,e,i){this.createG(!0);let n,r,s,a,o,l,h,c,d,u,f,m,g=this.getSelectIndex("x","left",-1),_=this.getSelectIndex("x","right",1),x=this.getHisto(),y=x.fXaxis,A=this.options.Text,v="",b="",w="",M=this.options.BarStyle>10?this.options.BarStyle%10:0;for(M>4&&(M=4),f=e.swap_xy?0:t,Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=i.scale_ymin&&(f=Math.round(i.gry(this.options.BaseLine))),A&&(n=this.getColor(x.fMarkerColor),r=-1*this.options.TextAngle,s=20,1!==x.fMarkerSize&&r&&(s=.02*t*x.fMarkerSize),this.startTextDrawing(42,s,this.draw_g,s)),a=g;a<_;++a)if(o=y.GetBinLowEdge(a+1),l=y.GetBinLowEdge(a+2),!(e.logx&&l<=0)&&(h=Math.round(i.grx(o)),c=Math.round(i.grx(l)),d=x.getBinContent(a+1),!(i.logy&&d<i.scale_ymin)&&(u=Math.round(i.gry(d)),m=c-h,h+=Math.round(x.fBarOffset/1e3*m),m=Math.round(x.fBarWidth/1e3*m),e.swap_xy?v+=`M${f},${h}h${u-f}v${m}h${f-u}z`:v+=`M${h},${u}h${m}v${f-u}h${-m}z`,M>0&&(c=h+m,m=Math.round(m*M/10),e.swap_xy?(b+=`M${f},${h}h${u-f}v${m}h${f-u}z`,w+=`M${f},${c}h${u-f}v${-m}h${f-u}z`):(b+=`M${h},${u}h${m}v${f-u}h${-m}z`,w+=`M${c},${u}h${-m}v${f-u}h${m}z`)),A&&d))){let t=d===Math.round(d)?d.toString():rl(d,p.fPaintTextFormat);e.swap_xy?this.drawText({align:12,x:Math.round(u+s/2),y:Math.round(h+.1),height:Math.round(.8*m),text:t,color:n,latex:0}):r?this.drawText({align:12,x:h+m/2,y:Math.round(u-2-s/5),width:0,height:0,rotate:r,text:t,color:n,latex:0}):this.drawText({align:22,x:Math.round(h+.1*m),y:Math.round(u-2-s),width:Math.round(.8*m),height:s,text:t,color:n,latex:0})}if(v&&this.draw_g.append("svg:path").attr("d",v).call(this.fillatt.func),b&&this.draw_g.append("svg:path").attr("d",b).call(this.fillatt.func).style("fill",ut(this.fillatt.color).brighter(.5).formatHex()),w&&this.draw_g.append("svg:path").attr("d",w).call(this.fillatt.func).style("fill",ut(this.fillatt.color).darker(.5).formatHex()),A)return this.finishTextDrawing()}drawFilledErrors(t){this.createG(!0);let e,i,n,r,s,a,o,l=this.getSelectIndex("x","left",-1),h=this.getSelectIndex("x","right",1),c=this.getHisto(),d=c.fXaxis,u=[],f=[];for(e=l;e<h;++e)i=d.GetBinCoord(e+.5),t.logx&&i<=0||(n=Math.round(t.grx(i)),r=c.getBinContent(e+1),s=c.getBinError(e+1),t.logy&&r-s<t.scale_ymin||(a=Math.round(t.gry(r+s)),o=Math.round(t.gry(r-s)),u.push({grx:n,gry:a}),f.unshift({grx:n,gry:o})));let m=4===this.options.ErrorKind?"bezier":"line",p=ol(m,u),g=ol("L"+m,f);this.draw_g.append("svg:path").attr("d",p.path+g.path+"Z").call(this.fillatt.func)}draw1DBins(){this.createHistDrawAttributes();let t=this.getFramePainter(),e=t.getGrFuncs(this.options.second_x,this.options.second_y),i=t.getFrameWidth(),n=t.getFrameHeight();if(!this.draw_content||i<=0||n<=0)return this.removeG();if(this.options.Bar)return this.drawBars(n,t,e);if(3===this.options.ErrorKind||4===this.options.ErrorKind)return this.drawFilledErrors(t,e);let r,s,a,o,h,c,d,u,f,g,_,x,y,A,v,b,w,M,T,S,C,P,E,k,D,z,O,R=this.getSelectIndex("x","left",-1),L=this.getSelectIndex("x","right",2),B=this.getHisto(),N=!l()&&m.Tooltip,F=B.fXaxis,I="",j=!1,q=!this.options.Zero,U=this.options.Error,G=this.options.Mark,H=this.options.Line||this.options.Curve,X=this.options.Text,V=X&&"E"==this.options.TextKind&&this.isTProfile()&&B.fBinEntries,Y=null,$=null,W=null,Z=null,Q=null,J=null,K=5,tt=!1,et=!1,it=0,nt=0;U&&!G&&B.fMarkerStyle>1&&(G=!0),2===this.options.ErrorKind?this.fillatt.empty()?G=!0:Y="":this.options.Error&&($="",Q=N?"":null,et=!0),H&&(Z=""),nt=this.lineatt.width+p.fEndErrorSize,1===this.options.ErrorKind&&(it=Math.floor((this.lineatt.width-1)/2)),G&&(this.createAttMarker({attr:B,style:this.options.MarkStyle}),this.markeratt.size>0?(W="",tt=!0,this.markeratt.resetPos(),null===Q&&N&&(!this.markeratt.fill||this.markeratt.getFullSize()<7)&&(J="",K=Math.max(5,Math.round(.7*this.markeratt.getFullSize())))):G=!1);let rt=U||G,st=rt||X||H,at=this.options.Hist&&(!this.lineatt.empty()||!this.fillatt.empty());if(!at&&!st)return this.removeG();if(this.createG(!0),X){if(D=this.getColor(B.fMarkerColor),z=-1*this.options.TextAngle,O=20,1!==B.fMarkerSize&&z&&(O=.02*n*B.fMarkerSize),!z&&!this.options.TextKind){let t=i/(L-R+1);t<3*O&&(z=270,O=Math.round(.7*t))}this.startTextDrawing(42,O,this.draw_g,O)}let ot=st||L-R>3*i;const lt=t=>(M=B.getBinContent(t+1),(!q||0!==M)&&(S=Math.round(e.grx(F.GetBinLowEdge(t+1))),C=Math.round(e.grx(F.GetBinLowEdge(t+2))),P=Math.round((S+C)/2),v=Math.round(e.gry(M)),U?(T=B.getBinError(t+1),b=Math.round(v-e.gry(M+T)),w=Math.round(e.gry(M-T)-v)):b=w=20,!0));let ht=()=>{let t=5;this.options.errorX>0&&(t=Math.round((C-S)*this.options.errorX),E=P-t,k=P+t,1===this.options.ErrorKind?$+=`M${E+it},${v-nt}v${2*nt}m0,-${nt}h${k-E-2*it}m0,-${nt}v${2*nt}`:$+=`M${E+it},${v}h${k-E-2*it}`),1===this.options.ErrorKind?$+=`M${P-nt},${v-b+it}h${2*nt}m${-nt},0v${b+w-2*it}m${-nt},0h${2*nt}`:$+=`M${P},${v-b+it}v${b+w-2*it}`,null!==Q&&(Q+=`M${P-t},${v-b}h${2*t}v${b+w}h${-2*t}z`)};const ct=t=>{if(lt(t)){if(X){let e=V?B.fBinEntries[t+1]:M;if(0!==e){let t=e===Math.round(e)?e.toString():rl(e,p.fPaintTextFormat);z?this.drawText({align:12,x:P,y:Math.round(v-2-O/5),width:0,height:0,rotate:z,text:t,color:D,latex:0}):this.drawText({align:22,x:Math.round(S+.1*(C-S)),y:Math.round(v-2-O),width:Math.round(.8*(C-S)),height:O,text:t,color:D,latex:0})}}H&&null!==Z&&(Z+=(0===Z.length?"M":"L")+P+","+v),rt&&v>=-b&&v<=n+w&&(null!==Y&&(Y+=`M${S},${v-b}h${C-S}v${b+w+1}h${S-C}z`),null!==W&&tt&&(W+=this.markeratt.create(P,v),null!==J&&(J+=`M${P-K},${v-K}h${2*K}v${2*K}h${-2*K}z`)),null!==$&&et&&ht())}};if((tt||et)&&(!m.OptimizeDraw||L-R<5e4&&1==m.OptimizeDraw)){for(x=R;x<L;++x)lt(x)&&(null!==W&&(W+=this.markeratt.create(P,v)),null!==J&&(J+=`M${P-K},${v-K}h${2*K}v${2*K}h${-2*K}z`),null!==$&&ht());et=tt=!1}for(x=R;x<=L;++x)o=F.GetBinLowEdge(x+1),this.logx&&o<=0||(h=Math.round(e.grx(o)),j=x===L,j&&R<L?d=a:(c=B.getBinContent(x+1),d=Math.round(e.gry(c))),0===I.length?(y=A=x,_=r=s=h,g=u=f=a=d,I="M"+s+","+a):ot?h!==s||j?(st&&(y===A?ct(y):y<A?(ct(y),ct(A)):(ct(A),ct(y))),!at||u===f&&g===u||(_!==s&&(I+="h"+(s-_)),a===u?(f!==g&&(I+="v"+(f-g)),u!==f&&(I+="v"+(u-f))):(u!==g&&(I+="v"+(u-g)),f!==u&&(I+="v"+(f-u)),a!==f&&(I+="v"+(a-f))),_=s,g=a),j&&_!==h&&(I+="h"+(h-_)),y=A=x,u=f=a=d,s=h):(d<u?A=x:d>f&&(y=x),u=Math.min(u,d),f=Math.max(f,d),a=d):(d!==a||j)&&(h!==s&&(I+="h"+(h-s)),d!==a&&(I+="v"+(d-a)),a=d,s=h));let dt=N&&this.fillatt.empty()&&at&&!rt&&!H,ut=n+3;if(!dt){let t=Math.round(e.gry(0));t<=0?ut=-3:t<n&&(ut=t)}let ft=`L${s},${ut}H${r}Z`;return(rt||H)&&(null!==Y&&Y.length>0&&this.draw_g.append("svg:path").attr("d",Y).call(this.fillatt.func),$&&this.draw_g.append("svg:path").attr("d",$).call(this.lineatt.func),Q&&this.draw_g.append("svg:path").attr("d",Q).style("fill","none").style("pointer-events",l()?null:"visibleFill"),Z&&(this.fillatt.empty()||at||this.draw_g.append("svg:path").attr("d",Z+ft).call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",Z).style("fill","none").call(this.lineatt.func)),W&&this.draw_g.append("svg:path").attr("d",W).call(this.markeratt.func),J&&this.draw_g.append("svg:path").attr("d",J).style("fill","none").style("pointer-events",l()?null:"visibleFill")),I&&at&&this.draw_g.append("svg:path").attr("d",I+(!this.fillatt.empty()||dt?ft:"")).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func),X?this.finishTextDrawing():void 0}getBinTooltips(t){let e=[],i=this.getObjectHint(),n=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),r=this.getHisto(),s=r.fXaxis.GetBinLowEdge(t+1),a=r.fXaxis.GetBinLowEdge(t+2),o=r.getBinContent(t+1),l=this.getAxisBinTip("x",r.fXaxis,t);return i.length>0&&e.push(i),this.options.Error||this.options.Mark?(e.push("x = "+l),e.push("y = "+n.axisAsText("y",o)),this.options.Error&&("["==l[0]&&e.push("error x = "+((a-s)/2).toPrecision(4)),e.push("error y = "+r.getBinError(t+1).toPrecision(4)))):(e.push("bin = "+(t+1)),e.push("x = "+l),r.$baseh&&(o-=r.$baseh.getBinContent(t+1)),o===Math.round(o)?e.push("entries = "+o):e.push("entries = "+rl(o,p.fStatFormat))),e}processTooltipEvent(t){if(!t||!this.draw_content||!this.draw_g||this.options.Mode3D)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;const e=this.getFramePainter(),i=e.getGrFuncs(this.options.second_x,this.options.second_y),n=this.getHisto(),r=this.getSelectIndex("x","left",-1),s=this.getSelectIndex("x","right",2);let a,o,l,h,c,d,u,f=e.getFrameWidth(),m=e.getFrameHeight(),p=null,g=2,_=r,x=s,y=t.x,A=t.y;const v=t=>{let e=n.fXaxis.GetBinLowEdge(t+1);return i.logx&&e<=0?null:i.grx(e)},b=t=>{let e=n.getBinContent(t+1);return i.logy&&e<i.scale_ymin?i.swap_xy?-1e3:10*m:Math.round(i.gry(e))};if(i.swap_xy){let e=t.x;y=A,A=e,e=m,m=f,f=e}for(;_<x-1;){let t=Math.round(.5*(_+x)),e=v(t);null===e||e<y-.5?i.swap_xy?x=t:_=t:e>y+.5?i.swap_xy?_=t:x=t:(_++,x--)}if(p=x=_,o=v(p),e.swap_xy){for(;_>r&&v(_-1)<o+2;)--_;for(;x<s&&v(x+1)>o-2;)++x}else{for(;_>r&&v(_-1)>o-2;)--_;for(;x<s&&v(x+1)<o+2;)++x}if(_<x){let t=m;for(let e=_;e<=x;e++){let i=Math.abs(b(e)-A);i<t&&(t=i,p=e)}t>m/10&&(p=Math.round(_+(x-_)/m*A)),o=v(p)}if(o=Math.round(o),h=Math.round(v(p+1)),this.options.Bar){let t=h-o;o+=Math.round(n.fBarOffset/1e3*t),h=o+Math.round(n.fBarWidth/1e3*t)}if(o>h){let t=o;o=h,h=t}if(l=Math.round((o+h)/2),d=c=u=b(p),this.options.Bar){if(a=!0,g=0,c=Math.round(i.gry(!1!==this.options.BaseLine&&this.options.BaseLine>i.scale_ymin?this.options.BaseLine:i.scale_ymin)),c>u){let t=c;c=u,u=t}t.touch||1!==t.nproc||(A<c||A>u)&&(p=null)}else if(this.options.Error||this.options.Mark||this.options.Line||this.options.Curve){a=!0;let e=3;if(this.markeratt&&(e=Math.max(e,this.markeratt.getFullSize())),this.options.Error){let t=n.getBinContent(p+1),e=n.getBinError(p+1);c=Math.round(i.gry(t+e)),u=Math.round(i.gry(t-e)),0==t&&this.isTProfile()&&(p=null);let r=(h-o)*this.options.errorX;o=Math.round(l-r),h=Math.round(l+r)}h-o<2*e&&(o=l-e,h=l+e),c=Math.min(c,d-e),u=Math.max(u,d+e),t.touch||1!==t.nproc||(A<c||A>u)&&(p=null)}else if(a=1===t.nproc&&s-r<f,a){if(u=m,!this.fillatt.empty()&&(u=Math.round(i.gry(0)),u<0?u=0:u>m&&(u=m),u<c)){let t=c;c=u,u=t}(t.y<c||t.y>u)&&!t.touch&&(p=null)}null!==p&&(p===r&&o>y+g||p===s-1&&h<y-g||y<o-g||y>h+g?p=null:this.options.Zero||0!==n.getBinContent(p+1)||(p=null));let w=this.draw_g.select(".tooltip_bin");if(null===p||u<=0||c>=m)return w.remove(),null;let M={name:n.fName,title:n.fTitle,x:l,y:d,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(p)};if(t.disabled)w.remove(),M.changed=!0;else if(a)w.empty()&&(w=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),M.changed=w.property("current_bin")!==p,M.changed&&w.attr("x",i.swap_xy?c:o).attr("width",i.swap_xy?u-c:h-o).attr("y",i.swap_xy?o:c).attr("height",i.swap_xy?h-o:u-c).style("opacity","0.3").property("current_bin",p),M.exact=Math.abs(d-A)<=5||A>=c&&A<=u,M.menu=!0,M.menu_dist=Math.sqrt((l-y)*(l-y)+(d-A)*(d-A));else{let e=this.lineatt.width+3;w.empty()&&(w=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",e).call(this.lineatt.func).call(this.fillatt.func)),M.exact=Math.abs(l-t.x)<=e&&Math.abs(d-t.y)<=e,M.menu=M.exact,M.menu_dist=Math.sqrt((l-t.x)*(l-t.x)+(d-t.y)*(d-t.y)),M.changed=w.property("current_bin")!==p,M.changed&&w.attr("cx",l).attr("cy",d).property("current_bin",p)}return M.changed&&(M.user_info={obj:n,name:n.fName,bin:p,cont:n.getBinContent(p+1),grx:l,gry:d}),M}fillHistContextMenu(t){t.add("Auto zoom-in",(()=>this.autoZoom()));let e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,(t=>{if("inspect"===t)return this.showInspector();this.decodeOptions(t),this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")})),this.snapid||this.isTProfile()||t.addRebinMenu((t=>this.rebinHist(t)))}rebinHist(t){let e=this.getHisto(),i=e.fXaxis,n=Math.floor(i.fNbins/t);if(n<2)return;let r=new Array(n+2),s=null;i.fXbins.length>0&&(s=new Array(n)),r[0]=e.fArray[0];let a=1;for(let o=1;o<=n;++o){s&&(s[o-1]=i.fXbins[a-1]);let n=0;for(let i=0;i<t;++i)n+=e.fArray[a++];r[o]=n}s?(a<=i.fXbins.length&&(i.fXmax=i.fXbins[a-1]),i.fXbins=s):i.fXmax=i.fXmin+(i.fXmax-i.fXmin)/i.fNbins*n*t,i.fNbins=n;let o=0;for(;a<e.fArray.length;)o+=e.fArray[a++];r[n+1]=o,e.fArray=r,e.fSumw2=[],this.scanContent(),this.interactiveRedraw("pad")}autoZoom(){let t=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",1),i=e-t,n=this.getHisto();if(0==i||!n)return;let r=n.getBinContent(t+1);for(let i=t;i<e;++i)r=Math.min(r,n.getBinContent(i+1));if(!(r>0)){for(;t<e&&n.getBinContent(t+1)<=r;)++t;for(;t<e&&n.getBinContent(e)<=r;)--e;return t===e-1&&t>2&&e<this.nbinsx-2&&(--t,++e),e-t<i&&t<e?this.getFramePainter().zoom(n.fXaxis.GetBinLowEdge(t+1),n.fXaxis.GetBinLowEdge(e+1)):void 0}}canZoomInside(t,e,i){let n=this.getHisto();return!!("x"==t&&n&&n.fXaxis.FindBin(i,.5)-n.fXaxis.FindBin(e,0)>1)||"y"==t&&Math.abs(i-e)>1e-6*Math.abs(this.ymax-this.ymin)}callDrawFunc(t){let e=this.getMainPainter(),i=this.getFramePainter();return e!==this&&i&&i.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(e),this.options.Mode3D?this.draw3D(t):this.draw2D(t)}draw2D(){return this.clear3DScene(),this.scanContent(!0),(this.isMainPainter()?this.drawColorPalette(!1):Promise.resolve(!0)).then((()=>this.drawAxes())).then((()=>this.draw1DBins())).then((()=>this.drawHistTitle())).then((()=>(this.updateStatWebCanvas(),this.addInteractivity())))}draw3D(t){return console.log("3D drawing is disabled, load ./hist/TH1Painter.mjs"),this.draw2D(t)}redraw(t){return this.callDrawFunc(t)}static draw(t,e,i){return lb._drawHist(new lb(t,e),i)}}class hb extends lb{draw3D(t){this.mode3d=!0;let e=this.getFramePainter(),i=this.isMainPainter(),n=this.getHisto(),r=Promise.resolve(!0);return"resize"==t?i&&e.resize3D()&&e.render3D():(this.deleteAttr(),this.scanContent(!0),i&&(iA(e),e.create3DScene(this.options.Render3D,this.options.x3dscale,this.options.y3dscale),e.setAxesRanges(n.fXaxis,this.xmin,this.xmax,n.fYaxis,this.ymin,this.ymax,n.fZaxis,0,0),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,Dy,{use_y_for_z:!0,zmult:1.1,zoom:m.Zooming,ndim:1,draw:-1!==this.options.Axis})),e.mode3d&&(nA(this),e.render3D(),this.updateStatWebCanvas(),e.addKeysHandler())),i&&(r=this.drawColorPalette(this.options.Zscale&&(12===this.options.Lego||14===this.options.Lego)).then((()=>this.drawHistTitle()))),r.then((()=>this))}static draw(t,e,i){return hb._drawHist(new hb(t,e),i)}}var cb=Object.freeze({__proto__:null,TH1Painter:hb});class db extends ob{constructor(t,e){super(t,e),this.fPalette=null,this.wheel_zoomy=!0,this._show_empty_bins=!1}cleanup(){delete this.tt_handle,super.cleanup()}toggleProjection(t,e){if("Projections"!=t&&"Off"!=t||(t=""),"string"==typeof t&&t.length>1&&(e=parseInt(t.slice(1)),t=t[0]),e||(e=1),t&&this.is_projection==t){if(this.projection_width!==e)return void(this.projection_width=e);t=""}delete this.proj_hist;let i=this.is_projection===t?"":t;this.projection_width=e,this.is_projection="",this.provideSpecialDrawArea(i).then((()=>(this.is_projection=i,this.redrawProjection())))}redrawProjection(t,e,i,n){if(!this.is_projection)return;if(void 0===n){if(!this.tt_handle)return;e=(t=Math.round((this.tt_handle.i1+this.tt_handle.i2)/2))+1,n=(i=Math.round((this.tt_handle.j1+this.tt_handle.j2)/2))+1}let r=this.getCanvPainter(),s=this.getHisto();if(r&&!r._readonly&&void 0!==this.snapid){let s="EXECANDSEND:D"+this.is_projection+"PROJ:"+this.snapid+":";return"X"==this.is_projection?s+='ProjectionX("_projx",'+(i+1)+","+n+',"")':s+='ProjectionY("_projy",'+(t+1)+","+e+',"")',void r.sendWebsocket(s)}this.proj_hist||("X"==this.is_projection?(this.proj_hist=D("TH1D",this.nbinsx),Object.assign(this.proj_hist.fXaxis,s.fXaxis),this.proj_hist.fName="xproj",this.proj_hist.fTitle="X projection"):(this.proj_hist=D("TH1D",this.nbinsy),Object.assign(this.proj_hist.fXaxis,s.fYaxis),this.proj_hist.fName="yproj",this.proj_hist.fTitle="Y projection"));let a=0,o=-1;if("X"==this.is_projection){for(let t=0;t<this.nbinsx;++t){let e=0;for(let r=i;r<n;++r)e+=s.getBinContent(t+1,r+1);this.proj_hist.setBinContent(t+1,e)}this.proj_hist.fTitle="X projection "+(i+1==n?`bin ${n}`:`bins [${i+1} .. ${n}]`),this.tt_handle&&(a=this.tt_handle.i1+1,o=this.tt_handle.i2)}else{for(let i=0;i<this.nbinsy;++i){let n=0;for(let r=t;r<e;++r)n+=s.getBinContent(r+1,i+1);this.proj_hist.setBinContent(i+1,n)}this.proj_hist.fTitle="Y projection "+(t+1==e?`bin ${e}`:`bins [${t+1} .. ${e}]`),this.tt_handle&&(a=this.tt_handle.j1+1,o=this.tt_handle.j2)}if(a<o){let t=this.proj_hist.fXaxis;t.fFirst=a,t.fLast=o,(1==t.fFirst&&t.fLast==t.fNbins)==t.TestBit(Py.kAxisRange)&&t.InvertBit(Py.kAxisRange)}return this.proj_hist.fEntries=0,this.proj_hist.fTsumw=0,this.drawInSpecialArea(this.proj_hist)}executeMenuCommand(t,e){return!!super.executeMenuCommand(t,e)||("SetShowProjectionX"==t.fName||"SetShowProjectionY"==t.fName)&&(this.toggleProjection(t.fName[17],e&&parseInt(e)?parseInt(e):1),!0)}fillHistContextMenu(t){if(!this.isTH2Poly()){t.add("sub:Projections",(()=>this.toggleProjection()));let e=this.is_projection||"";e&&(e+=this.projection_width);const i=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10"];this.is_projection&&i.push("Off");for(let n=0;n<i.length;++n)t.addchk(e==i[n],i[n],i[n],(t=>this.toggleProjection(t)));t.add("endsub:"),t.add("Auto zoom-in",(()=>this.autoZoom()))}let e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,(t=>{if("inspect"==t)return this.showInspector();this.decodeOptions(t),this.interactiveRedraw("pad","drawopt")})),this.options.Color&&this.fillPaletteMenu(t)}clickButton(t){if(super.clickButton(t))return!0;if(this!==this.getMainPainter())return!1;switch(t){case"ToggleColor":this.toggleColor();break;case"ToggleColorZ":this.toggleColz();break;case"Toggle3D":this.toggleMode3D();break;default:return!1}return!0}fillToolbar(){super.fillToolbar(!0);let t=this.getPadPainter();t&&(this.isTH2Poly()||t.addPadButton("th2color","Toggle color","ToggleColor"),t.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),t.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),t.showPadButtons())}toggleColor(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color,this._can_move_colz=!0,this.copyOptionsToOthers(),this.redrawPad()}autoZoom(){if(this.isTH2Poly())return;let t,e,i=this.getSelectIndex("x","left",-1),n=this.getSelectIndex("x","right",1),r=this.getSelectIndex("y","left",-1),s=this.getSelectIndex("y","right",1),a=this.getObject();if(i==n||r==s)return;let o=a.getBinContent(i+1,r+1);for(t=i;t<n;++t)for(e=r;e<s;++e)o=Math.min(o,a.getBinContent(t+1,e+1));if(o>0)return;let l=n,h=i,c=s,d=r;for(t=i;t<n;++t)for(e=r;e<s;++e)a.getBinContent(t+1,e+1)>o&&(t<l&&(l=t),t>=h&&(h=t+1),e<c&&(c=e),e>=d&&(d=e+1));let u,f,m,p,g=!1;return l===h-1&&l>i+1&&h<n-1&&(l--,h++),c===d-1&&c>r+1&&d<s-1&&(c--,d++),(l>i||h<n)&&l<h-1&&(u=a.fXaxis.GetBinLowEdge(l+1),f=a.fXaxis.GetBinLowEdge(h+1),g=!0),(c>r||d<s)&&c<d-1&&(m=a.fYaxis.GetBinLowEdge(c+1),p=a.fYaxis.GetBinLowEdge(d+1),g=!0),g?this.getFramePainter().zoom(u,f,m,p):void 0}scanContent(t){if(t&&this.nbinsx&&this.nbinsy)return;let e,i,n=this.getObject();if(this.extractAxesProperties(2),this.isTH2Poly()){this.gminposbin=null,this.gminbin=this.gmaxbin=0;for(let t=0,e=n.fBins.arr.length;t<e;++t){let e=n.fBins.arr[t].fContent;0===t&&(this.gminbin=this.gmaxbin=e),e<this.gminbin?this.gminbin=e:e>this.gmaxbin&&(this.gmaxbin=e),e>0&&(null===this.gminposbin||this.gminposbin>e)&&(this.gminposbin=e)}}else for(this.gminbin=this.gmaxbin=n.getBinContent(1,1),this.gminposbin=null,e=0;e<this.nbinsx;++e)for(i=0;i<this.nbinsy;++i){let t=n.getBinContent(e+1,i+1);t<this.gminbin?this.gminbin=t:t>this.gmaxbin&&(this.gmaxbin=t),t>0&&(null===this.gminposbin||this.gminposbin>t)&&(this.gminposbin=t)}null===this.gminposbin&&(this.gminposbin=1e-4*this.gmaxbin),this.options.Axis>0?this.draw_content=!1:(this.draw_content=this.gmaxbin>0,!this.draw_content&&this.options.Zero&&this.isTH2Poly()&&(this.draw_content=!0,this.options.Line=1))}countStat(t){let e,i,n,r,s,a=this.getHisto(),o=a.fXaxis,l=a.fYaxis,h=0,c=0,d=0,u=0,f=0,m=this.getFramePainter(),p=m.getGrFuncs(this.options.second_x,this.options.second_y),g={name:a.fName,entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.isTH2Poly()){let o,l,m,_,x,y,A,v=a.fBins.arr.length;for(o=0;o<v;++o){for(l=a.fBins.arr[o],e=1,i=1,l.fXmin>p.scale_xmax?e=2:l.fXmax<p.scale_xmin&&(e=0),l.fYmin>p.scale_ymax?i=2:l.fYmax<p.scale_ymin&&(i=0),n=r=A=0,_=l.fPoly,y=1,"TMultiGraph"===_._typename&&(y=l.fPoly.fGraphs.arr.length,_=null),x=0;x<y;++x)for((!_||x>0)&&(_=l.fPoly.fGraphs.arr[x]),m=0;m<_.fNpoints;++m)++A,n+=_.fX[m],r+=_.fY[m];A>1&&(n/=A,r/=A),s=l.fContent,g.entries+=s,g.matrix[3*i+e]+=s,1==e&&1==i&&(t&&!t(n,r)||((null===g.wmax||s>g.wmax)&&(g.wmax=s,g.xmax=n,g.ymax=r),h+=s,c+=n*s,d+=r*s,u+=n*n*s,f+=r*r*s))}}else{let m,p,_=this.getSelectIndex("x","left"),x=this.getSelectIndex("x","right"),y=this.getSelectIndex("y","left"),A=this.getSelectIndex("y","right");for(m=0;m<=this.nbinsx+1;++m)for(e=m<=_?0:m>x?2:1,n=o.GetBinCoord(m-.5),p=0;p<=this.nbinsy+1;++p)i=p<=y?0:p>A?2:1,r=l.GetBinCoord(p-.5),s=a.getBinContent(m,p),g.entries+=s,g.matrix[3*i+e]+=s,1==e&&1==i&&(t&&!t(n,r)||((null===g.wmax||s>g.wmax)&&(g.wmax=s,g.xmax=n,g.ymax=r),h+=s,c+=n*s,d+=r*s,u+=n*n*s,f+=r*r*s))}return!m.isAxisZoomed("x")&&!m.isAxisZoomed("y")&&a.fTsumw>0&&(h=a.fTsumw,c=a.fTsumwx,u=a.fTsumwx2,d=a.fTsumwy,f=a.fTsumwy2),h>0&&(g.meanx=c/h,g.meany=d/h,g.rmsx=Math.sqrt(Math.abs(u/h-g.meanx*g.meanx)),g.rmsy=Math.sqrt(Math.abs(f/h-g.meany*g.meany))),null===g.wmax&&(g.wmax=0),g.integral=h,a.fEntries>1&&(g.entries=a.fEntries),g}fillStatistic(t,e,i){if(this.isIgnoreStatsFill())return!1;let n=this.countStat(),r=Math.floor(e%10),s=Math.floor(e/10)%10,a=Math.floor(e/100)%10,o=Math.floor(e/1e3)%10,l=Math.floor(e/1e4)%10,h=Math.floor(e/1e5)%10,c=Math.floor(e/1e6)%10,d=Math.floor(e/1e7)%10,u=Math.floor(e/1e8)%10;if(t.clearPave(),r>0&&t.addText(n.name),s>0&&t.addText("Entries = "+t.format(n.entries,"entries")),a>0&&(t.addText("Mean x = "+t.format(n.meanx)),t.addText("Mean y = "+t.format(n.meany))),o>0&&(t.addText("Std Dev x = "+t.format(n.rmsx)),t.addText("Std Dev y = "+t.format(n.rmsy))),c>0&&t.addText("Integral = "+t.format(n.matrix[4],"entries")),d>0&&(t.addText("Skewness x = <undef>"),t.addText("Skewness y = <undef>")),u>0&&t.addText("Kurt = <undef>"),l>0||h>0){let e=n.matrix;t.addText(e[6].toFixed(0)+" | "+e[7].toFixed(0)+" | "+e[7].toFixed(0)),t.addText(e[3].toFixed(0)+" | "+e[4].toFixed(0)+" | "+e[5].toFixed(0)),t.addText(e[0].toFixed(0)+" | "+e[1].toFixed(0)+" | "+e[2].toFixed(0))}return i&&t.fillFunctionStat(this.findFunction("TF2"),i),!0}drawBinsColor(){const t=this.getHisto(),e=this.prepareDraw(),i=this.getContour(),n=this.getHistPalette(),r=[],s=this._show_empty_bins,a=1===e.ybar2&&0===e.ybar1;let o,l,h,c,d,u,f,m=null,p=!this.options.Zero;const g=()=>{m.path+=`h${o}v${m.y1-m.y2}h${-o}z`,m=null};p||s||null!==i.getPaletteIndex(n,0)||(p=!0);for(let _=e.i1;_<e.i2;++_){o=e.grx[_+1]-e.grx[_],h=Math.round(e.grx[_]+o*e.xbar1),o=Math.round(o*(e.xbar2-e.xbar1))||1;for(let x=e.j2-1;x>=e.j1;--x){if(d=t.getBinContent(_+1,x+1),u=0===d,u&&p){m&&g();continue}if(f=i.getPaletteIndex(n,d),null===f){if(!u||!s){m&&g();continue}f=0}l=e.gry[x]-e.gry[x+1]||1,a?c=e.gry[x+1]:(c=Math.round(e.gry[x+1]+l*e.ybar2),l=Math.round(l*(e.ybar2-e.ybar1))||1);let y=`M${h},${c}`,A=r[f];if(A){if(a&&A===m){A.y1=c+l;continue}{let t=h-A.x1,e=c-A.y2;if(t||e){let i=`m${t},${e}`;A.path+=i.length<y.length?i:y}}}else A=r[f]={path:y};m&&g(),A.x1=h,A.y2=c,a?(A.y1=c+l,m=A):A.path+=`h${o}v${l}h${-o}z`}m&&g()}return r.forEach(((t,e)=>{t&&this.draw_g.append("svg:path").attr("fill",n.getColor(e)).attr("d",t.path)})),e}buildContour(t,e,i,n){const r=this.getObject(),s=new Float32Array(4008),a=new Float32Array(4008),o=new Int32Array(4008),l=e.length;let h,c,d,u,f,m,p,g,_,x,y,A,v,b,w,M=0,T=[],S=0,C=[0,0,0,0],P=[0,0,0,0],E=[0,0,0,0],k=[0,0,0,0];const D=t=>{for(let i=0;i<l;++i)if(t<e[i])return i-1;return l-1},O=(t,i,n,r,l,h,c,d)=>{let u,f,m,p,g=n===c,_=g?d-r:c-n,x=i+1,y=l-t,A=M-1,v=999+M,b=0;for(;x<=h&&A<=v;)p=e[x],m=p-t,f=m/y,u=_*f,g?(s[A]=n,a[A]=r+u):(s[A]=n+u,a[A]=r),o[A]=x,b++,A+=2,x++;return b};let R=t.original?t.origx:t.grx,L=t.original?t.origy:t.gry;for(f=t.j1;f<t.j2-1;++f)for(P[1]=P[0]=(L[f]+L[f+1])/2,P[3]=P[2]=(L[f+1]+L[f+2])/2,u=t.i1;u<t.i2-1;++u){for(E[0]=r.getBinContent(u+1,f+1),E[1]=r.getBinContent(u+2,f+1),E[2]=r.getBinContent(u+2,f+2),E[3]=r.getBinContent(u+1,f+2),m=0;m<4;m++)k[m]=D(E[m]);if(k[0]!==k[1]||k[1]!==k[2]||k[2]!==k[3]||k[3]!==k[0]){for(C[3]=C[0]=(R[u]+R[u+1])/2,C[2]=C[1]=(R[u+1]+R[u+2])/2,p=E[0]<=E[1]?0:1,g=E[2]<=E[3]?2:3,E[p]>E[g]&&(p=g),p++,M=1,b=1;b<=4;b++)g=p%4+1,_=O(E[p-1],k[p-1],C[p-1],P[p-1],E[g-1],k[g-1],C[g-1],P[g-1]),M+=2*_,p=g;for(p=E[0]<=E[1]?0:1,g=E[2]<=E[3]?2:3,E[p]>E[g]&&(p=g),p++,M=2,b=1;b<=4;b++)g=1==p?4:p-1,_=O(E[p-1],k[p-1],C[p-1],P[p-1],E[g-1],k[g-1],C[g-1],P[g-1]),M+=2*_,p=g;for(x=0,b=1;b<=M-5;b+=2)for(;o[b-1]!=o[b];){for(y=s[b],A=a[b],v=o[b],w=b;w<=M-5;w+=2)s[w]=s[w+2],a[w]=a[w+2],o[w]=o[w+2];if(s[M-3]=y,a[M-3]=A,o[M-3]=v,x>2e3)break;x++}if(x>2e3)continue;for(b=1;b<=M-2;b+=2)h=o[b-1],h>=0&&h<e.length&&(c=T[h],c||(c=T[h]=z(8016,!0)),d=c.fLastPoint,d<c.fN-2&&(c.fX[d+1]=Math.round(s[b-1]),c.fY[d+1]=Math.round(a[b-1]),c.fX[d+2]=Math.round(s[b]),c.fY[d+2]=Math.round(a[b]),c.fLastPoint=d+2,S=Math.max(S,c.fLastPoint+1)))}}let B=new Int32Array(e.length),N=0;for(h=0;h<e.length;h++)if(e[h]>=0){N=h;break}for(m=0,h=N-1;h>=0;h--)B[m]=h,m++;for(h=N;h<e.length;h++)B[m]=h,m++;let F=new Float32Array(2*S),I=new Float32Array(2*S);for(m=0;m<e.length;++m){if(h=B[m],c=T[h],!c)continue;let t,r,s,a=i.calcColorIndex(h,e.length),o=c.fX,l=c.fY,d=c.fLastPoint+1,f=0,p=0,g=0;for(;;){for(t=S,r=t+1,F[t]=o[f],I[t]=l[f],F[r]=o[f+1],I[r]=l[f+1],o[f]=o[f+1]=p,l[f]=l[f+1]=g;;){for(s=0,u=2;u<d;u+=2)r<2*S-1&&o[u]===F[r]&&l[u]===I[r]&&(r++,F[r]=o[u+1],I[r]=l[u+1],o[u]=o[u+1]=p,l[u]=l[u+1]=g,s++),t>0&&o[u+1]===F[t]&&l[u+1]===I[t]&&(t--,F[t]=o[u],I[t]=l[u],o[u]=o[u+1]=p,l[u]=l[u+1]=g,s++);if(0==s)break}for(t+1<r&&t>=0&&n(a,F,I,t,r,h),f=0,u=2;u<d;u+=2)if(o[u]!==p&&l[u]!==g){f=u;break}if(0===f)break}}}drawBinsContour(){let t=this.prepareDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),e=this.getFramePainter(),i=e.getFrameWidth(),n=e.getFrameHeight(),r=e.getGrFuncs(this.options.second_x,this.options.second_y),s=this.getContourLevels(),a=this.getHistPalette(),o=e.getProjectionFunc();const l=(t,e,i,n,s)=>{let a,l,h,c,d,u,f,m="",p=!1;for(let g=i;g<=n;++g){if(o){let i=o(t[g],e[g]);u=Math.round(r.grx(i.x)),f=Math.round(r.gry(i.y))}else u=Math.round(t[g]),f=Math.round(e[g]);if(m)if(g==n&&i!==n&&u==h&&f==c){if(!p)return"";m+="z",s=!1,d=!0}else{let t=u-a,e=f-l;t?(p=!0,m+=e?`l${t},${e}`:`h${t}`):e&&(p=!0,m+=`v${e}`)}else m=`M${u},${f}`,h=u,c=f;a=u,l=f}return!s||d||o?(s&&(m+="z"),m):"<failed>"},h=(t,e)=>{let i,n,r,s,a,o,l,h,c,d;if(r=t.x2-t.x1,s=t.y2-t.y1,a=e.x2-e.x1,o=e.y2-e.y1,c=r*o-a*s,0==c)return 0;let u=c>0;return i=t.x1-e.x1,n=t.y1-e.y1,l=r*n-s*i,l<0==u?null:(h=a*n-o*i,h<0==u||l>c==u||h>c==u?null:(d=h/c,{x:Math.round(t.x1+d*r),y:Math.round(t.y1+d*s)}))};if(14===this.options.Contour){let e=`M0,0h${i}v${n}h${-i}z`;if(this.options.Proj){let i=t.j2-t.j1,n=new Float32Array(2*i),r=new Float32Array(2*i);for(let e=0;e<i;++e)n[e]=t.origx[t.i1],r[e]=(t.origy[t.j1]*(e+.5)+t.origy[t.j2]*(i-.5-e))/i,n[e+i]=t.origx[t.i2],r[e+i]=(t.origy[t.j2]*(e+.5)+t.origy[t.j1]*(i-.5-e))/i;e=l(n,r,0,2*i-1,!0)}this.draw_g.append("svg:path").attr("d",e).style("fill",a.calcColor(0,s.length))}return this.buildContour(t,s,a,((t,e,r,s,o,c)=>{let d,u=a.getColor(t),f=u;switch(this.options.Contour){case 1:break;case 11:f="none",d=new Hl({color:u});break;case 12:f="none",d=new Hl({color:1,style:c%5+1,width:1});break;case 13:f="none",d=this.lineatt}let m=l(e,r,s,o,"none"!=f);if("<failed>"==m&&(m=((t,e,r,s,a)=>{const o=[{x:0,y:0},{x:i,y:0},{x:i,y:n},{x:0,y:n}],c=(i,n)=>{let r={x1:t[i],y1:e[i],x2:2*t[i]-t[i+n],y2:2*e[i]-e[i+n]};for(let t=0;t<4;++t){let e=h(r,{x1:o[t].x,y1:o[t].y,x2:o[(t+1)%4].x,y2:o[(t+1)%4].y});if(e)return e.indx=t+.5,e}return null};let d,u;for(r--;r<s-1&&!d;)d=c(++r,1);for(s++;r<s-1&&d&&!u;)u=c(--s,-1);if(!d||!u)return"";let f=l(t,e,r,s),m=u.indx,p=.5*a;for(f+=`L${u.x},${u.y}`;Math.abs(m-d.indx)>.1;)m=Math.round(m+p)%4,f+=`L${o[m].x},${o[m].y}`,m+=p;return f+`L${d.x},${d.y}z`})(e,r,s,o,1)),!m)return;let p=this.draw_g.append("svg:path").attr("class","th2_contour").attr("d",m).style("fill",f);d&&p.call(d.func)})),t.hide_only_zeros=!0,t}createPolyBin(t,e,i){let n,r="",s="",a=0,o=0,l=1,h=null;"TMultiGraph"==e.fPoly._typename?l=e.fPoly.fGraphs.arr.length:h=e.fPoly,i&&(e._sumx=e._sumy=e._suml=0);const c=(t,i,n,r)=>{const s=Math.sqrt((t-n)*(t-n)+(i-r)*(i-r));e._sumx+=(t+n)*s/2,e._sumy+=(i+r)*s/2,e._suml+=s},d=()=>{a&&(s+="h"+a,a=0),o&&(s+="v"+o,o=0)};for(n=0;n<l;++n){(!h||n>0)&&(h=e.fPoly.fGraphs.arr[n]);const l=h.fX,u=h.fY;let f,m,p,g,_,x=h.fNpoints,y=Math.round(t.grx(l[0])),A=Math.round(t.gry(u[0]));x>2&&l[0]===l[x-1]&&u[0]===u[x-1]&&x--;let v=`M${y},${A}`;for(s="",f=1;f<x;++f)m=Math.round(t.grx(l[f])),p=Math.round(t.gry(u[f])),i&&c(y,A,m,p),g=m-y,_=p-A,(g||_)&&(0===g?(0!==o&&_<0==o<0||d(),o+=_):0===_?(0!==a&&g<0==a<0||d(),a+=g):(d(),s+="l"+g+","+_),y=m,A=p);i&&c(y,A,Math.round(t.grx(l[0])),Math.round(t.gry(u[0]))),d(),s&&(r+=v+s+"z")}return i&&(e._suml>0?(e._midx=Math.round(e._sumx/e._suml),e._midy=Math.round(e._sumy/e._suml)):(e._midx=Math.round(t.grx((e.fXmin+e.fXmax)/2)),e._midy=Math.round(t.gry((e.fYmin+e.fYmax)/2)))),r}drawPolyBinsColor(){let t,e,i,n,r,s=this.getObject(),a=this.getFramePainter(),o=a.getGrFuncs(this.options.second_x,this.options.second_y),l=a.getFrameHeight(),h=[],c=[],d=s.fBins.arr.length;this.maxbin=this.gmaxbin,this.minbin=this.gminbin,this.minposbin=this.gminposbin;let u=this.getContour(!0),f=this.getHistPalette();for(r=0;r<d;++r)if(i=s.fBins.arr[r],t=u.getPaletteIndex(f,i.fContent),null!==t){if(0===i.fContent){if(!this.options.Zero||!this.options.Line)continue;t=0}i.fXmin>o.scale_xmax||i.fXmax<o.scale_xmin||i.fYmin>o.scale_ymax||i.fYmax<o.scale_ymin||(e=this.createPolyBin(o,i,this.options.Text&&i.fContent),void 0===h[t]?h[t]=e:h[t]+=e,this.options.Text&&i.fContent&&c.push(i))}for(t=0;t<h.length;++t)h[t]&&(n=this.draw_g.append("svg:path").style("fill",t?this.fPalette.getColor(t):"none").attr("d",h[t]),this.options.Line&&n.call(this.lineatt.func));let m=Promise.resolve(!0);if(c.length>0){let t=this.getColor(s.fMarkerColor),e=-1*this.options.TextAngle,n=this.draw_g.append("svg:g").attr("class","th2poly_text"),a=12;for(1!==s.fMarkerSize&&e&&(a=Math.round(.02*l*s.fMarkerSize)),this.startTextDrawing(42,a,n,a),r=0;r<c.length;++r){i=c[r];let s="";this.options.TextKind?(i.fPoly&&(s=i.fPoly.fName),"Graph"===s&&(s=""),s||(s=i.fNumber)):s=Math.round(i.fContent)===i.fContent?i.fContent.toString():rl(i.fContent,p.fPaintTextFormat),this.drawText({align:22,x:i._midx,y:i._midy,rotate:e,text:s,color:t,latex:0,draw_g:n})}m=this.finishTextDrawing(n,!0)}return m.then((()=>({poly:!0})))}drawBinsText(t){let e,i,n,r,s=this.getObject(),a=this.getColor(s.fMarkerColor),o=-1*this.options.TextAngle,l=this.draw_g.append("svg:g").attr("class","th2_text"),h=20,c=0,d=this.matchObjectType("TProfile2D")&&"function"==typeof s.getBinEntries,u="E"==this.options.TextKind,f=u&&!this.options.TextLine?1:0;t||(t=this.prepareDraw({rounding:!1})),1!==s.fMarkerSize&&o&&(h=Math.round(.02*s.fMarkerSize*this.getFramePainter().getFrameHeight())),0!==s.fBarOffset&&(c=.001*s.fBarOffset),this.startTextDrawing(42,h,l,h);for(let h=t.i1;h<t.i2;++h){let m=t.grx[h+1]-t.grx[h];for(let g=t.j1;g<t.j2;++g){let _=s.getBinContent(h+1,g+1);if(0===_&&!this._show_empty_bins)continue;let x=t.gry[g]-t.gry[g+1];d&&(_=s.getBinEntries(h+1,g+1));let y=_===Math.round(_)?_.toString():rl(_,p.fPaintTextFormat);if(u){let t=s.getBinError(s.getBin(h+1,g+1)),e=t===Math.round(t)?t.toString():rl(t,p.fPaintTextFormat);this.options.TextLine?y+="±"+e:y=`#splitline{${y}}{#pm${e}}`}o?(e=Math.round(t.grx[h]+.5*m),i=Math.round(t.gry[g+1]+x*(.5+c)),n=r=0):(e=Math.round(t.grx[h]+.1*m),i=Math.round(t.gry[g+1]+x*(.1+c)),n=Math.round(.8*m),r=Math.round(.8*x)),this.drawText({align:22,x:e,y:i,width:n,height:r,rotate:o,text:y,color:a,latex:f,draw_g:l})}}return t.hide_only_zeros=!0,this.finishTextDrawing(l,!0).then((()=>t))}drawBinsArrow(){let t,e,i,n,r,s,a,o,l,h,c,d,u,f,m,p=this.getObject(),g="",_=1e-30,x=this.prepareDraw({rounding:!1}),y=(x.grx[x.i2]-x.grx[x.i1])/(x.i2-x.i1+1)/2,A=(x.gry[x.j2]-x.gry[x.j1])/(x.j2-x.j1+1)/2;const v=(t,e)=>t?e?`l${t},${e}`:`h${t}`:e?`v${e}`:"";for(let b=0;b<2;++b)for(t=x.i1;t<x.i2;++t)for(e=x.j1;e<x.j2;++e)i=t===x.i1?p.getBinContent(t+2,e+1)-p.getBinContent(t+1,e+1):t===x.i2-1?p.getBinContent(t+1,e+1)-p.getBinContent(t,e+1):.5*(p.getBinContent(t+2,e+1)-p.getBinContent(t,e+1)),n=e===x.j1?p.getBinContent(t+1,e+2)-p.getBinContent(t+1,e+1):e===x.j2-1?p.getBinContent(t+1,e+1)-p.getBinContent(t+1,e):.5*(p.getBinContent(t+1,e+2)-p.getBinContent(t+1,e)),0===b?_=Math.max(_,Math.abs(i),Math.abs(n)):(r=(x.grx[t]+x.grx[t+1])/2,s=(x.gry[e]+x.gry[e+1])/2,a=y*i/_,o=A*n/_,l=r-a,h=r+a,c=s-o,d=s+o,i=Math.round(h-l),n=Math.round(d-c),(i||n)&&(g+="M"+Math.round(l)+","+Math.round(c)+v(i,n),(Math.abs(i)>5||Math.abs(n)>5)&&(u=Math.sqrt(2/(i*i+n*n)),f=Math.round(u*(i+n)),m=Math.round(u*(i-n)),(f||m)&&(g+=`m${-f},${m}`+v(f,-m)+v(-m,-f)))));return this.draw_g.append("svg:path").attr("d",g).style("fill","none").call(this.lineatt.func),x}drawBinsBox(){let t=this.getObject(),e=this.prepareDraw({rounding:!1}),i=this.getMainPainter();i===this&&(i.maxbin===i.minbin&&(i.maxbin=i.gmaxbin,i.minbin=i.gminbin,i.minposbin=i.gminposbin),i.maxbin===i.minbin&&(i.minbin=Math.min(0,i.maxbin-1)));let n,r,s,a,o,l,h,c,d,u,f,m,p=Math.max(Math.abs(i.maxbin),Math.abs(i.minbin)),g=Math.max(0,i.minbin),_="",x="",y="",A="",v=!1,b=0,w=this.getPadPainter().getRootPad(!0);if(w&&w.fLogz&&p>0){v=!0;let t=Math.log(p);b=g>0?Math.log(g):i.minposbin>=1&&i.minposbin<100?Math.log(.7):i.minposbin>0?Math.log(.7*i.minposbin):t-10,b>=t&&(b=t-10),m=1/(t-b)}else m=1/(p-g);for(n=e.i1;n<e.i2;++n)for(r=e.j1;r<e.j2;++r)if(s=t.getBinContent(n+1,r+1),a=Math.abs(s),!(0===a||a<g)&&(o=v?a>0?Math.log(a)-b:0:a-g,o=.5*(o<0?1:1-Math.sqrt(o*m)),o<0&&(o=0),u=e.grx[n+1]-e.grx[n],f=e.gry[r]-e.gry[r+1],l=o*u,h=o*f,c=Math.round(e.grx[n]+l),d=Math.round(e.gry[r+1]+h),u=Math.max(Math.round(u-2*l),1),f=Math.max(Math.round(f-2*h),1),_+=`M${c},${d}v${f}h${u}v${-f}z`,s<0&&10===this.options.BoxStyle&&(x+=`M${c},${d}l${u},${f}m0,${-f}l${-u},${f}`),11===this.options.BoxStyle&&u>5&&f>5)){const t=Math.round(.1*u),e=Math.round(.1*f),i=`M${c},${d}h${u}l${-t},${e}h${2*t-u}v${f-2*e}l${-t},${e}z`,n=`M${c+u},${d+f}v${-f}l${-t},${e}v${f-2*e}h${2*t-u}l${-t},${e}z`;s<0?(A+=i,y+=n):(y+=i,A+=n)}if(_.length>0){let t=this.draw_g.append("svg:path").attr("d",_).call(this.fillatt.func);11!==this.options.BoxStyle&&this.fillatt.empty()&&t.call(this.lineatt.func)}if(y.length>0&&this.fillatt.hasColor()&&this.draw_g.append("svg:path").attr("d",y).call(this.fillatt.func).style("fill",ut(this.fillatt.color).brighter(.5).formatHex()),A.length>0&&this.draw_g.append("svg:path").attr("d",A).call(this.fillatt.func).style("fill",this.fillatt.hasColor()?ut(this.fillatt.color).darker(.5).formatHex():"red"),x.length>0){let t=this.draw_g.append("svg:path").attr("d",x).style("fill","none");this.lineatt.empty()?t.style("stroke","black"):t.call(this.lineatt.func)}return e}drawBinsCandle(){const t=10,e=300,i=1e3,n=2e3,r=1e4,s=1e5,a=2e5,o=3e5,h=1e6,c=2e6,d=3e6,u=1e7,f=1e8,m=13001300;let p=0;const g=t=>{let e=1;for(;t>=e;)e*=10;return e/=10,Math.floor(p/e)%10===Math.floor(t/e)},_=(t,e)=>{let i="",n="",r=0,s=t[0],a=t[1];if(s>="A"&&s<="Z"&&(i=s),s>="1"&&s<="9"&&(n=s),a>="A"&&a<="Z"&&n&&(i=a),a>="1"&&a<="9"&&i&&(n=a),e)switch(n){case"1":default:r+=11311;break;case"2":r+=112111;break;case"3":r+=112311;break;case"4":r+=112321;break;case"5":r+=212111;break;case"6":r+=312311}else switch(n){case"1":default:r+=m;break;case"2":r+=13102300}let o=t.indexOf("("),l=t.lastIndexOf(")");o>=0&&l>o+1&&(r=parseInt(t.slice(o+1,l))),p=r,"Y"!=i&&"H"!=i||g(f)||(p+=f)};this.options.Candle?_(this.options.Candle,!0):this.options.Violin&&_(this.options.Violin,!1);let x,y,A=this.getHisto(),v=this.prepareDraw(),b=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),w="",M="",T="",S="",C="",P="",E="",k=null,D=g(f),z=!0,O=!1,R=0,L=0;if(null!==this.options.Scaled?z=O=this.options.Scaled:A.fTitle.indexOf("unscaled")>=0?z=O=!1:A.fTitle.indexOf("scaled")>=0&&(z=O=!0),z&&(g(c)||g(h)||g(d)))for(let t=0;t<this.nbinsx;++t)for(let e=0;e<this.nbinsy;++e)R=Math.max(R,A.getBinContent(t+1,e+1));const B=(...t)=>{let e=t.length,i=2,n=t[0],r=t[1],s=D?`M${r},${n}`:`M${n},${r}`;for(;i<e;){switch(t[i]){case"Z":return s+"z";case"V":r!=t[i+1]&&(s+=(D?"h":"v")+(t[i+1]-r),r=t[i+1]);break;case"H":n!=t[i+1]&&(s+=(D?"v":"h")+(t[i+1]-n),n=t[i+1]);break;default:s+=D?`l${t[i+1]-r},${t[i]-n}`:`l${t[i]-n},${t[i+1]-r}`,n=t[i],r=t[i+1]}i+=2}return s},N=(t,e)=>{P||(this.createAttMarker({attr:A,style:g(o)?0:5}),this.markeratt.resetPos()),P+=D?this.markeratt.create(e,t):this.markeratt.create(t,e)},F=(t,e)=>{k||(k=new ql({attr:A,style:24}),k.resetPos()),E+=D?k.create(e,t):k.create(t,e)};1===A.fMarkerColor&&(A.fMarkerColor=A.fLineColor),v.candle=[];const I=[1e-15,.25,.5,.75,1-1e-15],j=(l,f,m,p,_)=>{let P=((t,e,i)=>{let n=0,r=0,s=0,a={max:0,first:-1,last:-1,entries:0};for(let i=0;i<e.length;++i)e[i]>0&&(a.max=Math.max(a.max,e[i]),a.first<0&&(a.first=i),a.last=i),n+=e[i],s+=e[i]*(t[i]+t[i+1])/2;if(n<=0)return null;a.entries=n,a.mean=s/n,a.quantiles=new Array(i.length),a.indx=new Array(i.length);let o=0,l=0;for(let s=0;s<e.length;++s){let h=l,c=t[s];if(h===i[r]&&0===e[s]&&h<.99){for(;0===e[s]&&s<e.length;)s++;c=(t[s]+c)/2}for(o+=e[s],l=o/n;i[r]>=h&&i[r]<l;){if(a.indx[r]=s,a.quantiles[r]=c+(i[r]-h)/(l-h)*(t[s+1]-c),r++==i.length)return a;c=t[s]}}for(;r<i.length;)a.indx[r]=e.length-1,a.quantiles[r++]=t[t.length-1];return a})(x,y,I);if(!P)return;let E={bin:l,swapXY:D,fBoxDown:P.quantiles[1],fMedian:P.quantiles[2],fBoxUp:P.quantiles[3]},k=P.quantiles[0],j=P.quantiles[4],q=E.fBoxUp-E.fBoxDown;if(g(n)){let t=E.fBoxDown-1.5*q,e=P.indx[1];for(;x[e]>t&&e>0;)e--;for(;!y[e];)e++;for(k=x[e],t=E.fBoxUp+1.5*q,e=P.indx[3];x[e]<t&&e<y.length;)e++;for(;!y[e];)e--;j=x[e+1]}let U=P.mean,G=1.57*q/Math.sqrt(P.entries);if(k<=0&&(D&&b.logx||!D&&b.logy))return;let H,X,V=m-f,Y=(f+m)/2+A.fBarOffset/1e3*V;A.fBarWidth>0&&1e3!==A.fBarWidth?H=X=V*A.fBarWidth/1e3:(H=.66*V,X=.8*V),z&&R>0&&(X*=P.max/R),O&&L>0&&(H*=P.entries/L),E.x1=Math.round(Y-H/2),E.x2=Math.round(Y+H/2),Y=Math.round(Y);let $=Math.round(Y-H/3),W=Math.round(Y+H/3),Z=D?"grx":"gry";E.yy1=Math.round(b[Z](j)),E.y1=Math.round(b[Z](E.fBoxUp)),E.y0=Math.round(b[Z](E.fMedian)),E.y2=Math.round(b[Z](E.fBoxDown)),E.yy2=Math.round(b[Z](k));let Q=Math.round(b[Z](U)),J=Math.round(b[Z](E.fMedian+G)),K=Math.round(b[Z](E.fMedian-G));if(g(u)&&(C+=B(Y,Math.round(b[Z](x[p])),"V",Math.round(b[Z](x[_])))),g(t)?M+=B(E.x1,E.y0,"H",E.x2):g(20)?M+=B($,E.y0,"H",W):g(30)&&F(Y,E.y0),g(e)?F(Y,Q):g(100)&&(T+=B(E.x1,Q,"H",E.x2)),g(1)&&(g(20)?w+=B(E.x1,E.y1,"V",J,$,E.y0,E.x1,K,"V",E.y2,"H",E.x2,"V",K,W,E.y0,E.x2,J,"V",E.y1,"Z"):w+=B(E.x1,E.y1,"V",E.y2,"H",E.x2,"V",E.y1,"Z")),g(r)&&(M+=B(E.x1,E.yy1,"H",E.x2)+B(E.x1,E.yy2,"H",E.x2)),g(i)&&!g(u)?T+=B(Y,E.y1,"V",E.yy1)+B(Y,E.y2,"V",E.yy2):(g(i)&&g(u)||g(n))&&(M+=B(Y,E.y1,"V",E.yy1)+B(Y,E.y2,"V",E.yy2)),g(s)||g(a)||g(o)){let t=new al(7521*l+Math.round(P.integral)),e=!g(s),i=g(o);for(let n=0;n<y.length;++n){let r=y[n],s=(x[n]+x[n+1])/2,a=Y,o=0;if(r&&!(!e&&s>=k&&s<=j))for(let e=0;e<r;e++)i&&(a=Y+Math.round((t.random()-.5)*H)),o=1!=r||i?Math.round(b[Z](x[n]+t.random()*(x[n+1]-x[n]))):Math.round(b[Z](s)),N(a,o)}}if((g(c)||g(h)||g(d))&&P.max>0&&P.first>=0){let t=[],e=(D?-.5:.5)*X/P.max;if(p=Math.max(p,P.first),_=Math.min(_-1,P.last),g(c)||g(d)){let i=Y,n=Math.round(b[Z](x[p]));t.push(i,n);for(let r=p;r<=_;r++){let s=Math.round(Y+e*y[r]),a=Math.round(b[Z](x[r+1]));s!=i&&(r!=p&&t.push("V",n),t.push("H",s)),i=s,n=a}t.push("V",n)}if(g(h)||g(d)){let i=Y,n=Math.round(b[Z](x[_+1]));0==t.length&&t.push(i,n);for(let r=_;r>=p;r--){let s=Math.round(Y-e*y[r]),a=Math.round(b[Z](x[r]));s!=i&&(r!=_&&t.push("V",n),t.push("H",s)),i=s,n=a}t.push("V",n)}t.push("H",Y),S+=B(...t),this.fillatt.empty()||(S+="Z")}v.candle.push(E)};if(D){x=new Array(this.nbinsx+1),y=new Array(this.nbinsx);for(let t=0;t<this.nbinsx+1;++t)x[t]=A.fXaxis.GetBinLowEdge(t+1);if(O)for(let t=0;t<this.nbinsy;++t){let e=0;for(let i=0;i<this.nbinsx;++i)e+=A.getBinContent(i+1,t+1);L=Math.max(L,e)}for(let t=v.j1;t<v.j2;++t){for(let e=0;e<this.nbinsx;++e)y[e]=A.getBinContent(e+1,t+1);j(t,v.gry[t+1],v.gry[t],v.i1,v.i2)}}else{x=new Array(this.nbinsy+1),y=new Array(this.nbinsy);for(let t=0;t<this.nbinsy+1;++t)x[t]=A.fYaxis.GetBinLowEdge(t+1);if(O)for(let t=0;t<this.nbinsx;++t){let e=0;for(let i=0;i<this.nbinsy;++i)e+=A.getBinContent(t+1,i+1);L=Math.max(L,e)}for(let t=v.i1;t<v.i2;++t){for(let e=0;e<this.nbinsy;++e)y[e]=A.getBinContent(t+1,e+1);j(t,v.grx[t],v.grx[t+1],v.j1,v.j2)}}C.length>0&&A.fFillColor>0&&this.draw_g.append("svg:path").attr("d",C).style("stroke",this.getColor(A.fFillColor));let q=g(u)&&0!=A.fFillStyle?this.fillatt.color:this.lineatt.color;if(S.length>0&&(!this.fillatt.empty()||"none"!=q)&&this.draw_g.append("svg:path").attr("d",S).style("stroke","none"!=q?q:null).style("pointer-events",l()?null:"visibleFill").call(this.fillatt.func),w.length>0&&this.draw_g.append("svg:path").attr("d",w).call(this.lineatt.func).call(this.fillatt.func),M.length>0&&this.draw_g.append("svg:path").attr("d",M).call(this.lineatt.func).style("fill","none"),T.length>0){let t=new Hl({attr:A,style:2});this.draw_g.append("svg:path").attr("d",T).call(t.func).style("fill","none")}return E.length>0&&this.draw_g.append("svg:path").attr("d",E).call(k.func),P.length>0&&this.draw_g.append("svg:path").attr("d",P).call(this.markeratt.func),v}drawBinsScatter(){let t,e,i,n,r,a,o,l,h=this.getObject(),c=this.prepareDraw({rounding:!0,pixel_density:!0}),d=[],u=[],f=[],m=[],p=[],g=1,_=this.options.ScatCoef*(this.gmaxbin>2e3?2e3/this.gmaxbin:1),x=new al(c.sumz);if(_*c.sumz<1e5){this.createAttMarker({attr:h}),this.markeratt.resetPos();let t="";for(n=c.i1;n<c.i2;++n)for(o=c.grx[n+1]-c.grx[n],r=c.j1;r<c.j2;++r){l=c.gry[r]-c.gry[r+1],a=h.getBinContent(n+1,r+1);let e=Math.round(_*a);if(!(e<=0))for(let i=0;i<e;++i)t+=this.markeratt.create(Math.round(c.grx[n]+o*x.random()),Math.round(c.gry[r+1]+l*x.random()))}return this.draw_g.append("svg:path").attr("d",t).call(this.markeratt.func),c}this.maxbin>.7&&(g=.7/this.maxbin);let y=Math.round(c.max-c.min),A=this.createContour(y>50?50:y,this.minposbin,this.maxbin,this.minposbin);for(n=c.i1;n<c.i2;++n)for(r=c.j1;r<c.j2;++r)a=h.getBinContent(n+1,r+1),a<=0||a<this.minbin||(o=c.grx[n+1]-c.grx[n],l=c.gry[r]-c.gry[r+1],o*l<=0||(t=A.getContourIndex(a/o/l),t<0||(e=`M${c.grx[n]},${c.gry[r+1]}`,void 0===d[t]?(d[t]=e,m[t]=o,p[t]=l):(i=`m${c.grx[n]-u[t]},${c.gry[r+1]-f[t]}`,d[t]+=i.length<e.length?i:e,m[t]=Math.max(m[t],o),p[t]=Math.max(p[t],l)),u[t]=c.grx[n],f[t]=c.gry[r+1],d[t]+=`v${l}h${o}v${-l}z`)));let v=this.getFrameSvg().select(".main_layer"),b=v.select("defs");for(b.empty()&&d.length>0&&(b=v.insert("svg:defs",":first-child")),this.createAttMarker({attr:h}),t=0;t<d.length;++t)if(void 0!==d[t]&&t<A.arr.length){let e="scatter_"+t,i=b.select("."+e);i.empty()?i=b.append("svg:pattern").attr("class",e).attr("id","jsroot_scatter_pattern_"+s.id_counter++).attr("patternUnits","userSpaceOnUse"):i.selectAll("*").remove();let n=Math.round(g*A.arr[t]*m[t]*p[t]);n<1&&(n=1);let r=new Float32Array(n),a=new Float32Array(n);if(1===n)r[0]=a[0]=.5;else for(let t=0;t<n;++t)r[t]=x.random(),a[t]=x.random();this.markeratt.resetPos();let o="";for(let e=0;e<n;++e)o+=this.markeratt.create(r[e]*m[t],a[e]*p[t]);i.attr("width",m[t]).attr("height",p[t]).append("svg:path").attr("d",o).call(this.markeratt.func),this.draw_g.append("svg:path").attr("scatter-index",t).style("fill","url(#"+i.attr("id")+")").attr("d",d[t])}return c}draw2DBins(){if(this._hide_frame&&this.isMainPainter()&&(this.getFrameSvg().style("display",null),delete this._hide_frame),!this.draw_content)return this.removeG();let t,e;if(this.createHistDrawAttributes(),this.createG(!0),this.isTH2Poly()?e=this.drawPolyBinsColor():(this.options.Scat&&(t=this.drawBinsScatter()),this.options.Color?t=this.drawBinsColor():this.options.Box?t=this.drawBinsBox():this.options.Arrow?t=this.drawBinsArrow():this.options.Contour?t=this.drawBinsContour():(this.options.Candle||this.options.Violin)&&(t=this.drawBinsCandle()),this.options.Text&&(e=this.drawBinsText(t)),t||e||(t=this.drawBinsScatter())),t)this.tt_handle=t;else if(e)return e.then((t=>{this.tt_handle=t}))}drawBinsCircular(){this.getFrameSvg().style("display","none"),this._hide_frame=!0;let t=this.getPadPainter().getFrameRect(),e=this.getHisto(),i=this.options.Circular>10?this.getHistPalette():null,n=e.fXaxis,r=t=>{if(n.fLabels)for(let e=0;e<n.fLabels.arr.length;++e){const i=n.fLabels.arr[e];if(i.fUniqueID===t+1)return i.fString}return t.toString()};this.createG(),this.draw_g.attr("transform",`translate(${Math.round(t.x+t.width/2)},${Math.round(t.y+t.height/2)})`);let s=Math.min(this.nbinsx,this.nbinsy);this.startTextDrawing(42,20,this.draw_g);let a=[];for(let e=0;e<s;e++){let n=(.5-e/s)*Math.PI*2,o=Math.round((.9*t.width/2-32)*Math.cos(n)),l=Math.round((.9*t.height/2-32)*Math.sin(n)),h=Math.round(.9*t.width/2*Math.cos(n)),c=Math.round(.9*t.height/2*Math.sin(n)),d=Math.round(n/Math.PI*180),u=12,f=i?i.calcColor(e,s):"black";a.push({x:o,y:l,a:n,color:f}),(d<-90||d>90)&&(d+=180,u=32);let m=Math.round(10),p=2*m;this.draw_g.append("path").attr("d",`M${o-m},${l} a${m},${m},0,1,0,${p},0a${m},${m},0,1,0,${-p},0z`).style("stroke",f).style("fill","none"),this.drawText({align:u,rotate:d,text:r(e),x:h,y:c})}let o=0,l=0;if(this.options.Circular>11)for(let t=0;t<s-1;++t)for(let i=t+1;i<s;++i){let n=e.getBinContent(t+1,i+1);n>0&&(o=Math.max(o,n),(!l||n<l)&&(l=n))}for(let i=0;i<s-1;++i){let n="",r=a[i];for(let h=i+1;h<s;++h){let s=e.getBinContent(i+1,h+1);if(s<=0)continue;let c=a[h],d=(r.a+c.a)/2,u=.5*(1-Math.abs(r.a-c.a)/Math.PI),f=Math.round(u*t.width/2*Math.cos(d)),m=Math.round(u*t.height/2*Math.sin(d));if(n+=`M${r.x},${r.y}Q${f},${m},${c.x},${c.y}`,this.options.Circular>11&&o>l){let t=Math.round((s-l)/(o-l)*7+1);this.draw_g.append("path").attr("d",n).style("stroke",r.color).style("stroke-width",t).style("fill","none"),n=""}}n&&this.draw_g.append("path").attr("d",n).style("stroke",r.color).style("fill","none")}return this.finishTextDrawing()}drawBinsChord(){this.getFrameSvg().style("display","none"),this._hide_frame=!0;let t=0,e=[],i=!0,n=Math.min(this.nbinsx,this.nbinsy),r=this.getHisto();for(let s=0;s<n;++s){let a=0;for(let t=0;t<n;++t){let e=r.getBinContent(s+1,t+1);e>0&&(a+=e,i&&Math.round(e)!==e&&(i=!1))}a>0&&e.push(s),t+=a}if(e.length<2)return Promise.resolve(!0);let s=this.getPadPainter().getFrameRect(),a=this.getHistPalette(),o=.5*Math.min(s.width,s.height)-60,l=o-10,h=[],c=[],d=t=>a.calcColor(t,e.length),u=0,f=1,m=t=>t.toString(),p=(t,e)=>e<t?-1:e>t?1:e>=t?0:NaN;if(!i&&t<10){let e=Math.round(Math.log10(t)-2.3);u=-e,f=Math.pow(10,e)}else if(t>200){let e=Math.round(Math.log10(t)-2.3);f=Math.pow(10,e)}250*f<t?f*=5:100*f<t&&(f*=2);for(let t=0;t<e.length;++t){h[t]=[];for(let i=0;i<e.length;++i)h[t].push(r.getBinContent(e[t]+1,e[i]+1));let i=r.fXaxis,n="indx_"+e[t].toString();if(i.fLabels)for(let r=0;r<i.fLabels.arr.length;++r){const s=i.fLabels.arr[r];if(s.fUniqueID===e[t]+1){n=s.fString;break}}c.push(n)}this.createG(),this.draw_g.attr("transform",`translate(${Math.round(s.x+s.width/2)},${Math.round(s.y+s.height/2)})`);const g=ne().padAngle(10/l).sortSubgroups(p).sortChords(p)(h),_=this.draw_g.append("g").attr("font-size",10).attr("font-family","sans-serif").selectAll("g").data(g.groups).join("g"),x=function(){var t=Va,e=Ya,i=za(0),n=null,r=$a,s=Wa,a=Za,o=null;function l(){var l,h,c=+t.apply(this,arguments),d=+e.apply(this,arguments),u=r.apply(this,arguments)-Ua,f=s.apply(this,arguments)-Ua,m=Oa(f-u),p=f>u;if(o||(o=l=he()),d<c&&(h=d,d=c,c=h),d>ja)if(m>Ga-ja)o.moveTo(d*La(u),d*Fa(u)),o.arc(0,0,d,u,f,!p),c>ja&&(o.moveTo(c*La(f),c*Fa(f)),o.arc(0,0,c,f,u,p));else{var g,_,x=u,y=f,A=u,v=f,b=m,w=m,M=a.apply(this,arguments)/2,T=M>ja&&(n?+n.apply(this,arguments):Ia(c*c+d*d)),S=Na(Oa(d-c)/2,+i.apply(this,arguments)),C=S,P=S;if(T>ja){var E=Xa(T/c*Fa(M)),k=Xa(T/d*Fa(M));(b-=2*E)>ja?(A+=E*=p?1:-1,v-=E):(b=0,A=v=(u+f)/2),(w-=2*k)>ja?(x+=k*=p?1:-1,y-=k):(w=0,x=y=(u+f)/2)}var D=d*La(x),z=d*Fa(x),O=c*La(v),R=c*Fa(v);if(S>ja){var L,B=d*La(y),N=d*Fa(y),F=c*La(A),I=c*Fa(A);if(m<qa&&(L=Qa(D,z,F,I,B,N,O,R))){var j=D-L[0],q=z-L[1],U=B-L[0],G=N-L[1],H=1/Fa(Ha((j*U+q*G)/(Ia(j*j+q*q)*Ia(U*U+G*G)))/2),X=Ia(L[0]*L[0]+L[1]*L[1]);C=Na(S,(c-X)/(H-1)),P=Na(S,(d-X)/(H+1))}}w>ja?P>ja?(g=Ja(F,I,D,z,d,P,p),_=Ja(B,N,O,R,d,P,p),o.moveTo(g.cx+g.x01,g.cy+g.y01),P<S?o.arc(g.cx,g.cy,P,Ra(g.y01,g.x01),Ra(_.y01,_.x01),!p):(o.arc(g.cx,g.cy,P,Ra(g.y01,g.x01),Ra(g.y11,g.x11),!p),o.arc(0,0,d,Ra(g.cy+g.y11,g.cx+g.x11),Ra(_.cy+_.y11,_.cx+_.x11),!p),o.arc(_.cx,_.cy,P,Ra(_.y11,_.x11),Ra(_.y01,_.x01),!p))):(o.moveTo(D,z),o.arc(0,0,d,x,y,!p)):o.moveTo(D,z),c>ja&&b>ja?C>ja?(g=Ja(O,R,B,N,c,-C,p),_=Ja(D,z,F,I,c,-C,p),o.lineTo(g.cx+g.x01,g.cy+g.y01),C<S?o.arc(g.cx,g.cy,C,Ra(g.y01,g.x01),Ra(_.y01,_.x01),!p):(o.arc(g.cx,g.cy,C,Ra(g.y01,g.x01),Ra(g.y11,g.x11),!p),o.arc(0,0,c,Ra(g.cy+g.y11,g.cx+g.x11),Ra(_.cy+_.y11,_.cx+_.x11),p),o.arc(_.cx,_.cy,C,Ra(_.y11,_.x11),Ra(_.y01,_.x01),!p))):o.arc(0,0,c,v,A,p):o.lineTo(O,R)}else o.moveTo(0,0);if(o.closePath(),l)return o=null,l+""||null}return l.centroid=function(){var i=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,n=(+r.apply(this,arguments)+ +s.apply(this,arguments))/2-qa/2;return[La(n)*i,Fa(n)*i]},l.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:za(+e),l):t},l.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:za(+t),l):e},l.cornerRadius=function(t){return arguments.length?(i="function"==typeof t?t:za(+t),l):i},l.padRadius=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:za(+t),l):n},l.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:za(+t),l):r},l.endAngle=function(t){return arguments.length?(s="function"==typeof t?t:za(+t),l):s},l.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:za(+t),l):a},l.context=function(t){return arguments.length?(o=null==t?null:t,l):o},l}().innerRadius(l).outerRadius(o),y=xe().radius(l-1).padAngle(1/l);_.append("path").attr("fill",(t=>d(t.index))).attr("d",x),_.append("title").text((t=>`${c[t.index]} ${m(t.value)}`));const A=_.append("g").selectAll("g").data((function({startAngle:t,endAngle:e,value:i}){const n=(e-t)/i;let r=[];for(let e=0;e<=i;e+=f)r.push({value:e,angle:e*n+t});return r})).join("g").attr("transform",(t=>`rotate(${180*t.angle/Math.PI-90}) translate(${o},0)`));return A.append("line").attr("stroke","currentColor").attr("x2",6),A.append("text").attr("x",8).attr("dy","0.35em").attr("transform",(t=>t.angle>Math.PI?"rotate(180) translate(-16)":null)).attr("text-anchor",(t=>t.angle>Math.PI?"end":null)).text((t=>{return e=t.value,u>3?e.toExponential(0):e.toFixed(u);var e})),_.select("text").attr("font-weight","bold").text((function(t){return"end"===this.getAttribute("text-anchor")?`↑ ${c[t.index]}`:`${c[t.index]} ↓`})),this.draw_g.append("g").attr("fill-opacity",.8).selectAll("path").data(g).join("path").style("mix-blend-mode","multiply").attr("fill",(t=>d(t.source.index))).attr("d",y).append("title").text((t=>`${m(t.source.value)} ${c[t.target.index]} → ${c[t.source.index]}${t.source.index===t.target.index?"":`\n${m(t.target.value)} ${c[t.source.index]} → ${c[t.target.index]}`}`)),Promise.resolve(!0)}getBinTooltips(t,e){let i=[],n=this.getHisto(),r=n.getBinContent(t+1,e+1);if(i.push(this.getObjectHint()),i.push("x = "+this.getAxisBinTip("x",n.fXaxis,t)),i.push("y = "+this.getAxisBinTip("y",n.fYaxis,e)),i.push(`bin = ${t}, ${e}`),n.$baseh&&(r-=n.$baseh.getBinContent(t+1,e+1)),i.push("entries = "+(r===Math.round(r)?r:rl(r,p.fStatFormat))),"E"==this.options.TextKind||this.matchObjectType("TProfile2D")){let r=n.getBinError(n.getBin(t+1,e+1));i.push("error = "+(r===Math.round(r)?r.toString():rl(r,p.fPaintTextFormat)))}return i}getCandleTooltips(t){let e=[],i=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),n=this.getHisto();return e.push(this.getObjectHint()),t.swapXY?e.push("y = "+i.axisAsText("y",n.fYaxis.GetBinLowEdge(t.bin+1))):e.push("x = "+i.axisAsText("x",n.fXaxis.GetBinLowEdge(t.bin+1))),e.push("m-25%  = "+rl(t.fBoxDown,p.fStatFormat)),e.push("median = "+rl(t.fMedian,p.fStatFormat)),e.push("m+25%  = "+rl(t.fBoxUp,p.fStatFormat)),e}getPolyBinTooltips(t,e,i){let n=this.getHisto().fBins.arr[t],r=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),s=n.fPoly.fName,a=[],o=0;if("Graph"===s&&(s=""),0===s.length&&(s=n.fNumber),void 0===e&&void 0===i){e=i=0;let t=n.fPoly,r=1;"TMultiGraph"===t._typename&&(r=n.fPoly.fGraphs.arr.length,t=null);for(let s=0;s<r;++s){(!t||s>0)&&(t=n.fPoly.fGraphs.arr[s]);for(let n=0;n<t.fNpoints;++n)++o,e+=t.fX[n],i+=t.fY[n]}o>1&&(e/=o,i/=o)}return a.push(this.getObjectHint()),a.push("x = "+r.axisAsText("x",e)),a.push("y = "+r.axisAsText("y",i)),o>0&&a.push("npnts = "+o),a.push("bin = "+s),n.fContent===Math.round(n.fContent)?a.push("content = "+n.fContent):a.push("content = "+rl(n.fContent,p.fStatFormat)),a}processTooltipEvent(t){if(!t||!this.draw_content||!this.draw_g||!this.tt_handle||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let e=this.getHisto(),i=this.tt_handle,n=this.draw_g.select(".tooltip_bin");if(i.poly){let i,r=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),s=-1;const a=r.revertAxis("x",t.x),o=r.revertAxis("y",t.y);if(void 0!==a&&void 0!==o){const t=e.fBins.arr.length;for(let n=0;n<t&&s<0;++n){if(i=e.fBins.arr[n],a<i.fXmin||a>i.fXmax||o<i.fYmin||o>i.fYmax)continue;if(0===i.fContent&&!this.options.Zero)continue;let t=i.fPoly,r=1;"TMultiGraph"===t._typename&&(r=i.fPoly.fGraphs.arr.length,t=null);for(let e=0;e<r;++e)if((!t||e>0)&&(t=i.fPoly.fGraphs.arr[e]),t.IsInside(a,o)){s=n;break}}}if(s<0)return n.remove(),null;let l={name:e.fName,title:e.fTitle,x:t.x,y:t.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",exact:!0,menu:!0,lines:this.getPolyBinTooltips(s,a,o)};return t.disabled?(n.remove(),l.changed=!0):(n.empty()&&(n=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),l.changed=n.property("current_bin")!==s,l.changed&&n.attr("d",this.createPolyBin(r,i)).style("opacity","0.7").property("current_bin",s)),l.changed&&(l.user_info={obj:e,name:e.fName,bin:s,cont:i.fContent,grx:t.x,gry:t.y}),l}if(i.candle){let r,s,a;for(r=0;r<i.candle.length&&(s=i.candle[r],a=s.swapXY?s.x1<=t.y&&t.y<=s.x2&&s.yy1>=t.x&&t.x>=s.yy2:s.x1<=t.x&&t.x<=s.x2&&s.yy1<=t.y&&t.y<=s.yy2,!a);++r);if(!a)return n.remove(),null;let o={name:e.fName,title:e.fTitle,x:t.x,y:t.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getCandleTooltips(s),exact:!0,menu:!0};return t.disabled?(n.remove(),o.changed=!0):(n.empty()&&(n=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none").style("opacity","0.7")),o.changed=n.property("current_bin")!==r,o.changed&&n.attr("d",s.swapXY?`M${s.yy1},${s.x1}H${s.yy2}V${s.x2}H${s.yy1}Z`:`M${s.x1},${s.yy1}H${s.x2}V${s.yy2}H${s.x1}Z`).property("current_bin",r)),o.changed&&(o.user_info={obj:e,name:e.fName,bin:r+1,cont:s.fMedian,binx:r+1,biny:1,grx:t.x,gry:t.y}),o}let r,s,a,o,l,h,c,d,u,f,m=0,p=null,g=this.getFramePainter();if(g.reverse_x)for(r=i.i1;r<i.i2&&!(t.x<=i.grx[r]&&t.x>=i.grx[r+1]);++r);else for(r=i.i1;r<i.i2&&!(t.x>=i.grx[r]&&t.x<=i.grx[r+1]);++r);if(g.reverse_y)for(s=i.j1;s<i.j2&&!(t.y<=i.gry[s+1]&&t.y>=i.gry[s]);++s);else for(s=i.j1;s<i.j2&&!(t.y>=i.gry[s+1]&&t.y<=i.gry[s]);++s);if(r<i.i2&&s<i.j2){a=r,o=r+1,l=s,h=s+1,c=i.grx[a],d=i.grx[o],u=i.gry[h],f=i.gry[l];let n=!0;if(this.options.Color){let e=d-c,r=f-u;d=Math.round(c+e*i.xbar2),c=Math.round(c+e*i.xbar1),f=Math.round(u+r*i.ybar2),u=Math.round(u+r*i.ybar1),g.reverse_x?(t.x>c||t.x<=d)&&(n=!1):(t.x<c||t.x>=d)&&(n=!1),g.reverse_y?(t.y>u||t.y<=f)&&(n=!1):(t.y<u||t.y>=f)&&(n=!1)}m=e.getBinContent(r+1,s+1),this.is_projection?p=0:n?i.hide_only_zeros?p=0!==m||this._show_empty_bins?0:null:(p=this.getContour().getPaletteIndex(this.getHistPalette(),m),null===p&&0===m&&this._show_empty_bins&&(p=0)):p=null}if(null===p)return n.remove(),null;let _={name:e.fName,title:e.fTitle,x:t.x,y:t.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(r,s),exact:!0,menu:!0};if(this.options.Color&&(_.color2=this.getHistPalette().getColor(p)),t.disabled&&!this.is_projection)n.remove(),_.changed=!0;else{n.empty()&&(n=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none"));let t=1e4*r+s;if("X"==this.is_projection){if(c=0,d=this.getFramePainter().getFrameWidth(),this.projection_width>1){let t=(this.projection_width-1)/2;h+t>=i.j2?(h=Math.min(Math.round(h+t),i.j2),l=Math.max(h-this.projection_width,i.j1)):(l=Math.max(Math.round(l-t),i.j1),h=Math.min(l+this.projection_width,i.j2))}u=i.gry[h],f=i.gry[l],t=777*l+333*h}else if("Y"==this.is_projection){if(u=0,f=this.getFramePainter().getFrameHeight(),this.projection_width>1){let t=(this.projection_width-1)/2;o+t>=i.i2?(o=Math.min(Math.round(o+t),i.i2),a=Math.max(o-this.projection_width,i.i1)):(a=Math.max(Math.round(a-t),i.i1),o=Math.min(a+this.projection_width,i.i2))}c=i.grx[a],d=i.grx[o],t=777*a+333*o}_.changed=n.property("current_bin")!==t,_.changed&&n.attr("d","M"+c+","+u+"h"+(d-c)+"v"+(f-u)+"h"+(c-d)+"z").style("opacity","0.7").property("current_bin",t),this.is_projection&&_.changed&&this.redrawProjection(a,o,l,h)}return _.changed&&(_.user_info={obj:e,name:e.fName,bin:e.getBin(r+1,s+1),cont:m,binx:r+1,biny:s+1,grx:t.x,gry:t.y}),_}canZoomInside(t,e,i){if("z"==t)return!0;let n=this.getHisto();return n&&(n="y"==t?n.fYaxis:n.fXaxis),!n||n.FindBin(i,.5)-n.FindBin(e,0)>1}completePalette(t){return!t||(t.$main_painter=this,this.options.Zvert=t._palette_vertical,t.drawPave(this.options.Cjust?"cjust":""))}draw2D(){this.clear3DScene();let t=this.options.Zscale&&(this.options.Color||this.options.Contour);return this.drawColorPalette(t,!0).then((t=>{let e;return e=this.options.Circular&&this.isMainPainter()?this.drawBinsCircular():this.options.Chord&&this.isMainPainter()?this.drawBinsChord():this.drawAxes().then((()=>this.draw2DBins())),e.then((()=>this.completePalette(t)))})).then((()=>this.drawHistTitle())).then((()=>(this.updateStatWebCanvas(),this.addInteractivity())))}draw3D(t){return console.log("3D drawing is disabled, load ./hist/TH2Painter.mjs"),this.draw2D(t)}callDrawFunc(t){let e=this.getMainPainter(),i=this.getFramePainter();return e!==this&&i&&i.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(e),this.options.Mode3D?this.draw3D(t):this.draw2D(t)}redraw(t){return this.callDrawFunc(t)}static draw(t,e,i){return db._drawHist(new db(t,e),i)}}class ub extends db{draw3D(t){this.mode3d=!0;let e=this.getFramePainter(),i=this.isMainPainter(),n=this.getHisto(),r=Promise.resolve(!0);if("resize"==t)i&&e.resize3D()&&e.render3D();else{let t=this.getPadPainter().getRootPad(!0),r=1.1;this.zmin=t&&t.fLogz?.3*this.gminposbin:this.gminbin,this.zmax=this.gmaxbin,-1111!==this.options.minimum&&(this.zmin=this.options.minimum),-1111!==this.options.maximum&&(this.zmax=this.options.maximum,r=1),t&&t.fLogz&&this.zmin<=0&&(this.zmin=1e-5*this.zmax),this.deleteAttr(),i&&(iA(e),e.create3DScene(this.options.Render3D,this.options.x3dscale,this.options.y3dscale),e.setAxesRanges(n.fXaxis,this.xmin,this.xmax,n.fYaxis,this.ymin,this.ymax,n.fZaxis,this.zmin,this.zmax),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,Dy,{zmult:r,zoom:m.Zooming,ndim:2,draw:-1!==this.options.Axis})),e.mode3d&&(this.draw_content&&(this.isTH2Poly()?function(t){let e,i,n,r,s=t.getHisto(),a=t.getFramePainter(),o=a.z_handle.getScaleMin(),l=a.z_handle.getScaleMax(),h=s.fBins.arr.length,c=a.grz(o);t.maxbin=t.gmaxbin,t.minbin=t.gminbin,t.minposbin=t.gminposbin;let d=t.getContour(!0),u=t.getHistPalette();for(n=0;n<h;++n){if(i=s.fBins.arr[n],i.fContent<o)continue;if(e=d.getPaletteIndex(u,i.fContent),null===e)continue;if(i.fXmin>a.scale_xmax||i.fXmax<a.scale_xmin||i.fYmin>a.scale_ymax||i.fYmax<a.scale_ymin)continue;r=a.grz(i.fContent>l?l:i.fContent);let h=[],f=[],m=1,p=i.fPoly,g=0;"TMultiGraph"==p._typename&&(m=i.fPoly.fGraphs.arr.length,p=null);for(let t=0;t<m;++t){(!p||t>0)&&(p=i.fPoly.fGraphs.arr[t]);let e,n,s=p.fNpoints,o=p.fX,l=p.fY;for(;s>2&&o[0]===o[s-1]&&l[0]===l[s-1];)--s;for(let t=0;t<2;++t){let i,r,h,c,d=a.size_x3d*a.size_z3d,u=t>0?0:d/1e6;e=[],n=null;for(let t=0;t<s;++t)h=a.grx(o[t]),c=a.gry(l[t]),t>0&&(d=(h-i)*(h-i)+(c-r)*(c-r)),d>u&&(e.push(new Zh(h,c)),i=h,r=c);try{e.length>2&&(n=kg.triangulateShape(e,[]))}catch(t){n=null}if(n&&n.length>e.length-3)break}n&&n.length&&e&&(h.push(e),f.push(n),g+=2*n.length,r>c&&(g+=2*e.length))}let _=new Float32Array(9*g),x=0;for(let t=0;t<h.length;++t){let e=h[t],i=f[t];for(let t=0;t<2;++t)for(let n=0;n<i.length;++n){let s=i[n],a=e[s[0]],o=e[s[0===t?2:1]],l=e[s[0===t?1:2]];_[x]=a.x,_[x+1]=a.y,_[x+2]=t?r:c,x+=3,_[x]=o.x,_[x+1]=o.y,_[x+2]=t?r:c,x+=3,_[x]=l.x,_[x+1]=l.y,_[x+2]=t?r:c,x+=3}if(r>c)for(let t=0;t<e.length;++t){let i=e[t],n=e[t>0?t-1:e.length-1];_[x]=i.x,_[x+1]=i.y,_[x+2]=c,x+=3,_[x]=n.x,_[x+1]=n.y,_[x+2]=c,x+=3,_[x]=n.x,_[x+1]=n.y,_[x+2]=r,x+=3,_[x]=i.x,_[x+1]=i.y,_[x+2]=c,x+=3,_[x]=n.x,_[x+1]=n.y,_[x+2]=r,x+=3,_[x]=i.x,_[x+1]=i.y,_[x+2]=r,x+=3}}let y=new Od;y.setAttribute("position",new rd(_,3)),y.computeVertexNormals();let A=t.fPalette.getColor(e),v=new ou({color:A,vertexColors:!1}),b=new Tu(y,v);a.toplevel.add(b),b.painter=t,b.bins_index=n,b.draw_z0=c,b.draw_z1=r,b.tip_color=65280,b.tooltip=function(){let t=this.painter,e=t.getFramePainter(),i=t.getObject().fBins.arr[this.bins_index];return{use_itself:!0,x1:e.grx(i.fXmin),x2:e.grx(i.fXmax),y1:e.gry(i.fYmin),y2:e.gry(i.fYmax),z1:this.draw_z0,z2:this.draw_z1,bin:this.bins_index,value:i.fContent,color:this.tip_color,lines:t.getPolyBinTooltips(this.bins_index)}}}}(this):this.options.Contour?sA(this,!0):this.options.Surf?aA(this):this.options.Error?rA(this):nA(this)),e.render3D(),this.updateStatWebCanvas(),e.addKeysHandler())}return i&&(r=this.drawColorPalette(this.options.Zscale&&(12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf)).then((()=>this.drawHistTitle()))),r.then((()=>this))}static draw(t,e,i){return ub._drawHist(new ub(t,e),i)}}var fb=Object.freeze({__proto__:null,TH2Painter:ub});class mb extends ob{scanContent(t){if(t&&this.nbinsx&&this.nbinsy&&this.nbinsz)return;let e=this.getHisto();this.extractAxesProperties(3),this.gminbin=this.gmaxbin=e.getBinContent(1,1,1);for(let t=0;t<this.nbinsx;++t)for(let i=0;i<this.nbinsy;++i)for(let n=0;n<this.nbinsz;++n){let r=e.getBinContent(t+1,i+1,n+1);r<this.gminbin?this.gminbin=r:r>this.gmaxbin&&(this.gmaxbin=r)}this.draw_content=this.gmaxbin>0}countStat(){let t,e,i,n,r,s,a,o,l,h,c=this.getHisto(),d=c.fXaxis,u=c.fYaxis,f=c.fZaxis,m=0,p=0,g=0,_=0,x=0,y=0,A=0,v=this.getSelectIndex("x","left"),b=this.getSelectIndex("x","right"),w=this.getSelectIndex("y","left"),M=this.getSelectIndex("y","right"),T=this.getSelectIndex("z","left"),S=this.getSelectIndex("z","right"),C=this.getFramePainter(),P={name:c.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0};for(t=0;t<this.nbinsx+2;++t)for(n=d.GetBinCoord(t-.5),r=t<v?0:t>b?2:1,e=0;e<this.nbinsy+2;++e)for(s=u.GetBinCoord(e-.5),a=e<w?0:e>M?2:1,i=0;i<this.nbinsz+2;++i)o=f.GetBinCoord(i-.5),l=i<T?0:i>S?2:1,h=c.getBinContent(t,e,i),P.entries+=h,1==r&&1==a&&1==l&&(m+=h,p+=n*h,g+=s*h,_+=o*h,x+=n*n*h,y+=s*s*h,A+=o*o*h);return c.fTsumw>0&&!C.isAxisZoomed("x")&&!C.isAxisZoomed("y")&&!C.isAxisZoomed("z")&&(m=c.fTsumw,p=c.fTsumwx,x=c.fTsumwx2,g=c.fTsumwy,y=c.fTsumwy2,_=c.fTsumwz,A=c.fTsumwz2),m>0&&(P.meanx=p/m,P.meany=g/m,P.meanz=_/m,P.rmsx=Math.sqrt(Math.abs(x/m-P.meanx*P.meanx)),P.rmsy=Math.sqrt(Math.abs(y/m-P.meany*P.meany)),P.rmsz=Math.sqrt(Math.abs(A/m-P.meanz*P.meanz))),P.integral=m,c.fEntries>1&&(P.entries=c.fEntries),P}fillStatistic(t,e,i){if(this.isIgnoreStatsFill())return!1;let n=this.countStat(),r=e%10,s=Math.floor(e/10)%10,a=Math.floor(e/100)%10,o=Math.floor(e/1e3)%10,l=Math.floor(e/1e6)%10;return t.clearPave(),r>0&&t.addText(n.name),s>0&&t.addText("Entries = "+t.format(n.entries,"entries")),a>0&&(t.addText("Mean x = "+t.format(n.meanx)),t.addText("Mean y = "+t.format(n.meany)),t.addText("Mean z = "+t.format(n.meanz))),o>0&&(t.addText("Std Dev x = "+t.format(n.rmsx)),t.addText("Std Dev y = "+t.format(n.rmsy)),t.addText("Std Dev z = "+t.format(n.rmsz))),l>0&&t.addText("Integral = "+t.format(n.integral,"entries")),i&&t.fillFunctionStat(this.findFunction("TF3"),i),!0}getBinTooltips(t,e,i){let n=[],r=this.getHisto();n.push(this.getObjectHint()),n.push("x = "+this.getAxisBinTip("x",r.fXaxis,t)+"  xbin="+(t+1)),n.push("y = "+this.getAxisBinTip("y",r.fYaxis,e)+"  ybin="+(e+1)),n.push("z = "+this.getAxisBinTip("z",r.fZaxis,i)+"  zbin="+(i+1));let s=r.getBinContent(t+1,e+1,i+1);return s===Math.round(s)?n.push("entries = "+s):n.push("entries = "+rl(s,p.fStatFormat)),n}draw3DScatter(){let t,e,i,n,r=this.getObject(),s=this.getFramePainter(),a=this.getSelectIndex("x","left",.5),o=this.getSelectIndex("x","right",0),l=this.getSelectIndex("y","left",.5),h=this.getSelectIndex("y","right",0),c=this.getSelectIndex("z","left",.5),d=this.getSelectIndex("z","right",0);if(o<=a||h<=l||d<=c)return Promise.resolve(!0);let u=this.gmaxbin>1e3?1e3/this.gmaxbin:1,f=0,m=0,p=Math.max(0,this.gminbin);for(t=a;t<o;++t)for(e=l;e<h;++e)for(i=c;i<d;++i)n=r.getBinContent(t+1,e+1,i+1),m+=n,n<=p||(f+=Math.round(n*u));if(f>(s.webgl?1e5:3e4))return!1;let g=new Vy(f,s.webgl,s.size_x3d/200),_=new Int32Array(f),x=0,y=new al(m);for(t=a;t<o;++t)for(e=l;e<h;++e)for(i=c;i<d;++i){if(n=r.getBinContent(t+1,e+1,i+1),n<=p)continue;let a=Math.round(n*u);for(let n=0;n<a;++n){let n=r.fXaxis.GetBinCoord(t+y.random()),a=r.fYaxis.GetBinCoord(e+y.random()),o=r.fZaxis.GetBinCoord(i+y.random());_[x++]=r.getBin(t+1,e+1,i+1),g.addPoint(s.grx(n),s.gry(a),s.grz(o))}}return g.createPoints({color:this.getColor(r.fMarkerColor)}).then((t=>(s.toplevel.add(t),t.bins=_,t.painter=this,t.tip_color=3===r.fMarkerColor?16711680:65280,t.tooltip=function(t){if(!Number.isInteger(t.index))return console.error("intersect.index not provided, three.js version 138"),null;let e=Math.floor(t.index/this.nvertex);if(e<0||e>=this.bins.length)return null;let i=this.painter,n=i.getHisto(),r=i.getFramePainter(),s=i.get3DToolTip(this.bins[e]);return s.x1=r.grx(n.fXaxis.GetBinLowEdge(s.ix)),s.x2=r.grx(n.fXaxis.GetBinLowEdge(s.ix+1)),s.y1=r.gry(n.fYaxis.GetBinLowEdge(s.iy)),s.y2=r.gry(n.fYaxis.GetBinLowEdge(s.iy+1)),s.z1=r.grz(n.fZaxis.GetBinLowEdge(s.iz)),s.z2=r.grz(n.fZaxis.GetBinLowEdge(s.iz+1)),s.color=this.tip_color,s.opacity=.3,s},!0)))}draw3DBins(){if(!this.draw_content)return Promise.resolve(!1);if(!(this.options.Box||this.options.GLBox||this.options.GLColor||this.options.Lego))return this.draw3DScatter();let t,e,i=this.getHisto(),n=this.getColor(i.fFillColor),r=this.getFramePainter(),s=0,a=!1,o=!1,l=!1,h=1,c=!0,d=this.options.Box?this.options.BoxStyle:0,u=.5;if(!d&&this.options.Lego&&(d=1===this.options.Lego?10:this.options.Lego),11===this.options.GLBox||12===this.options.GLBox){u=.4,a=!0,12===this.options.GLBox&&(l=!0);let i=r.webgl?new Bg(.5,16,12):new Bg(.5,8,6);i.applyMatrix4((new Vc).makeRotationX(Math.PI/2)),i.computeVertexNormals();let n=i.getIndex().array,o=i.getAttribute("position").array,h=i.getAttribute("normal").array;s=3*n.length,t=new Float32Array(s),e=new Float32Array(s);for(let i=0;i<n.length;++i){let r=3*n[i];t[3*i]=o[r],t[3*i+1]=o[r+1],t[3*i+2]=o[r+2],e[3*i]=h[r],e[3*i+1]=h[r+1],e[3*i+2]=h[r+2]}}else{let i=Xy.Indexes,n=Xy.Normals,r=Xy.Vertices;s=3*i.length,t=new Float32Array(s),e=new Float32Array(s);for(let s=0,a=-3;s<i.length;++s){let o=r[i[s]];t[3*s]=o.x-.5,t[3*s+1]=o.y-.5,t[3*s+2]=o.z-.5,s%6==0&&(a+=3),e[3*s]=n[a],e[3*s+1]=n[a+1],e[3*s+2]=n[a+2]}o=!0,12===d?l=!0:13===d?(l=!0,o=!1):this.options.GLColor&&(l=!0,h=.5,c=!1,o=!1,a=!0)}c&&(c=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);let f=this.getSelectIndex("x","left",.5),m=this.getSelectIndex("x","right",0),p=this.getSelectIndex("y","left",.5),g=this.getSelectIndex("y","right",0),_=this.getSelectIndex("z","left",.5),x=this.getSelectIndex("z","right",0);if(m<=f||g<=p||x<=_)return Promise.resolve(!1);let y,A,v,b,w,M=(r.grx(i.fXaxis.GetBinLowEdge(m+1))-r.grx(i.fXaxis.GetBinLowEdge(f+1)))/(m-f),T=(r.gry(i.fYaxis.GetBinLowEdge(g+1))-r.gry(i.fYaxis.GetBinLowEdge(p+1)))/(g-p),S=(r.grz(i.fZaxis.GetBinLowEdge(x+1))-r.grz(i.fZaxis.GetBinLowEdge(_+1)))/(x-_),C=0,P=[],E=0,k=[],D=l?this.getContour():null,z=l?this.getHistPalette():null;for(y=f;y<m;++y)for(A=p;A<g;++A)for(v=_;v<x;++v){if(w=i.getBinContent(y+1,A+1,v+1),!this.options.GLColor&&(0===w||w<this.gminbin))continue;if(b=c?Math.pow(Math.abs(w*c),.3333):1,b<.001)continue;if(C++,!l)continue;let t=D.getPaletteIndex(z,w);null!==t?(void 0===P[t]&&(P[t]=0,k[t]=E++),P[t]+=1):console.error("not found color for",w)}l||(P.push(C),E=1,k=[0]);const O=new Array(E),R=new Array(E),L=new Array(E),B=new Array(E),N=new Array(E),F=new Array(E),I=new Array(E);for(let t=0;t<P.length;++t){if(!P[t])continue;C=P[t];let e=k[t];O[e]=N[e]=0,o&&(N[e]=C*s/3>65520?2:1),R[e]=new Float32Array(C*s),L[e]=new Float32Array(C*s),B[e]=new Int32Array(C),1===N[e]&&(F[e]=new Uint16Array(C*Xy.MeshSegments.length)),2===N[e]&&(I[e]=new Float32Array(C*Xy.Segments.length*3))}let j,q,U,G,H,X;for(y=f;y<m;++y)for(j=i.fXaxis.GetBinCenter(y+1),q=r.grx(j),A=p;A<g;++A)for(U=i.fYaxis.GetBinCenter(A+1),G=r.gry(U),v=_;v<x;++v){if(w=i.getBinContent(y+1,A+1,v+1),!this.options.GLColor&&(0===w||w<this.gminbin))continue;if(b=c?Math.pow(Math.abs(w*c),.3333):1,b<.001)continue;let n=0;if(l){let t=D.getPaletteIndex(z,w);if(null===t)continue;n=k[t]}C=O[n],H=i.fZaxis.GetBinCenter(v+1),X=r.grz(H),B[n][C]=i.getBin(y+1,A+1,v+1);let a=C*s,o=R[n],h=L[n];for(let i=0;i<s;i+=3,a+=3)o[a]=q+t[i]*M*b,o[a+1]=G+t[i+1]*T*b,o[a+2]=X+t[i+2]*S*b,h[a]=e[i],h[a+1]=e[i+1],h[a+2]=e[i+2];if(1===N[n]){let t=Xy.MeshSegments;a=C*t.length;let e=Math.round(C*s/3),i=F[n];for(let n=0;n<t.length;++n)i[a+n]=e+t[n]}if(2===N[n]){let t=Xy.Segments,e=I[n];a=C*t.length*3;for(let i=0;i<t.length;++i,a+=3){let n=Xy.Vertices[t[i]];e[a]=q+(n.x-.5)*M*b,e[a+1]=G+(n.y-.5)*T*b,e[a+2]=X+(n.z-.5)*S*b}}O[n]=C+1}for(let t=0;t<P.length;++t){if(!P[t])continue;let e=k[t],o=new Od;o.setAttribute("position",new rd(R[e],3)),o.setAttribute("normal",new rd(L[e],3)),l&&(n=this.fPalette.getColor(t));const d=a?new $g({color:n,opacity:h,transparent:h<1,vertexColors:!1}):new ou({color:n,opacity:h,vertexColors:!1}),f=new Tu(o,d);if(f.bins=B[e],f.bins_faces=s/9,f.painter=this,f.scalex=u*M,f.scaley=u*T,f.scalez=u*S,f.tip_color=3===i.fFillColor?16711680:65280,f.use_scale=c,f.tooltip=function(t){if(!Number.isInteger(t.faceIndex))return console.error("intersect.faceIndex not provided, three.js version 138"),null;let e=Math.floor(t.faceIndex/this.bins_faces);if(e<0||e>=this.bins.length)return null;let i=this.painter,n=i.getHisto(),r=i.getFramePainter(),s=i.get3DToolTip(this.bins[e]),a=r.grx(n.fXaxis.GetBinCoord(s.ix-.5)),o=r.gry(n.fYaxis.GetBinCoord(s.iy-.5)),l=r.grz(n.fZaxis.GetBinCoord(s.iz-.5)),h=this.use_scale?Math.pow(Math.abs(s.value*this.use_scale),.3333):1;return s.x1=a-this.scalex*h,s.x2=a+this.scalex*h,s.y1=o-this.scaley*h,s.y2=o+this.scaley*h,s.z1=l-this.scalez*h,s.z2=l+this.scalez*h,s.color=this.tip_color,s},r.toplevel.add(f),N[e]>0){let t=this.getColor(i.fLineColor),n=new pp({color:t}),s=null;s=1===N[e]?Hy(R[e],n,F[e]):Hy(I[e],n),r.toplevel.add(s)}}return Promise.resolve(!0)}redraw(t){let e=this.getFramePainter(),i=this.getHisto(),n=Promise.resolve(!0);return"resize"==t?e.resize3D()&&e.render3D():(iA(e),e.create3DScene(this.options.Render3D,this.options.x3dscale,this.options.y3dscale),e.setAxesRanges(i.fXaxis,this.xmin,this.xmax,i.fYaxis,this.ymin,this.ymax,i.fZaxis,this.zmin,this.zmax),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,Dy,{zoom:m.Zooming,ndim:3,draw:-1!==this.options.Axis}),n=this.draw3DBins().then((()=>{e.render3D(),this.updateStatWebCanvas(),e.addKeysHandler()}))),n.then((()=>this.drawHistTitle())).then((()=>this))}fillToolbar(){let t=this.getPadPainter();t&&(t.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&t.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t.showPadButtons())}canZoomInside(t,e,i){let n=this.getHisto();return n&&(n=n["f"+t.toUpperCase()+"axis"]),!n||n.FindBin(i,.5)-n.FindBin(e,0)>1}autoZoom(){let t,e,i,n=this.getSelectIndex("x","left"),r=this.getSelectIndex("x","right"),s=this.getSelectIndex("y","left"),a=this.getSelectIndex("y","right"),o=this.getSelectIndex("z","left"),l=this.getSelectIndex("z","right"),h=this.getObject();if(n===r||s===a||o===l)return;let c=h.getBinContent(n+1,s+1,o+1);for(t=n;t<r;++t)for(e=s;e<a;++e)for(i=o;i<l;++i)c=Math.min(c,h.getBinContent(t+1,e+1,i+1));if(c>0)return;let d=r,u=n,f=a,m=s,p=l,g=o;for(t=n;t<r;++t)for(e=s;e<a;++e)for(i=o;i<l;++i)h.getBinContent(t+1,e+1,i+1)>c&&(t<d&&(d=t),t>=u&&(u=t+1),e<f&&(f=e),e>=m&&(m=e+1),i<p&&(p=i),i>=g&&(g=i+1));let _,x,y,A,v,b,w=!1;return d===u-1&&d>n+1&&u<r-1&&(d--,u++),f===m-1&&f>s+1&&m<a-1&&(f--,m++),p===g-1&&p>o+1&&g<l-1&&(p--,g++),(d>n||u<r)&&d<u-1&&(_=h.fXaxis.GetBinLowEdge(d+1),x=h.fXaxis.GetBinLowEdge(u+1),w=!0),(f>s||m<a)&&f<m-1&&(y=h.fYaxis.GetBinLowEdge(f+1),A=h.fYaxis.GetBinLowEdge(m+1),w=!0),(p>o||g<l)&&p<g-1&&(v=h.fZaxis.GetBinLowEdge(p+1),b=h.fZaxis.GetBinLowEdge(g+1),w=!0),w?this.getFramePainter().zoom(_,x,y,A,v,b):void 0}fillHistContextMenu(t){let e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,(t=>{if("inspect"===t)return this.showInspector();this.decodeOptions(t),this.interactiveRedraw(!0,"drawopt")}))}static draw(t,e,i){let n=new mb(t,e);return n.mode3d=!0,Vv(n,"3d").then((()=>(n.setAsMainPainter(),n.decodeOptions(i),n.checkPadRange(),n.scanContent(),n.redraw()))).then((()=>{let e=n.createStat();if(e)return $v.draw(t,e,"")})).then((()=>(n.fillToolbar(),n)))}}var pb=Object.freeze({__proto__:null,TH3Painter:mb});const gb="ROOT::Experimental::";function _b(){return Promise.resolve().then((function(){return Xw}))}const xb={lst:[{name:"TCanvas",icon:"img_canvas",class:()=>Promise.resolve().then((function(){return Yv})).then((t=>t.TCanvasPainter)),opt:";grid;gridx;gridy;tick;tickx;ticky;log;logx;logy;logz",expand_item:"fPrimitives"},{name:"TPad",icon:"img_canvas",class:()=>Promise.resolve().then((function(){return Uv})).then((t=>t.TPadPainter)),opt:";grid;gridx;gridy;tick;tickx;ticky;log;logx;logy;logz",expand_item:"fPrimitives"},{name:"TSlider",icon:"img_canvas",class:()=>Promise.resolve().then((function(){return Uv})).then((t=>t.TPadPainter))},{name:"TFrame",icon:"img_frame",draw:()=>Promise.resolve().then((function(){return Yv})).then((t=>t.drawTFrame))},{name:"TPave",icon:"img_pavetext",class:()=>Promise.resolve().then((function(){return Zv})).then((t=>t.TPavePainter))},{name:"TPaveText",sameas:"TPave"},{name:"TPavesText",sameas:"TPave"},{name:"TPaveStats",sameas:"TPave"},{name:"TPaveLabel",sameas:"TPave"},{name:"TDiamond",sameas:"TPave"},{name:"TLegend",icon:"img_pavelabel",sameas:"TPave"},{name:"TPaletteAxis",icon:"img_colz",sameas:"TPave"},{name:"TLatex",icon:"img_text",draw:()=>_b().then((t=>t.drawText)),direct:!0},{name:"TMathText",sameas:"TLatex"},{name:"TText",sameas:"TLatex"},{name:/^TH1/,icon:"img_histo1d",class:()=>Promise.resolve().then((function(){return cb})).then((t=>t.TH1Painter)),opt:";hist;P;P0;E;E1;E2;E3;E4;E1X0;L;LF2;B;B1;A;TEXT;LEGO;same",ctrl:"l"},{name:"TProfile",icon:"img_profile",class:()=>Promise.resolve().then((function(){return cb})).then((t=>t.TH1Painter)),opt:";E0;E1;E2;p;AH;hist"},{name:"TH2Poly",icon:"img_histo2d",class:()=>Promise.resolve().then((function(){return fb})).then((t=>t.TH2Painter)),opt:";COL;COL0;COLZ;LCOL;LCOL0;LCOLZ;LEGO;TEXT;same",expand_item:"fBins",theonly:!0},{name:"TProfile2Poly",sameas:"TH2Poly"},{name:"TH2PolyBin",icon:"img_histo2d",draw_field:"fPoly",draw_field_opt:"L"},{name:/^TH2/,icon:"img_histo2d",class:()=>Promise.resolve().then((function(){return fb})).then((t=>t.TH2Painter)),dflt:"col",opt:";COL;COLZ;COL0;COL1;COL0Z;COL1Z;COLA;BOX;BOX1;PROJ;PROJX1;PROJX2;PROJX3;PROJY1;PROJY2;PROJY3;SCAT;TEXT;TEXTE;TEXTE0;CANDLE;CANDLE1;CANDLE2;CANDLE3;CANDLE4;CANDLE5;CANDLE6;CANDLEY1;CANDLEY2;CANDLEY3;CANDLEY4;CANDLEY5;CANDLEY6;VIOLIN;VIOLIN1;VIOLIN2;VIOLINY1;VIOLINY2;CONT;CONT1;CONT2;CONT3;CONT4;ARR;SURF;SURF1;SURF2;SURF4;SURF6;E;A;LEGO;LEGO0;LEGO1;LEGO2;LEGO3;LEGO4;same",ctrl:"lego"},{name:"TProfile2D",sameas:"TH2"},{name:/^TH3/,icon:"img_histo3d",class:()=>Promise.resolve().then((function(){return pb})).then((t=>t.TH3Painter)),opt:";SCAT;BOX;BOX2;BOX3;GLBOX1;GLBOX2;GLCOL"},{name:"THStack",icon:"img_histo1d",class:()=>Promise.resolve().then((function(){return Yw})).then((t=>t.THStackPainter)),expand_item:"fHists",opt:"NOSTACK;HIST;E;PFC;PLC"},{name:"TPolyMarker3D",icon:"img_histo3d",draw:()=>Promise.resolve().then((function(){return JM})).then((t=>t.drawPolyMarker3D)),direct:!0,frame:"3d"},{name:"TPolyLine3D",icon:"img_graph",draw:()=>Promise.resolve().then((function(){return JM})).then((t=>t.drawPolyLine3D)),direct:!0,frame:"3d"},{name:"TGraphStruct"},{name:"TGraphNode"},{name:"TGraphEdge"},{name:"TGraphTime",icon:"img_graph",class:()=>Promise.resolve().then((function(){return tT})).then((t=>t.TGraphTimePainter)),opt:"once;repeat;first",theonly:!0},{name:"TGraph2D",icon:"img_graph",class:()=>Promise.resolve().then((function(){return iT})).then((t=>t.TGraph2DPainter)),opt:";P;PCOL",theonly:!0},{name:"TGraph2DErrors",sameas:"TGraph2D",opt:";P;PCOL;ERR",theonly:!0},{name:"TGraph2DAsymmErrors",sameas:"TGraph2D",opt:";P;PCOL;ERR",theonly:!0},{name:"TGraphPolargram",icon:"img_graph",class:()=>Promise.resolve().then((function(){return sT})).then((t=>t.TGraphPolargramPainter)),theonly:!0},{name:"TGraphPolar",icon:"img_graph",class:()=>Promise.resolve().then((function(){return sT})).then((t=>t.TGraphPolarPainter)),opt:";F;L;P;PE",theonly:!0},{name:/^TGraph/,icon:"img_graph",class:()=>Promise.resolve().then((function(){return lT})).then((t=>t.TGraphPainter)),opt:";L;P"},{name:"TEfficiency",icon:"img_graph",class:()=>Promise.resolve().then((function(){return yT})).then((t=>t.TEfficiencyPainter)),opt:";AP"},{name:"TCutG",sameas:"TGraph"},{name:/^RooHist/,sameas:"TGraph"},{name:/^RooCurve/,sameas:"TGraph"},{name:"RooPlot",icon:"img_canvas",func:function(t,e){return wb(t,e._hist,"hist").then((i=>{let n=[];for(let i=0;i<e._items.arr.length;++i)n.push(wb(t,e._items.arr[i],e._items.opt[i]));return Promise.all(n).then((()=>i))}))}},{name:"TRatioPlot",icon:"img_mgraph",class:()=>Promise.resolve().then((function(){return vT})).then((t=>t.TRatioPlotPainter)),opt:""},{name:"TMultiGraph",icon:"img_mgraph",class:()=>Promise.resolve().then((function(){return TT})).then((t=>t.TMultiGraphPainter)),opt:";l;p;3d",expand_item:"fGraphs"},{name:"TStreamerInfoList",icon:"img_question",draw:()=>Promise.resolve().then((function(){return qw})).then((t=>t.drawStreamerInfo))},{name:"TWebPainting",icon:"img_graph",class:()=>Promise.resolve().then((function(){return CT})).then((t=>t.TWebPaintingPainter))},{name:"TCanvasWebSnapshot",icon:"img_canvas",draw:()=>Promise.resolve().then((function(){return Yv})).then((t=>t.drawTPadSnapshot))},{name:"TPadWebSnapshot",sameas:"TCanvasWebSnapshot"},{name:"kind:Text",icon:"img_text",func:Yl},{name:"TObjString",icon:"img_text",func:Yl},{name:"TF1",icon:"img_tf1",class:()=>Promise.resolve().then((function(){return dT})).then((t=>t.TF1Painter))},{name:"TF2",icon:"img_tf2",draw:()=>Promise.resolve().then((function(){return ET})).then((t=>t.drawTF2))},{name:"TSpline3",icon:"img_tf1",class:()=>Promise.resolve().then((function(){return DT})).then((t=>t.TSplinePainter))},{name:"TSpline5",sameas:"TSpline3"},{name:"TEllipse",icon:"img_graph",draw:()=>_b().then((t=>t.drawEllipse)),direct:!0},{name:"TArc",sameas:"TEllipse"},{name:"TCrown",sameas:"TEllipse"},{name:"TPie",icon:"img_graph",draw:()=>_b().then((t=>t.drawPie)),direct:!0},{name:"TPieSlice",icon:"img_graph",dummy:!0},{name:"TExec",icon:"img_graph",dummy:!0},{name:"TLine",icon:"img_graph",draw:()=>_b().then((t=>t.drawTLine))},{name:"TArrow",icon:"img_graph",class:()=>Promise.resolve().then((function(){return OT})).then((t=>t.TArrowPainter))},{name:"TPolyLine",icon:"img_graph",draw:()=>_b().then((t=>t.drawPolyLine)),direct:!0},{name:"TCurlyLine",sameas:"TPolyLine"},{name:"TCurlyArc",sameas:"TPolyLine"},{name:"TParallelCoord",icon:"img_graph",dummy:!0},{name:"TGaxis",icon:"img_graph",draw:()=>Promise.resolve().then((function(){return Yv})).then((t=>t.drawTGaxis))},{name:"TBox",icon:"img_graph",draw:()=>_b().then((t=>t.drawBox)),direct:!0},{name:"TWbox",sameas:"TBox"},{name:"TSliderBox",sameas:"TBox"},{name:"TMarker",icon:"img_graph",draw:()=>_b().then((t=>t.drawMarker)),direct:!0},{name:"TPolyMarker",icon:"img_graph",draw:()=>_b().then((t=>t.drawPolyMarker)),direct:!0},{name:"TASImage",icon:"img_mgraph",class:()=>Promise.resolve().then((function(){return BT})).then((t=>t.TASImagePainter)),opt:";z"},{name:"TJSImage",icon:"img_mgraph",draw:()=>_b().then((t=>t.drawJSImage)),opt:";scale;center"},{name:"TGeoVolume",icon:"img_histo3d",class:()=>Promise.resolve().then((function(){return ZM})).then((t=>t.TGeoPainter)),get_expand:()=>Promise.resolve().then((function(){return ZM})).then((t=>t.expandGeoObject)),opt:";more;all;count;projx;projz;wire;no_screen;dflt",ctrl:"dflt"},{name:"TEveGeoShapeExtract",sameas:"TGeoVolume",opt:";more;all;count;projx;projz;wire;dflt"},{name:gb+"REveGeoShapeExtract",sameas:"TGeoVolume",opt:";more;all;count;projx;projz;wire;dflt"},{name:"TGeoOverlap",sameas:"TGeoVolume",opt:";more;all;count;projx;projz;wire;dflt",dflt:"dflt",ctrl:"expand"},{name:"TGeoManager",sameas:"TGeoVolume",opt:";more;all;count;projx;projz;wire;tracks;no_screen;dflt",dflt:"expand",ctrl:"dflt"},{name:"TGeoVolumeAssembly",sameas:"TGeoVolume",icon:"img_geoassembly",opt:";more;all;count"},{name:/^TGeo/,class:()=>Promise.resolve().then((function(){return ZM})).then((t=>t.TGeoPainter)),get_expand:()=>Promise.resolve().then((function(){return ZM})).then((t=>t.expandGeoObject)),opt:";more;all;axis;compa;count;projx;projz;wire;no_screen;dflt",dflt:"dflt",ctrl:"expand"},{name:"TAxis3D",icon:"img_graph",draw:()=>Promise.resolve().then((function(){return ZM})).then((t=>t.drawAxis3D)),direct:!0},{name:"kind:Command",icon:"img_execute",execute:!0},{name:"TFolder",icon:"img_folder",icon2:"img_folderopen",noinspect:!0,get_expand:()=>Promise.resolve().then((function(){return qw})).then((t=>t.folderHierarchy))},{name:"TTask",icon:"img_task",get_expand:()=>Promise.resolve().then((function(){return qw})).then((t=>t.taskHierarchy)),for_derived:!0},{name:"TTree",icon:"img_tree",get_expand:()=>Promise.resolve().then((function(){return KT})).then((t=>t.treeHierarchy)),draw:()=>Promise.resolve().then((function(){return rS})).then((t=>t.drawTree)),dflt:"expand",opt:"player;testio",shift:"inspect",direct:!0},{name:"TNtuple",sameas:"TTree"},{name:"TNtupleD",sameas:"TTree"},{name:"TBranchFunc",icon:"img_leaf_method",draw:()=>Promise.resolve().then((function(){return rS})).then((t=>t.drawTree)),opt:";dump",noinspect:!0,direct:!0},{name:/^TBranch/,icon:"img_branch",draw:()=>Promise.resolve().then((function(){return rS})).then((t=>t.drawTree)),dflt:"expand",opt:";dump",ctrl:"dump",shift:"inspect",ignore_online:!0,direct:!0},{name:/^TLeaf/,icon:"img_leaf",noexpand:!0,draw:()=>Promise.resolve().then((function(){return rS})).then((t=>t.drawTree)),opt:";dump",ctrl:"dump",ignore_online:!0,direct:!0},{name:"TList",icon:"img_list",draw:()=>Promise.resolve().then((function(){return qw})).then((t=>t.drawList)),get_expand:()=>Promise.resolve().then((function(){return qw})).then((t=>t.listHierarchy)),dflt:"expand"},{name:"THashList",sameas:"TList"},{name:"TObjArray",sameas:"TList"},{name:"TClonesArray",sameas:"TList"},{name:"TMap",sameas:"TList"},{name:"TColor",icon:"img_color"},{name:"TFile",icon:"img_file",noinspect:!0},{name:"TMemFile",icon:"img_file",noinspect:!0},{name:"TStyle",icon:"img_question",noexpand:!0},{name:"Session",icon:"img_globe"},{name:"kind:TopFolder",icon:"img_base"},{name:"kind:Folder",icon:"img_folder",icon2:"img_folderopen",noinspect:!0},{name:gb+"RCanvas",icon:"img_canvas",class:()=>Sb().then((t=>t.RCanvasPainter)),opt:"",expand_item:"fPrimitives"},{name:gb+"RCanvasDisplayItem",icon:"img_canvas",draw:()=>Sb().then((t=>t.drawRPadSnapshot)),opt:"",expand_item:"fPrimitives"},{name:gb+"RHist1Drawable",icon:"img_histo1d",class:()=>Sb("rh1").then((t=>t.RH1Painter)),opt:""},{name:gb+"RHist2Drawable",icon:"img_histo2d",class:()=>Sb("rh2").then((t=>t.RH2Painter)),opt:""},{name:gb+"RHist3Drawable",icon:"img_histo3d",class:()=>Sb("rh3").then((t=>t.RH3Painter)),opt:""},{name:gb+"RHistDisplayItem",icon:"img_histo1d",draw:()=>Sb("rh3").then((t=>t.drawHistDisplayItem)),opt:""},{name:gb+"RText",icon:"img_text",draw:()=>Sb("more").then((t=>t.drawText)),opt:"",direct:"v7",csstype:"text"},{name:gb+"RFrameTitle",icon:"img_text",draw:()=>Sb().then((t=>t.drawRFrameTitle)),opt:"",direct:"v7",csstype:"title"},{name:gb+"RPaletteDrawable",icon:"img_text",class:()=>Sb("more").then((t=>t.RPalettePainter)),opt:""},{name:gb+"RDisplayHistStat",icon:"img_pavetext",class:()=>Sb("pave").then((t=>t.RHistStatsPainter)),opt:""},{name:gb+"RLine",icon:"img_graph",draw:()=>Sb("more").then((t=>t.drawLine)),opt:"",direct:"v7",csstype:"line"},{name:gb+"RBox",icon:"img_graph",draw:()=>Sb("more").then((t=>t.drawBox)),opt:"",direct:"v7",csstype:"box"},{name:gb+"RMarker",icon:"img_graph",draw:()=>Sb("more").then((t=>t.drawMarker)),opt:"",direct:"v7",csstype:"marker"},{name:gb+"RPave",icon:"img_pavetext",class:()=>Sb("pave").then((t=>t.RPavePainter)),opt:""},{name:gb+"RLegend",icon:"img_graph",class:()=>Sb("pave").then((t=>t.RLegendPainter)),opt:""},{name:gb+"RPaveText",icon:"img_pavetext",class:()=>Sb("pave").then((t=>t.RPaveTextPainter)),opt:""},{name:gb+"RFrame",icon:"img_frame",draw:()=>Sb().then((t=>t.drawRFrame)),opt:""},{name:gb+"RFont",icon:"img_text",draw:()=>Sb().then((t=>t.drawRFont)),opt:"",direct:"v7",csstype:"font"},{name:gb+"RAxisDrawable",icon:"img_frame",draw:()=>Sb().then((t=>t.drawRAxis)),opt:""}],cache:{}};function yb(t){return xb.lst.push(t),t}function Ab(t,e){if("string"!=typeof t)return null;""===e&&(e=null);let i=null;if(null===e&&t in xb.cache)return xb.cache[t];let n=0==t.indexOf("ROOT.")?t.slice(5):"kind:"+t,r=0;for(let s=0;s<xb.lst.length;++s){let a=xb.lst[s];if("string"==typeof a.name){if(a.name!=n)continue}else if(!n.match(a.name))continue;if(void 0!==a.sameas){let t=Ab("ROOT."+a.sameas,e);if(t){for(let e in t)void 0===a[e]&&(a[e]=t[e]);delete a.sameas}return a}if(null==e)return t in xb.cache||(xb.cache[t]=a),a;if("string"==typeof e){if(i||(i=a),"::expand"==e){if("expand"in a||"expand_item"in a)return a}else if("opt"in a){let t=a.opt.split(";");for(let e=0;e<t.length;++e)t[e]=t[e].toLowerCase();if(t.indexOf(e.toLowerCase())>=0)return a}}else if(e===r)return a;++r}return i}function vb(t){return"string"==typeof t&&(t=Ab(t)),!(!t||"object"!=typeof t)&&!!(t.func||t.class||t.draw||t.draw_field)}function bb(t,e){let i={opts:null,inspect:!1,expand:!1,draw:!1,handle:null};if("string"!=typeof t)return i;let n=!1,r=!1,s=!1;"string"!=typeof e&&(e="");for(let a=0;a<1e3;++a){let o=Ab(t,a);if(!o)break;if(i.handle||(i.handle=o),o.noinspect&&(r=!0),(o.expand||o.get_expand||o.expand_item||o.can_expand)&&(s=!0),!o.func&&!o.class&&!o.draw)break;if(n=!0,!("opt"in o))continue;let l=o.opt.split(";");for(let t=0;t<l.length;++t)l[t]=l[t].toLowerCase(),e.indexOf("nosame")>=0&&0==l[t].indexOf("same")||(null===i.opts&&(i.opts=[]),i.opts.indexOf(l[t])<0&&i.opts.push(l[t]));if(o.theonly)break}return e.indexOf("noinspect")>=0&&(r=!0),n&&null===i.opts&&(i.opts=[""]),n||0!=t.indexOf("ROOT.")||r||(i.opts=[]),!r&&i.opts&&i.opts.push("inspect"),i.inspect=!r,i.expand=s,i.draw=i.opts&&i.opts.length>0,i}function wb(t,e,i){if(!e||"object"!=typeof e)return Promise.reject(Error("not an object in draw call"));if("inspect"==i)return Promise.resolve().then((function(){return qw})).then((i=>i.drawInspector(t,e)));let n,r,a;if("_typename"in e)r="type "+e._typename,n=Ab("ROOT."+e._typename,i);else{if(!("_kind"in e))return Promise.resolve().then((function(){return qw})).then((i=>i.drawInspector(t,e)));r="kind "+e._kind,n=Ab(e._kind,i)}if(!n)return Promise.reject(Error(`Object of ${r} cannot be shown with draw`));if(n.dummy)return Promise.resolve(null);if(n.draw_field&&e[n.draw_field])return wb(t,e[n.draw_field],i||n.draw_field_opt);if(!vb(n)){if(i&&i.indexOf("same")>=0){let n=Wl(t);if(n&&"function"==typeof n.performDrop)return n.performDrop(e,"",null,i)}return Promise.reject(Error(`Function not specified to draw object ${r}`))}function o(){let s,a;return"v7"==n.direct?s=Promise.resolve().then((function(){return mS})).then((r=>(a=new r.RObjectPainter(t,e,i,n.csstype),a.redraw=n.func,r.ensureRCanvas(a,n.frame||!1)))).then((()=>a.redraw())):n.direct?(a=new Vl(t,e,i),a.redraw=n.func,s=Promise.resolve().then((function(){return Yv})).then((t=>t.ensureTCanvas(a,n.frame||!1))).then((()=>a.redraw()))):(s=n.func(t,e,i),q(s)||(s=Promise.resolve(s))),s.then((t=>{if(a||(a=t),!a)throw Error(`Fail to draw object ${r}`);return"object"!=typeof a||a.options||(a.options={original:i||""}),a}))}if("function"==typeof n.func)return o();if(n.class&&"function"==typeof n.class)a=n.class().then((t=>{n.func=t.draw}));else if(n.draw&&"function"==typeof n.draw)a=n.draw().then((t=>{n.func=t}));else{if(!n.func||"string"!=typeof n.func)return Promise.reject(Error(`Draw function or class not specified to draw ${r}`));if(!n.prereq&&!n.script)return Promise.reject(Error(`Prerequicities to load ${n.func} are not specified`));a=(s.ignore_v6?Promise.resolve(!0):U().then((t=>(n.prereq?t.require(n.prereq):Promise.resolve(!0)).then((()=>{if(n.script)return x(n.script)})).then((()=>t._complete_loading()))))).then((()=>{let t=C(n.func);if(!t||"function"!=typeof t)return Promise.reject(Error(`Fail to find function ${n.func} after loading ${n.prereq||n.script}`));n.func=t}))}return a.then((()=>o()))}function Mb(t,e,i){if(!e||"object"!=typeof e)return Promise.reject(Error("not an object in redraw"));let n,r,s=$l(t),a=null;if(e._typename&&(n=Ab("ROOT."+e._typename)),n&&n.draw_field&&e[n.draw_field]&&(e=e[n.draw_field]),s)if(s.matchObjectType(e._typename))r=s.redrawObject(e,i),r&&(a=s);else for(let t=0;t<s.painters.length;++t){let n=s.painters[t];if(n.matchObjectType(e._typename)&&(r=n.redrawObject(e,i),r)){a=n;break}}else{let n=new hl(t).getTopPainter();n&&"function"==typeof n.redrawObject&&(r=n.redrawObject(e,i),r&&(a=n))}return a?(q(r)||(r=Promise.resolve(!0)),r.then((()=>a))):(th(t),wb(t,e,i))}function Tb(t){t.prototype.drawObject=wb,t.prototype.getObjectDrawSettings=bb}function Sb(t){return Promise.resolve().then((function(){return mS})).then((e=>{switch(Tb(e.RPadPainter),t){case"more":return Promise.resolve().then((function(){return gS}));case"pave":return Promise.resolve().then((function(){return TS}));case"rh1":return Promise.resolve().then((function(){return DS}));case"rh2":return Promise.resolve().then((function(){return RS}));case"rh3":return Promise.resolve().then((function(){return BS}))}return e}))}s.addDrawFunc=yb,Tb(qv),s.addStreamerInfosForPainter=function(t){if(t)for(let i=0;i<t.arr.length;++i){let n=t.arr[i];if(null!==Ab("ROOT."+n.fName))continue;let r=e(n,0);if(!r)continue;let s=Object.assign({},r);s.name=n.fName,yb(s)}function e(i,n){if(!i.fElements)return null;if(n>10)return null;for(let r=0;r<i.fElements.arr.length;++r){let s=i.fElements.arr[r];if("BASE"!==s.fTypeName)continue;let a=Ab("ROOT."+s.fName);if(a&&!a.for_derived&&(a=null),null===a)for(let i=0;i<t.arr.length;++i)if(t.arr[i].fName===s.fName){a=e(t.arr[i],n+1);break}if(a&&a.for_derived)return a}return null}};const Cb="TObject",Pb="TNamed",Eb="TObjString",kb="TString",Db="TList",zb="TStreamerElement",Ob="TStreamerObject",Rb=11,Lb=12,Bb=13,Nb=16,Fb=17,Ib=18,jb=19,qb=20,Ub=40,Gb=62,Hb=65,Xb=500,Vb=501,Yb=1073741824,$b=4294967295,Wb=2147483648,Zb=y(14),Qb=["BASE","char","short","int","long","float","int","const char*","double","Double32_t","char","unsigned  char","unsigned short","unsigned","unsigned long","unsigned","Long64_t","ULong64_t","bool","Float16_t"],Jb=["","vector","list","deque","map","multimap","set","multiset","bitset"],Kb=y(4),tw=y(5),ew={TObject(t,e){e.fUniqueID=t.ntou4(),e.fBits=t.ntou4(),e.fBits&Kb&&t.ntou2()},TNamed:[{basename:Cb,base:1,func:(t,e)=>{e._typename||(e._typename=Pb),t.classStreamer(e,Cb)}},{name:"fName",func:(t,e)=>{e.fName=t.readTString()}},{name:"fTitle",func:(t,e)=>{e.fTitle=t.readTString()}}],TObjString:[{basename:Cb,base:1,func:(t,e)=>{e._typename||(e._typename=Eb),t.classStreamer(e,Cb)}},{name:"fString",func:(t,e)=>{e.fString=t.readTString()}}],TClonesArray(t,e){e._typename||(e._typename="TClonesArray"),e.$kind="TClonesArray",e.name="";const i=t.last_read_version;i>2&&t.classStreamer(e,Cb),i>1&&(e.name=t.readTString());let n=t.readTString(),r=0,s=n.lastIndexOf(";");s>0&&(r=parseInt(n.slice(s+1)),n=n.slice(0,s));let a=t.ntou4();a<0&&(a=-a),e.arr=new Array(a),e.fLast=a-1,e.fLowerBound=t.ntou4();let o=t.fFile.getStreamer(n,{val:r});if(o=t.fFile.getSplittedStreamer(o),o){for(let t=0;t<a;++t)e.arr[t]={_typename:n};for(let i=0;i<o.length;++i)for(let n=0;n<a;++n)o[i].func(t,e.arr[n])}else console.log("Cannot get member-wise streamer for",n,r)},TMap(t,e){e._typename||(e._typename="TMap"),e.name="",e.arr=[];const i=t.last_read_version;i>2&&t.classStreamer(e,Cb),i>1&&(e.name=t.readTString());const n=t.ntou4();for(let i=0;i<n;++i){let i={_typename:"TPair"};i.first=t.readObjectAny(),i.second=t.readObjectAny(),i.first&&e.arr.push(i)}},TTreeIndex(t,e){const i=t.last_read_version;e._typename="TTreeIndex",t.classStreamer(e,"TVirtualIndex"),e.fMajorName=t.readTString(),e.fMinorName=t.readTString(),e.fN=t.ntoi8(),e.fIndexValues=t.readFastArray(e.fN,Nb),i>1&&(e.fIndexValuesMinor=t.readFastArray(e.fN,Nb)),e.fIndex=t.readFastArray(e.fN,Nb)},TRefArray(t,e){e._typename="TRefArray",t.classStreamer(e,Cb),e.name=t.readTString();const i=t.ntoi4();e.fLast=i-1,e.fLowerBound=t.ntoi4(),t.ntou2(),e.fUIDs=t.readFastArray(i,Bb)},TCanvas(t,e){e._typename="TCanvas",t.classStreamer(e,"TPad"),e.fDISPLAY=t.readTString(),e.fDoubleBuffer=t.ntoi4(),e.fRetained=0!==t.ntou1(),e.fXsizeUser=t.ntoi4(),e.fYsizeUser=t.ntoi4(),e.fXsizeReal=t.ntoi4(),e.fYsizeReal=t.ntoi4(),e.fWindowTopX=t.ntoi4(),e.fWindowTopY=t.ntoi4(),e.fWindowWidth=t.ntoi4(),e.fWindowHeight=t.ntoi4(),e.fCw=t.ntou4(),e.fCh=t.ntou4(),e.fCatt=t.classStreamer({},"TAttCanvas"),t.ntou1(),t.ntou1(),e.fHighLightColor=t.ntoi2(),e.fBatch=0!==t.ntou1(),t.ntou1(),t.ntou1(),t.ntou1()},TObjArray(t,e){e._typename||(e._typename="TObjArray"),e.$kind="TObjArray",e.name="";const i=t.last_read_version;i>2&&t.classStreamer(e,Cb),i>1&&(e.name=t.readTString());const n=t.ntou4();let r=0;for(e.arr=new Array(n),e.fLast=n-1,e.fLowerBound=t.ntou4();r<n;)e.arr[r++]=t.readObjectAny()},TPolyMarker3D(t,e){const i=t.last_read_version;t.classStreamer(e,Cb),t.classStreamer(e,"TAttMarker"),e.fN=t.ntoi4(),e.fP=t.readFastArray(3*e.fN,5),e.fOption=t.readTString(),e.fName=i>1?t.readTString():"TPolyMarker3D"},TPolyLine3D(t,e){t.classStreamer(e,Cb),t.classStreamer(e,"TAttLine"),e.fN=t.ntoi4(),e.fP=t.readFastArray(3*e.fN,5),e.fOption=t.readTString()},TStreamerInfo(t,e){t.classStreamer(e,Pb),e.fCheckSum=t.ntou4(),e.fClassVersion=t.ntou4(),e.fElements=t.readObjectAny()},TStreamerElement(t,e){const i=t.last_read_version;if(t.classStreamer(e,Pb),e.fType=t.ntou4(),e.fSize=t.ntou4(),e.fArrayLength=t.ntou4(),e.fArrayDim=t.ntou4(),e.fMaxIndex=t.readFastArray(1==i?t.ntou4():5,Bb),e.fTypeName=t.readTString(),e.fType!==Rb||"Bool_t"!=e.fTypeName&&"bool"!=e.fTypeName||(e.fType=Ib),e.fXmin=e.fXmax=e.fFactor=0,3===i)e.fXmin=t.ntod(),e.fXmax=t.ntod(),e.fFactor=t.ntod();else if(i>3&&e.fBits&y(6)){let t=e.fTitle.indexOf("[");t>=0&&e.fType>Ub&&(t=e.fTitle.indexOf("[",t+1));let i=e.fTitle.indexOf("]",t+1);if(t>=0&&i>=t+2){let n=e.fTitle.slice(t+1,i).split(","),r=32;if(!n||n.length<2)throw new Error(`Problem to decode range setting from streamer element title ${e.fTitle}`);3===n.length&&(r=parseInt(n[2])),(!Number.isInteger(r)||r<2||r>32)&&(r=32);let s=t=>{if(!t)return 0;if(t.indexOf("pi")<0)return parseFloat(t);let e=1;switch("-"==(t=t.trim())[0]&&(e=-1,t=t.slice(1)),t){case"2pi":case"2*pi":case"twopi":return 2*e*Math.PI;case"pi/2":return e*Math.PI/2;case"pi/4":return e*Math.PI/4}return e*Math.PI};e.fXmin=s(n[0]),e.fXmax=s(n[1]);let a=r>=0&&r<32?Math.pow(2,r):4294967295;e.fXmin<e.fXmax?e.fFactor=a/(e.fXmax-e.fXmin):r<15&&(e.fXmin=r)}}},TStreamerBase(t,e){const i=t.last_read_version;t.classStreamer(e,zb),i>2&&(e.fBaseVersion=t.ntou4())},TStreamerSTL(t,e){t.classStreamer(e,zb),e.fSTLtype=t.ntou4(),e.fCtype=t.ntou4(),5!==e.fSTLtype||0!==e.fTypeName.indexOf("std::set")&&0!==e.fTypeName.indexOf("set")||(e.fSTLtype=6),6!==e.fSTLtype||0!==e.fTypeName.indexOf("std::multimap")&&0!==e.fTypeName.indexOf("multimap")||(e.fSTLtype=5)},TStreamerSTLstring(t,e){t.last_read_version>0&&t.classStreamer(e,"TStreamerSTL")},TList:function(t,e){if(e._typename||(e._typename=this.typename),e.$kind=Db,t.last_read_version>3){t.classStreamer(e,Cb),e.name=t.readTString();const i=t.ntou4();e.arr=new Array(i),e.opt=new Array(i);for(let n=0;n<i;++n)e.arr[n]=t.readObjectAny(),e.opt[n]=t.readTString()}else e.name="",e.arr=[],e.opt=[]},THashList:Db,TStreamerLoop(t,e){t.last_read_version>1&&(t.classStreamer(e,zb),e.fCountVersion=t.ntou4(),e.fCountName=t.readTString(),e.fCountClass=t.readTString())},TStreamerBasicPointer:"TStreamerLoop",TStreamerObject(t,e){t.last_read_version>1&&t.classStreamer(e,zb)},TStreamerBasicType:Ob,TStreamerObjectAny:Ob,TStreamerString:Ob,TStreamerObjectPointer:Ob,TStreamerObjectAnyPointer(t,e){t.last_read_version>0&&t.classStreamer(e,zb)},TTree:{name:"$file",func:(t,e)=>{e.$kind="TTree",e.$file=t.fFile}},RooRealVar(t,e){const i=t.last_read_version;t.classStreamer(e,"RooAbsRealLValue"),1==i&&(t.ntod(),t.ntod(),t.ntoi4()),e._error=t.ntod(),e._asymErrLo=t.ntod(),e._asymErrHi=t.ntod(),i>=2&&(e._binning=t.readObjectAny()),3==i&&(e._sharedProp=t.readObjectAny()),i>=4&&(e._sharedProp=t.classStreamer({},"RooRealVarSharedProperties"))},RooAbsBinning(t,e){t.classStreamer(e,1==t.last_read_version?Cb:Pb),t.classStreamer(e,"RooPrintable")},RooCategory(t,e){const i=t.last_read_version;t.classStreamer(e,"RooAbsCategoryLValue"),e._sharedProp=1===i?t.readObjectAny():t.classStreamer({},"RooCategorySharedProperties")},"RooWorkspace::CodeRepo":t=>{const e=2==t.last_read_version?3:2;for(let i=0;i<e;++i){let e=t.ntoi4()*(0==i?4:3);for(;e--;)t.readTString()}},RooLinkedList(t,e){const i=t.last_read_version;t.classStreamer(e,Cb);let n=t.ntoi4();for(e.arr=k(Db);n--;)e.arr.Add(t.readObjectAny());i>1&&(e._name=t.readTString())},TImagePalette:[{basename:Cb,base:1,func:(t,e)=>{e._typename||(e._typename="TImagePalette"),t.classStreamer(e,Cb)}},{name:"fNumPoints",func:(t,e)=>{e.fNumPoints=t.ntou4()}},{name:"fPoints",func:(t,e)=>{e.fPoints=t.readFastArray(e.fNumPoints,8)}},{name:"fColorRed",func:(t,e)=>{e.fColorRed=t.readFastArray(e.fNumPoints,Lb)}},{name:"fColorGreen",func:(t,e)=>{e.fColorGreen=t.readFastArray(e.fNumPoints,Lb)}},{name:"fColorBlue",func:(t,e)=>{e.fColorBlue=t.readFastArray(e.fNumPoints,Lb)}},{name:"fColorAlpha",func:(t,e)=>{e.fColorAlpha=t.readFastArray(e.fNumPoints,Lb)}}],TAttImage:[{name:"fImageQuality",func:(t,e)=>{e.fImageQuality=t.ntoi4()}},{name:"fImageCompression",func:(t,e)=>{e.fImageCompression=t.ntou4()}},{name:"fConstRatio",func:(t,e)=>{e.fConstRatio=0!=t.ntou1()}},{name:"fPalette",func:(t,e)=>{e.fPalette=t.classStreamer({},"TImagePalette")}}],TASImage(t,e){if(1==t.last_read_version&&t.fFile.fVersion>0&&t.fFile.fVersion<5e4)return console.warn("old TASImage version - not yet supported");if(t.classStreamer(e,Pb),0!=t.ntou1()){const i=t.ntoi4();e.fPngBuf=t.readFastArray(i,Rb)}else t.classStreamer(e,"TAttImage"),e.fWidth=t.ntoi4(),e.fHeight=t.ntoi4(),e.fImgBuf=t.readFastArray(e.fWidth*e.fHeight,8)},TMaterial(t,e){const i=t.last_read_version;t.classStreamer(e,Pb),e.fNumber=t.ntoi4(),e.fA=t.ntof(),e.fZ=t.ntof(),e.fDensity=t.ntof(),i>2?(t.classStreamer(e,"TAttFill"),e.fRadLength=t.ntof(),e.fInterLength=t.ntof()):e.fRadLength=e.fInterLength=0},TMixture(t,e){t.classStreamer(e,"TMaterial"),e.fNmixt=t.ntoi4(),e.fAmixt=t.readFastArray(t.ntoi4(),5),e.fZmixt=t.readFastArray(t.ntoi4(),5),e.fWmixt=t.readFastArray(t.ntoi4(),5)},TVirtualPerfStats:Cb,TMethodCall:Cb},iw={TQObject(){},TGraphStruct(){},TGraphNode(){},TGraphEdge(){},TDatime(t,e){e.fDatime=t.ntou4()},TKey(t,e){e.fNbytes=t.ntoi4(),e.fVersion=t.ntoi2(),e.fObjlen=t.ntou4(),e.fDatime=t.classStreamer({},"TDatime"),e.fKeylen=t.ntou2(),e.fCycle=t.ntou2(),e.fVersion>1e3?(e.fSeekKey=t.ntou8(),t.shift(8)):(e.fSeekKey=t.ntou4(),t.shift(4)),e.fClassName=t.readTString(),e.fName=t.readTString(),e.fTitle=t.readTString()},TDirectory(t,e){const i=t.ntou2();e.fDatimeC=t.classStreamer({},"TDatime"),e.fDatimeM=t.classStreamer({},"TDatime"),e.fNbytesKeys=t.ntou4(),e.fNbytesName=t.ntou4(),e.fSeekDir=i>1e3?t.ntou8():t.ntou4(),e.fSeekParent=i>1e3?t.ntou8():t.ntou4(),e.fSeekKeys=i>1e3?t.ntou8():t.ntou4()},TBasket(t,e){t.classStreamer(e,"TKey");const i=t.readVersion();e.fBufferSize=t.ntoi4(),e.fNevBufSize=t.ntoi4(),e.fNevBuf=t.ntoi4(),e.fLast=t.ntoi4(),e.fLast>e.fBufferSize&&(e.fBufferSize=e.fLast);const n=t.ntoi1();if(0!==n){if(n%10!=2){if(e.fNevBuf&&(e.fEntryOffset=t.readFastArray(t.ntoi4(),3),20<n&&n<40))for(let t=0,i=4278190080;t<e.fNevBuf;++t)e.fEntryOffset[t]&=~i;n>40&&(e.fDisplacement=t.readFastArray(t.ntoi4(),3))}if(1===n||n>10){const n=i.val<=1?t.ntoi4():e.fLast;if(n>e.fKeylen){let i=t.extract([t.o+e.fKeylen,n-e.fKeylen]);e.fBufferRef=new xw(i,0,t.fFile,n-e.fKeylen),e.fBufferRef.fTagOffset=e.fKeylen}t.shift(n)}}},TRef(t,e){t.classStreamer(e,Cb),e.fBits&tw?e.fUUID=t.readTString():e.fPID=t.ntou2()},"TMatrixTSym<float>":(t,e)=>{t.classStreamer(e,"TMatrixTBase<float>"),e.fElements=new Float32Array(e.fNelems);let i=t.readFastArray(e.fNrows*(e.fNcols+1)/2,5),n=0;for(let t=0;t<e.fNrows;++t)for(let r=t;r<e.fNcols;++r)e.fElements[r*e.fNcols+t]=e.fElements[t*e.fNcols+r]=i[n++]},"TMatrixTSym<double>":(t,e)=>{t.classStreamer(e,"TMatrixTBase<double>"),e.fElements=new Float64Array(e.fNelems);let i=t.readFastArray(e.fNrows*(e.fNcols+1)/2,8),n=0;for(let t=0;t<e.fNrows;++t)for(let r=t;r<e.fNcols;++r)e.fElements[r*e.fNcols+t]=e.fElements[t*e.fNcols+r]=i[n++]}};function nw(t,e){switch(t){case"bool":case"Bool_t":return Ib;case"char":case"signed char":case"Char_t":return 1;case"Color_t":case"Style_t":case"Width_t":case"short":case"Short_t":return 2;case"int":case"EErrorType":case"Int_t":return 3;case"long":case"Long_t":return 4;case"float":case"Float_t":return 5;case"double":case"Double_t":return 8;case"unsigned char":case"UChar_t":return Rb;case"unsigned short":case"UShort_t":return Lb;case"unsigned":case"unsigned int":case"UInt_t":return Bb;case"unsigned long":case"ULong_t":return 14;case"int64_t":case"long long":case"Long64_t":return Nb;case"uint64_t":case"unsigned long long":case"ULong64_t":return Fb;case"Double32_t":return 9;case"Float16_t":return jb;case"char*":case"const char*":case"const Char_t*":return 7}if(!e){let e=ew[t];if("string"==typeof e)return nw(e,!0)}return-1}function rw(t,e,i){const n={_typename:"TStreamerElement",fName:t,fTypeName:e,fType:0,fSize:0,fArrayLength:0,fArrayDim:0,fMaxIndex:[0,0,0,0,0],fXmin:0,fXmax:0,fFactor:0};if("string"==typeof e?(n.fType=nw(e),n.fType<0&&i&&i.fBasicTypes[e]&&(n.fType=i.fBasicTypes[e])):(n.fType=e,e=n.fTypeName=Qb[n.fType]||"int"),n.fType>0)return n;let r=0,s=e.indexOf("<");if(s>0&&e.indexOf(">")>s+2)for(let t=1;t<Jb.length;++t)if(e.slice(0,s)===Jb[t]){r=t;break}if(0!==r)return n._typename="TStreamerSTL",n.fType=Xb,n.fSTLtype=r,n.fCtype=0,n;const a=e.lastIndexOf("*")===e.length-1;return a&&(n.fTypeName=e=e.slice(0,e.length-1)),0==ow(e)?(n.fType=Hb,n):(n.fType=a?69:Gb,n)}function sw(t,e,i){if(!t){if(0!==e.indexOf("pair"))return null;if(!(t=i.findStreamerInfo(e))){let r=e.indexOf("<"),s=e.lastIndexOf(">");function a(){let t="",i=r+1,n=0;for(;i<s&&n>=0;){switch(e[i]){case"<":n++;break;case",":0===n&&n--;break;case">":n--}n>=0&&(t+=e[i]),i++}return r=i-1,t.trim()}(t={_typename:"TStreamerInfo",fVersion:1,fName:e,fElements:k(Db)}).fElements.Add(rw("first",a(),i)),t.fElements.Add(rw("second",a(),i))}}let n=i.getStreamer(e,null,t);if(!n)return null;if(2!==n.length)return console.error(`Streamer for pair class contains ${n.length} elements`),null;for(let o=0;o<2;++o)n[o].readelem&&!n[o].pair_name&&(n[o].pair_name=0==o?"first":"second",n[o].func=function(t,e){e[this.pair_name]=this.readelem(t)});return n}function aw(t,e){let i={name:t.fName,type:t.fType,fArrayLength:t.fArrayLength,fArrayDim:t.fArrayDim,fMaxIndex:t.fMaxIndex};switch("BASE"===t.fTypeName&&(ow(i.name)>0?(i.name="fArray",i.type=Gb):i.type=0),i.type){case 0:i.base=t.fBaseVersion,i.basename=t.fName,i.func=function(t,e){t.classStreamer(e,this.basename)};break;case 2:i.func=function(t,e){e[this.name]=t.ntoi2()};break;case 3:case 6:i.func=function(t,e){e[this.name]=t.ntoi4()};break;case 4:case Nb:i.func=function(t,e){e[this.name]=t.ntoi8()};break;case 8:i.func=function(t,e){e[this.name]=t.ntod()};break;case 5:i.func=function(t,e){e[this.name]=t.ntof()};break;case 10:case Rb:i.func=function(t,e){e[this.name]=t.ntou1()};break;case Lb:i.func=function(t,e){e[this.name]=t.ntou2()};break;case 15:case Bb:i.func=function(t,e){e[this.name]=t.ntou4()};break;case Fb:case 14:i.func=function(t,e){e[this.name]=t.ntou8()};break;case Ib:i.func=function(t,e){e[this.name]=0!=t.ntou1()};break;case 38:case 23:case 26:case 28:case 31:case 22:case 32:case 35:case 33:case 34:case 37:case 24:case 36:case 25:t.fArrayDim<2?(i.arrlength=t.fArrayLength,i.func=function(t,e){e[this.name]=t.readFastArray(this.arrlength,this.type-qb)}):(i.arrlength=t.fMaxIndex[t.fArrayDim-1],i.minus1=!0,i.func=function(t,e){e[this.name]=t.readNdimArray(this,((t,e)=>t.readFastArray(e.arrlength,e.type-qb)))});break;case 21:t.fArrayDim<2?(i.arrlength=t.fArrayLength,i.func=function(t,e){e[this.name]=t.readFastString(this.arrlength)}):(i.minus1=!0,i.arrlength=t.fMaxIndex[t.fArrayDim-1],i.func=function(t,e){e[this.name]=t.readNdimArray(this,((t,e)=>t.readFastString(e.arrlength)))});break;case 58:case 43:case 48:case 51:case 42:case 52:case 55:case 53:case 54:case 57:case 44:case 56:case 45:i.cntname=t.fCountName,i.func=function(t,e){e[this.name]=1===t.ntou1()?t.readFastArray(e[this.cntname],this.type-Ub):[]};break;case 41:i.cntname=t.fCountName,i.func=function(t,e){e[this.name]=1===t.ntou1()?t.readFastString(e[this.cntname]):null};break;case 9:case 29:case 49:i.double32=!0;case jb:case 39:case 59:0!==t.fFactor?(i.factor=1/t.fFactor,i.min=t.fXmin,i.read=function(t){return t.ntou4()*this.factor+this.min}):0===t.fXmin&&i.double32?i.read=function(t){return t.ntof()}:(i.nbits=Math.round(t.fXmin),0===i.nbits&&(i.nbits=12),i.dv=new DataView(new ArrayBuffer(8),0),i.read=function(t){let e=t.ntou1(),i=t.ntou2();return this.dv.setUint32(0,e<<23|(i&(1<<this.nbits+1)-1)<<23-this.nbits),(1<<this.nbits+1&i?-1:1)*this.dv.getFloat32(0)}),i.readarr=function(t,e){let i=this.double32?new Float64Array(e):new Float32Array(e);for(let n=0;n<e;++n)i[n]=this.read(t);return i},i.type<qb?i.func=function(t,e){e[this.name]=this.read(t)}:i.type>Ub?(i.cntname=t.fCountName,i.func=function(t,e){e[this.name]=1===t.ntou1()?this.readarr(t,e[this.cntname]):null}):t.fArrayDim<2?(i.arrlength=t.fArrayLength,i.func=function(t,e){e[this.name]=this.readarr(t,this.arrlength)}):(i.arrlength=t.fMaxIndex[t.fArrayDim-1],i.minus1=!0,i.func=function(t,e){e[this.name]=t.readNdimArray(this,((t,e)=>e.readarr(t,e.arrlength)))});break;case 69:case 64:i.func=function(t,e){e[this.name]=t.readNdimArray(this,(t=>t.readObjectAny()))};break;case Gb:case 68:case 63:case 61:{let e="BASE"===t.fTypeName?t.fName:t.fTypeName;"*"==e[e.length-1]&&(e=e.slice(0,e.length-1));const n=ow(e);n>0?(i.arrkind=n,i.func=function(t,e){e[this.name]=t.readFastArray(t.ntou4(),this.arrkind)}):0===n?i.func=function(t,e){e[this.name]=t.readTString()}:(i.classname=e,t.fArrayLength>1?i.func=function(t,e){e[this.name]=t.readNdimArray(this,((t,e)=>t.classStreamer({},e.classname)))}:i.func=function(t,e){e[this.name]=t.classStreamer({},this.classname)});break}case 81:case 82:case 88:case 83:{let e=t.fTypeName;"*"==e[e.length-1]&&(e=e.slice(0,e.length-1)),i.arrkind=ow(e),i.arrkind<0&&(i.classname=e),i.func=function(t,e){e[this.name]=t.readNdimArray(this,((t,e)=>e.arrkind>0?t.readFastArray(t.ntou4(),e.arrkind):0===e.arrkind?t.readTString():t.classStreamer({},e.classname)))};break}case 1:i.func=function(t,e){e[this.name]=t.ntoi1()};break;case 7:i.func=function(t,e){const i=t.ntoi4();e[this.name]=t.substring(t.o,t.o+i),t.o+=i};break;case Hb:i.func=function(t,e){e[this.name]=t.readTString()};break;case 66:case 67:i.typename=t.fTypeName,i.func=function(t,e){e[this.name]=t.classStreamer({},this.typename)};break;case 85:case 86:case 87:i.typename=t.fTypeName,i.func=function(t,e){const i=t.readVersion();e[this.name]=t.readNdimArray(this,((t,e)=>e.typename===kb?t.readTString():t.classStreamer({},e.typename))),t.checkByteCount(i,this.typename+"[]")};break;case Vb:case 521:i.typename=t.fTypeName,i.cntname=t.fCountName,i.typename.lastIndexOf("**")>0?(i.typename=i.typename.slice(0,i.typename.lastIndexOf("**")),i.isptrptr=!0):(i.typename=i.typename.slice(0,i.typename.lastIndexOf("*")),i.isptrptr=!1),i.isptrptr?i.readitem=function(t){return t.readObjectAny()}:(i.arrkind=ow(i.typename),i.arrkind>0?i.readitem=function(t){return t.readFastArray(t.ntou4(),this.arrkind)}:0===i.arrkind?i.readitem=function(t){return t.readTString()}:i.readitem=function(t){return t.classStreamer({},this.typename)}),void 0!==i.readitem?(i.read_loop=function(t,e){return t.readNdimArray(this,((t,i)=>{let n=new Array(e);for(let r=0;r<e;++r)n[r]=i.readitem(t);return n}))},i.func=function(t,e){const i=t.readVersion();let n=this.read_loop(t,e[this.cntname]);t.checkByteCount(i,this.typename)||(n=null),e[this.name]=n},i.branch_func=function(t,e){const i=t.readVersion(),n=e[this.stl_size];let r=new Array(n);for(let i=0;i<n;++i){let n=e[this.cntname][i];r[i]=this.read_loop(t,n)}t.checkByteCount(i,this.typename)||(r=null),e[this.name]=r},i.objs_branch_func=function(t,e){const i=t.readVersion();let n=e[this.name0];for(let e=0;e<n.length;++e){let i=this.get(n,e),r=i[this.cntname];i[this.name]=this.read_loop(t,r)}t.checkByteCount(i,this.typename)}):(console.error(`fail to provide function for ${t.fName} (${t.fTypeName})  typ = ${t.fType}`),i.func=function(t,e){const i=t.readVersion();t.checkByteCount(i),e[this.name]=null});break;case Xb:{i.typename=t.fTypeName;let n=(t.fSTLtype||0)%40;if("TStreamerSTLstring"===t._typename||"string"==i.typename||"string*"==i.typename)i.readelem=t=>t.readTString();else if(1===n||2===n||3===n||6===n||7===n){let n=i.typename.indexOf("<"),r=i.typename.lastIndexOf(">");if(i.conttype=i.typename.slice(n+1,r).trim(),i.typeid=nw(i.conttype),i.typeid<0&&e.fBasicTypes[i.conttype]&&(i.typeid=e.fBasicTypes[i.conttype],console.log("!!! Reuse basic type",i.conttype,"from file streamer infos")),t.fCtype&&t.fCtype<20&&t.fCtype!==i.typeid&&(console.warn("Contained type",i.conttype,"not recognized as basic type",t.fCtype,"FORCE"),i.typeid=t.fCtype),i.typeid>0)i.readelem=function(t){return t.readFastArray(t.ntoi4(),this.typeid)};else if(i.isptr=!1,i.conttype.lastIndexOf("*")===i.conttype.length-1&&(i.isptr=!0,i.conttype=i.conttype.slice(0,i.conttype.length-1)),63===t.fCtype&&(i.isptr=!0),i.arrkind=ow(i.conttype),i.readelem=vw,!i.isptr&&i.arrkind<0){let t=rw("temp",i.conttype);t.fType===Xb&&(t.$fictional=!0,i.submember=aw(t,e))}}else if(4===n||5===n){const t=i.typename.indexOf("<"),n=i.typename.lastIndexOf(">");i.pairtype="pair<"+i.typename.slice(t+1,n)+">",i.si=e.findStreamerInfo(i.pairtype),i.streamer=sw(i.si,i.pairtype,e),i.streamer&&2===i.streamer.length||(console.error(`Fail to build streamer for pair ${i.pairtype}`),delete i.streamer),i.streamer&&(i.readelem=bw)}else 8===n&&(i.readelem=t=>t.readFastArray(t.ntou4(),Ib));i.readelem?t.$fictional||(i.read_version=function(t,e){if(0===e)return null;const i=t.readVersion();return this.member_wise=0!=(i.val&Zb),this.stl_version=void 0,this.member_wise&&(i.val=i.val&~Zb,this.stl_version={val:t.ntoi2()},this.stl_version.val<=0&&(this.stl_version.checksum=t.ntou4())),i},i.func=function(t,e){const i=this.read_version(t);let n=t.readNdimArray(this,((t,e)=>e.readelem(t)));t.checkByteCount(i,this.typename)||(n=null),e[this.name]=n},i.branch_func=function(t,e){const i=e[this.stl_size],n=this.read_version(t,i);let r=new Array(i);for(let e=0;e<i;++e)r[e]=t.readNdimArray(this,((t,e)=>e.readelem(t)));n&&t.checkByteCount(n,"branch "+this.typename),e[this.name]=r},i.split_func=function(t,e,i){const n=this.read_version(t);for(let n=0;n<i;++n)e[n][this.name]=t.readNdimArray(this,((t,e)=>e.readelem(t)));t.checkByteCount(n,this.typename)},i.objs_branch_func=function(t,e){let i=e[this.name0];const n=this.read_version(t,i.length);for(let e=0;e<i.length;++e){this.get(i,e)[this.name]=t.readNdimArray(this,((t,e)=>e.readelem(t)))}n&&t.checkByteCount(n,"branch "+this.typename)}):(console.error(`'failed to create streamer for element ${i.typename} ${i.name} element ${t._typename} STL type ${t.fSTLtype}`),i.func=function(t,e){const i=t.readVersion();t.checkByteCount(i),e[this.name]=null});break}default:console.error(`fail to provide function for ${t.fName} (${t.fTypeName})  typ = ${t.fType}`),i.func=function(){}}return i}function ow(t){if(t===kb||"string"===t||ew[t]===kb)return 0;if(t.length<7||0!==t.indexOf("TArray"))return-1;if(7==t.length)switch(t[6]){case"I":return 3;case"D":return 8;case"F":return 5;case"S":return 2;case"C":return 1;case"L":return 4;default:return-1}return"TArrayL64"==t?Nb:-1}function lw(t,e){if(null===e)return e;let i=N(t);if(i)for(let t in i)"function"!=typeof i[t]&&0!=t.indexOf("_")||e.push({name:t,method:i[t],func:function(t,e){e[this.name]=this.method}});return e}const hw=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],cw=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],dw=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],uw=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],fw=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],mw=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function pw(t,e){let i,n,r,s,a,o,l=new Array(65536),h=0,c=null,d=0,u=0,f=-1,m=!1,p=0,g=0,_=null,x=t,y=t.byteLength,A=0;function v(t){for(;u<t;)A<y&&(d|=x[A++]<<u),u+=8}function b(t){return d&hw[t]}function w(t){d>>=t,u-=t}function M(t,e,i,n,r,s){this.status=0,this.root=null,this.m=0;const a=16;let o,l,h,c,d,u,f,m,p,g,_,x,y=Array(17).fill(0),A=Array(17).fill(0),v=Array(a).fill(null),b=Array(288).fill(0),w=Array(17).fill(0),M={e:0,b:0,n:0,t:null},T=null,S=e>256?t[256]:a,C=t,P=0,E=this.root=null,k=e;do{y[C[P++]]++}while(--k>0);if(y[0]==e)return this.root=null,this.m=0,this.status=0,this;for(d=1;d<=a&&0==y[d];++d);for(u=d,s<d&&(s=d),k=a;0!=k&&0==y[k];--k);for(h=k,s>k&&(s=k),g=1<<d;d<k;++d,g<<=1)if((g-=y[d])<0)return this.status=2,this.m=s,this;if((g-=y[k])<0)return this.status=2,this.m=s,this;for(y[k]+=g,w[1]=d=0,C=y,P=1,p=2;--k>0;)w[p++]=d+=C[P++];C=t,P=0,k=0;do{0!=(d=C[P++])&&(b[w[d]++]=k)}while(++k<e);for(e=w[h],w[0]=k=0,C=b,P=0,c=-1,m=A[0]=0,f=null,_=0;u<=h;++u)for(o=y[u];o-- >0;){for(;u>m+A[1+c];){if(m+=A[1+c++],_=(_=h-m)>s?s:_,(l=1<<(d=u-m))>o+1)for(l-=o+1,p=u;++d<_&&!((l<<=1)<=y[++p]);)l-=y[p];for(m+d>S&&m<S&&(d=S-m),_=1<<d,A[1+c]=d,f=new Array(_),x=0;x<_;++x)f[x]={e:0,b:0,n:0,t:null};E=null==E?this.root={next:null,list:null}:E.next={next:null,list:null},E.next=null,E.list=f,v[c]=f,c>0&&(w[c]=k,M.b=A[c],M.e=16+d,M.t=f,d=(k&(1<<m)-1)>>m-A[c],T=v[c-1][d],T.e=M.e,T.b=M.b,T.n=M.n,T.t=M.t)}for(M.b=u-m,P>=e?M.e=99:C[P]<i?(M.e=C[P]<256?16:15,M.n=C[P++]):(M.e=r[C[P]-i],M.n=n[C[P++]-i]),l=1<<u-m,d=k>>m;d<_;d+=l)T=f[d],T.e=M.e,T.b=M.b,T.n=M.n,T.t=M.t;for(d=1<<u-1;0!=(k&d);d>>=1)k^=d;for(k^=d;(k&(1<<m)-1)!=w[c];)m-=A[c--]}return this.m=A[1],this.status=0!=g&&1!=h?1:0,this}function T(t,e,i){if(0==i)return 0;let n,r,c=0;for(;;){for(v(a),r=_.list[b(a)],n=r.e;n>16;){if(99==n)return-1;w(r.b),n-=16,v(n),r=r.t[b(n)],n=r.e}if(w(r.b),16!=n){if(15==n)break;for(v(n),p=r.n+b(n),w(n),v(o),r=s.list[b(o)],n=r.e;n>16;){if(99==n)return-1;w(r.b),n-=16,v(n),r=r.t[b(n)],n=r.e}for(w(r.b),v(n),g=h-r.n-b(n),w(n);p>0&&c<i;)--p,g&=32767,h&=32767,t[e+c++]=l[h++]=l[g++];if(c==i)return i}else if(h&=32767,t[e+c++]=l[h++]=r.n,c==i)return i}return f=-1,c}function S(t,e,i){let n=7&u;if(w(n),v(16),n=b(16),w(16),v(16),n!=(65535&~d))return-1;for(w(16),p=n,n=0;p>0&&n<i;)--p,h&=32767,v(8),t[e+n++]=l[h++]=b(8),w(8);return 0==p&&(f=-1),n}function C(t,e,l){if(null==c){let t=Array(288).fill(8,0,144).fill(9,144,256).fill(7,256,280).fill(8,280,288);n=7;let e=new M(t,288,257,cw,dw,n);if(0!=e.status)throw new Error("HufBuild error: "+e.status);if(c=e.root,n=e.m,t.fill(5,0,30),r=5,e=new M(t,30,0,uw,fw,r),e.status>1)throw c=null,new Error("HufBuild error: "+e.status);i=e.root,r=e.m}return _=c,s=i,a=n,o=r,T(t,e,l)}function P(t,e,i){let n,r,l,h,c,d,u=new Array(316).fill(0);v(5);const f=257+b(5);w(5),v(5);const m=1+b(5);w(5),v(4);const p=4+b(4);if(w(4),f>286||m>30)return-1;for(r=0;r<p;++r)v(3),u[mw[r]]=b(3),w(3);for(;r<19;++r)u[mw[r]]=0;if(a=7,d=new M(u,19,19,null,null,a),0!=d.status)return-1;for(_=d.root,a=d.m,h=f+m,n=l=0;n<h;)if(v(a),c=_.list[b(a)],r=c.b,w(r),r=c.n,r<16)u[n++]=l=r;else if(16==r){if(v(2),r=3+b(2),w(2),n+r>h)return-1;for(;r-- >0;)u[n++]=l}else if(17==r){if(v(3),r=3+b(3),w(3),n+r>h)return-1;for(;r-- >0;)u[n++]=0;l=0}else{if(v(7),r=11+b(7),w(7),n+r>h)return-1;for(;r-- >0;)u[n++]=0;l=0}if(a=9,d=new M(u,f,257,cw,dw,a),0==a&&(d.status=1),0!=d.status)return-1;for(_=d.root,a=d.m,n=0;n<m;++n)u[n]=u[n+f];return o=6,d=new M(u,m,0,uw,fw,o),s=d.root,o=d.m,0==o&&f>257||0!=d.status?-1:T(t,e,i)}function E(t,e,i){let n,r=0;for(;r<i;){if(m&&-1==f)return r;if(p>0){if(0!=f)for(;p>0&&r<i;)--p,g&=32767,h&=32767,t[e+r++]=l[h++]=l[g++];else{for(;p>0&&r<i;)--p,h&=32767,v(8),t[e+r++]=l[h++]=b(8),w(8);0==p&&(f=-1)}if(r==i)return r}if(-1==f){if(m)break;v(1),0!=b(1)&&(m=!0),w(1),v(2),f=b(2),w(2),_=null,p=0}switch(f){case 0:n=S(t,e+r,i-r);break;case 1:n=null!=_?T(t,e+r,i-r):C(t,e+r,i-r);break;case 2:n=null!=_?T(t,e+r,i-r):P(t,e+r,i-r);break;default:n=-1}if(-1==n)return m?0:-1;r+=n}return r}let k,D=0;for(;(k=E(e,D,Math.min(1024,e.byteLength-D)))>0;)D+=k;return D}function gw(t,e,i,n){for(let r=i=i||0,s=n=n||t.length-i,a=0;r<s;){let i=t[r++],n=i>>4;if(n>0){let i=n+240;for(;255===i;)i=t[r++],n+=i;let o=r+n;for(;r<o;)e[a++]=t[r++];if(r===s)return a}const o=t[r++]|t[r++]<<8;if(0===o||o>a)return-(r-2);let l=15&i,h=l+240;for(;255===h;)h=t[r++],l+=h;let c=a-o;const d=a+l+4;for(;a<d;)e[a++]=e[c++]}return j}function _w(t,e,i,n){const r=t.byteLength,s=e=>String.fromCharCode(t.getUint8(e)),a=e=>t.getUint8(e);let o=n||0,l=0,h=null;const d=()=>{for(;l<e;){let n="unknown",u=0,f=0;if(o+9>=r)return i||console.error("Error R__unzip: header size exceeds buffer size"),Promise.resolve(null);if("Z"==s(o)&&"L"==s(o+1)&&8==a(o+2)?(n="new",u=2):"C"==s(o)&&"S"==s(o+1)&&8==a(o+2)?(n="old",u=0):"X"==s(o)&&"Z"==s(o+1)&&0==a(o+2)?n="LZMA":"Z"==s(o)&&"S"==s(o+1)&&1==a(o+2)?n="ZSTD":"L"==s(o)&&"4"==s(o+1)&&(n="LZ4",u=0,f=8),"new"!==n&&"old"!==n&&"LZ4"!==n&&"ZSTD"!==n)return i||console.error(`R__unzip: ${n} format is not supported!`),Promise.resolve(null);const m=9+(255&a(o+3)|(255&a(o+4))<<8|(255&a(o+5))<<16),p=new Uint8Array(t.buffer,t.byteOffset+o+9+u+f,Math.min(t.byteLength-o-9-u-f,m-9-f));if("ZSTD"===n){const t=t=>new Promise(((i,n)=>{t.run((t=>{const r=(new t.Streaming).decompress(p),s=r.length;if(0!==r.byteOffset)return n(Error("ZSTD result with byteOffset != 0"));h||(h=new ArrayBuffer(e));let a=new Uint8Array(h,l);for(let t=0;t<s;++t)a[t]=r[t];l+=s,o+=m,i(!0)}))}));return(c()?Promise.resolve().then((function(){return Gw})).then((e=>t(e.ZstdCodec))):x("../../zstd/zstd-codec.min.js").catch((()=>x("https://root.cern/js/zstd/zstd-codec.min.js"))).then((()=>t(ZstdCodec)))).then((()=>d()))}h||(h=new ArrayBuffer(e));let g=new Uint8Array(h,l);const _="LZ4"===n?gw(p,g):pw(p,g);if(_<=0)break;l+=_,o+=m}return l!==e?(i||console.error(`R__unzip: fail to unzip data expects ${e}, got ${l}`),Promise.resolve(null)):Promise.resolve(new DataView(h))};return d()}class xw{constructor(t,e,i,n){this._typename="TBuffer",this.arr=t,this.o=e||0,this.fFile=i,this.length=n||(t?t.byteLength:0),this.clearObjectMap(),this.fTagOffset=0,this.last_read_version=0}locate(t){this.o=t}shift(t){this.o+=t}remain(){return this.length-this.o}getMappedObject(t){return this.fObjectMap[t]}mapObject(t,e){null!==e&&(this.fObjectMap[t]=e)}mapClass(t,e){this.fClassMap[t]=e}getMappedClass(t){return t in this.fClassMap?this.fClassMap[t]:-1}clearObjectMap(){this.fObjectMap={},this.fClassMap={},this.fObjectMap[0]=null,this.fDisplacement=0}readVersion(){let t={},e=this.ntou4();return e&Yb?t.bytecnt=e-Yb-2:this.o-=4,this.last_read_version=t.val=this.ntoi2(),this.last_read_checksum=0,t.off=this.o,t.val<=0&&t.bytecnt&&t.bytecnt>=4&&(t.checksum=this.ntou4(),this.fFile.findStreamerInfo(void 0,void 0,t.checksum)?this.last_read_checksum=t.checksum:(this.o-=4,delete t.checksum)),t}checkByteCount(t,e){return void 0===t.bytecnt||t.off+t.bytecnt===this.o||(e&&console.log(`Missmatch in ${e} bytecount expected = ${t.bytecnt}  got = ${this.o-t.off}`),this.o=t.off+t.bytecnt,!1)}readTString(){let t=this.ntou1();if(255==t&&(t=this.ntou4()),0==t)return"";const e=this.o;return this.o+=t,0==this.codeAt(e)?"":this.substring(e,e+t)}readFastString(t){let e,i="",n=!1;for(let r=0;(t<0||r<t)&&(e=this.ntou1(),!(0==e&&(n=!0,t<0)));++r)n||(i+=String.fromCharCode(e));return i}ntou1(){return this.arr.getUint8(this.o++)}ntou2(){const t=this.o;return this.o+=2,this.arr.getUint16(t)}ntou4(){const t=this.o;return this.o+=4,this.arr.getUint32(t)}ntou8(){const t=this.arr.getUint32(this.o);this.o+=4;const e=this.arr.getUint32(this.o);return this.o+=4,t<2097152?4294967296*t+e:BigInt(t)*BigInt(4294967296)+BigInt(e)}ntoi1(){return this.arr.getInt8(this.o++)}ntoi2(){const t=this.o;return this.o+=2,this.arr.getInt16(t)}ntoi4(){const t=this.o;return this.o+=4,this.arr.getInt32(t)}ntoi8(){const t=this.arr.getUint32(this.o);this.o+=4;const e=this.arr.getUint32(this.o);return this.o+=4,t<2147483648?t<2097152?4294967296*t+e:BigInt(t)*BigInt(4294967296)+BigInt(e):~t<2097152?-1-(4294967296*~t+~e):BigInt(-1)-(BigInt(~t)*BigInt(4294967296)+BigInt(~e))}ntof(){const t=this.o;return this.o+=4,this.arr.getFloat32(t)}ntod(){const t=this.o;return this.o+=8,this.arr.getFloat64(t)}readFastArray(t,e){let i,n=0,r=this.o;const s=this.arr;switch(e){case 8:for(i=new Float64Array(t);n<t;++n,r+=8)i[n]=s.getFloat64(r);break;case 5:for(i=new Float32Array(t);n<t;++n,r+=4)i[n]=s.getFloat32(r);break;case 4:case Nb:for(i=new Array(t);n<t;++n)i[n]=this.ntoi8();return i;case 14:case Fb:for(i=new Array(t);n<t;++n)i[n]=this.ntou8();return i;case 3:case 6:for(i=new Int32Array(t);n<t;++n,r+=4)i[n]=s.getInt32(r);break;case 2:for(i=new Int16Array(t);n<t;++n,r+=2)i[n]=s.getInt16(r);break;case Lb:for(i=new Uint16Array(t);n<t;++n,r+=2)i[n]=s.getUint16(r);break;case 1:for(i=new Int8Array(t);n<t;++n)i[n]=s.getInt8(r++);break;case Ib:case Rb:for(i=new Uint8Array(t);n<t;++n)i[n]=s.getUint8(r++);break;case Hb:for(i=new Array(t);n<t;++n)i[n]=this.readTString();return i;case 9:throw new Error("kDouble32 should not be used in readFastArray");case jb:throw new Error("kFloat16 should not be used in readFastArray");default:for(i=new Uint32Array(t);n<t;++n,r+=4)i[n]=s.getUint32(r)}return this.o=r,i}canExtract(t){for(let e=0;e<t.length;e+=2)if(t[e]+t[e+1]>this.length)return!1;return!0}extract(t){if(!this.arr||!this.arr.buffer||!this.canExtract(t))return null;if(2===t.length)return new DataView(this.arr.buffer,this.arr.byteOffset+t[0],t[1]);let e=new Array(t.length/2);for(let i=0;i<t.length;i+=2)e[i/2]=new DataView(this.arr.buffer,this.arr.byteOffset+t[i],t[i+1]);return e}codeAt(t){return this.arr.getUint8(t)}substring(t,e){let i="";for(let n=t;n<e;++n)i+=String.fromCharCode(this.arr.getUint8(n));return i}readNdimArray(t,e){let i,n=t.fArrayDim,r=t.fMaxIndex;if(n<1&&t.fArrayLength>0&&(n=1,r=[t.fArrayLength]),t.minus1&&--n,n<1)return e(this,t);if(1===n){i=new Array(r[0]);for(let n=0;n<r[0];++n)i[n]=e(this,t)}else if(2===n){i=new Array(r[0]);for(let n=0;n<r[0];++n){let s=new Array(r[1]);for(let i=0;i<r[1];++i)s[i]=e(this,t);i[n]=s}}else{let s,a=[],o=[];for(s=0;s<n;++s)a[s]=0,o[s]=[];for(i=o[0];a[0]<r[0];)for(s=n-1,o[s].push(e(this,t)),++a[s];a[s]===r[s]&&s>0;)a[s]=0,o[s-1].push(o[s]),o[s]=[],++a[--s]}return i}readTKey(t){t||(t={}),this.classStreamer(t,"TKey");let e=t.fName.replace(/['"]/g,"");return e!==t.fName&&(t.fRealName=t.fName,t.fName=e),t}readBasketEntryOffset(t,e){if(this.locate(t.fLast-e),this.remain()<=0)return!t.fEntryOffset&&t.fNevBuf<=1&&(t.fEntryOffset=[t.fKeylen]),void(t.fEntryOffset||console.warn("No fEntryOffset when expected for basket with",t.fNevBuf,"entries"));const i=this.ntoi4();if(i<0||i>4*this.remain())return console.error("Error when reading entries offset from basket fNevBuf",t.fNevBuf,"remains",this.remain(),"want to read",i),void(t.fNevBuf<=1&&(t.fEntryOffset=[t.fKeylen]));t.fEntryOffset=this.readFastArray(i,3),t.fEntryOffset||(t.fEntryOffset=[t.fKeylen]),this.remain()>0?t.fDisplacement=this.readFastArray(this.ntoi4(),3):t.fDisplacement=void 0}readClass(){const t={name:-1},e=this.ntou4(),i=this.o;let n;if(n=e&Yb&&e!=$b?this.ntou4():e,!(n&Wb))return t.objtag=n+this.fDisplacement,t;if(n==$b)t.name=this.readFastString(-1),-1===this.getMappedClass(this.fTagOffset+i+2)&&this.mapClass(this.fTagOffset+i+2,t.name);else{const e=(2147483647&n)+this.fDisplacement;t.name=this.getMappedClass(e),-1===t.name&&console.error(`Did not found class with tag ${e}`)}return t}readObjectAny(){const t=this.fTagOffset+this.o+2,e=this.readClass();if("objtag"in e)return this.getMappedObject(e.objtag);if(-1===e.name)return null;const i=ow(e.name);let n;return 0===i?n=this.readTString():i>0?(n=this.readFastArray(this.ntou4(),i),this.mapObject(t,n)):(n={},this.mapObject(t,n),this.classStreamer(n,e.name)),n}classStreamer(t,e){void 0===t._typename&&(t._typename=e);const i=iw[e];if(i)return i(this,t),t;const n=this.readVersion(),r=this.fFile.getStreamer(e,n);if(null!==r){const e=r.length;for(let i=0;i<e;++i)r[i].func(this,t)}else b(t);return this.checkByteCount(n,e),t}}class yw{constructor(t,e,i){this.fFile=t,this._typename="TDirectory",this.dir_name=e,this.dir_cycle=i,this.fKeys=[]}getKey(t,e,i){"number"!=typeof e&&(e=-1);let n=null;for(let i=0;i<this.fKeys.length;++i){const r=this.fKeys[i];if(r&&r.fName===t){if(r.fCycle==e){n=r;break}e<0&&(!n||r.fCycle>n.fCycle)&&(n=r)}}if(n)return i?n:Promise.resolve(n);let r=t.lastIndexOf("/");for(;r>0;){let n=t.slice(0,r),s=t.slice(r+1),a=this.getKey(n,void 0,!0);if(a&&!i&&0==a.fClassName.indexOf("TDirectory"))return this.fFile.readObject(this.dir_name+"/"+n,1).then((t=>t.getKey(s,e)));r=t.lastIndexOf("/",r-1)}return i?null:Promise.reject(Error("Key not found "+t))}readObject(t,e){return this.fFile.readObject(this.dir_name+"/"+t,e)}readKeys(t){if(t.classStreamer(this,"TDirectory"),this.fSeekKeys<=0||this.fNbytesKeys<=0)return Promise.resolve(this);let e=this.fFile;return e.readBuffer([this.fSeekKeys,this.fNbytesKeys]).then((t=>{const i=new xw(t,0,e);i.readTKey();const n=i.ntoi4();for(let t=0;t<n;++t)this.fKeys.push(i.readTKey());return e.fDirectories.push(this),this}))}}class Aw{constructor(t){if(this._typename="TFile",this.fEND=0,this.fFullURL=t,this.fURL=t,this.fAcceptRanges=!0,this.fUseStampPar=!!m.UseStamp&&"stamp="+(new Date).getTime(),this.fFileContent=null,this.fMaxRanges=200,this.fDirectories=[],this.fKeys=[],this.fSeekInfo=0,this.fNbytesInfo=0,this.fTagOffset=0,this.fStreamers=0,this.fStreamerInfos=null,this.fFileName="",this.fStreamers=[],this.fBasicTypes={},"string"!=typeof this.fURL)return this;"+"===this.fURL[this.fURL.length-1]&&(this.fURL=this.fURL.slice(0,this.fURL.length-1),this.fAcceptRanges=!1),"^"===this.fURL[this.fURL.length-1]&&(this.fURL=this.fURL.slice(0,this.fURL.length-1),this.fSkipHeadRequest=!0),"-"===this.fURL[this.fURL.length-1]&&(this.fURL=this.fURL.slice(0,this.fURL.length-1),this.fUseStampPar=!1),0==this.fURL.indexOf("file://")&&(this.fUseStampPar=!1,this.fAcceptRanges=!1);const e=Math.max(this.fURL.lastIndexOf("/"),this.fURL.lastIndexOf("\\"));this.fFileName=e>=0?this.fURL.slice(e+1):this.fURL}assignFileContent(t){this.fFileContent=new xw(new DataView(t)),this.fAcceptRanges=!1,this.fUseStampPar=!1,this.fEND=this.fFileContent.length}_open(){return!this.fAcceptRanges||this.fSkipHeadRequest?this.readKeys():E(this.fURL,"head").then((t=>{t.getResponseHeader("Accept-Ranges")||(this.fAcceptRanges=!1);const e=t.getResponseHeader("Content-Length");return e?this.fEND=parseInt(e):this.fAcceptRanges=!1,this.readKeys()}))}readBuffer(t,e,i){if(null!==this.fFileContent&&!e&&(!this.fAcceptRanges||this.fFileContent.canExtract(t)))return Promise.resolve(this.fFileContent.extract(t));let n,r,s,a=this,o=a.fURL,l=new Promise(((t,e)=>{n=t,r=e})),h=0,c=0,d=[];if(e&&"string"==typeof e&&e.length>0){const t=o.lastIndexOf("/");o=t<0?e:o.slice(0,t+1)+e}function u(e){if(e&&(h=c,c=Math.min(h+2*a.fMaxRanges,t.length),h>=t.length))return n(d);let r=o,l="bytes",u=0;a.fUseStampPar&&(r+=(r.indexOf("?")<0?"?":"&")+a.fUseStampPar);for(let e=h;e<c;e+=2)l+=(e>h?",":"=")+t[e]+"-"+(t[e]+t[e+1]-1),u+=t[e+1];c-h>2&&(u+=60*(c-h));let f=P(r,"buf",s);if(a.fAcceptRanges&&(f.setRequestHeader("Range",l),f.expected_size=Math.max(Math.round(1.1*u),u+200)),i&&"function"==typeof f.addEventListener){let e=0,n=0,r=0;for(let i=1;i<t.length;i+=2)r+=t[i],i<h&&(e+=t[i]),i<c&&(n+=t[i]);r||(r=1);let s=e/r,a=(n-e)/r;f.addEventListener("progress",(function(t){t.lengthComputable&&i(s+a*t.loaded/t.total)}))}f.send(null)}return s=function(e){if(!e&&a.fUseStampPar&&0===t[0]&&2===t.length)return a.fUseStampPar=!1,u();if(e&&0===t[0]&&2===t.length&&!a.fFileContent)return a.fFileContent=new xw("string"==typeof e?e:new DataView(e)),a.fAcceptRanges||(a.fEND=a.fFileContent.length),n(a.fFileContent.extract(t));if(!e)return 0===h&&c>2&&a.fMaxRanges>1?(a.fMaxRanges=c/2>200?200:c/2>50?50:c/2>20?20:c/2>5?5:1,c=Math.min(c,2*a.fMaxRanges),u()):r(Error("Fail to read with several ranges"));if(c-h==2){let i=new DataView(e);return 2===t.length?n(i):(d.push(i),u(!0))}let i=this.getResponseHeader("Content-Type"),s="string"==typeof i&&i.indexOf("multipart")>=0,o=new DataView(e);if(!s){let i=this.getResponseHeader("Content-Range"),n=0,s=-1;if(i&&i.indexOf("bytes")>=0){let t=i.slice(i.indexOf("bytes")+6).split(/[\s-\/]+/);3===t.length&&(n=parseInt(t[0]),s=parseInt(t[1]),(!Number.isInteger(n)||!Number.isInteger(s)||n>s)&&(n=0,s=-1))}let o=n<=s;for(let e=h;e<c;e+=2)(t[e]<n||t[e]+t[e+1]-1>s)&&(o=!1);if(o){for(let i=h;i<c;i+=2)d.push(new DataView(e,t[i]-n,t[i+1]));return u(!0)}return 1===a.fMaxRanges||0!==h?r(Error("Server returns normal response when multipart was requested, disable multirange support")):(a.fMaxRanges=1,c=Math.min(c,2*a.fMaxRanges),u())}let l=i.indexOf("boundary="),f="",m=h,p=0;for(l>0?(f=i.slice(l+9),'"'==f[0]&&'"'==f[f.length-1]&&(f=f.slice(1,f.length-1)),f="--"+f):console.error("Did not found boundary id in the response header");m<c;){let i,n=o.getUint8(p),s=0,a="",l=!1,h=0,u=-1;for(;p<o.byteLength-1&&!l&&s<5;){if(i=n,n=o.getUint8(p+1),13==i&&10==n){if(a.length>2&&"--"==a.slice(0,2)&&a!==f)return r(Error("Decode multipart message, expect boundary"+f+" got "+a));if(a=a.toLowerCase(),a.indexOf("content-range")>=0&&a.indexOf("bytes")>0){let t=a.slice(a.indexOf("bytes")+6).split(/[\s-\/]+/);3===t.length?(h=parseInt(t[0]),u=parseInt(t[1]),(!Number.isInteger(h)||!Number.isInteger(u)||h>u)&&(h=0,u=-1)):console.error("Fail to decode content-range",a,t)}s>1&&0===a.length&&(l=!0),p++,s++,a="",n=o.getUint8(p+1)}else a+=String.fromCharCode(i);p++}if(!l)return r(Error("Cannot decode header in multipart message"));if(h>u)d.push(new DataView(e,p,t[m+1])),p+=t[m+1],m+=2;else{for(;m<c&&t[m]>=h&&t[m]+t[m+1]-1<=u;)d.push(new DataView(e,p+t[m]-h,t[m+1])),m+=2;p+=u-h+1}}u(!0)},u(!0),l}getFileName(){return this.fFileName}getDir(t,e){if(void 0===e&&"string"==typeof t){const i=t.lastIndexOf(";");i>0&&(e=parseInt(t.slice(i+1)),t=t.slice(0,i))}for(let i=0;i<this.fDirectories.length;++i){const n=this.fDirectories[i];if(n.dir_name==t&&(void 0===e||n.dir_cycle===e))return n}return null}getKey(t,e,i){"number"!=typeof e&&(e=-1);let n=null;for(let i=0;i<this.fKeys.length;++i){const r=this.fKeys[i];if(r&&r.fName===t){if(r.fCycle==e){n=r;break}e<0&&(!n||r.fCycle>n.fCycle)&&(n=r)}}if(n)return i?n:Promise.resolve(n);let r=t.lastIndexOf("/");for(;r>0;){let n=t.slice(0,r),s=t.slice(r+1),a=this.getDir(n);if(a)return a.getKey(s,e,i);let o=this.getKey(n,void 0,!0);if(o&&!i&&0==o.fClassName.indexOf("TDirectory"))return this.readObject(n).then((t=>t.getKey(s,e)));r=t.lastIndexOf("/",r-1)}return i?null:Promise.reject(Error("Key not found "+t))}readObjBuffer(t){return this.readBuffer([t.fSeekKey+t.fKeylen,t.fNbytes-t.fKeylen]).then((e=>{if(t.fObjlen<=t.fNbytes-t.fKeylen){let i=new xw(e,0,this);return i.fTagOffset=t.fKeylen,i}return _w(e,t.fObjlen).then((e=>{if(!e)return Promise.reject(Error("Fail to UNZIP buffer"));let i=new xw(e,0,this);return i.fTagOffset=t.fKeylen,i}))}))}readObject(t,e,i){let n=t.lastIndexOf(";");for(n>0&&(e=parseInt(t.slice(n+1)),t=t.slice(0,n)),"number"!=typeof e&&(e=-1);t.length&&"/"==t[0];)t=t.slice(1);return this.getKey(t,e).then((n=>{if("StreamerInfo"==t&&n.fClassName==Db)return this.fStreamerInfos;let r=!1;if("TDirectory"==n.fClassName||"TDirectoryFile"==n.fClassName){let i=this.getDir(t,e);if(i)return i;r=!0}return!r&&i?Promise.reject(Error(`Key ${t} is not directory}`)):this.readObjBuffer(n).then((i=>{if(r){let r=new yw(this,t,e);return r.fTitle=n.fTitle,r.readKeys(i)}let s={};return i.mapObject(1,s),i.classStreamer(s,n.fClassName),"TF1"===n.fClassName||"TF2"===n.fClassName?this._readFormulas(s):s}))}))}_readFormulas(t){let e=[];for(let t=0;t<this.fKeys.length;++t)"TFormula"==this.fKeys[t].fClassName&&e.push(this.readObject(this.fKeys[t].fName,this.fKeys[t].fCycle));return Promise.all(e).then((e=>(e.forEach((e=>t.addFormula(e))),t)))}extractStreamerInfos(t){if(!t)return;let e={};t.mapObject(1,e),t.classStreamer(e,Db),e._typename="TStreamerInfoList",this.fStreamerInfos=e,s.addStreamerInfosForPainter&&s.addStreamerInfosForPainter(e);for(let t=0;t<e.arr.length;++t){let i=e.arr[t];if(i.fElements)for(let t=0;t<i.fElements.arr.length;++t){let e=i.fElements.arr[t];if(!e.fTypeName||!e.fType)continue;let n=e.fType,r=e.fTypeName;if(n>=60){if(n===Xb&&"TStreamerSTL"==e._typename&&e.fSTLtype&&e.fCtype&&e.fCtype<20){let t=(Jb[e.fSTLtype]||"undef")+"<";if(0===r.indexOf(t)&&">"==r[r.length-1]&&(n=e.fCtype,r=r.slice(t.length,r.length-1).trim(),4===e.fSTLtype||5===e.fSTLtype)){if(!(r.indexOf(",")>0))continue;r=r.slice(0,r.indexOf(",")).trim()}}if(n>=60)continue}else n>20&&"*"==r[r.length-1]&&(r=r.slice(0,r.length-1)),n%=20;const s=nw(r);s!==n&&(15===n&&s===Bb||6===n&&3===s||r&&n&&this.fBasicTypes[r]!==n&&(this.fBasicTypes[r]=n))}}}readKeys(){return this.readBuffer([0,1024]).then((t=>{let e=new xw(t,0,this);if("root"!==e.substring(0,4))return Promise.reject(Error(`Not a ROOT file ${this.fURL}`));if(e.shift(4),this.fVersion=e.ntou4(),this.fBEGIN=e.ntou4(),this.fVersion<1e6?(this.fEND=e.ntou4(),this.fSeekFree=e.ntou4(),this.fNbytesFree=e.ntou4(),e.shift(4),this.fNbytesName=e.ntou4(),this.fUnits=e.ntou1(),this.fCompress=e.ntou4(),this.fSeekInfo=e.ntou4(),this.fNbytesInfo=e.ntou4()):(this.fEND=e.ntou8(),this.fSeekFree=e.ntou8(),this.fNbytesFree=e.ntou4(),e.shift(4),this.fNbytesName=e.ntou4(),this.fUnits=e.ntou1(),this.fCompress=e.ntou4(),this.fSeekInfo=e.ntou8(),this.fNbytesInfo=e.ntou4()),!this.fSeekInfo||!this.fNbytesInfo)return Promise.reject(Error(`File ${this.fURL} does not provide streamer infos`));if(!this.fNbytesName||this.fNbytesName>1e5)return Promise.reject(Error(`Cannot read directory info of the file ${this.fURL}`));let i=this.fNbytesName+22;return i+=4,i+=4,i+=18,this.fVersion>=4e4&&(i+=12),this.readBuffer([this.fBEGIN,Math.max(300,i)])})).then((t=>{let e=new xw(t,0,this);return this.fTitle=e.readTKey().fTitle,e.locate(this.fNbytesName),e.classStreamer(this,"TDirectory"),this.fSeekKeys?this.readBuffer([this.fSeekKeys,this.fNbytesKeys,this.fSeekInfo,this.fNbytesInfo]):Promise.reject(Error(`Empty keys list in ${this.fURL}`))})).then((t=>{const e=new xw(t[0],0,this);e.readTKey();const i=e.ntoi4();for(let t=0;t<i;++t)this.fKeys.push(e.readTKey());const n=new xw(t[1],0,this).readTKey();return n?(this.fKeys.push(n),this.readObjBuffer(n)):Promise.reject(Error(`Fail to read StreamerInfo data in ${this.fURL}`))})).then((t=>(this.extractStreamerInfos(t),this)))}readDirectory(t,e){return this.readObject(t,e,!0)}findStreamerInfo(t,e,i){if(!this.fStreamerInfos)return null;const n=this.fStreamerInfos.arr,r=n.length;if(void 0!==i){let t=this.fStreamerInfos.cache;t||(t=this.fStreamerInfos.cache={});let e=t[i];if(void 0!==e)return e;for(let s=0;s<r;++s)if(e=n[s],e.fCheckSum===i)return t[i]=e;t[i]=null}else for(let i=0;i<r;++i){let r=n[i];if(r.fName===t&&(r.fClassVersion===e||void 0===e))return r}return null}getStreamer(t,e,i){if("TQObject"==t||"TBasket"==t)return null;let n,r=t;if(e&&(r+=e.checksum?"$chksum"+e.checksum:"$ver"+e.val,n=this.fStreamers[r],void 0!==n))return n;let s=ew[t];if("string"==typeof s)return this.getStreamer(s,e,i);if("function"==typeof s)return n=[{typename:t,func:s}],lw(t,n);if(n=[],"object"==typeof s){if(!s.name&&!s.func)return s;n.push(s)}if(i||(i=this.findStreamerInfo(t,e.val,e.checksum)),!i)return delete this.fStreamers[r],e.nowarning||console.warn(`Not found streamer for ${t} ver ${e.val} checksum ${e.checksum} full ${r}`),null;if("TStyle"==i.fName&&i.fElements&&i.fElements.arr.forEach((t=>{"fLineStyle"==t.fName&&(t.fName="fLineStyles")})),i.fElements)for(let t=0;t<i.fElements.arr.length;++t)n.push(aw(i.fElements.arr[t],this));return this.fStreamers[r]=n,lw(t,n)}getSplittedStreamer(t,e){if(!t)return e;e||(e=[]);for(let i=0;i<t.length;++i){let n=t[i];if(void 0===n.base){e.push(n);continue}if(n.basename==Cb){e.push({func:function(t,e){t.ntoi2(),e.fUniqueID=t.ntou4(),e.fBits=t.ntou4(),e.fBits&Kb&&t.ntou2()}});continue}let r={val:n.base};4294967295===r.val&&(r.val=1);let s=this.getStreamer(n.basename,r);s&&this.getSplittedStreamer(s,e)}return e}delete(){this.fDirectories=null,this.fKeys=null,this.fStreamers=null,this.fSeekInfo=0,this.fNbytesInfo=0,this.fTagOffset=0}}function vw(t){if(this.member_wise){const e=t.ntou4();let i=null,n=this.stl_version;if(0===e)return[];if(e>1e6)throw new Error("member-wise streaming of "+this.conttype+" num "+e+" member "+this.name);n.val===this.member_ver&&n.checksum===this.member_checksum?i=this.member_streamer:(i=t.fFile.getStreamer(this.conttype,n),this.member_streamer=i=t.fFile.getSplittedStreamer(i),this.member_ver=n.val,this.member_checksum=n.checksum);let r,s,a,o=new Array(e);for(r=0;r<e;++r)o[r]={_typename:this.conttype};if(i)for(s=0;s<i.length;++s)if(a=i[s],a.split_func)a.split_func(t,o,e);else for(r=0;r<e;++r)a.func(t,o[r]);else console.error("Fail to create split streamer for",this.conttype,"need to read ",e,"objects version",n);return o}const e=t.ntou4();let i=new Array(e),n=0;if(e>2e5)return console.error("vector streaming for of",this.conttype,e),i;if(this.arrkind>0)for(;n<e;)i[n++]=t.readFastArray(t.ntou4(),this.arrkind);else if(0===this.arrkind)for(;n<e;)i[n++]=t.readTString();else if(this.isptr)for(;n<e;)i[n++]=t.readObjectAny();else if(this.submember)for(;n<e;)i[n++]=this.submember.readelem(t);else for(;n<e;)i[n++]=t.classStreamer({},this.conttype);return i}function bw(t){let e=this.streamer;if(this.member_wise){const i=this.stl_version;if(this.si){let n=t.fFile.findStreamerInfo(this.pairtype,i.val,i.checksum);if(this.si!==n&&(e=sw(n,this.pairtype,t.fFile),!e||2!==e.length))return console.log("Fail to produce streamer for ",this.pairtype),null}}const i=t.ntoi4();let n,r=new Array(i);for(this.member_wise&&t.remain()>=6&&(t.ntoi2()==Zb?t.shift(4):t.shift(-2)),n=0;n<i;++n)r[n]={_typename:this.pairtype},e[0].func(t,r[n]),this.member_wise||e[1].func(t,r[n]);if(this.member_wise)for(n=0;n<i;++n)e[1].func(t,r[n]);return r}class ww extends Aw{constructor(t){super(null),this.fUseStampPar=!1,this.fLocalFile=t,this.fEND=t.size,this.fFullURL=t.name,this.fURL=t.name,this.fFileName=t.name}_open(){return this.readKeys()}readBuffer(t,e){let i=this.fLocalFile;return new Promise(((n,r)=>{if(e)return r(Error(`Cannot access other local file ${e}`));let s=new FileReader,a=0,o=[];s.onload=function(e){let r=new DataView(e.target.result);return 2===t.length?n(r):(o.push(r),a+=2,a>=t.length?n(o):void s.readAsArrayBuffer(i.slice(t[a],t[a]+t[a+1])))},s.readAsArrayBuffer(i.slice(t[0],t[0]+t[1]))}))}}class Mw extends Aw{constructor(t){super(null),this.fUseStampPar=!1,this.fEND=0,this.fFullURL=t,this.fURL=t,this.fFileName=t}_open(){return Promise.resolve().then((function(){return Gw})).then((t=>(this.fs=t,new Promise(((t,e)=>this.fs.open(this.fFileName,"r",((i,n)=>{if(i)return console.log(i.message),e(Error(`Not possible to open ${this.fFileName} inside node.js`));let r=this.fs.fstatSync(n);this.fEND=r.size,this.fd=n,this.readKeys().then(t).catch(e)})))))))}readBuffer(t,e){return new Promise(((i,n)=>{if(e)return n(Error(`Cannot access other local file ${e}`));if(!this.fs||!this.fd)return n(Error(`File is not opened ${this.fFileName}`));let r=0,s=[],a=(e,n,o)=>{let l=new DataView(o.buffer,o.byteOffset,t[r+1]);return 2===t.length?i(l):(s.push(l),r+=2,r>=t.length?i(s):void this.fs.read(this.fd,Buffer.alloc(t[r+1]),0,t[r+1],t[r],a))};this.fs.read(this.fd,Buffer.alloc(t[1]),0,t[1],t[0],a)}))}}function Tw(t){let e;return c()&&"string"==typeof t&&(0==t.indexOf("file://")?e=new Mw(t.slice(7)):0!==t.indexOf("http")&&(e=new Mw(t))),!e&&"object"==typeof t&&t instanceof ArrayBuffer&&(e=new Aw("localfile.root"),e.assignFileContent(t)),!e&&"object"==typeof t&&t.size&&t.name&&(e=new ww(t)),e||(e=new Aw(t)),e._open()}function Sw(t){return t?.expand||t?.get_expand||t?.expand_item}function Cw(t=365,e="jsroot_settings"){let i=t<=0?"":btoa(JSON.stringify(m)),n=new Date;n.setTime(t<=0?0:n.getTime()+24*t*60*60*1e3),document.cookie=`${e}=${i}; expires=${n.toUTCString()}; SameSite=None; Secure; path=/;`}function Pw(t=!1,e="jsroot_settings"){let i=decodeURIComponent(document.cookie).split(";");e+="=";for(let n=0;n<i.length;n++){let r=i[n];for(;" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(e)){let i=JSON.parse(atob(r.substring(e.length,r.length)));if(i&&"object"==typeof i)return t||Object.assign(m,i),!0}}}function Ew(t,e){if(!I(e))return!1;if(void 0===e.arr||0===e.arr.length)return t._more=!1,!0;let i=!1,n=t;for(;n;)n._do_context&&(i=!0),n=n._parent;let r="TMap"==e._typename,s=[],a=[],o=[];for(let t=0;t<e.arr.length;++t){let i=r?e.arr[t].first:e.arr[t];if(!i)continue;let n=i.fName||i.name;if(!n)continue;let l=s.indexOf(n);l>=0?a[l]++:(a[s.length]=o[s.length]=1,s.push(n))}t._childs=[];for(let n=0;n<e.arr.length;++n){let l=r?e.arr[n].first:e.arr[n],h=l&&l._typename?{_name:l.fName||l.name,_kind:"ROOT."+l._typename,_title:(l.fTitle||"")+" type:"+l._typename,_obj:l}:{_name:n.toString(),_kind:"ROOT.NULL",_title:"NULL",_value:"null",_obj:null};switch(l._typename){case"TColor":h._value=Ll(l);break;case"TText":case"TLatex":h._value=l.fTitle;break;case"TObjString":h._value=l.fString;break;default:e.opt&&e.opt[n]&&e.opt[n].length&&(h._value=e.opt[n])}if(i&&vb(l._typename)&&(h._direct_context=!0),!h._name||Number.isInteger(parseInt(h._name))&&parseInt(h._name)!==n||e.arr.indexOf(l)<n)h._name=n.toString();else{let t=s.indexOf(l.fName);t>=0&&a[t]>1&&(h._cycle=o[t]++,h._keyname=h._name,h._name=h._keyname+";"+h._cycle)}t._childs.push(h)}return!0}function kw(t,e,i,n){if(void 0===e)return!1;t._childs=[];for(let r=0;r<e.length;++r){let s=e[r];if(m.OnlyLastCycle&&r>0&&s.fName==e[r-1].fName&&s.fCycle<e[r-1].fCycle)continue;let a={_name:s.fName+";"+s.fCycle,_cycle:s.fCycle,_kind:"ROOT."+s.fClassName,_title:s.fTitle,_keyname:s.fName,_readobj:null,_parent:t};if(s.fObjlen>1e5&&(a._title+=" (size: "+(s.fObjlen/1e6).toFixed(1)+"MB)"),s.fRealName&&(a._realname=s.fRealName+";"+s.fCycle),"TDirectory"==s.fClassName||"TDirectoryFile"==s.fClassName){let t=n&&i?i.getDir(n+s.fName):null;t?(a._name=s.fName,kw(a,t.fKeys,i,n+s.fName+"/")):(a._more=!0,a._expand=function(t,e){return kw(t,e.fKeys)})}else if("TList"==s.fClassName&&"StreamerInfo"==s.fName){if(m.SkipStreamerInfos)continue;a._name="StreamerInfo",a._kind="ROOT.TStreamerInfoList",a._title="List of streamer infos for binary I/O",a._readobj=i.fStreamerInfos}t._childs.push(a)}return!0}function Dw(t,e,i){if(!t||null===e)return!1;t._childs=[];let n=Object.prototype.toString.apply(e);if("[object DataView]"===n){let i={_parent:t,_name:"size",_value:e.byteLength.toString(),_vclass:"h_value_num"};t._childs.push(i);let n=e.byteLength<10?1:Math.log10(e.byteLength);for(let r=0;r<e.byteLength;++r){if(r%16==0){for(i={_parent:t,_name:r.toString(),_value:"",_vclass:"h_value_num"};i._name.length<n;)i._name="0"+i._name;t._childs.push(i)}let s=e.getUint8(r).toString(16);for(;s.length<2;)s="0"+s;i._value.length>0&&(i._value+=r%4==0?" | ":" "),i._value+=s}return!0}let r=!0,s=!1,a=t;for(;a;){if(a._do_context&&(s=!0),"_nosimple"in a){r=a._nosimple;break}a=a._parent}let o,l,h,c,d=u(n)>0&&e.length,f=d&&e.length>m.HierarchyLimit,p=!1;if(d&&"Object"===t._name&&!t._parent&&(t._name="Array"),f){p=!0;for(let t=0;t<e.length;++t){let i=typeof e[t];if(!("number"===i||"boolean"===i||"string"==i&&e[t].length<16)){p=!1;break}}}if("_obj"in t?t._obj!==e&&alert("object missmatch"):t._obj=e,t._title||(e._typename?t._title="ROOT."+e._typename:d&&(t._title="Array len: "+e.length)),p){for(let i=0;i<e.length;){let n=Math.min(i+10,e.length),r=!0,s=i;for(;r;){r=!0;for(let t=s;t<n;++t)e[i]!==e[t]&&(r=!1);if(r){if(n===e.length)break;s=n,n=Math.min(n+10,e.length)}else if(s!==i){n=s,r=!0;break}}let a={_parent:t,_name:i+".."+(n-1),_vclass:"h_value_num"};if(r)a._value=e[i].toString();else{a._value="";for(let t=i;t<n;++t)a._value+=(t===i?"[ ":", ")+e[t].toString();a._value+=" ]"}t._childs.push(a),i=n}return!0}for(let a in e){if("_typename"==a||"$"==a[0])continue;let d=e[a];if("function"==typeof d)continue;if(i?.exclude&&i.exclude.indexOf(a)>=0)continue;if(f&&o){if(h===d){++c,l=a;continue}c>0&&(o._name+=".."+l)}let m={_parent:t,_name:a};if(f&&(o=m,l=a,h=d,c=0),null===d){m._value=m._title="null",r||t._childs.push(m);continue}let p=!1;if("object"==typeof d)if(n=Object.prototype.toString.apply(d),u(n)>0)m._title="array len="+d.length,p="[object Array]"!=n,0===d.length?(m._value="[ ]",m._more=!1):(m._value="[...]",m._more=!0,m._expand=Dw,m._obj=d);else if("[object DataView]"===n)m._title="DataView len="+d.byteLength,m._value="[...]",m._more=!0,m._expand=Dw,m._obj=d;else if("[object Date]"===n)m._more=!1,m._title="Date",m._value=d.toString(),m._vclass="h_value_num";else{(d.$kind||d._typename)&&(m._kind=m._title="ROOT."+(d.$kind||d._typename)),d._typename&&(m._title=d._typename,s&&vb(d._typename)&&(m._direct_context=!0));let e=t,i=!1;for(;e&&!i;)i=e._obj===d,e=e._parent;if(i)m._value="{ prnt }",m._vclass="h_value_num",m._more=!1,p=!0;else switch(m._obj=d,m._more=!1,d._typename){case"TColor":m._value=Ll(d);break;case"TText":case"TLatex":m._value=d.fTitle;break;case"TObjString":m._value=d.fString;break;default:I(d)&&"object"==typeof d.arr?(m._value=d.arr.length?"[...]":"[]",m._title+=", size:"+d.arr.length,d.arr.length>0&&(m._more=!0)):(m._more=!0,m._value="{ }")}}else"number"==typeof d||"boolean"==typeof d?(p=!0,m._value="fBits"==a?"0x"+d.toString(16):d.toString(),m._vclass="h_value_num"):"string"==typeof d?(p=!0,m._value="&quot;"+d.replace(/\&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"&quot;",m._vclass="h_value_str"):void 0===d?(p=!0,m._value="undefined",m._vclass="h_value_num"):(p=!0,alert("miss "+a+"  "+typeof d));p&&r||t._childs.push(m)}return f&&o&&c>0&&(o._name+=".."+l),!0}function zw(t){let e={_name:"StreamerInfo",_childs:[]};for(let i=0;i<t.arr.length;++i){let n=t.arr[i];if("TList"==n._typename)continue;if(void 0===n.fName){console.warn(`strange element in StreamerInfo with type ${n._typename}`);continue}let r={_name:n.fName+";"+n.fClassVersion,_kind:"class "+n.fName,_title:"class:"+n.fName+" version:"+n.fClassVersion+" checksum:"+n.fCheckSum,_icon:"img_class",_childs:[]};if(""!=n.fTitle&&(r._title+="  "+n.fTitle),e._childs.push(r),void 0!==n.fElements){for(let t=0;t<n.fElements.arr.length;++t){let e=n.fElements.arr[t];if(!e||!e.fName)continue;let i=e.fTypeName+" "+e.fName,s=e.fTypeName+" type:"+e.fType;if(1===e.fArrayDim)i+="["+e.fArrayLength+"]";else for(let t=0;t<e.fArrayDim;++t)i+="["+e.fMaxIndex[t]+"]";4294967295===e.fBaseVersion?i+=":-1":void 0!==e.fBaseVersion&&(i+=":"+e.fBaseVersion),i+=";",e.fTitle&&(i+=" // "+e.fTitle),r._childs.push({_name:i,_title:s,_kind:e.fTypeName,_icon:"BASE"==e.fTypeName?"img_class":"img_member"})}r._childs.length||delete r._childs}}return e}function Ow(t,e,i){i&&"TList"==i._typename&&(i._typename="TStreamerInfoList")}function Rw(t){let e={_name:"Object",_title:"",_click_action:"expand",_nosimple:!1,_do_context:!0};return"string"==typeof t.fName&&t.fName.length>0&&(e._name=t.fName),"string"==typeof t.fTitle&&t.fTitle.length>0&&(e._title=t.fTitle),t._typename&&(e._title+="  type:"+t._typename),I(t)?(e._name=t.name||t._typename,Ew(e,t)):Dw(e,t),e}lw(Pb,ew.TNamed),lw(Eb,ew.TObjString);let Lw=t=>{let e=[];if("string"!=typeof t)return e;if(""==(t=t.trim()))return e;if(t.length<2||"["!=t[0]||"]"!=t[t.length-1])return e.push(t),e;let i=0,n=0,r=0,s=1;for(let a=1;a<t.length;++a)if(n>0)"'"===t[a]&&n--;else if(r>0)'"'===t[a]&&r--;else switch(t[a]){case"'":n++;break;case'"':r++;break;case"[":i++;break;case"]":if(a<t.length-1){i--;break}case",":if(0===i){let i=t.substring(s,a).trim();i.length>1&&i[0]==i[i.length-1]&&('"'==i[0]||"'"==i[0])&&(i=i.slice(1,i.length-1)),e.push(i),s=a+1}}return 0===e.length&&e.push(t.slice(1,t.length-1).trim()),e};function Bw(t,e){if(e&&t&&"_childs"in e){for(let t=0;t<e._childs.length;++t)(e._childs[t]._more||e._childs[t]._childs)&&(e._childs[t]._expand=Bw);return t._childs=e._childs,e._childs=null,!0}return!1}let Nw=null;function Fw(){return Nw}class Iw extends hl{constructor(t,e,i){super(e),this.name=t,this.h=null,this.with_icons=!0,this.background=i,this.files_monitoring=!e,this.nobrowser=null===e,Nw||(Nw=this)}cleanup(){this.clearHierarchy(!0),super.cleanup(),Nw===this&&(Nw=null)}fileHierarchy(t){let e=this,i={_name:t.fFileName,_title:(t.fTitle?t.fTitle+", path ":"")+t.fFullURL,_kind:"ROOT.TFile",_file:t,_fullurl:t.fFullURL,_localfile:t.fLocalFile,_had_direct_read:!1,_get:function(t,i){if(t&&t._readobj)return Promise.resolve(t._readobj);t&&(i=e.itemFullName(t,this));const n=n=>(this._file||(this._file=n),n?n.readObject(i).then((r=>{if(!t&&r){let r=e.findItem({name:i,top:this,last_exists:!0,check_keys:!0});if(void 0!==r?.last&&r.last!==this){let t=n.getDir(e.itemFullName(r.last,this));if(t){r.last._name=r.last._keyname;let i=e.itemFullName(r.last,this);kw(r.last,t.fKeys,n,i+"/")}}else kw(this,n.fKeys,n,"");t=e.findItem({name:i,top:this})}return t&&(t._readobj=r,"_expand"in t&&(t._name=t._keyname)),r})):Promise.resolve(null));return this._file?n(this._file):this._localfile?Tw(this._localfile).then((t=>n(t))):this._fullurl?Tw(this._fullurl).then((t=>n(t))):Promise.resolve(null)}};return kw(i,t.fKeys,t,""),i}forEachItem(t,e){"function"==typeof t&&function e(i,n){if(i&&(n&&(i._parent=n),t(i),"_childs"in i))for(let t=0;t<i._childs.length;++t)e(i._childs[t],i)}(e||this.h)}findItem(t){let e=this.h,i="";if(null===t)return null;if("string"==typeof t)i=t,t={};else{if("object"!=typeof t)return null;i=t.name,"top"in t&&(e=t.top)}return"__top_folder__"===i?e:"string"==typeof i&&0==i.indexOf("img:")?null:function e(i,n){if(!n||0==n.length||!i)return i;let r=n.length;if(!i._parent&&"TopFolder"!==i._kind&&0===n.indexOf(i._name)){if(n===i._name)return i;let t=i._name.length;"/"==n[t]&&(n=n.slice(t+1),r=n.length)}function s(t,s){return s||(t._parent=i),r>=n.length-1||r<0?t:e(t,n.slice(r+1))}for(;r>0;){let e=r>=n.length?n:n.slice(0,r);if(i._childs){for(let t=0;t<i._childs.length;++t)if(i._childs[t]._name==e)return s(i._childs[t]);if("TopFolder"===i._kind&&void 0!==i._childs[0]._online)for(let t=0;t<i._childs[0]._childs.length;++t)if(i._childs[0]._childs[t]._name==e)return s(i._childs[0]._childs[t],!0);if(t.check_keys){let t=null;for(let n=0;n<i._childs.length;++n)i._childs[n]._keyname===e&&(!t||t._cycle<i._childs[n]._cycle)&&(t=i._childs[n]);if(t)return s(t)}let n=t.allow_index;if("["===e[0]&&"]"===e[e.length-1]&&/^\d+$/.test(e.slice(1,e.length-1))&&(n=!0,e=e.slice(1,e.length-1)),n&&/^\d+$/.test(e)){let t=parseInt(e);if(Number.isInteger(t)&&t>=0&&t<i._childs.length)return s(i._childs[t])}}r=n.lastIndexOf("/",r-1)}if(t.force){void 0===i._childs&&(i._childs=[]),r=n.indexOf("/");let t={_name:r<0?n:n.slice(0,r)};return i._childs.push(t),s(t)}return t.last_exists&&i?{last:i,rest:n}:null}(e,i)}itemFullName(t,e,i){if(t&&"TopFolder"===t._kind)return"__top_folder__";let n="";for(;t;){if(void 0!==t._online&&!e)return n;if(t===e||"TopFolder"===t._kind)break;if(i&&!t._parent)break;n.length>0&&(n="/"+n),n=t._name+n,t=t._parent}return n}executeCommand(t,e){let i=this.findItem(t),n=this.getOnlineItemUrl(i)+"/cmd.json",r=Ii(e),s=[];if("_numargs"in i)for(let t=0;t<i._numargs;++t)s.push(t+2<arguments.length?arguments[t+2]:"");return(0!=s.length&&e?vv().then((t=>t.showCommandArgsDialog(i._name,s))):Promise.resolve(s)).then((t=>{if(null===t)return!1;let e="";for(let i=0;i<t.length;++i)e+=`${i>0?"&":"?"}arg${i+1}=${t[i]}`;return r.empty()||(r.style("background","yellow"),i._title&&r.attr("title","Executing "+i._title)),E(n+e,"text").then((t=>{if(r.empty())return t;let e=t&&"false"!=t?"green":"red";return r.style("background",e),i._title&&r.attr("title",i._title+" lastres="+t),setTimeout((()=>{r.style("background",null),i._icon&&r.classed("jsroot_fastcmd_btn")&&r.style("background-image",`url("${i._icon}")`)}),2e3),"green"==e&&"_hreload"in i&&this.reload(),"green"==e&&"_update_item"in i&&this.updateItems(i._update_item.split(";")),t}))}))}getObject(t,e){let i,n,r={item:null,obj:null};if(null===t)return Promise.resolve(r);if("string"==typeof t?i=t:"object"==typeof t&&(void 0!==t._parent&&void 0!==t._name&&void 0!==t._kind?n=t:void 0!==t.name?i=t.name:void 0!==t.arg?i=t.arg:void 0!==t.item&&(n=t.item)),"string"==typeof i&&0==i.indexOf("img:"))return r.obj={_typename:"TJSImage",fName:i.slice(4)},Promise.resolve(r);n?i=this.itemFullName(n):n=this.findItem({name:i,allow_index:!0,check_keys:!0});let s=n?null:this.findItem({name:i,last_exists:!0,check_keys:!0,allow_index:!0});if(null!==s&&"last"in s&&null!==s.last){let i=this.itemFullName(s.last);return"object"==typeof t&&"rest"in t&&(t.rest==s.rest||t.rest.length<=s.rest.length)?Promise.resolve(r):this.expandItem(i,void 0,"hierarchy_expand_verbose"!=e).then((t=>{if(!t)return r;let i=this.itemFullName(s.last);return i.length>0&&(i+="/"),this.getObject({name:i+s.rest,rest:s.rest},e)}))}if(r.item=n,null!==n&&"object"==typeof n._obj)return r.obj=n._obj,Promise.resolve(r);let a=n;for(;a;){if("function"==typeof a._get)return a._get(n,null,e).then((t=>(r.obj=t,r)));a="_parent"in a?a._parent:null}return Promise.resolve(r)}isLastSibling(t){if(!t||!t._parent||!t._parent._childs)return!1;let e=t._parent._childs,i=e.indexOf(t);if(i<0)return!1;for(;++i<e.length;)if(!("_hidden"in e[i]))return!1;return!0}addItemHtml(t,e,i){if(!t||"_hidden"in t)return!0;let n,r=t===this.h,s="_childs"in t,a=Ab(t._kind),o="",l="",h=!1,c=!1,d=this.itemFullName(t);a&&("icon"in a&&(o=a.icon),"icon2"in a&&(l=a.icon2),0==o.length&&"function"==typeof a.icon_get&&(o=a.icon_get(t,this)),(vb(a)||"execute"in a||"aslink"in a||Sw(a)&&!1!==t._more)&&(h=!0)),"_icon"in t&&(o=t._icon),"_icon2"in t&&(l=t._icon2),0==o.length&&"_online"in t&&(t._icon=o="img_globe"),0==o.length&&r&&(t._icon=o="img_base"),(t._more||t._expand||t._player||t._can_draw)&&(h=!0);let u=h;u||"string"!=typeof t._kind||0!=t._kind.indexOf("ROOT.")||(u=h=!0),0==l.length&&(l=o),0==o.length&&(o=s||t._more?"img_folder":"img_page"),0==l.length&&(l=s||t._more?"img_folderopen":"img_page"),"update"===i?(e.selectAll("*").remove(),n=e):(n=e.append("div"),i&&i>=(t._parent._show_limit||m.HierarchyLimit)&&(c=!0)),t._d3cont=n.node(),n.attr("item",d);let f=n.append("div").attr("class","h_line"),p=r?null:t._parent;for(;p&&p!==this.h;)f.insert("div",":first-child").attr("class",this.isLastSibling(p)?"img_empty":"img_line"),p=p._parent;let g="",_=!1;r||(s&&!c?(g=t._isopen?"img_minus":"img_plus",_=!0):g="img_join");let x=this;if(g.length>0){(c||this.isLastSibling(t))&&(g+="bottom");let e=f.append("div").attr("class",g);_&&e.style("cursor","pointer").on("click",(function(t){x.tree_click(t,this,"plusminus")}))}if(this.with_icons&&!c){let e,i=t._isopen?l:o;e=0==i.indexOf("img_")?f.append("div").attr("class",i).attr("title",t._kind):f.append("img").attr("src",i).attr("alt","").attr("title",t._kind).style("vertical-align","top").style("width","18px").style("height","18px"),("_icon_click"in t||a&&"icon_click"in a)&&e.on("click",(function(t){x.tree_click(t,this,"icon")}))}let y=f.append("a");if((h||s||c)&&y.attr("class","h_item").on("click",(function(t){x.tree_click(t,this)})),c)return t._break_point=!0,y.attr("title","there are "+(t._parent._childs.length-i)+" more items").text("...more..."),!1;"disp_kind"in x?(m.DragAndDrop&&h&&this.enableDrag(y,d),m.ContextMenu&&u&&y.on("contextmenu",(function(t){x.tree_contextmenu(t,this)})),y.on("mouseover",(function(){x.tree_mouseover(!0,this)})).on("mouseleave",(function(){x.tree_mouseover(!1,this)}))):t._direct_context&&m.ContextMenu&&y.on("contextmenu",(function(t){x.direct_contextmenu(t,this)}));let A=t._name,v="";if("_realname"in t&&(A=t._realname),"_title"in t&&(v=t._title),"_fullname"in t&&(v+="  fullname: "+t._fullname),v||(v=A),y.attr("title",v).text(A+("_value"in t?":":"")).style("background",t._background?t._background:null),"_value"in t){let e=f.append("p");"_vclass"in t&&e.attr("class",t._vclass),t._isopen||e.html(t._value)}if(s&&(r||t._isopen)){let e=n.append("div").attr("class","h_childs");this.show_overflow&&e.style("overflow","initial");for(let i=0;i<t._childs.length;++i){let n=t._childs[i];if(n._parent=t,!this.addItemHtml(n,e,i))break}}return!0}toggleOpenState(t,e){let i=e||this.h;if(void 0===i._childs)return!!t&&(!(this.with_icons&&!i._more&&!i._expand&&!this.canExpandItem(i))&&(this.expandItem(this.itemFullName(i)),void 0!==i._childs&&(i._isopen=!0),i._isopen));if(i!==this.h&&t&&!i._isopen)return i._isopen=!0,!0;let n=!1;for(let e=0;e<i._childs.length;++e)this.toggleOpenState(t,i._childs[e])&&(n=!0);return i===this.h||t||!i._isopen||n?(e||this.refreshHtml(),!1):(delete i._isopen,!0)}refreshHtml(){let t=this.selectDom();if(t.empty())return Promise.resolve(this);t.html("").style("overflow",this.show_overflow?"auto":"hidden").style("display","flex").style("flex-direction","column"),function(t){function e(t,e,i,n){return`.jsroot .img_${t} { display: inline-block; height: ${e}px; width: ${e}px; background-image: url("data:image/${i};base64,${n}"); }`}gv(`\n.jsroot .h_tree { display: block; white-space: nowrap; }\n.jsroot .h_tree * {\n    padding: 0;\n    margin: 0;\n    font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;\n    box-sizing: content-box;\n    line-height: 14px\n}\n.jsroot .h_tree img { border: 0px; vertical-align: middle; }\n.jsroot .h_tree a {\n    color: inherit;\n    white-space: nowrap;\n    text-decoration: none;\n    vertical-align: top;\n    white-space: nowrap;\n    padding: 1px 2px 0px 2px;\n    display: inline-block;\n    margin: 0;\n}\n.jsroot .h_tree p {\n    font-weight: bold;\n    white-space: nowrap;\n    text-decoration: none;\n    vertical-align: top;\n    white-space: nowrap;\n    padding: 1px 2px 0px 2px;\n    display: inline-block;\n    margin: 0;\n}\n.jsroot .h_value_str { color: green; }\n.jsroot .h_value_num { color: blue; }\n.jsroot .h_line { height: 18px; display: block; }\n.jsroot .h_button { cursor: pointer; color: blue; text-decoration: underline; }\n.jsroot .h_item { cursor: pointer; }\n.jsroot .h_item:hover { text-decoration: underline; }\n.jsroot .h_childs { overflow: hidden; display: block; }\n.jsroot_fastcmd_btn {\n   height: 32px;\n   width: 32px;\n   display: inline-block;\n   margin: 2px;\n   padding: 2px;\n   background-position: left 2px top 2px;\n   background-repeat: no-repeat;\n   background-size: 24px 24px;\n   border-color: inherit;\n}\n.jsroot_inspector {\n    border: 1px solid black;\n    box-shadow: 1px 1px 2px 2px #aaa;\n    opacity: 0.95;\n    background-color: white;\n}\n.jsroot_drag_area { background-color: #007fff; }\n${e("minus",18,"gif","R0lGODlhEgASAJEDAIKCgoCAgAAAAP///yH5BAEAAAMALAAAAAASABIAAAInnD+By+2rnpyhWvsizE0zf4CIIpRlgiqaiDosa7zZdU22A9y6u98FADs=")}\n${e("minusbottom",18,"gif","R0lGODlhEgASAJECAICAgAAAAP///wAAACH5BAEAAAIALAAAAAASABIAAAImlC+Ay+2rnpygWvsizE0zf4CIEpRlgiqaiDosa7zZdU32jed6XgAAOw==")}\n${e("plus",18,"gif","R0lGODlhEgASAJECAICAgAAAAP///wAAACH5BAEAAAIALAAAAAASABIAAAIqlC+Ay+2rnpygWvsizCcczWieAW7BeSaqookfZ4yqU5LZdU06vfe8rysAADs=")}\n${e("plusbottom",18,"gif","R0lGODlhEgASAJECAICAgAAAAP///wAAACH5BAEAAAIALAAAAAASABIAAAIplC+Ay+2rnpygWvsizCcczWieAW7BeSaqookfZ4yqU5LZdU36zvd+XwAAOw==")}\n${e("empty",18,"gif","R0lGODlhEgASAJEAAAAAAP///4CAgP///yH5BAEAAAMALAAAAAASABIAAAIPnI+py+0Po5y02ouz3pwXADs=")}\n${e("line",18,"gif","R0lGODlhEgASAIABAICAgP///yH5BAEAAAEALAAAAAASABIAAAIZjB+Ay+2rnpwo0uss3kfz7X1XKE5k+ZxoAQA7")}\n${e("join",18,"gif","R0lGODlhEgASAIABAICAgP///yH5BAEAAAEALAAAAAASABIAAAIcjB+Ay+2rnpwo0uss3kf5BGocNJZiSZ2opK5BAQA7")}\n${e("joinbottom",18,"gif","R0lGODlhEgASAIABAICAgP///yH5BAEAAAEALAAAAAASABIAAAIZjB+Ay+2rnpwo0uss3kf5BGrcSJbmiaZGAQA7")}\n${e("base",18,"gif","R0lGODlhEwASAPcAAPv6/Pn4+mnN/4zf/764x2vO//Dv84HZ/5jl/0ZGmfTz9vLy8lHB/+zr70u+/7S03IODtd7d6c/P0ndqiq/w/4Pb/5SKo/Py9fPy9tTU121kjd/f4MzM062tx5+zy5rO67GwxNDM14d8mJzn/7awwry713zX/9bW27u71lFRmW5uoZ+fxjOy/zm1/9HQ2o3g/2xfgZeMplav7sn9/6Cgv37X/6Dp/3jU/2uJ2M7J1JC63vn5+v38/d7e38PD0Z7o/9LR4LS01cPDzPb1+Nzb5IJ2lHCEv5bk/53C3MrJ3X56t+np6YF7o3JsndTU5Wtgh5GHoKaesuLi4mrO/19RdnnV/4WBqF5QdWPK/4+PvW5uu4+PuuHh4q7w/97e68C9z63w/9PT0+zs7FtbmWVXerS0yaqitpuSqWVlpcL6/8jD0H/C9mVajqWu3nFwpYqHtFfE/42DnaWl0bTz/5OPt+7u7tra5Y+Yz+Tk56fM6Gek5pG50LGpvOHh72LJ/9XU5lbD/6GnwHpujfDu8mxpntzb45qav7PH41+n6JeXyUZGopyYsWeGyDu2/6LQ44re/1yV41TD/8LC1zix/sS/zdTU4Y+gsd/c5L7z+a6uzE+3+XG89L6+087O1sTD3K2twoGBtWVbgomo4P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAKMALAAAAAATABIAAAjtAEcJFLgDTyE7SVCsAAJgoMNRYTII8fEpkAckOpiEaPhwlARLexxhmpEGzJEmBAJ0HMXhw6MfXeZQsDHADZ8hK13kMTEAwQgEL2oYiaJgJZFDU24cqHCgSgFGFgysBJAJkB8BBQRggQNJxKCVo0rIcMAgEgMHmnBMaADWEyIWLRptEqWETRG2K//ombSmjRZFoaCo4djRyZ0HchIlSECIRNGVXur0WcAlCJoUoOhcAltpyQIxPSRtGQPhjRkMKyN0krLhBCcaKrJoOCO1I48vi0CU6WDIyhNBKcEGyBEDBpUrZOJQugC2ufPnDwMCADs=")}\n${e("folder",18,"gif","R0lGODlhEgASANUAAPv7++/v79u3UsyZNOTk5MHBwaNxC8KPKre3t55sBrqHIpxqBMmWMb2KJbOBG5lnAdu3cbWCHaBuCMuYM///urB+GMWSLad1D8eUL6ampqVzDbeEH6t5E8iVMMCNKMbGxq58FppoAqh2EKx6FP/Ub//4k+vr6///nP/bdf/kf//viba2tv//////mQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAC4ALAAAAAASABIAAAaRQJdwSCwaj8ik0jUYTBidAEA5YFkplANhehxABGAwpKHYRByVwHBibbvbo8+Q0TrZ7/jWBTHEtP6AgX8GK0MWLSWJiostEoVCBy0qk5SVLQmPLh4tKZ2eny0LmQ0tKKanqC0hmQotJK+wsS0PfEIBZxUgHCIaBhIJCw8ZBUMABAUrycrLBQREAAEm0tPUUktKQQA7")}\n${e("folderopen",18,"gif","R0lGODlhEgASANUAAO/v76VzDfv7+8yZNMHBweTk5JpoAqBuCMuYM8mWMZ5sBpxqBPr7/Le3t///pcaaGvDker2KJc+iJqd1D7B+GOKzQ8KPKqJwCrOBG7WCHbeEH9e4QNq/bP/rhJlnAffwiaampuLBUMmgIf3VcKRyDP/XhLqHIqNxC8iVMMbGxqx6FP/kf//bdf/vievr67a2tv/4k8aaGf//nP//mf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADUALAAAAAASABIAAAaVwJpwSCwaj8ikUjgYIBIogEA5oFkZDEtheqzKvl9axKTJYCiAIYIGblutqtQwQYPZ73jZpCGM+f+AfiEdJy99M21tMxwxJQeGNTGIeHcyHzEjCpAAki2en54OIhULkAKSMiuqqysOGxIGkDWcMyy2t7YQDx58QqcBwMAkFwcKCwYgBEQFBC/Oz9AEBUUALtbX2FJLSUEAOw==")}\n${e("page",18,"gif","R0lGODlhEgASAOYAAPv7++/v7/j7/+32/8HBweTk5P39/djr/8Df//7///P5/8Ph//T09fn5+YGVw2t0pc7n/15hkFWn7ZOq0nqDsMDA/9nh7YSbyoqo2eTx/5G46pK873N+sPX6//f395Cjy83m/7rd/9jl9m13qGVqmoeh0n+OvI+z5Yyu387T//b6/2dtnvz9/32JtpS/8sbGxv7+/tvn92lwom96rHJ8rnSAsoep3NHp/8nk/7e3t+vr67a2tun1/3V4o+Hw/9vt/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEEALAAAAAASABIAAAejgEGCg4SFhoeILjaLjDY1AQCHG0AGAA0eDBY1E5CGGjBAoQkCMTUSHwGGJwaiAh0iNbEvhiihAgIDPDwpFRw5hhgsuLk8Pz8HNL+FJSoKuT4+xzczyoQXzjzQxjcgI9WDDrraPzc4OA/fgibZ0eTmCzLpQS0Z7TflCwgr8hT2EOYIQpCQ16OgwYMRCBgqQGCHw4cOCRQwBCCAjosYL3ZCxNFQIAA7")}\n${e("question",18,"gif","R0lGODlhEgASAPelAOP0//7//9bs//n///j//9Ls/8Pn//r//6rB1t3f5crO2N7g5k1livT4+7PW9dXt/+v4/+Xl5LHW9Ov6/+j1/6CyxrfCz9rd5Nzj6un1/Z6ouwcvj8HBzO7+/+3//+Ln7BUuXNHv/6K4y+/9/wEBZvX08snn/19qhufs8fP7/87n/+/t7czr/5q1yk55q97v/3Cfztnu//z//+X6/ypIdMHY7rPc/7fX9cbl/9/h52WHr2yKrd/0/9fw/4KTs9rm75Svzb2+ya690pu92mWJrcT3//H//+Dv/Xym35S216Ouwsvt/3N/mMnZ5gEBcMnq/wEBXs/o/wEBetzw/zdYpTdZpsvP2ClGml2N3b3H0Nzu/2Z2lF1ricrl/93w/97h6JqluktojM/u/+/z9g8pVff4+ebu9q+1xa6/zzdFaIiXr5Wyz0xslrTK4uL//2uIp11rh8Xj/NXn+Oz2/9bf6bG2xAEBePP//1xwkK/K5Nbr/8fp/2OBtG53kai3ykVCYwEBde/6/7O4xabI+fD//+by/x8+jDhZpM/q/6jK58nO19ny/7jV7ZO42NHr/9H4/2ZwimSV6VBxwMDX7Nvf5hYwX5m20sfb6Ieqyk9Yjr/k/cPM2NDp/+/098Tl9yQ9jLfW+Mne8sjU30JklP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAKUALAAAAAASABIAAAjxAEsJHEiwoMEyGMaQWthg0xeDAlGUWKjoz5mFAegY/LBiIalMUK54JCWEoJkIpA6kSDmoAykKgRaqGSiq04A5A5r4AKOEAAAtE2S0USAwSwYIhUb8METiUwAvemLMCMVEoIUjAF5MIYXAThUCDzgVWDQJjkA0cngIEHAHCCAqRqJ0QeQoDxeBFS71KKDCwxonhwiZwPEkzo4+AimJqBFCjBs+UjZ4WmLgxhAQVgb6acGIBShJkbAgMSAhCQ1IBTW8sZRI055HDhoRqXQCYo4tDMJgsqGDTJo6EAlyYFNkVJDgBgXBcJEAucEFeC44n04wIAA7")}\n${e("histo1d",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAADAFBMVEW9vb2np6empqanpqenpqivr6//AAD3+fn09vb19vf3+Pv8+v//+//29/v3+fr19vbZ3Nza3d7X0+Lb3t7b3N3AwMP2+PimpqXe4+Th6uvQ0dTi6uzg5ebFx8nt6vb////r5/T2+fnl4e3a3uDN0NT7/P6lpqX3+vvn9vhcVVHu+//W1uH48//29P///f+mpqelpqb4/v/t/f9oY2H6///59v/x8fXw9fny9/78/v+lpqf7//9iXl12dHPW2t/R1tdtaGbT2dpoZmT6/v9ycnKCgoJpZGJ6dnT3///2///0//95entpa2t+gIKLjI55d3aDgYBvcXL1+/z9/v6lpaWGiIt7fH6Ji42SlJeEhIZubGyMjI17fYD+//+kpKSmpaaRk5WIioyRk5aYmp2OkJJ+f4KTlZilpKWcnqGVl5qcnqCfoaOYmp6PkZOdn6GsrrGoqq6qrK+rrbGpq66lp6uqrbCoqq20tLSsrKzc3NzMzMzPz88AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB6enrU4/9iYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmLU4/9KSkoAAAAAAAAAAAB6enrU4//m5uZiYmLm5uZiYmLm5uZiYmLm5uZiYmLm5ubU4/9KSkoAAAAAAAAAAAB6enrU4/9KSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkrU4/9KSkoAAAAAAAAAAABubm7U4//U4//U4//U4//U4//U4//U4//U4//U4//U4//U4/9KSkoAAAAAAAAAAABubm5KSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABt6dBwBYjWHVG2AAAAB3RSTlP///////8AGksDRgAAAAlwSFlzAAALEgAACxIB0t1+/AAAAOxJREFUeNpjYGBkggBmFmYmRlY2BkZ2DhDg5OLm4eblY2RjYOIXEBQSFhEFkgKCYkxsDOKcEpJS0jKycvJS8gpcIAFFJWUVGFIFCqipa8hrymtpy+sI6crr6bMxGBgayRvLm8iamkmZW1gCBayslWxs7ewd7OwdlZStrYC2ODm7uLrJu3t4usl7mRiwMeh7+/j6+VsHBMr7+wQFhwAFQsPCIyKjomOiIsOiYuPYGOITEpOSU1LTElNTElPlgQLpGZlZ2Tm5eZm5OZm5IAGm/ILCouKS0rKS4oISeaDDypniEICpgo2hsgoZVLMBAHIaNxuoIXy2AAAAAElFTkSuQmCC")}\n${e("histo2d",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsSAAALEgHS3X78AAABUUlEQVR42o1R0U7CQBDkU/w/v8qk1/OhCS+88miMiQYMBMNRTqiisQiRhF6h13adsuVKDEYvm81kdmdv9q7V7XallP65I30UrpErLGW73SaiFtDF5dXWmNNITJrubJ4RWUI2qU33GTorAdSJMeMwhOxpEE20noRTYISaajBcMrsdOlkgME+/vILtPw6j+BPg5vZuFRuUgZGX71tc2AjALuYrpWcP/WE1+ADAADMAY/OyFghfpJnlSTCAvLb1YDbJmArC5izwQa0K4g5EdgSbTQKTX8keOC8bgXSWAEbqmbs5BmPF3iyR8I+vdNrhIj3ewzdnlaBeWroCDHBZxWtm9DzaEyU2L8pSCNEI+N76+fVs8rE8fbeRUiWR53kHgWgs6cXbD2OOIScQnji7g7OE2UVZNILflnbrulx/XKfTAfL+OugJgqAShGF4/7/T6/Ug+AYZrx7y3UV8agAAAABJRU5ErkJggg==")}\n${e("histo3d",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAADAFBMVEX////48OjIgTrHfjjKgTr78+yixH9HiQBHiACiw37jvJXfpVP6wzT7zTn7yj3lp1qOhyJzvgCa3wCa3gB2ugBinQ6Pt2D4+vfOjEr96p3986z83mT99rD99a3WhEvC0kaU3gCV3ADG71zo/KORzw1gowBonS3Z5snHfTb6uyD6tzD+/Nb7z0/70D3KdTXI1l3h+qTi+KXD7luU3ACY3gCc4QCi3g1QjwXHfjr710T6xi/+9sn70UH73E/MdDqhvQCi1BKkug2XxACU1wCS2ADD51rr9aJXkw/MpYDgpkb71U7+9MP7007hnEO3niOj0hGq3SCZtQCbtQCjtwj//+7F4Vui0wBDhgDk5eTMxcGxfi3TfTq+fyPPz4ak3xux5TG87kmZuwCZvACWtgDf8a+c0gCy3yNLiwD7/Ps1iwCiyAPF3F7j7bG67EW77kmq5yWYzwCZwwCTugDc8KTE51ve9YZCigCgwgCVuQDa5p7U9YSq4yWT2gCV2wCT2wCp2h/y+9HC6lW87DlChQBGigCixgCYvgDK3nyXvgC72UjG7mSj3xXL7XDK7W7b9J+36TrG9lBDhQBHigClywCbxQDJ33SXvwCYvQCcwADq+8S77Ei460Hd+KDD9VHU/2VEhgBdlR1rowCXwwDK4W6bxgCaxQCVvQDp/L+/8k7F91fn/6zC9V18tiNbkx/U1dSyv6RglihnoQCYwwChyQDs/7/P/2fE92F5tCBdkib19vXW1taoupVLiwNooQCWwADo/7h5tSBFhgaouZXx8vHOz86ftYVJiQBNjQKetIXt7u3Nzs0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBfAAAAAAAAAA2tmA2tmAAACQAAAAAAAAAAAAAAAAAAAAAATgAABNBfMAAAAAAAAA2tpQ2tpQAACQAAAAAAAAAAAAAAAAAAAAAAdQAABNBfMAAAAAAAAA2tsg2tsgAACQAAAAAAAAAAAAAAAAAAAAAAggAABNBfMCaVmCSAAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEgAACxIB0t1+/AAAAQVJREFUeNpjYGBkYmZhZWBj5+BkAAMubh5ePn4BQSFhEVExcaCAhKSUtIysnLyCopKyiqqaOoOGppa2jq6evoGhkbGJqZk5g4WllbWNrZ29g6OTs4urmzuDh6eXt4+vn39AYFBwSGhYOENEZFR0TGxcfEJiUnJKalo6A0NGZlZ2Tm5efkFhUXFJqTnQnrLyisqq6prauvqGxqZmoEBLa1t7R2dXd09vX/+EiUCBSZOnTJ02fcbMWbPnzJ03HyiwYOGixUuWLlu+YuWq1WvWAgXWrd+wcdPmTVu2btu+Y/06kHd27tq9Z+++/QcOHtq1E+JBhsNHjh47fuLIYQYEOHnq1EkwAwCuO1brXBOTOwAAAABJRU5ErkJggg==")}\n${e("graph",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AEFCgohaz8VogAAAT9JREFUOMulkz1LQlEYx39XmrIhcLa5i4mD4JBQrtHieDbb+gx3dbl9hca7tLi4VOsRMkKQVO7LLAQNNdSQgyJPg903tDT8w4HzPDznd56Xc1BKCVsokzTGjhPBXDcQAAEZDgPZCHDQaESH5/PYXyqZxp8A349vGHkjOXo3uXtp035sy79KABi8DQCwshb7x3U6gIYU6KNej+1kEwUEjbQeWtIb9mTsOCIgN1eXgiYd96OdcKNBOoCuQc47pFgoGmHw7skZTK9X16CUku5zV9BIkhz4vgSuG/nsWzvKIhmXAah+VpfJsxnGZMKkUln05NwykqOORq6UWkn+TRokXFEG/Vx/45c3fbrnFKjpRVkZgHKxbAC8NptrAfm9PAD2l42VtdJjDDwv2CSLpSaGMgsFc91hpdRFKtNtf6OxLeAbVYSb7ipFh3AAAAAASUVORK5CYII=")}\n${e("mgraph",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAADAFBMVEW9vb2np6empqanpqenpqivr68AAAD3+fn09vb19vf3+Pv8+v//+//29/v3+fr19vbZ3Nza3d6/wcLb3t7b3N3AwMPi4et2oz0yfwDh3+n2+PimpqXe4+Th6uvD0NHi6uzg5ebFx8nt6vY2ggDs/881gQDr5/T2+fnFz9DDZVrAIhDEZVvJ0tTN0NTX0+IvZAA4hAAuYgDT0N77/P6lpqX3+vvn9vi/JRL81cHBJhTu+//W1uEkXgD48//29P8fWwD//f+mpqelpqb4/v/t/f+yCwDBKBi3CgD6//8kYAD59v/x8fXQ0dTw9fny9/78/v+lpqf7//+wAADV5ezZ5e7g6PQjZQDf4+/W2t/R1tfT2drT3+OvAAD9///6/v/////k4vIiXwC1AAD3///2///X6Oz0//9+rUgzfwAwdADa6u6xCwDAJxb5///1+/z9/v6lpaUwfADo/8vl4e3a3uDb6eu+IxL808C+IhDZ5+nW2tr+//+kpKSmpaaArUgvewB1oj39/v/e5ebVd227HgvJa2H8///6/PylpKXn4+ze4eLg5+j9/v20tLSsrKzc3NzMzMzPz88AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAPAAAAAAEAAAEAAABzL1z/CSMAAAAAAAAAAAAAAAMAAAAmCTsAAAAAAAAAAAAAAAAAAAQAAQEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7op0gAAAAB3RSTlP///////8AGksDRgAAAAlwSFlzAAALEgAACxIB0t1+/AAAAOhJREFUeNpjYGBkggBmFmYmRlY2BkZ2DhDg5OLm4eblY2RjYOIXEBQSFhEVE5cQl5RiYmOQ5pSRlZNXUFRSVlFV4wIJqGtoamnr6OrpGxgaGQMFTEzNzC0sraxtbPXs7B0c2RicnF1c3dw9PL28fXz9/IECAYFBwSGhYeERkVHRMYEBQFti4+ITEuOTklNSg9I8nNgYHOPTMzLjA7Oyc7Jz8/ILQAKFRRnFJaVl5RWVVdU1bAy18XX1DfGNTc0trW3t8UCBjvj4+M746q74+O7qHpAAUzwyADqsl6kGAZj62Bj6JyCDiWwAyPNF46u5fYIAAAAASUVORK5CYII=")}\n${e("tree",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAQAAAAEABcxq3DAAACjklEQVQ4y4WTy49LcRzFP+2tzmVUr9dIDJOWGGVBicgEyTQTCzIetUFssDKJSFhY2SARCYvBbGrj8QcIkYglk8xCmEQ9xqNexbQVY2Zub3un9/W7PwstHZH4Jie/7+Kc8/suzgnwr+kjBqSBbm2lkm6bHyH3XM9SZQ8Z8s3UQJPo0IJVof5EZ7v2faxMrKONlhmQWN5GSFEwLbhybjBPhDwVsmQ4AaA09Mou+k8d702EAzXiS6KEgzahoIthGOi6DtKlN71GS+/cEPs0WewaX2R9ZphssP776UhESY0WSpQNg7Jh4Anx+zgJVKpV3uZyvHjzir27NwGs/XVBH8c7N2nnjx7eSqlYxPM8JCCkxBU+rhA4dVhCYJgmyc4Ej96/7rLi8nNAPc/k2ZNp7cnTpziuiy8lvpSI+tvYhS/xpY8vJXMiEbZv3MzFq3cJqaqiPX72jnKt9kfQRPZ9f5qZ70sMawyAas1GseIy1rNtVXK8Mkm1VsP2PBzhYQuB5Qns+t6AJQSqqlIcrTAy+ONGENBWLF3MN71MxXGo1mE6DqbrYLou8z/a7L3uMKvgUnU8xk2T3u71ADGFDdgvCx/3TwkLEfKxhWDHbY+eYZ+Obz6tJcmRApRsuJ8Ex4Po7Jl8/TDBl7flm4Gm5F1vSZKaFQUh4cB9OLgaDB3UVrjwA+6tBnKAis4El8lwujmJSVQeoKAxFzqDcG0KWhZC6R30tUJRQD3Odxqy4G+DDFks4pisY5RLgRx5pZ5T4cKy95yhSrxZDBCaVqIMOpAd2EIeSEW7wLQh3Ar7RtCHbk0v0vQy1WdgCymgf147Sa0dhAOVMZgoALDu2BDZ/xloQAzQgIOhMCnPYQ+gHRvi4d/8n00kYDRVLifLAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDEwLTAyLTExVDE0OjUxOjE3LTA2OjAwHh/NoQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAwNC0wOS0yMFQxNzoxMDoyNi0wNTowMCcJijsAAAAASUVORK5CYII=")}\n${e("branch",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAADAFBMVEX///99plFAfADL27hpmyfP8YxyoilSiRiv0XGGygK02VtRiBmVwjh8xQCcziFZkhLz9+9BfQB2rwaCyACRygFQigXw9Ox0mkpXkQCJzwBblgBmkzP8/fxEgQBCfwBEgQejwITe3t5hkC1CfgBfjynZ2tmSq3eArDu72oNvoDJajyTY2dhFgQDCzLqhvn9EgAazx55XkwCVzC2824GMs1J0oUTY48xajiK72YR9qj2Tq3dhkix+th99xAB3uADA3oQ+fABEgABIgwW82oOUyi5VkgCf0CaEygB+wwCbzjN1mkrA3YZ1tAB7wAB+uB1vl0JdmgCJwwCKzwBoqAB4nVBikiuayzZ8wQCFywCg0Sjd3t1lkjFBfABLgwhKgwlmpgCK0QCJxQBclwDMzMzPz89GggCDpFxDfgCIpmPl5eUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABhAABQEABuZQBjYQBvcgAIZABiYQBlZAAABQDU/wCx/wCO/wBr/wBI/wAl/wAA/wAA3AAAuQAAlgAAcwAAUADU/wCx/wCO/wBr/wBI/wAl/wAA/gAA3AAAuQAAlgAAcwAAUADj/wDH/wCr/wCP/wBz/wBX/wBV/wBJ3AA9uQAxlgAlcwAZUADw/wDi/wDU/wDG/wC4/wCq/wCq/wCS3AB6uQBilgBKcwAyUAD//wD//wD//wD//wD//wD//wD+/gDc3AC5uQCWlgBzcwBQUAD/8AD/4gD/1AD/xgD/uAD/qgD/qgDckgC5egCWYgBzSgBQMgD/4wD/xwD/qwD/jwD/cwD/VwD/VQDcSQC5PQCWMQBzJQBQGQD/1AD/sQD/jgD/awD/SAD/JQD+AADcAAC5AACWAABzAABQAAD/1AD/sQD/jgD/awD/SAD/JQD/AADcAACwULzWAAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEgAACxIB0t1+/AAAALZJREFUeNpjYAADRiZGBmTAzMLKxowswM7BycWNLMDEw8vHL4AkICgkLCIqhiQgLiEpJS0D5cjKySsoKimrqMJk1dQ1NLW0dXQZ9PTlZEECBoZGxiamOmbmmhaWViABaxtbO3sHRycTZxdXA7ANbu4enkxeDt4+vn7WIAH/gMCg4JBQprDwiEhBkEBUtGBMrI5OXHxCYpI/2BrV5OSU5NS09BjB6CiE01JTM5KTVZHcmpycCWEAANfrHJleKislAAAAAElFTkSuQmCC")}\n${e("leaf",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAADAFBMVEX////M27mQs2tilDA9eQA7egBbkhVTjAxJgwWBqVdGgQBrnySdxViu0WrE4oaYv2PC35NtoCqxvaSevX5FgAB7qje73nDK6neu109vpyVupCGo2kJ9xwBQhBtilC9pnx7G63PM6olgnAB/vQBDigCVv0yb1CaDzAB8uBJwmkNnnBnB52ui2Ca94WZopAE/hgCtz2ue2CmDywCByACKujtdjyqdvHpdlhLV9YdkowCFxwCw1lFXmAJvpC5jng1coABlpwBprAB8sitAfABDfgKx31Gr3TuCsi5sqABtqgBUkxTV85zL7I213mef0j+OxyKk00k/ewCp3TCSyhCw0mRRjQC23HmU0h55wQB5vQB4uQB1tgCIwBeJxgCBvQDC3ndCjACYx1204Fx6wwB7vQB1tABzsQBBfQBpkzdtpQB9tQA/iQCMu1SMukNUlQBYmQBsqAd4rh11rwZyrQBvqgBDfwCqvZVWkQBUnACp0Hq/43K733C+4X+w12eZyT2IvSN5sgpZkwBxmUSDqFlbnACJzQy742p/wwB2ugBysgBwrwBvqwBwqQBhmgBCfwDV2NN8pk1foACO1QBZmABRkABpqwB3uQB0sgB0rgBnogBUjgC7w7NymkFdnQBUhxmis41okjdCfgBGgQWHpWPMzMzb3NtumD5NhQzT09Pv8O/a2trOz87l5eXc3NzPz88AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABtHAA4HXQAAEgAAB9CTigAAABCfCQ4HTxy6Kw4HXRy+8xy+8wAAMwAAAAAAAAAAAAAAAAAAAAAAAgAAAgAABgYAAG7AAAAACgAAAgAAAgYAAEAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4Hnw4HnwAAFRpRiYmO2V0aWRtSSY7ZWdsZVNpdGNBO251amRGO3R0bCYmO3J3ZWlvVCY7c2xuaVc7d28ABCwBG8q3AAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEgAACxIB0t1+/AAAAOtJREFUeNpjYIACRiZmFlY2dg4ol5OLm4eXj19AUAjMFRYRFROXkJSSlpEF8+XkFRSVlFVU1dQ1NMF8LW0dXT19A0MjYxNTIN/M3MLSytrG1s7ewdHJGSjg4urm7uHp5e3j6+cfABIIDAoOCVUJC4+IjIqOAQk4x8bFJyQmJadEpaalpQMFMjKzsnNy8/ILCouKS0qBAmXlFZVV1TW1dfUNJY1NQIHmlta29o7ozq7unt6+fgaGCRMnTZ4ydVrU9BkzZ5XOBiqYM3HuvPkL0tPTFy5avATkzqXLlq9YuWoJEKxeA/Ho2nUMyAAA9OtDOfv2TiUAAAAASUVORK5CYII=")}\n${e("leaf_method",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAKlBMVEUAAAAAgADzExMAgIAAAADAwMCAgADxGRnuFxLnHhHuIyPKJQ/rLi7////aW8ZOAAAAAXRSTlMAQObYZgAAAAFiS0dEDfa0YfUAAAAHdElNRQfgCxIPFR/msbP7AAAAaUlEQVQI12NggANBBiYFMMNQxAjCYA4UUoZIBRpBGMyiQorGIIaxWRCEwSYo3igiCNJlaLkwGSwkJn1QGMhgNDQ0TDU2dACqERYTDksGG5SkmGoApBnFhBRTBUAiaYJpDIJgs10cGBgdACxbDamu76Z5AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAxLTE3VDA5OjMwOjM1KzAxOjAwyGHxKQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0xMS0xOFQxNToyMTozMSswMTowMJgvuUkAAAAASUVORK5CYII=")}\n${e("globe",18,"gif","R0lGODlhEwASAPcAAPr7/AFyAQFCpwGD6jy3/wE9on7N0AE+pAFjyMLI0AE2mwF94wGP9QFpzgU3nISSopWgrmJsfTNLfgFHqAFuBilNiTp4sLnGzwWb/0xYb/P09mRygGl0hRlnMgR12V2Pr6e4xF9peS2Cyh5FpBdSfgF84YmisdPa30hjvw+foQFYvlWj4HWIlkWb5gk5n/b4+gw+kgFMscXb6ylmieDj5ju2pylTsniElgqd/u/x8wGW/O7v8SVMsUq+JSSJXQFiwfv+/AFqvB9ntobZeKbc/9vt+B+YmW2rvKruzQGPkm3PPrjmxQFIklrFLVbD4QGMYaXkoIPD13LC+nGw5AGFQHG66gF2eBaJxket9sLf84HI+wF7axBdbg2c0CR+1QFsEIfJ7yqoUIbH41tldgF+KzVTjn3QfitZgTJZkaDR8gKDsXeWrE+zogE3nCeKzQFtJ0tknjdnbQGB6EJgxQFqAcLJ0WC//yKm/wE+o7vI0ARozEOz/4/g/4KToyaX4/D09pCpuNHV24HA6gw7oAF/AXWKnEVSb5TI6VzDTrPprxBQts7e6FNdcBA9oySd9RRjPAhnD2NvgIydrF+6wdLo9v7//2K+twKSdDmKyeD56wGCyHq12VnF+ZXXsARdTjZWthShoo7gtilDlAFw1RCXvF+z6p/R8kqZzAF0Oj5jjFuJqgFoAkRgxtzr9YmcrJKsugFlylfBgxJGhjJIeFnFuhmi/+bo65ipt8Hn+UhVco7B5SZowAGBKoaZqAGGAVHBUwF8Qq7Y819qe4DEoVyYwrnb8QGN9GCy6QFTuHB9jgGY/gFRtuTu9ZOhr150iwFbwTFiwFus4h9mYt/y+kWZ35vM7hGfccz43Xy/6m3BuS1GiYveqDRfwnbUV4rdu////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAN8ALAAAAAATABIAAAj/AL8JHEiwVTVspar8ITiwiJhswyaBibJJUq9Trxh+S2OAVihvSzqRcoTpmy5ADIPFqrHtGpBETbrIuXJEBgiGbHoogTItExJOoAbw8rHmAkFTC8KYwTWkGx8COp4AozAjD8Epo4wQQfTLCQEcxqigoiONBUFqerRYspYCgzIGmgi98cRlA8EVLaR4UJPk0oASVgKs6kAiBMFDdrzAarDFF5kgCJA9ilNBGMFjWAQse/YjwBcVMfCcgTMr2UBKe0QIaHNgAiQmBRS4+CSKEYSBWe44E6JoEAxZDhrxmDPCEAcaA4vVinTCwi5uKFhBs6EtQ4QEOQYy8+NGUDRiqdCUJJGQa8yNQDsADHyxSNUHE4Vc3erzoFkdWxoAVNLIv7///98EBAA7")}\n${e("canvas",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAADAFBMVEX/AAC1t7etsLCsrq6rrq6rrq2tr6+0tratsK/////p6enIysrl5OTn5uXo5+ajpaXo5+dhhKdliKlmialgg6elp6f6+/vIycnr7Ozw7u7x7u7x7u3t6+vLzMvp7vbs7/bz8PD17+3z7u2rrq/6xS76xy13zv9+z/+EwLF4zP/38/NfgqWAoL36uCj6vCmR2f+TxamSrBmNvoj++fz8+Pf69/WZ3f+g4P+n4/+Cnw2Dox16nQ3//f9hg6eBob6x5/+46f+77P+p2NKSZhOi1s////7//fusrq98sB6CsyWDtSmFuC9+dBl/tilfgqasr6+sr7DbAADcAABcgqWAoLyusLC4urqssLCssLGrsLCrr7Ctr67c3NzMzMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoAAAKAgJldmV0dU8GB3JvTnZDBWVyb2xsYwdjYWxhUBB0bmVrY2F1b3IICGRPYmFyZWQAAAXj1P/Hsf+rjv+Pa/9zSP9XJf9VAP9JANw9ALkxAJYlAHMZAFDU1P+xsf+Ojv9ra/9ISP8lJf8AAP4AANwAALkAAJYAAHMAAFDU4/+xx/+Oq/9rj/9Ic/8lV/8AVf8ASdwAPbkAMZYAJXMAGVDU8P+x4v+O1P9rxv9IuP8lqv8Aqv8AktwAerkAYpYASnMAMlDU//+x//+O//9r//9I//8l//8A/v4A3NwAubkAlpYAc3MAUFDU//Cx/+KO/9Rr/8ZI/7gl/6oA/6oA3JIAuXoAlmIAc0oAUDLU/+Ox/8eO/6tr/49I/3Ml/1cA/1UA3EkAuT0AljEAcyUAUBnU/9Sx/7GO/45r/2tI/0gl/yUA/gAA3AAAuQAAlgAAcwAAUADj/9TH/7Gr/46P/2tz/0hX/yVV/wBJ3AAQ+AFLAAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEgAACxIB0t1+/AAAALpJREFUeNpjYGBkYmZhYWFlYWNngAAOTijg4oYIMHPy8PLx8nDycwpwQwUEhYSFRDhFxTi5xCECEpJS0jKcsqL8nGwgARZOOXkFRSWwMcwgAWVOFVU1dQ1NLW0dmICunr6BoZGxiSlEgJnTzNzC0sraxtYOJmDv4Ojk7MLp6gYRcOf08PTy9vHl9IOa4c+JAGCBAM7AoEDOwEDO4BCIABOSilCQQBhTeERkVGS4f3R0aBhIICYWAWIYGAClIBsa7hXG7gAAAABJRU5ErkJggg==")}\n${e("profile",16,"gif","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsSAAALEgHS3X78AAABZElEQVR42o1R22rCQBD1U/p//apCNtsHwRdfBaFIKbRoUVKMMTWBWIxVCq2b+07POrn4UKjDMpw9O2fm7G5vNBpJKe2/Qto4uEc2WMrBYEBEPaAky36UulwnlSRpUeZEBSGrpEiyHJVGAPVJqZvbO3ftv83Dle+vvPV4/LD0PGYAcKrSFJUsEOgHKoj3s9dFGH9uou3k8ekQKxyDQcYpBnYC7Hm9zBZmlL8BiIJDC0AWpa4FwhZJXoDCBgYAjgU5ToBt+k1tL14ssFNNvIEBAFwVljJlSDBfpwyg1ISnYoEsiHju5XLcd+T50q0tEQm7eaWKKNfUWgKApUsbPFY0lzY6DraEZm585Do/CLMzqLQWQnSC9k34lVa7PTsBs/zYOa4LB5ZlnQXCbif40Ra50jUwE6JtCcMlUiMQlugEQYisG8CWtGlRdQL+jmui/rjhcAhk/Reo6ff7RuB53vN1MZ1OIfgFQC1cuR3Y6lIAAAAASUVORK5CYII=")}\n${e("execute",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEXAwMAAxwCvbOAvAAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEgAACxIB0t1+/AAAACBJREFUCFtjYIABHgYGfiA6wMD/gYH/B5g8ABLhYUAGAHniBNrUPuoHAAAAAElFTkSuQmCC")}\n${e("file",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAQAAAAEABcxq3DAAAA2klEQVRIx61VURbDIAgTX+9ljg4n2z5sNouj1ml+LE9rQkSU5PA6kTZBToTznj5aqKqq+py4lFJKScnMzCwlAAB6IbnNuyXycd1g3oHrf32CmR9mZqpVOdDHs2DmI+c+AiJixu1RAN9xFUcdWCjVIr8xCX8Jubc8Ao9CJF8nRFgNJBxZSCEkjmrIxxSS0yIAoBU4OkpfU8sCPEbEvqaOXcR31zWORbYJ8EI8rsK+DWm7gMVb8F/GK7eg6818jNjJZjMn0agY7x6oxqL5sWbIbhLHoQN78PQ5F3kDgX8u9tphBfoAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMDItMDZUMTA6Mjc6MzErMDE6MDChLu/mAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjIwKzAxOjAwIGvf8wAAAABJRU5ErkJggg==")}\n${e("text",16,"gif","R0lGODlhEgASALMAAP/////MzP+Zmf9mZv8zM/8AAMzM/8zMzJmZ/5mZmWZm/2ZmZjMz/zMzMwAA/////yH5BAUUAA8ALAAAAAASABIAAARo8MlJq73SKGSwdSDjUQoIjhNYOujDnGAnFXRBZKoBIpMw1ICHaaigBAq/AUK1CVEIhcfPNFlRbAEBEvWr0VDYQLYgkCQWh8XiAfgRymPyoTFRa2uPO009maP8ZmsjAHxnBygLDQ1zihEAOw==")}\n${e("task",18,"png","iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAAAAACMfPpKAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAABIAAAASABGyWs+AAAATklEQVQY05XQUQoAIAgD0N3JY3fIChWttKR9xYvBCj0J0FsI3VVKQflwV22J0oyo3LOCc6pHW4dqi56v2CebbpMLtcmr+uTizz6UYpBnADSS8gvhaL5WAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTA0LTA3VDA5OjQyOjQ4KzAyOjAwMgzRmQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOCswMTowMJ0LlncAAAAASUVORK5CYII=")}\n${e("pavetext",18,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAsSURBVBjTY2CgCuBAAt1gASS5KKgARBpJACSEooIsARRbkABYoDsKCRDhEQBA2Am/6OrPewAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNi0wMS0wNFQxMDoxODoyNyswMTowMHsz6UQAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MjArMDE6MDAga9/zAAAAAElFTkSuQmCC")}\n${e("pavelabel",18,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAApSURBVBjTY2CgCuBAAt1gASS5KJgABzUEgABFANUWJAAWYIhCAkR4BAAHoAkEyi2U3wAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNi0wMS0wNFQxMDoxODoyNyswMTowMHsz6UQAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MjArMDE6MDAga9/zAAAAAElFTkSuQmCC")}\n${e("list",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AEECTc01vBgywAAAE9JREFUOMu1k8ERwDAMwqRc9l/Z/eeRpKZlABkOLFD0JQGgAAah5kp8Y30F2HEwDhGTCG6tX5yqtAV/acEdwHQHl0Y8RbA7pLIxRPziGyM9xLEOKSpp/5AAAAAASUVORK5CYII=")}\n${e("color",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAM1BMVEUAAAAA4xcavGZGS1xZT79lW+9wdvFz/3N6fo3RISTZwXbyniXz80v/AAD/zAD/66v//6vGWiYeAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAADswAAA7MAbGhBn4AAAAHdElNRQfgAQQLLBhOmhPcAAAAIklEQVQY02NgRgEMDAzMnLzcfDwC7IxMbKwsQ10A3XMEAQA3JQVNowlkTAAAAABJRU5ErkJggg==")}\n${e("colz",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAMFBMVEV6fo0A4xcavGZGS1xZT79lW+9wdvFz/3PRISTZwXbyniXz80v/AAD/zAD/66v//6t1AkcGAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAADswAAA7MAbGhBn4AAAAHdElNRQfgAQQLNwdqpNWzAAAAT0lEQVQI12NgYGAwNjZmAAOLjmY0hs2ZwxCG1arFEIbt3csQhvXuzRCG/f/PEIZ5eTGEYSgoDGEYKSlDGGZpyRCGaWgwhGHi4gxhwG0HAwCr3BFWzqCkcAAAAABJRU5ErkJggg==")}\n${e("frame",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfgAQQLOwq4oOYCAAAAcUlEQVQoz7WQMQqAMAxFX0Uk4OLgIbp4oZ7BA/cOXR0KDnGpRbGayT+EQF74nw+GHIBo+5hdWdqAaFDoLIsegCSeWE0VcMxXYM6xvmiZSYDTooSR4WlxzzBZwGYBuwWs4mWUpVHJe1H9F1J7yC4ov+kAkTYXFCNzDrEAAAAASUVORK5CYII=")}\n${e("class",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAvQC9AL1pQtWoAAAAjUlEQVR42p2T2wnAIAxFM0g/O6jDdBBHcAyHKKQYjfiI0UY4P8I9BG4CID8smB4+8SUsohpO3CFzKqmBFrhCO4kqQnCR6MJF4BEJTVQFhBAmASNIZkH6a0OMc8oUDAu8z7RhTTBVyIIEhxeCdYWjQApvK2TBrgGpwpP1livsBXC0ROMO/LqDKjKEzaf8AZWbJP6pTT9BAAAATHpUWHRTb2Z0d2FyZQAAeNpz0FDW9MxNTE/1TUzPTM5WMNEz0jNQsLTUNzDWNzBUSC7KLC6pdMitLC7JTNZLLdZLKS3IzyvRS87PBQDzvxJ8u4pLSgAAADN6VFh0U2lnbmF0dXJlAAB42ktKs0hLMkk2MzJKNEuzMLKwtEizSElMMbNITUw0NUtNAQCc7Qma0Goe1QAAAABJRU5ErkJggg==")}\n${e("member",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAvQC9AL1pQtWoAAAAX0lEQVR42mNgAAIVBob/+DADPgBS8GCPBV6M1xCKDcDnBRcoZhgW4D8DBV75v2bLATAmxyC4ZmRMrCFYNfeU9BBvwJwpS8AYWTNZBoAwTDPFBpAciDCDyNFMtXSAFwAAUyq0GRPbbz4AAABMelRYdFNvZnR3YXJlAAB42nPQUNb0zE1MT/VNTM9MzlYw0TPSM1CwtNQ3MNY3MFRILsosLql0yK0sLslM1kst1kspLcjPK9FLzs8FAPO/Eny7iktKAAAAM3pUWHRTaWduYXR1cmUAAHjaS01JNrE0S00zSbU0NEsxMbMwM0xOSjYwNzY3NLRIMjUCAJcdCJ2BHe6SAAAAAElFTkSuQmCC")}\n${e("tf1",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADFBMVEX/////AP8/SMz///+Cf5VqAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfgCw4QHgSCla+2AAAAL0lEQVQI12MQYAACrAQXiFBoABINCgwMQgwcDAwSDEwMDKmhodMYJjAwaKDrAAEAoRAEjHDJ/uQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTYtMTEtMTRUMTc6Mjk6MjErMDE6MDDxcSccAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE2LTExLTE0VDE3OjI5OjA1KzAxOjAwNka8zgAAAABJRU5ErkJggg==")}\n${e("tf2",16,"png","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADFBMVEX/////AP8A/wD////pL6WoAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfgCw4PNgzGaW1jAAAARUlEQVQI12NgEGDQZAASKkBigQKQ6GhgYBDiYgASIiAigIGBS8iBgUFhEpCnoAEkUkNDQxkagUIMrUDMMAVETAARQI0MAD5GCJ7tAr1aAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTExLTE0VDE2OjUxOjUzKzAxOjAwi1Gz3gAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0xMS0xNFQxNjo1MTozNiswMTowMG5bLUIAAAAASUVORK5CYII=")}\n`,t)}(t.node());let e=this,i=[],n=null;if(this.forEachItem((t=>{delete t._d3cont,"_fastcmd"in t&&"Command"==t._kind&&i.push(t),"_status"in t&&!n&&(n=t)})),!this.h||t.empty())return Promise.resolve(this);if(i.length){let n=t.append("div").attr("style","display: inline; vertical-align: middle; white-space: nowrap;");for(let t=0;t<i.length;++t){let r=n.append("button").text("").attr("class","jsroot_fastcmd_btn").attr("item",this.itemFullName(i[t])).attr("title",i[t]._title).on("click",(function(){e.executeCommand(Ii(this).attr("item"),this)}));i[t]._icon&&r.style("background-image",`url("${i[t]._icon}")`)}}let r=t.append("p").attr("class","jsroot").style("margin-bottom","3px").style("margin-top",0);r.append("a").attr("class","h_button").text("open all").attr("title","open all items in the browser").on("click",(()=>this.toggleOpenState(!0))),r.append("text").text(" | "),r.append("a").attr("class","h_button").text("close all").attr("title","close all items in the browser").on("click",(()=>this.toggleOpenState(!1))),"function"==typeof this.removeInspector&&(r.append("text").text(" | "),r.append("a").attr("class","h_button").text("remove").attr("title","remove inspector").on("click",(()=>this.removeInspector()))),"_online"in this.h&&(r.append("text").text(" | "),r.append("a").attr("class","h_button").text("reload").attr("title","reload object list from the server").on("click",(()=>this.reload()))),"disp_kind"in this&&(r.append("text").text(" | "),r.append("a").attr("class","h_button").text("clear").attr("title","clear all drawn objects").on("click",(()=>this.clearHierarchy(!1))));let s=t.append("div").attr("class","jsroot").style("font-size",this.with_icons?"12px":"15px").style("flex","1");if(this.show_overflow||s.style("overflow","auto"),this.background&&s.style("background-color",this.background).style("margin","2px").style("padding","2px"),this.addItemHtml(this.h,s.append("div").attr("class","h_tree")),this.setTopPainter(),n&&!this.status_disabled&&!S().has("nostatus")){let t=C(n._status);if("function"==typeof t)return this.createStatusLine().then((e=>{e&&t(e,this.itemFullName(n))}))}return Promise.resolve(this)}updateTreeNode(t,e){if(void 0===e||e.empty()){e=Ii(t._d3cont?t._d3cont:null);let i=this.itemFullName(t);if(e.empty()&&(e=this.selectDom().select("[item='"+i+"']")),e.empty()&&"_cycle"in t&&(e=this.selectDom().select("[item='"+i+";"+t._cycle+"']")),e.empty())return}this.addItemHtml(t,e,"update"),this.brlayout&&this.brlayout.adjustBrowserSize(!0)}updateBackground(t,e){if(!t||!t._d3cont)return;let i=Ii(t._d3cont);if(i.empty())return;let n=i.select(".h_item");n.style("background",t._background?t._background:null),e&&t._background&&n.node().scrollIntoView(!1)}focusOnItem(t){"string"==typeof t&&(t=this.findItem(t));let e=t?this.itemFullName(t):"";if(!e)return Promise.resolve(!1);let i=t,n=!1;for(;i;)void 0===i._childs||i._isopen||(i._isopen=!0,n=!0),i=i._parent;return(n?this.refreshHtml():Promise.resolve(!0)).then((()=>{let t=this.selectDom().select("[item='"+e+"']");return!t.empty()&&(t.node().scrollIntoView(),!0)}))}tree_click(t,e,i){if(!e)return;let n=Ii(e.parentNode.parentNode),r=n.attr("item"),s=r?this.findItem(r):null;if(!s)return;if(s._break_point){delete s._break_point,this.addItemHtml(s,n,"update");let t=s._parent,e=t._childs.indexOf(s),i=Ii(n.node().parentNode);if(e<0)return console.error("internal error");t._show_limit=2*(t._show_limit||m.HierarchyLimit);for(let n=e+1;n<t._childs.length;++n){let e=t._childs[n];if(e._parent=t,!this.addItemHtml(e,i,n))break}return}let a,o=s;for(;o&&void 0===(a=o._click_action);)o=o._parent;i&&""!=i||(i="item");let l="ROOT.TKey"==s._kind&&s._more?"noinspect":"",h=bb(s._kind,l),c=h.handle;if("icon"==i){let t=null;return"function"==typeof s._icon_click?t=s._icon_click:c&&"function"==typeof c.icon_click&&(t=c.icon_click),void(t&&t(s,this)&&this.updateTreeNode(s,n))}if("item"!=i||!("_expand"in s)||t.ctrlKey||t.shiftKey||(i="plusminus"),"plusminus"==i&&!("_childs"in s)&&s._more||"item"==i&&"expand"===a)return this.expandItem(r,n);if("item"==i){if(s._player)return this.player(r);if(c?.aslink)return window.open(r+"/");if(c?.execute)return this.executeCommand(r,e.parentNode);if(c?.ignore_online&&this.isOnlineItem(s))return;let i=s._can_draw,a=s._more,o="expand"===this.default_by_click,l="";if(t.shiftKey&&(l=c&&c.shift?c.shift:"inspect","inspect"===l&&c&&c.noinspect&&(l="")),c&&c.ctrl&&t.ctrlKey&&(l=c.ctrl),!l)for(let t=s._parent;t;t=t._parent)if(t._painter){i=!1,void 0===a&&(a=!1);break}if(s._childs&&(a=!1),void 0===i&&(i=h.draw),void 0===a&&(a=h.expand||h.get_expand),i&&a&&!l&&(o||"expand"===c?.dflt||this.isItemDisplayed(r))&&(i=!1),i&&!l&&c?.dflt&&"expand"!==c?.dflt&&(l=c.dflt),i)return this.display(r,l);if(a||o)return this.expandItem(r,n);if("string"==typeof s._kind&&0===s._kind.indexOf("ROOT.")&&h.inspect&&!1!==i)return this.display(r,"inspect");if(!s._childs||s===this.h)return}s._isopen?delete s._isopen:s._isopen=!0,this.updateTreeNode(s,n)}tree_mouseover(t,e){let i=Ii(e.parentNode.parentNode).attr("item"),n=this.findItem(i);if(!n)return;let r,s=n;for(;s&&!r;)r=s._painter,s=s._parent;r&&"function"==typeof r.mouseOverHierarchy&&r.mouseOverHierarchy(t,i,n)}direct_contextmenu(t,e){t.preventDefault();let i=Ii(e.parentNode.parentNode).attr("item"),n=this.findItem(i);n&&"function"==typeof this.fill_context&&vv(t,this).then((t=>{this.fill_context(t,n),t.size()>0&&(t.tree_node=e.parentNode,t.show())}))}fillSettingsMenu(t){t.add("sub:Settings"),t.add("sub:Files"),t.addchk(m.OnlyLastCycle,"Last cycle",(t=>{m.OnlyLastCycle=t,this.forEachRootFile((t=>kw(t,t._file.fKeys,t._file,""))),this.refreshHtml()})),t.addchk(!m.SkipStreamerInfos,"Streamer infos",(t=>{m.SkipStreamerInfos=!t,this.forEachRootFile((t=>kw(t,t._file.fKeys,t._file,""))),this.refreshHtml()})),t.addchk(m.UseStamp,"Use stamp arg",(t=>{m.UseStamp=t})),t.addchk(m.HandleWrongHttpResponse,"Handle wrong http response",(t=>{m.HandleWrongHttpResponse=t})),t.add("endsub:"),t.add("sub:Toolbar"),t.addchk(!1===m.ToolBar,"Off",(t=>{m.ToolBar=!t})),t.addchk(!0===m.ToolBar,"On",(t=>{m.ToolBar=t})),t.addchk("popup"===m.ToolBar,"Popup",(t=>{m.ToolBar=!!t&&"popup"})),t.add("separator"),t.addchk("left"==m.ToolBarSide,"Left side",(t=>{m.ToolBarSide=t?"left":"right"})),t.addchk(m.ToolBarVert,"Vertical",(t=>{m.ToolBarVert=t})),t.add("endsub:"),t.add("sub:Interactive"),t.addchk(m.Tooltip,"Tooltip",(t=>{m.Tooltip=t})),t.addchk(m.ContextMenu,"Context menus",(t=>{m.ContextMenu=t})),t.add("sub:Zooming"),t.addchk(m.Zooming,"Global",(t=>{m.Zooming=t})),t.addchk(m.ZoomMouse,"Mouse",(t=>{m.ZoomMouse=t})),t.addchk(m.ZoomWheel,"Wheel",(t=>{m.ZoomWheel=t})),t.addchk(m.ZoomTouch,"Touch",(t=>{m.ZoomTouch=t})),t.add("endsub:"),t.addchk(m.HandleKeys,"Keypress handling",(t=>{m.HandleKeys=t})),t.addchk(m.MoveResize,"Move and resize",(t=>{m.MoveResize=t})),t.addchk(m.DragAndDrop,"Drag and drop",(t=>{m.DragAndDrop=t})),t.addchk(m.DragGraphs,"Drag graph points",(t=>{m.DragGraphs=t})),t.addchk(m.ProgressBox,"Progress box",(t=>{m.ProgressBox=t})),t.add("endsub:"),t.add("sub:Drawing"),t.addSelectMenu("Optimize",["None","Smart","Always"],m.OptimizeDraw,(t=>{m.OptimizeDraw=t})),t.addPaletteMenu(m.Palette,(t=>{m.Palette=t})),t.addchk(m.AutoStat,"Auto stat box",(t=>{m.AutoStat=t})),t.addSelectMenu("Latex",["Off","Symbols","Normal","MathJax","Force MathJax"],m.Latex,(t=>{m.Latex=t})),t.addSelectMenu("3D rendering",["Default","WebGL","Image"],m.Render3D,(t=>{m.Render3D=t})),t.addSelectMenu("WebGL embeding",["Default","Overlay","Embed"],m.Embed3D,(t=>{m.Embed3D=t})),t.add("endsub:"),t.add("sub:Geometry"),t.add("Grad per segment:  "+m.GeoGradPerSegm,(()=>t.input("Grad per segment in geometry",m.GeoGradPerSegm,"int",1,60).then((t=>{m.GeoGradPerSegm=t})))),t.addchk(m.GeoCompressComp,"Compress composites",(t=>{m.GeoCompressComp=t})),t.add("endsub:"),t.add("Hierarchy limit:  "+m.HierarchyLimit,(()=>t.input("Max number of items in hierarchy",m.HierarchyLimit,"int",10,1e5).then((t=>{m.HierarchyLimit=t})))),t.add("separator"),t.add("Save settings",(()=>{(Pw(!0)?Promise.resolve(!0):t.confirm("Save settings","Pressing OK one agreess that JSROOT will store settings as browser cookies")).then((t=>{t&&Cw()}))})),t.add("Delete settings",(()=>Cw(-1))),t.add("endsub:")}tree_contextmenu(e,i){e.preventDefault();let n=Ii(i.parentNode.parentNode).attr("item"),r=this.findItem(n);if(!r)return;let s=this.getOnlineProp(n),a=this.getFileProp(n);return vv(e,this).then((e=>{if(n&&r._parent||"_jsonfile"in r)if(s)this.fillOnlineMenu(e,s,n);else{let i=bb(r._kind,"nosame");if(r._can_draw&&(i.opts||(i.opts=[""]),i.opts.indexOf("")<0&&i.opts.unshift("")),i.opts&&e.addDrawMenu("Draw",i.opts,(t=>this.display(n,t))),a&&i.opts&&!a.localfile){let n=function(t){const e=document.createElement("div");return e.innerHTML='<a href="'+t.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")+'">x</a>',e.firstChild.href}(a.fileurl);if(0==n.indexOf(t.source_dir)&&(n=n.slice(t.source_dir.length)),n=a.kind+"="+n,a.itemname.length>0){let t=a.itemname;t.search(/\+| |\,/)>=0&&(t="'"+t+"'"),n+="&item="+t}e.addDrawMenu("Draw in new tab",i.opts,(e=>window.open(t.source_dir+"index.htm?nobrowser&"+n+"&opt="+e)))}!i.expand&&!i.get_expand||"_childs"in r||!r._more&&"_more"in r||e.add("Expand",(()=>this.expandItem(n))),"ROOT.TStyle"===r._kind&&e.add("Apply",(()=>this.applyStyle(n)))}else{let i=[],n="",r=0,s=()=>r++>0?"&":"?";this.forEachRootFile((t=>i.push(t._file.fFullURL))),this.getTopOnlineItem()||(n=t.source_dir+"index.htm"),this.isMonitoring()&&(n+=s()+"monitoring="+this.getMonitoringInterval()),1==i.length?n+=s()+"file="+i[0]:i.length>1&&(n+=s()+"files="+JSON.stringify(i)),this.disp_kind&&(n+=s()+"layout="+this.disp_kind.replace(/ /g,""));let a=[],o=[];this.disp&&this.disp.forEachFrame((t=>{let e,i=new Vl(t),n=i.getTopPainter(),r=n?n.getItemName():null;r?e=n.getDrawOpt()||n.getItemDrawOpt():(n=null,i.forEachPainter((t=>{let i=t.getItemName();if(!i)return;let s=t.getDrawOpt()||t.getItemDrawOpt()||"";n?n.getPadPainter()===t.getPadPainter()&&(0==s.indexOf("same ")&&(s=s.slice(5)),r+="+"+i,e+="+"+s):(n=t,r=i,e=s)}))),r&&(a.push(r),o.push(e||""))})),1==a.length?n+=s()+"item="+a[0]+s()+"opt="+o[0]:a.length>1&&(n+=s()+"items="+JSON.stringify(a)+s()+"opts="+JSON.stringify(o)),e.add("Direct link",(()=>window.open(n))),e.add("Only items",(()=>window.open(n+"&nobrowser"))),this.fillSettingsMenu(e)}"function"==typeof r._menu&&r._menu(e,r,this),e.size()>0&&(e.tree_node=i.parentNode,e.separ&&e.add("separator"),e.add("Close"),e.show())})),!1}async player(t,e){let i=this.findItem(t);if(!i||!i._player||"string"!=typeof i._player)return null;let n=null;if(i._module){let t=await this.importModule(i._module);n=t?t[i._player]:null}else(i._prereq||i._player.indexOf("JSROOT.")>=0)&&await this.loadScripts("",i._prereq),n=C(i._player);return"function"!=typeof n?null:(await this.createDisplay(),n(this,t,e))}canDisplay(t,e){if(!t)return!1;if(t._player)return!0;if(void 0!==t._can_draw)return t._can_draw;if("inspect"==e)return!0;return vb(Ab(t._kind,e))}isItemDisplayed(t){let e=this.getDisplay();return!!e&&null!==e.findFrame(t)}display(t,e){let i=this,n=null,r=!1,s=null,a=t,o=t,l="::_display_on_frame_::",h=e?e.indexOf(l):-1;function c(o,l){return l&&console.log("When display ",t,"got",l),r&&s&&delete s._doing_update,r||lv(),o&&"object"==typeof o&&"function"==typeof o.setItemName&&(o.setItemName(a,r?null:e,i),s&&!s._painter&&(s._painter=o)),o||n}return h>=0&&(o=e.slice(h+l.length),e=e.slice(0,h)),i.createDisplay().then((t=>{if(!t)return c();if(s=i.findItem(a),s&&"_player"in s)return i.player(a,e).then((t=>c(t)));if(r="string"==typeof e&&0==e.indexOf("update:"),r){if(e=e.slice(7),!s||s._doing_update)return c();s._doing_update=!0}if(s&&!i.canDisplay(s,e))return c();let l="",h=!1;if("string"==typeof e&&e.indexOf("divid:")>=0){let t=e.indexOf("divid:");l=e.slice(t+6),e=e.slice(0,t)}return"__default_draw_option__"==e&&(h=!0,e=""),r||lv("Loading "+a),i.getObject(a,e).then((i=>{r||lv(),s||(s=i.item);let d=i.obj;if(!d)return c();r||lv("Drawing "+a);let u=d._typename?Ab("ROOT."+d._typename):null;if(u&&u.draw_field&&d[u.draw_field]&&(d=d[u.draw_field],e||(e=u.draw_field_opt||""),u=d._typename?Ab("ROOT."+d._typename):null),h&&u&&u.dflt&&!e&&"expand"!=u.dflt&&(e=u.dflt),l.length>0){return(r?Mb:wb)(l,d,e).then((t=>c(t))).catch((t=>c(null,t)))}if(t.forEachPainter(((t,i)=>{t.getItemName()==a&&(!r&&e&&t.getItemDrawOpt()!=e||"function"==typeof t.redrawObject&&t.redrawObject(d,e)&&(n=t))})),n)return c();if(r)return console.warn(`something went wrong - did not found painter when doing update of ${a}`),c();let f=t.findFrame(o,!0);return Ii(f).html(""),t.activateFrame(f),wb(f,d,e).then((t=>c(t))).catch((t=>c(null,t)))}))}))}enableDrag(t){t.attr("draggable","true").on("dragstart",(function(t){let e=this.parentNode.parentNode.getAttribute("item");t.dataTransfer.setData("item",e)}))}enableDrop(t){let e=this;Ii(t).on("dragover",(function(t){let i=t.dataTransfer.getData("item"),n=e.findItem(i);n&&"string"==typeof n._kind&&0==n._kind.indexOf("ROOT.")&&t.preventDefault()})).on("dragenter",(function(){Ii(this).classed("jsroot_drag_area",!0)})).on("dragleave",(function(){Ii(this).classed("jsroot_drag_area",!1)})).on("drop",(function(t){Ii(this).classed("jsroot_drag_area",!1);let i=t.dataTransfer.getData("item");i&&e.dropItem(i,this.getAttribute("id"))}))}clearDrop(t){Ii(t).on("dragover",null).on("dragenter",null).on("dragleave",null).on("drop",null)}dropItem(t,e,i){i&&"function"==typeof i&&(call_back=i,i=""),void 0===i&&(i="");let n=(e,i)=>(e&&!i&&"object"==typeof e&&"function"==typeof e.setItemName&&e.setItemName(t,null,this),e);return"$legend"==t?Wv(e,i).then((t=>n(t))):this.getObject(t).then((r=>{if(!r.obj)return null;let s=Wl(e);return s&&"function"==typeof s.performDrop?s.performDrop(r.obj,t,r.item,i).then((t=>n(t,s===t))):s&&s.accept_drops?wb(e,r.obj,"same "+i).then((t=>n(t,s===t))):(this.cleanupFrame(e),wb(e,r.obj,i).then((t=>n(t))))}))}updateItems(t){if(!this.disp)return Promise.resolve(!1);let e=[],i=[],n=!1,r=!1;return"string"==typeof t?t=[t]:"object"!=typeof t&&(void 0===t&&(t=!this.isMonitoring()),r=!0,n=!!t),this.disp.forEachPainter((s=>{let a=s.getItemName();if(!("string"!=typeof a||e.indexOf(a)>=0)){if(r){let t=this.findItem(a);if(!t||"_not_monitor"in t||"_player"in t)return;if(!("_always_monitor"in t)){let e=!1,i=Ab(t._kind);if(i&&"monitor"in i){if(!1===i.monitor||"never"==i.monitor)return;"always"==i.monitor&&(e=!0)}if(!e&&n)return}}else if(t.indexOf(a)<0)return;e.push(a),i.push("update:"+s.getItemDrawOpt())}}),!0),this.files_monitoring&&!n&&r&&this.forEachRootFile((t=>{this.forEachItem((t=>{delete t._readobj}),t),delete t._file})),this.displayItems(e,i)}displayItems(t,e){if(!t||0==t.length)return Promise.resolve(!0);let i=this;for(e||(e=[]);e.length<t.length;)e.push("__default_draw_option__");if(1==e.length&&"iotest"==e[0]){this.clearHierarchy(),Ii("#"+this.disp_frameid).html("<h2>Start I/O test</h2>");let e=new Date;return this.getObject(t[0]).then((()=>{let i=new Date;return Ii("#"+this.disp_frameid).append("h2").html("Item "+t[0]+" reading time = "+(i.getTime()-e.getTime())+"ms"),Promise.resolve(!0)}))}let n=new Array(t.length),r=new Array(t.length),s=new Array(t.length);for(let a=0;a<t.length;++a){n[a]=r[a]=null;let o=t[a],l=!0;if(o&&0==o.indexOf("img:")){s[a]=!0;continue}o&&o.length>1&&"'"==o[0]&&"'"==o[o.length-1]&&(t[a]=o.slice(1,o.length-1),l=!1);let h=i.findItem({name:t[a],check_keys:!0});if(h){t[a]=i.itemFullName(h);continue}if(l&&"["==t[a][0]&&"]"==t[a][t[a].length-1]?(n[a]=Lw(t[a]),t[a]=n[a].shift()):l&&t[a].indexOf("+")>0&&(n[a]=t[a].split("+"),t[a]=n[a].shift()),n[a]&&n[a].length>0){for(let e=0;e<n[a].length;++e){let r=n[a][e].indexOf("_same_");r>0&&null===i.findItem(n[a][e])&&(n[a][e]=n[a][e].slice(0,r)+t[a].slice(r)),h=i.findItem({name:n[a][e],check_keys:!0}),h&&(n[a][e]=i.itemFullName(h))}for("["==e[a][0]&&"]"==e[a][e[a].length-1]?(r[a]=Lw(e[a]),e[a]=r[a].shift()):e[a].indexOf("+")>0?(r[a]=e[a].split("+"),e[a]=r[a].shift()):r[a]=[];r[a].length<n[a].length;)r[a].push("")}let c=t[a].indexOf("_same_");c>0&&!i.findItem(t[a])&&a>0&&(t[a]=t[a].slice(0,c)+t[0].slice(c)),h=i.findItem({name:t[a],check_keys:!0}),h&&(t[a]=i.itemFullName(h))}for(let r=t.length-1;r>=0;--r){if(s[r])continue;let a=i.findItem(t[r]);a&&!i.canDisplay(a,e[r])&&(i.expandItem(t[r],null,!0),t.splice(r,1),e.splice(r,1),n.splice(r,1))}if(0==t.length)return Promise.resolve(!0);let a=new Array(t.length),o=new Array(t.length);for(let i=0;i<t.length;++i){o[i]=0;let n=t[i],r=0;t.indexOf(n)<i&&(o[i]=!0);let s=e[i].indexOf("frameid:");if(s>=0)n=e[i].slice(s+8),e[i]=e[i].slice(0,s);else for(;a.indexOf(n)>=0;)n=t[i]+"_"+r++;a[i]=n}for(let i=0;i<t.length;++i){if(0!==o[i])continue;let n=i;for(let r=0;r<t.length;++r)t[i]===t[r]&&e[r].indexOf("main")>=0&&(n=r);for(let e=0;e<t.length;++e)t[i]===t[e]&&(o[e]=n!=e)}return this.createDisplay().then((s=>{if(!s)return!1;for(let i=0;i<t.length;++i)0!==e[i].indexOf("update:")&&(s.createFrame(a[i]),e[i]+="::_display_on_frame_::"+a[i]);function l(s,a){if(a&&n[s]&&n[s].length>0)return i.dropItem(n[s].shift(),a.getDom(),r[s].shift()).then((()=>l(s,a)));n[s]=null,t[s]=null;for(let n=0;n<t.length;++n)if(null!==t[n]&&o[n]&&t.indexOf(t[n])===n)return o[n]=!1,i.display(t[n],e[n]).then((t=>l(n,t)))}let h=[];for(let n=0;n<t.length;++n)o[n]||h.push(i.display(t[n],e[n]).then((t=>l(n,t))));return Promise.all(h)}))}reload(){return"_online"in this.h?this.openOnline(this.h._online).then((()=>this.refreshHtml())):Promise.resolve(!1)}activateItems(t,e){"string"==typeof t&&(t=[t]);let i=[],n=[];this.forEachItem((t=>{t._background&&(i.push(t),delete t._background)}));let r=()=>{for(let t=n.length-1;t>=0;--t)this.updateTreeNode(n[t]);for(let t=0;t<i.length;++t)this.updateBackground(i[t],e)},s=(a,o)=>{if(void 0===a){if(0==t.length)return r();a=t.shift()}let l=this.findItem(a);if(!l){let t=this.findItem({name:a,last_exists:!0,check_keys:!0,allow_index:!0});if(!t||!t.last)return s();if(t.now_found=this.itemFullName(t.last),e)return void 0!==o&&t.now_found===o?s():this.expandItem(t.now_found).then((e=>{if(!e)return s();let i=this.itemFullName(t.last);i.length>0&&(i+="/"),s(i+t.rest,t.now_found)}));l=t.last}if(l){let t=l._parent;for(;t;){if(!t._isopen){if(!e){l=t;break}t._isopen=!0,n.indexOf(t)<0&&n.push(t)}t=t._parent}l._background="LightSteelBlue",i.indexOf(l)<0&&i.push(l)}s()};if(e&&this.brlayout){if(!this.brlayout.browser_kind)return this.createBrowser("float",!0).then((()=>s()));this.brlayout.browser_visible||this.brlayout.toggleBrowserVisisbility()}s()}canExpandItem(t){if(!t)return!1;if(t._expand)return!0;let e=Ab(t._kind,"::expand");return e&&Sw(e)}expandItem(t,e,i){let n=this.findItem(t),r=this;if(!n&&e)return Promise.resolve();async function a(t,n){if("string"==typeof t._expand&&(t._expand=C(item._expand)),"function"!=typeof t._expand){let e=Ab(t._kind,"::expand");if(e&&e.expand_item&&(e=(n=n[e.expand_item])&&n._typename?Ab("ROOT."+n._typename,"::expand"):null),e&&(e.expand||e.get_expand))if("function"==typeof e.expand)t._expand=e.expand;else if("string"==typeof e.expand){if(!s.ignore_v6){let t=await U();await t.require(e.prereq),await t._complete_loading()}t._expand=e.expand=C(e.expand)}else"function"==typeof e.get_expand&&(t._expand=e.expand=await e.get_expand())}return n&&t&&"function"==typeof t._expand&&t._expand(t,n)||n&&Dw(t,n)?(t._isopen=!0,t._parent&&!t._parent._isopen?(t._parent._isopen=!0,i||r.updateTreeNode(t._parent)):i||r.updateTreeNode(t,e),t):-1}let o=Promise.resolve(-1);if(n){if(!1===n._more||!n._parent&&n._childs)return Promise.resolve();if(n._childs&&n._isopen)return n._isopen=!1,i||this.updateTreeNode(n,e),Promise.resolve();n._obj&&(o=a(n,n._obj))}return o.then((e=>-1!==e?e:(lv("Loading "+t),this.getObject(t,i?"hierarchy_expand":"hierarchy_expand_verbose").then((t=>{if(lv(),t.obj)return a(t.item,t.obj).then((t=>-1!==t?t:void 0))})))))}getTopOnlineItem(t){if(t){for(;t&&!("_online"in t);)t=t._parent;return t}return this.h?"_online"in this.h?this.h:this.h._childs&&"_online"in this.h._childs[0]?this.h._childs[0]:null:null}forEachJsonFile(t){if(this.h){if("_jsonfile"in this.h)return t(this.h);if(this.h._childs)for(let e=0;e<this.h._childs.length;++e){let i=this.h._childs[e];"_jsonfile"in i&&t(i)}}}openJsonFile(t){let e=!1;return this.forEachJsonFile((i=>{i._jsonfile==t&&(e=!0)})),e?Promise.resolve():E(t,"object").then((e=>{let i={_jsonfile:t,_kind:"ROOT."+e._typename,_jsontmp:e,_name:t.split("/").pop()};if(e.fTitle&&(i._title=e.fTitle),i._get=function(t){return t._jsontmp?Promise.resolve(t._jsontmp):E(t._jsonfile,"object").then((e=>(t._jsontmp=e,e)))},this.h)if("TopFolder"==this.h._kind)this.h._childs.push(i);else{let t=this.h,e="_jsonfile"in t?"Files":"Items";this.h={_name:e,_kind:"TopFolder",_childs:[t,i]}}else this.h=i;return this.refreshHtml()}))}forEachRootFile(t){if(this.h){if("ROOT.TFile"==this.h._kind&&this.h._file)return t(this.h);if(this.h._childs)for(let e=0;e<this.h._childs.length;++e){let i=this.h._childs[e];"ROOT.TFile"==i._kind&&"_fullurl"in i&&t(i)}}}openRootFile(t){let e=!1;return this.forEachRootFile((i=>{i._fullurl===t&&(e=!0)})),e?Promise.resolve():(lv("Opening "+t+" ..."),Tw(t).then((t=>{let e=this.fileHierarchy(t);if(e._isopen=!0,this.h)if("TopFolder"==this.h._kind)this.h._childs.push(e);else{let t=this.h,i="ROOT.TFile"==t._kind?"Files":"Items";this.h={_name:i,_kind:"TopFolder",_childs:[t,e],_isopen:!0}}else this.h=e,this._topname&&(e._name=this._topname);return this.refreshHtml()})).catch((()=>(l()?console.error(`Fail to open ${t} - check CORS headers`):Ii("#gui_fileCORS").style("background","red").empty()||setTimeout((()=>Ii("#gui_fileCORS").style("background","")),5e3),!1))).finally((()=>lv())))}applyStyle(t){if(!t)return Promise.resolve(!0);let e=Promise.resolve(t);if("string"==typeof t){let i=this.findItem({name:t,allow_index:!0,check_keys:!0});null!==i?e=this.getObject(i).then((t=>t.obj)):t.indexOf(".json")>0&&(e=E(t,"object"))}return e.then((t=>{t&&"object"==typeof t&&"TStyle"===t._typename&&Object.assign(p,t)}))}getFileProp(t){let e=this.findItem(t);if(!e)return null;let i=e._name;for(;e._parent;){if(e=e._parent,"_file"in e)return{kind:"file",fileurl:e._file.fURL,itemname:i,localfile:!!e._file.fLocalFile};if("_jsonfile"in e)return{kind:"json",fileurl:e._jsonfile,itemname:i};i=e._name+"/"+i}return null}getOnlineItemUrl(t){"string"==typeof t&&(t=this.findItem(t));let e=t;for(;e&&void 0===e._online;)e=e._parent;return e?e._online+this.itemFullName(t,e):null}isOnlineItem(t){return null!==this.getOnlineItemUrl(t)}importModule(t){switch(t){case"core":return Promise.resolve().then((function(){return G}));case"draw_tree":return Promise.resolve().then((function(){return rS}));case"hierarchy":return Promise.resolve({HierarchyPainter:Iw,markAsStreamerInfo:Ow})}return import(t)}async getOnlineItem(t,e,i){let n=e,r=!1,s="",a="object",o=null;if("string"==typeof i&&0==i.indexOf("hierarchy_expand")&&(r=!0,i=void 0),t){n=this.getOnlineItemUrl(t);let e=null;if("_kind"in t&&(o=Ab(t._kind)),r)s="h.json?compact=3",t._expand=Bw;else if(t._make_request)if(t._module){e=(await this.importModule(t._module))[t._make_request]}else e=C(t._make_request);else o&&o.make_request&&(e=o.make_request);if("function"==typeof e){let r=e(this,t,n,i);r&&("string"==typeof r?s=r:("req"in r&&(s=r.req),"kind"in r&&(a=r.kind)))}0==s.length&&0!=t._kind.indexOf("ROOT.")&&(s="item.json.gz?compact=3")}if(!e&&t&&"_cached_draw_object"in this&&0==s.length){let t=this._cached_draw_object;return delete this._cached_draw_object,Promise.resolve(t)}return 0==s.length&&(s="root.json.gz?compact=23"),n.length>0&&(n+="/"),n+=s,new Promise((e=>{let s=P(n,a,(n=>{let a=r=>{if("function"==typeof r){let e=r(this,t,n,i,s);e&&"object"==typeof e&&(n=e)}e(n)};!r&&t?._after_request?t._module?this.importModule(t._module).then((e=>a(e[t._after_request]))):a(C(t._after_request)):a(o?.after_request)}));s.send(null)}))}openOnline(t){let e=e=>{if(this.h=e,!e)return Promise.resolve(null);"_title"in this.h&&""!=this.h._title&&(document.title=this.h._title),e._isopen=!0,this.h._online=t,this.h._get=(t,e,i)=>this.getOnlineItem(t,e,i),this.h._expand=Bw;let i=[],n=[],r=[],s=[];return this.forEachItem((t=>{if(void 0!==t._childs&&(t._expand=Bw),t._autoload){t._autoload.split(";").forEach((t=>{t.length>4&&t.lastIndexOf(".mjs")==t.length-4?s.push(this.importModule(t)):t.length>3&&t.lastIndexOf(".js")==t.length-3?n.find((e=>e==t))||n.push(t):t.length>4&&t.lastIndexOf(".css")==t.length-4?i.find((e=>e==t))||i.push(t):t&&!r.find((e=>e==t))&&r.push(t)}))}})),this.loadScripts(n,r).then((()=>x(i))).then((()=>Promise.all(s))).then((()=>(this.forEachItem((t=>{if(!("_drawfunc"in t)||!("_kind"in t))return;let e="kind:"+t._kind;0==t._kind.indexOf("ROOT.")&&(e=t._kind.slice(5));let i=t._drawopt;vb(e)&&!i||yb({name:e,func:t._drawfunc,script:t._drawscript,opt:i})})),this)))};if(t||(t=""),"object"==typeof t){let i=t;return t="",e(i)}return E(t+"h.json?compact=3","object").then((t=>e(t)))}getOnlineProp(t){let e=this.findItem(t);if(!e)return null;let i=e._name;for(;e._parent;){if(e=e._parent,"_online"in e)return{server:e._online,itemname:i};i=e._name+"/"+i}return null}fillOnlineMenu(t,e,i){let n=this.findItem(i),r=bb(n._kind,"nosame;noinspect"),s=Ab(n._kind),a="string"==typeof n._kind&&0==n._kind.indexOf("ROOT.");r.opts&&!1!==n._can_draw&&(r.opts.push("inspect"),t.addDrawMenu("Draw",r.opts,(t=>this.display(i,t)))),!n._childs&&!1!==n._more&&(n._more||a||r.expand||r.get_expand)&&t.add("Expand",(()=>this.expandItem(i))),s&&"execute"in s&&t.add("Execute",(()=>this.executeCommand(i,t.tree_node))),r.opts&&!1!==n._can_draw&&t.addDrawMenu("Draw in new window",r.opts,(t=>window.open(e.server+"?nobrowser&item="+e.itemname+(this.isMonitoring()?"&monitoring="+this.getMonitoringInterval():"")+(t?"&opt="+t:"")))),r.opts&&r.opts.length>0&&a&&!1!==n._can_draw&&t.addDrawMenu("Draw as png",r.opts,(t=>window.open(e.server+e.itemname+"/root.png?w=600&h=400"+(t?"&opt="+t:"")))),"_player"in n&&t.add("Player",(()=>this.player(i)))}setHierarchy(t){this.h=t,this.refreshHtml()}setMonitoring(t,e){this._runMonitoring("cleanup"),t&&(t=parseInt(t),Number.isInteger(t)&&t>0?(this._monitoring_interval=Math.max(100,t),e=!0):this._monitoring_interval=3e3),this._monitoring_on=e,this.isMonitoring()&&this._runMonitoring()}_runMonitoring(t){return"cleanup"!=t&&this.isMonitoring()?"frame"==t?(delete this._monitoring_handle,void(this._monitoring_frame=requestAnimationFrame(this._runMonitoring.bind(this,"draw")))):("draw"==t&&(delete this._monitoring_frame,this.updateItems()),void(this._monitoring_handle=setTimeout(this._runMonitoring.bind(this,"frame"),this.getMonitoringInterval()))):(this._monitoring_handle&&(clearTimeout(this._monitoring_handle),delete this._monitoring_handle),void(this._monitoring_frame&&(cancelAnimationFrame(this._monitoring_frame),delete this._monitoring_frame)))}getMonitoringInterval(){return this._monitoring_interval||3e3}isMonitoring(){return this._monitoring_on}setDisplay(t,e){e||"object"!=typeof t?(this.disp_kind=t,this.disp_frameid=e):(this.disp=t,this.disp_kind="custom",this.disp_frameid=null),this.register_resize||"batch"==this.disp_kind||(this.register_resize=!0,fv(this))}getLayout(){return this.disp_kind}removePainter(t){this.forEachItem((e=>{e._painter===t&&(delete e._painter,"function"==typeof e.clear&&e.clear())}))}clearHierarchy(t){this.disp&&(this.disp.cleanup(),delete this.disp);let e=[];this.forEachItem((i=>{delete i._painter,t||"function"!=typeof i.clear||i.clear(),t&&e.push(i)})),t&&(this.enableMonitoring(!1),this.selectDom().html(""),e.forEach((t=>{delete t._parent,delete t._childs,delete t._obj,delete t._d3cont})),delete this.h)}getDisplay(){return this.disp}cleanupFrame(t){Ii(t).attr("frame_title",null),this.clearDrop(t);let e=th(t);e.length>0&&this.forEachItem((t=>{t._painter&&e.indexOf(t._painter)>=0&&delete t._painter}))}createDisplay(){if("disp"in this){if(this.disp.numDraw()>0||"custom"==this.disp_kind)return Promise.resolve(this.disp);this.disp.cleanup(),delete this.disp}if("batch"==this.disp_kind){return(c()?cl():Promise.resolve(null)).then((t=>(this.disp=new Dv(1200,800,t?.body),this.disp)))}return document.getElementById(this.disp_frameid)?(0==this.disp_kind.indexOf("flex")||"tabs"==this.disp_kind||0==this.disp_kind.indexOf("coll")?this.disp=new kv(this.disp_frameid):this.disp=new Ev(this.disp_frameid,this.disp_kind),this.disp.cleanupFrame=this.cleanupFrame.bind(this),m.DragAndDrop&&this.disp.setInitFrame(this.enableDrop.bind(this)),Promise.resolve(this.disp)):Promise.resolve(null)}createCustomDisplay(t,e){if("simple"!=this.disp_kind)return this.createDisplay();if(this.disp_kind=e,this.disp){let e=this.disp.numDraw();if(e>1||1==e&&!this.disp.findFrame(t))return this.createDisplay();this.disp.cleanup(),delete this.disp}return this.createDisplay()}updateOnOtherFrames(t,e){let i=this.disp,n=!1;if(!i)return!1;let r=e._typename?Ab("ROOT."+e._typename):null;return r&&r.draw_field&&e[r.draw_field]&&(e=e[r.draw_field]),i.forEachPainter(((i,r)=>{i!==t&&i.getItemName()==t.getItemName()&&"function"==typeof i.redrawObject&&i.redrawObject(e)&&(n=!0)})),n}checkResize(t){this.disp&&this.disp.checkMDIResize(null,t)}loadScripts(t,e){return t?.length||e?.length?s.ignore_v6?x(t):U().then((i=>i.require(e).then((()=>x(t))).then((()=>i._complete_loading())))):Promise.resolve(!0)}startGUI(t,e){let i=S(e),n=e=>{let n=i.get(e,null);return null===n&&t&&!t.empty()&&t.node().hasAttribute(e)&&(n=t.attr(e)),n},r=e=>{let n=(t=>{let e=[];for(;t.length>0;){let n=t.indexOf(";"),r=n>0?t.slice(0,n):t;t=n>0?t.slice(n+1):"";let s=!0;"#"==r[0]&&(r=r.slice(1),s=!1);let a=i.get(r,null);s?e=e.concat(Lw(a)):null!==a&&e.push(a)}return e})(e);if(n.length>0||!t||t.empty())return n;for(;e.length>0;){let i=e.indexOf(";"),r=i>0?e.slice(0,i):e;e=i>0?e.slice(i+1):"";let s=!0;if("#"==r[0]&&(r=r.slice(1),s=!1),"files"===r)continue;if(!t.node().hasAttribute(r))continue;let a=t.attr(r);s?n=n.concat(Lw(a)):null!==a&&n.push(a)}return n},a=n("prereq")||"",o=i.get("path")||"",l=r("#file;files"),h=n("localfile"),c=r("#json;jsons"),d=r("expand"),u=n("focus"),f=r("#item;items"),m=r("#opt;opts"),p=n("monitoring"),g=n("layout"),_=r("#style"),x=0,y=n("status"),A=n("browser"),v=!!A,b=n("title");p=null===p?0:""===p?3e3:parseInt(p),null!==n("float")?(A="float",v=!0):null!==n("fix")&&(A="fix",v=!0),this.no_select=n("noselect"),null!==n("files_monitoring")&&(this.files_monitoring=!0),b&&(document.title=b);let w=n("load");if(0==d.length&&""===n("expand")&&d.push(""),o){for(let t=0;t<l.length;++t)l[t]=o+l[t];for(let t=0;t<c.length;++t)c[t]=o+c[t]}if(0==f.length&&""===n("item")&&f.push(""),1==c.length&&0==f.length&&0==d.length&&f.push(""),!this.disp_kind)if("string"==typeof g&&g.length>0)this.disp_kind=g;else switch(f.length){case 0:case 1:this.disp_kind="simple";break;case 2:this.disp_kind="vert2";break;case 3:this.disp_kind="vert21";break;case 4:this.disp_kind="vert22";break;case 5:this.disp_kind="vert32";break;case 6:this.disp_kind="vert222";break;case 7:this.disp_kind="vert322";break;case 8:this.disp_kind="vert332";break;case 9:this.disp_kind="vert333";break;default:this.disp_kind="flex"}"no"===y?y=null:"off"===y?(this.status_disabled=!0,y=null):"on"===y?y=!0:null!==y&&(x=parseInt(y),(!Number.isInteger(x)||x<5)&&(x=0),y=!0),""===this.no_select&&(this.no_select=!0),A?"no"===A?A="":"off"===A&&(A="",y=null,this.exclude_browser=!0):A="fix",null!==n("nofloat")&&(this.float_browser_disabled=!0),this.start_without_browser&&(A=""),this._topname=n("topname");let M=()=>{let t;if(w||a)t=this.loadScripts(w,a),w="",a="";else if(A)t=this.createBrowser(A),A="";else if(null!==y)t=this.createStatusLine(x,y),y=null;else if(c.length>0)t=this.openJsonFile(c.shift());else if(l.length>0)t=this.openRootFile(l.shift());else if(null!==h&&"function"==typeof this.selectLocalFile)h=null,t=this.selectLocalFile();else if(d.length>0)t=this.expandItem(d.shift());else{if(!(_.length>0))return this.refreshHtml().then((()=>this.displayItems(f,m))).then((()=>u?this.focusOnItem(u):this)).then((()=>(this.setMonitoring(p),f?this.refreshHtml():this)));t=this.applyStyle(_.shift())}return t.then(M)},T=null;if(this.is_online){let t=s.getCachedHierarchy||C("GetCachedHierarchy");"function"==typeof t&&(T=t()),"object"!=typeof T&&(T=""),"draw"!=this.is_online||f.length||f.push("")}return null!==T?this.openOnline(T).then((()=>(this.exclude_browser||v||!("_browser"in this.h)||(A=this.h._browser,"no"===A?A="":"off"===A&&(A="",y=null,this.exclude_browser=!0)),"_monitoring"in this.h&&!p&&(p=this.h._monitoring),"_loadfile"in this.h&&0==l.length&&(l=Lw(this.h._loadfile)),"_drawitem"in this.h&&0==f.length&&(f=Lw(this.h._drawitem),m=Lw(this.h._drawopt)),"_layout"in this.h&&!g&&("draw"!=this.is_online||f.length>1)&&(this.disp_kind=this.h._layout),"_toptitle"in this.h&&this.exclude_browser&&document&&(document.title=this.h._toptitle),t&&this.prepareGuiDiv(t.attr("id"),this.disp_kind),M()))):(t&&this.prepareGuiDiv(t.attr("id"),this.disp_kind),M())}prepareGuiDiv(t,e){if(this.gui_div="string"==typeof t?t:t.attr("id"),this.brlayout=new zv(this.gui_div,this),this.brlayout.create(!this.exclude_browser),!this.exclude_browser){let t=this.brlayout.createBrowserBtns();uv.createSVG(t,uv.diamand,15,"toggle fix-pos browser").style("margin","3px").on("click",(()=>this.createBrowser("fix",!0))),this.float_browser_disabled||uv.createSVG(t,uv.circle,15,"toggle float browser").style("margin","3px").on("click",(()=>this.createBrowser("float",!0))),this.status_disabled||uv.createSVG(t,uv.three_circles,15,"toggle status line").style("margin","3px").on("click",(()=>this.createStatusLine(0,"toggle")))}this.setDisplay(e,this.brlayout.drawing_divid())}createStatusLine(t,e){return!this.status_disabled&&this.gui_div&&this.brlayout?this.brlayout.createStatusLine(t,e):Promise.resolve("")}redrawObject(t){return!(!this._inspector&&!this._streamer_info)&&(this._streamer_info?this.h=zw(t):this.h=Rw(t),this.refreshHtml().then((()=>{this.setTopPainter()})))}createBrowser(t,e){if(!this.gui_div||this.exclude_browser||!this.brlayout)return Promise.resolve(!1);let i=Ii("#"+this.gui_div+" .jsroot_browser");if(i.empty())return Promise.resolve(!1);if("float"===t&&this.float_browser_disabled&&(t="fix"),!i.select(".jsroot_browser_area").empty())return e&&this.brlayout.toggleKind(t),Promise.resolve(!0);let r=`<p class="jsroot_browser_version"><a href="https://root.cern/js/">JSROOT</a> version <span style="color:green"><b>${n}</b></span></p>`;if(this.is_online)r+='<p> Hierarchy in <a href="h.json">json</a> and <a href="h.xml">xml</a> format</p><div style="display:inline; vertical-align:middle; white-space: nowrap;"><label style="margin-right:5px"><input type="checkbox" name="monitoring" class="gui_monitoring"/>Monitoring</label>';else if(this.no_select)"file"==this.no_select&&(r+='<div style="display:flex;flex-direction:row">');else{let t=Ii("#"+this.gui_div),e=t.attr("files")||"../files/hsimple.root",i=S().get("path")||t.attr("path")||"",n=e.split(";");r+='<input type="text" value="" style="width:95%; margin:5px;border:2px;" class="gui_urlToLoad" title="input file name"/><div style="display:flex;flex-direction:row;padding-top:5px"><select class="gui_selectFileName" style="flex:1;padding:2px;" title="select file name"<option value="" selected="selected"></option>',n.forEach((t=>{r+=`<option value="${i+t}">${t}</option>`})),r+='</select><input type="file" class="gui_localFile" accept=".root" style="display:none"/><output id="list" style="display:none"></output><input type="button" value="..." class="gui_fileBtn" style="min-width:3em;padding:3px;margin-left:5px;margin-right:5px;" title="select local file for reading"/><br/></div><p id="gui_fileCORS"><small><a href="https://github.com/root-project/jsroot/blob/master/docs/JSROOT.md#reading-root-files-from-other-servers">Read docu</a> how to open files from other servers.</small></p><div style="display:flex;flex-direction:row"><input style="padding:3px;margin-right:5px" class="gui_ReadFileBtn" type="button" title="Read the Selected File" value="Load"/><input style="padding:3px;margin-right:5px" class="gui_ResetUIBtn" type="button" title="Close all opened files and clear drawings" value="Reset"/>'}!this.is_online&&this.no_select&&"file"!=this.no_select||(r+='<select style="padding:2px;margin-right:5px;" title="layout kind" class="gui_layout"></select></div>'),r+=`<div id="${this.gui_div}_browser_hierarchy" class="jsroot_browser_hierarchy"></div>`,this.brlayout.setBrowserContent(r),this.is_online?this.brlayout.setBrowserTitle("ROOT online server"):this.brlayout.setBrowserTitle("Read a ROOT file");let s=null;this.is_online||this.no_select||(this.readSelectedFile=function(){let t=i.select(".gui_urlToLoad").property("value").trim();t&&(t.toLowerCase().lastIndexOf(".json")==t.length-5?this.openJsonFile(t):this.openRootFile(t))},i.select(".gui_selectFileName").property("value","").on("change",(t=>i.select(".gui_urlToLoad").property("value",t.target.value))),i.select(".gui_fileBtn").on("click",(()=>i.select(".gui_localFile").node().click())),i.select(".gui_ReadFileBtn").on("click",(()=>this.readSelectedFile())),i.select(".gui_ResetUIBtn").on("click",(()=>this.clearHierarchy(!0))),i.select(".gui_urlToLoad").on("keyup",(t=>{13==t.keyCode&&this.readSelectedFile()})),i.select(".gui_localFile").on("change",(t=>{let e=t.target.files,n=[];for(let t=0;t<e.length;++t){let r=e[t];i.select(".gui_urlToLoad").property("value",r.name),n.push(this.openRootFile(r))}Promise.all(n).then((()=>{s&&(s(),s=null)}))})),this.selectLocalFile=function(){return new Promise((t=>{s=t,i.select(".gui_localFile").node().click()}))});let a=i.select(".gui_layout");return a.empty()||(["simple","vert2","vert3","vert231","horiz2","horiz32","flex","grid 2x2","grid 1x3","grid 2x3","grid 3x3","grid 4x4"].forEach((t=>a.append("option").attr("value",t).html(t))),a.on("change",(t=>this.setDisplay(t.target.value||"flex",this.gui_div+"_drawing")))),this.setDom(this.gui_div+"_browser_hierarchy"),e&&(this.refreshHtml(),this.initializeBrowser()),this.brlayout.toggleBrowserKind(t||"fix")}initializeBrowser(){let t=Ii("#"+this.gui_div+" .jsroot_browser");if(t.empty()||!this.brlayout)return;this.brlayout&&this.brlayout.adjustBrowserSize();let e=t.select(".gui_layout").node();if(e){let t=!1;for(let i in e.options){let n=e.options[i].text;if("string"==typeof n&&(n==this.getLayout()||n.replace(/ /g,"")==this.getLayout())){e.selectedIndex=i,t=!0;break}}if(!t){let t=document.createElement("option");t.innerHTML=t.value=this.getLayout(),e.appendChild(t),e.selectedIndex=e.options.length-1}}if(this.is_online)this.h&&this.h._toptitle&&this.brlayout.setBrowserTitle(this.h._toptitle),t.select(".gui_monitoring").property("checked",this.isMonitoring()).on("click",(t=>{this.enableMonitoring(t.target.checked),this.updateItems()}));else if(!this.no_select){let e="";this.forEachRootFile((t=>{e||(e=t._fullurl)})),t.select(".gui_urlToLoad").property("value",e)}}enableMonitoring(t){this.setMonitoring(void 0,t);let e=Ii("#"+this.gui_div+" .jsroot_browser .gui_monitoring");e.empty()||e.property("checked")===t||e.property("checked",t)}}function jw(t,e){th(t);let i=new Iw("inspector",t,"white");return l()?(i.selectDom().property("_json_object_",e),Promise.resolve(i)):(i.default_by_click="expand",i.with_icons=!1,i._inspector=!0,i.selectDom().classed("jsroot_inspector")&&(i.removeInspector=function(){this.selectDom().remove()}),i.fill_context=function(t,e){let i=bb(e._kind,"nosame");i.opts&&t.addDrawMenu("nosub:Draw",i.opts,(function(t){if(!e||!e._obj)return;let i=e._obj,n=this.selectDom().node();if(this.removeInspector&&(n=n.parentNode,this.removeInspector(),"inspect"==t))return this.showInspector(i);th(n),wb(n,i,t)}))},i.h=Rw(e),i.refreshHtml().then((()=>(i.setTopPainter(),i))))}Vl.prototype.showInspector=function(t){if("check"===t)return!0;let e=this.selectDom(),i=il(e),n=Math.round(.05*i.width)+"px",r=Math.round(.05*i.height)+"px",a="root_inspector_"+s.id_counter++;return e.append("div").attr("id",a).attr("class","jsroot_inspector").style("position","absolute").style("top",r).style("bottom",r).style("left",n).style("right",n),t&&"object"==typeof t&&t._typename||(t=this.getObject()),jw(a,t)},s.drawInspector=jw;var qw=Object.freeze({__proto__:null,getHPainter:Fw,HierarchyPainter:Iw,drawInspector:jw,drawStreamerInfo:function(t,e){let i=new Iw("sinfo",t,"white");return l()?(i.selectDom().property("_json_object_",e),Promise.resolve(i)):(i._streamer_info=!0,i.h=zw(e),i.refreshHtml().then((()=>(i.setTopPainter(),i))))},drawList:function(t,e,i){if(!e||!e.arr)return Promise.resolve(null);let n={divid:t,lst:e,opt:i,indx:-1,painter:null,draw_next:function(){for(;++this.indx<this.lst.arr.length;){let t=this.lst.arr[this.indx],e=this.lst.opt&&this.lst.opt[this.indx]?this.lst.opt[this.indx]:this.opt;if(t)return wb(this.getDom(),t,e).then((t=>(t&&!this.painter&&(this.painter=t),this.draw_next())))}return Promise.resolve(this.painter)}};return n.draw_next()},markAsStreamerInfo:Ow,readSettings:Pw,folderHierarchy:function(t,e){if(!e||!("fFolders"in e)||null===e.fFolders)return!1;if(0===e.fFolders.arr.length)return t._more=!1,!0;t._childs=[];for(let i=0;i<e.fFolders.arr.length;++i){let n=e.fFolders.arr[i];t._childs.push({_name:n.fName,_kind:"ROOT."+n._typename,_obj:n})}return!0},taskHierarchy:function(t,e){if(!e||!("fTasks"in e)||null===e.fTasks)return!1;if(Dw(t,e,{exclude:["fTasks","fName"]}),0===e.fTasks.arr.length&&0==t._childs.length)return t._more=!1,!0;for(let i=0;i<e.fTasks.arr.length;++i){let n=e.fTasks.arr[i];t._childs.push({_name:n.fName,_kind:"ROOT."+n._typename,_obj:n})}return!0},listHierarchy:Ew,objectHierarchy:Dw,keysHierarchy:kw});function Uw(t){Pw();let e=S(t);if(e.has("optimize")){m.OptimizeDraw=2;let t=e.get("optimize");t&&(t=parseInt(t),Number.isInteger(t)&&(m.OptimizeDraw=t))}if(e.has("lastcycle")){let t=e.get("lastcycle");m.OnlyLastCycle="0"!=t&&"false"!=t}let i=e.get("usestamp");m.UseStamp="0"!=i&&"false"!=i,e.has("wrong_http_response")&&(m.HandleWrongHttpResponse=!0);let n=e.get("interactive");if("nomenu"===n)m.ContextMenu=!1;else if(void 0!==n){if(n&&"1"!=n?"0"==n&&(n="000000"):n="111111",6===n.length){switch(n[0]){case"0":m.ToolBar=!1;break;case"1":m.ToolBar="popup";break;case"2":m.ToolBar=!0}n=n.slice(1)}5==n.length&&(m.Tooltip=parseInt(n[0]),m.ContextMenu="0"!=n[1],m.Zooming="0"!=n[2],m.MoveResize="0"!=n[3],m.DragAndDrop="0"!=n[4])}let r=e.get("tooltip");"off"==r||"false"==r||"0"==r?m.Tooltip=!1:e.has("tooltip")&&(m.Tooltip=!0),(e.has("bootstrap")||e.has("bs"))&&(m.Bootstrap=!0);let s=e.get("mathjax",null),a=e.get("latex",null);null!==s&&"0"!=s&&null===a&&(a="math"),null!==a&&(m.Latex=f.Latex.fromString(a)),e.has("nomenu")&&(m.ContextMenu=!1),e.has("noprogress")&&(m.ProgressBox=!1),e.has("notouch")&&(browser.touches=!1),e.has("adjframe")&&(m.CanAdjustFrame=!0);let o=e.get("optstat"),l=e.get("optfit");if(o&&(p.fOptStat=parseInt(o)),l&&(p.fOptFit=parseInt(l)),p.fStatFormat=e.get("statfmt",p.fStatFormat),p.fFitFormat=e.get("fitfmt",p.fFitFormat),e.has("toolbar")){let t=e.get("toolbar",""),i=null;t.indexOf("popup")>=0&&(i="popup"),t.indexOf("left")>=0&&(m.ToolBarSide="left",i="popup"),t.indexOf("right")>=0&&(m.ToolBarSide="right",i="popup"),t.indexOf("vert")>=0&&(m.ToolBarVert=!0,i="popup"),t.indexOf("show")>=0&&(i=!0),m.ToolBar=i||t.indexOf("0")<0&&t.indexOf("false")<0&&t.indexOf("off")<0}if((e.has("skipsi")||e.has("skipstreamerinfos"))&&(m.SkipStreamerInfos=!0),e.has("nodraggraphs")&&(m.DragGraphs=!1),e.has("palette")){let t=parseInt(e.get("palette"));Number.isInteger(t)&&t>0&&t<113&&(m.Palette=t)}let h=e.get("render3d"),c=e.get("embed3d"),d=e.get("geosegm"),u=e.get("geocomp");h&&(m.Render3D=f.Render3D.fromString(h)),c&&(m.Embed3D=f.Embed3D.fromString(c)),d&&(m.GeoGradPerSegm=Math.max(2,parseInt(d))),u&&(m.GeoCompressComp="0"!==u&&"false"!==u&&"off"!==u),e.has("hlimit")&&(m.HierarchyLimit=parseInt(e.get("hlimit")))}var Gw=Object.freeze({__proto__:null,default:{}});function Hw(t,e){let i=new Vl(t,e);return i.redraw=function(){const t=y(14),e=this.getObject(),i=new Hl(e),n=e.TestBit(t);return this.createG(),this.draw_g.append("svg:path").attr("d",`M${this.axisToSvg("x",e.fX1,n)},${this.axisToSvg("y",e.fY1,n)}L${this.axisToSvg("x",e.fX2,n)},${this.axisToSvg("y",e.fY2,n)}`).call(i.func),this},Vv(i,!1).then((()=>i.redraw()))}var Xw=Object.freeze({__proto__:null,drawText:function(){let t=this.getObject(),e=this.getPadPainter(),i=e.getPadWidth(),n=e.getPadHeight(),r=t.fX,s=t.fY,a=this.getColor(t.fTextColor),o=!1,h=1,c=t.fTextSize||.05,d=this.getFramePainter();t.TestBit(y(14))?this.isndc=!0:d&&!d.mode3d?(i=d.getFrameWidth(),n=d.getFrameHeight(),o="upper_layer"):e.getRootPad(!0)||(this.isndc=!0,r=s=.5,t.fTextAlign=22,a||(a="black")),this.createG(o),this.draw_g.attr("transform",null),this.pos_x=this.axisToSvg("x",r,this.isndc),this.pos_y=this.axisToSvg("y",s,this.isndc);let u={align:t.fTextAlign,x:this.pos_x,y:this.pos_y,text:t.fTitle,color:a,latex:0};return t.fTextAngle&&(u.rotate=-t.fTextAngle),"TLatex"==t._typename?(u.latex=1,h=.9):"TMathText"==t._typename&&(u.latex=2,h=.8),this.startTextDrawing(t.fTextFont,Math.round(c>1?c:c*Math.min(i,n)*h)),this.drawText(u),this.finishTextDrawing().then((()=>(l()||(this.pos_dx=this.pos_dy=0,this.moveDrag||(this.moveDrag=function(t,e){this.pos_dx+=t,this.pos_dy+=e,this.draw_g.attr("transform",`translate(${this.pos_dx},${this.pos_dy})`)}),this.moveEnd||(this.moveEnd=function(t){if(t)return;let e=this.getObject();e.fX=this.svgToAxis("x",this.pos_x+this.pos_dx,this.isndc),e.fY=this.svgToAxis("y",this.pos_y+this.pos_dy,this.isndc),this.submitCanvExec(`SetX(${e.fX});;SetY(${e.fY});;`)}),pv(this)),this)))},drawTLine:Hw,drawPolyLine:function(){this.createG();let t=this.getObject(),e=new Hl(t),i=this.createAttFill(t),n=y(14),r=t.TestBit(n),s="",a=this.getAxisToSvgFunc(r);for(let e=0;e<=t.fLastPoint;++e)s+=(e>0?"L":"M")+a.x(t.fX[e])+","+a.y(t.fY[e]);"TPolyLine"!=t._typename&&i.setSolidColor("none"),i.empty()||(s+="Z"),this.draw_g.append("svg:path").attr("d",s).call(e.func).call(i.func)},drawEllipse:function(){let t=this.getObject();this.createAttLine({attr:t}),this.createAttFill({attr:t}),this.createG();let e=this.getAxisToSvgFunc(),i=e.x(t.fX1),n=e.y(t.fY1),r=e.x(t.fX1+t.fR1)-i,s=n-e.y(t.fY1+t.fR2),a="",o=0==t.fPhimin&&360==t.fPhimax;if("TCrown"==t._typename&&t.fR1<=0&&(r=e.x(t.fX1+t.fR2)-i),"TCrown"==t._typename&&t.fR1>0){let l=r,h=s,c=n-e.y(t.fY1+t.fR1),d=e.x(t.fX1+t.fR2)-i;if(o)a=`M${-l},0A${l},${c},0,1,0,${l},0A${l},${c},0,1,0,${-l},0M${-d},0A${d},${h},0,1,0,${d},0A${d},${h},0,1,0,${-d},0`;else{let e=t.fPhimax-t.fPhimin>=180?1:0,i=t.fPhimin*Math.PI/180,n=t.fPhimax*Math.PI/180,r=Math.round(l*Math.cos(i)),s=Math.round(c*Math.sin(i));a=`M${Math.round(l*Math.cos(n))},${Math.round(c*Math.sin(n))}A${l},${c},0,${e},0,${r},${s}L${Math.round(d*Math.cos(i))},${Math.round(h*Math.sin(i))}A${d},${h},0,${e},1,${Math.round(d*Math.cos(n))},${Math.round(h*Math.sin(n))}Z`}}else if(0==t.fTheta)if(o)a=`M${-r},0A${r},${s},0,1,0,${r},0A${r},${s},0,1,0,${-r},0Z`;else{a=`M0,0L${Math.round(r*Math.cos(t.fPhimin*Math.PI/180))},${Math.round(s*Math.sin(t.fPhimin*Math.PI/180))}A${r},${s},0,1,1,${Math.round(r*Math.cos(t.fPhimax*Math.PI/180))},${Math.round(s*Math.sin(t.fPhimax*Math.PI/180))}Z`}else{let r=Math.cos(t.fTheta*Math.PI/180),s=Math.sin(t.fTheta*Math.PI/180),l=t.fPhimin*Math.PI/180,h=200,c=(t.fPhimax*Math.PI/180-l)/(h-(o?0:1)),d=0,u=0;o||(a="M0,0");for(let o=0;o<h;++o){let h=l+o*c,f=t.fR1*Math.cos(h),m=t.fR2*Math.sin(h),p=e.x(t.fX1+f*r-m*s)-i,g=e.y(t.fY1+f*s+m*r)-n;a?a+=d==p?"v"+(g-u):u==g?"h"+(p-d):`l${p-d},${g-u}`:a=`M${p},${g}`,d=p,u=g}a+="Z"}this.draw_g.append("svg:path").attr("transform",`translate(${i},${n})`).attr("d",a).call(this.lineatt.func).call(this.fillatt.func)},drawPie:function(){let t=this.getObject();this.createG();let e=this.axisToSvg("x",t.fX),i=this.axisToSvg("y",t.fY),n=this.axisToSvg("x",t.fX+t.fRadius)-e,r=this.axisToSvg("y",t.fY+t.fRadius)-i;this.draw_g.attr("transform",`translate(${e},${i})`);let s=t.fPieSlices.length,a=0,o=t.fAngularOffset*Math.PI/180,l=Math.round(n*Math.cos(o)),h=Math.round(r*Math.sin(o));for(let e=0;e<s;e++)a+=t.fPieSlices[e].fValue;for(let e=0;e<s;e++){let i=t.fPieSlices[e],s=new Hl({attr:i}),c=this.createAttFill(i);o+=i.fValue/a*2*Math.PI;let d=Math.round(n*Math.cos(o)),u=Math.round(r*Math.sin(o));this.draw_g.append("svg:path").attr("d",`M0,0L${l},${h}A${n},${r},0,0,0,${d},${u}z`).call(s.func).call(c.func),l=d,h=u}},drawBox:function(){let t=this.getObject(),e=this.getDrawOpt().toUpperCase().indexOf("L")>=0,i=this.createAttLine(t),n=this.createAttFill(t);this.createG();let r=this.axisToSvg("x",t.fX1),s=this.axisToSvg("x",t.fX2),a=this.axisToSvg("y",t.fY1),o=this.axisToSvg("y",t.fY2),l=Math.min(r,s),h=Math.min(a,o),c=Math.abs(s-r),d=Math.abs(a-o);if(n.empty()||e||(i.color="none"),this.draw_g.append("svg:path").attr("d",`M${l},${h}h${c}v${d}h${-c}z`).call(i.func).call(n.func),t.fBorderMode&&t.fBorderSize&&n.hasColor()){let e=t.fBorderSize,i=t.fBorderSize,r=`M${l},${h}h${c}l${-e},${i}h${2*e-c}v${d-2*i}l${-e},${i}z`,s=`M${l+c},${h+d}v${-d}l${-e},${i}v${d-2*i}h${2*e-c}l${-e},${i}z`;if(t.fBorderMode<0){let t=r;r=s,s=t}this.draw_g.append("svg:path").attr("d",r).call(n.func).style("fill",ut(n.color).brighter(.5).formatHex()),this.draw_g.append("svg:path").attr("d",s).call(n.func).style("fill",ut(n.color).darker(.5).formatHex())}},drawMarker:function(){let t=this.getObject(),e=new ql(t),i=y(14),n=t.TestBit(i);this.createG();let r=this.axisToSvg("x",t.fX,n),s=this.axisToSvg("y",t.fY,n),a=e.create(r,s);a&&this.draw_g.append("svg:path").attr("d",a).call(e.func)},drawPolyMarker:function(){this.createG();let t=this.getObject(),e=new ql(t),i="",n=this.getAxisToSvgFunc();for(let r=0;r<t.fN;++r)i+=e.create(n.x(t.fX[r]),n.y(t.fY[r]));i&&this.draw_g.append("svg:path").attr("d",i).call(e.func)},drawJSImage:function(t,e,i){let n=new hl(t),r=n.selectDom(),s=r.append("img").attr("src",e.fName).attr("title",e.fTitle||e.fName);return i&&i.indexOf("scale")>=0?s.style("width","100%").style("height","100%"):i&&i.indexOf("center")>=0&&(r.style("position","relative"),s.attr("style","margin: 0; position: absolute;  top: 50%; left: 50%; transform: translate(-50%, -50%);")),n.setTopPainter(),n}});class Vw extends Vl{constructor(t,e,i){super(t,e,i),this.firstpainter=null,this.painters=[]}cleanup(){let t=this.getPadPainter();t&&t.cleanPrimitives((t=>t===this.firstpainter||this.painters.indexOf(t)>=0)),delete this.firstpainter,delete this.painters,super.cleanup()}buildStack(t){if(!t.fHists)return!1;let e=t.fHists.arr.length;if(e<=0)return!1;let i=k("TList");i.Add(A(t.fHists.arr[0]),t.fHists.opt[0]);for(let n=1;n<e;++n){let e=A(t.fHists.arr[n]),r=t.fHists.opt[n],s=i.arr[n-1];if(e.fNbins!=s.fNbins||e.fXaxis.fXmin!=s.fXaxis.fXmin||e.fXaxis.fXmax!=s.fXaxis.fXmax)return console.warn(`When drawing THStack, cannot sum-up histograms ${e.fName} and ${s.fName}`),i.Clear(),!1;for(let t=0;t<e.fArray.length;++t)e.fArray[t]+=s.fArray[t];i.Add(e,r)}return t.fStack=i,!0}getMinMax(t){let e={min:0,max:0},i=this.getObject(),n=this.getPadPainter().getRootPad(!0);const r=(t,e)=>{let i={min:0,max:0},n=!0,r=!0;if(-1111!==t.fMinimum&&(i.min=t.fMinimum,n=!1),-1111!==t.fMaximum&&(i.max=t.fMaximum,r=!1),!n&&!r)return i;let s=1,a=t.fXaxis.fNbins,o=1,l=1,h=!0;t.fXaxis.TestBit(Py.kAxisRange)&&(s=t.fXaxis.fFirst,a=t.fXaxis.fLast),0===t._typename.indexOf("TH2")&&(l=t.fYaxis.fNbins,t.fYaxis.TestBit(Py.kAxisRange)&&(o=t.fYaxis.fFirst,l=t.fYaxis.fLast));for(let c=o;c<=l;++c)for(let o=s;o<=a;++o){let s=t.getBinContent(o,c),a=e?t.getBinError(t.getBin(o,c)):0;n&&(h||s-a<i.min)&&(i.min=s-a),r&&(h||s+a>i.max)&&(i.max=s+a),h=!1}return i};if(this.options.nostack)for(let n=0;n<i.fHists.arr.length;++n){let s=r(i.fHists.arr[n],t);0==n?e=s:(e.min=Math.min(e.min,s.min),e.max=Math.max(e.max,s.max))}else e.min=r(i.fStack.arr[0],t).min,e.max=r(i.fStack.arr[i.fStack.arr.length-1],t).max;if(-1111!=i.fMaximum&&(e.max=i.fMaximum),e.max*=1.05,-1111!=i.fMinimum&&(e.min=i.fMinimum),n&&(1==this.options.ndim?n.fLogy:n.fLogz)){e.max<=0&&(e.max=1),e.min<=0&&(e.min=1e-4*e.max);let t=1/(1+.5*Math.log10(e.max/e.min)),i=1+.2*Math.log10(e.max/e.min);e.min*=t,e.max*=i}else e.min>0&&e.min<.05*e.max&&(e.min=0);return e}drawNextHisto(t,e){let i=this.getObject(),n=this.options.nostack?i.fHists:i.fStack,r=n&&n.arr?n.arr.length:0;if(t>=r)return Promise.resolve(this);let s=this.options.horder?t:r-t-1,a=n.arr[s],o=n.opt[s]||a.fOption||this.options.hopt;if(o.toUpperCase().indexOf(this.options.hopt)<0&&(o+=" "+this.options.hopt),this.options.draw_errors&&!o&&(o="E"),this.options._pfc||this.options._plc||this.options._pmc){let t=this.getMainPainter();if(t&&t.createAutoColor){let e=t.createAutoColor(r);this.options._pfc&&(a.fFillColor=e),this.options._plc&&(a.fLineColor=e),this.options._pmc&&(a.fMarkerColor=e)}}if(e){let i=e.getSubPadPainter(t+1);if(!i)return Promise.resolve(this);let n=i.selectCurrentPad(i.this_pad_name);return this.hdraw_func(i.getDom(),a,o).then((r=>(this.painters.push(r),i.selectCurrentPad(n),this.drawNextHisto(t+1,e))))}return s>0&&!this.options.nostack&&(a.$baseh=n.arr[s-1]),this.hdraw_func(this.getDom(),a,o+" same nostat").then((i=>(this.painters.push(i),this.drawNextHisto(t+1,e))))}decodeOptions(t){this.options||(this.options={}),Object.assign(this.options,{ndim:1,nostack:!1,same:!1,horder:!0,has_errors:!1,draw_errors:!1,hopt:""});let e=this.getObject(),i=e.fHistogram||(e.fHists?e.fHists.arr[0]:null)||(e.fStack?e.fStack.arr[0]:null);const n=t=>{if(t.fSumw2&&t.fSumw2.length>0)for(let e=0;e<t.fSumw2.length;++e)if(t.fSumw2[e]>0)return!0;return!1};if(i&&0==i._typename.indexOf("TH2")&&(this.options.ndim=2),2!=this.options.ndim||t||(t="lego1"),e.fHists&&!this.options.nostack)for(let t=0;t<e.fHists.arr.length;++t)this.options.has_errors=this.options.has_errors||n(e.fHists.arr[t]);this.options.nhist=e.fHists?e.fHists.arr.length:1;let r=new sl(t);this.options.nostack=r.check("NOSTACK"),r.check("STACK")&&(this.options.nostack=!1),this.options.same=r.check("SAME"),r.check("NOCLEAR"),this.options._pfc=r.check("PFC"),this.options._plc=r.check("PLC"),this.options._pmc=r.check("PMC"),this.options.pads=r.check("PADS"),this.options.pads&&(this.options.nostack=!0),this.options.hopt=r.remain();let s=r.check("LEGO");this.options.errors=r.check("E"),!this.options.nostack&&this.options.has_errors&&!s&&!r.check("HIST")&&this.options.hopt.indexOf("E")<0&&(this.options.draw_errors=!0),this.options.horder=this.options.nostack||s}createHistogram(t){let e=t.fHists,i=e?e.arr.length:0;if(!i){let e=D("TH1I",100);return e.fTitle=t.fTitle,e}let n=e.arr[0],r=D(1==this.options.ndim?"TH1I":"TH2I",n.fXaxis.fNbins,n.fYaxis.fNbins);r.fName="axis_hist",Object.assign(r.fXaxis,n.fXaxis),2==this.options.ndim&&Object.assign(r.fYaxis,n.fYaxis);for(let t=1;t<i;++t){let i=e.arr[t];r.fXaxis.fLabels||(r.fXaxis.fXmin=Math.min(r.fXaxis.fXmin,i.fXaxis.fXmin),r.fXaxis.fXmax=Math.max(r.fXaxis.fXmax,i.fXaxis.fXmax)),2!=this.options.ndim||r.fYaxis.fLabels||(r.fYaxis.fXmin=Math.min(r.fYaxis.fXmin,i.fYaxis.fXmin),r.fYaxis.fXmax=Math.max(r.fYaxis.fXmax,i.fYaxis.fXmax))}return r.fTitle=t.fTitle,r}updateObject(t){if(!this.matchObjectType(t))return!1;let e=this.getObject();if(e.fHists=t.fHists,e.fStack=t.fStack,e.fTitle=t.fTitle,this.options.nostack||(this.options.nostack=!this.buildStack(e)),this.firstpainter){let i=t.fHistogram;i||(i=e.fHistogram=this.createHistogram(e)),this.firstpainter.updateObject(i);let n=this.getMinMax(this.options.errors||this.options.draw_errors);this.firstpainter.options.minimum=n.min,this.firstpainter.options.maximum=n.max,1==this.options.ndim&&(this.firstpainter.ymin=n.min,this.firstpainter.ymax=n.max)}let i=this.options.nostack?e.fHists:e.fStack,n=i&&i.arr?i.arr.length:0;if(n!==this.painters.length){let t=this.getPadPainter();t&&t.cleanPrimitives((t=>this.painters.indexOf(t)>=0)),this.painters=[],this.did_update=!0}else for(let t=0;t<n;++t){let e=this.options.horder?t:n-t-1,r=i.arr[e];this.painters[t].updateObject(r)}return!0}redraw(){if(this.did_update)return delete this.did_update,this.drawNextHisto(0,this.options.pads?this.getPadPainter():null)}static draw(t,e,i){if(!e.fHists||!e.fHists.arr)return null;let n=new Vw(t,e,i),r=null,s=!1;return Vv(n,!1).then((()=>{if(n.decodeOptions(i),n.hdraw_func=1==n.options.ndim?hb.draw:ub.draw,n.options.pads)return r=n.getPadPainter(),r.doingDraw()&&r.pad&&r.pad.fPrimitives&&r.pad.fPrimitives.arr.length>1&&0==r.pad.fPrimitives.arr.indexOf(e)?(s=!0,void console.log("special case with THStack with is already rendered - do nothing")):(r.cleanPrimitives((t=>t!==n)),r.divide(n.options.nhist));if(n.options.nostack||(n.options.nostack=!n.buildStack(e)),n.options.same)return;e.fHistogram||(e.fHistogram=n.createHistogram(e));let a=n.getMinMax(n.options.errors||n.options.draw_errors),o=n.options.hopt+" axis";return a&&(o+=";minimum:"+a.min+";maximum:"+a.max),n.hdraw_func(t,e.fHistogram,o).then((t=>{n.firstpainter=t}))})).then((()=>s?n:n.drawNextHisto(0,r)))}}var Yw=Object.freeze({__proto__:null,THStackPainter:Vw});const $w=1e-5;class Ww{constructor(t,e,i,n,r,s){this.x=t,this.y=e,this.z=i,this.nx=n,this.ny=r,this.nz=s}setnormal(t,e,i){this.nx=t,this.ny=e,this.nz=i}clone(){return new Ww(this.x,this.y,this.z,this.nx,this.ny,this.nz)}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}cross(t){let e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=t,this.y/=t,this.z/=t,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}diff(t){let e=this.x-t.x,i=this.y-t.y,n=this.z-t.z,r=this.x*this.x+this.y*this.y+this.z*this.z;return(e*e+i*i+n*n)/(r>0?r:1e-10)}interpolate(t,e){let i=1-e;return new Ww(this.x*i+t.x*e,this.y*i+t.y*e,this.z*i+t.z*e,this.nx*i+t.nx*e,this.ny*i+t.ny*e,this.nz*i+t.nz*e)}applyMatrix4(t){let e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14],e=this.nx,i=this.ny,n=this.nz,this.nx=r[0]*e+r[4]*i+r[8]*n,this.ny=r[1]*e+r[5]*i+r[9]*n,this.nz=r[2]*e+r[6]*i+r[10]*n,this}}class Zw{constructor(t){this.vertices=t||[],this.nsign=1,this.vertices.length>0&&this.calculateProperties()}copyProperties(t,e){return this.normal=t.normal,this.w=t.w,this.nsign=t.nsign,e&&void 0!==t.id&&(this.id=t.id,this.parent=t),this}calculateProperties(){if(this.normal)return;let t=this.vertices[0],e=this.vertices[1],i=this.vertices[2];return this.nsign=1,this.normal=e.clone().subtract(t).cross(i.clone().subtract(t)).normalize(),this.w=this.normal.clone().dot(t),this}clone(){let t=this.vertices.length,e=new Zw;for(let i=0;i<t;++i)e.vertices.push(this.vertices[i].clone());return e.copyProperties(this)}flip(){return this.nsign*=-1,this.vertices.reverse(),this}classifyVertex(t){let e=this.nsign*(this.normal.dot(t)-this.w);return e<-1e-5?2:e>$w?1:0}classifySide(t){let e,i,n=0,r=0,s=t.vertices.length;for(e=0;e<s;++e)i=this.classifyVertex(t.vertices[e]),1===i?++n:2===i&&++r;return n>0&&0===r?1:0===n&&r>0?2:0===n&&0===r?0:3}splitPolygon(t,e,i,n,r){let s=this.classifySide(t);if(0===s)(this.nsign*t.nsign*this.normal.dot(t.normal)>0?e:i).push(t);else if(1===s)n.push(t);else if(2===s)r.push(t);else{let e,i,s,a,o,l,h,c,d=t.vertices.length,u=this.normal.x,f=this.normal.y,m=this.normal.z,p=[],g=[];for(e=0;e<d;++e)i=(e+1)%d,o=t.vertices[e],l=t.vertices[i],s=this.classifyVertex(o),a=this.classifyVertex(l),2!=s&&p.push(o),1!=s&&g.push(o),3==(s|a)&&(h=(this.w-(u*o.x+f*o.y+m*o.z))/(u*(l.x-o.x)+f*(l.y-o.y)+m*(l.z-o.z)),c=o.interpolate(l,h),p.push(c),g.push(c));p.length>=3&&n.push(new Zw(p).copyProperties(t,!0)),g.length>=3&&r.push(new Zw(g).copyProperties(t,!0))}}}class Qw{constructor(t,e){if(this.polygons=[],this.front=this.back=void 0,!t)return;this.divider=t[0].clone();let i=t.length,n=[],r=[];for(let s=0;s<i;++s)void 0!==e&&(t[s].id=e++,delete t[s].parent),this.divider.splitPolygon(t[s],this.polygons,this.polygons,n,r);void 0!==e&&(this.maxnodeid=e),n.length>0&&(this.front=new Qw(n)),r.length>0&&(this.back=new Qw(r))}isConvex(t){let e,i,n=t.length;for(e=0;e<n;++e)for(i=0;i<n;++i)if(e!==i&&2!==t[e].classifySide(t[i]))return!1;return!0}build(t){let e=t.length,i=[],n=[];this.divider||(this.divider=t[0].clone());for(let r=0;r<e;++r)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,n);i.length>0&&(this.front||(this.front=new Qw),this.front.build(i)),n.length>0&&(this.back||(this.back=new Qw),this.back.build(n))}collectPolygons(t){let e=this.polygons.length;for(let i=0;i<e;++i)t.push(this.polygons[i]);return this.front&&this.front.collectPolygons(t),this.back&&this.back.collectPolygons(t),t}allPolygons(){let t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t}numPolygons(){let t=this.polygons.length;return this.front&&(t+=this.front.numPolygons()),this.back&&(t+=this.back.numPolygons()),t}clone(){let t=new Qw;return t.divider=this.divider.clone(),t.polygons=this.polygons.map((function(t){return t.clone()})),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t}invert(){let t=this.polygons.length;for(let e=0;e<t;++e)this.polygons[e].flip();this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();let e=this.front;return this.front=this.back,this.back=e,this}clipPolygons(t){if(!this.divider)return t.slice();let e=t.length,i=[],n=[];for(let r=0;r<e;++r)this.divider.splitPolygon(t[r],i,n,i,n);return this.front&&(i=this.front.clipPolygons(i)),n=this.back?this.back.clipPolygons(n):[],i.concat(n)}clipTo(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)}}function Jw(t){let e,i,n=t.length,r=0;for(e=0;e<n;++e)r+=9*(t[e].vertices.length-2);let s,a=new Float32Array(r),o=new Float32Array(r),l=0;function h(t){a[l]=t.x,a[l+1]=t.y,a[l+2]=t.z,o[l]=s.nsign*t.nx,o[l+1]=s.nsign*t.ny,o[l+2]=s.nsign*t.nz,l+=3}for(e=0;e<n;++e)for(s=t[e],i=2;i<s.vertices.length;++i)h(s.vertices[0]),h(s.vertices[i-1]),h(s.vertices[i]);let c=new Od;return c.setAttribute("position",new rd(a,3)),c.setAttribute("normal",new rd(o,3)),c}class Kw{constructor(t,e,i,n){if(!(t instanceof Tu)){if(t instanceof Qw)return this.tree=t,this.matrix=null,this;if(t instanceof Od){let r,s,a,o,l=t.getAttribute("position").array,h=t.getAttribute("normal").array,c=[];for(let t=0;t<l.length;t+=9)r=new Zw,s=new Ww(l[t],l[t+1],l[t+2],h[t],h[t+1],h[t+2]),e&&s.applyMatrix4(e),a=new Ww(l[t+3],l[t+4],l[t+5],h[t+3],h[t+4],h[t+5]),e&&a.applyMatrix4(e),o=new Ww(l[t+6],l[t+7],l[t+8],h[t+6],h[t+7],h[t+8]),e&&o.applyMatrix4(e),n?r.vertices.push(s,o,a):r.vertices.push(s,a,o),r.calculateProperties(),c.push(r);return this.tree=new Qw(c,i),void 0!==i&&(this.maxid=this.tree.maxnodeid),this}if(t.polygons&&t.polygons[0]instanceof Zw){let n=t.polygons;for(let t=0;t<n.length;++t){let i=n[t];if(e)for(let t=0;t<i.vertices.length;++t)i.vertices[t].applyMatrix4(e);i.calculateProperties()}return this.tree=new Qw(n,i),void 0!==i&&(this.maxid=this.tree.maxnodeid),this}throw Error("ThreeBSP: Given geometry is unsupported")}t.updateMatrix(),e=this.matrix=t.matrix.clone();let r,s,a,o,l,h=[],c=(t=t.geometry).faces.length;for(let i=0;i<c;++i)r=t.faces[i],o=r.normal,s=new Zw,l=r.vertexNormals&&3==r.vertexNormals.length,a=t.vertices[r.a],l&&(o=r.vertexNormals[0]),a=new Ww(a.x,a.y,a.z,o.x,o.y,o.z),e&&a.applyMatrix4(e),s.vertices.push(a),a=t.vertices[r.b],l&&(o=r.vertexNormals[1]),a=new Ww(a.x,a.y,a.z,o.x,o.y,o.z),e&&a.applyMatrix4(e),s.vertices.push(a),a=t.vertices[r.c],l&&(o=r.vertexNormals[2]),a=new Ww(a.x,a.y,a.z,o.x,o.y,o.z),e&&a.applyMatrix4(e),s.vertices.push(a),s.calculateProperties(),h.push(s);this.tree=new Qw(h,i),void 0!==i&&(this.maxid=this.tree.maxnodeid)}subtract(t){let e=this.tree.clone(),i=t.tree.clone();return e.invert(),e.clipTo(i),i.clipTo(e),i.invert(),i.clipTo(e),i.invert(),e.build(i.allPolygons()),e.invert(),e=new Kw(e),e.matrix=this.matrix,e}union(t){let e=this.tree.clone(),i=t.tree.clone();return e.clipTo(i),i.clipTo(e),i.invert(),i.clipTo(e),i.invert(),e.build(i.allPolygons()),e=new Kw(e),e.matrix=this.matrix,e}intersect(t){let e=this.tree.clone(),i=t.tree.clone();return e.invert(),i.clipTo(e),i.invert(),e.clipTo(i),i.clipTo(e),e.build(i.allPolygons()),e.invert(),e=new Kw(e),e.matrix=this.matrix,e}tryToCompress(t){if(void 0===this.maxid)return;let e,i,n,r,s,a,o,l,h=[],c=0,d=t.length;for(n=0;n<d;++n)r=t[n],void 0!==r.id&&(void 0===h[r.id]&&(h[r.id]=[]),h[r.id].push(r));for(n=0;n<h.length;++n)if(e=h[n],void 0!==e)for(d=e.length,i=d>1;i;)for(i=!1,o=0;o<d-1;++o)if(s=e[o],s&&s.parent)for(l=o+1;l<d;++l)if(a=e[l],a&&s.parent===a.parent&&s.nsign===a.nsign){s.nsign!==s.parent.nsign&&s.parent.flip(),c++,e[o]=s.parent,e[l]=null,s.parent.vertices.length<3&&console.log("something wrong with parent"),i=!0;break}if(c>0)for(t.splice(0,t.length),n=0;n<h.length;++n)if(e=h[n],void 0!==e)for(o=0,d=e.length;o<d;++o)e[o]&&t.push(e[o])}direct_subtract(t){let e=this.tree,i=t.tree;return e.invert(),e.clipTo(i),i.clipTo(e),i.invert(),i.clipTo(e),i.invert(),e.build(i.collectPolygons([])),e.invert(),this}direct_union(t){let e=this.tree,i=t.tree;return e.clipTo(i),i.clipTo(e),i.invert(),i.clipTo(e),i.invert(),e.build(i.collectPolygons([])),this}direct_intersect(t){let e=this.tree,i=t.tree;return e.invert(),i.clipTo(e),i.invert(),e.clipTo(i),i.clipTo(e),e.build(i.collectPolygons([])),e.invert(),this}cut_from_plane(t){let e=this.tree,i=t.tree;return e.invert(),i.clipTo(e),this}scale(t,e,i){let n=this.tree.collectPolygons([]);for(let r=0;r<n.length;++r){let s=n[r];for(let n=0;n<s.vertices.length;++n){let r=s.vertices[n];r.x*=t,r.y*=e,r.z*=i}delete s.normal,s.calculateProperties()}}toPolygons(){let t=this.tree.collectPolygons([]);this.tryToCompress(t);for(let e=0;e<t.length;++e)delete t[e].id,delete t[e].parent;return t}toBufferGeometry(){return Jw(this.toPolygons())}toMesh(t){let e=this.toBufferGeometry(),i=new Tu(e,t);return this.matrix&&(i.position.setFromMatrixPosition(this.matrix),i.rotation.setFromRotationMatrix(this.matrix)),i}}function tM(t){return 1<<t}let eM={GradPerSegm:6,CompressComp:!0};function iM(t,e){if(void 0===e)return eM[t];eM[t]=e}const nM={kVisOverride:tM(0),kVisNone:tM(1),kVisThis:tM(2),kVisDaughters:tM(3),kVisOneLevel:tM(4),kVisStreamed:tM(5),kVisTouched:tM(6),kVisOnScreen:tM(7),kVisContainers:tM(12),kVisOnly:tM(13),kVisBranch:tM(14),kVisRaytrace:tM(15)};function rM(t,e){let i=t.fGeoAtt;return void 0!==i&&0!=(i&e)}function sM(t,e,i){void 0!==t.fGeoAtt&&(t.fGeoAtt=i?t.fGeoAtt|e:t.fGeoAtt&~e)}function aM(t,e){void 0!==t.fGeoAtt&&(t.fGeoAtt=t.fGeoAtt^16777215&e)}function oM(t,e){if(void 0===e&&(e=!0),sM(t,nM.kVisThis,!e),t.fNodes)for(let i=0;i<t.fNodes.arr.length;++i){sM(t.fNodes.arr[i].fVolume,nM.kVisThis,!e)}}const lM={};function hM(t){void 0===lM[t]&&(lM[t]=!0,console.warn(t))}function cM(t){return null==t||"object"!=typeof t?-1:"fShape"in t&&"fTrans"in t?1:0}function dM(t){return t?"TGeoCompositeShape"!==t._typename?1:dM(t.fNode.fLeft)+dM(t.fNode.fRight):0}function uM(t){return t&&t.fName?t.fName+(t.$geo_suffix?t.$geo_suffix:""):""}function fM(t,e){if(t){if(t.$geo_checked)return;t.$geo_checked=!0}let i=[],n=[];for(let t=0;t<e.length;++t){let r=e[t];if(r&&r.fName){if(!r.$geo_suffix){let t=i.indexOf(r.fName);if(t>=0){let e=n[t]||1;for(;i.indexOf(r.fName+"#"+e)>=0;)++e;r.$geo_suffix="#"+e,n[t]=e+1}}i.push(uM(r))}}}function mM(t,e,i,n,r,s,a,o,l){let h=new gc(t,e,i),c=new gc(n,r,s),d=new gc(a,o,l),u=new gc,f=new gc;return u.subVectors(d,c),f.subVectors(h,c),u.cross(f),u}class pM{constructor(t){this.nfaces=t,this.indx=0,this.pos=new Float32Array(9*t),this.norm=new Float32Array(9*t)}addFace3(t,e,i,n,r,s,a,o,l){let h=this.indx,c=this.pos;c[h]=t,c[h+1]=e,c[h+2]=i,c[h+3]=n,c[h+4]=r,c[h+5]=s,c[h+6]=a,c[h+7]=o,c[h+8]=l,this.last4=!1,this.indx=h+9}startPolygon(){}stopPolygon(){}addFace4(t,e,i,n,r,s,a,o,l,h,c,d,u){let f=this.indx,m=this.pos;1!==u&&(m[f]=t,m[f+1]=e,m[f+2]=i,m[f+3]=n,m[f+4]=r,m[f+5]=s,m[f+6]=a,m[f+7]=o,m[f+8]=l,f+=9),2!==u&&(m[f]=t,m[f+1]=e,m[f+2]=i,m[f+3]=a,m[f+4]=o,m[f+5]=l,m[f+6]=h,m[f+7]=c,m[f+8]=d,f+=9),this.last4=f!==this.indx+9,this.indx=f}setNormal4(t,e,i,n,r,s,a,o,l,h,c,d,u){if(this.last4&&u)return console.error("missmatch between addFace4 and setNormal4 calls");let f=this.indx-(this.last4?18:9),m=this.norm;1!==u&&(m[f]=t,m[f+1]=e,m[f+2]=i,m[f+3]=n,m[f+4]=r,m[f+5]=s,m[f+6]=a,m[f+7]=o,m[f+8]=l,f+=9),2!==u&&(m[f]=t,m[f+1]=e,m[f+2]=i,m[f+3]=a,m[f+4]=o,m[f+5]=l,m[f+6]=h,m[f+7]=c,m[f+8]=d)}recalcZ(t){let e=this.pos,i=this.indx,n=i-(this.last4?18:9);for(;n<i;)e[n+2]=t(e[n],e[n+1],e[n+2]),n+=3}calcNormal(){this.cb||(this.pA=new gc,this.pB=new gc,this.pC=new gc,this.cb=new gc,this.ab=new gc),this.pA.fromArray(this.pos,this.indx-9),this.pB.fromArray(this.pos,this.indx-6),this.pC.fromArray(this.pos,this.indx-3),this.cb.subVectors(this.pC,this.pB),this.ab.subVectors(this.pA,this.pB),this.cb.cross(this.ab),this.setNormal(this.cb.x,this.cb.y,this.cb.z)}setNormal(t,e,i){let n=this.indx-9,r=this.norm;r[n]=r[n+3]=r[n+6]=t,r[n+1]=r[n+4]=r[n+7]=e,r[n+2]=r[n+5]=r[n+8]=i,this.last4&&(n-=9,r[n]=r[n+3]=r[n+6]=t,r[n+1]=r[n+4]=r[n+7]=e,r[n+2]=r[n+5]=r[n+8]=i)}setNormal_12_34(t,e,i,n,r,s,a){void 0===a&&(a=0);let o=this.indx-(a>0?9:18),l=this.norm;1!==a&&(l[o]=t,l[o+1]=e,l[o+2]=i,l[o+3]=t,l[o+4]=e,l[o+5]=i,l[o+6]=n,l[o+7]=r,l[o+8]=s,o+=9),2!==a&&(l[o]=t,l[o+1]=e,l[o+2]=i,l[o+3]=n,l[o+4]=r,l[o+5]=s,l[o+6]=n,l[o+7]=r,l[o+8]=s,o+=9)}create(){this.nfaces!==this.indx/9&&console.error("Mismatch with created "+this.nfaces+" and filled "+this.indx/9+" number of faces");let t=new Od;return t.setAttribute("position",new rd(this.pos,3)),t.setAttribute("normal",new rd(this.norm,3)),t}}class gM{constructor(){this.polygons=[]}startPolygon(t){this.multi=1,this.mnormal=t}stopPolygon(){this.multi&&(this.multi=0,console.error("Polygon should be already closed at this moment"))}addFace3(t,e,i,n,r,s,a,o,l){this.addFace4(t,e,i,n,r,s,a,o,l,a,o,l,2)}addFace4(t,e,i,n,r,s,a,o,l,h,c,d,u){if(void 0===u&&(u=0),this.v1=new Ww(t,e,i,0,0,0),this.v2=1===u?null:new Ww(n,r,s,0,0,0),this.v3=new Ww(a,o,l,0,0,0),this.v4=2===u?null:new Ww(h,c,d,0,0,0),this.reduce=u,this.multi){let t;if(2!==u&&console.error("polygon not supported for not-reduced faces"),1==this.multi++)t=new Zw,t.vertices.push(this.mnormal?this.v2:this.v3),this.polygons.push(t);else{t=this.polygons[this.polygons.length-1];let e=this.mnormal?t.vertices[t.vertices.length-1]:t.vertices[0];(this.mnormal?this.v2:this.v3).diff(e)>1e-12&&console.error("vertex missmatch when building polygon")}let e=this.mnormal?t.vertices[0]:t.vertices[t.vertices.length-1];return void((this.mnormal?this.v3:this.v2).diff(e)<1e-12?this.multi=0:this.mnormal?t.vertices.push(this.v3):t.vertices.unshift(this.v2))}let f=new Zw;switch(u){case 0:f.vertices.push(this.v1,this.v2,this.v3,this.v4);break;case 1:f.vertices.push(this.v1,this.v3,this.v4);break;case 2:f.vertices.push(this.v1,this.v2,this.v3)}this.polygons.push(f)}setNormal4(t,e,i,n,r,s,a,o,l,h,c,d){this.v1.setnormal(t,e,i),this.v2&&this.v2.setnormal(n,r,s),this.v3.setnormal(a,o,l),this.v4&&this.v4.setnormal(h,c,d)}setNormal_12_34(t,e,i,n,r,s){this.v1.setnormal(t,e,i),this.v2&&this.v2.setnormal(t,e,i),this.v3.setnormal(n,r,s),this.v4&&this.v4.setnormal(n,r,s)}calcNormal(){this.cb||(this.pA=new gc,this.pB=new gc,this.pC=new gc,this.cb=new gc,this.ab=new gc),this.pA.set(this.v1.x,this.v1.y,this.v1.z),1!==this.reduce?(this.pB.set(this.v2.x,this.v2.y,this.v2.z),this.pC.set(this.v3.x,this.v3.y,this.v3.z)):(this.pB.set(this.v3.x,this.v3.y,this.v3.z),this.pC.set(this.v4.x,this.v4.y,this.v4.z)),this.cb.subVectors(this.pC,this.pB),this.ab.subVectors(this.pA,this.pB),this.cb.cross(this.ab),this.setNormal(this.cb.x,this.cb.y,this.cb.z)}setNormal(t,e,i){this.v1.setnormal(t,e,i),this.v2&&this.v2.setnormal(t,e,i),this.v3.setnormal(t,e,i),this.v4&&this.v4.setnormal(t,e,i)}recalcZ(t){this.v1.z=t(this.v1.x,this.v1.y,this.v1.z),this.v2&&(this.v2.z=t(this.v2.x,this.v2.y,this.v2.z)),this.v3.z=t(this.v3.x,this.v3.y,this.v3.z),this.v4&&(this.v4.z=t(this.v4.x,this.v4.y,this.v4.z))}create(){return{polygons:this.polygons}}}function _M(t,e){let i=[4,7,6,5,0,3,7,4,4,5,1,0,6,2,1,5,7,3,2,6,1,2,3,0],n=e>0?new gM:new pM(12);for(let e=0;e<i.length;e+=4){let r=3*i[e],s=3*i[e+1],a=3*i[e+2],o=3*i[e+3];n.addFace4(t[r],t[r+1],t[r+2],t[s],t[s+1],t[s+2],t[a],t[a+1],t[a+2],t[o],t[o+1],t[o+2]),0===e?n.setNormal(0,0,1):20===e?n.setNormal(0,0,-1):n.calcNormal()}return n.create()}function xM(t,e){let i,n;"TGeoCone"==t._typename||"TGeoConeSeg"==t._typename?(i=[t.fRmax2,t.fRmax1],n=[t.fRmin2,t.fRmin1]):(i=[t.fRmax,t.fRmax],n=[t.fRmin,t.fRmin]);let r=n[0]>0||n[1]>0,s=0,a=360;"TGeoConeSeg"!=t._typename&&"TGeoTubeSeg"!=t._typename&&"TGeoCtub"!=t._typename||(s=t.fPhi1,a=t.fPhi2-t.fPhi1);let o=Math.max(4,Math.round(a/eM.GradPerSegm)),l=o*(i[0]<=0||i[1]<=0?1:2);if(r&&(l+=o*(n[0]<=0||n[1]<=0?1:2)),i[0]>0&&(l+=o*(n[0]>0?2:1)),i[1]>0&&(l+=o*(n[1]>0?2:1)),a<360&&(l+=(i[0]>n[0]?2:0)+(i[1]>n[1]?2:0)),e<0)return l;let h=s*Math.PI/180,c=a/o*Math.PI/180,d=new Float32Array(o+1),u=new Float32Array(o+1);for(let t=0;t<=o;++t)u[t]=Math.cos(h+t*c),d[t]=Math.sin(h+t*c);let f,m=e?new gM:new pM(l);"TGeoCtub"==t._typename&&(f=(e,i,n)=>{let r=n<0?t.fNlow:t.fNhigh;return(n<0?-t.fDz:t.fDz)-(e*r[0]+i*r[1])/r[2]});for(let e=0;e<2&&(1!==e||r);++e){let r=0===e?i:n,s=e,a=1-e,l=1,h=0;if(r[0]!==r[1]){let e=Math.atan2(r[1]-r[0],2*t.fDZ);l=Math.cos(e),h=Math.sin(e)}1===e&&(l*=-1,h*=-1);let c=0;r[0]<=0?c=2:r[1]<=0&&(c=1);for(let e=0;e<o;++e)m.addFace4(r[0]*u[e+s],r[0]*d[e+s],t.fDZ,r[1]*u[e+s],r[1]*d[e+s],-t.fDZ,r[1]*u[e+a],r[1]*d[e+a],-t.fDZ,r[0]*u[e+a],r[0]*d[e+a],t.fDZ,c),f&&m.recalcZ(f),m.setNormal_12_34(l*u[e+s],l*d[e+s],h,l*u[e+a],l*d[e+a],h,c)}for(let e=0;e<2;++e){if(i[e]<=0)continue;let r=e,s=1-e,l=0==e?1:-1,h=n[e]<=0?2:0;2!=h||360!==a||f||m.startPolygon(0===e);for(let a=0;a<o;++a)m.addFace4(n[e]*u[a+r],n[e]*d[a+r],l*t.fDZ,i[e]*u[a+r],i[e]*d[a+r],l*t.fDZ,i[e]*u[a+s],i[e]*d[a+s],l*t.fDZ,n[e]*u[a+s],n[e]*d[a+s],l*t.fDZ,h),f?(m.recalcZ(f),m.calcNormal()):m.setNormal(0,0,l);m.stopPolygon()}return a<360&&(m.addFace4(n[1]*u[0],n[1]*d[0],-t.fDZ,i[1]*u[0],i[1]*d[0],-t.fDZ,i[0]*u[0],i[0]*d[0],t.fDZ,n[0]*u[0],n[0]*d[0],t.fDZ,i[0]===n[0]?2:n[1]===i[1]?1:0),f&&m.recalcZ(f),m.calcNormal(),m.addFace4(n[0]*u[o],n[0]*d[o],t.fDZ,i[0]*u[o],i[0]*d[o],t.fDZ,i[1]*u[o],i[1]*d[o],-t.fDZ,n[1]*u[o],n[1]*d[o],-t.fDZ,i[0]===n[0]?1:n[1]===i[1]?2:0),f&&m.recalcZ(f),m.calcNormal()),m.create()}function yM(t){if(!t)return null;let e,i,n;switch(t._typename){case"TGeoTranslation":e=t.fTranslation;break;case"TGeoRotation":i=t.fRotationMatrix;break;case"TGeoScale":n=t.fScale;break;case"TGeoGenTrans":n=t.fScale;case"TGeoCombiTrans":e=t.fTranslation,t.fRotation&&(i=t.fRotation.fRotationMatrix);break;case"TGeoHMatrix":e=t.fTranslation,i=t.fRotationMatrix,n=t.fScale;break;case"TGeoIdentity":break;default:console.warn("unsupported matrix "+t._typename)}if(!e&&!i&&!n)return null;let r=new Vc;return i&&r.set(i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),e&&r.setPosition(e[0],e[1],e[2]),n&&r.scale(new gc(n[0],n[1],n[2])),r}function AM(t,e){let i=null;if(1===t)i=new Vc,e.fTrans&&(i.set(e.fTrans[0],e.fTrans[4],e.fTrans[8],0,e.fTrans[1],e.fTrans[5],e.fTrans[9],0,e.fTrans[2],e.fTrans[6],e.fTrans[10],0,0,0,0,1),i.setPosition(e.fTrans[12],e.fTrans[13],e.fTrans[14]));else if(e.fMatrix)i=yM(e.fMatrix);else if("TGeoNodeOffset"==e._typename&&e.fFinder){let t=tM(14);switch(0!=(e.fFinder.fBits&t)&&hM("Unsupported reflected pattern "+e.fFinder._typename),e.fFinder._typename){case"TGeoPatternX":case"TGeoPatternY":case"TGeoPatternZ":case"TGeoPatternParaX":case"TGeoPatternParaY":case"TGeoPatternParaZ":let t=e.fFinder.fStart+(e.fIndex+.5)*e.fFinder.fStep;switch(i=new Vc,e.fFinder._typename[e.fFinder._typename.length-1]){case"X":i.setPosition(t,0,0);break;case"Y":i.setPosition(0,t,0);break;case"Z":i.setPosition(0,0,t)}break;case"TGeoPatternCylPhi":let n=Math.PI/180*(e.fFinder.fStart+(e.fIndex+.5)*e.fFinder.fStep),r=Math.cos(n),s=Math.sin(n);i=new Vc,i.set(r,-s,0,0,s,r,0,0,0,0,1,0,0,0,0,1);break;case"TGeoPatternCylR":i=new Vc;break;case"TGeoPatternTrapZ":let a=e.fFinder.fStart+(e.fIndex+.5)*e.fFinder.fStep;i=new Vc,i.setPosition(e.fFinder.fTxz*a,e.fFinder.fTyz*a,a);break;default:hM("Unsupported pattern type "+e.fFinder._typename)}}return i}function vM(t,e){if(!t||!t.fN||!t.fP)return null;let i=new gc(t.fP[0],t.fP[1],t.fP[2]),n=new gc(t.fN[0],t.fN[1],t.fN[2]);n.normalize();let r=1e10;if(e){let t=function(t){if(!t)return null;let e=null;if(t instanceof Kw?e=t.tree.collectPolygons([]):t.polygons&&(e=t.polygons),null!==e){let t=new yc;for(let i=0;i<e.length;++i){let n=e[i],r=n.vertices.length;for(let e=0;e<r;++e)t.expandByPoint(n.vertices[e])}return t}return t.boundingBox||t.computeBoundingBox(),t.boundingBox.clone()}(e);t&&(r=1e3*t.getSize(new gc).length())}let s=new gc(-r,-r/2,0),a=new gc(0,r,0),o=new gc(r,-r/2,0),l=new gc(0,0,-r),h=new Od,c=new Float32Array([s.x,s.y,s.z,o.x,o.y,o.z,a.x,a.y,a.z,s.x,s.y,s.z,a.x,a.y,a.z,l.x,l.y,l.z,a.x,a.y,a.z,o.x,o.y,o.z,l.x,l.y,l.z,o.x,o.y,o.z,s.x,s.y,s.z,l.x,l.y,l.z]);h.setAttribute("position",new rd(c,3)),h.computeVertexNormals(),h.lookAt(n),h.computeVertexNormals();for(let t=0;t<c.length;t+=3)c[t]=c[t]+i.x,c[t+1]=c[t+1]+i.y,c[t+2]=c[t+2]+i.z;return h}function bM(t){if(!t)return 0;if(t instanceof Kw)return t.tree.numPolygons();if("BufferGeometry"==t.type){let e=t.getAttribute("position");return e&&e.count?Math.round(e.count/3):0}return t.polygons?t.polygons.length:t.faces.length}function wM(t,e,i,n,r){t.boundingBox||t.computeBoundingBox();let s=t.boundingBox.clone();if(s.applyMatrix4(e),n||(n=0),s.min[i]>=n&&s.max[i]>=n||s.min[i]<=n&&s.max[i]<=n)return null;let a=new Kw(t,e,0,r),o=2*Math.max(Math.abs(s.min.x),Math.abs(s.max.x)),l=2*Math.max(Math.abs(s.min.y),Math.abs(s.max.y)),h=2*Math.max(Math.abs(s.min.z),Math.abs(s.max.z)),c=1e4;switch(i){case"x":c=Math.max(l,h);break;case"y":c=Math.max(o,h);break;case"z":c=Math.max(o,l)}let d=function(t,e,i){let n;switch((!i||i<1e4)&&(i=1e4),t){case"x":n=[new Ww(e,-3*i,i,1,0,0),new Ww(e,i,-3*i,1,0,0),new Ww(e,i,i,1,0,0)];break;case"y":n=[new Ww(-3*i,e,i,0,1,0),new Ww(i,e,i,0,1,0),new Ww(i,e,-3*i,0,1,0)];break;default:n=[new Ww(-3*i,i,e,0,0,1),new Ww(i,-3*i,e,0,0,1),new Ww(i,i,e,0,0,1)]}let r=new Zw(n);r.calculateProperties();let s=new Qw([r]);return new Kw(s)}(i,n,c);return a.cut_from_plane(d),d.toBufferGeometry()}function MM(t,e){void 0===e&&(e=0);try{switch(t._typename){case"TGeoBBox":return function(t,e){if(e<0)return 12;let i=t.fDX,n=t.fDY,r=t.fDZ,s=e?new gM:new pM(12);return s.addFace4(i,n,r,i,-n,r,i,-n,-r,i,n,-r),s.setNormal(1,0,0),s.addFace4(-i,n,-r,-i,-n,-r,-i,-n,r,-i,n,r),s.setNormal(-1,0,0),s.addFace4(-i,n,-r,-i,n,r,i,n,r,i,n,-r),s.setNormal(0,1,0),s.addFace4(-i,-n,r,-i,-n,-r,i,-n,-r,i,-n,r),s.setNormal(0,-1,0),s.addFace4(-i,n,r,-i,-n,r,i,-n,r,i,n,r),s.setNormal(0,0,1),s.addFace4(i,n,-r,i,-n,-r,-i,-n,-r,-i,n,-r),s.setNormal(0,0,-1),s.create()}(t,e);case"TGeoPara":return function(t,e){if(e<0)return 12;let i=t.fTxy,n=t.fTxz,r=t.fTyz;return _M([-t.fZ*n-i*t.fY-t.fX,-t.fY-t.fZ*r,-t.fZ,-t.fZ*n+i*t.fY-t.fX,t.fY-t.fZ*r,-t.fZ,-t.fZ*n+i*t.fY+t.fX,t.fY-t.fZ*r,-t.fZ,-t.fZ*n-i*t.fY+t.fX,-t.fY-t.fZ*r,-t.fZ,t.fZ*n-i*t.fY-t.fX,-t.fY+t.fZ*r,t.fZ,t.fZ*n+i*t.fY-t.fX,t.fY+t.fZ*r,t.fZ,t.fZ*n+i*t.fY+t.fX,t.fY+t.fZ*r,t.fZ,t.fZ*n-i*t.fY+t.fX,-t.fY+t.fZ*r,t.fZ],e)}(t,e);case"TGeoTrd1":case"TGeoTrd2":return function(t,e){if(e<0)return 12;let i,n;return"TGeoTrd1"==t._typename?i=n=t.fDY:(i=t.fDy1,n=t.fDy2),_M([-t.fDx1,i,-t.fDZ,t.fDx1,i,-t.fDZ,t.fDx1,-i,-t.fDZ,-t.fDx1,-i,-t.fDZ,-t.fDx2,n,t.fDZ,t.fDx2,n,t.fDZ,t.fDx2,-n,t.fDZ,-t.fDx2,-n,t.fDZ],e)}(t,e);case"TGeoArb8":case"TGeoTrap":case"TGeoGtra":return function(t,e){if(e<0)return 12;let i=[t.fXY[0][0],t.fXY[0][1],-t.fDZ,t.fXY[1][0],t.fXY[1][1],-t.fDZ,t.fXY[2][0],t.fXY[2][1],-t.fDZ,t.fXY[3][0],t.fXY[3][1],-t.fDZ,t.fXY[4][0],t.fXY[4][1],t.fDZ,t.fXY[5][0],t.fXY[5][1],t.fDZ,t.fXY[6][0],t.fXY[6][1],t.fDZ,t.fXY[7][0],t.fXY[7][1],t.fDZ];const n=[4,7,6,6,5,4,3,7,4,4,0,3,5,1,0,0,4,5,6,2,1,1,5,6,7,3,2,2,6,7,1,2,3,3,0,1];for(let t=0;t<i.length;t+=i.length/2)for(let e=t;e<t+i.length/2-3;e+=3)for(let r=e+3;r<t+i.length/2;r+=3)if(i[e]===i[r]&&i[e+1]===i[r+1]&&i[e+2]===i[r+2])for(let t=0;t<n.length;++t)n[t]===r/3&&(n[t]=e/3);let r=[],s=0;for(let t=0;t<n.length;t+=3){let e=100*n[t]+10*n[t+1]+n[t+2],i=100*n[t+1]+10*n[t+2]+n[t],a=100*n[t+2]+10*n[t]+n[t+1];n[t]==n[t+1]||n[t]==n[t+2]||n[t+1]==n[t+2]||r.indexOf(e)>=0||r.indexOf(i)>=0||r.indexOf(a)>=0?n[t]=n[t+1]=n[t+2]=-1:(r.push(e,i,a),s++)}let a=e?new gM:new pM(s);for(let t=0;t<n.length;t+=6){let r=3*n[t],s=3*n[t+1],o=3*n[t+2],l=3*n[t+3],h=3*n[t+4],c=3*n[t+5],d=null;if(r>=0&&l>=0&&e)if(0===t)d=new gc(0,0,1);else if(30===t)d=new gc(0,0,-1);else{let t=mM(i[r],i[r+1],i[r+2],i[s],i[s+1],i[s+2],i[o],i[o+1],i[o+2]);t.normalize();let e=mM(i[l],i[l+1],i[l+2],i[h],i[h+1],i[h+2],i[c],i[c+1],i[c+2]);e.normalize(),t.distanceToSquared(e)<1e-12&&(d=t)}null!==d?(a.addFace4(i[r],i[r+1],i[r+2],i[s],i[s+1],i[s+2],i[o],i[o+1],i[o+2],i[h],i[h+1],i[h+2]),a.setNormal(d.x,d.y,d.z)):(r>=0&&(a.addFace3(i[r],i[r+1],i[r+2],i[s],i[s+1],i[s+2],i[o],i[o+1],i[o+2]),a.calcNormal()),l>=0&&(a.addFace3(i[l],i[l+1],i[l+2],i[h],i[h+1],i[h+2],i[c],i[c+1],i[c+2]),a.calcNormal()))}return a.create()}(t,e);case"TGeoSphere":return function(t,e){let i=[t.fRmax,t.fRmin],n=t.fPhi1,r=t.fPhi2-t.fPhi1,s=t.fTheta1,a=t.fTheta2-t.fTheta1,o=t.fNseg,l=t.fNz,h=i[1]<=0;if(e>0){let t=(h?2:4)*o*l/e;t>1&&(o=Math.max(4,Math.floor(o/Math.sqrt(t))),l=Math.max(4,Math.floor(l/Math.sqrt(t))))}let c=o*l*2,d=2*o,u=2*o,f=360===r?0:l*(h?2:4),m=1e-10;if(h&&(u=d=o),e<0)return c*(h?1:2)+d+u+f;let p=new Float32Array(o+1),g=new Float32Array(o+1),_=new Float32Array(l+1),x=new Float32Array(l+1);for(let t=0;t<=l;++t){let e=(s+a/l*t)*Math.PI/180;_[t]=Math.sin(e),x[t]=Math.cos(e)}for(let t=0;t<=o;++t){let e=(n+r/o*t)*Math.PI/180;p[t]=Math.sin(e),g[t]=Math.cos(e)}Math.abs(_[0])<=m&&(c-=o,d=0),Math.abs(_[l])<=m&&(c-=o,u=0);let y=c*(h?1:2)+d+u+f,A=e?new gM:new pM(y);for(let t=0;t<2&&(1!==t||!h);++t){let e=i[t],n=0===t?1:-1,r=1-t,s=1-r;for(let t=0;t<l;++t){let i=t+r,a=t+s,l=0;Math.abs(_[i])<=m?l=1:Math.abs(_[a])<=m&&(l=2);for(let t=0;t<o;++t)A.addFace4(e*_[i]*g[t],e*_[i]*p[t],e*x[i],e*_[i]*g[t+1],e*_[i]*p[t+1],e*x[i],e*_[a]*g[t+1],e*_[a]*p[t+1],e*x[a],e*_[a]*g[t],e*_[a]*p[t],e*x[a],l),A.setNormal4(n*_[i]*g[t],n*_[i]*p[t],n*x[i],n*_[i]*g[t+1],n*_[i]*p[t+1],n*x[i],n*_[a]*g[t+1],n*_[a]*p[t+1],n*x[a],n*_[a]*g[t],n*_[a]*p[t],n*x[a],l)}}for(let t=0;t<=l;t+=l)if(Math.abs(_[t])>=m){let e=_[t],n=x[t],r=0===t?0:1,s=1-r;for(let t=0;t<o;++t)A.addFace4(i[1]*e*g[t+r],i[1]*e*p[t+r],i[1]*n,i[0]*e*g[t+r],i[0]*e*p[t+r],i[0]*n,i[0]*e*g[t+s],i[0]*e*p[t+s],i[0]*n,i[1]*e*g[t+s],i[1]*e*p[t+s],i[1]*n,h?2:0),A.calcNormal()}if(r<360)for(let t=0;t<=o;t+=o){let e=p[t],n=g[t],r=0===t?1:0,s=1-r;for(let t=0;t<l;++t)A.addFace4(i[1]*_[t+r]*n,i[1]*_[t+r]*e,i[1]*x[t+r],i[0]*_[t+r]*n,i[0]*_[t+r]*e,i[0]*x[t+r],i[0]*_[t+s]*n,i[0]*_[t+s]*e,i[0]*x[t+s],i[1]*_[t+s]*n,i[1]*_[t+s]*e,i[1]*x[t+s],h?2:0),A.calcNormal()}return A.create()}(t,e);case"TGeoCone":case"TGeoConeSeg":case"TGeoTube":case"TGeoTubeSeg":case"TGeoCtub":return xM(t,e);case"TGeoEltu":return function(t,e){let i=Math.max(4,Math.round(360/eM.GradPerSegm));if(e<0)return 4*i;let n=new Float32Array(i+1),r=new Float32Array(i+1);for(let e=0;e<=i;++e){let s=e/i*2*Math.PI;n[e]=t.fRmin*Math.cos(s),r[e]=t.fRmax*Math.sin(s)}let s,a,o=e?new gM:new pM(4*i),l=1,h=0;for(let e=0;e<i;++e){o.addFace4(n[e],r[e],+t.fDZ,n[e],r[e],-t.fDZ,n[e+1],r[e+1],-t.fDZ,n[e+1],r[e+1],t.fDZ),s=l,a=h,l=n[e+1]*t.fRmax/t.fRmin,h=r[e+1]*t.fRmin/t.fRmax;let i=Math.sqrt(l*l+h*h);l/=i,h/=i,o.setNormal_12_34(s,a,0,l,h,0)}for(let e=0;e<2;++e){let s=0===e?1:-1,a=e,l=1-e;for(let e=0;e<i;++e)o.addFace3(0,0,s*t.fDZ,n[e+a],r[e+a],s*t.fDZ,n[e+l],r[e+l],s*t.fDZ),o.setNormal(0,0,s)}return o.create()}(t,e);case"TGeoTorus":return function(t,e){let i=t.fR,n=Math.max(6,Math.round(360/eM.GradPerSegm)),r=Math.max(8,Math.round(t.fDphi/eM.GradPerSegm)),s=(t.fRmin>0?4:2)*n*(r+(360!==t.fDphi?1:0));if(e<0)return s;e>0&&s>e&&(n=Math.floor(n/Math.sqrt(s/e)),r=Math.floor(r/Math.sqrt(s/e)),s=(t.fRmin>0?4:2)*n*(r+(360!==t.fDphi?1:0)));let a=new Float32Array(n+1),o=new Float32Array(n+1),l=new Float32Array(r+1),h=new Float32Array(r+1);for(let t=0;t<=n;++t)a[t]=Math.sin(t/n*2*Math.PI),o[t]=Math.cos(t/n*2*Math.PI);for(let e=0;e<=r;++e){let i=(t.fPhi1+t.fDphi*e/r)/180*Math.PI;l[e]=Math.sin(i),h[e]=Math.cos(i)}let c=e?new gM:new pM(s),d=new gc,u=new gc,f=new gc,m=new gc,p=new gc,g=new gc,_=new gc,x=new gc,y=new gc,A=new gc;for(let e=0;e<2&&!(e>0&&t.fRmin<=0);++e){let s=e>0?t.fRmin:t.fRmax,v=1-e,b=1-v,w=e>0?-1:1;for(let t=0;t<r;++t){let e=t+v,r=t+b;y.x=i*h[e],y.y=i*l[e],A.x=i*h[r],A.y=i*l[r];for(let t=0;t<n;++t)d.x=(i+s*o[t])*h[e],d.y=(i+s*o[t])*l[e],d.z=s*a[t],u.x=(i+s*o[t+1])*h[e],u.y=(i+s*o[t+1])*l[e],u.z=s*a[t+1],f.x=(i+s*o[t+1])*h[r],f.y=(i+s*o[t+1])*l[r],f.z=s*a[t+1],m.x=(i+s*o[t])*h[r],m.y=(i+s*o[t])*l[r],m.z=s*a[t],c.addFace4(d.x,d.y,d.z,u.x,u.y,u.z,f.x,f.y,f.z,m.x,m.y,m.z),p.subVectors(d,y).normalize(),g.subVectors(u,y).normalize(),_.subVectors(f,A).normalize(),x.subVectors(m,A).normalize(),c.setNormal4(w*p.x,w*p.y,w*p.z,w*g.x,w*g.y,w*g.z,w*_.x,w*_.y,w*_.z,w*x.x,w*x.y,w*x.z)}}if(360!==t.fDphi)for(let e=0;e<=r;e+=r){let r=t.fRmax,s=t.fRmin,d=e>0?0:1,u=1-d,f=t.fRmin>0?0:1,m=e>0?1:-1;for(let t=0;t<n;++t)c.addFace4((i+r*o[t+d])*h[e],(i+r*o[t+d])*l[e],r*a[t+d],(i+s*o[t+d])*h[e],(i+s*o[t+d])*l[e],s*a[t+d],(i+s*o[t+u])*h[e],(i+s*o[t+u])*l[e],s*a[t+u],(i+r*o[t+u])*h[e],(i+r*o[t+u])*l[e],r*a[t+u],f),c.setNormal(-m*l[e],m*h[e],0)}return c.create()}(t,e);case"TGeoPcon":case"TGeoPgon":return function(t,e){let i,n,r=t.fPhi1,s=t.fDphi;"TGeoPgon"==t._typename?(i=t.fNedges,n=1/Math.cos(Math.PI/180*s/i/2)):(i=Math.max(5,Math.round(s/eM.GradPerSegm)),n=1);let a=new Int16Array(2*t.fNz),o=0,l=!1;for(let e=0;e<t.fNz;++e)t.fRmin[e]>0&&(l=!0);if(e<0)return(l?4:2)*i*(t.fNz-1);let h=360===s?null:[];for(let e=0;e<2;++e){let i=0===e?"fRmax":"fRmin";for(let r=0;r<t.fNz;++r){let s=t.fZ[r],c=t[i][r];a[2*r+e]=0,r>0&&r<t.fNz-1&&(t.fZ[r-1]===s&&t[i][r-1]===c||t[i][r+1]===c&&t[i][r-1]===c)||(r>0&&(0===e||l)&&(a[2*r+e]=1,o++),null!==h&&(0===e?h.push(new Zh(n*c,s)):c<t.fRmax[r]&&h.unshift(new Zh(n*c,s))))}}let c=o*i*2;t.fRmin[0]!==t.fRmax[0]&&(c+=i*(l?2:1)),t.fRmin[t.fNz-1]!==t.fRmax[t.fNz-1]&&(c+=i*(l?2:1));let d=null;if(null!==h){if(h.length===2*t.fNz){d=[];for(let e=t.fNz-1;e>0;--e){if(t.fZ[e]===t.fZ[e-1])continue;let i=2*t.fNz-1-e;d.push([i,e-1,e]),d.push([i,i+1,e-1])}}else d=kg.triangulateShape(h,[]);c+=2*d.length}let u=r*Math.PI/180,f=s/i*Math.PI/180,m=new Float32Array(i+1),p=new Float32Array(i+1);for(let t=0;t<=i;++t)p[t]=Math.cos(u+t*f),m[t]=Math.sin(u+t*f);let g=e?new gM:new pM(c);for(let e=0;e<2;++e){let r=0===e?"fRmax":"fRmin",s=t.fZ[0],o=n*t[r][0],l=1-e,h=e;for(let c=0;c<t.fNz;++c){if(0===a[2*c+e])continue;let d=t.fZ[c],u=n*t[r][c],f=1,_=0;if(u!==o){let t=Math.atan2(u-o,d-s);f=Math.cos(t),_=Math.sin(t)}e>0&&(f*=-1,_*=-1);for(let t=0;t<i;++t)g.addFace4(o*p[t+l],o*m[t+l],s,u*p[t+l],u*m[t+l],d,u*p[t+h],u*m[t+h],d,o*p[t+h],o*m[t+h],s),g.setNormal_12_34(f*p[t+l],f*m[t+l],_,f*p[t+h],f*m[t+h],_);s=d,o=u}}for(let e=0;e<t.fNz;e+=t.fNz-1){let r=n*t.fRmin[e],s=n*t.fRmax[e];if(r===s)continue;let a=t.fZ[e],o=0===e?1:0,h=1-o,c=0===e?-1:1;l||d||g.startPolygon(e>0);for(let t=0;t<i;++t)g.addFace4(r*p[t+o],r*m[t+o],a,s*p[t+o],s*m[t+o],a,s*p[t+h],s*m[t+h],a,r*p[t+h],r*m[t+h],a,l?0:2),g.setNormal(0,0,c);g.stopPolygon()}if(d)for(let t=0;t<=i;t+=i){let e=0===t?1:2,i=3-e;for(let n=0;n<d.length;++n){let r=h[d[n][0]],s=h[d[n][e]],a=h[d[n][i]];g.addFace3(r.x*p[t],r.x*m[t],r.y,s.x*p[t],s.x*m[t],s.y,a.x*p[t],a.x*m[t],a.y),g.calcNormal()}}return g.create()}(t,e);case"TGeoXtru":return function(t,e){let i=(t.fNz-1)*t.fNvert*2;if(e<0)return i+3*t.fNvert;let n=[];for(let e=0;e<t.fNvert;++e)n.push(new Zh(t.fX[e],t.fY[e]));let r=kg.triangulateShape(n,[]);r.length<n.length-2?(hM("Problem with XTRU shape "+t.fName+" with "+n.length+" vertices"),r=[]):i+=2*r.length;let s=e?new gM:new pM(i);for(let e=0;e<t.fNz-1;++e){let i=t.fZ[e],n=t.fScale[e],r=t.fZ[e+1],a=t.fScale[e+1],o=t.fX0[e],l=t.fX0[e+1],h=t.fY0[e],c=t.fY0[e+1];for(let e=0;e<t.fNvert;++e){let d=(e+1)%t.fNvert;s.addFace4(n*t.fX[e]+o,n*t.fY[e]+h,i,a*t.fX[e]+l,a*t.fY[e]+c,r,a*t.fX[d]+l,a*t.fY[d]+c,r,n*t.fX[d]+o,n*t.fY[d]+h,i),s.calcNormal()}}for(let e=0;e<=t.fNz-1;e+=t.fNz-1){let i=t.fZ[e],a=t.fScale[e],o=t.fX0[e],l=t.fY0[e];for(let t=0;t<r.length;++t){let h=r[t],c=n[h[0]],d=n[h[0===e?2:1]],u=n[h[0===e?1:2]];s.addFace3(a*c.x+o,a*c.y+l,i,a*d.x+o,a*d.y+l,i,a*u.x+o,a*u.y+l,i),s.setNormal(0,0,0===e?-1:1)}}return s.create()}(t,e);case"TGeoParaboloid":return function(t,e){let i=Math.max(4,Math.round(360/eM.GradPerSegm)),n=30;if(e>0){let t=2*i*(n+1)/e;t>1&&(i=Math.max(5,Math.floor(i/Math.sqrt(t))),n=Math.max(5,Math.floor(n/Math.sqrt(t))))}let r=-t.fDZ,s=t.fDZ,a=t.fRlo,o=t.fRhi;t.fA>=0?t.fB>r&&(r=t.fB):t.fB<s&&(s=t.fB);let l=Math.atan2(r,a),h=Math.atan2(s,o),c=(n+1)*i*2;if(0===a&&(c-=2*i),0===o&&(c-=2*i),e<0)return c;let d=new Float32Array(i+1),u=new Float32Array(i+1);for(let t=0;t<=i;++t)u[t]=Math.cos(t/i*2*Math.PI),d[t]=Math.sin(t/i*2*Math.PI);let f=e?new gM:new pM(c),m=r,p=0,g=0,_=-1;for(let e=0;e<=n+1;++e){let c=0,x=0,y=0,A=-1;if(0===e&&0===a)continue;if(e===n+1&&0===p)break;switch(e){case 0:c=r,x=a;break;case n:c=s,x=o;break;case n+1:c=s,x=0;break;default:{let i=Math.tan(l+(h-l)*e/n),r=i*i-4*t.fA*t.fB;x=.5*(i+Math.sqrt(r))/t.fA,x<1e-6&&(x=0),c=x*i}}y=t.fA*x,A=t.fA>0?-1:1;let v=0;0===p?v=1:0===x&&(v=2);for(let t=0;t<i;++t)f.addFace4(x*u[t],x*d[t],c,p*u[t],p*d[t],m,p*u[t+1],p*d[t+1],m,x*u[t+1],x*d[t+1],c,v),0===v||1===e&&0===a||e===n+1&&0===o?f.setNormal4(y*u[t],y*d[t],A,g*u[t],g*d[t],_,g*u[t+1],g*d[t+1],_,y*u[t+1],y*d[t+1],A,v):f.setNormal(0,0,e<n?-1:1);m=c,p=x,g=y,_=A}return f.create()}(t,e);case"TGeoHype":return function(t,e){if(0===t.fTin&&0===t.fTout)return xM(t,e);let i=Math.max(4,Math.round(360/eM.GradPerSegm)),n=30,r=i*(n+1)*(t.fRmin>0?4:2);if(e<0)return r;e>0&&e>r&&(i=Math.max(4,Math.floor(i/Math.sqrt(r/e))),n=Math.max(4,Math.floor(n/Math.sqrt(r/e))),r=i*(n+1)*(t.fRmin>0?4:2));let s=new Float32Array(i+1),a=new Float32Array(i+1);for(let t=0;t<=i;++t)a[t]=Math.cos(t/i*2*Math.PI),s[t]=Math.sin(t/i*2*Math.PI);let o=e?new gM:new pM(r);for(let e=0;e<2&&!(e>0&&t.fRmin<=0);++e){let r=e>0?t.fRmin:t.fRmax,l=e>0?t.fTinsq:t.fToutsq,h=1-e,c=1-h;for(let e=0;e<n;++e){let d=-t.fDz+e/n*2*t.fDz,u=-t.fDz+(e+1)/n*2*t.fDz,f=Math.sqrt(r*r+l*d*d),m=Math.sqrt(r*r+l*u*u);for(let t=0;t<i;++t)o.addFace4(f*a[t+h],f*s[t+h],d,m*a[t+h],m*s[t+h],u,m*a[t+c],m*s[t+c],u,f*a[t+c],f*s[t+c],d),o.calcNormal()}}for(let e=0;e<2;++e){let n=0===e?t.fDz:-t.fDz,r=Math.sqrt(t.fRmax*t.fRmax+t.fToutsq*n*n),l=t.fRmin>0?Math.sqrt(t.fRmin*t.fRmin+t.fTinsq*n*n):0,h=t.fRmin>0?0:1,c=1-e,d=1-c;for(let t=0;t<i;++t)o.addFace4(r*a[t+c],r*s[t+c],n,l*a[t+c],l*s[t+c],n,l*a[t+d],l*s[t+d],n,r*a[t+d],r*s[t+d],n,h),o.setNormal(0,0,0===e?1:-1)}return o.create()}(t,e);case"TGeoTessellated":return function(t,e){let i=0;for(let e=0;e<t.fFacets.length;++e)4==t.fFacets[e].fNvert?i+=2:i+=1;if(e<0)return i;let n=e?new gM:new pM(i);for(let e=0;e<t.fFacets.length;++e){let i=t.fFacets[e],r=t.fVertices[i.fIvert[0]].fVec,s=t.fVertices[i.fIvert[1]].fVec,a=t.fVertices[i.fIvert[2]].fVec;if(4==i.fNvert){let e=t.fVertices[i.fIvert[3]].fVec;n.addFace4(r[0],r[1],r[2],s[0],s[1],s[2],a[0],a[1],a[2],e[0],e[1],e[2]),n.calcNormal()}else n.addFace3(r[0],r[1],r[2],s[0],s[1],s[2],a[0],a[1],a[2]),n.calcNormal()}return n.create()}(t,e);case"TGeoCompositeShape":return function(t,e){if(e<0)return MM(t.fNode.fLeft,-10)+MM(t.fNode.fRight,-10);let i,n,r,s,a=!1,o=yM(t.fNode.fLeftMat),l=yM(t.fNode.fRightMat);if(0===e?e=4e3:a=!0,o&&o.determinant()<-.9&&hM("Axis reflection in left composite shape - not supported"),l&&l.determinant()<-.9&&hM("Axis reflections in right composite shape - not supported"),i="TGeoHalfSpace"==t.fNode.fLeft._typename?vM(t.fNode.fLeft):MM(t.fNode.fLeft,e),!i)return null;let h=bM(i),c=0;if(i._exceed_limit&&(h+=e),h<e&&(n="TGeoHalfSpace"==t.fNode.fRight._typename?vM(t.fNode.fRight,i):MM(t.fNode.fRight,e),c=bM(n)),h+c>=e||!n)return i.polygons&&(i=Jw(i.polygons)),o&&i.applyMatrix4(o),i._exceed_limit=!0,i;switch(r=new Kw(i,o,eM.CompressComp?0:void 0),s=new Kw(n,l,r.maxid),r.maxid=s.maxid,t.fNode._typename){case"TGeoIntersection":r.direct_intersect(s);break;case"TGeoUnion":r.direct_union(s);break;case"TGeoSubtraction":r.direct_subtract(s);break;default:hM("unsupported bool operation "+t.fNode._typename+", use first geom")}return 0===bM(r)&&(hM("Zero faces in comp shape left: "+t.fNode.fLeft._typename+" "+bM(i)+" faces right: "+t.fNode.fRight._typename+" "+bM(n)+" faces  use first"),r=new Kw(i,o)),a?{polygons:r.toPolygons()}:r.toBufferGeometry()}(t,e);case"TGeoShapeAssembly":break;case"TGeoScaledShape":{let i=MM(t.fShape,e);return t.fScale&&e>=0&&"object"==typeof i&&"function"==typeof i.scale&&i.scale(t.fScale.fScale[0],t.fScale.fScale[1],t.fScale.fScale[2]),i}case"TGeoHalfSpace":if(e<0)return 1;default:hM("unsupported shape type "+t._typename)}}catch(e){let i="";void 0!==e.stack&&(i=e.stack.split("\n")[0],i=i.indexOf(e.message)>=0?e.stack.split("\n")[1]:" at: "+i),hM(t._typename+" err: "+e.message+i)}return e<0?0:null}function TM(t){let e=[],i=null;if(void 0!==t.fVolume?i=t.fVolume.fShape:void 0!==t.fShape?i=t.fShape:void 0!==t.fShapeBits&&void 0!==t.fShapeId&&(i=t),!i)return e.push(t._typename),e;let n=Math.max(i.fDX,i.fDY,i.fDZ),r=n>1e7||n<1e-7,s=t=>void 0===t?"???":t==Math.round(t)&&t<1e7?Math.round(t):r?t.toExponential(4):t.toPrecision(7);switch(e.push(i._typename),e.push("DX="+s(i.fDX)+" DY="+s(i.fDY)+" DZ="+s(i.fDZ)),i._typename){case"TGeoBBox":break;case"TGeoPara":e.push("Alpha="+i.fAlpha+" Phi="+i.fPhi+" Theta="+i.fTheta);break;case"TGeoTrd2":e.push("Dy1="+s(i.fDy1)+" Dy2="+s(i.fDy1));case"TGeoTrd1":e.push("Dx1="+s(i.fDx1)+" Dx2="+s(i.fDx1));break;case"TGeoArb8":case"TGeoTrap":case"TGeoGtra":break;case"TGeoSphere":e.push("Rmin="+s(i.fRmin)+" Rmax="+s(i.fRmax)),e.push("Phi1="+i.fPhi1+" Phi2="+i.fPhi2),e.push("Theta1="+i.fTheta1+" Theta2="+i.fTheta2);break;case"TGeoConeSeg":e.push("Phi1="+i.fPhi1+" Phi2="+i.fPhi2);case"TGeoCone":e.push("Rmin1="+s(i.fRmin1)+" Rmax1="+s(i.fRmax1)),e.push("Rmin2="+s(i.fRmin2)+" Rmax2="+s(i.fRmax2));break;case"TGeoCtub":case"TGeoTubeSeg":e.push("Phi1="+i.fPhi1+" Phi2="+i.fPhi2);case"TGeoEltu":case"TGeoTube":e.push("Rmin="+s(i.fRmin)+" Rmax="+s(i.fRmax));break;case"TGeoTorus":e.push("Rmin="+s(i.fRmin)+" Rmax="+s(i.fRmax)),e.push("Phi1="+i.fPhi1+" Dphi="+i.fDphi);break;case"TGeoPcon":case"TGeoPgon":case"TGeoXtru":break;case"TGeoParaboloid":e.push("Rlo="+s(i.fRlo)+" Rhi="+s(i.fRhi)),e.push("A="+s(i.fA)+" B="+s(i.fB));break;case"TGeoHype":e.push("Rmin="+s(i.fRmin)+" Rmax="+s(i.fRmax)),e.push("StIn="+s(i.fStIn)+" StOut="+s(i.fStOut));break;case"TGeoCompositeShape":case"TGeoShapeAssembly":break;case"TGeoScaledShape":e=TM(i.fShape),i.fScale&&e.unshift("Scale X="+i.fScale.fScale[0]+" Y="+i.fScale.fScale[1]+" Z="+i.fScale.fScale[2])}return e}function SM(t){let e=new Vc;return t.updateMatrixWorld(),t.matrixWorldInverse.copy(t.matrixWorld).invert(),e.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e}function CM(t){if(!t)return null;t instanceof Bu&&(t=SM(t));let e=new Xc;return e.setFromProjectionMatrix(t),e.corners=new Float32Array([1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,0,0,0]),e.test=new gc(0,0,0),e.CheckShape=function(t,e){let i,n=this.test,r=this.corners.length,s=this.corners;for(i=0;i<r;i+=3)if(n.x=s[i]*e.fDX,n.y=s[i+1]*e.fDY,n.z=s[i+2]*e.fDZ,this.containsPoint(n.applyMatrix4(t)))return!0;return!1},e.CheckBox=function(t){let e=this.test,i=0;return e.set(t.min.x,t.min.y,t.min.z),this.containsPoint(e)&&i++,e.set(t.min.x,t.min.y,t.max.z),this.containsPoint(e)&&i++,e.set(t.min.x,t.max.y,t.min.z),this.containsPoint(e)&&i++,e.set(t.min.x,t.max.y,t.max.z),this.containsPoint(e)&&i++,e.set(t.max.x,t.max.y,t.max.z),this.containsPoint(e)&&i++,e.set(t.max.x,t.min.y,t.max.z),this.containsPoint(e)&&i++,e.set(t.max.x,t.max.y,t.min.z),this.containsPoint(e)&&i++,e.set(t.max.x,t.max.y,t.max.z),this.containsPoint(e)&&i++,i>5},e}class PM{constructor(t,e){this.toplevel=!0,this.name_prefix="",this.maxdepth=1,this.vislevel=4,this.maxnodes=1e4,t?(t.$geoh&&(this.toplevel=!1),this.createClones(t)):e&&(this.nodes=e)}setVisLevel(t){this.vislevel=t&&Number.isInteger(t)?t:4}getVisLevel(){return this.vislevel}setMaxVisNodes(t){this.maxnodes=Number.isFinite(t)?t:1e4}getMaxVisNodes(){return this.maxnodes}updateNode(t){t&&Number.isInteger(t.id)&&t.id<this.nodes.length&&(this.nodes[t.id]=t)}getNodeShape(t){if(!this.origin||!this.nodes)return null;let e=this.origin[t],i=this.nodes[t];return e&&i?0!==i.kind?e.fShape:e.fVolume?e.fVolume.fShape:null:null}cleanup(t,e){if(t)for(let e=0;e<t.length;++e)delete t[e].stack,t[e]=void 0;if(e)for(let t=0;t<e.length;++t)delete e[t].geom,e[t]=void 0;if(this.nodes)for(let t=0;t<this.nodes.length;++t)this.nodes[t]&&delete this.nodes[t].chlds;delete this.nodes,delete this.origin,delete this.sortmap}createClones(t,e,i){if(!e){if(t&&"$$Shape$$"==t._typename)return this.createClonesForShape(t);this.origin=[],e=1,i=cM(t)}if(i<0||!t||"_refid"in t)return;t._refid=this.origin.length,this.origin.push(t),e>this.maxdepth&&(this.maxdepth=e);let n=null;if(n=0===i?t.fVolume&&t.fVolume.fNodes?t.fVolume.fNodes.arr:null:t.fElements?t.fElements.arr:null,null!==n){fM(t,n);for(let t=0;t<n.length;++t)this.createClones(n[t],e+1,i)}if(e>1)return;this.nodes=[];let r=[];for(let t=0;t<this.origin.length;++t){let e={id:t,kind:i,vol:0,nfaces:0};this.nodes.push(e),r.push(e)}for(let t=0;t<this.origin.length;++t){let e=this.origin[t],n=this.nodes[t],r=null,s=null;1===i?(s=e.fShape,e.fElements&&(r=e.fElements.arr)):e.fVolume&&(s=e.fVolume.fShape,e.fVolume.fNodes&&(r=e.fVolume.fNodes.arr));let a=AM(i,e);if(a){if(n.matrix=a.elements,1===n.matrix[0]){let t=!0;for(let e=1;e<n.matrix.length&&t;++e)t=n.matrix[e]===(5===e||10===e||15===e?1:0);t&&delete n.matrix}n.matrix&&1==i&&(n.abs_matrix=!0)}if(s&&(n.fDX=s.fDX,n.fDY=s.fDY,n.fDZ=s.fDZ,n.vol=s.fDX*s.fDY*s.fDZ,void 0===s.$nfaces&&(s.$nfaces=MM(s,-1)),n.nfaces=s.$nfaces,n.nfaces<=0&&(n.vol=0)),r){n.chlds=new Array(r.length);for(let t=0;t<r.length;++t)n.chlds[t]=r[t]._refid}}for(let t=0;t<this.origin.length;++t)delete this.origin[t]._refid;r.sort((function(t,e){return e.vol-t.vol})),this.sortmap=new Array(this.nodes.length);for(let t=0;t<this.nodes.length;++t)this.sortmap[t]=r[t].id,r[t].sortid=t}createClonesForShape(t){this.origin=[],this.plain_shape=t;let e={id:0,sortid:0,kind:2,name:"Shape",nfaces:t.nfaces,fDX:1,fDY:1,fDZ:1,vol:1,vis:!0};this.nodes=[e]}countVisibles(){let t=0;if(this.nodes)for(let e=0;e<this.nodes.length;++e)this.nodes[e].vis&&t++;return t}markVisibles(t,e,i){if(this.plain_shape)return 1;if(!this.origin||!this.nodes)return 0;let n=0;for(let r=0;r<this.nodes.length;++r){let s=this.nodes[r],a=this.origin[r];s.vis=0,delete s.nochlds,0===s.kind?a.fVolume&&(t?(s.vis=rM(a.fVolume,nM.kVisOnScreen)?99:0,0==r&&s.vis&&i&&(s.vis=0),e&&(sM(a.fVolume,nM.kVisNone,!1),sM(a.fVolume,nM.kVisThis,s.vis>0),sM(a.fVolume,nM.kVisDaughters,!0))):(s.vis=!rM(a.fVolume,nM.kVisNone)&&rM(a.fVolume,nM.kVisThis)?99:0,rM(a,nM.kVisDaughters)&&rM(a.fVolume,nM.kVisDaughters)||(s.nochlds=!0),s.vis>0&&s.chlds&&!s.nochlds&&(s.vis=1),0==r&&(i&&(s.vis=0),delete s.nochlds))):(s.vis=a.fRnrSelf?99:0,0===r&&1===this.nodes.length&&(s.vis=99),this.vislevel=9999),(s.vol<=0||s.nfaces<=0)&&(s.vis=0),s.vis&&n++}return n}produceIdShifts(){for(let t=0;t<this.nodes.length;++t)this.nodes[t].idshift=-1;!function t(e,i){if(i.idshift<0&&(i.idshift=0,i.chlds))for(let n=0;n<i.chlds.length;++n)i.idshift+=t(e,e[i.chlds[n]]);return i.idshift+1}(this.nodes,this.nodes[0])}getVisibleFlags(){let t=new Array(this.nodes.length);for(let e=0;e<this.nodes.length;++e)t[e]={vis:this.nodes[e].vis,nochlds:this.nodes[e].nochlds};return t}setVisibleFlags(t){if(!this.nodes||!t||!t.length!=this.nodes.length)return 0;let e=0;for(let i=0;i<this.nodes.length;++i){let n=this.nodes[i];n.vis=t[i].vis,n.nochlds=t[i].nochlds,n.vis&&e++}return e}scanVisible(t,e){if(!this.nodes)return 0;void 0===e&&(t||(t={}),(e=t.vislvl||this.vislevel||4)>88&&(e=88),t.stack=new Array(100),t.nodeid=0,t.counter=0,t.last=0,t.CopyStack=function(t){let e={nodeid:this.nodeid,seqid:this.counter,stack:new Array(this.last)};t&&(e.factor=t);for(let t=0;t<this.last;++t)e.stack[t]=this.stack[t+1];return e},t.domatrix&&(t.matrices=[],t.mpool=[new Vc],t.getmatrix=function(){return this.matrices[this.last]}));let i=0,n=this.nodes[t.nodeid];if(t.domatrix){t.mpool[t.last+1]||(t.mpool[t.last+1]=new Vc);let e=t.last>0?t.matrices[t.last-1]:new Vc;n.matrix?(t.matrices[t.last]=t.mpool[t.last].fromArray(e.elements),t.matrices[t.last].multiply(t.mpool[t.last+1].fromArray(n.matrix))):t.matrices[t.last]=e}if(n.nochlds&&(e=0),n.vis>e&&(t.func&&!t.func(n)||i++),t.counter++,e>0&&n.chlds){t.last++;for(let r=0;r<n.chlds.length;++r)t.nodeid=n.chlds[r],t.stack[t.last]=r,i+=this.scanVisible(t,e-1);t.last--}else t.counter+=n.idshift||0;return 0===t.last&&(delete t.last,delete t.stack,delete t.CopyStack,delete t.counter,delete t.matrices,delete t.mpool,delete t.getmatrix),i}getNodeName(t){if(this.origin){let e=this.origin[t];return e?uM(e):""}let e=this.nodes[t];return e?e.name:""}resolveStack(t,e){let i={id:0,obj:null,node:this.nodes[0],name:this.name_prefix};if(e&&(i.matrix=new Vc,i.node.matrix&&i.matrix.fromArray(i.node.matrix)),this.origin&&(i.obj=this.origin[0]),t)for(let n=0;n<t.length;++n){i.id=i.node.chlds[t[n]],i.node=this.nodes[i.id],this.origin&&(i.obj=this.origin[i.id]);let r=this.getNodeName(i.id);r&&(i.name&&(i.name+="/"),i.name+=r),e&&i.node.matrix&&i.matrix.multiply((new Vc).fromArray(i.node.matrix))}return i}buildStackByIds(t){if(!t)return null;if(0!==t[0])return console.error("wrong ids - first should be 0"),null;let e=this.nodes[0],i=[];for(let n=1;n<t.length;++n){let r=t[n];if(!e)return null;let s=e.chlds.indexOf(r);if(s<0)return console.error("wrong nodes ids "+t[n]+" is not child of "+t[n-1]),null;i.push(s),e=this.nodes[r]}return i}buildIdsByStack(t){if(!t)return null;let e=this.nodes[0],i=[0];for(let n=0;n<t.length;++n){let r=e.chlds[t[n]];i.push(r),e=this.nodes[r]}return i}isIdInStack(t,e){if(!t)return!0;let i=this.nodes[0],n=0;for(let r=0;r<e.length;++r){if(n=i.chlds[e[r]],n==t)return!0;i=this.nodes[n]}return!1}findStackByName(t){let e=t.split("/"),i=0,n=[];if(this.getNodeName(i)!==e[0])return null;for(let t=1;t<e.length;++t){let r=this.nodes[i];if(!r.chlds)return null;for(let s=0;s<r.chlds.length;++s){let a=r.chlds[s];if(this.getNodeName(a)===e[t]){n.push(s),i=a;break}}if(n.length===t-1)return null}return n}setDefaultColors(t){if(this.use_dflt_colors=t,this.use_dflt_colors&&!this.dflt_table){let t={kWhite:0,kBlack:1,kGray:920,kRed:632,kGreen:416,kBlue:600,kYellow:400,kMagenta:616,kCyan:432,kOrange:800,kSpring:820,kTeal:840,kAzure:860,kViolet:880,kPink:900},e=110,i=[];for(let n=0;n<e;n++)i.push(t.kGray);i[3]=t.kYellow-10,i[4]=i[5]=t.kGreen-10,i[6]=i[7]=t.kBlue-7,i[8]=i[9]=t.kMagenta-3,i[10]=i[11]=t.kRed-10,i[12]=t.kGray+1,i[13]=t.kBlue-10,i[14]=t.kOrange+7,i[16]=t.kYellow+1,i[20]=t.kYellow-10,i[24]=i[25]=i[26]=t.kBlue-8,i[29]=t.kOrange+9,i[79]=t.kOrange-2,this.dflt_table=i}}getDrawEntryProperties(t,e){let i=this.nodes[t.nodeid];if(2===i.kind){let e={name:i.name,nname:i.name,shape:null,material:null,chlds:null},n=t.opacity||1;return e.fillcolor=new ac(t.color?"rgb("+t.color+")":"blue"),e.material=new $g({transparent:n<1,opacity:n,wireframe:!1,color:e.fillcolor,side:0,vertexColors:!1,depthWrite:1==n}),e.material.inherentOpacity=n,e}if(!this.origin)return console.error("origin not there - kind",i.kind,t.nodeid,i),null;let n=this.origin[t.nodeid];if(1===i.kind){let t={name:uM(n),nname:uM(n),shape:n.fShape,material:null,chlds:null};null!==n.fElements&&(t.chlds=n.fElements.arr);{let e=Math.min(1,n.fRGBA[3]);t.fillcolor=new ac(n.fRGBA[0],n.fRGBA[1],n.fRGBA[2]),t.material=new $g({transparent:e<1,opacity:e,wireframe:!1,color:t.fillcolor,side:0,vertexColors:!1,depthWrite:1==e}),t.material.inherentOpacity=e}return t}let r=n.fVolume,s={name:uM(r),nname:uM(n),volume:n.fVolume,shape:r.fShape,material:null,chlds:null};null!==n.fVolume.fNodes&&(s.chlds=n.fVolume.fNodes.arr),r&&(s.linewidth=r.fLineWidth);{let i=1;if(e||(e=["white","black","red","green","blue","yellow","magenta","cyan"]),t.custom_color?s.fillcolor=t.custom_color:r.fFillColor>1&&1==r.fLineColor?s.fillcolor=e[r.fFillColor]:r.fLineColor>=0&&(s.fillcolor=e[r.fLineColor]),r.fMedium&&r.fMedium.fMaterial){let t=r.fMedium.fMaterial,n=t.fFillStyle,a=n<3e3||n>3100?0:n-3e3;if(this.use_dflt_colors){let i=Math.round(t.fZ),n=this.dflt_table[i];s.fillcolor=e[n],t.fDensity<.1&&(a=60)}a>0&&(i=(100-a)/100),void 0===s.fillcolor&&(s.fillcolor=e[t.fFillColor])}void 0===s.fillcolor&&(s.fillcolor="lightgrey"),s.material=new $g({transparent:i<1,opacity:i,wireframe:!1,color:s.fillcolor,side:0,vertexColors:!1,depthWrite:1==i}),s.material.inherentOpacity=i}return s}createObject3D(t,e,i){let n=this.nodes[0],r=e,s=0,a="object"==typeof i||"force"===i;for(let e=0;e<=t.length;++e){let o,l=e>0?t[e-1]:0;if(e>0&&(n=this.nodes[n.chlds[l]]),r.children)for(let t=0;t<r.children.length;++t)if(r.children[t].nchld===l){o=r.children[t];break}if(o)r=o,o.$jsroot_drawable&&s++;else{if(!a)return null;o=new Td,n.abs_matrix?(o.absMatrix=new Vc,o.absMatrix.fromArray(n.matrix)):n.matrix&&(o.matrix.fromArray(n.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale)),o.nchld=l,r.add(o),0==e&&"object"==typeof i&&i.scale&&(i.scale.x<0||i.scale.y<0||i.scale.z<0)&&(o.scale.copy(i.scale),o.updateMatrix()),o.updateMatrixWorld(),r=o}}if("mesh"===i||"delete_mesh"===i){let t=null;if(r)for(let e=0;e<r.children.length&&!t;++e){let i=r.children[e];"Mesh"===i.type&&void 0===i.nchld&&(t=i)}if("mesh"===i||!t)return t;let n=r;for(;t&&t!==e;)r=t.parent,r.remove(t),t=0==r.children.length?r:null;return n}return r&&(r.$jsroot_drawable=!0,r.$jsroot_depth=s),r}getVolumeBoundary(t,e,i){let n={min:0,max:1,sortidcut:0};if(!this.sortmap)return console.error("sorting map do not exist"),n;let r,s,a=0,o=0;for(let n=0;n<this.sortmap.length&&a<i&&o<e;++n){let e=this.sortmap[n];0!==t[e]&&(s=this.nodes[e],r||(r=s),a+=t[e],o+=t[e]*s.nfaces)}return s?(n.max=r.vol,n.min=s.vol,n.sortidcut=s.sortid,n):(console.error("no volumes selected"),n)}collectVisibles(t,e){if(this.plain_shape)return{lst:[{nodeid:0,seqid:0,stack:[],factor:1,shapeid:0,server_shape:this.plain_shape}],complete:!0};let i={facecnt:0,viscnt:new Array(this.nodes.length),vislvl:this.getVisLevel(),reset(){this.total=0,this.facecnt=0,this.viscnt.fill(0)},func(t){return this.total++,this.facecnt+=t.nfaces,this.viscnt[t.id]++,!0}};i.reset();let n=this.scanVisible(i),r=this.getMaxVisNodes();if(r>0)for(;n>r&&i.vislvl>1;)i.vislvl--,i.reset(),n=this.scanVisible(i);this.actual_level=i.vislvl;let s=0,a=0,o=-1,l=10,h=this.nodes.length+1;if(console.log("Total visible nodes "+n+" numfaces "+i.facecnt),i.facecnt>t){let n=t*(e?.8:1),c=r*(e?.8:1),d=this.getVolumeBoundary(i.viscnt,n,c);if(s=d.min,a=d.max,h=d.sortidcut,e){i.domatrix=!0,i.frustum=e,i.totalcam=0,i.func=function(t){return t.vol<=s&&this.frustum.CheckShape(this.getmatrix(),t)&&(this.viscnt[t.id]++,this.totalcam+=t.nfaces),!0};for(let t=0;t<i.viscnt.length;++t)i.viscnt[t]=0;this.scanVisible(i),o=i.totalcam>.2*t?this.getVolumeBoundary(i.viscnt,.2*t,.2*r).min:0,l=a/(o>0?o>0:s)}}return i.items=[],i.func=function(t){return t.sortid<h?this.items.push(this.CopyStack()):o>=0&&t.vol>o&&this.frustum.CheckShape(this.getmatrix(),t)&&this.items.push(this.CopyStack(l)),!0},this.scanVisible(i),{lst:i.items,complete:0===s}}mergeVisibles(t,e){let i=0,n=[];for(let r=0;r<t.length&&i<e.length;++r){for(;i<e.length&&e[i].seqid<t[r].seqid;)n.push(e[i++]);i<e.length&&e[i].seqid===t[r].seqid&&(e[i].done&&(t[r].done=!0),i++)}for(;i<e.length;)n.push(e[i++]);return n}collectShapes(t){if(this.plain_shape)return[this.plain_shape];let e=[];for(let i=0;i<t.length;++i){let n=t[i],r=this.getNodeShape(n.nodeid);r&&(void 0===r._id?(r._id=e.length,e.push({id:r._id,shape:r,vol:this.nodes[n.nodeid].vol,refcnt:1,factor:1,ready:!1})):e[r._id].refcnt++,n.shape=e[r._id],n.factor&&n.factor>n.shape.factor&&(n.shape.factor=n.factor))}e.sort(((t,e)=>e.vol*e.factor-t.vol*t.factor));for(let t=0;t<e.length;++t){let i=e[t];i.id=t,delete i.shape._id}for(let e=0;e<t.length;++e){let i=t[e];i.shape&&(i.shapeid=i.shape.id,delete i.shape)}return e}mergeShapesLists(t,e){if(!t)return e;for(let e=0;e<t.length;++e){let i=t[e];i.shape._geom=i.geom,delete i.geom,void 0!==i.geomZ&&(i.shape._geomZ=i.geomZ,delete i.geomZ)}for(let t=0;t<e.length;++t){let i=e[t];void 0!==i.shape._geom&&(i.geom=i.shape._geom,delete i.shape._geom),void 0!==i.shape._geomZ&&(i.geomZ=i.shape._geomZ,delete i.shape._geomZ)}for(let e=0;e<t.length;++e){let i=t[e];delete i.shape._geom,delete i.shape._geomZ}return e}buildShapes(t,e,i){let n=0,r=(new Date).getTime(),s={done:!1,shapes:0,faces:0,notusedshapes:0};for(let a=0;a<t.length;++a){let o=t[a];if(s.done)o.ready=!0;else if(o.ready||(o._typename="$$Shape$$",o.ready=!0,void 0===o.geom&&(o.geom=MM(o.shape),o.geom&&n++),o.nfaces=bM(o.geom)),s.shapes++,o.used||s.notusedshapes++,s.faces+=o.nfaces*o.refcnt,s.faces>=e)s.done=!0;else if(n>.01*t.length&&void 0!==i){if((new Date).getTime()-r>i)return s}}return s.done=!0,s}}function EM(t,e){let i=new gc(1,1,-1);if(void 0===t.geomZ)if("BufferGeometry"==t.geom.type){let e=t.geom.getAttribute("position").array,i=t.geom.getAttribute("normal").array,n=t.geom.getIndex();if(n){let r=n.array,s=t.geom.drawRange.start,a=t.geom.drawRange.count;s+a>r.length&&(a=r.length-s);let o=new Float32Array(3*a),l=new Float32Array(3*a);for(let t=0;t<a;++t){let n=r[s+t];(n<0||3*n>=e.length)&&console.log("strange index",3*n,e.length),o[3*t]=e[3*n],o[3*t+1]=e[3*n+1],o[3*t+2]=e[3*n+2],l[3*t]=i[3*n],l[3*t+1]=i[3*n+1],l[3*t+2]=i[3*n+2]}e=o,i=l}let r,s=e.length,a=0,o=new Float32Array(s),l=new Float32Array(s);for(r=0;r<s;r+=3)o[r]=e[r+a],o[r+1]=e[r+1+a],o[r+2]=-e[r+2+a],l[r]=i[r+a],l[r+1]=i[r+1+a],l[r+2]=-i[r+2+a],a+=3,6===a&&(a=-3);t.geomZ=new Od,t.geomZ.setAttribute("position",new rd(o,3)),t.geomZ.setAttribute("normal",new rd(l,3))}else{t.geomZ=t.geom.clone(),t.geomZ.scale(i.x,i.y,i.z);let e,n,r=0;for(;r<t.geomZ.faces.length;)e=geom.faces[r++],n=e.b,e.b=e.c,e.c=n}let n=new Tu(t.geomZ,e);return n.scale.copy(i),n.updateMatrix(),n._flippedMesh=!0,n}function kM(t,e,i){if(!t||!t.geometry)return e;e||(e=new yc).makeEmpty(),i||t.updateMatrixWorld();let n=new gc,r=t.geometry;if(r.isGeometry){let s=r.vertices;for(let r=0,a=s.length;r<a;r++)n.copy(s[r]),i||n.applyMatrix4(t.matrixWorld),e.expandByPoint(n)}else if(r.isBufferGeometry){let s=r.attributes.position;if(void 0!==s)for(let r=0,a=s.count;r<a;r++)n.fromBufferAttribute(s,r),i||n.applyMatrix4(t.matrixWorld),e.expandByPoint(n)}return e}function DM(t,e,i,n){let r=new V_;function s(t){t&&t.traverse((function(t){t.renderOrder=0,t.material&&(t.material.depthWrite=!0)}))}function a(t,e,i){if(t.children)for(let n=0;n<t.children.length;++n){let r=t.children[n];r.$jsroot_order===e?r.material&&(r.material.transparent?(r.material.depthWrite=!1,i.push(r)):s(r)):(void 0===t.$jsroot_depth||t.$jsroot_depth<e)&&a(r,e,i)}}i&&"dflt"!==i?function t(s,o,l,h){let c=[],d=!1;if(a(s,o,c),c.length){if(l===h)for(let t=0;t<c.length;++t)c[t].renderOrder=l;else d=function(t,s,a){if(t.length>300){for(let e=0;e<t.length;++e)t[e].renderOrder=(s+a)/2;return!1}let o=new gc;for(let n=0;n<t.length;++n){let r=t[n],s=r.$jsroot_box3;if(s||(r.$jsroot_box3=s=kM(r)),"size"===i){r.$jsroot_distance=s.getSize(new gc);continue}if("pnt"===i){r.$jsroot_distance=e.distanceTo(s.getCenter(o));continue}let a=Math.min(e.distanceTo(s.min),e.distanceTo(s.max)),l=new gc(s.min.x,s.min.y,s.max.z);a=Math.min(a,e.distanceTo(l)),l.set(s.min.x,s.max.y,s.min.z),a=Math.min(a,e.distanceTo(l)),l.set(s.max.x,s.min.y,s.min.z),a=Math.min(a,e.distanceTo(l)),l.set(s.max.x,s.max.y,s.min.z),a=Math.min(a,e.distanceTo(l)),l.set(s.max.x,s.min.y,s.max.z),a=Math.min(a,e.distanceTo(l)),l.set(s.min.x,s.max.y,s.max.z),a=Math.min(a,e.distanceTo(l)),r.$jsroot_distance=a}t.sort(((t,e)=>t.$jsroot_distance-e.$jsroot_distance));let l=new Array(t.length);for(let e=0;e<t.length;++e)t[e].$jsroot_index=e,l[e]=t[e];if("ray"===i)for(let i=t.length-1;i>=0;--i){let s=t[i],a=s.$jsroot_box3.getCenter(o);for(let i=0;i<2;++i){a.sub(e).normalize(),r.set(e,a);let o=r.intersectObjects(t,!1),l=[];for(let t=0;t<o.length;++t)l.indexOf(o[t].object)<0&&l.push(o[t].object);if(o=l,o.indexOf(s)<0&&i>0&&console.log("MISS",n?n.resolveStack(s.stack).name:"???"),o.indexOf(s)>=0||i>0)break;let h=s.geometry.attributes.position.array;a=new gc((h[0]+h[3]+h[6])/3,(h[1]+h[4]+h[7])/3,(h[2]+h[5]+h[8])/3),a.applyMatrix4(s.matrixWorld)}for(let t=0;t<intersects.length-1;++t){let e=intersects[t],i=intersects[t+1],n=e.$jsroot_index,r=i.$jsroot_index;if(!(n<r)){for(let t=r;t<n;++t)l[t]=l[t+1],l[t].$jsroot_index=t;l[n]=i,i.$jsroot_index=n}}}for(let t=0;t<l.length;++t)l[t].renderOrder=a-(t+1)/(l.length+1)*(a-s),delete l[t].$jsroot_index,delete l[t].$jsroot_distance;return!0}(c,l,h),d||(l=h=(l+h)/2);for(let e=0;e<c.length;++e){let i=c[e].parent,n=l,r=h;d&&(r=c[e].renderOrder,n=r-(h-l)/(c.length+2)),t(i,o+1,n,r)}}}(t,0,1,1e6):s(t)}let zM=0;function OM(t,e,i){void 0===e&&(e=1),i||(zM=0,i="");let n=k("TGeoVolume");if(sM(n,nM.kVisThis,!0),sM(n,nM.kVisDaughters,!0),i&&"TGeoCompositeShape"!==t._typename||e<=0)return n.fName=i,n.fLineColor=zM++%8+2,n.fShape=t,n;i&&(i+="/"),n.$geoh=!0,n.fName="";let r=k("TGeoNodeMatrix");sM(r,nM.kVisThis,!0),sM(r,nM.kVisDaughters,!0),r.fName="Left",r.fMatrix=t.fNode.fLeftMat,r.fVolume=OM(t.fNode.fLeft,e-1,i+"Left");let s=k("TGeoNodeMatrix");return sM(s,nM.kVisThis,!0),sM(s,nM.kVisDaughters,!0),s.fName="Right",s.fMatrix=t.fNode.fRightMat,s.fVolume=OM(t.fNode.fRight,e-1,i+"Right"),n.fNodes=k("TList"),n.fNodes.Add(r),n.fNodes.Add(s),i||(zM=0),n}function RM(t,e,i,n){if(!e||!("arr"in e)||0==e.arr.length)return;let r={_name:i,_kind:"ROOT.TList",_title:n,_more:!0,_geoobj:e,_parent:t,_get:function(t){return Promise.resolve(t._geoobj||null)},_expand:function(t,e){if("fVolume"in e&&(e=e.fVolume.fNodes),!("arr"in e))return!1;t._childs=[],fM(null,e.arr);for(let i in e.arr)YM(t,e.arr[i]);return!0}};t._childs||(t._childs=[]),t._childs.push(r)}function LM(t,e){if(!t||!e)return!1;let i,n,r,s=0===e._typename.indexOf("TGeoNode"),a=0===e._typename.indexOf("TGeoVolume"),o="TGeoManager"===e._typename,l="TEveGeoShapeExtract"===e._typename||"ROOT::Experimental::REveGeoShapeExtract"===e._typename,h="TGeoOverlap"===e._typename;if(!(s||a||o||l||h))return!1;if(t._childs)return!0;if(o)return RM(t,e.fMaterials,"Materials","list of materials"),RM(t,e.fMedia,"Media","list of media"),RM(t,e.fTracks,"Tracks","list of tracks"),RM(t,e.fOverlaps,"Overlaps","list of detected overlaps"),YM(t,e.fMasterVolume),!0;if(h)return YM(t,e.fVolume1),YM(t,e.fVolume2),YM(t,e.fMarker,"Marker"),!0;if(l?(n=e.fElements?e.fElements.arr:null,r=e.fShape):(i=s?e.fVolume:e,n=i&&i.fNodes?i.fNodes.arr:null,r=i?i.fShape:null),!n&&r&&"TGeoCompositeShape"===r._typename&&r.fNode)return t._childs||(YM(t,r.fNode.fLeft,"Left"),YM(t,r.fNode.fRight,"Right")),!0;if(!n)return!1;fM(e,n);for(let e=0;e<n.length;++e)YM(t,n[e]);return!0}function BM(t,e){for(;t;){if(t._painter&&t._painter._camera)return e&&"function"==typeof t._painter[e]&&t._painter[e](),t;t=t._parent}return null}function NM(t){if("TEveGeoShapeExtract"===t._typename||"ROOT::Experimental::REveGeoShapeExtract"===t._typename)return t.fRnrSelf?" geovis_this":"";let e=!rM(t,nM.kVisNone)&&rM(t,nM.kVisThis),i=rM(t,nM.kVisDaughters);return!i||t.fNodes&&0!==t.fNodes.arr.length||(i=!1),e&&i?" geovis_all":e?" geovis_this":i?" geovis_daughters":""}function FM(t,e){t&&e&&e.forEachItem((i=>{t!==i._volume&&t!==i._geoobj||(i._icon=i._icon.split(" ")[0]+NM(t),e.updateTreeNode(i))}))}class IM{constructor(t,e){this.bright=e,this.element=t.append("div").attr("class","geo_toolbar_group"),gv("\n.geo_toolbar_group { float: left; box-sizing: border-box; position: relative; bottom: 23px; vertical-align: middle; white-space: nowrap; }\n.geo_toolbar_group:first-child { margin-left: 2px; }\n.geo_toolbar_group a { position: relative; font-size: 16px; padding: 3px 1px; cursor: pointer; line-height: normal; box-sizing: border-box; }\n.geo_toolbar_group a svg { position: relative; top: 2px; }\n.geo_toolbar_btn path { fill: rgba(0, 31, 95, 0.2); }\n.geo_toolbar_btn path .active,\n.geo_toolbar_btn path:hover { fill: rgba(0, 22, 72, 0.5); }\n.geo_toolbar_btn_bright path { fill: rgba(255, 224, 160, 0.2); }\n.geo_toolbar_btn_bright path .active,\n.geo_toolbar_btn_bright path:hover { fill: rgba(255, 233, 183, 0.5); }",this.element.node())}addButtons(t){this.buttonsNames=[],t.forEach((t=>{let e=t.name;if(!e)throw new Error(`must provide button ${name} in button config`);if(-1!==this.buttonsNames.indexOf(e))throw new Error(`button name ${e} is taken`);this.buttonsNames.push(e);let i=t.title||t.name;if("function"!=typeof t.click)throw new Error('must provide button "click" function in button config');let n=this.element.append("a").attr("class",this.bright?"geo_toolbar_btn_bright":"geo_toolbar_btn").attr("rel","tooltip").attr("data-title",i).on("click",t.click);uv.createSVG(n,uv[t.icon],16,i)}))}changeBrightness(t){this.bright=t,this.element&&this.element.selectAll(t?".geo_toolbar_btn":".geo_toolbar_btn_bright").attr("class",t?"geo_toolbar_btn_bright":"geo_toolbar_btn")}cleanup(){this.element&&(this.element.remove(),delete this.element)}}class jM extends class{cleanup(){}extractIndex(){}setSelected(){}setHighlight(){}checkHighlightIndex(){}}{constructor(t,e){super(),this.mesh=t&&t.material?t:null,this.bloom=e}setHighlight(t,e){return this.drawSpecial(t,e)}drawSpecial(t){let e=this.mesh;if(e&&e.material)return t?(e.origin||(e.origin={color:e.material.color,emissive:e.material.emissive,opacity:e.material.opacity,width:e.material.linewidth,size:e.material.size}),this.bloom?(e.layers.enable(1),e.material.emissive=new ac(65280)):(e.material.color=new ac(t),e.material.opacity=1),e.hightlightWidthScale&&!d.isWin&&(e.material.linewidth=e.origin.width*e.hightlightWidthScale),e.highlightScale&&(e.material.size=e.origin.size*e.highlightScale),!0):e.origin?(this.bloom?(e.material.emissive=e.origin.emissive,e.layers.enable(0)):(e.material.color=e.origin.color,e.material.opacity=e.origin.opacity),e.hightlightWidthScale&&(e.material.linewidth=e.origin.width),e.highlightScale&&(e.material.size=e.origin.size),!0):void 0}}class qM extends Vl{constructor(t,e){let i;e&&"TGeoManager"===e._typename&&(i=e,e=e.fMasterVolume),e&&0===e._typename.indexOf("TGeoVolume")&&(e={_typename:"TGeoNode",fVolume:e,fName:e.fName,$geoh:e.$geoh,_proxy:!0}),super(t,e),i&&(this.geo_manager=i),this.no_default_title=!0,this.mode3d=!0,this.drawing_stage=0,this.ctrl={clipIntersect:!0,clip:[{name:"x",enabled:!1,value:0,min:-100,max:100},{name:"y",enabled:!1,value:0,min:-100,max:100},{name:"z",enabled:!1,value:0,min:-100,max:100}],ssao:{enabled:!1,output:_y.OUTPUT.Default,kernelRadius:0,minDistance:.001,maxDistance:.1},bloom:{enabled:!0,strength:1.5},info:{num_meshes:0,num_faces:0,num_shapes:0},highlight:!1,highlight_scene:!1,depthTest:!0,depthMethod:"dflt",select_in_view:!1,update_browser:!0,light:{kind:"points",top:!1,bottom:!1,left:!1,right:!1,front:!1,specular:!0,power:1},trans_radial:0,trans_z:0},this.ctrl.depthMethodItems=[{name:"Default",value:"dflt"},{name:"Raytraicing",value:"ray"},{name:"Boundary box",value:"box"},{name:"Mesh size",value:"size"},{name:"Central point",value:"pnt"}],this.ctrl.ssao.outputItems=[{name:"Default",value:_y.OUTPUT.Default},{name:"SSAO Only",value:_y.OUTPUT.SSAO},{name:"SSAO Only + Blur",value:_y.OUTPUT.Blur},{name:"Beauty",value:_y.OUTPUT.Beauty},{name:"Depth",value:_y.OUTPUT.Depth},{name:"Normal",value:_y.OUTPUT.Normal}],this.cleanup(!0)}createToolbar(){if(this._toolbar||!this._webgl||this.ctrl.notoolbar||l())return;let t=[{name:"toImage",title:"Save as PNG",icon:"camera",click:()=>this.createSnapshot()},{name:"control",title:"Toggle control UI",icon:"rect",click:()=>this.showControlOptions("toggle")},{name:"enlarge",title:"Enlarge geometry drawing",icon:"circle",click:()=>this.toggleEnlarge()}];navigator.getVRDisplays&&(t.push({name:"entervr",title:"Enter VR (It requires a VR Headset connected)",icon:"vrgoggles",click:()=>this.toggleVRMode()}),this.initVRMode()),m.ContextMenu&&t.push({name:"menu",title:"Show context menu",icon:"question",click:t=>{t.preventDefault(),t.stopPropagation(),bv()||vv(t,this).then((t=>{t.painter.fillContextMenu(t),t.show()}))}});let e=new ac(this.ctrl.background);this._toolbar=new IM(this.selectDom(),e.r+e.g+e.b<1),this._toolbar.addButtons(t)}initVRMode(){this._dolly=new ap,this._scene.add(this._dolly),this._standingMatrix=new Vc,this._raycasterEnd=new gc,this._raycasterOrigin=new gc,navigator.getVRDisplays().then((t=>{let e=t[0];e&&(this._renderer.vr.setDevice(e),this._vrDisplay=e,e.stageParameters&&this._standingMatrix.fromArray(e.stageParameters.sittingToStandingTransform),this.initVRControllersGeometry())}))}initVRControllersGeometry(){let t=new Bg(.025,18,36),e=new ou({color:"grey",vertexColors:!1}),i=new ou({color:"fuchsia",vertexColors:!1}),n=new Rd(.001,.001,2),r=new Tu(n,i),s=new Tu(n,i),a=new Tu(t,e),o=new Tu(t,e);this._controllersMeshes=[],this._controllersMeshes.push(a),this._controllersMeshes.push(o),r.position.z-=1,s.position.z-=1,a.add(r),o.add(s),this._dolly.add(a),this._dolly.add(o),a.visible=!1,o.visible=!1}updateVRControllersList(){let t=navigator.getGamepads&&navigator.getGamepads();if(!this.vrControllers||t.length!==this.vrControllers.length){this._controllersMeshes.forEach((t=>{t.visible=!1})),this._vrControllers=[];for(let e=0;e<t.length;++e)t[e]&&t[e].pose&&(this._vrControllers.push({gamepad:t[e],mesh:this._controllersMeshes[e]}),this._controllersMeshes[e].visible=!0)}}processVRControllerIntersections(){let t=[];for(let e=0;e<this._vrControllers.length;++e){let i=this._vrControllers[e].mesh,n=i.localToWorld(this._raycasterEnd.set(0,0,-1)),r=i.localToWorld(this._raycasterOrigin.set(0,0,0));n.sub(r).normalize(),t=t.concat(this._controls.getOriginDirectionIntersects(r,n))}t=t.filter((function(e,i){return t.indexOf(e)===i})),this._controls.processMouseMove(t)}updateVRControllers(){this.updateVRControllersList();for(let t=0;t<this._vrControllers.length;++t){let e=this._vrControllers[t],i=e.gamepad.pose.orientation,n=e.gamepad.pose.position,r=e.mesh;i&&r.quaternion.fromArray(i),n&&r.position.fromArray(n),r.updateMatrix(),r.applyMatrix4(this._standingMatrix),r.matrixWorldNeedsUpdate=!0}this.processVRControllerIntersections()}toggleVRMode(){this._vrDisplay&&(this._vrDisplay.isPresenting?this.exitVRMode():(this._previousCameraPosition=this._camera.position.clone(),this._previousCameraRotation=this._camera.rotation.clone(),this._vrDisplay.requestPresent([{source:this._renderer.domElement}]).then((()=>{this._previousCameraNear=this._camera.near,this._dolly.position.set(this._camera.position.x/4,-this._camera.position.y/8,-this._camera.position.z/4),this._camera.position.set(0,0,0),this._dolly.add(this._camera),this._camera.near=.1,this._camera.updateProjectionMatrix(),this._renderer.vr.enabled=!0,this._renderer.setAnimationLoop((()=>{this.updateVRControllers(),this.render3D(0)}))})),this._renderer.vr.enabled=!0,window.addEventListener("keydown",(t=>{27===t.keyCode&&this.exitVRMode()}))))}exitVRMode(){this._vrDisplay.isPresenting&&(this._renderer.vr.enabled=!1,this._dolly.remove(this._camera),this._scene.add(this._camera),this._camera.position.copy(this._previousCameraPosition),this._previousCameraPosition=void 0,this._camera.rotation.copy(this._previousCameraRotation),this._previousCameraRotation=void 0,this._camera.near=this._previousCameraNear,this._camera.updateProjectionMatrix(),this._vrDisplay.exitPresent())}getGeometry(){return this.getObject()}modifyVisisbility(t,e){if(0!==cM(this.getGeometry()))return;if(""==t)return sM(this.getGeometry().fVolume,nM.kVisThis,"+"===e);let i,n=!1;t.indexOf("*")<0?(i=new RegExp("^"+t+"$"),n=!0):(i=new RegExp("^"+t.split("*").join(".*")+"$"),n=!1),this.findNodeWithVolume(i,(function(t){return oM(t.node.fVolume,"+"!==e),n?t:null}))}decodeOptions(t){"string"!=typeof t&&(t="");let e={_grid:!1,_bound:!1,_debug:!1,_full:!1,_axis:0,_count:!1,wireframe:!1,scale:new gc(1,1,1),zoom:1,rotatey:0,rotatez:0,more:1,maxlimit:1e5,vislevel:void 0,maxnodes:void 0,dflt_colors:!1,use_worker:!1,show_controls:!1,highlight:!1,highlight_scene:!1,no_screen:!1,project:"",is_main:!1,tracks:!1,showtop:!1,can_rotate:!0,ortho_camera:!1,clipx:!1,clipy:!1,clipz:!1,usessao:!1,usebloom:!0,outline:!1,script_name:"",transparency:0,rotate:!1,background:"#FFFFFF",depthMethod:"dflt",mouse_tmout:50,trans_radial:0,trans_z:0},i=S();"true"==i.get("_grid")&&(e._grid=!0);let n=i.get("_debug");"true"==n&&(e._debug=!0,e._grid=!0),"bound"==n&&(e._debug=!0,e._grid=!0,e._bound=!0),"full"==n&&(e._debug=!0,e._grid=!0,e._full=!0,e._bound=!0);let r=t.indexOf("macro:");if(r>=0){let i=t.indexOf(";",r+6);i<0&&(i=t.length),e.script_name=t.slice(r+6,i),t=t.slice(0,r)+t.slice(i+1),console.log("script",e.script_name,"rest",t)}for(;;){let e=t.indexOf("+"),i=t.indexOf("-");if(e<0&&i<0)break;let n=e,r="+";(n<0||i>=0&&i<e)&&(n=i,r="-");let s=n+1,a=new RegExp("[,; .]");for(;s<t.length&&!a.test(t[s])&&"+"!=t[s]&&"-"!=t[s];)s++;let o=t.substring(n+1,s);t=t.slice(0,n)+t.slice(s),this.modifyVisisbility(o,r)}let s=new sl(t);if(s.check("MAIN")&&(e.is_main=!0),s.check("TRACKS")&&(e.tracks=!0),s.check("SHOWTOP")&&(e.showtop=!0),s.check("NO_SCREEN")&&(e.no_screen=!0),s.check("ORTHO_CAMERA_ROTATE")&&(e.ortho_camera=!0,e.can_rotate=!0),s.check("ORTHO_CAMERA")&&(e.ortho_camera=!0,e.can_rotate=!1),s.check("MOUSE_CLICK")&&(e.mouse_click=!0),(s.check("DEPTHRAY")||s.check("DRAY"))&&(e.depthMethod="ray"),(s.check("DEPTHBOX")||s.check("DBOX"))&&(e.depthMethod="box"),(s.check("DEPTHPNT")||s.check("DPNT"))&&(e.depthMethod="pnt"),(s.check("DEPTHSIZE")||s.check("DSIZE"))&&(e.depthMethod="size"),(s.check("DEPTHDFLT")||s.check("DDFLT"))&&(e.depthMethod="dflt"),s.check("ZOOM",!0)&&(e.zoom=s.partAsFloat(0,100)/100),s.check("ROTY",!0)&&(e.rotatey=s.partAsFloat()),s.check("ROTZ",!0)&&(e.rotatez=s.partAsFloat()),s.check("VISLVL",!0)&&(e.vislevel=s.partAsInt()),s.check("BLACK")&&(e.background="#000000"),s.check("WHITE")&&(e.background="#FFFFFF"),s.check("BKGR_",!0)){let t=null;if(s.partAsInt(1)>0)t=Fl(s.partAsInt());else for(let e=0;e<8;++e)Fl(e).toUpperCase()===s.part&&(t=Fl(e));t&&(e.background="#"+new ac(t).getHexString())}return s.check("R3D_",!0)&&(e.Render3D=f.Render3D.fromString(s.part.toLowerCase())),s.check("MORE3")&&(e.more=3),s.check("MORE")&&(e.more=2),s.check("ALL")&&(e.more=10,e.vislevel=9),(s.check("CONTROLS")||s.check("CTRL"))&&(e.show_controls=!0),s.check("CLIPXYZ")&&(e.clipx=e.clipy=e.clipz=!0),s.check("CLIPX")&&(e.clipx=!0),s.check("CLIPY")&&(e.clipy=!0),s.check("CLIPZ")&&(e.clipz=!0),s.check("CLIP")&&(e.clipx=e.clipy=e.clipz=!0),s.check("PROJX",!0)&&(e.project="x",s.partAsInt(1)>0&&(e.projectPos=s.partAsInt()),e.can_rotate=!1),s.check("PROJY",!0)&&(e.project="y",s.partAsInt(1)>0&&(e.projectPos=s.partAsInt()),e.can_rotate=!1),s.check("PROJZ",!0)&&(e.project="z",s.partAsInt(1)>0&&(e.projectPos=s.partAsInt()),e.can_rotate=!1),(s.check("DFLT_COLORS")||s.check("DFLT"))&&(e.dflt_colors=!0),s.check("SSAO")&&(e.usessao=!0),s.check("NOBLOOM")&&(e.usebloom=!1),s.check("BLOOM")&&(e.usebloom=!0),s.check("OUTLINE")&&(e.outline=!0),s.check("NOWORKER")&&(e.use_worker=-1),s.check("WORKER")&&(e.use_worker=1),(s.check("NOHIGHLIGHT")||s.check("NOHIGH"))&&(e.highlight_scene=e.highlight=0),s.check("HIGHLIGHT")&&(e.highlight_scene=e.highlight=!0),s.check("HSCENEONLY")&&(e.highlight_scene=!0,e.highlight=0),s.check("NOHSCENE")&&(e.highlight_scene=0),s.check("HSCENE")&&(e.highlight_scene=!0),(s.check("WIREFRAME")||s.check("WIRE"))&&(e.wireframe=!0),s.check("ROTATE")&&(e.rotate=!0),(s.check("INVX")||s.check("INVERTX"))&&(e.scale.x=-1),(s.check("INVY")||s.check("INVERTY"))&&(e.scale.y=-1),(s.check("INVZ")||s.check("INVERTZ"))&&(e.scale.z=-1),s.check("COUNT")&&(e._count=!0),s.check("TRANSP",!0)&&(e.transparency=s.partAsInt(0,100)/100),s.check("OPACITY",!0)&&(e.transparency=1-s.partAsInt(0,100)/100),(s.check("AXISCENTER")||s.check("AC"))&&(e._axis=2),s.check("TRR",!0)&&(e.trans_radial=s.partAsInt()/100),s.check("TRZ",!0)&&(e.trans_z=s.partAsInt()/100),(s.check("AXIS")||s.check("A"))&&(e._axis=!0),s.check("D")&&(e._debug=!0),s.check("G")&&(e._grid=!0),s.check("B")&&(e._bound=!0),s.check("W")&&(e.wireframe=!0),s.check("F")&&(e._full=!0),s.check("Y")&&(e._yup=!0),s.check("Z")&&(e._yup=!1),void 0===e._yup&&(e._yup=this.getCanvSvg().empty()),e}activateInBrowser(t,e){"string"==typeof t&&(t=[t]),this._hpainter&&(this._hpainter.activateItems(t,e),this.ctrl.update_browser||setTimeout((()=>this._hpainter.activateItems([])),2e3))}testMatrixes(){let t=0,e=0,i=0,n={domatrix:!0,func:()=>{let n=this.getmatrix(),r=this.CopyStack(),s=this._clones.createObject3D(r.stack,this._toplevel,"mesh");if(!s)return!0;e++;let a,o=s.matrixWorld;if(o.equals(n))return!0;if(o.determinant()>0&&n.determinant()<-.9&&(a=new gc(1,1,-1),n=n.clone().scale(a),o.equals(n)))return!0;let l=0;for(let t=0;t<16;++t)l=Math.max(l,Math.abs(o.elements[t]-n.elements[t]));return i=Math.max(l,i),l<1e-4||(console.log(this._clones.resolveStack(r.stack).name,"maxdiff",l,"determ",o.determinant(),n.determinant()),t++,!1)}},r=(new Date).getTime();this._clones.scanVisible(n);let s=(new Date).getTime();console.log(`Compare matrixes total ${e} errors ${t} takes ${s-r} maxdiff ${i}`)}fillContextMenu(t){t.add("header: Draw options"),t.addchk(this.ctrl.update_browser,"Browser update",(()=>{this.ctrl.update_browser=!this.ctrl.update_browser,this.ctrl.update_browser||this.activateInBrowser([])})),t.addchk(this.ctrl.show_controls,"Show Controls",(()=>this.showControlOptions("toggle"))),t.addchk(this.ctrl._axis,"Show axes",(()=>this.setAxesDraw("toggle"))),this.geo_manager&&t.addchk(this.ctrl.showtop,"Show top volume",(()=>this.setShowTop(!this.ctrl.showtop))),t.addchk(this.ctrl.wireframe,"Wire frame",(()=>this.toggleWireFrame())),t.addchk(this.ctrl.highlight,"Highlight volumes",(()=>{this.ctrl.highlight=!this.ctrl.highlight})),t.addchk(this.ctrl.highlight_scene,"Highlight scene",(()=>{this.ctrl.highlight_scene=!this.ctrl.highlight_scene})),t.add("Reset camera position",(()=>this.focusCamera())),this._geom_viewer||t.add("Get camera position",(()=>t.info("Position (as url)","&opt="+this.produceCameraUrl()))),this.ctrl.project||t.addchk(this.ctrl.rotate,"Autorotate",(()=>this.setAutoRotate(!this.ctrl.rotate))),t.addchk(this.ctrl.select_in_view,"Select in view",(()=>{this.ctrl.select_in_view=!this.ctrl.select_in_view,this.ctrl.select_in_view&&this.startDrawGeometry()}))}changedGlobalTransparency(t,e){let i="function"==typeof t?t:null;(i||void 0===t)&&(t=this.ctrl.transparency),this._toplevel.traverse((function(e){if(e&&e.material&&void 0!==e.material.inherentOpacity){let n=i?i(e):void 0;e.material.opacity=void 0!==n?1-n:Math.min(1-(t||0),e.material.inherentOpacity),e.material.transparent=e.material.opacity<1}})),e||this.render3D(-1)}resetTransformation(){this.changedTransformation("reset")}changedTransformation(t){if(!this._toplevel)return;let e=this.ctrl,i=new Vc,n=new gc;"reset"==t&&(e.trans_z=e.trans_radial=0),this._toplevel.traverse((r=>{if(void 0===r.stack)return;let s=r.parent;if("reset"==t)return s.matrix0&&(s.matrix.copy(s.matrix0),s.matrix.decompose(s.position,s.quaternion,s.scale),s.matrixWorldNeedsUpdate=!0),delete s.matrix0,delete s.vect0,delete s.vect1,void delete s.minvert;if(void 0===s.vect0){s.matrix0=s.matrix.clone(),s.minvert=(new Vc).copy(s.matrixWorld).invert();let t=kM(r,null,!0),e=r._flippedMesh?-1:1;s.vect0=new gc((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2,e*(t.max.z+t.min.z)/2).applyMatrix4(s.matrixWorld),s.vect1=new gc(0,0,0).applyMatrix4(s.minvert)}n.set(e.trans_radial*s.vect0.x,e.trans_radial*s.vect0.y,e.trans_z*s.vect0.z).applyMatrix4(s.minvert).sub(s.vect1),s.matrix.multiplyMatrices(s.matrix0,i.makeTranslation(n.x,n.y,n.z)),s.matrix.decompose(s.position,s.quaternion,s.scale),s.matrixWorldNeedsUpdate=!0})),this._toplevel.updateMatrixWorld(),"norender"!=t&&this.drawSimpleAxis()}changedAutoRotate(){this.autorotate(2.5)}changedAxes(){"string"==typeof this.ctrl._axis&&(this.ctrl._axis=parseInt(this.ctrl._axis)),this.drawSimpleAxis()}changedBackground(t){if(void 0!==t&&(this.ctrl.background=t),this._renderer.setClearColor(this.ctrl.background,1),this.render3D(0),this._toolbar){let t=new ac(this.ctrl.background);this._toolbar.changeBrightness(t.r+t.g+t.b<1)}}changedSSAO(){this.ctrl.ssao.enabled?(this.createSSAO(),this._ssaoPass.output=parseInt(this.ctrl.ssao.output),this._ssaoPass.kernelRadius=this.ctrl.ssao.kernelRadius,this._ssaoPass.minDistance=this.ctrl.ssao.minDistance,this._ssaoPass.maxDistance=this.ctrl.ssao.maxDistance):this.removeSSAO(),this.updateClipping(),this._slave_painters&&this._slave_painters.forEach((t=>{Object.assign(t.ctrl.ssao,this.ctrl.ssao),t.changedSSAO()}))}showControlOptions(t){this.ctrl&&("toggle"===t?t=!this._datgui:void 0===t&&(t=this.ctrl.show_controls),this.ctrl.show_controls=t,this._datgui?t||(this._datgui.domElement.remove(),this._datgui.destroy(),delete this._datgui):t&&Promise.resolve().then((function(){return JC})).then((t=>this.buildDatGui(t))))}buildDatGui(t){if(!this._renderer)return;if(!t)throw Error("Fail to load dat.gui");this._datgui=new t.GUI({autoPlace:!1,width:Math.min(650,this._renderer.domElement.width/2)});let e=this.selectDom();"static"==e.style("position")&&e.style("position","relative");let i=this._datgui.domElement;if(i.style.position="absolute",i.style.top=0,i.style.right=0,e.node().appendChild(i),this._datgui.painter=this,this.ctrl.project){let t=this.getGeomBoundingBox(this.getProjectionSource(),.01),e=this.ctrl.project;void 0===this.ctrl.projectPos&&(this.ctrl.projectPos=(t.min[e]+t.max[e])/2),this._datgui.add(this.ctrl,"projectPos",t.min[e],t.max[e]).name(e.toUpperCase()+" projection").onChange(this.startDrawGeometry.bind(this))}else{let t=this._datgui.addFolder("Clipping"),e=this.changedClipping.bind(this,-1);for(let i=0;i<3;++i){let n=this.ctrl.clip[i],r=n.name.toUpperCase();t.add(n,"enabled").name("Enable "+r).listen().onChange(e),t.add(n,"value",n.min,n.max).name(r+" position").onChange(this.changedClipping.bind(this,i))}t.add(this.ctrl,"clipIntersect").name("Clip intersection").listen().onChange(e)}let n=this._datgui.addFolder("Appearance");if(n.add(this.ctrl,"highlight").name("Highlight Selection").listen().onChange(this.changedHighlight.bind(this)),n.add(this.ctrl,"transparency",0,1,.001).listen().onChange(this.changedGlobalTransparency.bind(this)),n.addColor(this.ctrl,"background").name("Background").onChange(this.changedBackground.bind(this)),n.add(this.ctrl,"wireframe").name("Wireframe").listen().onChange(this.changedWireFrame.bind(this)),this.ctrl._axis_cfg=0,n.add(this.ctrl,"_axis",{none:0,show:1,center:2}).name("Axes").onChange(this.changedAxes.bind(this)),this.ctrl.project||n.add(this.ctrl,"rotate").name("Autorotate").listen().onChange(this.changedAutoRotate.bind(this)),n.add(this,"focusCamera").name("Reset camera position"),this._webgl){let t=this._datgui.addFolder("Advanced"),e={};this.ctrl.depthMethodItems.forEach((t=>{e[t.name]=t.value})),t.add(this.ctrl,"depthTest").name("Depth test").listen().onChange(this.changedDepthTest.bind(this)),t.add(this.ctrl,"depthMethod",e).name("Rendering order").onChange(this.changedDepthMethod.bind(this)),t.add(this.ctrl,"ortho_camera").name("Orhographic camera").listen().onChange((()=>this.changeCamera())),t.add(this,"resetAdvanced").name("Reset")}if(!this.ctrl.project){let t=this._datgui.addFolder("Transform");t.add(this.ctrl,"trans_z",0,3,.01).name("Z axis").listen().onChange(this.changedTransformation.bind(this)),t.add(this.ctrl,"trans_radial",0,3,.01).name("Radial").listen().onChange(this.changedTransformation.bind(this)),t.add(this,"resetTransformation").name("Reset"),(this.ctrl.trans_z||this.ctrl.trans_radial)&&t.open()}if(this.ctrl.outline)return;let r=this._datgui.addFolder("Smooth Lighting (SSAO)"),s=this.changedSSAO.bind(this),a={};this.ctrl.ssao.outputItems.forEach((t=>{a[t.name]=t.value})),r.add(this.ctrl.ssao,"enabled").name("Enable SSAO").listen().onChange(s),r.add(this.ctrl.ssao,"output",a).listen().onChange(s),r.add(this.ctrl.ssao,"kernelRadius",0,32).listen().onChange(s),r.add(this.ctrl.ssao,"minDistance",.001,.02).listen().onChange(s),r.add(this.ctrl.ssao,"maxDistance",.01,.3).listen().onChange(s);let o=this._datgui.addFolder("Unreal Bloom"),l=this.changedBloomSettings.bind(this);o.add(this.ctrl.bloom,"enabled").name("Enable Blooming").listen().onChange(l),o.add(this.ctrl.bloom,"strength",0,3).name("Strength").listen().onChange(l)}changedBloomSettings(){this.ctrl.bloom.enabled?(this.createBloom(),this._bloomPass.strength=this.ctrl.bloom.strength):this.removeBloom(),this._slave_painters&&this._slave_painters.forEach((t=>{Object.assign(t.ctrl.bloom,this.ctrl.bloom),t.changedBloomSettings()}))}changeCamera(){this._controls&&(this._controls.cleanup(),delete this._controls),this.removeBloom(),this.removeSSAO(),this.createCamera(),this.createSpecialEffects(),this._first_drawing=!0,this.startDrawGeometry(!0)}createBloom(){this._bloomPass||(this._camera.layers.enable(1),this._bloomComposer=new cy(this._renderer),this._bloomComposer.addPass(new uy(this._scene,this._camera)),this._bloomPass=new yy(new Zh(window.innerWidth,window.innerHeight),1.5,.4,.85),this._bloomPass.threshold=0,this._bloomPass.strength=this.ctrl.bloom.strength,this._bloomPass.radius=0,this._bloomPass.renderToScreen=!0,this._bloomComposer.addPass(this._bloomPass),this._renderer.autoClear=!1)}removeBloom(){this._bloomPass&&(delete this._bloomPass,delete this._bloomComposer,this._renderer.autoClear=!0,this._camera.layers.disable(1))}removeSSAO(){delete this._ssaoPass,delete this._effectComposer}createSSAO(){this._webgl&&(this._ssaoPass||(this._effectComposer||(this._effectComposer=new cy(this._renderer),this._effectComposer.addPass(new uy(this._scene,this._camera))),this._ssaoPass=new _y(this._scene,this._camera,this._scene_width,this._scene_height),this._ssaoPass.kernelRadius=16,this._ssaoPass.renderToScreen=!0,this._effectComposer.addPass(this._ssaoPass)))}orbitContext(t,e){vv(t,this).then((t=>{let i=0,n=0,r=0;if(e)for(let t=0;t<e.length;++t)e[t].object.stack&&n++,e[t].object.geo_name&&i++;if(n+i===0)this.fillContextMenu(t);else{let s=n+i>1;s&&t.add("header:"+(i>0?"Items":"Nodes"));for(let i=0;i<e.length;++i){let n,a,o,l=e[i].object;if(l.geo_name)a=l.geo_name,0==a.indexOf("<prnt>")&&(a=(this.getItemName()||"top")+a.slice(6)),n=a.slice(a.lastIndexOf("/")+1),n||(n=a),o=n;else{if(!l.stack)continue;n=this._clones.resolveStack(l.stack).name,a=this.getStackFullName(l.stack),o=this.getItemName(),0===n.indexOf("Nodes/")?o=n.slice(6):n.length>0?o=n:o||(o="header")}if(t.add((s?"sub:":"header:")+o,a,(t=>this.activateInBrowser([t],!0))),t.add("Browse",a,(t=>this.activateInBrowser([t],!0))),this._hpainter&&t.add("Inspect",a,(t=>this._hpainter.display(t,"inspect"))),l.geo_name){t.add("Hide",i,(i=>{let n=e[i].object;n.visible=!1,n.geo_object&&(n.geo_object.$hidden_via_menu=!0),t.painter.render3D()})),s&&t.add("endsub:");continue}let h=this.accessObjectWireFrame(l);void 0!==h&&t.addchk(h,"Wireframe",i,(function(t){let i=e[t].object.material;i.wireframe=!i.wireframe,this.render3D()})),++r>1&&t.add("Manifest",i,(function(t){this._last_manifest&&(this._last_manifest.wireframe=!this._last_manifest.wireframe),this._last_hidden&&this._last_hidden.forEach((t=>{t.visible=!0})),this._last_hidden=[];for(let i=0;i<t;++i)this._last_hidden.push(e[i].object);this._last_hidden.forEach((t=>{t.visible=!1})),this._last_manifest=e[t].object.material,this._last_manifest.wireframe=!this._last_manifest.wireframe,this.render3D()})),t.add("Focus",i,(function(t){this.focusCamera(e[t].object)})),this._geom_viewer||t.add("Hide",i,(function(i){let n=t.painter._clones.resolveStack(e[i].object.stack);n.obj&&0===n.node.kind&&n.obj.fVolume?(sM(n.obj.fVolume,nM.kVisThis,!1),FM(n.obj.fVolume,this._hpainter)):n.obj&&1===n.node.kind&&(n.obj.fRnrSelf=!1,FM(n.obj,this._hpainter)),this.testGeomChanges()})),s&&t.add("endsub:")}}t.show()}))}filterIntersects(t){if(!t.length)return t;for(let e=0;e<t.length;++e)t[e].object.geo_highlight&&(t[e].object=t[e].object.geo_highlight);for(let e=t.length-1;e>=0;--e){let i=t[e].object,n=void 0!==i.stack||void 0!==i.geo_name;n&&i.material&&void 0!==i.material.opacity&&(n=i.material.opacity>=.1),i.jsroot_special&&(n=!1);for(let r=0;r<e&&n;++r)t[r].object===i&&(n=!1);n||t.splice(e,1)}let e=this.ctrl.clip;if(e[0].enabled||e[1].enabled||e[2].enabled){let i=[];for(let n=0;n<t.length;++n){let r=t[n].point,s="Points"==t[n].object.type,a=!0;e[0].enabled&&this._clipPlanes[0].normal.dot(r)>this._clipPlanes[0].constant^s&&(a=!1),e[1].enabled&&this._clipPlanes[1].normal.dot(r)>this._clipPlanes[1].constant^s&&(a=!1),e[2].enabled&&this._clipPlanes[2].normal.dot(r)>this._clipPlanes[2].constant&&(a=!1),a||i.push(t[n])}t=i}return t}testCameraPositionChange(){if(!this.ctrl.select_in_view||this._draw_all_nodes)return;CM(SM(this._camera)).CheckBox(this.getGeomBoundingBox(this._toplevel))||this.startDrawGeometry()}resolveStack(t){return this._clones&&t?this._clones.resolveStack(t):null}getStackFullName(t){let e=this.getItemName(),i=this.resolveStack(t);return i&&i.name?e?e+"/"+i.name:i.name:e}addHighlightHandler(t){t&&"function"==typeof t.highlightMesh&&(this._highlight_handlers||(this._highlight_handlers=[]),this._highlight_handlers.push(t))}highlightMesh(t,e,i,n,r,s){if(i){t=t?[t]:[];let e=this.getExtrasContainer();e&&e.traverse((e=>{e.geo_object===i&&t.indexOf(e)<0&&t.push(e)}))}else r&&this._toplevel?(t=[],this._toplevel.traverse((e=>{e instanceof Tu&&function(t,e){if(!t||!e)return!1;if(t===e)return!0;if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}(e.stack,r)&&t.push(e)}))):t=t?[t]:[];if(t.length||(t=null),t&&(t[0].geo_object?this.ctrl.highlight_scene||(t=null):this.ctrl.highlight||(t=null)),!s){t&&(i||(i=t[0].geo_object),r||(r=t[0].stack));let s=this._highlight_handlers||(this._main_painter?this._main_painter._slave_painters.concat([this._main_painter]):this._slave_painters);for(let t=0;t<s.length;++t)s[t]!==this&&s[t].highlightMesh(null,e,i,n,r,!0)}let a=this._selected_mesh,o=!1;if(!a&&!t)return!1;const l=t=>t.get_ctrl?t.get_ctrl():new jM(t,this.ctrl.bloom.enabled);if(a&&t&&a.length==t.length){o=!0;for(let e=0;e<a.length&&o;++e)(a[e]!==t[e]||l(a[e]).checkHighlightIndex(n))&&(o=!1)}if(o)return!!a;if(a)for(let t=0;t<a.length;++t)l(a[t]).setHighlight();if(this._selected_mesh=t,t)for(let i=0;i<t.length;++i)l(t[i]).setHighlight(e||65280,n);return this.render3D(0),!!t}processMouseClick(t,e,i){if(!e.length)return;let n=e[0].object;if(!n.get_ctrl)return;let r=n.get_ctrl(),s=r.extractIndex(e[0]);r.evnt=i,r.setSelected("blue",s)&&this.render3D(),r.evnt=null}setMouseTmout(t){this.ctrl&&(this.ctrl.mouse_tmout=t),this._controls&&(this._controls.mouse_tmout=t)}setDepthMethod(t){this.ctrl&&(this.ctrl.depthMethod=t)}addOrbitControls(){if(this._controls||!this._webgl||l())return;let t=this;this.setTooltipAllowed(m.Tooltip),this._controls=Uy(this,this._camera,this._scene,this._renderer,this._lookat),this._controls.mouse_tmout=this.ctrl.mouse_tmout,this.ctrl.can_rotate||(this._controls.enableRotate=!1),this._controls.contextMenu=this.orbitContext.bind(this),this._controls.processMouseMove=function(e){if(!t.ctrl||!t._controls)return;let i,n,r=null,s=null,a=null,o=[];for(let l=0;l<e.length;++l){let h=e[l].object,c=null;h&&(h.geo_object?c=h.geo_name:h.stack&&(c=t.getStackFullName(h.stack)),c&&(0==c.indexOf("<prnt>")&&(c=t.getItemName()+c.slice(6)),o.push(c),r||(r=h,s=c,i=h.geo_object,h.get_ctrl&&(n=h.get_ctrl().extractIndex(e[l]),void 0!==n&&"string"==typeof s&&(s+=" indx:"+JSON.stringify(n))),r.stack&&(a=t.resolveStack(r.stack)))))}if(t.highlightMesh(r,void 0,i,n),t.ctrl.update_browser&&(t.ctrl.highlight&&s&&(o=[s]),t.activateInBrowser(o)),!a||!a.obj)return s;let l=TM(a.obj);return l.unshift(s),{name:a.obj.fName,title:a.obj.fTitle||a.obj._typename,lines:l}},this._controls.processMouseLeave=function(){this.processMouseMove([])},this._controls.processDblClick=function(){t.ctrl&&t._controls&&(t._last_manifest?(t._last_manifest.wireframe=!t._last_manifest.wireframe,t._last_hidden&&t._last_hidden.forEach((t=>{t.visible=!0})),delete t._last_hidden,delete t._last_manifest,t.render3D()):t.adjustCameraPosition())}}addTransformControl(){this._tcontrols||(this.ctrl._debug||this.ctrl._grid)&&(this._tcontrols=new Ox(this._camera,this._renderer.domElement),this._scene.add(this._tcontrols),this._tcontrols.attach(this._toplevel),window.addEventListener("keydown",(t=>{switch(t.keyCode){case 81:this._tcontrols.setSpace("local"===this._tcontrols.space?"world":"local");break;case 17:this._tcontrols.setTranslationSnap(Math.ceil(this._overall_size)/50),this._tcontrols.setRotationSnap(Wh.degToRad(15));break;case 84:this._tcontrols.setMode("translate");break;case 82:this._tcontrols.setMode("rotate");break;case 83:this._tcontrols.setMode("scale");break;case 187:case 107:this._tcontrols.setSize(this._tcontrols.size+.1);break;case 189:case 109:this._tcontrols.setSize(Math.max(this._tcontrols.size-.1,.1))}})),window.addEventListener("keyup",(function(t){if(17===t.keyCode)this._tcontrols.setTranslationSnap(null),this._tcontrols.setRotationSnap(null)})),this._tcontrols.addEventListener("change",(()=>this.render3D(0))))}nextDrawAction(){if(!this._clones||0==this.drawing_stage)return!1;if(1==this.drawing_stage){if(this._geom_viewer)return this._draw_all_nodes=!1,this.drawing_stage=3,!0;if(this.ctrl.use_worker>0){if(!this._worker)return this.startWorker(),1;if(!this._worker_ready)return 1}let e=this._clones.countVisibles()||this._clones.markVisibles(),i=null,n=null;this.ctrl.select_in_view&&!this._first_drawing&&(i=SM(this._camera),n=CM(i),n.CheckBox(this.getGeomBoundingBox(this._toplevel))&&(i=null,n=null)),this._current_face_limit=this.ctrl.maxlimit,i&&(this._current_face_limit*=1.25);let r=!l()&&d.isChrome&&(e>1e4||i&&this._clones.scanVisible()>1e5);if(r&&0==t.source_dir.indexOf("file://")&&(console.log("disable worker for jsroot from file system"),r=!1),r&&!this._worker&&this.ctrl.use_worker>=0&&this.startWorker(),!r||!this._worker_ready){let t=this._clones.collectVisibles(this._current_face_limit,n);return this._new_draw_nodes=t.lst,this._draw_all_nodes=t.complete,this.drawing_stage=3,!0}let s={collect:this._current_face_limit,flags:this._clones.getVisibleFlags(),matrix:i?i.elements:null};return this.submitToWorker(s),this.drawing_stage=2,this.drawing_log="Worker select visibles",2}if(2==this.drawing_stage)return this.drawing_log="Worker select visibles",2;if(3==this.drawing_stage){if(this.drawing_log="Analyse visibles",this._new_append_nodes)this._new_draw_nodes=this._draw_nodes.concat(this._new_append_nodes),delete this._new_append_nodes;else if(this._draw_nodes){let t;t=this._geom_viewer?this._draw_nodes:this._clones.mergeVisibles(this._new_draw_nodes,this._draw_nodes);for(let e=0;e<t.length;++e)this._clones.createObject3D(t[e].stack,this._toplevel,"delete_mesh");t.length>0&&(this.drawing_log="Delete "+t.length+" nodes")}return this._draw_nodes=this._new_draw_nodes,delete this._new_draw_nodes,this.drawing_stage=4,!0}if(4===this.drawing_stage){this.drawing_log="Collect shapes";let t=this._clones.collectShapes(this._draw_nodes);return this._build_shapes=this._clones.mergeShapesLists(this._build_shapes,t),this.drawing_stage=5,!0}if(5===this.drawing_stage){if(this.canSubmitToWorker()){let t={limit:this._current_face_limit,shapes:[]},e=0;for(let i=0;i<this._build_shapes.length;++i){let n=null,r=this._build_shapes[i];r.ready||r.geom?n={id:r.id,ready:!0,nfaces:bM(r.geom),refcnt:r.refcnt}:(n=A(r,null,!0),e++),t.shapes.push(n)}if(e>0)return this.submitToWorker(t),this.drawing_log="Worker build shapes",this.drawing_stage=6,2}this.drawing_stage=7}if(6===this.drawing_stage)return 2;if(7===this.drawing_stage||8===this.drawing_stage){if(7===this.drawing_stage){let t=this._clones.buildShapes(this._build_shapes,this._current_face_limit,500);if(t.done)this.ctrl.info.num_shapes=this._build_shapes.length,this.drawing_stage=8;else if(this.ctrl.info.num_shapes=t.shapes,this.drawing_log="Creating: "+t.shapes+" / "+this._build_shapes.length+" shapes,  "+t.faces+" faces",t.notusedshapes<30)return!0}let t=(new Date).getTime(),e=!0,i=this.ctrl.project?this._full_geom:this._toplevel;for(let n=0;n<this._draw_nodes.length;++n){let r=this._draw_nodes[n];if(r.done)continue;let s=r.server_shape||this._build_shapes[r.shapeid];if(s.ready){if(r.done=!0,s.used=!0,this.createEntryMesh(r,s,i)&&(this.ctrl.info.num_meshes++,this.ctrl.info.num_faces+=s.nfaces),(new Date).getTime()-t>500){e=!1;break}}else 8===this.drawing_stage&&console.warn("shape marked as not ready when should"),e=!1}return e?this.ctrl.project?(this.drawing_log="Build projection",this.drawing_stage=10,!0):(this.drawing_log="Building done",this.drawing_stage=0,!1):(this.drawing_stage>7&&(this.drawing_log="Building meshes "+this.ctrl.info.num_meshes+" / "+this.ctrl.info.num_faces),!0)}if(9===this.drawing_stage){if(!this._main_painter)return console.warn("MAIN PAINTER DISAPPER"),this.drawing_stage=0,!1;if(!this._main_painter._drawing_ready)return 1;this.drawing_stage=10}return 10===this.drawing_stage?(this.doProjection(),this.drawing_log="Building done",this.drawing_stage=0,!1):(console.error("never come here stage = "+this.drawing_stage),!1)}createEntryMesh(t,e,i){if(!e.geom||0===e.nfaces)return this._clones.createObject3D(t.stack,i,"delete_mesh"),!1;this._splitColors&&t.stack&&(0===t.stack[0]?t.custom_color="green":1===t.stack[0]&&(t.custom_color="blue"));let n,r=this._clones.getDrawEntryProperties(t,Rl()),s=this._clones.createObject3D(t.stack,i,this.ctrl);if(r.material.wireframe=this.ctrl.wireframe,r.material.side=this.ctrl.bothSides?2:0,n=(s.absMatrix||s.matrixWorld).determinant()>-.9?new Tu(e.geom,r.material):EM(e,r.material),s.add(n),s.absMatrix&&(n.matrix.copy(s.absMatrix),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld()),n.stack=t.stack,n.renderOrder=this._clones.maxdepth-t.stack.length,n.$jsroot_order=s.$jsroot_depth,this.ctrl._debug||this.ctrl._full){let t=new Fg(n.geometry),e=new pp({color:r.fillcolor,linewidth:r.linewidth||1}),i=new Mp(t,e);s.add(i)}if(this.ctrl._bound||this.ctrl._full){let t=new sx(n);s.add(t)}return!0}appendMoreNodes(t,e){if(this.drawing_stage&&!e)return void(this._provided_more_nodes=t);if(this._more_nodes)for(let t=0;t<this._more_nodes.length;++t){let e=this._more_nodes[t];Gy(this._clones.createObject3D(e.stack,this._toplevel,"delete_mesh")),(i=e.server_shape)&&(i.geom&&"function"==typeof i.geom.dispose&&i.geom.dispose(),i.geomZ&&"function"==typeof i.geomZ.dispose&&i.geomZ.dispose(),delete i.geom,delete i.geomZ),delete e.server_shape}var i;if(delete this._more_nodes,!t)return;let n=[];for(let e=0;e<t.length;++e){let i=t[e],r=i.server_shape;r&&r.ready&&(i.done=!0,r.used=!0,this.createEntryMesh(i,r,this._toplevel)&&n.push(i))}n.length>0&&(this._more_nodes=n),e||this.render3D()}getProjectionSource(){return this._clones_owner?this._full_geom:this._main_painter?this._main_painter._drawing_ready?this._main_painter._toplevel:(console.warn("MAIN PAINTER NOT READY WHEN DO PROJECTION"),null):(console.warn("MAIN PAINTER DISAPPER"),null)}getGeomBoundingBox(t,e){let i=new yc,n=!this._clones;return t?(i.makeEmpty(),t.traverse((t=>{(n||t.stack&&t instanceof Tu||t.main_track&&t instanceof Mp)&&kM(t,i)})),void 0!==e&&i.expandByVector(i.getSize(new gc).multiplyScalar(e)),i):(i.min.x=i.min.y=i.min.z=-1,i.max.x=i.max.y=i.max.z=1,i)}doProjection(){let t=this.getProjectionSource();if(!t)return!1;if(Gy(this._toplevel,!0),void 0===this.ctrl.projectPos){let e=this.getGeomBoundingBox(t),i=e.min[this.ctrl.project],n=e.max[this.ctrl.project],r=(i+n)/2;i<0&&n>0&&Math.abs(r)<.2*Math.max(-i,n)&&(r=0),this.ctrl.projectPos=r}return t.traverse((t=>{if(!(t instanceof Tu&&t.stack))return;let e=wM(t.geometry,t.parent.absMatrix||t.parent.matrixWorld,this.ctrl.project,this.ctrl.projectPos,t._flippedMesh);if(!e)return;let i=new Tu(e,t.material.clone());this._toplevel.add(i),i.stack=t.stack})),!0}changedLight(t){if(!this._camera)return;let e=!t;t||(t=this.getGeomBoundingBox(this._toplevel));let i=t.max.x-t.min.x,n=t.max.y-t.min.y,r=t.max.z-t.min.z,s=[],a=this.ctrl.light.power;if(void 0===a&&(a=1),this._camera._lights!=this.ctrl.light.kind)switch(Gy(this._camera,!0),this._camera._lights=this.ctrl.light.kind,this._camera._lights){case"ambient":this._camera.add(new G_(15724527,a));break;case"hemisphere":this._camera.add(new D_(16777147,526368,a));break;default:for(let t=0;t<6;++t)this._camera.add(new q_(15724527,a))}for(let t=0;t<this._camera.children.length;++t){let e=this._camera.children[t],o=!1;if(e.isAmbientLight||e.isHemisphereLight)e.intensity=a;else if(e.isPointLight){switch(t){case 0:e.position.set(i/5,n/5,r/5),o=this.ctrl.light.specular;break;case 1:e.position.set(0,0,r/2),o=this.ctrl.light.front;break;case 2:e.position.set(0,2*n,0),o=this.ctrl.light.top;break;case 3:e.position.set(0,-2*n,0),o=this.ctrl.light.bottom;break;case 4:e.position.set(-2*i,0,0),o=this.ctrl.light.left;break;case 5:e.position.set(2*i,0,0),o=this.ctrl.light.right}e.power=o?a*Math.PI*4:0,o&&s.push(e)}}s.forEach((t=>{t.power=4*a*Math.PI/s.length})),e&&this.render3D()}createCamera(){this._camera&&(this._scene.remove(this._camera),Gy(this._camera),delete this._camera),this.ctrl.ortho_camera?this._camera=new Uu(-this._scene_width/2,this._scene_width/2,this._scene_height/2,-this._scene_height/2,1,1e4):(this._camera=new Bu(25,this._scene_width/this._scene_height,1,1e4),this._camera.up=this.ctrl._yup?new gc(0,1,0):new gc(0,0,1));let t=new q_(15724527,1);t.position.set(10,10,10),this._camera.add(t),this._scene.add(this._camera)}createSpecialEffects(){this._webgl&&(this.ctrl.ssao.enabled||this.ctrl.outline)&&(this.ctrl.outline&&"function"==typeof this.createOutline?(this._effectComposer=new cy(this._renderer),this._effectComposer.addPass(new uy(this._scene,this._camera)),this.createOutline(this._scene_width,this._scene_height)):this.ctrl.ssao.enabled&&this.createSSAO()),this._webgl&&this.ctrl.bloom.enabled&&this.createBloom()}createScene(t,e){if(this._scene=new mp,this._scene.fog=new fp(16777215,1,1e4),this._scene.overrideMaterial=new $g({color:7340287,vertexColors:!1,transparent:!0,opacity:.2,depthTest:!1}),this._scene_width=t,this._scene_height=e,this.createCamera(),this._selected_mesh=null,this._overall_size=10,this._toplevel=new Td,this._scene.add(this._toplevel),this._renderer=Ny(t,e,this.options.Render3D,{antialias:!0,logarithmicDepthBuffer:!1,preserveDrawingBuffer:!0}),this._webgl=this._renderer.jsroot_render3d===f.Render3D.WebGL,this._renderer.setPixelRatio&&!c()&&this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(t,e,!this._fit_main_area),this._renderer.localClippingEnabled=!0,this._renderer.setClearColor(this.ctrl.background,1),this._fit_main_area&&this._webgl){this._renderer.domElement.style.width="100%",this._renderer.domElement.style.height="100%";let t=this.selectDom();"static"==t.style("position")&&t.style("position","relative")}if(this._animating=!1,this.ctrl.bothSides=!1,this._clipPlanes=[new Uc(new gc(1,0,0),0),new Uc(new gc(0,this.ctrl._yup?-1:1,0),0),new Uc(new gc(0,0,this.ctrl._yup?1:-1),0)],this.createSpecialEffects(),this._fit_main_area&&!this._webgl){let i=g().createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("width",t),i.setAttribute("height",e),i.appendChild(this._renderer.jsroot_dom),i}return this._renderer.jsroot_dom}startDrawGeometry(t){t||0===this.drawing_stage?(this._clones_owner&&this._clones&&this._clones.setDefaultColors(this.ctrl.dflt_colors),this._startm=(new Date).getTime(),this._last_render_tm=this._startm,this._last_render_meshes=0,this.drawing_stage=1,this._drawing_ready=!1,this.drawing_log="collect visible",this.ctrl.info.num_meshes=0,this.ctrl.info.num_faces=0,this.ctrl.info.num_shapes=0,this._selected_mesh=null,this.ctrl.project&&(this._clones_owner?this._full_geom?(this.drawing_stage=10,this.drawing_log="build projection"):this._full_geom=new Td:(this.drawing_stage=9,this.drawing_log="wait for main painter")),delete this._last_manifest,delete this._last_hidden,delete this._draw_nodes_again,this.continueDraw()):this._draw_nodes_again=!0}resetAdvanced(){this.ctrl.ssao.kernelRadius=16,this.ctrl.ssao.output=_y.OUTPUT.Default,this.ctrl.depthTest=!0,this.ctrl.clipIntersect=!0,this.ctrl.depthMethod="ray",this.changedDepthMethod("norender"),this.changedDepthTest()}getOverallSize(t){if(!this._overall_size||t){let t=this.getGeomBoundingBox(this._toplevel);if(!Number.isFinite(t.min.x))return 1e3;let e=t.max.x-t.min.x,i=t.max.y-t.min.y,n=t.max.z-t.min.z;this._overall_size=2*Math.max(e,i,n)}return this._overall_size}createSnapshot(t){if(!this._renderer)return;this.render3D(0);let e=this._renderer.domElement.toDataURL("image/png");if("asis"===t)return e;e.replace("image/png","image/octet-stream");let i=g(),n=i.createElement("a");"string"==typeof n.download&&(i.body.appendChild(n),n.download=t||"geometry.png",n.href=e,n.click(),i.body.removeChild(n))}produceCameraUrl(t){if(!(this._lookat&&this._camera0pos&&this._camera&&this.ctrl))return;let e=(new gc).add(this._camera0pos).sub(this._lookat),i=(new gc).add(this._camera.position).sub(this._lookat),n=e.length(),r=i.length(),s=this.ctrl.zoom*r/n*100;s<1?s=1:s>1e4&&(s=1e4),e.normalize(),i.normalize();let a=new pc,o=new cd;a.setFromUnitVectors(e,i),o.setFromQuaternion(a,"YZX");let l=o.y/Math.PI*180,h=o.z/Math.PI*180;return l<0&&(l+=360),h<0&&(h+=360),"roty"+l.toFixed(t||0)+",rotz"+h.toFixed(t||0)+",zoom"+s.toFixed(t||0)}calculateZoom(){if(this._camera0pos&&this._camera&&this._lookat){let t=(new gc).add(this._camera0pos).sub(this._lookat);return(new gc).add(this._camera.position).sub(this._lookat).length()/t.length()}return 0}adjustCameraPosition(t,e){if(!this._toplevel)return;let i=this.getGeomBoundingBox(this._toplevel);if(!Number.isFinite(i.min.x))return;let n=i.max.x-i.min.x,r=i.max.y-i.min.y,s=i.max.z-i.min.z,a=(i.max.x+i.min.x)/2,o=(i.max.y+i.min.y)/2,l=(i.max.z+i.min.z)/2;if(this._overall_size=2*Math.max(n,r,s),this._camera.near=this._overall_size/350,this._camera.far=12*this._overall_size,this._scene.fog.near=2*this._overall_size,this._scene.fog.far=12*this._overall_size,t)for(let t=0;t<3;++t){let e=this.ctrl.clip[t];e.min=i.min[e.name],e.max=i.max[e.name];let n=e.max-e.min;e.max+=.01*n,e.min-=.01*n,e.value?e.value<e.min?e.value=e.min:e.value>e.max&&(e.value=e.max):e.value=(e.min+e.max)/2}this.ctrl.ortho_camera&&(this._camera.left=i.min.x,this._camera.right=i.max.x,this._camera.top=i.max.y,this._camera.bottom=i.min.y),this._camera.updateProjectionMatrix();let h=2*this.ctrl.zoom,c=Math.max(n,r,s);if((this.ctrl.rotatey||this.ctrl.rotatez)&&this.ctrl.can_rotate){let t=this.calculateZoom();e&&t&&(h=2*t);let i=new cd(0,this.ctrl.rotatey/180*Math.PI,this.ctrl.rotatez/180*Math.PI,"YZX");if(this._camera.position.set(-h*c,0,0),this._camera.position.applyEuler(i),this._camera.position.add(new gc(a,o,l)),e&&t){h*=t/this.calculateZoom(),this._camera.position.set(-h*c,0,0),this._camera.position.applyEuler(i),this._camera.position.add(new gc(a,o,l))}}else if(this.ctrl.ortho_camera)this._camera.position.set(a,o,Math.max(n,r));else if(this.ctrl.project)switch(this.ctrl.project){case"x":this._camera.position.set(1.5*h*Math.max(r,s),0,0);break;case"y":this._camera.position.set(0,1.5*h*Math.max(n,s),0);break;case"z":this._camera.position.set(0,0,1.5*h*Math.max(n,r))}else this.ctrl._yup?this._camera.position.set(a-h*Math.max(n,s),o+h*r,l-h*Math.max(n,s)):this._camera.position.set(a-h*Math.max(n,r),o-h*Math.max(n,r),l+h*s);this._lookat=new gc(a,o,l),this._camera0pos=new gc(-2*c,0,0),this._camera.lookAt(this._lookat),this.changedLight(i),this._controls&&(this._controls.target.copy(this._lookat),this._controls.update()),this.ctrl.select_in_view&&this.startDrawGeometry()}setCameraPosition(t,e,i){if(!this.ctrl)return;this.ctrl.rotatey=t||0,this.ctrl.rotatez=e||0;let n=!1;i&&Number.isFinite(i)?this.ctrl.zoom=i:n=!0,this.adjustCameraPosition(!1,n)}focusOnItem(t){if(!t||!this._clones)return;let e=this._clones.findStackByName(t);if(!e)return;let i=this._clones.resolveStack(e,!0);this.focusCamera(i,!1)}focusCamera(t,e){if(this.ctrl.project||this.ctrl.ortho_camera)return this.adjustCameraPosition();let i=new yc;if(void 0===t)i=this.getGeomBoundingBox(this._toplevel);else if(t instanceof Tu)i.setFromObject(t);else{let e=(new gc).setFromMatrixPosition(t.matrix),n=t.node,r=new gc(n.fDX,n.fDY,n.fDZ).multiplyScalar(.5);i.min=e.clone().sub(r),i.max=e.clone().add(r)}let n,r=i.max.x-i.min.x,s=i.max.y-i.min.y,a=i.max.z-i.min.z,o=(i.max.x+i.min.x)/2,l=(i.max.y+i.min.y)/2,h=(i.max.z+i.min.z)/2;n=this.ctrl._yup?new gc(o-2*Math.max(r,a),l+2*s,h-2*Math.max(r,a)):new gc(o-2*Math.max(r,s),l-2*Math.max(r,s),h+2*a);let c=new gc(o,l,h),d=this._controls.target,u=50,f=0,m=n.sub(this._camera.position).divideScalar(u),p=c.sub(d).divideScalar(u);if(e=e&&this._webgl){for(let t=0;t<3;++t){let e=this.ctrl.clip[t];e.enabled||(e.value=e.min,e.enabled=!0),e.inc=((e.min+e.max)/2-e.value)/u}this.updateClipping()}this._animating=!0;let g=()=>{if(void 0===this._animating)return;this._animating?requestAnimationFrame(g):this._geom_viewer||this.startDrawGeometry();let t=1-Math.cos(2*Math.PI*f/u);this._camera.position.add(m.clone().multiplyScalar(t)),d.add(p.clone().multiplyScalar(t)),this._lookat=d,this._camera.lookAt(this._lookat),this._camera.updateProjectionMatrix();let i=(new Date).getTime();if(e){for(let e=0;e<3;++e)this.ctrl.clip[e].value+=this.ctrl.clip[e].inc*t;this.updateClipping()}else this.render3D(0);let n=(new Date).getTime();0==f&&n-i>200&&(u=20),f++,this._animating=f<u};g()}autorotate(t){let e=void 0===t?2:t,i=new Date;const n=()=>{if(!this._renderer||!this.ctrl)return;let t=new Date;this.ctrl.rotate&&requestAnimationFrame(n),this._controls&&(this._controls.autoRotate=this.ctrl.rotate,this._controls.autoRotateSpeed=e*(t.getTime()-i.getTime())/16.6666,this._controls.update()),i=new Date,this.render3D(0)};this._webgl&&n()}completeScene(){if(this.ctrl._debug||this.ctrl._grid){if(this.ctrl._full){let t=new sx(this._toplevel);this._scene.add(t)}this._scene.add(new ax(2*this._overall_size)),this._scene.add(new nx(Math.ceil(this._overall_size),Math.ceil(this._overall_size)/50)),this.helpText("<font face='verdana' size='1' color='red'><center>Transform Controls<br>'T' translate | 'R' rotate | 'S' scale<br>'+' increase size | '-' decrease size<br>'W' toggle wireframe/solid display<br>keep 'Ctrl' down to snap to grid</center></font>")}}drawCount(t,e){const i=t=>(l()?"anytime":t.toString())+" ms";let n=["Unique nodes: "+this._clones.nodes.length,"Unique visible: "+t,"Time to clone: "+i(e)];this._clones.scanVisible();let r=0,s={clones:this._clones,cnt:[],func:function(t){return void 0===this.cnt[this.last]?this.cnt[this.last]=1:this.cnt[this.last]++,r+=dM(this.clones.getNodeShape(t.id)),!0}},a=(new Date).getTime(),o=this._clones.scanVisible(s),h=(new Date).getTime();n.push("Total visible nodes: "+o,"Total shapes: "+r);for(let t=0;t<s.cnt.length;++t)void 0!==s.cnt[t]&&n.push("  lvl"+t+": "+s.cnt[t]);n.push("Time to scan: "+i(h-a),"","Check timing for matrix calculations ...");let c=this.selectDom().style("overflow","auto");return l()?c.property("_json_object_",n):n.forEach((t=>c.append("p").text(t))),new Promise((t=>{setTimeout((()=>{s.domatrix=!0,a=(new Date).getTime(),o=this._clones.scanVisible(s),h=(new Date).getTime();let e="Time to scan with matrix: "+i(h-a);l()?n.push(e):c.append("p").text(e),t(this)}),100)}))}performDrop(t,e,i,n){if(t&&"TTree"===t.$kind){let e="extract_geo_tracks";n&&n.indexOf("$")>0&&(e=n.slice(0,n.indexOf("$")),n=n.slice(n.indexOf("$")+1));let i=C(e);return i?i(t,n).then((t=>t?this.drawExtras(t,"",!1).then((()=>(this.updateClipping(!0),this.render3D(100)))):this)):Promise.reject(Error(`Function ${e} not found`))}return this.drawExtras(t,e).then((t=>t?(i&&(i._painter=this),this.render3D(100)):this))}mouseOverHierarchy(t,e,i){if(!this.ctrl)return;let n=i._obj;this.ctrl._debug&&console.log("Mouse over",t,e,n?n._typename:"---"),!n||"TEveTrack"!==n._typename&&"TEvePointSet"!==n._typename&&"TPolyMarker3D"!==n._typename||this.highlightMesh(null,65280,t?n:null)}clearExtras(){this.getExtrasContainer("delete"),delete this._extraObjects,this.render3D()}addExtra(t,e){return void 0===this._extraObjects&&(this._extraObjects=k("TList")),!(this._extraObjects.arr.indexOf(t)>=0)&&(this._extraObjects.Add(t,e),delete t.$hidden_via_menu,!0)}extraObjectVisible(t,e,i){if(!this._extraObjects)return;let n=t.itemFullName(e),r=this._extraObjects.opt.indexOf(n);if(r<0&&e._obj&&(r=this._extraObjects.arr.indexOf(e._obj),r>=0&&(this._extraObjects.opt[r]=n)),r<0)return;let s=this._extraObjects.arr[r],a=!s.$hidden_via_menu;if(i){s.$hidden_via_menu=a,a=!a;let t=null;this._toplevel.traverse((e=>{e.geo_object===s&&(t=e)})),t?(t.visible=a,this.render3D()):a&&this.drawExtras(s,"",!1).then((()=>{this.updateClipping(!0),this.render3D()}))}return a}drawExtras(t,e,i){if(!t||!t._typename||!i&&t.$hidden_via_menu)return Promise.resolve(!1);let n=!1;void 0===i&&(i=!0,n=!0);let r=!1;if("TList"===t._typename||"TObjArray"===t._typename){if(!t.arr)return!1;let n=[];for(let r=0;r<t.arr.length;++r){let s=t.arr[r],a=t.opt?t.opt[r]:"";a||(a=(e||"<prnt>")+"/["+r+"]"),n.push(this.drawExtras(s,a,i))}r=Promise.all(n).then((t=>t.indexOf(!0)>=0))}else"Mesh"===t._typename?(this.addToExtrasContainer(t),r=Promise.resolve(!0)):"TGeoTrack"===t._typename?i&&!this.addExtra(t,e)||(r=this.drawGeoTrack(t,e)):"TPolyLine3D"===t._typename?i&&!this.addExtra(t,e)||(r=this.drawPolyLine(t,e)):"TEveTrack"===t._typename||"ROOT::Experimental::TEveTrack"===t._typename?i&&!this.addExtra(t,e)||(r=this.drawEveTrack(t,e)):"TEvePointSet"===t._typename||"ROOT::Experimental::TEvePointSet"===t._typename||"TPolyMarker3D"===t._typename?i&&!this.addExtra(t,e)||(r=this.drawHit(t,e)):"TEveGeoShapeExtract"!==t._typename&&"ROOT::Experimental::REveGeoShapeExtract"!==t._typename||i&&!this.addExtra(t,e)||(r=this.drawExtraShape(t,e));return q(r)||(r=Promise.resolve(r)),n?r.then((t=>!!t&&(this.updateClipping(!0),this.render3D(100)))):r}getExtrasContainer(t,e){if(!this._toplevel)return null;e||(e="tracks");let i=null,n=[];for(let r=0;r<this._toplevel.children.length;++r){let s=this._toplevel.children[r];if(s._extras)if("collect"!==t){if(s._extras===e){i=s;break}}else n.push(s)}if("collect"===t){for(let t=0;t<n.length;++t)this._toplevel.remove(n[t]);return n}return"delete"===t?(i&&this._toplevel.remove(i),Gy(i),null):("get"===t||i||(i=new Td,i._extras=e,this._toplevel.add(i)),i)}addToExtrasContainer(t,e){let i=this.getExtrasContainer("",e);i?i.add(t):(console.warn("Fail to add object to extras"),Gy(t))}drawGeoTrack(t,e){if(!t||!t.fNpoints)return!1;let i=t.fLineWidth||1,n=Fl(t.fLineColor)||"#ff00ff";d.isWin&&(i=1);let r=Math.round(t.fNpoints/4),s=new Float32Array(6*(r-1)),a=0,o=this.ctrl.projectPos,l="x"===this.ctrl.project,h="y"===this.ctrl.project,c="z"===this.ctrl.project;for(let e=0;e<r-1;++e)s[a]=l?o:t.fPoints[4*e],s[a+1]=h?o:t.fPoints[4*e+1],s[a+2]=c?o:t.fPoints[4*e+2],s[a+3]=l?o:t.fPoints[4*e+4],s[a+4]=h?o:t.fPoints[4*e+5],s[a+5]=c?o:t.fPoints[4*e+6],a+=6;let u=Hy(s,new pp({color:n,linewidth:i}));return u.renderOrder=1e6,u.geo_name=e,u.geo_object=t,u.hightlightWidthScale=2,e&&0==e.indexOf("<prnt>/Tracks")&&(u.main_track=!0),this.addToExtrasContainer(u),!0}drawPolyLine(t,e){if(!t)return!1;let i=t.fLineWidth||1,n=Fl(t.fLineColor)||"#ff00ff";d.isWin&&(i=1);let r=t.fN,s=t.fP,a=new Float32Array(6*(r-1)),o=0,l=this.ctrl.projectPos,h="x"===this.ctrl.project,c="y"===this.ctrl.project,u="z"===this.ctrl.project;for(let t=0;t<r-1;++t)a[o]=h?l:s[3*t],a[o+1]=c?l:s[3*t+1],a[o+2]=u?l:s[3*t+2],a[o+3]=h?l:s[3*t+3],a[o+4]=c?l:s[3*t+4],a[o+5]=u?l:s[3*t+5],o+=6;let f=Hy(a,new pp({color:n,linewidth:i}));return f.renderOrder=1e6,f.geo_name=e,f.geo_object=t,f.hightlightWidthScale=2,this.addToExtrasContainer(f),!0}drawEveTrack(t,e){if(!t||t.fN<=0)return!1;let i=t.fLineWidth||1,n=Fl(t.fLineColor)||"#ff00ff";d.isWin&&(i=1);let r=new Float32Array(6*(t.fN-1)),s=0,a=this.ctrl.projectPos,o="x"===this.ctrl.project,l="y"===this.ctrl.project,h="z"===this.ctrl.project;for(let e=0;e<t.fN-1;++e)r[s]=o?a:t.fP[3*e],r[s+1]=l?a:t.fP[3*e+1],r[s+2]=h?a:t.fP[3*e+2],r[s+3]=o?a:t.fP[3*e+3],r[s+4]=l?a:t.fP[3*e+4],r[s+5]=h?a:t.fP[3*e+5],s+=6;let c=Hy(r,new pp({color:n,linewidth:i}));return c.renderOrder=1e6,c.geo_name=e,c.geo_object=t,c.hightlightWidthScale=2,this.addToExtrasContainer(c),!0}drawHit(t,e){if(!t||!t.fN||t.fN<0)return Promise.resolve(!1);let i=t.fMarkerSize*this.getOverallSize()*.005;i<=.2&&(i=.2);let n=t.fMarkerStyle;4!=n&&2!=n||(n=7,i*=1.5);let r=t.fN,s=this.ctrl.projectPos,a="x"===this.ctrl.project,o="y"===this.ctrl.project,l="z"===this.ctrl.project,h=new Vy(r,this._webgl,i);for(let e=0;e<r;e++)h.addPoint(a?s:t.fP[3*e],o?s:t.fP[3*e+1],l?s:t.fP[3*e+2]);return h.createPoints({color:Fl(t.fMarkerColor)||"#0000ff",style:n}).then((i=>(i.renderOrder=1e6,i.highlightScale=2,i.geo_name=e,i.geo_object=t,this.addToExtrasContainer(i),!0)))}drawExtraShape(t,e){let i=WM(t);return!!i&&(i.geo_name=e,i.geo_object=t,this.addToExtrasContainer(i),!0)}findNodeWithVolume(t,e,i,n,r){let s=!1,a=null;if(i)n.length>0&&(n+="/"),n+=i.fName;else{if(!(i=this.getGeometry())&&0!==cM(i))return null;n=this.geo_manager?i.fName:"",s=!0,r=[]}if(!i.fVolume||i.fVolume._searched)return null;if(t.test(i.fVolume.fName)&&(a=e({node:i,item:n}),a))return a;if(i.fVolume._searched=!0,r.push(i.fVolume),i.fVolume.fNodes)for(let s=0;s<i.fVolume.fNodes.arr.length&&(a=this.findNodeWithVolume(t,e,i.fVolume.fNodes.arr[s],n,r),!a);++s);if(s)for(let t=0,e=r.length;t<e;++t)delete r[t]._searched;return a}loadMacro(t){let e={obj:this.getGeometry(),prefix:""};if(this.geo_manager&&(e.prefix=e.obj.fName),!t||t.length<3||0!==cM(e.obj))return Promise.resolve(e);let i={GetVolume:t=>{let i=new RegExp("^"+t+"$"),n=this.findNodeWithVolume(i,(t=>t));return n||console.log("Did not found "+t+" volume"),{found:n,fVolume:n?n.node.fVolume:null,InvisibleAll:function(t){oM(this.fVolume,t)},Draw:function(){this.found&&this.fVolume&&(e.obj=this.found.node,e.prefix=this.found.item,console.log("Select volume for drawing",this.fVolume.fName,e.prefix))},SetTransparency:function(t){this.fVolume&&this.fVolume.fMedium&&this.fVolume.fMedium.fMaterial&&(this.fVolume.fMedium.fMaterial.fFillStyle=3e3+t)},SetLineColor:function(t){this.fVolume&&(this.fVolume.fLineColor=t)}}},DefaultColors:()=>{this.ctrl.dflt_colors=!0},SetMaxVisNodes:t=>{this.ctrl.maxnodes||(this.ctrl.maxnodes=pasrseInt(t)||0)},SetVisLevel:t=>{this.ctrl.vislevel||(this.ctrl.vislevel=parseInt(t)||0)}};return lv("Loading macro "+t),E(t,"text").then((t=>{let n=t.split("\n"),r=0;for(;r<n.length;){let t=n[r++].trim();if(0!=t.indexOf("//")&&!(t.indexOf("gGeoManager")<0||(t=t.replace("->GetVolume",".GetVolume"),t=t.replace("->InvisibleAll",".InvisibleAll"),t=t.replace("->SetMaxVisNodes",".SetMaxVisNodes"),t=t.replace("->DefaultColors",".DefaultColors"),t=t.replace("->Draw",".Draw"),t=t.replace("->SetTransparency",".SetTransparency"),t=t.replace("->SetLineColor",".SetLineColor"),t=t.replace("->SetVisLevel",".SetVisLevel"),t.indexOf("->")>=0)))try{new Function("gGeoManager",t)(i)}catch(e){console.error("Problem by processing "+t)}}return e})).catch((()=>(console.error("Fail to load "+t),e)))}assignClones(t){this._clones_owner=!0,this._clones=t}prepareObjectDraw(t,e,i){if(this.did_cleanup)return Promise.resolve(null);if("__geom_viewer_append__"==e)this._new_append_nodes=t,this.ctrl.use_worker=0,this._geom_viewer=!0;else if("__geom_viewer_selection__"==e&&this._clones)this._new_draw_nodes=t,this.ctrl.use_worker=0,this._geom_viewer=!0;else if(this._main_painter)this._clones_owner=!1,this._clones=this._main_painter._clones,console.log("Reuse clones",this._clones.nodes.length,"from main painter");else if(t){this._start_drawing_time=(new Date).getTime(),this._clones_owner=!0,this._clones=new PM(t);let i=this.ctrl.vislevel,n=this.ctrl.maxnodes;this.geo_manager&&(!i&&this.geo_manager.fVisLevel&&(i=this.geo_manager.fVisLevel),n||(n=this.geo_manager.fMaxVisNodes)),this._clones.setVisLevel(i),this._clones.setMaxVisNodes(n),this._clones.name_prefix=e;let r=!!this.geo_manager&&!this.ctrl.showtop,s=this.ctrl.no_screen?0:this._clones.markVisibles(!0,!1,r);s=s<=0?this._clones.markVisibles(!1,!1,r):this._clones.markVisibles(!0,!0,r),this._clones.produceIdShifts();let a=(new Date).getTime()-this._start_drawing_time;if(this._scene||console.log("Creating clones",this._clones.nodes.length,"takes",a,"uniquevis",s),this.options._count)return this.drawCount(s,a)}else this._clones_owner=!1,this._clones=null;let n=Promise.resolve(!0);if(!this._scene)if(this.ctrl.maxlimit=(this._webgl?2e5:1e5)*this.ctrl.more,this._first_drawing=!0,this._on_pad=!!this.getPadPainter(),this._on_pad){let t,e,i;n=Vv(this,"3d").then((()=>{i=this.getFramePainter(),e=Ry(),By(i),i.mode3d=!0,t=i.getSizeFor3d(void 0,e),this._fit_main_area=-1===t.can3d;let n=this.createScene(t.width,t.height);i.add3dCanvas(t,n,e===f.Render3D.WebGL)}))}else{this.ctrl.use_worker>0&&this.startWorker(),By(this);let t=this.getSizeFor3d(this._webgl?void 0:3);this._fit_main_area=-1===t.can3d;let e=this.createScene(t.width,t.height);this.add3dCanvas(t,e,this._webgl)}return n.then((()=>(this.setAsMainPainter(),this.createToolbar(),this._clones?new Promise((t=>{this._resolveFunc=t,this.showDrawInfo("Drawing geometry"),this.startDrawGeometry(!0)})):this.completeDraw())))}showDrawInfo(t){if(l()||!this._first_drawing||!this._start_drawing_time)return;let e=this._renderer.domElement.parentNode,i=e.querySelector(".geo_info");if(t){let n=.001*((new Date).getTime()-this._start_drawing_time);i||(i=document.createElement("p"),i.setAttribute("class","geo_info"),i.setAttribute("style","position: absolute; text-align: center; vertical-align: middle; top: 45%; left: 40%; color: red; font-size: 150%;"),e.append(i)),i.innerHTML=`${t}, ${n.toFixed(1)}s`}else i.remove()}continueDraw(){if(0===this.drawing_stage)return;let t=(new Date).getTime(),e=this._first_drawing?1e3:200,i=t;for(;;){let n=this.nextDrawAction();if(!n)break;if(i=(new Date).getTime(),i-this._startm>1e5){this.drawing_stage=0;break}if(!(!0===n&&i-t<e)&&(i-t>e||1===n||2===n))return lv(this.drawing_log),this.showDrawInfo(this.drawing_log),this._first_drawing&&this._webgl&&this._num_meshes-this._last_render_meshes>100&&i-this._last_render_tm>2.5*e&&(this.adjustCameraPosition(),this.render3D(-1),this._last_render_meshes=this.ctrl.info.num_meshes),void(2!==n&&setTimeout((()=>this.continueDraw()),1===n?100:1))}let n=i-this._startm;if((this._first_drawing||this._full_redrawing)&&console.log(`Create tm = ${n} meshes ${this.ctrl.info.num_meshes} faces ${this.ctrl.info.num_faces}`),n>300)return lv("Rendering geometry"),this.showDrawInfo("Rendering"),setTimeout((()=>this.completeDraw(!0)),10);this.completeDraw(!0)}testCameraPosition(t){this._camera.updateMatrixWorld();let e=this._camera.position.clone();if(!t&&this._last_camera_position){if(this._last_camera_position.distanceTo(e)<1e-4*(this._overall_size||1e3))return}this._last_camera_position=e,!this.ctrl.project&&this._webgl&&DM(this._toplevel,e,this.ctrl.depthMethod,this._clones)}render3D(t,e){if(!this._renderer)return this.did_cleanup?console.warn("try to render after cleanup"):console.warn("renderer object not exists - check code"),this;let i=void 0!==t&&t>0;if(void 0===t&&(t=5),t>0&&this._webgl)return l()&&(t=1),i?new Promise((i=>{this._render_resolveFuncs||(this._render_resolveFuncs=[]),this._render_resolveFuncs.push(i),this.render_tmout||(this.render_tmout=setTimeout((()=>this.render3D(0,e)),t))})):(this.render_tmout||(this.render_tmout=setTimeout((()=>this.render3D(0,e)),t)),this);this.render_tmout&&(clearTimeout(this.render_tmout),delete this.render_tmout),Iy(this._renderer);let n=new Date;this.testCameraPosition(-1===t),this._webgl&&this._effectComposer&&this._effectComposer.passes.length>0?this._effectComposer.render():this._webgl&&this._bloomComposer&&this._bloomComposer.passes.length>0?(this._renderer.clear(),this._camera.layers.set(1),this._bloomComposer.render(),this._renderer.clearDepth(),this._camera.layers.set(0),this._renderer.render(this._scene,this._camera)):this._renderer.render(this._scene,this._camera);let r=new Date;this.last_render_tm=r.getTime(),0===this.first_render_tm&&e&&(this.first_render_tm=r.getTime()-n.getTime(),console.log(`three.js r138, first render tm = ${this.first_render_tm}`)),jy(this._renderer),this._render_resolveFuncs&&(this._render_resolveFuncs.forEach((t=>t(this))),delete this._render_resolveFuncs)}startWorker(){this._worker||(this._worker_ready=!1,this._worker_jobs=0,this._worker=new Worker(t.source_dir+"scripts/geoworker.js"),this._worker.onmessage=t=>{if("object"==typeof t.data){if("log"in t.data)return console.log(`geo: ${t.data.log}`);if("progress"in t.data)return lv(t.data.progress);t.data.tm3=(new Date).getTime(),"init"in t.data?(this._worker_ready=!0,console.log("Worker ready: "+(t.data.tm3-t.data.tm0))):this.processWorkerReply(t.data)}},this._worker.postMessage({init:!0,browser:d,tm0:(new Date).getTime(),vislevel:this._clones.getVisLevel(),maxvisnodes:this._clones.getMaxVisNodes(),clones:this._clones.nodes,sortmap:this._clones.sortmap}))}canSubmitToWorker(t){return!!this._worker&&(this._worker_ready&&(0==this._worker_jobs||t))}submitToWorker(t){if(!this._worker)return!1;this._worker_jobs++,t.tm0=(new Date).getTime(),this._worker.postMessage(t)}processWorkerReply(t){if(this._worker_jobs--,"collect"in t)return this._new_draw_nodes=t.new_nodes,this._draw_all_nodes=t.complete,this.drawing_stage=3,this.continueDraw();if("shapes"in t){for(let e=0;e<t.shapes.length;++e){let i=t.shapes[e],n=this._build_shapes[e];i.buf_pos&&i.buf_norm&&(0===i.buf_pos.length?n.geom=null:i.buf_pos.length!==i.buf_norm.length?(console.error("item.buf_pos",i.buf_pos.length,"item.buf_norm",i.buf_norm.length),n.geom=null):(n.geom=new Od,n.geom.setAttribute("position",new rd(i.buf_pos,3)),n.geom.setAttribute("normal",new rd(i.buf_norm,3))),n.ready=!0,n.nfaces=i.nfaces)}return t.tm4=(new Date).getTime(),this.drawing_stage=7,this.continueDraw()}}testGeomChanges(){if(this._main_painter)return console.warn("Get testGeomChanges call for slave painter"),this._main_painter.testGeomChanges();this.startDrawGeometry();for(let t=0;t<this._slave_painters.length;++t)this._slave_painters[t].startDrawGeometry()}drawSimpleAxis(t){if(this.getExtrasContainer("delete","axis"),!this.ctrl._axis)return t?null:this.render3D();let e=this.getGeomBoundingBox(this._toplevel),i=this.getExtrasContainer("create","axis"),n=.02*Math.max(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=[0,0,0],s=["x","y","z"],a=["X","Y","Z"],o=["red","green","blue"],l=this.ctrl.ortho_camera,h=[this.ctrl._yup,this.ctrl._yup,this.ctrl._yup],c=3;if(2==this.ctrl._axis)for(let t=0;t<3;++t){let i=s[t];e.min[i]<=0&&e.max[i]>=0||(r[t]=(e.min[i]+e.max[i])/2)}this.ctrl.ortho_camera&&(c=2,a[0]=a[2],o[0]=o[2],h[0]=h[2],l=!0);for(let t=0;t<c;++t){let c=new Float32Array(6),d=o[t],u=s[t];const f=t=>e.max[u]-e.min[u]<2?t.toFixed(3):Math.abs(t)>1e5?t.toExponential(3):Math.round(t).toString();let m=f(e.max[u]);switch(c[0]=e.min.x,c[1]=e.min.y,c[2]=e.min.z,c[3]=e.min.x,c[4]=e.min.y,c[5]=e.min.z,t){case 0:c[3]=e.max.x,h[0]&&!l?m=a[0]+" "+m:m+=" "+a[0];break;case 1:c[4]=e.max.y,h[1]?m+=" "+a[1]:m=a[1]+" "+m;break;case 2:c[5]=e.max.z,m+=" "+a[2]}if(2==this.ctrl._axis)for(let e=0;e<6;++e)e%3!==t&&(c[e]=r[e%3]);let p=Hy(c,new pp({color:d}));i.add(p);let g=new ou({color:d,vertexColors:!1});if(0===r[t]&&r[t]>=e.min[u]&&r[t]<=e.max[u]&&(2!=this.ctrl._axis||0===t)){let e=l?new Rp(.25*n):new Bg(.25*n);p=new Tu(e,g),p.translateX(0===t?r[0]:c[0]),p.translateY(1===t?r[1]:c[1]),p.translateZ(2===t?r[2]:c[2]),i.add(p)}let _=new hx(m,{font:zy,size:n,height:0,curveSegments:5});p=new Tu(_,g);let x=(new yc).setFromObject(p);if(p.translateX(c[3]),p.translateY(c[4]),p.translateZ(c[5]),h[t])switch(t){case 0:l?p.translateX(.5*n):(p.rotateY(Math.PI),p.translateX(-x.max.x-.5*n)),p.translateY(-x.max.y/2);break;case 1:l?p.rotateZ(Math.PI/2):(p.rotateX(-Math.PI/2),p.rotateY(-Math.PI/2)),p.translateX(.5*n),p.translateY(-x.max.y/2);break;case 2:p.rotateY(-Math.PI/2),p.translateX(.5*n),p.translateY(-x.max.y/2)}else switch(t){case 0:p.rotateX(Math.PI/2),p.translateY(-x.max.y/2),p.translateX(.5*n);break;case 1:p.rotateX(Math.PI/2),p.rotateY(-Math.PI/2),p.translateX(-x.max.x-.5*n),p.translateY(-x.max.y/2);break;case 2:p.rotateX(Math.PI/2),p.rotateZ(Math.PI/2),p.translateX(.5*n),p.translateY(-x.max.y/2)}if(i.add(p),_=new hx(f(e.min[u]),{font:zy,size:n,height:0,curveSegments:5}),p=new Tu(_,g),x=(new yc).setFromObject(p),p.translateX(c[0]),p.translateY(c[1]),p.translateZ(c[2]),h[t])switch(t){case 0:l?p.translateX(-x.max.x-.5*n):(p.rotateY(Math.PI),p.translateX(.5*n)),p.translateY(-x.max.y/2);break;case 1:l?p.rotateZ(Math.PI/2):(p.rotateX(-Math.PI/2),p.rotateY(-Math.PI/2)),p.translateY(-x.max.y/2),p.translateX(-x.max.x-.5*n);break;case 2:p.rotateY(-Math.PI/2),p.translateX(-x.max.x-.5*n),p.translateY(-x.max.y/2)}else switch(t){case 0:p.rotateX(Math.PI/2),p.translateX(-x.max.x-.5*n),p.translateY(-x.max.y/2);break;case 1:p.rotateX(Math.PI/2),p.rotateY(-Math.PI/2),p.translateY(-x.max.y/2),p.translateX(.5*n);break;case 2:p.rotateX(Math.PI/2),p.rotateZ(Math.PI/2),p.translateX(-x.max.x-.5*n),p.translateY(-x.max.y/2)}i.add(p)}return this.changedDepthMethod(t?"norender":void 0)}setAxesDraw(t){return this.ctrl._axis="toggle"===t?this.ctrl._axis?0:1:"number"==typeof t?t:t?1:0,this.drawSimpleAxis()}setAutoRotate(t){this.ctrl.project||(void 0!==t&&(this.ctrl.rotate=t),this.autorotate(2.5))}toggleWireFrame(){this.ctrl.wireframe=!this.ctrl.wireframe,this.changedWireFrame()}setWireFrame(t){this.ctrl.wireframe=!!t,this.changedWireFrame()}setShowTop(t){this.ctrl.showtop=!!t,this.redrawObject("same")}changedClipping(t){let e=this.ctrl.clip;void 0!==t&&t>=0&&!e[t].enabled||((e[0].enabled||e[1].enabled||e[2].enabled)&&(this.ctrl.ssao.enabled=!1,this.removeSSAO()),this.updateClipping(!1,!0))}changedDepthTest(){if(!this._toplevel)return;let t=this.ctrl.depthTest;this._toplevel.traverse((e=>{e instanceof Tu&&(e.material.depthTest=t)})),this.render3D(0)}changedDepthMethod(t){if(delete this._last_camera_position,"norender"!==t)return this.render3D()}changedHighlight(){this.ctrl.highlight||this.highlightMesh(null)}updateClipping(t,e){if(this._renderer&&this._renderer.jsroot_render3d===f.Render3D.SVG)return;let i=this.ctrl.clip,n=[],r=!1,s=[i[0].value,-1*i[1].value,(this.ctrl._yup?-1:1)*i[2].value],a=this.ctrl.clipIntersect?16:0;for(let t=0;t<3;++t)i[t].enabled&&(a+=2<<t),this._clipPlanes[t].constant!=s[t]&&(r=!0,this._clipPlanes[t].constant=s[t]);this.ctrl.ssao.enabled||(i[0].enabled&&n.push(this._clipPlanes[0]),i[1].enabled&&n.push(this._clipPlanes[1]),i[2].enabled&&n.push(this._clipPlanes[2]),a+=1e3*n.length),0==n.length&&(n=null),this._clipCfg!==a&&(r=!0),this._clipCfg=a;let o=!!n,l=this.ctrl.clipIntersect,h=o?2:0;return(e||r)&&this._scene.traverse((t=>{t.hasOwnProperty("material")&&t.material&&void 0!==t.material.clippingPlanes&&(t.material.clippingPlanes!==n&&(t.material.clipIntersection=l,t.material.clippingPlanes=n,t.material.needsUpdate=!0),void 0!==t.material.emissive&&t.material.side!=h&&(t.material.side=h,t.material.needsUpdate=!0))})),this.ctrl.bothSides=o,t||this.render3D(0),r}setCompleteHandler(t){this._complete_handler=t}completeDraw(t){let e=!1,i=!1,n=!0;if(!this.ctrl)return console.warn("ctrl object does not exist in completeDraw - something went wrong"),Promise.resolve(this);let r=Promise.resolve(!0);if(this._clones)(this._first_drawing||this._full_redrawing)&&this.ctrl.tracks&&this.geo_manager&&(r=this.drawExtras(this.geo_manager.fTracks,"<prnt>/Tracks"));else{n=!1,this.getExtrasContainer("delete");let t=(this._main_painter?this._main_painter._extraObjects:null)||this._extraObjects;r=this.drawExtras(t,"",!1)}return r.then((()=>{if(this._full_redrawing&&(this.adjustCameraPosition(!0),this._full_redrawing=!1,i=!0,this.changedDepthMethod("norender")),this._first_drawing&&(this.adjustCameraPosition(!0),this.showDrawInfo(),this._first_drawing=!1,e=!0,i=!0),0!==this.ctrl.transparency&&this.changedGlobalTransparency(this.ctrl.transparency,!0),e&&this.completeScene(),i&&(this.ctrl.trans_radial||this.ctrl.trans_z)&&this.changedTransformation("norender"),i&&this.ctrl._axis&&this.drawSimpleAxis(!0),this._scene.overrideMaterial=null,void 0!==this._provided_more_nodes&&(this.appendMoreNodes(this._provided_more_nodes,!0),delete this._provided_more_nodes),n){this.getExtrasContainer("delete");let t=(this._main_painter?this._main_painter._extraObjects:null)||this._extraObjects;return this.drawExtras(t,"",!1)}})).then((()=>(this.updateClipping(!0),this.render3D(0,!0),t&&lv(),this.addOrbitControls(),this.addTransformControl(),e&&(!1===this.ctrl.highlight&&(this.ctrl.highlight=this.first_render_tm<1e3),!1===this.ctrl.highlight_scene&&(this.ctrl.highlight_scene=this.ctrl.highlight),this._webgl&&this.ctrl.rotate&&!this.ctrl.project&&this.autorotate(2.5),this._webgl&&this.ctrl.show_controls&&!l()&&this.showControlOptions(!0)),this.setAsMainPainter(),"function"==typeof this._resolveFunc&&(this._resolveFunc(this),delete this._resolveFunc),"function"==typeof this._complete_handler&&this._complete_handler(this),this._draw_nodes_again?this.startDrawGeometry():this._drawing_ready=!0,this)))}isDrawingReady(){return this._drawing_ready||!1}removeDrawnNode(t){if(!this._draw_nodes)return;let e=[];for(let i=0;i<this._draw_nodes.length;++i){let n=this._draw_nodes[i];n.nodeid===t||this._clones.isIdInStack(t,n.stack)?this._clones.createObject3D(n.stack,this._toplevel,"delete_mesh"):e.push(n)}e.length<this._draw_nodes.length&&(this._draw_nodes=e,this.render3D())}cleanup(t){if(!t){this.removeSSAO(),this.clearTopPainter();let t=0;if(this._on_pad){let t=this.getFramePainter();t&&t.mode3d&&(t.clear3dCanvas(),t.mode3d=!1)}else t=this.clear3dCanvas();this._toolbar&&this._toolbar.cleanup(),this.helpText(),Gy(this._scene),Gy(this._full_geom),this._tcontrols&&this._tcontrols.dispose(),this._controls&&this._controls.cleanup(),this._context_menu&&this._renderer.domElement.removeEventListener("contextmenu",this._context_menu,!1),this._datgui&&this._datgui.destroy(),this._worker&&this._worker.terminate(),delete this._animating;let e=this.getGeometry();if(e&&this.ctrl.is_main&&(e.$geo_painter===this?delete e.$geo_painter:e.fVolume&&e.fVolume.$geo_painter===this&&delete e.fVolume.$geo_painter),this._main_painter){let t=this._main_painter._slave_painters.indexOf(this);t>=0&&this._main_painter._slave_painters.splice(t,1)}for(let t=0;t<this._slave_painters.length;++t){let e=this._slave_painters[t];e&&e._main_painter===this&&(e._main_painter=null)}delete this.geo_manager,delete this._highlight_handlers,super.cleanup(),delete this.ctrl,delete this.options,this.did_cleanup=!0,t<0&&this.selectDom().html("")}if(this._slave_painters)for(let t in this._slave_painters){let e=this._slave_painters[t];e._main_painter=null,e._clones===this._clones&&(e._clones=null)}this._main_painter=null,this._slave_painters=[],this._render_resolveFuncs&&(this._render_resolveFuncs.forEach((t=>t(this))),delete this._render_resolveFuncs),Fy(this._renderer),delete this._scene,this._scene_width=0,this._scene_height=0,this._renderer=null,this._toplevel=null,delete this._full_geom,delete this._camera,delete this._camera0pos,delete this._lookat,delete this._selected_mesh,this._clones&&this._clones_owner&&this._clones.cleanup(this._draw_nodes,this._build_shapes),delete this._clones,delete this._clones_owner,delete this._draw_nodes,delete this._drawing_ready,delete this._build_shapes,delete this._new_draw_nodes,delete this._new_append_nodes,delete this._last_camera_position,this.first_render_tm=0,this.last_render_tm=0,this.drawing_stage=0,delete this.drawing_log,delete this._datgui,delete this._controls,delete this._context_menu,delete this._tcontrols,delete this._toolbar,delete this._worker}helpText(t){lv(t)}performResize(t,e){return(this._scene_width!==t||this._scene_height!==e)&&(!(t<10||e<10)&&(this._scene_width=t,this._scene_height=e,this._camera&&this._renderer&&("PerspectiveCamera"==this._camera.type&&(this._camera.aspect=this._scene_width/this._scene_height),this._camera.updateProjectionMatrix(),this._renderer.setSize(this._scene_width,this._scene_height,!this._fit_main_area),this._effectComposer&&this._effectComposer.setSize(this._scene_width,this._scene_height),this._bloomComposer&&this._bloomComposer.setSize(this._scene_width,this._scene_height),this.drawing_stage||this.render3D()),!0))}checkResize(t){let e=this.getCanvPainter();if(e&&!e.checkCanvasResize(t))return!1;let i=this.getSizeFor3d();return this.performResize(i.width,i.height)}toggleEnlarge(){this.enlargeMain("toggle")&&this.checkResize()}ownedByTransformControls(t){let e=t.parent;for(;e&&!(e instanceof Ox);)e=e.parent;return e&&e instanceof Ox}accessObjectWireFrame(t,e){if(t.hasOwnProperty("material")&&!(t instanceof nx)&&!this.ownedByTransformControls(t))return void 0!==e&&t.stack&&(t.material.wireframe=e),t.material.wireframe}changedWireFrame(){if(!this._scene)return;let t=this.ctrl.wireframe;this._scene.traverse((e=>this.accessObjectWireFrame(e,t))),this.render3D()}updateObject(t){return"same"===t||!(!t||!t._typename)&&(t===this.getObject()||(this.geo_manager&&"TGeoManager"==t._typename?(this.geo_manager=t,this.assignObject({_typename:"TGeoNode",fVolume:t.fMasterVolume,fName:t.fMasterVolume.fName,$geoh:t.fMasterVolume.$geoh,_proxy:!0}),!0):!!this.matchObjectType(t._typename)&&(this.assignObject(t),!0)))}clearDrawings(){this._clones&&this._clones_owner&&this._clones.cleanup(this._draw_nodes,this._build_shapes),delete this._clones,delete this._clones_owner,delete this._draw_nodes,delete this._drawing_ready,delete this._build_shapes,delete this._extraObjects,delete this._clipCfg,Gy(this._toplevel,!0),this._full_redrawing=!0}redraw(){if(!this._on_pad)return;let t=this.getFramePainter();if(!t)return;let e=t.getSizeFor3d(t.access3dKind());return t.apply3dSize(e),this.performResize(e.width,e.height)}redrawObject(t,e){if(!this.updateObject(t))return!1;this.clearDrawings();let i=this.getGeometry(),n="";return this.geo_manager&&(n=i.fName),this.prepareObjectDraw(i,n),!0}static draw(t,e,i){if(!e)return null;let n=null,r=null,s="",a=!1;if("fShapeBits"in e&&"fShapeId"in e?(n=e,e=null):"TGeoVolumeAssembly"===e._typename||"TGeoVolume"===e._typename?n=e.fShape:"TEveGeoShapeExtract"===e._typename||"ROOT::Experimental::REveGeoShapeExtract"===e._typename?(n=e.fShape,a=!0):"TGeoManager"===e._typename?n=e.fMasterVolume.fShape:"TGeoOverlap"===e._typename?(r=e.fMarker,s="<prnt>/Marker",e=function(t){let e=k("TGeoVolume");sM(e,nM.kVisDaughters,!0),e.$geoh=!0,e.fName="";let i=k("TGeoNodeMatrix");i.fName=t.fVolume1.fName||"Overlap1",i.fMatrix=t.fMatrix1,i.fVolume=t.fVolume1;let n=k("TGeoNodeMatrix");return n.fName=t.fVolume2.fName||"Overlap2",n.fMatrix=t.fMatrix2,n.fVolume=t.fVolume2,e.fNodes=k("TList"),e.fNodes.Add(i),e.fNodes.Add(n),e}(e),i||(i="wire")):"fVolume"in e?e.fVolume&&(n=e.fVolume.fShape):e=null,"string"==typeof i&&0==i.indexOf("comp")&&n&&"TGeoCompositeShape"==n._typename&&n.fNode){let t=1;"x"==(i=i.slice(4))[0]&&(t=999,i=i.slice(1)+"_vislvl999"),e=OM(n,t)}if(!e&&n&&(e=Object.assign(k("TEveGeoShapeExtract"),{fTrans:null,fShape:n,fRGBA:[0,1,0,1],fElements:null,fRnrSelf:!0})),!e)return null;let o=GM(t,e,i);return o.ctrl.is_main&&!e.$geo_painter&&(e.$geo_painter=o),!o.ctrl.is_main&&o.ctrl.project&&e.$geo_painter&&(o._main_painter=e.$geo_painter,o._main_painter._slave_painters.push(o)),(a&&!o.ctrl.vislevel||o.ctrl.vislevel<9)&&(o.ctrl.vislevel=9),r&&(o._splitColors=!0,o.addExtra(r,s)),o.loadMacro(o.ctrl.script_name).then((t=>o.prepareObjectDraw(t.obj,t.prefix,!0)))}}let UM=!1;function GM(t,e,i){if(!UM&&"function"==typeof s.addDrawFunc){function r(t,e){return`.jsroot .img_${t} { display: inline-block; height: 16px; width: 16px; background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQ${e}"); }`}UM=!0,s.addDrawFunc({name:"TEvePointSet",icon_get:VM,icon_click:XM}),s.addDrawFunc({name:"TEveTrack",icon_get:VM,icon_click:XM}),gv(`\n${r("geoarb8","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAB1SURBVBjTdY6rEYAwEETTy6lzK8/Fo+Jj18dTAjUgaQGfGiggtRDE8RtY93Zu514If2nzk2ux9c5TZkwXbiWTUavzws69oBfpYBrMT4r0Jhsw+QfRgQSw+CaKRsKsnV+SaF8MN49RBSgPUxO85PMl5n4tfGUH2gghs2uPAeQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geocombi","CAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAABIAAAASABGyWs+AAAAlUlEQVQoz5VQMQ4CMQyzEUNnBqT7Bo+4nZUH8gj+welWJsQDkHoCEYakTXMHSFiq2jqu4xRAEl2A7w4myWzpzCSZRZ658ldKu1hPnFsequBIc/hcLli3l52MAIANtpWrDsv8waGTW6BPuFtsdZArXyFuj33TQpazGEQF38phipnLgItxRcAoOeNpzv4PTXnC42fb//AGI5YqfQAU8dkAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geocone","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACRSURBVBjTdY+xDcNACEVvEm/ggo6Olva37IB0C3iEzJABvAHFTXBDeJRwthMnUvylk44vPjxK+afeokX0flQhJO7L4pafSOMxzaxIKc/Tc7SIjNLyieyZSjBzc4DqMZI0HTMonWPBNlogOLeuewbg9c0hOiIqH7DKmTCuFykjHe4XOzQ58XVMGxzt575tKzd6AX9yMkcWyPlsAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geogtra","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACCSURBVBjTVc+hDQMxDAVQD1FyqCQk0MwsCwQEG3+eCW6B0FvheDboFMGepTlVitPP/Cz5y0S/mNkw8pySU9INJDDH4vM4Usm5OrQXasXtkA+tQF+zxfcDY8EVwgNeiwmA37TEccK5oLOwQtuCj7BM2Fq7iGrxVqJbSsH+GzXs+798AThwKMh3/6jDAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geomedium","BAMAAADt3eJSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAABVQTFRFAAAAAAAAMDAww8PDWKj/////gICAG0/C4AAAAAF0Uk5TAEDm2GYAAAABYktHRAX4b+nHAAAACXBIWXMAAABIAAAASABGyWs+AAAAXElEQVQI102MwRGAMAgEuQ6IDwvQCjQdhAl/H7ED038JHhkd3dcOLAgESFARaAqnEB3yrj6QSEym1RbbOKinN+8q2Esui1GaX7VXSi4RUbxHRbER8X6O5Pg/fLgBBzMN8HfXD3AAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geopara","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAABtSURBVBjTY2DADq5MT7+CzD9kaKjp+QhJYIWqublhMbKAgpOnZxWSQJdsVJTndCSBKoWoAM/VSALpqlEBAYeQBKJAAsi2BGgCBZDdEWUYFZCOLFBlGOWJ7AyGFeaotjIccopageK3R12PGHABACTYHWd0tGw6AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("georotation","CAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAABIAAAASABGyWs+AAAAiklEQVQoz2NgYGBgYGDg+A/BmIAFIvyDEbs0AwMTAwHACLPiB5QVBTdpGSOSCZjScDcgc4z+32BgYGBgEGIQw3QDLkdCTZD8/xJFeBfDVxQT/j9n/MeIrMCNIRBJwX8GRuzGM/yHKMAljeILNFOuMTyEisEUMKIqucrwB2oyIhyQpH8y/MZrLWkAAHFzIHIc0Q5yAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geotranslation","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAABESURBVBjTY2DgYGAAYzjgAAIQgSLAgSwAAcrWUUCAJBAVhSpgBAQumALGCJPAAsriHIS0IAQ4UAU4cGphQBWwZSAOAADGJBKdZk/rHQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("geotrd2","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAABsSURBVBjTbY+xDcAwCARZx6UraiaAmpoRvIIb75PWI2QITxIiRQKk0CCO/xcA/NZ9LRs7RkJEYg3QxczUwoGsXiMAoe8lAelqRWFNKpiNXZLAalRDd0f3TMgeMckABKsCDmu+442RddeHz9cf9jUkW8smGn8AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geovolume","BAMAAADt3eJSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAB5QTFRFAAAAMDAw///Ay8uc/7+Q/4BgmJh4gIDgAAD/////CZb2ugAAAAF0Uk5TAEDm2GYAAAABYktHRAnx2aXsAAAACXBIWXMAAABIAAAASABGyWs+AAAAR0lEQVQI12NggAEBIBAEQgYGQUYQAyIGIhgwAZMSGCgwMJuEKimFOhswsKWAGG4JDGxJIBk1EEO9o6NIDVkEpgauC24ODAAASQ8Pkj/retYAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geoassembly","BAMAAADt3eJSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAA9QTFRFAAAAMDAw/wAAAAD/////jEo0BQAAAAF0Uk5TAEDm2GYAAAABYktHRASPaNlRAAAACXBIWXMAAABIAAAASABGyWs+AAAAOklEQVQI12NggAFGRgEgEBRgEBSAMhgYGQQEgAR+oARGDIwCIAYjUL0A2DQQg9nY2ABVBKoGrgsDAADxzgNboMz8zQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("geocomposite","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAABuSURBVBjTY2AgF2hqgQCCr+0V4O7hFmgCF7CJyKysKkmxhfGNLaw9SppqAi2gfMuY5Agrl+ZaC6iAUXRJZX6Ic0klTMA5urapPFY5NRcmYKFqWl8S5RobBRNg0PbNT3a1dDGH8RlM3LysTRjIBwAG6xrzJt11BAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("geoctub","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACESURBVBjTdc+xDcMwDARA7cKKHTuWX37LHaw+vQbQAJomA7j2DB7FhCMFCZB8pxPwJEv5kQcZW+3HencRBekak4aaMQIi8YJdAQ1CMeE0UBkuaLMETklQ9Alhka0JzzXWqLVBuQYPpWcVuBbZjZafNRYcDk9o/b07bvhINz+/zxu1/M0FSRcmAk/HaIcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geohype","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACKSURBVBjTbU+rFQQhDKQSDDISEYuMREfHx6eHKMpYuf5qoIQt5bgDblfcuJk3nySEhSvceDV3c/ejT66lspopE9pXyIlkCrHMBACpu1DClekQAREi/loviCnF/NhRwJLaQ6hVhPjB8bOCsjlnNnNl0FWJVWxAqGzHONRHpu5Ml+nQ+8GzNW9n+Is3eg80Nk0iiwoAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geomixture","BAMAAADt3eJSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAACFQTFRFAAAAAAAAKysrVVUA//8B//8AgICAqqpV398gv79A////VYJtlwAAAAF0Uk5TAEDm2GYAAAABYktHRApo0PRWAAAACXBIWXMAAABIAAAASABGyWs+AAAAXklEQVQI12NgwASCQsJCgoZAhoADq1tKIJAhEpDGxpYIZKgxsLElgBhibAkOCY4gKTaGkPRGIEPUIYEBrEaAIY0tDawmgYWNgREkkjCVjRWkWCUhLY0FJCIIBljsBgCZTAykgaRiRwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("geopcon","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACJSURBVBjTdc+hGcQwCIZhhjl/rkgWiECj8XgGyAbZoD5LdIRMkEnKkV575n75Pp8AgLU54dmh6mauelyAL2Qzxfe2sklioq6FacFAcRFXYhwJHdU5rDD2hEYB/CmoJVRMiIJqgtENuoqA8ltAlYAqRH4d1tGkwzTqN2gA7Nv+fUwkgZ/3mg34txM+szzATJS1HQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("geosphere","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACFSURBVBjTdY+xEcQwCAQp5QNFjpQ5vZACFBFTADFFfKYCXINzlUAJruXll2ekxDAEt9zcANFbXb2mqm56dxsymAH0yccAJaeNi0h5QGyfxGJmivMPjj0nmLsbRmyFCss3rlbpcUjfS8wLUNRcJyCF6uqg2IvYCnoKC7f1kSbA6riTz7evfwj3Ml+H3KBqAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geotrap","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAB5SURBVBjTbY+hFYAwDETZB1OJi4yNPp0JqjtAZ2AELL5DdABmIS2PtLxHXH7u7l2W5W+uHMHpGiCHLYR1yw4SCZMIXBOJWVSjK7QDDAu4g8OBmAKK4sAEDdR3rw8YmcUcrEijKKhl7lN1IQPn9ExlgU6/WEyc75+5AYK0KY5oHBDfAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geotubeseg","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACBSURBVBjTdc+hEcQwDARA12P6QFBQ9LDwcXEVkA7SQTr4BlJBakgpsWdsh/wfux3NSCrlV86Mlrxmz1pBWq3bAHwETohxABVmDZADQp1BE+wDNnGywzHgmHDOreJNTDH3Xn3CVX0dpu2MHcIFBkYp/gKsQ8SCQ72V+36/+2aWf3kAQfgshnpXF0wAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geoxtru","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAABcSURBVBjTY2AgEmhpeZV56vmWwQW00QUYwAJlSAI6XmVqukh8PT1bT03PchhXX09Pr9wQIQDiJ+ZowgWAXD3bck+QQDlCQTkDQgCoxA/ERBKwhbDglgA1lDMQDwCc/Rvq8nYsWgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("geobbox","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAB/SURBVBjTVc+hEYAwDAXQLlNRF1tVGxn9NRswQiSSCdgDyQBM0FlIIb2WuL77uf6E8E0N02wKYRwDciTKREVvB04GuZSyOMCABRB1WGzF3uDNQTvs/RcDtJXT4fSEXA5XoiQt0ttVSm8Co2psIOvoimjAOqBmFtH5wEP2373TPIvTK1nrpULXAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geoconeseg","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAB4SURBVBjTdc6hEcAgDAXQbFNZXHQkFlkd/30myAIMwAws0gmYpVzvoFyv/S5P/B+izzQ387ZA2pkDnvsU1SQLVIFrOM4JFmEaYp2gCQbmPEGODhJ8jt7Am47hwgrzInGAifa/elUZnQLY00iU30BZAV+BWi2VfnIBv1osbHH8jX0AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTItMDJUMTQ6MjY6MjkrMDE6MDDARtd2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE0LTExLTEyVDA4OjM5OjE5KzAxOjAwO3ydwwAAAABJRU5ErkJggg==")}\n${r("geoeltu","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACGSURBVBjTdY+hFYUwDEU7xq9CIXC4uNjY6KczQXeoYgVMR2ABRmCGjvIp/6dgiEruueedvBDuOR57LQnKyc8CJmKO+N8bieIUPtmBWjIIx8XDBHYCipsnql1g2D0UP2OoDqwBncf+RdZmzFMHizRjog7KZYzawd4Ay93lEAPWR7WAvNbwMl/XwSxBV8qCjgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("geomaterial","CAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAABIAAAASABGyWs+AAAAbElEQVQoz62QMRbAIAhDP319Xon7j54qHSyCtaMZFCUkRjgDIdRU9yZUCfg8ut5aAHdcxtoNurmgA3ABNKIR9KimhSukPe2qxcCYC0pfFXx/aFWo7i42KKItOpopqvvnLzJmtlZTS7EfGAfwAM4EQbLIGV0sAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geoparab","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAB/SURBVBjTbY+xDYAwDAQ9UAp3X7p0m9o9dUZgA9oMwAjpMwMzMAnYBAQSX9mn9+tN9KOtzsWsLOvYCziUGNX3nnCLJRzKPgeYrhPW7FJNLUB3YJazYKQKTnBaxgXRzNmJcrt7XCHQp9kEB1wfELEir/KGj4Foh8A+/zW1nf51AFabKZuWK+mNAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geopgon","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAABwSURBVBjTY2AgDlwAAzh3sX1sPRDEeuwDc+8V2dsHgQQ8LCzq74HkLSzs7Yva2tLt7S3sN4MNiDUGKQmysCi6BzWkzcI+PdY+aDPCljZlj1iFOUjW1tvHLjYuQhJIt5/DcAFZYLH9YnSn7iPST9gAACbsJth21haFAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geotorus","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACGSURBVBjTjY+hFcMwDEQ9SkFggXGIoejhw+LiGkBDlHoAr+AhgjNL5byChuXeE7gvPelUyjOds/f5Zw0ggfj5KVCPMBWeyx+SbQ1XUriAC2XfpWWxjQQEZasRtRHiCUAj3qN4JaolUJppzh4q7dUTdHFXW/tH9OuswWm3nI7tc08+/eGLl758ey9KpKrNOQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("geotrd1","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAB/SURBVBjTbc6xDQMhDAVQ9qH6lUtal65/zQ5IDMAMmYAZrmKGm4FJzlEQQUo+bvwkG4fwm9lbodV7w40Y4WGfSxQiXiJlQfZOjWRb8Ioi3tKuBQMCo7+9N72BzPsfAuoTdUP9QN8wgOQwvsfWmHzpeT5BKydMNW0nhJGvGf7mAc5WKO9e5N2dAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE1LTEyLTAyVDE0OjI2OjI5KzAxOjAwwEbXdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMlQwODozOToxOSswMTowMDt8ncMAAAAASUVORK5CYII=")}\n${r("geotube","CAAAAAA6mKC9AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJ0Uk5TAAB2k804AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAACGSURBVBjTRc+tEcAwCAXgLFNbWeSzSDQazw5doWNUZIOM0BEyS/NHy10E30HyklKvWnJ+0le3sJoKn3X2z7GRuvG++YRyMMDt0IIKUXMzxbnugJi5m9K1gNnGBOUFElAWGMaKIKI4xoQggl00gT+A9hXWgDwnfqgsHRAx2m+8bfjfdyrx5AtsSjpwu+M2RgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMi0wMlQxNDoyNjoyOSswMTowMMBG13YAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTJUMDg6Mzk6MTkrMDE6MDA7fJ3DAAAAAElFTkSuQmCC")}\n${r("evepoints","BAMAAADt3eJSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAABJQTFRF////n4mJcEdKRDMzcEdH////lLE/CwAAAAF0Uk5TAEDm2GYAAAABYktHRACIBR1IAAAACXBIWXMAAABIAAAASABGyWs+AAAAI0lEQVQI12NgIAowIpgKEJIZLiAgAKWZGQzQ9UGlWIizBQgAN4IAvGtVrTcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTYtMDktMDJUMTU6MDQ6MzgrMDI6MDDPyc7hAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE2LTA5LTAyVDE1OjA0OjM4KzAyOjAwvpR2XQAAAABJRU5ErkJggg==")}\n${r("evetrack","CAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAABIAAAASABGyWs+AAAAqElEQVQoz32RMQrCQBBFf4IgSMB0IpGkMpVHCFh7BbHIGTyVhU0K8QYewEKsbVJZaCUiPAsXV8Puzhaz7H8zs5+JUDjikLilQr5zpCRl5xMXZNScQE5gSMGaz70jjUAJcw5c3UBMTsUe+9Kzf065SbropeLXimWfDIgoab/tOyPGzOhz53+oSWcSGh7UdB2ZNKXBZdgAuUdEKJYmrEILyVgG6pE2tEHgDfe42rbjYzSHAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTA5LTAyVDE1OjA0OjQ3KzAyOjAwM0S3EQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0wOS0wMlQxNTowNDo0NyswMjowMEIZD60AAAAASUVORK5CYII=")}\n.jsroot .geovis_this { background-color: lightgreen; }\n.jsroot .geovis_daughters { background-color: lightblue; }\n.jsroot .geovis_all { background-color: yellow; }`)}iM("GradPerSegm",m.GeoGradPerSegm),iM("CompressComp",m.GeoCompressComp);let n=new qM(t,e);return n.options=n.decodeOptions(i),Object.assign(n.ctrl,n.options),n.ctrl.ssao.enabled=n.options.usessao,n.ctrl.bloom.enabled=n.options.usebloom,n.ctrl.clip[0].enabled=n.options.clipx,n.ctrl.clip[1].enabled=n.options.clipy,n.ctrl.clip[2].enabled=n.options.clipz,n}function HM(t,e,i){if(!e._geoobj)return!1;let n=e._geoobj,r=e._volume,s="TEveGeoShapeExtract"===n._typename||"ROOT::Experimental::REveGeoShapeExtract"===n._typename;if(!r&&!s)return!1;t.add("separator");const a=(t,e,i)=>{if(e||(e={visible:0,hidden:0}),i||(void 0!==e.assign?t.fRnrSelf=e.assign:t.fRnrSelf?e.vis++:e.hidden++),t.fElements)for(let i=0;i<t.fElements.arr.length;++i)a(t.fElements.arr[i],e,!1);return e},o=t=>{"self"===t?(n.fRnrSelf=!n.fRnrSelf,e._icon=e._icon.split(" ")[0]+NM(n),i.updateTreeNode(e)):(a(n,{assign:"true"===t},!0),i.forEachItem((t=>{t._geoobj&&t._icon&&(t._icon=e._icon.split(" ")[0]+NM(t._geoobj),i.updateTreeNode(t))}),e)),BM(e,"testGeomChanges")},l=t=>{aM(r,t);let n=e._icon.split(" ")[0]+NM(r);i.forEachItem((t=>{e._volume===t._volume&&(t._icon=n,i.updateTreeNode(t))})),i.updateTreeNode(e),BM(e,"testGeomChanges")};if(0===e._geoobj._typename.indexOf("TGeoNode")&&BM(e)&&t.add("Focus",(function(){let t=BM(e);if(!t)return;let n=i.itemFullName(e,t);t._painter&&"function"==typeof t._painter.focusOnItem&&t._painter.focusOnItem(n)})),s){t.addchk(n.fRnrSelf,"Visible","self",o);let e=a(n,void 0,!0);e.hidden+e.visible>0&&t.addchk(0==e.hidden,"Daughters",0!=e.hidden?"true":"false",o)}else t.addchk(rM(r,nM.kVisNone),"Invisible",nM.kVisNone,l),t.addchk(rM(r,nM.kVisThis),"Visible",nM.kVisThis,l),t.addchk(rM(r,nM.kVisDaughters),"Daughters",nM.kVisDaughters,l);return!0}function XM(t,e){if(t._volume)return t._more&&t._volume.fNodes&&t._volume.fNodes.arr.length>0?aM(t._volume,nM.kVisDaughters):aM(t._volume,nM.kVisThis),FM(t._volume,e),BM(t,"testGeomChanges"),!1;if(t._geoobj&&("TEveGeoShapeExtract"==t._geoobj._typename||"ROOT::Experimental::REveGeoShapeExtract"==t._geoobj._typename))return t._geoobj.fRnrSelf=!t._geoobj.fRnrSelf,FM(t._geoobj,e),BM(t,"testGeomChanges"),!1;let i=BM(t);return!!i&&void 0!==i._painter.extraObjectVisible(e,t,!0)}function VM(t,e){let i="";if("ROOT.TEveTrack"==t._kind?i="img_evetrack":("ROOT.TEvePointSet"==t._kind||"ROOT.TPolyMarker3D"==t._kind)&&(i="img_evepoints"),i.length>0){let n=BM(t);n&&n._painter.extraObjectVisible(e,t)&&(i+=" geovis_this")}return i}function YM(t,e,i){let n,r,s,a={_kind:"ROOT."+e._typename,_name:i||uM(e),_title:e.fTitle,_parent:t,_geoobj:e,_get:function(t){return t._geoobj&&(t._geoobj.$geoh=!0),Promise.resolve(t._geoobj)}},o=!1;return"TGeoMaterial"==e._typename?a._icon="img_geomaterial":"TGeoMedium"==e._typename?a._icon="img_geomedium":"TGeoMixture"==e._typename?a._icon="img_geomixture":0===e._typename.indexOf("TGeoNode")&&e.fVolume?(a._title="node:"+e._typename,e.fTitle.length>0&&(a._title+=" "+e.fTitle),n=e.fVolume):0===e._typename.indexOf("TGeoVolume")?n=e:"TEveGeoShapeExtract"==e._typename||"ROOT::Experimental::REveGeoShapeExtract"==e._typename?(o=!0,r=e.fShape,s=e.fElements?e.fElements.arr:null):void 0!==e.fShapeBits&&void 0!==e.fShapeId&&(r=e),n&&(r=n.fShape,s=n.fNodes?n.fNodes.arr:null),(n||r||s)&&(n&&(a._volume=n),s?(a._more=!0,a._expand=LM):r&&"TGeoCompositeShape"===r._typename&&r.fNode&&(a._more=!0,a._shape=r,a._expand=function(t){return YM(t,t._shape.fNode.fLeft,"Left"),YM(t,t._shape.fNode.fRight,"Right"),!0}),a._title||"TGeoVolume"==e._typename||(a._title=e._typename),r?(""==a._title&&(a._title=r._typename),a._icon=function(t){switch(t._typename){case"TGeoArb8":return"img_geoarb8";case"TGeoCone":return"img_geocone";case"TGeoConeSeg":return"img_geoconeseg";case"TGeoCompositeShape":return"img_geocomposite";case"TGeoTube":return"img_geotube";case"TGeoTubeSeg":return"img_geotubeseg";case"TGeoPara":return"img_geopara";case"TGeoParaboloid":return"img_geoparab";case"TGeoPcon":return"img_geopcon";case"TGeoPgon":return"img_geopgon";case"TGeoShapeAssembly":return"img_geoassembly";case"TGeoSphere":return"img_geosphere";case"TGeoTorus":return"img_geotorus";case"TGeoTrd1":return"img_geotrd1";case"TGeoTrd2":return"img_geotrd2";case"TGeoXtru":return"img_geoxtru";case"TGeoTrap":return"img_geotrap";case"TGeoGtra":return"img_geogtra";case"TGeoEltu":return"img_geoeltu";case"TGeoHype":return"img_geohype";case"TGeoCtub":return"img_geoctub"}return"img_geotube"}(r)):a._icon=a._more?"img_geocombi":"img_geobbox",n?a._icon+=NM(n):o&&(a._icon+=NM(e)),a._menu=HM,a._icon_click=XM),t._childs||(t._childs=[]),a._name||("string"==typeof t._name?(a._name=t._name,a._name.lastIndexOf("s")===a._name.length-1&&(a._name=a._name.slice(0,a._name.length-1)),a._name+="_"+t._childs.length):a._name="item_"+t._childs.length),t._childs.push(a),a}function $M(t){let e=t.getObject(),i=[-1,-1,-1],n=[1,1,1];if(e.fP&&e.fP.length)for(let t=0;t<e.fP.length;t+=3)for(let r=0;r<3;++r)i[r]=Math.min(i[r],e.fP[t+r]),n[r]=Math.max(n[r],e.fP[t+r]);let r=k("TNamed");r._typename="TGeoBBox",r.fDX=n[0]-i[0],r.fDY=n[1]-i[1],r.fDZ=n[2]-i[2],r.fShapeId=1,r.fShapeBits=0,r.fOrigin=[0,0,0];let s=k("TEveGeoShapeExtract");Object.assign(s,{fTrans:[1,0,0,0,0,1,0,0,0,0,1,0,(i[0]+n[0])/2,(i[1]+n[1])/2,(i[2]+n[2])/2,0],fShape:r,fRGBA:[0,0,0,0],fElements:null,fRnrSelf:!1});let a="",o=t.getPadPainter();return o&&o.pad&&o.pad.fFillColor&&o.pad.fFillStyle>1e3&&(a="bkgr_"+o.pad.fFillColor),qM.draw(t.getDom(),s,a).then((t=>t.drawExtras(e)))}function WM(t,e){if(!t)return null;e||(e={}),e.numfaces||(e.numfaces=1e5),e.numnodes||(e.numnodes=1e3),e.frustum||(e.frustum=null),e.res_mesh=e.res_faces=0;let i=null,n=!1;if("fShapeBits"in t&&"fShapeId"in t?(i=t,t=null):"TGeoVolumeAssembly"===t._typename||"TGeoVolume"===t._typename||"TEveGeoShapeExtract"===t._typename||"ROOT::Experimental::REveGeoShapeExtract"===t._typename?i=t.fShape:"TGeoManager"===t._typename?(t=t.fMasterVolume,n=!e.showtop,i=t.fShape):t.fVolume?i=t.fVolume.fShape:t=null,e.composite&&i&&"TGeoCompositeShape"==i._typename&&i.fNode&&(t=OM(i)),!t&&i&&(t=Object.assign(k("TEveGeoShapeExtract"),{fTrans:null,fShape:i,fRGBA:[0,1,0,1],fElements:null,fRnrSelf:!0})),!t)return null;0===t._typename.indexOf("TGeoVolume")&&(t={_typename:"TGeoNode",fVolume:t,fName:t.fName,$geoh:t.$geoh,_proxy:!0});let r=new PM(t);r.setVisLevel(e.vislevel),r.setMaxVisNodes(e.numnodes),e.dflt_colors&&r.setDefaultColors(!0),(e.no_screen?0:r.markVisibles(!0))<=0?r.markVisibles(!1,!1,n):r.markVisibles(!0,!0,n),r.produceIdShifts();let s=r.collectVisibles(e.numfaces,e.frustum),a=r.collectShapes(s.lst);r.buildShapes(a,e.numfaces);let o=new Td;for(let t=0;t<s.lst.length;++t){let i=s.lst[t];if(i.done)continue;let n=a[i.shapeid];if(!n.ready){console.warn("shape marked as not ready when should");break}if(i.done=!0,n.used=!0,!n.geom||0===n.nfaces){r.createObject3D(i.stack,o,"delete_mesh");continue}let l=r.getDrawEntryProperties(i,Rl());e.res_mesh++,e.res_faces+=n.nfaces;let h=r.createObject3D(i.stack,o,e);l.material.wireframe=e.wireframe,l.material.side=e.doubleside?2:0;let c=null;c=(h.absMatrix||h.matrixWorld).determinant()>-.9?new Tu(n.geom,l.material):EM(n,l.material),c.name=r.getNodeName(i.nodeid),h.add(c),h.absMatrix&&(c.matrix.copy(h.absMatrix),c.matrix.decompose(h.position,h.quaternion,h.scale),c.updateMatrixWorld())}return o}var ZM=Object.freeze({__proto__:null,ClonedNodes:PM,build:WM,TGeoPainter:qM,GeoDrawingControl:jM,expandGeoObject:LM,createGeoPainter:GM,drawAxis3D:function(){let t=this.getMainPainter();if(t&&"function"==typeof t.setAxesDraw)return t.setAxesDraw(!0);console.error("no geometry painter found to toggle TAxis3D drawing")},drawDummy3DGeom:$M,produceRenderOrder:DM});function QM(t,e){let i=t.getFramePainter();if(!i||!i.mode3d||!e)return null;if(i.toplevel)return i;let n=t.getMainPainter();return n?"function"==typeof n.drawExtras?n.drawExtras(e):null:$M(t)}var JM=Object.freeze({__proto__:null,drawPolyMarker3D:function(){let t=this.getObject(),e=QM(this,t);if(!(e&&"object"==typeof e&&e.grx&&e.gry&&e.grz))return e;let i=1,n=0;for(let i=0;i<t.fP.length;i+=3)t.fP[i]<e.scale_xmin||t.fP[i]>e.scale_xmax||t.fP[i+1]<e.scale_ymin||t.fP[i+1]>e.scale_ymax||t.fP[i+2]<e.scale_zmin||t.fP[i+2]>e.scale_zmax||++n;m.OptimizeDraw>0&&n>5e4&&(i=Math.floor(n/5e4),i<=2&&(i=2));let r=Math.floor(n/i),s=new Vy(r,e.webgl,e.size_x3d/100),a=new Int32Array(r),o=0,l=0;for(let n=0;n<t.fP.length;n+=3)t.fP[n]<e.scale_xmin||t.fP[n]>e.scale_xmax||t.fP[n+1]<e.scale_ymin||t.fP[n+1]>e.scale_ymax||t.fP[n+2]<e.scale_zmin||t.fP[n+2]>e.scale_zmax||i>1&&(o=(o+1)%i,0!==o)||(a[l++]=n,s.addPoint(e.grx(t.fP[n]),e.gry(t.fP[n+1]),e.grz(t.fP[n+2])));return s.createPoints({color:this.getColor(t.fMarkerColor),style:t.fMarkerStyle}).then((i=>(i.tip_color=3===t.fMarkerColor?16711680:65280,i.tip_name=t.fName||"Poly3D",i.poly=t,i.painter=e,i.scale0=.7*s.scale,i.index=a,e.toplevel.add(i),i.tooltip=function(t){if(!Number.isInteger(t.index))return console.error("intersect.index not provided, three.js version 138"),null;let e=Math.floor(t.index/this.nvertex);if(e<0||e>=this.index.length)return null;e=this.index[e];let i=this.painter,n=i.grx(this.poly.fP[e]),r=i.gry(this.poly.fP[e+1]),s=i.grz(this.poly.fP[e+2]);return{x1:n-this.scale0,x2:n+this.scale0,y1:r-this.scale0,y2:r+this.scale0,z1:s-this.scale0,z2:s+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+e/3,"x: "+i.axisAsText("x",this.poly.fP[e]),"y: "+i.axisAsText("y",this.poly.fP[e+1]),"z: "+i.axisAsText("z",this.poly.fP[e+2])]}},e.render3D(100),this)))},drawPolyLine3D:function(){let t=this.getObject(),e=QM(this,t);if(!(e&&"object"==typeof e&&e.grx&&e.gry&&e.grz))return e;let i=3*t.fN,n=t.fP,r=[];for(let t=3;t<i;t+=3)r.push(e.grx(n[t-3]),e.gry(n[t-2]),e.grz(n[t-1]),e.grx(n[t]),e.gry(n[t+1]),e.grz(n[t+2]));let s=Hy(r,Yy(this,t));return e.toplevel.add(s),!0}});class KM extends Vl{redraw(){void 0===this.step&&this.startDrawing()}decodeOptions(t){let e=new sl(t||"REPEAT");this.options||(this.options={}),Object.assign(this.options,{once:e.check("ONCE"),repeat:e.check("REPEAT"),first:e.check("FIRST")}),this.storeDrawOpt(t)}drawPrimitives(t){t||(t=0,this._doing_primitives=!0);let e=this.getObject().fSteps.arr[this.step];return!e||t>=e.arr.length?(delete this._doing_primitives,Promise.resolve()):wb(this.getDom(),e.arr[t],e.opt[t]).then((e=>(e&&(e.$grtimeid=this.selfid),this.drawPrimitives(t+1))))}continueDrawing(){if(!this.options)return;let t=this.getObject();if(this.options.first)delete this.step;else if(this.wait_animation_frame){delete this.wait_animation_frame;let t=this.getPadPainter();if(!t)return void delete this.step;t.cleanPrimitives((t=>t.$grtimeid===this.selfid)),this.drawPrimitives().then((()=>this.continueDrawing()))}else if(this.running_timeout)clearTimeout(this.running_timeout),delete this.running_timeout,this.wait_animation_frame=!0,requestAnimationFrame((()=>this.continueDrawing()));else{let e=t.fSleepTime;if((!e||e<100)&&(e=10),++this.step>t.fSteps.arr.length){if(!this.options.repeat)return void delete this.step;this.step=0,e=Math.max(5e3,5*e)}this.running_timeout=setTimeout((()=>this.continueDrawing()),e)}}startDrawing(){return this.step=0,this.drawPrimitives().then((()=>(this.continueDrawing(),this)))}static draw(t,e,i){if(!e.fFrame)return console.error("Frame histogram not exists"),null;let n=new KM(t,e);return n.getMainPainter()?(console.error("Cannot draw graph time on top of other histograms"),null):(n.decodeOptions(i),!e.fFrame.fTitle&&e.fTitle&&(e.fFrame.fTitle=e.fTitle),n.selfid="grtime"+s.id_counter++,lb.draw(t,e.fFrame,"AXIS").then((()=>(n.addToPadPrimitives(),n.startDrawing()))))}}var tT=Object.freeze({__proto__:null,TGraphTimePainter:KM});class eT extends Vl{decodeOptions(t,e){let i=new sl(t);this.options||(this.options={});let n=this.options;n.Color=i.check("COL"),n.Line=i.check("LINE"),n.Error=i.check("ERR")&&(this.matchObjectType("TGraph2DErrors")||this.matchObjectType("TGraph2DAsymmErrors")),n.Circles=i.check("P0"),n.Markers=i.check("P"),n.Markers||n.Error||n.Circles||n.Line||(1==e.fMarkerSize&&1==e.fMarkerStyle?n.Circles=!0:n.Markers=!0),n.Markers||(n.Color=!1),this.storeDrawOpt(t)}createHistogram(){let t=this.getObject(),e=this.matchObjectType("TGraph2DAsymmErrors"),i=t.fX[0],n=i,r=t.fY[0],s=r,a=t.fZ[0],o=a;for(let l=0;l<t.fNpoints;++l){let h=t.fX[l],c=t.fY[l],d=t.fZ[l];this.options.Error?(i=Math.min(i,h-(e?t.fEXlow[l]:t.fEX[l])),n=Math.max(n,h+(e?t.fEXhigh[l]:t.fEX[l])),r=Math.min(r,c-(e?t.fEYlow[l]:t.fEY[l])),s=Math.max(s,c+(e?t.fEYhigh[l]:t.fEY[l])),a=Math.min(a,d-(e?t.fEZlow[l]:t.fEZ[l])),o=Math.max(o,d+(e?t.fEZhigh[l]:t.fEZ[l]))):(i=Math.min(i,h),n=Math.max(n,h),r=Math.min(r,c),s=Math.max(s,c),a=Math.min(a,d),o=Math.max(o,d))}i>=n&&(n=i+1),r>=s&&(s=r+1),a>=o&&(o=a+1);let l=.02*(n-i),h=.02*(s-r),c=.02*(o-a),d=i-l,u=n+l,f=r-h,m=s+h,p=a-c,g=o+c;d<0&&i>=0&&(d=.98*i),u>0&&n<=0&&(u=0),f<0&&r>=0&&(f=.98*r),m>0&&s<=0&&(m=0),p<0&&a>=0&&(p=.98*a),g>0&&o<=0&&(g=0);let _=this.getObject();-1111!=_.fMinimum&&(p=_.fMinimum),-1111!=_.fMaximum&&(g=_.fMaximum);let x=D("TH2I",10,10);x.fName=_.fName+"_h",x.fTitle=_.fTitle,x.fXaxis.fXmin=d,x.fXaxis.fXmax=u,x.fYaxis.fXmin=f,x.fYaxis.fXmax=m,x.fZaxis.fXmin=p,x.fZaxis.fXmax=g,x.fMinimum=p,x.fMaximum=g;let A=y(9);return x.fBits=x.fBits|A,x}graph2DTooltip(t){if(!Number.isInteger(t.index))return console.error("intersect.index not provided, three.js version 138"),null;let e=Math.floor(t.index/this.nvertex);if(e<0||e>=this.index.length)return null;let i=t=>t*t;e=this.index[e];let n=this.painter,r=this.graph,s=n.grx(r.fX[e]),a=n.gry(r.fY[e]),o=n.grz(r.fZ[e]);if(this.check_next&&e+1<r.fX.length){let l=t.point,h=n.grx(r.fX[e+1]),c=n.gry(r.fY[e+1]),d=n.grz(r.fZ[e+1]);i(l.x-h)+i(l.y-c)+i(l.z-d)<i(l.x-s)+i(l.y-a)+i(l.z-o)&&(s=h,a=c,o=d,e++)}return{x1:s-this.scale0,x2:s+this.scale0,y1:a-this.scale0,y2:a+this.scale0,z1:o-this.scale0,z2:o+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+e,"x: "+n.axisAsText("x",r.fX[e]),"y: "+n.axisAsText("y",r.fY[e]),"z: "+n.axisAsText("z",r.fZ[e])]}}redraw(){let t=this.getMainPainter(),e=this.getFramePainter(),i=this.getObject(),n=1;if(!(i&&t&&e&&e.mode3d))return Promise.resolve(this);let r=(t,n)=>{let r=0;for(let s=0;s<i.fNpoints;++s)i.fX[s]<e.scale_xmin||i.fX[s]>e.scale_xmax||i.fY[s]<e.scale_ymin||i.fY[s]>e.scale_ymax||i.fZ[s]<t||i.fZ[s]>=n||++r;return r};if(m.OptimizeDraw>0&&!e.webgl){let t=r(e.scale_zmin,e.scale_zmax),i=5e4;t>i&&(n=Math.floor(t/i),n<=2&&(n=2))}let s=new ql(i),a=null,o=[e.scale_zmin,e.scale_zmax],l=e.size_x3d/100*s.getFullSize(),h=[];this.options.Circles&&(l=.06*e.size_x3d),e.usesvg&&(l*=.3),this.options.Color&&(o=t.getContourLevels(),a=t.getHistPalette());for(let t=0;t<o.length-1;++t){let s=Math.max(o[t],e.scale_zmin),c=Math.min(o[t+1],e.scale_zmax);if(s>=c)continue;let d=Math.floor(r(s,c)/n),u=null,f=0,m=new Int32Array(d),p=0,g=null,_=!1,x=null,y=0,A=0;(this.options.Markers||this.options.Circles)&&(u=new Vy(d,e.webgl,l/3)),this.options.Error&&(g=new Float32Array(6*d*3),_=this.matchObjectType("TGraph2DAsymmErrors")),this.options.Line&&(x=new Float32Array(6*(d-1)));for(let t=0;t<i.fNpoints;++t){if(i.fX[t]<e.scale_xmin||i.fX[t]>e.scale_xmax||i.fY[t]<e.scale_ymin||i.fY[t]>e.scale_ymax||i.fZ[t]<s||i.fZ[t]>=c)continue;if(n>1&&(f=(f+1)%n,0!==f))continue;m[p++]=t;let r=e.grx(i.fX[t]),a=e.gry(i.fY[t]),o=e.grz(i.fZ[t]);u&&u.addPoint(r,a,o),g&&(g[y]=e.grx(i.fX[t]-(_?i.fEXlow[t]:i.fEX[t])),g[y+1]=a,g[y+2]=o,g[y+3]=e.grx(i.fX[t]+(_?i.fEXhigh[t]:i.fEX[t])),g[y+4]=a,g[y+5]=o,y+=6,g[y]=r,g[y+1]=e.gry(i.fY[t]-(_?i.fEYlow[t]:i.fEY[t])),g[y+2]=o,g[y+3]=r,g[y+4]=e.gry(i.fY[t]+(_?i.fEYhigh[t]:i.fEY[t])),g[y+5]=o,y+=6,g[y]=r,g[y+1]=a,g[y+2]=e.grz(i.fZ[t]-(_?i.fEZlow[t]:i.fEZ[t])),g[y+3]=r,g[y+4]=a,g[y+5]=e.grz(i.fZ[t]+(_?i.fEZhigh[t]:i.fEZ[t])),y+=6),x&&(A>=6&&(x[A]=x[A-3],x[A+1]=x[A-2],x[A+2]=x[A-1],A+=3),x[A]=r,x[A+1]=a,x[A+2]=o,A+=3)}if(x&&A>3&&x.length==A){let t=this.getColor(i.fLineColor),n=Hy(x,new pp({color:new ac(t),linewidth:i.fLineWidth}));e.toplevel.add(n),n.graph=i,n.index=m,n.painter=e,n.scale0=.7*l,n.tip_name=this.getObjectHint(),n.tip_color=3===i.fMarkerColor?16711680:65280,n.nvertex=2,n.check_next=!0,n.tooltip=this.graph2DTooltip}if(g){let t=this.getColor(i.fLineColor),n=Hy(g,new pp({color:new ac(t),linewidth:i.fLineWidth}));e.toplevel.add(n),n.graph=i,n.index=m,n.painter=e,n.scale0=.7*l,n.tip_name=this.getObjectHint(),n.tip_color=3===i.fMarkerColor?16711680:65280,n.nvertex=6,n.tooltip=this.graph2DTooltip}if(u){let n="blue";this.options.Circles||(n=a?a.calcColor(t,o.length):this.getColor(i.fMarkerColor));let r=u.createPoints({color:n,style:this.options.Circles?4:i.fMarkerStyle}).then((t=>{t.graph=i,t.painter=e,t.tip_color=3===i.fMarkerColor?16711680:65280,t.scale0=.3*l,t.index=m,t.tip_name=this.getObjectHint(),t.tooltip=this.graph2DTooltip,e.toplevel.add(t)}));h.push(r)}}return Promise.all(h).then((()=>(e.render3D(100),this)))}static draw(t,e,i){let n=new eT(t,e);n.decodeOptions(i,e);let r=Promise.resolve(!0);return n.getMainPainter()||(e.fHistogram||(e.fHistogram=n.createHistogram()),r=ub.draw(t,e.fHistogram,"lego;axis"),n.ownhisto=!0),r.then((()=>(n.addToPadPrimitives(),n.redraw())))}}var iT=Object.freeze({__proto__:null,TGraph2DPainter:eT});class nT extends Vl{constructor(t,e){super(t,e),this.$polargram=!0,this.zoom_rmin=this.zoom_rmax=0}translate(t,e,i){let n=this.r(e),r=n/this.szx*this.szy,s={x:n*Math.cos(-t-this.angle),y:r*Math.sin(-t-this.angle),rx:n,ry:r};return i||(s.x=Math.round(s.x),s.y=Math.round(s.y),s.rx=Math.round(s.rx),s.ry=Math.round(s.ry)),s}format(t){return t===Math.round(t)?t.toString():this.ndig>10?t.toExponential(4):t.toFixed(this.ndig>0?this.ndig:0)}axisAsText(t,e){return"r"==t?e===Math.round(e)?e.toString():this.ndig>10?e.toExponential(4):e.toFixed(this.ndig+2):(e*=180/Math.PI)===Math.round(e)?e.toString():e.toFixed(1)}getFrameRect(){let t=this.getPadPainter(),e=t.getRootPad(!0),i=t.getPadWidth(),n=t.getPadHeight(),r={};return e?(r.szx=Math.round(Math.max(.1,.5-Math.max(e.fLeftMargin,e.fRightMargin))*i),r.szy=Math.round(Math.max(.1,.5-Math.max(e.fBottomMargin,e.fTopMargin))*n)):(r.szx=Math.round(.5*i),r.szy=Math.round(.5*n)),r.width=2*r.szx,r.height=2*r.szy,r.x=Math.round(i/2-r.szx),r.y=Math.round(n/2-r.szy),r.hint_delta_x=r.szx,r.hint_delta_y=r.szy,r.transform=`translate(${r.x},${r.y})`,r}mouseEvent(t,e){let i=this.getLayerSvg("primitives_layer").select(".interactive_ellipse");if(i.empty())return;let n=null;if("leave"!==t){let t=qi(e,i.node());n={x:t[0],y:t[1],touch:!1}}this.processFrameTooltipEvent(n)}mouseWheel(t){t.stopPropagation(),t.preventDefault(),this.processFrameTooltipEvent(null);let e=this.getObject();if(!e)return;let i=t.wheelDelta?-t.wheelDelta:t.deltaY||t.detail;if(!i)return;i=i<0?-.2:.2;let n=this.scale_rmin,r=this.scale_rmax;r+=i*(r-n),(n<e.fRwrmin||r>e.fRwrmax)&&(n=r=0),this.zoom_rmin==n&&this.zoom_rmax==r||(this.zoom_rmin=n,this.zoom_rmax=r,this.redrawPad())}redraw(){if(!this.isMainPainter())return;let t=this.getObject(),e=this.getPadPainter().getFrameRect();this.createG(),this.draw_g.attr("transform",`translate(${Math.round(e.x+e.width/2)},${Math.round(e.y+e.height/2)})`),this.szx=e.szx,this.szy=e.szy,this.scale_rmin=t.fRwrmin,this.scale_rmax=t.fRwrmax,this.zoom_rmin!=this.zoom_rmax&&(this.scale_rmin=this.zoom_rmin,this.scale_rmax=this.zoom_rmax),this.r=sr().domain([this.scale_rmin,this.scale_rmax]).range([0,this.szx]),this.angle=t.fAxisAngle||0;let i=this.r.ticks(5),n=Math.floor(t.fNdivRad%1e4/100);this.createAttLine({attr:t}),this.gridatt||(this.gridatt=new Hl({color:t.fLineColor,style:2,width:1}));let r=Math.abs(t.fRwrmax-t.fRwrmin);this.ndig=r<=0?-3:Math.round(Math.log10(i.length/r));let s=[],a=0;for(;a<i.length;){let t=this.format(i[a]);if(s.indexOf(t)>=0){if(++this.ndig>10)break;s=[],a=0}else s.push(t),a++}let o=!1;i[i.length-1]<t.fRwrmax&&this.zoom_rmin==this.zoom_rmax&&(i.push(t.fRwrmax),o=!0),this.startTextDrawing(t.fRadialLabelFont,Math.round(t.fRadialTextSize*this.szy*2));for(let e=0;e<i.length;++e){let r=this.r(i[e]),s=r/this.szx*this.szy;if(this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(r)).attr("ry",Math.round(s)).style("fill","none").call(this.lineatt.func),(e<i.length-1||!o)&&this.drawText({align:23,x:Math.round(r),y:Math.round(t.fRadialTextSize*this.szy*.5),text:this.format(i[e]),color:this.getColor(t.fRadialLabelColor),latex:0}),n>1&&(e<i.length-1||!o)){let t=(i[1]-i[0])/n;for(let a=1;a<n;++a){let n=i[e]+t*a;if(n>this.scale_rmax)break;r=this.r(n),s=r/this.szx*this.szy,this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(r)).attr("ry",Math.round(s)).style("fill","none").call(this.gridatt.func)}}}let h=t.fNdivPol%100;return 8!==h&&3!==h&&(h=8),this.finishTextDrawing().then((()=>{let e=Math.round(t.fPolarTextSize*this.szy*2);this.startTextDrawing(t.fPolarLabelFont,e),s=8==h?["0","#frac{#pi}{4}","#frac{#pi}{2}","#frac{3#pi}{4}","#pi","#frac{5#pi}{4}","#frac{3#pi}{2}","#frac{7#pi}{4}"]:["0","#frac{2#pi}{3}","#frac{4#pi}{3}"];let i=[12,11,21,31,32,33,23,13];for(let n=0;n<h;++n){let r=2*-n*Math.PI/h-this.angle;this.draw_g.append("svg:path").attr("d",`M0,0L${Math.round(this.szx*Math.cos(r))},${Math.round(this.szy*Math.sin(r))}`).call(this.lineatt.func);let a=Math.round(16-r/Math.PI*4)%8;this.drawText({align:i[a],x:Math.round((this.szx+e)*Math.cos(r)),y:Math.round((this.szy+e/this.szx*this.szy)*Math.sin(r)),text:s[n],color:this.getColor(t.fPolarLabelColor),latex:1})}return this.finishTextDrawing()})).then((()=>{if(n=Math.floor(t.fNdivPol%1e4/100),n>1)for(let t=0;t<h*n;++t){if(t%n==0)continue;let e=2*-t*Math.PI/h/n-this.angle;this.draw_g.append("svg:path").attr("d",`M0,0L${Math.round(this.szx*Math.cos(e))},${Math.round(this.szy*Math.sin(e))}`).call(this.gridatt.func)}if(l())return;Tv.assign(this);let e=this.getLayerSvg("primitives_layer"),i=e.select(".interactive_ellipse");i.empty()&&(i=e.append("g").classed("most_upper_primitives",!0).append("ellipse").classed("interactive_ellipse",!0).attr("cx",0).attr("cy",0).style("fill","none").style("pointer-events","visibleFill").on("mouseenter",(t=>this.mouseEvent("enter",t))).on("mousemove",(t=>this.mouseEvent("move",t))).on("mouseleave",(t=>this.mouseEvent("leave",t)))),i.attr("rx",this.szx).attr("ry",this.szy),Ii(i.node().parentNode).attr("transform",this.draw_g.attr("transform")),m.Zooming&&m.ZoomWheel&&i.on("wheel",(t=>this.mouseWheel(t)))}))}static draw(t,e){let i=Wl(t);if(i){if(i.getObject()===e)return i;throw Error("Cannot superimpose TGraphPolargram with any other drawings")}let n=new nT(t,e);return Vv(n,!1).then((()=>(n.setAsMainPainter(),n.redraw()))).then((()=>n))}}class rT extends Vl{redraw(){this.drawGraphPolar()}decodeOptions(t){let e=new sl(t||"L");this.options||(this.options={}),Object.assign(this.options,{mark:e.check("P"),err:e.check("E"),fill:e.check("F"),line:e.check("L"),curve:e.check("C")}),this.storeDrawOpt(t)}drawGraphPolar(){let t=this.getObject(),e=this.getMainPainter();if(!t||!e||!e.$polargram)return;this.options.mark&&this.createAttMarker({attr:t}),(this.options.err||this.options.line||this.options.curve)&&this.createAttLine({attr:t}),this.options.fill&&this.createAttFill({attr:t}),this.createG(),this.draw_g.attr("transform",e.draw_g.attr("transform"));let i="",n="",r="",s=[];for(let a=0;a<t.fNpoints;++a){if(t.fY[a]>e.scale_rmax)continue;if(this.options.err){let i=e.translate(t.fX[a],t.fY[a]-t.fEY[a]),r=e.translate(t.fX[a],t.fY[a]+t.fEY[a]);n+=`M${i.x},${i.y}L${r.x},${r.y}`,i=e.translate(t.fX[a]+t.fEX[a],t.fY[a]),r=e.translate(t.fX[a]-t.fEX[a],t.fY[a]),n+=`M${i.x},${i.y}A${r.rx},${r.ry},0,0,1,${r.x},${r.y}`}let o=e.translate(t.fX[a],t.fY[a]);this.options.mark&&(i+=this.markeratt.create(o.x,o.y)),(this.options.line||this.options.fill)&&(r+=(r?"L":"M")+o.x+","+o.y),this.options.curve&&(o.grx=o.x,o.gry=o.y,s.push(o))}this.options.fill&&r&&this.draw_g.append("svg:path").attr("d",r+"Z").call(this.fillatt.func),this.options.line&&r&&this.draw_g.append("svg:path").attr("d",r).style("fill","none").call(this.lineatt.func),this.options.curve&&s.length&&this.draw_g.append("svg:path").attr("d",ol("bezier",s).path).style("fill","none").call(this.lineatt.func),n&&this.draw_g.append("svg:path").attr("d",n).style("fill","none").call(this.lineatt.func),i&&this.draw_g.append("svg:path").attr("d",i).call(this.markeratt.func)}createPolargram(){let t=k("TGraphPolargram"),e=this.getObject(),i=e.fY[0]||0,n=i;for(let t=0;t<e.fNpoints;++t)i=Math.min(i,e.fY[t]-e.fEY[t]),n=Math.max(n,e.fY[t]+e.fEY[t]);return t.fRwrmin=i-.1*(n-i),t.fRwrmax=n+.1*(n-i),t}extractTooltip(t){if(!t)return null;let e=this.getObject(),i=this.getMainPainter(),n=1e10,r=-1,s=null;for(let a=0;a<e.fNpoints;++a){let o=i.translate(e.fX[a],e.fY[a]),l=(o.x-t.x)*(o.x-t.x)+(o.y-t.y)*(o.y-t.y);l<n&&(n=l,r=a,s=o)}let a=5;if(this.markeratt&&this.markeratt.used&&(a=this.markeratt.getFullSize()),Math.sqrt(n)>a)return null;let o={name:this.getObject().fName,title:this.getObject().fTitle,x:s.x,y:s.y,color1:this.markeratt&&this.markeratt.used?this.markeratt.color:this.lineatt.color,exact:Math.sqrt(n)<4,lines:[this.getObjectHint()],binindx:r,menu_dist:a,radius:a};return o.lines.push("r = "+i.axisAsText("r",e.fY[r])),o.lines.push("phi = "+i.axisAsText("phi",e.fX[r])),e.fEY&&e.fEY[r]&&o.lines.push("error r = "+i.axisAsText("r",e.fEY[r])),e.fEX&&e.fEX[r]&&o.lines.push("error phi = "+i.axisAsText("phi",e.fEX[r])),o}showTooltip(t){if(!this.draw_g)return;let e=this.draw_g.select(".tooltip_bin");t?(e.empty()&&(e=this.draw_g.append("svg:ellipse").attr("class","tooltip_bin").style("pointer-events","none")),t.changed=e.property("current_bin")!==t.binindx,t.changed&&e.attr("cx",t.x).attr("cy",t.y).attr("rx",Math.round(t.radius)).attr("ry",Math.round(t.radius)).style("fill","none").style("stroke",t.color1).property("current_bin",t.binindx)):e.remove()}processTooltipEvent(t){let e=this.extractTooltip(t);return t&&t.disabled||this.showTooltip(e),e}static draw(t,e,i){let n=new rT(t,e);n.decodeOptions(i);let r=n.getMainPainter();if(r&&!r.$polargram)return console.error("Cannot superimpose TGraphPolar with plain histograms"),null;let s=Promise.resolve(null);return r||(e.fPolargram||(e.fPolargram=n.createPolargram()),s=nT.draw(t,e.fPolargram)),s.then((()=>(n.addToPadPrimitives(),n.drawGraphPolar(),n)))}}var sT=Object.freeze({__proto__:null,TGraphPolargramPainter:nT,TGraphPolarPainter:rT});const aT=y(18);class oT extends Vl{constructor(t,e){super(t,e),this.axes_draw=!1,this.bins=null,this.xmin=this.ymin=this.xmax=this.ymax=0,this.wheel_zoomy=!0,this.is_bent="TGraphBentErrors"==e._typename,this.has_errors="TGraphErrors"==e._typename||"TGraphMultiErrors"==e._typename||"TGraphAsymmErrors"==e._typename||this.is_bent||e._typename.match(/^RooHist/)}redraw(){let t=Promise.resolve(!0);if(this.$redraw_hist){delete this.$redraw_hist;let e=this.getMainPainter();e&&e.$secondary&&this.axes_draw&&(t=e.redraw())}return t.then((()=>this.drawGraph()))}cleanup(){delete this.interactive_bin,delete this.bins,super.cleanup()}get_gme(){let t=this.getObject();return"TGraphMultiErrors"==t._typename?t:null}decodeOptions(t,e){"string"==typeof t&&0==t.indexOf("same ")&&(t=t.slice(5));let i=this.getObject(),n=!!this.get_gme(),r=[],s=e?!!this.getMainPainter():!this.axes_draw;this.options||(this.options={});const a=(t,e)=>{Object.assign(e,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,MainError:1,Ends:1,ScaleErrX:1}),n&&t.check("S=",!0)&&(e.ScaleErrX=t.partAsFloat()),t.check("L")&&(e.Line=1),t.check("F")&&(e.Fill=1),t.check("CC")&&(e.Curve=2),t.check("C")&&(e.Curve=1),t.check("*")&&(e.Mark=103),t.check("P0")&&(e.Mark=104),t.check("P")&&(e.Mark=1),t.check("B")&&(e.Bar=1,e.Errors=0),t.check("Z")&&(e.Errors=1,e.Ends=0),t.check("||")&&(e.Errors=1,e.MainError=0,e.Ends=1),t.check("[]")&&(e.Errors=1,e.MainError=0,e.Ends=2),t.check("|>")&&(e.Errors=1,e.Ends=3),t.check(">")&&(e.Errors=1,e.Ends=4),t.check("0")&&(e.Mark=1,e.Errors=1,e.OutRange=1),t.check("1")&&1==e.Bar&&(e.Bar=2),t.check("2")&&(e.Rect=1,e.Errors=0),t.check("3")&&(e.EF=1,e.Errors=0),t.check("4")&&(e.EF=2,e.Errors=0),t.check("5")&&(e.Rect=2,e.Errors=0),t.check("X")&&(e.Errors=0)};Object.assign(this.options,{Axis:"",NoOpt:0,PadStats:!1,original:t,second_x:!1,second_y:!1,individual_styles:!1}),n&&t&&(t.indexOf(";")>0?(r=t.split(";"),t=r.shift()):t.indexOf("_")>0&&(r=t.split("_"),t=r.shift()));let o=this.options,l=new sl(t);o.PadStats=l.check("USE_PAD_STATS");let h="";if(["USE_PAD_TITLE","LOGXY","LOGX","LOGY","LOGZ","GRIDXY","GRIDX","GRIDY","TICKXY","TICKX","TICKY"].forEach((t=>{l.check(t)&&(h+=";"+t)})),l.check("XAXIS_",!0)&&(h+=";XAXIS_"+l.part),l.check("YAXIS_",!0)&&(h+=";YAXIS_"+l.part),l.empty()&&(o.original=s?"lp":"alp",l=new sl(o.original)),l.check("NOOPT")&&(o.NoOpt=1),l.check("POS3D_",!0)&&(o.pos3d=l.partAsInt()-.5),o._pfc=l.check("PFC"),o._plc=l.check("PLC"),o._pmc=l.check("PMC"),l.check("A")&&(o.Axis=l.check("I")?"A":"AXIS"),l.check("X+")&&(o.Axis+="X+",o.second_x=s),l.check("Y+")&&(o.Axis+="Y+",o.second_y=s),l.check("RX")&&(o.Axis+="RX"),l.check("RY")&&(o.Axis+="RY"),n&&(o.blocks=[],o.skip_errors_x0=o.skip_errors_y0=!1,l.check("X0")&&(o.skip_errors_x0=!0),l.check("Y0")&&(o.skip_errors_y0=!0)),a(l,o),n&&l.check("S")&&(o.individual_styles=!0),void 0===o.Errors&&(o.Errors=!this.has_errors||n&&r.length?0:1),1==o.Mark&&1==i.fMarkerStyle&&(o.Mark=101),o.Line+o.Fill+o.Curve+o.Mark+o.Bar+o.EF+o.Rect+o.Errors==0&&l.empty()&&(o.Line=1),"TGraphErrors"==i._typename){let t=i.fEX.length,e=0;for(let n=0;n<t;++n)e=Math.max(e,i.fEX[n],i.fEY[n]);e<1e-100&&(o.Errors=0)}if(o.Axis)o.Axis.indexOf("A")<0&&(o.Axis="AXIS,"+o.Axis);else{let t=this.getPadPainter(),e=t?t.getRootPad(!0):null;(!e||e.fPrimitives&&e.fPrimitives.arr[0]===i)&&(o.Axis="AXIS")}o.Axis+=h;for(let t=0;t<r.length;++t){let e={};a(new sl(r[t]),e),e.skip_errors_x0=o.skip_errors_x0,e.skip_errors_y0=o.skip_errors_y0,o.blocks.push(e)}}extractGmeErrors(t){if(!this.bins)return;let e=this.getObject();this.bins.forEach((i=>{i.eylow=e.fEyL[t][i.indx],i.eyhigh=e.fEyH[t][i.indx]}))}createBins(){let t=this.getObject();if(!t)return;let e=0,i=t.fNpoints;"TCutG"===t._typename&&i>3&&i--,"TGraphErrors"==t._typename?e=1:"TGraphMultiErrors"==t._typename?e=2:("TGraphAsymmErrors"==t._typename||"TGraphBentErrors"==t._typename||t._typename.match(/^RooHist/))&&(e=3),this.bins=new Array(i);for(let n=0;n<i;++n){let i=this.bins[n]={x:t.fX[n],y:t.fY[n],indx:n};switch(e){case 1:i.exlow=i.exhigh=t.fEX[n],i.eylow=i.eyhigh=t.fEY[n];break;case 2:i.exlow=t.fExL[n],i.exhigh=t.fExH[n],i.eylow=t.fEyL[0][n],i.eyhigh=t.fEyH[0][n];break;case 3:i.exlow=t.fEXlow[n],i.exhigh=t.fEXhigh[n],i.eylow=t.fEYlow[n],i.eyhigh=t.fEYhigh[n]}0===n&&(this.xmin=this.xmax=i.x,this.ymin=this.ymax=i.y),e>0?(this.xmin=Math.min(this.xmin,i.x-i.exlow,i.x+i.exhigh),this.xmax=Math.max(this.xmax,i.x-i.exlow,i.x+i.exhigh),this.ymin=Math.min(this.ymin,i.y-i.eylow,i.y+i.eyhigh),this.ymax=Math.max(this.ymax,i.y-i.eylow,i.y+i.eyhigh)):(this.xmin=Math.min(this.xmin,i.x),this.xmax=Math.max(this.xmax,i.x),this.ymin=Math.min(this.ymin,i.y),this.ymax=Math.max(this.ymax,i.y))}}createHistogram(t,e,i){let n=this.xmin,r=this.xmax,s=this.ymin,a=this.ymax;n>=r&&(r=n+1),s>=a&&(a=s+1);let o=.1*(r-n),l=.1*(a-s),h=n-o,c=r+o,d=s-l,u=a+l;h<0&&n>=0&&(h=.9*n),c>0&&r<=0&&(c=0);let f=this.getObject();if(-1111!=f.fMinimum&&(d=s=f.fMinimum),-1111!=f.fMaximum&&(u=f.fMaximum),d<0&&s>=0&&(d=.9*s),e||i||(e=i=!0),!(t=f.fHistogram)){(t=f.fHistogram=D("TH1F",100)).fName=f.fName+"_h";let e=y(9);t.fBits=t.fBits|e,this._own_histogram=!0}return t.fTitle=f.fTitle,e&&(t.fXaxis.fXmin=h,t.fXaxis.fXmax=c),i&&(t.fYaxis.fXmin=d,t.fYaxis.fXmax=u,t.fMinimum=d,t.fMaximum=u),t}unzoomUserRange(t,e){let i=this.getObject();if(this._own_histogram||!i)return!1;let n=i.fHistogram;if(t=t&&n&&(n.fXaxis.fXmin>this.xmin||n.fXaxis.fXmax<this.xmax),e=e&&n&&(n.fYaxis.fXmin>this.ymin||n.fYaxis.fXmax<this.ymax),!t&&!e)return!1;this.createHistogram(null,t,e);let r=this.getMainPainter();return r&&r.extractAxesProperties(1),!0}canOptimize(){return m.OptimizeDraw>0&&!this.options.NoOpt}optimizeBins(t,e){if(this.bins.length<30&&!e)return this.bins;let i=null;if("function"==typeof e)for(let t=0;t<this.bins.length;++t)e(this.bins[t],t)?i||(i=0==t?[]:this.bins.slice(0,t)):i&&i.push(this.bins[t]);if(i||(i=this.bins),t||(t=5e5),i.length<t||!this.canOptimize())return i;let n=Math.floor(i.length/t);n<2&&(n=2);let r=[];for(let t=0;t<i.length;t+=n)r.push(i[t]);return r}getTooltips(t){let e=this.getFramePainter(),i=[],n=e?e.getGrFuncs(this.options.second_x,this.options.second_y):null,r=this.get_gme();if(i.push(this.getObjectHint()),t&&n)if(i.push("x = "+n.axisAsText("x",t.x)),i.push("y = "+n.axisAsText("y",t.y)),r?i.push("error x = -"+n.axisAsText("x",r.fExL[t.indx])+"/+"+n.axisAsText("x",r.fExH[t.indx])):this.options.Errors&&"normal"==n.x_handle.kind&&(t.exlow||t.exhigh)&&i.push("error x = -"+n.axisAsText("x",t.exlow)+"/+"+n.axisAsText("x",t.exhigh)),r)for(let e=0;e<r.fNYErrors;++e)i.push(`error y${e} = -${n.axisAsText("y",r.fEyL[e][t.indx])}/+${n.axisAsText("y",r.fEyH[e][t.indx])}`);else(this.options.Errors||this.options.EF>0)&&"normal"==n.y_handle.kind&&(t.eylow||t.eyhigh)&&i.push("error y = -"+n.axisAsText("y",t.eylow)+"/+"+n.axisAsText("y",t.eyhigh));return i}get_main(){let t=this.getFramePainter();if(t&&t.grx&&t.gry)return t;let e=this.getPadPainter(),i=e?e.getPadRect():{width:800,height:600};return t={pad_layer:!0,pad:e.getRootPad(!0),pw:i.width,ph:i.height,getFrameWidth:function(){return this.pw},getFrameHeight:function(){return this.ph},grx:function(t){return(t=this.pad.fLogx?t>0?Math.log10(t):this.pad.fUxmin:(t-this.pad.fX1)/(this.pad.fX2-this.pad.fX1))*this.pw},gry:function(t){return(1-(t=this.pad.fLogy?t>0?Math.log10(t):this.pad.fUymin:(t-this.pad.fY1)/(this.pad.fY2-this.pad.fY1)))*this.ph},getGrFuncs:function(){return this}},t.pad?t:null}appendExclusion(t,e,i,n){let r=[];for(let t=i.length-1;t>=0;--t){let e=i[t],s=Math.sqrt(e.dgrx*e.dgrx+e.dgry*e.dgry);e.grx+=n*e.dgry/s,e.gry-=n*e.dgrx/s,r.push(e)}let s=ol("L"+(t?"bezier":"line"),r);this.draw_g.append("svg:path").attr("d",e.path+s.path+"Z").call(this.fillatt.func).style("opacity",.75)}drawBins(t,e,i,n,r,s,a,o){let h=this.getObject(),c=0,d=null;if(o&&0!=s.excl_side&&(c=s.excl_width,s.width>0&&!e.Line&&!e.Curve&&(e.Line=1)),e.EF){d=this.optimizeBins(e.EF>1?2e4:0);for(let e=0;e<d.length;++e){let i=d[e];i.grx=t.grx(i.x),i.gry=t.gry(i.y-i.eylow)}let n=ol(e.EF>1?"bezier":"line",d),r=[];for(let e=d.length-1;e>=0;--e){let i=d[e];i.gry=t.gry(i.y+i.eyhigh),r.push(i)}let s=ol(e.EF>1?"Lbezier":"Lline",r);i.append("svg:path").attr("d",n.path+s.path+"Z").call(a.func),o&&(this.draw_kind="lines")}if(e.Line||e.Fill){let n="";"TCutG"==h._typename&&(e.Fill=1),e.Fill&&(n="Z",c=0),d||(d=this.optimizeBins(0));for(let e=0;e<d.length;++e){let i=d[e];i.grx=t.grx(i.x),i.gry=t.gry(i.y)}let r="line";c&&(r+="calc");let l=ol(r,d);c&&this.appendExclusion(!1,l,d,c);let u=i.append("svg:path").attr("d",l.path+n);e.Line&&u.call(s.func),e.Fill?u.call(a.func):u.style("fill","none"),o&&(this.draw_kind="lines")}if(e.Curve){let n=d;if("lines"!=this.draw_kind||!n||1==e.Curve&&n.length>2e4){n=this.optimizeBins(1==e.Curve?2e4:0);for(let e=0;e<n.length;++e){let i=n[e];i.grx=t.grx(i.x),i.gry=t.gry(i.y)}}let r="bezier";c&&(r+="calc");let a=ol(r,n);c&&this.appendExclusion(!0,a,n,c),i.append("svg:path").attr("d",a.path).call(s.func).style("fill","none"),o&&(this.draw_kind="lines")}let u=null;if((e.Errors||e.Rect||e.Bar)&&(d=this.optimizeBins(5e3,((i,s)=>{let a=t.grx(i.x);if(!e.Bar&&(a<0||a>n))return!0;let o=t.gry(i.y);return!e.Bar&&!e.OutRange&&(o<0||o>r)||(i.grx1=Math.round(a),i.gry1=Math.round(o),this.has_errors&&(i.grx0=Math.round(t.grx(i.x-e.ScaleErrX*i.exlow)-a),i.grx2=Math.round(t.grx(i.x+e.ScaleErrX*i.exhigh)-a),i.gry0=Math.round(t.gry(i.y-i.eylow)-o),i.gry2=Math.round(t.gry(i.y+i.eyhigh)-o),this.is_bent?(i.grdx0=Math.round(t.gry(i.y+h.fEXlowd[s])-o),i.grdx2=Math.round(t.gry(i.y+h.fEXhighd[s])-o),i.grdy0=Math.round(t.grx(i.x+h.fEYlowd[s])-a),i.grdy2=Math.round(t.grx(i.x+h.fEYhighd[s])-a)):i.grdx0=i.grdx2=i.grdy0=i.grdy2=0),!1)})),o&&(this.draw_kind="nodes"),u=i.selectAll(".grpoint").data(d).enter().append("svg:g").attr("class","grpoint").attr("transform",(t=>`translate(${t.grx1},${t.gry1})`))),e.Bar){for(let t=1;t<d.length-1;++t)d[t].width=Math.max(2,(d[t+1].grx1-d[t-1].grx1)/2-2);switch(d.length){case 0:break;case 1:d[0].width=n/4;break;case 2:d[0].width=d[1].width=(d[1].grx1-d[0].grx1)/2;break;default:d[0].width=d[1].width,d[d.length-1].width=d[d.length-2].width}let i=Math.round(t.gry(0)),s=a;if(o){let t=this.getFramePainter(),e=t&&t.fillatt&&!t.fillatt.empty()?t.fillatt.getFillColor():-1;e===a.getFillColor()&&(s=new Ul({color:"white"==e?1:0,pattern:1001}))}u.append("svg:path").attr("d",(t=>{t.bar=!0;let n=Math.round(-t.width/2),s=Math.round(t.width);return`M${n},${1!==e.Bar?0:t.gry1>i?i-t.gry1:0}h${s}v${1!==e.Bar?r>t.gry1?r-t.gry1:0:Math.abs(i-t.gry1)}h${-s}z`})).call(s.func)}if(e.Rect&&u.filter((t=>t.exlow>0&&t.exhigh>0&&t.eylow>0&&t.eyhigh>0)).append("svg:path").attr("d",(t=>(t.rect=!0,`M${t.grx0},${t.gry0}H${t.grx2}V${t.gry2}H${t.grx0}Z`))).call(a.func).call(2===e.Rect?s.func:()=>{}),this.error_size=0,e.Errors){let t=s.width+p.fEndErrorSize,i=0,n=e.Ends?`m0,${t}v${-2*t}`:"",r=e.Ends?`m${t},0h${-2*t}`:"",a=n,c=n,d=r,f=r;const g=(t,i)=>{if(!e.MainError)return`M${t},${i}`;let n="M0,0";return t?n+(i?`L${t},${i}`:`H${t}`):i?`M0,0V${i}`:n};switch(e.Ends){case 2:i=Math.max(s.width+1,Math.round(.66*t)),a=`m${i},${t}h${-i}v${-2*t}h${i}`,c=`m${-i},${t}h${i}v${-2*t}h${-i}`,d=`m${-t},${i}v${-i}h${2*t}v${i}`,f=`m${-t},${-i}v${i}h${2*t}v${-i}`;break;case 3:t=Math.max(t,Math.round(8*h.fMarkerSize*.66)),i=Math.max(s.width+1,Math.round(.66*t)),a=`l${i},${t}v${-2*t}l${-i},${t}`,c=`l${-i},${t}v${-2*t}l${i},${t}`,d=`l${-t},${i}h${2*t}l${-t},${-i}`,f=`l${-t},${-i}h${2*t}l${-t},${i}`;break;case 4:t=Math.max(t,Math.round(8*h.fMarkerSize*.66)),i=Math.max(s.width+1,Math.round(.66*t)),a=`l${i},${t}m0,${-2*t}l${-i},${t}`,c=`l${-i},${t}m0,${-2*t}l${i},${t}`,d=`l${-t},${i}m${2*t},0l${-t},${-i}`,f=`l${-t},${-i}m${2*t},0l${-t},${i}`}this.error_size=t,t=Math.floor((s.width-1)/2);let _=u.filter((t=>t.exlow>0||t.exhigh>0||t.eylow>0||t.eyhigh>0));(e.skip_errors_x0||e.skip_errors_y0)&&(_=_.filter((t=>!(0==t.x&&e.skip_errors_x0||0==t.y&&e.skip_errors_y0)))),!l()&&m.Tooltip&&o&&_.append("svg:path").style("fill","none").style("pointer-events","visibleFill").attr("d",(t=>`M${t.grx0},${t.gry0}h${t.grx2-t.grx0}v${t.gry2-t.gry0}h${t.grx0-t.grx2}z`)),_.append("svg:path").call(s.func).style("fill","none").attr("d",(e=>(e.error=!0,(e.exlow>0?g(e.grx0+t,e.grdx0)+a:"")+(e.exhigh>0?g(e.grx2-t,e.grdx2)+c:"")+(e.eylow>0?g(e.grdy0,e.gry0-t)+f:"")+(e.eyhigh>0?g(e.grdy2,e.gry2+t)+d:""))))}if(e.Mark){let s,a,c,f="";this.createAttMarker({attr:h,style:e.Mark-100}),this.marker_size=this.markeratt.getFullSize(),this.markeratt.resetPos();let p=!l()&&m.Tooltip&&(!this.markeratt.fill||this.marker_size<7)&&!u&&o,g="",_=Math.max(5,Math.round(.7*this.marker_size)),x=1e6/(this.markeratt.getMarkerLength()+7),y=1;d?this.canOptimize()&&d.length>1.5*x&&(y=Math.min(2,Math.round(d.length/x))):d=this.optimizeBins(x);for(let e=0;e<d.length;e+=y)s=d[e],a=t.grx(s.x),a>-this.marker_size&&a<n+this.marker_size&&(c=t.gry(s.y),c>-this.marker_size&&c<r+this.marker_size&&(f+=this.markeratt.create(a,c),p&&(g+=`M${a-_},${c-_}h${2*_}v${2*_}h${-2*_}z`)));f.length>0&&(i.append("svg:path").attr("d",f).call(this.markeratt.func),null===u&&"none"==this.draw_kind&&o&&(this.draw_kind=101==e.Mark?"path":"mark")),p&&g&&i.append("svg:path").attr("d",g).style("fill","none").style("pointer-events","visibleFill")}}appendQQ(t,e){let i=Math.max(t.scale_xmin,e.fXq1),n=Math.min(t.scale_xmax,e.fXq2),r=Math.max(t.scale_ymin,e.fYq1),s=Math.min(t.scale_ymax,e.fYq2),a="",o=(e,i,n,r)=>`M${t.grx(e)},${t.gry(i)}L${t.grx(n)},${t.gry(r)}`,l=(e.fYq2-e.fYq1)*(t.scale_xmin-e.fXq1)/(e.fXq2-e.fXq1)+e.fYq1;if(l<t.scale_ymin){a=o((e.fXq2-e.fXq1)*(t.scale_ymin-e.fYq1)/(e.fYq2-e.fYq1)+e.fXq1,t.scale_ymin,i,r)}else a=o(t.scale_xmin,l,i,r);let h=(e.fYq2-e.fYq1)*(t.scale_xmax-e.fXq1)/(e.fXq2-e.fXq1)+e.fYq1;if(h>t.scale_ymax){a+=o(n,s,(e.fXq2-e.fXq1)*(t.scale_ymax-e.fYq1)/(e.fYq2-e.fYq1)+e.fXq1,t.scale_ymax)}else a+=o(n,s,t.scale_xmax,h);let c=new Hl({style:1,width:1,color:"black"}),d=new Hl({style:2,width:1,color:"black"});this.draw_g.append("path").attr("d",o(i,r,n,s)).call(c.func).style("fill","none"),this.draw_g.append("path").attr("d",a).call(d.func).style("fill","none")}drawBins3D(){console.log("Load ./hist/TGraphPainter.mjs to draw graph in 3D")}drawGraph(){let t=this.get_main(),e=this.getObject();if(!t)return;if(this.options.pos3d)return this.drawBins3D(t,e);let i=!!this.get_gme(),n=t.getGrFuncs(this.options.second_x,this.options.second_y),r=t.getFrameWidth(),s=t.getFrameHeight();if(this.createG(!t.pad_layer),this.options._pfc||this.options._plc||this.options._pmc){let t=this.getMainPainter();if(t&&t.createAutoColor){let i=t.createAutoColor();this.options._pfc&&(e.fFillColor=i,delete this.fillatt),this.options._plc&&(e.fLineColor=i,delete this.lineatt),this.options._pmc&&(e.fMarkerColor=i,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1}}this.createAttLine({attr:e,can_excl:!0}),this.createAttFill({attr:e}),this.fillatt.used=!1,this.draw_kind="none",this.marker_size=0;let a=i?this.draw_g.append("svg:g"):this.draw_g;if(this.drawBins(n,this.options,a,r,s,this.lineatt,this.fillatt,!0),"TGraphQQ"==e._typename&&this.appendQQ(n,e),i){for(let t=0;t<e.fNYErrors;++t){let i=this.lineatt,a=this.fillatt;this.options.individual_styles&&(i=new Hl({attr:e.fAttLine[t],std:!1}),a=new Ul({attr:e.fAttFill[t],std:!1,svg:this.getCanvSvg()}));let o=this.draw_g.append("svg:g"),l=t<this.options.blocks.length?this.options.blocks[t]:this.options;this.extractGmeErrors(t),this.drawBins(n,l,o,r,s,i,a)}this.extractGmeErrors(0)}l()||pv(this,this.testEditable())}extractTooltip(t){if(!t)return null;if("lines"==this.draw_kind||"path"==this.draw_kind||"mark"==this.draw_kind)return this.extractTooltipForPath(t);if("nodes"!=this.draw_kind)return null;let e=this.getFramePainter(),i=e.getFrameHeight(),n=this.error_size,r=1===this.options.Bar,s=r?e.getGrFuncs(painter.options.second_x,painter.options.second_y):null,a=null,o=1e10,l=null,h=this.marker_size?Math.round(this.marker_size/2+1.5):0;if(this.draw_g.selectAll(".grpoint").each((function(){let e=Ii(this).datum();if(void 0===e)return;let c,d=Math.pow(t.x-e.grx1,2);if(1===t.nproc&&(d+=Math.pow(t.y-e.gry1,2)),d>=o)return;if(e.error||e.rect||e.marker)c={x1:Math.min(-n,e.grx0,-h),x2:Math.max(n,e.grx2,h),y1:Math.min(-n,e.gry2,-h),y2:Math.max(n,e.gry0,h)};else if(e.bar){if(c={x1:-e.width/2,x2:e.width/2,y1:0,y2:i-e.gry1},r){let t=s.gry(0);c.y1=e.gry1>t?t-e.gry1:0,c.y2=e.gry1>t?0:t-e.gry1}}else c={x1:-5,x2:5,y1:-5,y2:5};let u=t.x>=e.grx1+c.x1&&t.x<=e.grx1+c.x2,f=t.y>=e.gry1+c.y1&&t.y<=e.gry1+c.y2;u&&(f||t.nproc>1)&&(o=d,a=this,l=c,l.exact=f)})),null===a)return null;let c=Ii(a).datum(),d=this.getObject(),u={name:d.fName,title:d.fTitle,x:c.grx1,y:c.gry1,color1:this.lineatt.color,lines:this.getTooltips(c),rect:l,d3bin:a};return u.user_info={obj:d,name:d.fName,bin:c.indx,cont:c.y,grx:c.grx1,gry:c.gry1},this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(u.color2=this.fillatt.getFillColor()),l.exact&&(u.exact=!0),u.menu=u.exact,u.menu_dist=3,u.bin=c,u.binindx=c.indx,u}showTooltip(t){if(!t)return void(this.draw_g&&this.draw_g.select(".tooltip_bin").remove());if(t.usepath)return this.showTooltipForPath(t);let e=Ii(t.d3bin).datum(),i=this.draw_g.select(".tooltip_bin");i.empty()&&(i=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),t.changed=i.property("current_bin")!==t.d3bin,t.changed&&i.attr("x",e.grx1+t.rect.x1).attr("width",t.rect.x2-t.rect.x1).attr("y",e.gry1+t.rect.y1).attr("height",t.rect.y2-t.rect.y1).style("opacity","0.3").property("current_bin",t.d3bin)}processTooltipEvent(t){let e=this.extractTooltip(t);return t&&t.disabled||this.showTooltip(e),e}findBestBin(t){if(!this.bins)return null;let e,i,n,r,s,a="lines"==this.draw_kind,o=-1,l=null,h=1e10,c=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y);for(r=0;r<this.bins.length;++r)s=this.bins[r],i=c.grx(s.x),n=c.gry(s.y),e=(t.x-i)*(t.x-i)+(t.y-n)*(t.y-n),e<h&&(h=e,l=s,o=r);h>100&&a&&(l=null);let d=Math.max(this.lineatt.width+3,4);this.marker_size>0&&(d=Math.max(this.marker_size,d)),l&&(h=Math.sqrt(Math.pow(t.x-c.grx(l.x),2)+Math.pow(t.y-c.gry(l.y),2))),!a&&h>d&&(l=null),l||(o=-1);let u={bin:l,indx:o,dist:h,radius:Math.round(d)};if(!l&&a){h=1e10;const a=(t,e,i)=>e>=t&&t>=i||e<=t&&t<=i;let o,l=this.bins[0],f=c.grx(l.x),m=0;for(r=1;r<this.bins.length;++r)s=this.bins[r],i=c.grx(s.x),a(t.x,f,i)&&(o=c.gry(l.y),n=c.gry(s.y),Math.abs(i-f)<1?(m=t.y,e=a(t.y,o,n)?0:Math.min(Math.abs(t.y-o),Math.abs(t.y-n))):(m=o+(t.x-f)/(i-f)*(n-o),e=Math.abs(m-t.y)),e<h&&(h=e,u.linex=t.x,u.liney=m)),l=s,f=i;h<.5*d&&(u.linedist=h,u.closeline=!0)}return u}testEditable(t){let e=this.getObject();return!!e&&(("toggle"==t||void 0!==t&&!t!=e.TestBit(aT))&&e.InvertBit(aT),!e.TestBit(aT))}extractTooltipForPath(t){if(null===this.bins)return null;let e=this.findBestBin(t);if(!e||!e.bin&&!e.closeline)return null;let i="lines"==this.draw_kind,n="mark"==this.draw_kind,r=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),s=this.getObject(),a={name:s.fName,title:s.fTitle,x:e.bin?r.grx(e.bin.x):e.linex,y:e.bin?r.gry(e.bin.y):e.liney,color1:this.lineatt.color,lines:this.getTooltips(e.bin),usepath:!0};return a.user_info={obj:s,name:s.fName,bin:0,cont:0,grx:a.x,gry:a.y},a.ismark=n,a.islines=i,e.closeline?(a.menu=a.exact=!0,a.menu_dist=e.linedist):e.bin&&(this.options.EF&&i?(a.gry1=r.gry(e.bin.y-e.bin.eylow),a.gry2=r.gry(e.bin.y+e.bin.eyhigh)):a.gry1=a.gry2=r.gry(e.bin.y),a.binindx=e.indx,a.bin=e.bin,a.radius=e.radius,a.user_info.bin=e.indx,a.user_info.cont=e.bin.y,a.exact=Math.abs(t.x-a.x)<=e.radius&&(Math.abs(t.y-a.gry1)<=e.radius||Math.abs(t.y-a.gry2)<=e.radius),a.menu=a.exact,a.menu_dist=Math.sqrt((t.x-a.x)*(t.x-a.x)+Math.pow(Math.min(Math.abs(t.y-a.gry1),Math.abs(t.y-a.gry2)),2))),this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(a.color2=this.fillatt.getFillColor()),i||(a.color1=this.getColor(s.fMarkerColor),a.color2||(a.color2=a.color1)),a}showTooltipForPath(t){let e=this.draw_g.select(".tooltip_bin");if(t&&t.bin){if(e.empty()&&(e=this.draw_g.append("svg:g").attr("class","tooltip_bin")),t.changed=e.property("current_bin")!==t.bin,t.changed)if(e.selectAll("*").remove(),e.property("current_bin",t.bin),t.ismark)e.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",Math.round(t.x-t.radius)).attr("y",Math.round(t.y-t.radius)).attr("width",2*t.radius).attr("height",2*t.radius);else{e.append("svg:circle").attr("cy",Math.round(t.gry1)),Math.abs(t.gry1-t.gry2)>1&&e.append("svg:circle").attr("cy",Math.round(t.gry2));let i=e.selectAll("circle").attr("r",t.radius).attr("cx",Math.round(t.x));t.islines?(this.options.Line||this.options.Curve?i.call(this.lineatt.func):i.style("stroke","black"),this.options.Fill?i.call(this.fillatt.func):i.style("fill","none")):i.style("stroke","black"==t.color1?"green":"black").style("fill","none")}}else e.remove()}moveEnabled(){return this.testEditable()}moveStart(t,e){this.pos_dx=this.pos_dy=0;let i=this.extractTooltip({x:t,y:e});if(i&&i.exact&&void 0!==i.binindx){this.move_binindx=i.binindx,this.move_bin=i.bin;let n=this.getFramePainter(),r=n?n.getGrFuncs(this.options.second_x,this.options.second_y):null;this.move_x0=r?r.grx(this.move_bin.x):t,this.move_y0=r?r.gry(this.move_bin.y):e}else delete this.move_binindx}moveDrag(t,e){if(this.pos_dx+=t,this.pos_dy+=e,void 0===this.move_binindx)this.draw_g.attr("transform",`translate(${this.pos_dx},${this.pos_dy})`);else{let t=this.getFramePainter(),e=t?t.getGrFuncs(this.options.second_x,this.options.second_y):null;e&&this.move_bin&&(this.move_bin.x=e.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=e.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())}}moveEnd(t){let e="";if(void 0===this.move_binindx){this.draw_g.attr("transform",null);let i=this.getFramePainter(),n=i?i.getGrFuncs(this.options.second_x,this.options.second_y):null;if(n&&this.bins&&!t){for(let t=0;t<this.bins.length;++t){let i=this.bins[t];i.x=n.revertAxis("x",n.grx(i.x)+this.pos_dx),i.y=n.revertAxis("y",n.gry(i.y)+this.pos_dy),e+="SetPoint("+i.indx+","+i.x+","+i.y+");;",0==i.indx&&this.matchObjectType("TCutG")&&(e+="SetPoint("+(this.getObject().fNpoints-1)+","+i.x+","+i.y+");;")}this.drawGraph()}}else e="SetPoint("+this.move_bin.indx+","+this.move_bin.x+","+this.move_bin.y+")",0==this.move_bin.indx&&this.matchObjectType("TCutG")&&(e+=";;SetPoint("+(this.getObject().fNpoints-1)+","+this.move_bin.x+","+this.move_bin.y+")"),delete this.move_binindx;e&&!t&&this.submitCanvExec(e)}fillContextMenu(t){return super.fillContextMenu(t),this.snapid||t.addchk(this.testEditable(),"Editable",(()=>{this.testEditable("toggle"),this.drawGraph()})),t.size()>0}executeMenuCommand(t,e){if(super.executeMenuCommand(t,e))return!0;let i=this.getCanvPainter(),n=this.getFramePainter();if("RemovePoint"==t.fName||"InsertPoint"==t.fName){let e=n?n.getLastEventPos():null;if(!i||i._readonly||!e)return!0;let r=this.extractTooltip(e);if("InsertPoint"==t.fName){let t=n?n.getGrFuncs(this.options.second_x,this.options.second_y):null,r=t?t.revertAxis("x",e.x):0,s=t?t.revertAxis("y",e.y):0;i.showMessage("InsertPoint("+r.toFixed(3)+","+s.toFixed(3)+") not yet implemented")}else this.args_menu_id&&r&&void 0!==r.binindx&&this.submitCanvExec("RemovePoint("+r.binindx+")",this.args_menu_id);return!0}return!1}updateObject(t,e){if(!this.matchObjectType(t))return!1;e&&e!=this.options.original&&this.decodeOptions(e);let i=this.getObject();if(i.fBits=t.fBits,i.fTitle=t.fTitle,i.fX=t.fX,i.fY=t.fY,i.fNpoints=t.fNpoints,i.fMinimum=t.fMinimum,i.fMaximum=t.fMaximum,this.createBins(),delete this.$redraw_hist,this.axes_draw){let e=this.createHistogram(t.fHistogram);e.fTitle=i.fTitle;let n=this.getMainPainter();n&&n.$secondary&&(n.updateObject(e,this.options.Axis),this.$redraw_hist=!0)}return!0}canZoomInside(t,e,i){let n=this.getObject();if(!n||t!==(this.options.pos3d?"y":"x"))return!1;for(let t=0;t<n.fNpoints;++t)if(e<n.fX[t]&&n.fX[t]<i)return!0;return!1}clickButton(t){if("ToggleZoom"!==t)return!1;let e=this.getFramePainter();return!!e&&((this.xmin!==this.xmax||this.ymin!==this.ymax)&&(e.zoom(this.xmin,this.xmax,this.ymin,this.ymax),!0))}findFunc(){let t=this.getObject();if(t&&t.fFunctions)for(let e=0;e<t.fFunctions.arr.length;++e){let i=t.fFunctions.arr[e];if("TF1"==i._typename||"TF2"==i._typename)return i}return null}findStat(){let t=this.getObject();if(t&&t.fFunctions)for(let e=0;e<t.fFunctions.arr.length;++e){let i=t.fFunctions.arr[e];if("TPaveStats"==i._typename&&"stats"==i.fName)return i}return null}createStat(){let t=this.findFunc();if(!t)return null;let e=this.findStat();if(e)return e;let i=this.getCanvPainter();if(i&&i.normal_canvas)return null;if(this.options.PadStats)return null;this.create_stats=!0;let n=p;return e=k("TPaveStats"),Object.assign(e,{fName:"stats",fOptStat:0,fOptFit:n.fOptFit||111,fBorderSize:1}),e.fX1NDC=n.fStatX-n.fStatW,e.fY1NDC=n.fStatY-n.fStatH,e.fX2NDC=n.fStatX,e.fY2NDC=n.fStatY,e.fFillColor=n.fStatColor,e.fFillStyle=n.fStatStyle,e.fTextAngle=0,e.fTextSize=n.fStatFontSize,e.fTextAlign=12,e.fTextColor=n.fStatTextColor,e.fTextFont=n.fStatFont,e.AddText(t.fName),this.getObject().fFunctions.Add(e),e}fillStatistic(t,e,i){let n=this.findFunc();return!!(n&&i&&this.create_stats)&&(t.clearPave(),t.fillFunctionStat(n,i),!0)}drawNextFunction(t){let e=this.getObject();if(!e.fFunctions||t>=e.fFunctions.arr.length)return Promise.resolve(this);let i=this.getPadPainter(),n=e.fFunctions.arr[t],r=e.fFunctions.opt[t];return n.$main_painter=this,i.drawObject(this.getDom(),n,r).then((()=>this.drawNextFunction(t+1)))}drawAxisHisto(){let t=this.createHistogram();return lb.draw(this.getDom(),t,this.options.Axis)}static _drawGraph(t,e){t.decodeOptions(e,!0),t.createBins(),t.createStat(),m.DragGraphs||graph.TestBit(aT)||graph.InvertBit(aT);let i=Promise.resolve();return(!t.getMainPainter()||t.options.second_x||t.options.second_y)&&t.options.Axis&&(i=t.drawAxisHisto().then((e=>{e&&(t.axes_draw=!0,t._own_histogram||(t.$primary=!0),e.$secondary=!0)}))),i.then((()=>(t.addToPadPrimitives(),t.drawGraph()))).then((()=>t.drawNextFunction(0)))}static draw(t,e,i){return oT._drawGraph(new oT(t,e),i)}}var lT=Object.freeze({__proto__:null,TGraphPainter:oT});function hT(t){t._math=ov;let e=t.fTitle,i=!1,n="[";"gaus"===e&&(e="gaus(0)"),t.fFormula&&"string"==typeof t.fFormula.fFormula&&(0==t.fFormula.fFormula.indexOf("[](double*x,double*p)")?(i=!0,n="p[",e=t.fFormula.fFormula.slice(21)):(e=t.fFormula.fFormula,n="[p"),t.fFormula.fClingParameters&&t.fFormula.fParams&&t.fFormula.fParams.forEach((i=>{let n=new RegExp(`(\\[${i.first}\\])`,"g"),r=t.fFormula.fClingParameters[i.second];e=e.replace(n,r<0?`(${r})`:r)}))),"formulas"in t&&t.formulas.forEach((t=>{e=e.replaceAll(t.fName,t.fTitle)})),e=e.replace(/\b(abs)\b/g,"TMath::Abs").replace(/\b(TMath::Exp)/g,"Math.exp").replace(/\b(TMath::Abs)/g,"Math.abs"),e=e.replace(/xygaus\(/g,"this._math.gausxy(this, x, y, ").replace(/gaus\(/g,"this._math.gaus(this, x, ").replace(/gausn\(/g,"this._math.gausn(this, x, ").replace(/expo\(/g,"this._math.expo(this, x, ").replace(/landau\(/g,"this._math.landau(this, x, ").replace(/landaun\(/g,"this._math.landaun(this, x, ").replace(/TMath::/g,"this._math.").replace(/ROOT::Math::/g,"this._math.");for(let i=0;i<t.fNpar;++i)e=e.replaceAll(n+i+"]",`(${t.GetParValue(i)})`);e=e.replace(/\b(sin)\b/gi,"Math.sin").replace(/\b(cos)\b/gi,"Math.cos").replace(/\b(tan)\b/gi,"Math.tan").replace(/\b(exp)\b/gi,"Math.exp").replace(/\b(pow)\b/gi,"Math.pow").replace(/pi/g,"Math.PI");for(let t=2;t<10;++t)e=e.replaceAll(`x^${t}`,`Math.pow(x,${t})`);i?(e=e.replace(/x\[0\]/g,"x"),"TF2"===t._typename?(e=e.replace(/x\[1\]/g,"y"),t.evalPar=new Function("x","y",e).bind(t)):t.evalPar=new Function("x",e).bind(t)):"TF2"===t._typename?t.evalPar=new Function("x","y","return "+e).bind(t):t.evalPar=new Function("x","return "+e).bind(t)}class cT extends Vl{createBins(t){let e=this.getObject(),i=this.getFramePainter(),n=0,r=0;if(i&&!t){let t=i.getGrFuncs(this.second_x,this.second_y);n=t.scale_xmin,r=t.scale_xmax}let s=e.fXmin,a=e.fXmax,o=!1;n!==r&&(n>s&&(s=n),r<a&&(a=r)),i&&i.logx&&s>0&&a>0&&(o=!0,s=Math.log(s),a=Math.log(a));let l=Math.max(e.fNpx,101),h=(a-s)/(l-1),c=[],d=!1;if(!(e.fSave.length>3&&t))for(let t=0;t<l;t++){let i=s+t*h,n=0;o&&(i=Math.exp(i));try{n=e.evalPar(i)}catch(t){d=!0}if(d)break;Number.isFinite(n)&&c.push({x:i,y:n})}if((d||t||!c.length)&&e.fSave.length>3){l=e.fSave.length-2,s=e.fSave[l],a=e.fSave[l+1],c=[],h=0;let t=e.$histo&&s===a,i=0;t?(s=e.fSave[--l],i=e.$histo.fXaxis.FindBin(s,0)):h=(a-s)/(l-1);for(let a=0;a<l;++a){let o=t?e.$histo.fXaxis.GetBinCenter(i+a+1):s+h*a;if(n!==r&&(o+2*h<n||o-2*h>r))continue;let l=e.fSave[a];Number.isFinite(l)&&c.push({x:o,y:l})}}return c}createDummyHisto(){let t=0,e=1,i=0,n=1,r=this.createBins(!0);r&&r.length>0&&(t=e=r[0].x,i=n=r[0].y,r.forEach((r=>{t=Math.min(r.x,t),e=Math.max(r.x,e),i=Math.min(r.y,i),n=Math.max(r.y,n)})),n>0&&(n*=1.05),i<0&&(i*=1.05));let s=k("TH1I"),a=this.getObject();return s.fName=a.fName+"_hist",s.fTitle=a.fTitle,s.fXaxis.fXmin=t,s.fXaxis.fXmax=e,s.fYaxis.fXmin=i,s.fYaxis.fXmax=n,s.fMinimum=a.fMinimum,s.fMaximum=a.fMaximum,s}updateObject(t){return!!this.matchObjectType(t)&&(Object.assign(this.getObject(),t),hT(this.getObject()),!0)}processTooltipEvent(t){let e=!1;if(t&&this.bins&&!t.disabled?(!this.bins.length||t.x<this.bins[0].grx||t.x>this.bins[this.bins.length-1].grx)&&(e=!0):e=!0,e)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let i,n=1e5,r=-1;for(let e=0;e<this.bins.length;++e){i=this.bins[e];let s=Math.abs(i.grx-t.x);s<n&&(n=s,r=e)}i=this.bins[r];let s=this.draw_g.select(".tooltip_bin"),a=this.lineatt.width+3;s.empty()&&(s=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",a).call(this.lineatt.func).call(this.fillatt.func));let o={name:this.getObject().fName,title:this.getObject().fTitle,x:i.grx,y:i.gry,color1:this.lineatt.color,color2:this.fillatt.getFillColor(),lines:[],exact:Math.abs(i.grx-t.x)<a&&Math.abs(i.gry-t.y)<a};o.changed=s.property("current_bin")!==r,o.menu=o.exact,o.menu_dist=Math.sqrt((i.grx-t.x)*(i.grx-t.x)+(i.gry-t.y)*(i.gry-t.y)),o.changed&&s.attr("cx",i.grx).attr("cy",i.gry).property("current_bin",r);let l=this.getObjectHint();l.length>0&&o.lines.push(l);let h=this.getFramePainter(),c=h?h.getGrFuncs(this.second_x,this.second_y):null;return c&&o.lines.push("x = "+c.axisAsText("x",i.x)+" y = "+c.axisAsText("y",i.y)),o}redraw(){let t=this.getObject(),e=this.getFramePainter(),i=e.getFrameHeight(),n=this.getMainPainter();this.createG(!0),this.bins=this.createBins(!1),this.createAttLine({attr:t}),this.lineatt.used=!1,this.createAttFill({attr:t,kind:1}),this.fillatt.used=!1;let r=e.getGrFuncs(this.second_x,this.second_y);for(let t=0;t<this.bins.length;++t){let e=this.bins[t];e.grx=r.grx(e.x),e.gry=r.gry(e.y)}if(this.bins.length>2){let t=i;n.hmin&&n.hmin>=0&&(t=Math.round(r.gry(0)),(t>i||t<0)&&(t=i));let e=ol("bezier",this.bins,t,2);this.lineatt.empty()||this.draw_g.append("svg:path").attr("class","line").attr("d",e.path).style("fill","none").call(this.lineatt.func),this.fillatt.empty()||this.draw_g.append("svg:path").attr("class","area").attr("d",e.path+e.close).call(this.fillatt.func)}}canZoomInside(t,e,i){if("x"!==t)return!1;let n=this.getObject();if(n.fSave.length>0){let t=n.fNpx,r=n.fSave[t+1],s=n.fSave[t+2];return Math.abs(r-s)/t<Math.abs(e-i)}return!0}static draw(t,e,i){let n=new cT(t,e,i),r=new sl(i),s=!!n.getMainPainter(),a="AXIS";r.check("SAME"),r.check("X+")&&(a+="X+",n.second_x=s),r.check("Y+")&&(a+="Y+",n.second_y=s),r.check("RX")&&(a+="RX"),r.check("RY")&&(a+="RY"),hT(e);let o=Promise.resolve(!0);return(!s||n.second_x||n.second_y)&&(o=lb.draw(t,n.createDummyHisto(),a)),o.then((()=>(n.addToPadPrimitives(),n.redraw(),n)))}}var dT=Object.freeze({__proto__:null,TF1Painter:cT,proivdeEvalPar:hT});const uT=y(14),fT=y(15),mT=y(17),pT=y(18),gT=(t,e)=>t.fBeta_bin_params.length>e?t.fBeta_bin_params[e].first:t.fBeta_alpha,_T=(t,e)=>t.fBeta_bin_params.length>e?t.fBeta_bin_params[e].second:t.fBeta_beta;class xT extends Vl{getEfficiency(t,e){let i=t.fTotalHistogram.fArray[e],n=t.fPassedHistogram.fArray[e];if(t.TestBit(uT)){let a,o,l=t.TestBit(mT)?gT(t,e):t.fBeta_alpha,h=t.TestBit(mT)?_T(t,e):t.fBeta_beta;if(t.TestBit(pT)){let r=i,s=t.fTotalHistogram.fSumw2?t.fTotalHistogram.fSumw2[e]:Math.abs(i),c=n;if(s<=0)return c/r;let d=r/s;a=c*d+l,o=(r-c)*d+h}else a=n+l,o=i-n+h;return t.TestBit(fT)?((t,e)=>{if(t<=0||e<=0)return 0;if(t<=1||e<=1){if(t<e)return 0;if(t>e)return 1;if(t==e)return.5}return(t-1)/(t+e-2)})(a,o):(s=o,(r=a)<=0||s<=0?0:r/(r+s))}var r,s;return i?n/i:0}getEfficiencyErrorLow(t,e,i){let n=t.fTotalHistogram.fArray[e],r=t.fPassedHistogram.fArray[e],s=0,a=0;return t.TestBit(uT)&&(s=t.TestBit(mT)?gT(t,e):t.fBeta_alpha,a=t.TestBit(mT)?_T(t,e):t.fBeta_beta),i-this.fBoundary(n,r,t.fConfLevel,!1,s,a)}getEfficiencyErrorUp(t,e,i){let n=t.fTotalHistogram.fArray[e],r=t.fPassedHistogram.fArray[e],s=0,a=0;return t.TestBit(uT)&&(s=t.TestBit(mT)?gT(t,e):t.fBeta_alpha,a=t.TestBit(mT)?_T(t,e):t.fBeta_beta),this.fBoundary(n,r,t.fConfLevel,!0,s,a)-i}copyAttributes(t,e){["fLineColor","fLineStyle","fLineWidth","fFillColor","fFillStyle","fMarkerColor","fMarkerStyle","fMarkerSize"].forEach((i=>t[i]=e[i]))}createGraph(){let t=k("TGraphAsymmErrors");return t.fName="eff_graph",t}createHisto(t){const e=D("TH2F",t.fTotalHistogram.fXaxis.fNbins,t.fTotalHistogram.fYaxis.fNbins);return Object.assign(e.fXaxis,t.fTotalHistogram.fXaxis),Object.assign(e.fYaxis,t.fTotalHistogram.fYaxis),e.fName="eff_histo",e}fillGraph(t,e){const i=this.getObject(),n=i.fTotalHistogram.fXaxis,r=n.fNbins,s=e.indexOf("e0")>=0;for(let e=0,a=0;e<r;++e){if(!s&&0===i.fTotalHistogram.getBinContent(e+1))continue;let r=this.getEfficiency(i,e+1);t.fX[a]=n.GetBinCenter(e+1),t.fY[a]=r,t.fEXlow[a]=n.GetBinCenter(e+1)-n.GetBinLowEdge(e+1),t.fEXhigh[a]=n.GetBinLowEdge(e+2)-n.GetBinCenter(e+1),t.fEYlow[a]=this.getEfficiencyErrorLow(i,e+1,r),t.fEYhigh[a]=this.getEfficiencyErrorUp(i,e+1,r),t.fNpoints=++a}t.fTitle=i.fTitle,this.copyAttributes(t,i)}fillHisto(t){const e=this.getObject(),i=t.fXaxis.fNbins,n=t.fYaxis.fNbins,r=y(9);for(let r=0;r<i+2;++r)for(let i=0;i<n+2;++i){let n=t.getBin(r,i),s=this.getEfficiency(e,n);t.fArray[n]=s}t.fTitle=e.fTitle,t.fBits=t.fBits|r,this.copyAttributes(t,e)}drawFunction(t){const e=this.getObject();return!e||!e.fFunctions||t>=e.fFunctions.arr.length?this:cT.draw(this.getDom(),e.fFunctions.arr[t],e.fFunctions.opt[t]).then((()=>this.drawFunction(t+1)))}static draw(t,e,i){if(!e||!e.fTotalHistogram)return null;i&&"string"==typeof i||(i=""),i=i.toLowerCase();let n=0;if(0==e.fTotalHistogram._typename.indexOf("TH1"))n=1;else{if(0!=e.fTotalHistogram._typename.indexOf("TH2"))return null;n=2}let r,s=new xT(t,e);if(s.ndim=n,s.fBoundary=av(e.fStatisticOption,e.TestBit(uT)),1==n){i||(i="ap"),i.indexOf("same")<0&&i.indexOf("a")<0&&(i+="a"),i.indexOf("p")<0&&(i+="p");let n=s.createGraph(e);s.fillGraph(n,i),r=oT.draw(t,n,i)}else{i||(i="col");let n=s.createHisto(e);s.fillHisto(n,i),r=db.draw(t,n,i)}return r.then((()=>(s.addToPadPrimitives(),s.drawFunction(0))))}}var yT=Object.freeze({__proto__:null,TEfficiencyPainter:xT});class AT extends Vl{setGridsRange(t,e){let i=this.getObject(),n=this.getPadPainter();if(t===e){let r=n.findPainterFor(i.fLowerPad,"lower_pad","TPad"),s=r?r.getFramePainter():null;if(!s||!s.x_handle)return;t=s.x_handle.full_min,e=s.x_handle.full_max}i.fGridlines.forEach((i=>{i.fX1=t,i.fX2=e}))}redraw(){let t=this.getObject(),e=this.getPadPainter(),i=e.findPainterFor(t.fTopPad,"top_pad","TPad");i&&i.disablePadDrawing();let n=e.findPainterFor(t.fUpperPad,"upper_pad","TPad"),r=n?n.getMainPainter():null,s=n?n.getFramePainter():null,a=e.findPainterFor(t.fLowerPad,"lower_pad","TPad"),o=a?a.getMainPainter():null,l=a?a.getFramePainter():null,h=20,c=Promise.resolve(!0);if(n&&r&&s&&l&&!n._ratio_configured){n._ratio_configured=!0,r.options.Axis=0,h=r.getHisto().fYaxis.fLabelSize,h<1&&(h=Math.round(h*Math.min(n.getPadWidth(),n.getPadHeight())));let t=r.getHisto();t.fXaxis.fLabelSize=0,t.fXaxis.fTitle="",t.fYaxis.fLabelSize=h,t.fYaxis.fTitleSize=h,n.getRootPad().fTicky=1,c=n.redrawPad().then((()=>(s.o_zoom=s.zoom,s._ratio_low_fp=l,s._ratio_painter=this,s.zoom=function(t,e,i,n,r,s){return this._ratio_painter.setGridsRange(t,e),this._ratio_low_fp.o_zoom(t,e),this.o_zoom(t,e,i,n,r,s)},s.o_sizeChanged=s.sizeChanged,s.sizeChanged=function(){this.o_sizeChanged(),this._ratio_low_fp.fX1NDC=this.fX1NDC,this._ratio_low_fp.fX2NDC=this.fX2NDC,this._ratio_low_fp.o_sizeChanged()},!0)))}return c.then((()=>{if(!a||!o||!l||!s||a._ratio_configured)return this;a._ratio_configured=!0,o.options.Axis=0;let e=o.getHisto();e.fXaxis.fTitle="x",e.fXaxis.fLabelSize=h,e.fXaxis.fTitleSize=h,e.fYaxis.fLabelSize=h,e.fYaxis.fTitleSize=h,a.getRootPad().fTicky=1,a.forEachPainterInPad((t=>{"function"==typeof t.testEditable&&t.testEditable(!1)}));let i,n=[];return t.fGridlinePositions.length>0&&t.fGridlines.length<t.fGridlinePositions.length&&t.fGridlinePositions.forEach((e=>{let r=!1;if(t.fGridlines.forEach((t=>{t.fY1==t.fY2&&Math.abs(t.fY1-e)<1e-6&&(r=!0)})),!r){let r=k("TLine");r.fX1=s.scale_xmin,r.fX2=s.scale_xmax,r.fY1=r.fY2=e,r.fLineStyle=2,t.fGridlines.push(r),void 0===i&&(i=this.selectCurrentPad(t.fLowerPad.fName)),n.push(Hw(this.getDom(),r))}})),Promise.all(n).then((()=>l.zoom(s.scale_xmin,s.scale_xmax))).then((()=>(l.o_zoom=l.zoom,l._ratio_up_fp=s,l._ratio_painter=this,l.zoom=function(t,e,i,n,r,s){return this._ratio_painter.setGridsRange(t,e),this._ratio_up_fp.o_zoom(t,e),this.o_zoom(t,e,i,n,r,s)},l.o_sizeChanged=l.sizeChanged,l.sizeChanged=function(){this.o_sizeChanged(),this._ratio_up_fp.fX1NDC=this.fX1NDC,this._ratio_up_fp.fX2NDC=this.fX2NDC,this._ratio_up_fp.o_sizeChanged()},this)))}))}static draw(t,e,i){let n=new AT(t,e,i);return Vv(n,!1).then((()=>n.redraw()))}}var vT=Object.freeze({__proto__:null,TRatioPlotPainter:AT});class bT extends Vl{constructor(t,e){super(t,e),this.firstpainter=null,this.autorange=!1,this.painters=[]}cleanup(){this.painters=[],super.cleanup()}updateObject(t){if(!this.matchObjectType(t))return!1;let e=this.getObject(),i=t.fGraphs,n=this.getPadPainter();e.fTitle=t.fTitle;let r=!1;if(this.firstpainter){let e=t.fHistogram;this.autorange&&!e&&(e=this.scanGraphsRange(i)),this.firstpainter.updateObject(e)&&(r=!0)}for(let t=0;t<i.arr.length;++t)t<this.painters.length&&this.painters[t].updateObject(i.arr[t])&&(r=!0);if(t.fFunctions)for(let e=0;e<t.fFunctions.arr.length;++e){let i=t.fFunctions.arr[e];if(!i||!i._typename||!i.fName)continue;let r=n?n.findPainterFor(null,i.fName,i._typename):null;r&&r.updateObject(i)}return r}scanGraphsRange(t,e,i){let n,r,s,a,o=this.getObject(),l=0,h=0,c=!1,d=!1,u=!1,f="",m={xmin:0,xmax:0,ymin:0,ymax:0,first:!0};if(i&&(c=i.fLogx,d=i.fLogy,m.xmin=i.fUxmin,m.xmax=i.fUxmax,m.ymin=i.fUymin,m.ymax=i.fUymax,m.first=!1),this._3d&&e&&!e.fXaxis.fLabels&&(e=null),e){if(r=e.fYaxis.fXmin,n=e.fYaxis.fXmax,i){const t=t=>i.fLogx&&t<50?Math.exp(2.302585092994*t):t;l=t(m.xmin),h=t(m.xmax)}}else this.autorange=!0,t.arr.forEach((t=>{if(0!=t.fNpoints){m.first&&(m.xmin=m.xmax=t.fX[0],m.ymin=m.ymax=t.fY[0],m.first=!1);for(let e=0;e<t.fNpoints;++e)m.xmin=Math.min(m.xmin,t.fX[e]),m.xmax=Math.max(m.xmax,t.fX[e]),m.ymin=Math.min(m.ymin,t.fY[e]),m.ymax=Math.max(m.ymax,t.fY[e])}})),t.arr[0]&&t.arr[0].fHistogram&&t.arr[0].fHistogram.fXaxis.fTimeDisplay&&(u=!0,f=t.arr[0].fHistogram.fXaxis.fTimeFormat),m.xmin==m.xmax&&(m.xmax+=1),m.ymin==m.ymax&&(m.ymax+=1),s=.05*(m.xmax-m.xmin),a=.05*(m.ymax-m.ymin),l=m.xmin-s,h=m.xmax+s,d?(m.ymin<=0&&(m.ymin=.001*m.ymax),r=m.ymin/(1+.5*Math.log10(m.ymax/m.ymin)),n=m.ymax*(1+.2*Math.log10(m.ymax/m.ymin))):(r=m.ymin-a,n=m.ymax+a),r<0&&m.ymin>=0&&(r=0),n>0&&m.ymax<=0&&(n=0);if(l<0&&m.xmin>=0&&(l=c?.9*m.xmin:0),h>0&&m.xmax<=0&&(h=c?1.1*m.xmax:0),-1111!=o.fMinimum&&(m.ymin=r=o.fMinimum),-1111!=o.fMaximum&&(m.ymax=n=o.fMaximum),r<0&&m.ymin>=0&&d&&(r=.9*m.ymin),n>0&&m.ymax<=0&&d&&(n=1.1*m.ymax),r<=0&&d&&(r=.001*n),!d&&r>0&&r<.05*n&&(r=0),l<=0&&c&&(l=h>1e3?1:.001*h),!e){let i,n;if(this._3d){i=(e=k("TH2I")).fXaxis,i.fXmin=0,i.fXmax=t.arr.length,i.fNbins=t.arr.length,i.fLabels=k("THashList");for(let e=0;e<t.arr.length;e++){let n=k("TObjString");n.fString=t.arr[e].fTitle||`gr${e}`,n.fUniqueID=t.arr.length-e,i.fLabels.Add(n,"")}i=e.fYaxis,n=e.fZaxis}else i=(e=k("TH1I")).fXaxis,n=e.fYaxis;if(e.fTitle=o.fTitle,e.fTitle.indexOf(";")>=0){let t=e.fTitle.split(";");e.fTitle=t[0],t[1]&&(i.fTitle=t[1]),t[2]&&(n.fTitle=t[2])}i.fXmin=l,i.fXmax=h,i.fTimeDisplay=u,u&&(i.fTimeFormat=f)}return this._3d?(e.fMinimum=r,e.fMaximum=n):(e.fYaxis.fXmin=r,e.fYaxis.fXmax=n),e}drawAxisHist(t,e){return lb.draw(this.getDom(),t,"AXIS"+e)}drawNextFunction(t){let e=this.getObject();return!e.fFunctions||t>=e.fFunctions.arr.length?Promise.resolve(this):this.getPadPainter().drawObject(this.getDom(),e.fFunctions.arr[t],e.fFunctions.opt[t]).then((()=>this.drawNextFunction(t+1)))}drawGraph(t,e){return oT.draw(this.getDom(),t,e)}drawNextGraph(t,e){let i=this.getObject().fGraphs;if(t>=i.arr.length)return this._pfc=this._plc=this._pmc=!1,this.drawNextFunction(0);if(this._pfc||this._plc||this._pmc){let e=this.getMainPainter();if(e&&e.createAutoColor){let n=e.createAutoColor(i.arr.length);this._pfc&&(i.arr[t].fFillColor=n),this._plc&&(i.arr[t].fLineColor=n),this._pmc&&(i.arr[t].fMarkerColor=n)}}let n=i.opt[t]||e||"";return this.drawGraph(i.arr[t],n,i.arr.length-t).then((i=>(i&&this.painters.push(i),this.drawNextGraph(t+1,e))))}static _drawMG(t,e){let i=new sl(e);t._3d=i.check("3D"),t._pfc=i.check("PFC"),t._plc=i.check("PLC"),t._pmc=i.check("PMC");let n="";["USE_PAD_TITLE","LOGXY","LOGX","LOGY","LOGZ","GRIDXY","GRIDX","GRIDY","TICKXY","TICKX","TICKY","FB"].forEach((t=>{i.check(t)&&(n+=";"+t)}));let r=Promise.resolve(!0);if(i.check("A")||!t.getMainPainter()){let e=t.getObject(),i=t.getPadPainter(),s=t.scanGraphsRange(e.fGraphs,e.fHistogram,i?i.getRootPad(!0):null);r=t.drawAxisHist(s,n).then((e=>{t.firstpainter=e,e.$secondary=!0}))}return r.then((()=>(t.addToPadPrimitives(),t.drawNextGraph(0,i.remain()))))}static draw(t,e,i){return bT._drawMG(new bT(t,e),i)}}class wT extends oT{drawBins3D(t,e){if(!(t.mode3d&&t.grx&&t.gry&&t.grz&&t.toplevel))return console.log("Frame painter missing base 3d elements");if(t.zoom_xmin!=t.zoom_xmax&&(this.options.pos3d<t.zoom_xmin||this.options.pos3d>t.zoom_xmax))return;let i=this.optimizeBins(1e3),n=0,r=i.length-1;if(t.zoom_ymin!=t.zoom_ymax){for(;n<r&&i[n].x<t.zoom_ymin;)n++;for(;n<r&&i[r].x>t.zoom_ymax;)r--}if(n==r)return;let s=[],a=t.grx(this.options.pos3d),o=i[n];for(let e=n+1;e<=r;++e){let n=i[e];s.push(a,t.gry(o.x),t.grz(o.y),a,t.gry(n.x),t.grz(n.y)),o=n}let l=Hy(s,Yy(this,e));t.toplevel.add(l),t.render3D(100)}drawAxisHisto(){let t=this.createHistogram();return hb.draw(this.getDom(),t,this.options.Axis)}static draw(t,e,i){return wT._drawGraph(new wT(t,e),i)}}class MT extends bT{drawAxisHist(t,e){return this._3d?ub.draw(this.getDom(),t,"AXIS3D"+e):lb.draw(this.getDom(),t,"AXIS"+e)}drawGraph(t,e,i){return this._3d&&(e+="pos3d_"+i),wT.draw(this.getDom(),t,e)}static draw(t,e,i){return MT._drawMG(new MT(t,e),i)}}var TT=Object.freeze({__proto__:null,TMultiGraphPainter:MT});class ST extends Vl{updateObject(t){return!!this.matchObjectType(t)&&(this.assignObject(t),!0)}redraw(){const t=this.getObject(),e=this.getAxisToSvgFunc();if(!t||!t.fOper||!e)return;let i,n,r,s=0,a={},o=null,l="none",h="",c=t.fOper.split(";");const d=t=>{if(t!=l&&(o&&(o.attr("d",h),h="",o=null,l="none"),t))switch(l=t,o=this.draw_g.append("svg:path"),t){case"f":o.call(this.fillatt.func);break;case"l":o.call(this.lineatt.func).style("fill","none");break;case"m":o.call(this.markeratt.func)}},u=(t,e)=>{let i=0,n={_typename:"any"};for(let r=0;r<e.length;++r){let s=t.indexOf(":",i+1);n[e[r]]=parseInt(t.slice(i+1,s>i?s:void 0)),i=s}return n},f=o=>{for(;++o<c.length;)switch(i=c[o][0],i){case"z":this.createAttLine({attr:u(c[o],["fLineColor","fLineStyle","fLineWidth"]),force:!0}),d();continue;case"y":this.createAttFill({attr:u(c[o],["fFillColor","fFillStyle"]),force:!0}),d();continue;case"x":this.createAttMarker({attr:u(c[o],["fMarkerColor","fMarkerStyle","fMarkerSize"]),force:!0}),d();continue;case"o":a=u(c[o],["fTextColor","fTextFont","fTextSize","fTextAlign","fTextAngle"]),a.fTextSize<0&&(a.fTextSize*=-.001),d();continue;case"r":case"b":{d("b"==i?"f":"l");let n=e.x(t.fBuf[s++]),r=e.y(t.fBuf[s++]),a=e.x(t.fBuf[s++]),o=e.y(t.fBuf[s++]);h+=`M${n},${r}h${a-n}v${o-r}h${n-a}z`;continue}case"l":case"f":for(d(i),n=parseInt(c[o].slice(1)),r=0;r<n;++r)h+=(r>0?"L":"M")+e.x(t.fBuf[s++])+","+e.y(t.fBuf[s++]);"f"==i&&(h+="Z");continue;case"m":for(d(i),n=parseInt(c[o].slice(1)),this.markeratt.resetPos(),r=0;r<n;++r)h+=this.markeratt.create(e.x(t.fBuf[s++]),e.y(t.fBuf[s++]));continue;case"h":case"t":if(a.fTextSize){d();let n=a.fTextSize>1?a.fTextSize:this.getPadPainter().getPadHeight()*a.fTextSize,l=a.fTextAngle,h=c[o].slice(1),u=this.draw_g.append("svg:g");if(l>=360&&(l-=360*Math.floor(l/360)),this.startTextDrawing(a.fTextFont,n,u),"h"==i){let t="";for(r=0;r<h.length;r+=2)t+=String.fromCharCode(parseInt(h.slice(r,r+2),16));h=t}return this.drawText({align:a.fTextAlign,x:e.x(t.fBuf[s++]),y:e.y(t.fBuf[s++]),rotate:-l,text:h,color:Fl(a.fTextColor),latex:0,draw_g:u}),this.finishTextDrawing(u).then((()=>f(o)))}continue;default:console.log("unsupported operation "+i)}return Promise.resolve(!0)};return this.createG(),f(-1).then((()=>(d(),this)))}static draw(t,e){let i=new ST(t,e);return i.addToPadPrimitives(),i.redraw()}}var CT=Object.freeze({__proto__:null,TWebPaintingPainter:ST});function PT(t,e){let i=t.fSave.length,n=!0;i>6&&i!==(t.fSave[i-2]+1)*(t.fSave[i-1]+1)+6&&(i=0),i>6&&t.fXmin<t.fXmax&&t.fSave[i-6]<t.fSave[i-5]&&(t.fSave[i-5]-t.fSave[i-6])/(t.fXmax-t.fXmin)>.99999&&(n=!1);let r=Math.max(t.fNpx,2),s=Math.max(t.fNpy,2),a=!1,o=!1,l=(t.fXmax-t.fXmin)/(n?r:r-1),h=(t.fYmax-t.fYmin)/(n?s:s-1),c=n?.5:0;for(let i=0;i<s;++i)for(let n=0;n<r&&!a;++n){let d=t.fXmin+(n+c)*l,u=t.fYmin+(i+c)*h,f=0;try{f=t.evalPar(d,u)}catch{a=!0}!a&&Number.isFinite(f)&&(e||(e=D("TH2F",r,s)),o=!0,e.setBinContent(e.getBin(n+1,i+1),f))}let d=(a||!o)&&i>6;if(d||e||(e=D("TH2F",r,s)),!a&&o&&(e.fXaxis.fXmin=t.fXmin-(n?0:l/2),e.fXaxis.fXmax=t.fXmax+(n?0:l/2),e.fYaxis.fXmin=t.fYmin-(n?0:h/2),e.fYaxis.fXmax=t.fYmax+(n?0:h/2)),d){r=Math.round(t.fSave[i-2]),s=Math.round(t.fSave[i-1]),l=(t.fSave[i-5]-t.fSave[i-6])/r,h=(t.fSave[i-3]-t.fSave[i-4])/s,e||(e=D("TH2F",r+1,s+1)),e.fXaxis.fXmin=t.fSave[i-6]-l/2,e.fXaxis.fXmax=t.fSave[i-5]+l/2,e.fYaxis.fXmin=t.fSave[i-4]-h/2,e.fYaxis.fXmax=t.fSave[i-3]+h/2;for(let i=0,n=0;n<=s;++n)for(let s=0;s<=r;++s)e.setBinContent(e.getBin(s+1,n+1),t.fSave[i++])}e.fName="Func",e.fTitle=t.fTitle,e.fMinimum=t.fMinimum,e.fMaximum=t.fMaximum,e.fLineColor=t.fLineColor,e.fLineStyle=t.fLineStyle,e.fLineWidth=t.fLineWidth,e.fFillColor=t.fFillColor,e.fFillStyle=t.fFillStyle,e.fMarkerColor=t.fMarkerColor,e.fMarkerStyle=t.fMarkerStyle,e.fMarkerSize=t.fMarkerSize;const u=y(9);return e.fBits|=u,e}var ET=Object.freeze({__proto__:null,drawTF2:function(t,e,i){hT(e);let n=PT(e);if(!n)return;let r=new sl(i);return"SAMECOLORZ"!=(i=r.empty()?"cont3":"SAME"===r.opt?"cont2 same":r.opt)&&"SAMECOLOR"!=i&&"SAMECOLZ"!=i||(i="SAMECOL"),0==i.indexOf("SAME")&&(Wl(t)||(i="A_ADJUST_FRAME_"+i.slice(4))),ub.draw(t,n,i).then((t=>(t.tf2_typename=e._typename,t.updateObject=function(t){return!(!t||this.tf2_typename!=t._typename)&&(hT(t),PT(t,this.getHisto()),!0)},t)))}});class kT extends Vl{updateObject(t,e){let i=this.getObject();return i._typename==t._typename&&(i!==t&&Object.assign(i,t),void 0!==e&&this.decodeOptions(e),!0)}eval(t,e){let i=e-t.fX;return"TSplinePoly3"==t._typename?t.fY+i*(t.fB+i*(t.fC+i*t.fD)):"TSplinePoly5"==t._typename?t.fY+i*(t.fB+i*(t.fC+i*(t.fD+i*(t.fE+i*t.fF)))):t.fY+i}findX(t){let e=this.getObject(),i=0,n=e.fNp-1;if(t<=e.fXmin)return 0;if(t>=e.fXmax)return n;if(e.fKstep)i=Math.round((t-e.fXmin)/e.fDelta),t<e.fPoly[i].fX?i=Math.max(i-1,0):i<n&&t>e.fPoly[i+1].fX&&++i;else for(;n-i>1;){let r=Math.round((i+n)/2);t>e.fPoly[r].fX?i=r:n=r}return i}createDummyHisto(){let t=0,e=1,i=0,n=1,r=this.getObject();r&&r.fPoly&&(t=e=r.fPoly[0].fX,i=n=r.fPoly[0].fY,r.fPoly.forEach((r=>{t=Math.min(r.fX,t),e=Math.max(r.fX,e),i=Math.min(r.fY,i),n=Math.max(r.fY,n)})),n>0&&(n*=1.05),i<0&&(i*=1.05));let s=k("TH1I");return s.fName=r.fName+"_hist",s.fTitle=r.fTitle,s.fXaxis.fXmin=t,s.fXaxis.fXmax=e,s.fYaxis.fXmin=i,s.fYaxis.fXmax=n,s}processTooltipEvent(t){let e,i,n=!1,r=this.getObject(),s=this.getFramePainter(),a=s?s.getGrFuncs(this.options.second_x,this.options.second_y):null,o=null,l=0;if(null!==t&&r&&a?(e=a.revertAxis("x",t.x),l=this.findX(e),o=r.fPoly[l],i=this.eval(o,e),l<r.fN-1&&Math.abs(r.fPoly[l+1].fX-e)<Math.abs(e-o.fX)&&(o=r.fPoly[++l]),Math.abs(a.grx(o.fX)-t.x)<.5*this.knot_size?(e=o.fX,i=o.fY):(o=null,(e<r.fXmin||e>r.fXmax)&&(n=!0))):n=!0,n)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let h=this.draw_g.select(".tooltip_bin"),c=this.lineatt.width+3;h.empty()&&(h=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",c).style("fill","none").call(this.lineatt.func));let d={name:this.getObject().fName,title:this.getObject().fTitle,x:a.grx(e),y:a.gry(i),color1:this.lineatt.color,lines:[],exact:null!==o||Math.abs(a.gry(i)-t.y)<c};d.changed=h.property("current_xx")!==e,d.menu=d.exact,d.menu_dist=Math.sqrt((d.x-t.x)*(d.x-t.x)+(d.y-t.y)*(d.y-t.y)),d.changed&&h.attr("cx",Math.round(d.x)).attr("cy",Math.round(d.y)).property("current_xx",e);let u=this.getObjectHint();return u.length>0&&d.lines.push(u),d.lines.push("x = "+a.axisAsText("x",e)),d.lines.push("y = "+a.axisAsText("y",i)),null!==o&&(d.lines.push("knot = "+l),d.lines.push("B = "+rl(o.fB,p.fStatFormat)),d.lines.push("C = "+rl(o.fC,p.fStatFormat)),d.lines.push("D = "+rl(o.fD,p.fStatFormat)),void 0!==o.fE&&void 0!==o.fF&&(d.lines.push("E = "+rl(o.fE,p.fStatFormat)),d.lines.push("F = "+rl(o.fF,p.fStatFormat)))),d}redraw(){let t=this.getObject(),e=this.getFramePainter(),i=e?e.getGrFuncs(this.options.second_x,this.options.second_y):null,n=e.getFrameWidth(),r=e.getFrameHeight();if(this.createG(!0),this.knot_size=5,this.createAttLine({attr:t}),this.options.Line||this.options.Curve){let n=Math.max(10,t.fNpx),s=Math.max(e.scale_xmin,t.fXmin),a=Math.min(e.scale_xmax,t.fXmax),o=this.findX(s),l=[];e.logx&&(s=Math.log(s),a=Math.log(a));for(let r=0;r<n;++r){let h=s+(a-s)/n*(r-1);for(e.logx&&(h=Math.exp(h));o<t.fNp-1&&h>t.fPoly[o+1].fX;)++o;let c=this.eval(t.fPoly[o],h);l.push({x:h,y:c,grx:i.grx(h),gry:i.gry(c)})}let h=r;void 0!==e.hmin&&e.hmin>=0&&(h=Math.round(i.gry(0)),(h>r||h<0)&&(h=r));let c=ol("bezier",l,h,2);this.draw_g.append("svg:path").attr("class","line").attr("d",c.path).style("fill","none").call(this.lineatt.func)}if(this.options.Mark){let e="";this.createAttMarker({attr:t}),this.markeratt.resetPos(),this.knot_size=this.markeratt.getFullSize();for(let s=0;s<t.fPoly.length;s++){let a=t.fPoly[s],o=i.grx(a.fX);if(o>-this.knot_size&&o<n+this.knot_size){let t=i.gry(a.fY);t>-this.knot_size&&t<r+this.knot_size&&(e+=this.markeratt.create(o,t))}}e&&this.draw_g.append("svg:path").attr("d",e).call(this.markeratt.func)}}canZoomInside(t){if("x"!==t)return!1;return!!this.getObject()}decodeOptions(t){let e=new sl(t);this.options||(this.options={});let i=!!this.getMainPainter();Object.assign(this.options,{Same:e.check("SAME"),Line:e.check("L"),Curve:e.check("C"),Mark:e.check("P"),Hopt:"AXIS",second_x:!1,second_y:!1}),this.options.Line||this.options.Curve||this.options.Mark||(this.options.Curve=!0),e.check("X+")&&(this.options.Hopt+="X+",this.options.second_x=i),e.check("Y+")&&(this.options.Hopt+="Y+",this.options.second_y=i),this.storeDrawOpt(t)}static draw(t,e,i){let n=new kT(t,e);n.decodeOptions(i);let r=Promise.resolve(),s=!n.getMainPainter();if(s||n.options.second_x||n.options.second_y){if(n.options.Same&&s)return console.warn("TSpline painter requires histogram to be drawn"),null;let e=n.createDummyHisto();r=hb.draw(t,e,n.options.Hopt)}return r.then((()=>(n.addToPadPrimitives(),n.redraw(),n)))}}var DT=Object.freeze({__proto__:null,TSplinePainter:kT});class zT extends Vl{rotate(t,e,i){let n=this.wsize*Math.cos(t),r=this.wsize*Math.sin(t),s="";return void 0!==e&&void 0!==i?s=`M${Math.round(e-n)},${Math.round(i-r)}`:(n=-n,r=-r),s+=`l${Math.round(n)},${Math.round(r)}`,e&&void 0===i&&(s+="z"),s}createPath(){let t=Math.atan2(this.y2-this.y1,this.x2-this.x1),e=this.wsize*Math.cos(this.angle2),i=e*Math.cos(t),n=e*Math.sin(t),r="";return this.beg&&(r+=this.rotate(t-Math.PI-this.angle2,this.x1,this.y1)+this.rotate(t-Math.PI+this.angle2,this.beg>10)),this.mid%10==2&&(r+=this.rotate(t-Math.PI-this.angle2,(this.x1+this.x2-i)/2,(this.y1+this.y2-n)/2)+this.rotate(t-Math.PI+this.angle2,this.mid>10)),this.mid%10==1&&(r+=this.rotate(t-this.angle2,(this.x1+this.x2+i)/2,(this.y1+this.y2+n)/2)+this.rotate(t+this.angle2,this.mid>10)),this.end&&(r+=this.rotate(t-this.angle2,this.x2,this.y2)+this.rotate(t+this.angle2,this.end>10)),`M${Math.round(this.x1+(this.beg>10?i:0))},${Math.round(this.y1+(this.beg>10?n:0))}L${Math.round(this.x2-(this.end>10?i:0))},${Math.round(this.y2-(this.end>10?n:0))}`+r}moveStart(t,e){let i=Math.sqrt(Math.pow(this.x1-this.x2,2)+Math.pow(this.y1-this.y2,2)),n=Math.sqrt(Math.pow(t-this.x1,2)+Math.pow(e-this.y1,2))/i,r=Math.sqrt(Math.pow(t-this.x2,2)+Math.pow(e-this.y2,2))/i;this.side=n>.9?1:r>.9?-1:0}moveDrag(t,e){1!=this.side&&(this.x1+=t,this.y1+=e),-1!=this.side&&(this.x2+=t,this.y2+=e),this.draw_g.select("path").attr("d",this.createPath())}moveEnd(t){if(t)return;let e=this.getObject(),i="";e.fX1=this.svgToAxis("x",this.x1,this.isndc),e.fX2=this.svgToAxis("x",this.x2,this.isndc),e.fY1=this.svgToAxis("y",this.y1,this.isndc),e.fY2=this.svgToAxis("y",this.y2,this.isndc),1!=this.side&&(i+=`SetX1(${e.fX1});;SetY1(${e.fY1});;`),-1!=this.side&&(i+=`SetX2(${e.fX2});;SetY2(${e.fY2});;`),this.submitCanvExec(i+"Notify();;")}redraw(){let t=this.getObject(),e=y(14),i=t.fOption,n=this.getPadPainter().getPadRect();this.wsize=Math.max(3,Math.round(Math.max(n.width,n.height)*t.fArrowSize*.8)),this.isndc=t.TestBit(e),this.angle2=t.fAngle/2/180*Math.PI,this.beg=this.mid=this.end=0,0==i.indexOf("<")&&(this.beg=0==i.indexOf("<|")?12:2),i.indexOf("->-")>=0?this.mid=1:i.indexOf("-|>-")>=0?this.mid=11:i.indexOf("-<-")>=0?this.mid=2:i.indexOf("-<|-")>=0&&(this.mid=12);let r=i.lastIndexOf(">"),s=i.lastIndexOf("|>"),a=i.length;r>=0&&r==a-1&&(this.end=s>=0&&s==a-2?11:1),this.createAttLine({attr:t}),this.createG(),this.x1=this.axisToSvg("x",t.fX1,this.isndc,!0),this.y1=this.axisToSvg("y",t.fY1,this.isndc,!0),this.x2=this.axisToSvg("x",t.fX2,this.isndc,!0),this.y2=this.axisToSvg("y",t.fY2,this.isndc,!0);let o=this.draw_g.append("svg:path").attr("d",this.createPath()).call(this.lineatt.func);return this.beg>10||this.end>10?(this.createAttFill({attr:t}),o.call(this.fillatt.func)):o.style("fill","none"),l()||pv(this),this}static draw(t,e,i){let n=new zT(t,e,i);return Vv(n,!1).then((()=>n.redraw()))}}var OT=Object.freeze({__proto__:null,TArrowPainter:zT});let RT=globalThis?.btoa;class LT extends Vl{decodeOptions(t){this.options={Zscale:!1},t&&t.indexOf("z")>=0&&(this.options.Zscale=!0)}createRGBA(t){let e=this.getObject();if(!e||!e.fPalette)return null;let i=new Array(4*(t+1)),n=1,r=e.fPalette;for(let e=0;e<=t;++e){let s=1*e/t;for(;r.fPoints[n]<s&&n<r.fPoints.length-1;)n++;let a=(r.fPoints[n]-s)/(r.fPoints[n]-r.fPoints[n-1]),o=(s-r.fPoints[n-1])/(r.fPoints[n]-r.fPoints[n-1]);i[4*e]=Math.min(255,Math.round((r.fColorRed[n-1]*a+r.fColorRed[n]*o)/256)),i[4*e+1]=Math.min(255,Math.round((r.fColorGreen[n-1]*a+r.fColorGreen[n]*o)/256)),i[4*e+2]=Math.min(255,Math.round((r.fColorBlue[n-1]*a+r.fColorBlue[n]*o)/256)),i[4*e+3]=Math.min(255,Math.round((r.fColorAlpha[n-1]*a+r.fColorAlpha[n]*o)/256))}return i}drawImage(){let t=this.getObject(),e=!1,i=this.getFramePainter(),n=i?i.getFrameRect():this.getPadPainter().getPadRect();this.wheel_zoomy=!0,t._blob&&(15!=t._blob.length||t._blob[0]?3==t._blob.length&&t._blob[0]?(t.fPngBuf=t._blob[2],t.fPngBuf&&t.fPngBuf.length==t._blob[1]||(console.error("TASImage with png buffer _blob error",t._blob[1],"!=",t.fPngBuf?t.fPngBuf.length:-1),delete t.fPngBuf)):console.error("TASImage _blob len",t._blob.length,"not recognized"):(t.fImageQuality=t._blob[1],t.fImageCompression=t._blob[2],t.fConstRatio=t._blob[3],t.fPalette={_typename:"TImagePalette",fUniqueID:t._blob[4],fBits:t._blob[5],fNumPoints:t._blob[6],fPoints:t._blob[7],fColorRed:t._blob[8],fColorGreen:t._blob[9],fColorBlue:t._blob[10],fColorAlpha:t._blob[11]},t.fWidth=t._blob[12],t.fHeight=t._blob[13],t.fImgBuf=t._blob[14],t.fWidth*t.fHeight==t.fImgBuf.length&&t.fPalette.fNumPoints==t.fPalette.fPoints.length||(console.error("TASImage _blob decoding error",t.fWidth*t.fHeight,"!=",t.fImgBuf.length,t.fPalette.fNumPoints,"!=",t.fPalette.fPoints.length),delete t.fImgBuf,delete t.fPalette)),delete t._blob);let r,s=!0;if(t.fImgBuf&&t.fPalette){e=!0;let n=1e3;this.rgba=this.createRGBA(n);let a=t.fImgBuf[0],o=t.fImgBuf[0];for(let e=1;e<t.fImgBuf.length;++e){let i=t.fImgBuf[e];a=Math.min(i,a),o=Math.max(i,o)}this.fContour={arr:new Array(200),rgba:this.rgba,getLevels:function(){return this.arr},getPaletteColor:function(t,e){if(!this.arr||!this.rgba)return"white";let i=4*Math.round((e-this.arr[0])/(this.arr[this.arr.length-1]-this.arr[0])*(this.rgba.length-4)/4);return"#"+zl(this.rgba[i],1)+zl(this.rgba[i+1],1)+zl(this.rgba[i+2],1)+zl(this.rgba[i+3],1)}};for(let t=0;t<200;t++)this.fContour.arr[t]=a+(o-a)/199*t;a>=o&&(o=a+1);let l,h=0,d=t.fWidth,u=0,f=t.fHeight;if(i&&i.zoom_xmin!=i.zoom_xmax&&(h=Math.round(i.zoom_xmin*t.fWidth),d=Math.round(i.zoom_xmax*t.fWidth)),i&&i.zoom_ymin!=i.zoom_ymax&&(u=Math.round(i.zoom_ymin*t.fHeight),f=Math.round(i.zoom_ymax*t.fHeight)),c()?l=undefined.createCanvas(d-h,f-u):(l=document.createElement("canvas"),l.width=d-h,l.height=f-u),!l)return null;let m=l.getContext("2d"),p=m.getImageData(0,0,l.width,l.height),g=p.data;for(let e=u;e<f;++e){let i=(f-e-1)*(d-h)*4,r=e*t.fWidth;for(let e=h;e<d;++e){let s=4*Math.round((t.fImgBuf[r+e]-a)/(o-a)*n);g[i++]=this.rgba[s++],g[i++]=this.rgba[s++],g[i++]=this.rgba[s++],g[i++]=this.rgba[s++]}}m.putImageData(p,0,0),r=l.toDataURL(),s=t.fConstRatio}else if(t.fPngBuf){let e="";if("string"==typeof t.fPngBuf)e=t.fPngBuf;else for(let i=0;i<t.fPngBuf.length;++i)e+=String.fromCharCode(t.fPngBuf[i]<0?256+t.fPngBuf[i]:t.fPngBuf[i]);r="data:image/png;base64,"+RT(e)}return r&&this.createG(!!i).append("image").attr("href",r).attr("width",n.width).attr("height",n.height).attr("preserveAspectRatio",s?null:"none"),r&&this.isMainPainter()&&e&&i?this.drawColorPalette(this.options.Zscale,!0).then((()=>(i.setAxesRanges(k("TAxis"),0,1,k("TAxis"),0,1,null,0,0),i.createXY({ndim:2,check_pad_range:!1}),i.addInteractivity()))):this}canZoomInside(t,e,i){let n=this.getObject();return!(!n||!n.fImgBuf)&&("x"==t&&(i-e)*n.fWidth>3||"y"==t&&(i-e)*n.fHeight>3)}drawColorPalette(t,e){if(!this.isMainPainter())return Promise.resolve(null);if(!this.draw_palette){let t=k("TPave");Object.assign(t,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:k("TGaxis"),fX1NDC:.91,fX2NDC:.95,fY1NDC:.1,fY2NDC:.9,fInit:1}),t.fAxis.fChopt="+",this.draw_palette=t,this.fPalette=!0}let i=this.getPadPainter().findPainterFor(this.draw_palette);if(!t)return i&&(i.Enabled=!1,i.removeG()),Promise.resolve(null);let n=this.getFramePainter();if(e&&n){let t=this.draw_palette;t.fX2NDC=n.fX2NDC+.01+(t.fX2NDC-t.fX1NDC),t.fX1NDC=n.fX2NDC+.01,t.fY1NDC=n.fY1NDC,t.fY2NDC=n.fY2NDC}if(i)return i.Enabled=!0,i.drawPave("");let r=this.selectCurrentPad(this.getPadName());return $v.draw(this.getDom(),this.draw_palette).then((t=>{i=t,this.selectCurrentPad(r),i.$secondary=!0,i.redraw=function(){}}))}toggleColz(){let t=this.getObject();t&&t.fPalette&&(this.options.Zscale=!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!0))}redraw(t){let e=this.draw_g?this.draw_g.select("image"):null,i=this.getFramePainter();if(!e||e.empty()||"zoom"===t||!i)return this.drawImage();e.attr("width",i.getFrameWidth()).attr("height",i.getFrameHeight())}clickButton(t){return!!this.isMainPainter()&&("ToggleColorZ"===t&&(this.toggleColz(),!0))}fillToolbar(){let t=this.getPadPainter(),e=this.getObject();t&&e&&e.fPalette&&(t.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),t.showPadButtons())}static draw(t,e,i){let n=new LT(t,e,i);return n.decodeOptions(i),Vv(n,!1).then((()=>n.drawImage())).then((()=>(n.fillToolbar(),n)))}}var BT=Object.freeze({__proto__:null,TASImagePainter:LT});const NT=y(22);class FT{constructor(){this._branches=[],this._names=[],this._directs=[],this._break=0,this.tgtobj={}}addBranch(t,e,i){return e||(e="string"==typeof t?t:"br"+this._branches.length),this._branches.push(t),this._names.push(e),this._directs.push(i),this._branches.length-1}numBranches(){return this._branches.length}getBranch(t){return this._branches[t]}indexOfBranch(t){return this._branches.indexOf(t)}nameOfBranch(t){return this._names[t]}ShowProgress(){}Abort(){this._break=-1111}Begin(){}Process(){}Terminate(){}}function IT(t,e){if("object"!=typeof t)return 0;let i=u(Object.prototype.toString.apply(t));if(!e||1!=i)return i;let n,r=!0;for(let e=0;e<t.length;++e){let i=typeof t[e];if(n||(n=i),i!==n){r=!1;break}if("object"==i&&IT(t[e])){r=!1;break}}return r?2:1}class jT{constructor(t,e,i){this.object=t,this.value=0,this.arr=[],this.indx=[],this.cnt=-1,this.tgtobj=i,this.select="object"==typeof e?e:[]}next(){let t,e,i=this.cnt;if(i>=0){if(++this.fastindx<this.fastlimit)return this.value=this.fastarr[this.fastindx],!0;for(;--i>=0&&!(void 0===this.select[i]&&++this.indx[i]<this.arr[i].length););if(i<0)return!1}for(;;){if(t=i<0?this.object:this.arr[i][this.indx[i]],e=t?typeof t:"any","object"===e&&(void 0!==t._typename?I(t)?(t=t.arr,e="array"):e="any":e=Number.isInteger(t.length)&&IT(t)>0?"array":"any"),"$self$"==this.select[i+1])return this.value=t,this.fastindx=this.fastlimit=0,this.cnt=i+1,!0;if("any"!=e||"string"!=typeof this.select[i+1]){if("array"!==e||!(t.length>0||"$size$"===this.select[i+1]))return!(i<0)&&(this.value=t,void 0===this.select[i]?(this.fastarr=this.arr[i],this.fastindx=this.indx[i],this.fastlimit=this.fastarr.length):this.fastindx=this.fastlimit=0,this.cnt=i,!0);switch(this.arr[++i]=t,this.select[i]){case void 0:this.indx[i]=0;break;case"$last$":this.indx[i]=t.length-1;break;case"$size$":return this.value=t.length,this.fastindx=this.fastlimit=0,this.cnt=i,!0;default:Number.isInteger(this.select[i])?(this.indx[i]=this.select[i],this.indx[i]<0&&(this.indx[i]=t.length-1)):(this.select[i].produce(this.tgtobj),this.indx[i]=Math.round(this.select[i].get(0)))}}else this.arr[++i]=t,this.indx[i]=this.select[i]}}reset(){this.arr=[],this.indx=[],delete this.fastarr,this.cnt=-1,this.value=0}}function qT(t,e,i=!1,n=!1){if(!t||"TBranchElement"!==t._typename)return"";if(0===t.fType&&-2===t.fID&&-1===t.fStreamerType)return t.fClassName;if(i&&t.fClonesName&&(3===t.fType||4===t.fType))return t.fClonesName;let r=VT(t,e.$file);if(1===t.fType&&r&&"BASE"===r.fTypeName)return r.fName;if(2===t.fType)return!r||61!==r.fType&&r.fType!==Gb?"TObject":r.fTypeName;if(0===t.fType&&r&&n){if(61===r.fType||r.fType===Gb)return r.fTypeName;if(63===r.fType)return r.fTypeName.slice(0,r.fTypeName.length-1)}return""}function UT(t,e,i,n=!1){let r=!1,s=e,a=null;if(!i){r=!0,i=t.fBranches;let e=s.indexOf("[");e>0&&(s=s.slice(0,e))}if(!i||0===i.arr.length)return null;for(let e=0;e<i.arr.length;++e){let n=i.arr[e].fName;if("]"==n[n.length-1]&&(n=n.slice(0,n.indexOf("["))),0!==s.indexOf(n)&&n.indexOf("<")>0){let t=n.indexOf("<"),e=n.lastIndexOf(">");n=n.slice(0,t)+n.slice(e+1)}if(n===s){a={branch:i.arr[e],rest:""};break}if(0!==s.indexOf(n))continue;let r=n.length;if("."===n[r-1]&&r--,"."===s[r]){a=UT(t,s,i.arr[e].fBranches),a||(a=UT(t,s.slice(r+1),i.arr[e].fBranches)),a||(a={branch:i.arr[e],rest:s.slice(r)});break}}if(r&&!n&&!a&&0==s.indexOf("br_")){let e=3;for(;e<s.length&&s[e]>="0"&&s[e]<="9";)++e;let i=e>3?function(t,e){if(!Number.isInteger(e))return;let i,n=0;return function t(r){r&&r.fBranches&&r.fBranches.arr.forEach((r=>{n++===e&&(i=r),i||t(r)}))}(t),i}(t,parseInt(s.slice(3,e))):null;i&&(a={branch:i,rest:s.slice(e)})}return r&&a?(e.length>s.length&&(a.rest+=e.slice(s.length)),a):a}function GT(t,e){let i=UT(t,e,t.fBranches,!0);return!i||i.rest.length>0?null:i.branch}class HT{constructor(t){this.globals=t,this.code="",this.brindex=[],this.branches=[],this.brarray=[],this.func=null,this.kind=void 0,this.buf=[]}parse(t,e,i,n,r){const s=t=>t>="A"&&t<="Z"||(t>="a"&&t<="z"||"_"===t),a=t=>!!s(t)||t>="0"&&t<="9";i||(i=""),this.code=(n?n.fName:"")+i;let o=0,l=0,h=null;for(;o<i.length||n;){let c=[];if(n)h=n,n=void 0;else{for(l=o;l<i.length&&(a(i[l])||"."===i[l]);)l++;if("$"==i[l]){let t="";switch(i.slice(o,l)){case"LocalEntry":case"Entry":t="arg.$globals.entry";break;case"Entries":t="arg.$globals.entries"}if(t){i=i.slice(0,o)+t+i.slice(l+1),o+=t.length;continue}}if(h=UT(t,i.slice(o,l)),!h){o=l+1;continue}h.branch&&void 0!==h.rest&&(l-=h.rest.length,r=void 0,h=h.branch),l>=i.length-1&&"."===i[i.length-1]&&(c.push("$self$"),l=i.length)}for(;l<i.length;){if("@"===i[l]&&"@size"==i.slice(l,l+5)&&0==c.length){l+=5,r=!0;break}if("."===i[l]){let e=++l;if("@"===i[e]&&"@size"===i.slice(e,e+5)){c.push("$size$"),l+=5;break}if(!s(i[e])){c.push("$self$");break}for(;l<i.length&&a(i[l]);)l++;if("("==i[l]){l=e-1;break}if(0===c.length&&h)if(3===h.fType||4===h.fType)c.push(void 0);else{let e=qT(h,t,!1,!0);e&&I(null,e)&&c.push(void 0)}c.push(i.slice(e,l));continue}if("["!==i[l])break;if("]"==i[l+1]){c.push(void 0),l+=2;continue}let n=l++,o=0;for(;l<i.length&&("]"!=i[l]||o>0);)"["==i[l]?o++:"]"==i[l]&&o--,l++;let d=i.slice(n+1,l);switch(d){case"":case"$all$":c.push(void 0);break;case"$last$":c.push("$last$");break;case"$size$":c.push("$size$");break;case"$first$":c.push(0);break;default:if(Number.isInteger(parseInt(d)))c.push(parseInt(d));else{let i=new HT(this.globals);if(!i.parse(t,e,d))return!1;c.push(i)}}l++}0===c.length?c=void 0:1===c.length&&void 0===c[0]&&(c=!0);let d=e.indexOfBranch(h);if(d<0&&(d=e.addBranch(h,void 0,r)),r=void 0,this.brindex.push(d),this.branches.push(e.nameOfBranch(d)),this.brarray.push(c),0===o&&l===i.length&&1===this.branches.length)return this.direct_branch=!0,!0;let u="arg.var"+(this.branches.length-1);i=i.slice(0,o)+u+i.slice(l),o+=u.length}return i=i.replace(/TMath::Exp\(/g,"Math.exp(").replace(/TMath::Abs\(/g,"Math.abs(").replace(/TMath::Prob\(/g,"arg.$math.Prob(").replace(/TMath::Gaus\(/g,"arg.$math.Gaus("),this.func=new Function("arg","return ("+i+")"),!0}is_dummy(){return 0===this.branches.length&&!this.func}produce(t){if(this.length=1,this.isarray=!1,this.is_dummy())return this.value=1,void(this.kind="number");let e={$globals:this.globals,$math:ov},i=-1,n=[];for(let r=0;r<this.branches.length;++r){let s="var"+r;if(e[s]=t[this.branches[r]],void 0===this.brarray[r]&&(this.brarray[r]=IT(e[s])>0||I(e[s])),!1!==this.brarray[r]){if(!0===this.brarray[r]&&2===IT(e[s],!0))n[r]=e[s];else{let i=new jT(e[s],this.brarray[r],t);for(n[r]=[];i.next();)n[r].push(i.value)}(i<0||i<n[r].length)&&(i=n[r].length)}}if(i<0)return this.value=this.direct_branch?e.var0:this.func(e),void(this.kind||(this.kind=typeof this.value));if(0==i)return this.length=0,void(this.value=0);if(this.length=i,this.isarray=!0,this.direct_branch)this.value=n[0];else{this.value=new Array(i);for(let t=0;t<i;++t){for(let i=0;i<this.branches.length;++i)n[i]&&(e["var"+i]=n[i][t]);this.value[t]=this.func(e)}}this.kind||(this.kind=typeof this.value[0])}get(t){return this.isarray?this.value[t]:this.value}appendArray(t){this.buf=this.buf.concat(t[this.branches[0]])}}class XT extends FT{constructor(){super(),this.ndim=0,this.vars=[],this.cut=null,this.hist=null,this.histo_drawopt="",this.hist_name="$htemp",this.hist_title="Result of TTree::Draw",this.graph=!1,this.hist_args=[],this.arr_limit=1e3,this.htype="F",this.monitoring=0,this.globals={},this.last_progress=0,this.aver_diff=0}setCallback(t,e){this.result_callback=t,this.progress_callback=e}parseParameters(t,e,i){if(!i||"string"!=typeof i)return"";let n=i.lastIndexOf(";");for(;n>=0;){let r,s=i.slice(n+1);n=(i=i.slice(0,n)).lastIndexOf(";");let a=s.indexOf(":");a>0&&(r=s.slice(a+1),s=s.slice(0,a));let o=parseInt(r);switch(r&&Number.isInteger(o)||(o=void 0),s){case"num":case"entries":case"numentries":"all"===r?e.numentries=t.fEntries:"half"===r?e.numentries=Math.round(t.fEntries/2):void 0!==o&&(e.numentries=o);break;case"first":void 0!==o&&(e.firstentry=o);break;case"mon":case"monitor":e.monitoring=void 0!==o?o:5e3;break;case"player":e.player=!0;break;case"dump":e.dump=!0;break;case"maxseg":case"maxrange":o&&(t.$file.fMaxRanges=o);break;case"accum":o&&(this.arr_limit=o);break;case"htype":r&&1===r.length&&(this.htype=r.toUpperCase(),"C"!==this.htype&&"S"!==this.htype&&"I"!==this.htype&&"F"!==this.htype&&"L"!==this.htype&&"D"!==this.htype&&(this.htype="F"));break;case"hbins":this.hist_nbins=parseInt(r),(!Number.isInteger(this.hist_nbins)||this.hist_nbins<=3)&&delete this.hist_nbins;break;case"drawopt":e.drawopt=r;break;case"graph":e.graph=o||!0}}if(n=i.lastIndexOf(">>"),n>=0){let t=i.slice(n+2).trim();if(i=i.slice(0,n).trim(),n=t.indexOf("("),n>0&&(this.hist_name=t.slice(0,n),t=t.slice(n)),"dump"===t)e.dump=!0;else if(0==t.indexOf("Graph"))e.graph=!0;else if(n<0)this.hist_name=t;else if("("==t[0]&&")"==t[t.length-1]){t=t.slice(1,t.length-1).split(",");let e=!0;for(let i=0;i<t.length;++i)t[i]=i%3==0?parseInt(t[i]):parseFloat(t[i]),Number.isFinite(t[i])||(e=!1);e&&(this.hist_args=t)}}return e.dump&&(this.dump_values=!0,e.reallocate_objects=!0,void 0===e.numentries&&(e.numentries=10)),i}parseDrawExpression(t,e){let i=this.parseParameters(t,e,e.expr),n="";this.hist_title="drawing '"+i+"' from "+t.fName;let r=0;e.cut?n=e.cut:(r=i.replace(/TMath::/g,"TMath__").lastIndexOf("::"),r>0&&(n=i.slice(r+2).trim(),i=i.slice(0,r).trim())),e.parse_expr=i,e.parse_cut=n;let s=[],a=0,o=0,l=0;for(r=0;r<i.length;++r)switch(i[r]){case"(":a++;break;case")":a--;break;case"[":o++;break;case"]":o--;break;case":":if(":"==i[r+1]){r++;continue}!a&&!o&&r>l&&s.push(i.slice(l,r)),l=r+1}if(!a&&!o&&r>l&&s.push(i.slice(l,r)),s.length<1||s.length>3)return!1;this.ndim=s.length;let h=!n;for(let e=0;e<this.ndim;++e){if(this.vars[e]=new HT(this.globals),!this.vars[e].parse(t,this,s[e]))return!1;this.vars[e].direct_branch||(h=!1)}return this.cut=new HT(this.globals),!(n&&!this.cut.parse(t,this,n))&&(this.numBranches()?(h&&(this.ProcessArrays=this.ProcessArraysFunc),this.monitoring=e.monitoring,this.graph=e.graph,void 0!==e.drawopt?this.histo_drawopt=e.drawopt:this.histo_drawopt=2===this.ndim?"col":"",!0):(console.warn("no any branch is selected"),!1))}drawOnlyBranch(t,e,i,n){return this.ndim=1,0==i.indexOf("dump")&&(i=";"+i),i=this.parseParameters(t,n,i),this.monitoring=n.monitoring,n.dump&&(this.dump_values=!0,n.reallocate_objects=!0),this.dump_values?(this.hist=[],this.leaf=n.leaf,this.copy_fields=(n.branch.fLeaves&&n.branch.fLeaves.arr.length>1||n.branch.fBranches&&n.branch.fBranches.arr.length>0)&&!n.leaf,this.addBranch(e,"br0",n.direct_branch),this.Process=this.ProcessDump,!0):(this.vars[0]=new HT(this.globals),!!this.vars[0].parse(t,this,i,e,n.direct_branch)&&(this.hist_title="drawing branch '"+e.fName+(i?"' expr:'"+i:"")+"'  from "+t.fName,this.cut=new HT(this.globals),this.vars[0].direct_branch&&(this.ProcessArrays=this.ProcessArraysFunc),!0))}Begin(t){this.globals.entries=t.fEntries,this.monitoring&&(this.lasttm=(new Date).getTime())}ShowProgress(){}getBitsBins(t,e){e.nbins=e.max=t,e.fLabels=k("THashList");for(let i=0;i<t;++i){let t=k("TObjString");t.fString=i.toString(),t.fUniqueID=i+1,e.fLabels.Add(t)}return e}getMinMaxBins(t,e){let i={min:0,max:0,nbins:e,k:1,fLabels:null,title:""};if(t>=this.ndim)return i;let n=this.vars[t].buf;if(i.title=this.vars[t].code||"","object"===this.vars[t].kind){let e,r=!0,s=8;for(let t=0;t<n.length;++t)n[t]&&(e||(e=n[t]._typename),e!==n[t]._typename&&(r=!1),n[t].fNbits&&(s=Math.max(s,n[t].fNbits+1)));if(e&&r&&"TBits"===e&&0===t)return this.fill1DHistogram=this.fillTBitsHistogram,s%8&&(s=8+(65520&s)),"bits"===this.hist_name&&1==this.hist_args.length&&this.hist_args[0]&&(s=this.hist_args[0]),this.getBitsBins(s,i)}if("string"===this.vars[t].kind){i.lbls=[];for(let t=0;t<n.length;++t)i.lbls.indexOf(n[t])<0&&i.lbls.push(n[t]);i.lbls.sort(),i.max=i.nbins=i.lbls.length,i.fLabels=k("THashList");for(let t=0;t<i.lbls.length;++t){let e=k("TObjString");e.fString=i.lbls[t],e.fUniqueID=t+1,""===e.fString&&(e.fString="<empty>"),i.fLabels.Add(e)}}else{if(0===t&&"bits"===this.hist_name&&this.hist_args.length<=1)return this.fill1DHistogram=this.FillBitsHistogram,this.getBitsBins(this.hist_args[0]||32,i);if(3*t+2<this.hist_args.length)i.nbins=this.hist_args[3*t],i.min=this.hist_args[3*t+1],i.max=this.hist_args[3*t+2];else{if(i.min=Math.min.apply(null,n),i.max=Math.max.apply(null,n),this.hist_nbins&&(e=i.nbins=this.hist_nbins),i.isinteger=Math.round(i.min)===i.min&&Math.round(i.max)===i.max,i.isinteger)for(let t=0;t<n.length;++t)if(n[t]!==Math.round(n[t])){i.isinteger=!1;break}if(i.isinteger)if(i.min=Math.round(i.min),i.max=Math.round(i.max),i.max-i.min<5*e)i.min-=1,i.max+=2,i.nbins=Math.round(i.max-i.min);else{let t=i.max-i.min+2,n=Math.floor(t/e);for(;n*e<t;)n++;i.max=i.min+e*n}else i.min>=i.max?(i.max=i.min,Math.abs(i.min)<100?(i.min-=1,i.max+=1):i.min>0?(i.min*=.9,i.max*=1.1):(i.min*=1.1,i.max*=.9)):i.max+=(i.max-i.min)/i.nbins}}return i.k=i.nbins/(i.max-i.min),i.GetBin=function(t){const e=this.lbls?this.lbls.indexOf(t):Math.floor((t-this.min)*this.k);return e<0?0:e>this.nbins?this.nbins+1:e+1},i}createHistogram(){if(this.hist||!this.vars[0].buf)return;if(this.dump_values)this.hist=[],this.fill1DHistogram=this.fill2DHistogram=this.fill3DHistogram=this.dumpValues;else if(this.graph){let t=this.vars[0].buf.length;1==this.ndim?this.hist=O(t,Array.from(Array(t).keys()),this.vars[0].buf):2==this.ndim&&(this.hist=O(t,this.vars[0].buf,this.vars[1].buf),delete this.vars[1].buf),this.hist.fTitle=this.hist_title,this.hist.fName="Graph"}else{switch(this.x=this.getMinMaxBins(0,this.ndim>1?50:200),this.y=this.getMinMaxBins(1,50),this.z=this.getMinMaxBins(2,50),this.ndim){case 1:this.hist=D("TH1"+this.htype,this.x.nbins);break;case 2:this.hist=D("TH2"+this.htype,this.x.nbins,this.y.nbins);break;case 3:this.hist=D("TH3"+this.htype,this.x.nbins,this.y.nbins,this.z.nbins)}this.hist.fXaxis.fTitle=this.x.title,this.hist.fXaxis.fXmin=this.x.min,this.hist.fXaxis.fXmax=this.x.max,this.hist.fXaxis.fLabels=this.x.fLabels,this.ndim>1&&(this.hist.fYaxis.fTitle=this.y.title),this.hist.fYaxis.fXmin=this.y.min,this.hist.fYaxis.fXmax=this.y.max,this.hist.fYaxis.fLabels=this.y.fLabels,this.ndim>2&&(this.hist.fZaxis.fTitle=this.z.title),this.hist.fZaxis.fXmin=this.z.min,this.hist.fZaxis.fXmax=this.z.max,this.hist.fZaxis.fLabels=this.z.fLabels,this.hist.fName=this.hist_name,this.hist.fTitle=this.hist_title,this.hist.fOption=this.histo_drawopt,this.hist.$custom_stat="$htemp"==this.hist_name?111110:111111}let t=this.vars[0].buf,e=this.cut.buf,i=t.length;if(!this.graph)switch(this.ndim){case 1:for(let n=0;n<i;++n)this.fill1DHistogram(t[n],e?e[n]:1);break;case 2:{let n=this.vars[1].buf;for(let r=0;r<i;++r)this.fill2DHistogram(t[r],n[r],e?e[r]:1);delete this.vars[1].buf;break}case 3:{let n=this.vars[1].buf,r=this.vars[2].buf;for(let s=0;s<i;++s)this.fill3DHistogram(t[s],n[s],r[s],e?e[s]:1);delete this.vars[1].buf,delete this.vars[2].buf;break}}delete this.vars[0].buf,delete this.cut.buf}fillTBitsHistogram(t,e){if(!(e&&t&&t.fNbits&&t.fAllBits))return;const i=Math.min(t.fNbits+1,8*t.fNbytes);for(let n=0,r=1,s=0;n<i;++n)t.fAllBits[s]&&r&&(n<=this.x.nbins?this.hist.fArray[n+1]+=e:this.hist.fArray[this.x.nbins+1]+=e),r*=2,r>=256&&(r=1,++s)}FillBitsHistogram(t,e){if(e)for(let i=0,n=1;i<this.x.nbins;++i)t&n&&(this.hist.fArray[i+1]+=e),n*=2}fill1DHistogram(t,e){let i=this.x.GetBin(t);this.hist.fArray[i]+=e,this.x.lbls||(this.hist.fTsumw+=e,this.hist.fTsumwx+=e*t,this.hist.fTsumwx2+=e*t*t)}fill2DHistogram(t,e,i){let n=this.x.GetBin(t),r=this.y.GetBin(e);this.hist.fArray[n+(this.x.nbins+2)*r]+=i,this.x.lbls||this.y.lbls||(this.hist.fTsumw+=i,this.hist.fTsumwx+=i*t,this.hist.fTsumwy+=i*e,this.hist.fTsumwx2+=i*t*t,this.hist.fTsumwxy+=i*t*e,this.hist.fTsumwy2+=i*e*e)}fill3DHistogram(t,e,i,n){let r=this.x.GetBin(t),s=this.y.GetBin(e),a=this.z.GetBin(i);this.hist.fArray[r+(this.x.nbins+2)*(s+(this.y.nbins+2)*a)]+=n,this.x.lbls||this.y.lbls||this.z.lbls||(this.hist.fTsumw+=n,this.hist.fTsumwx+=n*t,this.hist.fTsumwy+=n*e,this.hist.fTsumwz+=n*i,this.hist.fTsumwx2+=n*t*t,this.hist.fTsumwy2+=n*e*e,this.hist.fTsumwz2+=n*i*i,this.hist.fTsumwxy+=n*t*e,this.hist.fTsumwxz+=n*t*i,this.hist.fTsumwyz+=n*e*i)}dumpValues(t,e,i,n){let r;switch(this.ndim){case 1:r={x:t,weight:e};break;case 2:r={x:t,y:e,weight:i};break;case 3:r={x:t,y:e,z:i,weight:n}}this.cut.is_dummy()&&(1===this.ndim?r=t:delete r.weight),this.hist.push(r)}ProcessArraysFunc(){if(this.arr_limit||this.graph){let t=this.vars[0],e=this.tgtarr.br0.length,i=this.vars[1],n=this.vars[2];if(0===t.buf.length&&e>=this.arr_limit&&!this.graph)t.buf=this.tgtarr.br0,i&&(i.buf=this.tgtarr.br1),n&&(n.buf=this.tgtarr.br2);else for(let r=0;r<e;++r)t.buf.push(this.tgtarr.br0[r]),i&&i.buf.push(this.tgtarr.br1[r]),n&&n.buf.push(this.tgtarr.br2[r]);t.kind="number",i&&(i.kind="number"),n&&(n.kind="number"),this.cut.buf=null,!this.graph&&t.buf.length>=this.arr_limit&&(this.createHistogram(),this.arr_limit=0)}else{let t=this.tgtarr.br0,e=t.length;switch(this.ndim){case 1:for(let i=0;i<e;++i)this.fill1DHistogram(t[i],1);break;case 2:{let i=this.tgtarr.br1;for(let n=0;n<e;++n)this.fill2DHistogram(t[n],i[n],1);break}case 3:{let i=this.tgtarr.br1,n=this.tgtarr.br2;for(let r=0;r<e;++r)this.fill3DHistogram(t[r],i[r],n[r],1);break}}}}ProcessDump(){let t=this.leaf?this.tgtobj.br0[this.leaf]:this.tgtobj.br0;t&&this.copy_fields&&0===IT(t)?this.hist.push(Object.assign({},t)):this.hist.push(t)}Process(t){if(this.globals.entry=t,this.cut.produce(this.tgtobj),!this.dump_values&&!this.cut.value)return;for(let t=0;t<this.ndim;++t)this.vars[t].produce(this.tgtobj);let e=this.vars[0],i=this.vars[1],n=this.vars[2],r=this.cut;if(this.graph||this.arr_limit){switch(this.ndim){case 1:for(let t=0;t<e.length;++t)e.buf.push(e.get(t)),r.buf.push(r.value);break;case 2:for(let t=0;t<e.length;++t)for(let n=0;n<i.length;++n)e.buf.push(e.get(t)),i.buf.push(i.get(n)),r.buf.push(r.value);break;case 3:for(let t=0;t<e.length;++t)for(let s=0;s<i.length;++s)for(let a=0;a<n.length;++a)e.buf.push(e.get(t)),i.buf.push(i.get(s)),n.buf.push(n.get(a)),r.buf.push(r.value)}!this.graph&&e.buf.length>=this.arr_limit&&(this.createHistogram(),this.arr_limit=0)}else if(this.hist)switch(this.ndim){case 1:for(let t=0;t<e.length;++t)this.fill1DHistogram(e.get(t),r.value);break;case 2:for(let t=0;t<e.length;++t)for(let n=0;n<i.length;++n)this.fill2DHistogram(e.get(t),i.get(n),r.value);break;case 3:for(let t=0;t<e.length;++t)for(let s=0;s<i.length;++s)for(let a=0;a<n.length;++a)this.fill3DHistogram(e.get(t),i.get(s),n.get(a),r.value)}if(this.monitoring&&this.hist&&!this.dump_values){let t=(new Date).getTime();t-this.lasttm>this.monitoring&&(this.lasttm=t,this.progress_callback&&this.progress_callback(this.hist))}}Terminate(t){t&&!this.hist&&this.createHistogram(),this.ShowProgress(),this.result_callback&&this.result_callback(this.hist)}}function VT(t,e){if(!t||!e||"TBranchElement"!==t._typename||t.fID<0||t.fStreamerType<0)return null;let i=e.findStreamerInfo(t.fClassName,t.fClassVersion,t.fCheckSum),n=i&&i.fElements?i.fElements.arr:null;if(!n)return null;let r=t.fName,s=r.indexOf("[");function a(e){return!!e&&(e.fName===r&&(e.fType===t.fStreamerType||(e.fType===Ib&&t.fStreamerType===Rb||((300===t.fStreamerType||320===t.fStreamerType||71===t.fStreamerType||91===t.fStreamerType)&&e.fType===Xb||(console.warn(`Should match element ${e.fType} with branch ${t.fStreamerType}`),!1)))))}if(s>0&&(r=r.slice(0,s)),s=r.lastIndexOf("."),s>0&&(r=r.slice(s+1)),a(n[t.fID]))return n[t.fID];for(let e=0;e<n.length;++e)if(e!==t.fID&&a(n[e]))return n[e];return console.error("Did not found/match element for branch",t.fName,"class",t.fClassName),null}function YT(t,e,i){let n=t.findStreamerInfo(e),r=n&&n.fElements?n.fElements.arr:null,s=null;if(!r)return"";for(let e=0;e<r.length;++e)if("BASE"===r[e].fTypeName){let n=YT(t,r[e].fName,i);if(n)return n}else if(r[e].fName===i){s=r[e];break}if(!s)return"";let a=s.fTypeName;return"*"===a[a.length-1]&&(a=a.slice(0,a.length-1)),a}function $T(t){let e=N(t),i={names:[],values:[],Create:function(){let t={};for(let e=0;e<this.names.length;++e)t[this.names[e]]=this.values[e];return t}};i.names.push("_typename"),i.values.push(t);for(let t in e)i.names.push(t),i.values.push(e[t]);return i}function WT(t,e,i){let n="";for(let r=i||0;r<t.arr.length;++r)0===t.arr[r].fName.indexOf(e)&&t.arr[r].fClassName&&(n=t.arr[r].fClassName);return n}function ZT(t,e,i){if(i||(i={}),!e||!t.$file||!e.numBranches())return e&&e.Terminate(!1),Promise.reject(Error("required parameter missing for TTree::Process"));const n={tree:t,file:t.$file,selector:e,arr:[],curr:-1,current_entry:-1,simple_read:!0,process_arrays:!0},r=(t,e)=>{let i=0;switch(t._typename){case"TLeafF":i=5;break;case"TLeafD":i=8;break;case"TLeafO":i=Ib;break;case"TLeafB":i=t.fIsUnsigned?Rb:1;break;case"TLeafS":i=t.fIsUnsigned?Lb:2;break;case"TLeafI":i=t.fIsUnsigned?Bb:3;break;case"TLeafL":i=t.fIsUnsigned?Fb:Nb;break;case"TLeafC":i=Hb;break;default:return null}return rw(e||t.fName,i)},s=t=>{for(let e=0;e<n.arr.length;++e)if(n.arr[e].branch===t)return n.arr[e];return null};let a,o,l=0;function h(t,e,a,o){if("string"==typeof t&&(t=GT(n.tree,t)),!t)return console.error("Did not found branch"),null;let c=s(t);if(c)return console.error("Branch already configured for reading",t.fName),c.tgt!==e&&console.error("Target object differs"),null;if(!t.fEntries)return console.warn("Branch ",t.fName," does not have entries"),null;for(c={branch:t,tgt:e,name:a,index:-1,member:null,type:0,curr_entry:-1,raw:null,basket:null,curr_basket:0,read_entry:-1,staged_entry:-1,first_readentry:-1,staged_basket:0,numentries:t.fEntries,numbaskets:t.fWriteBasket,counters:null,ascounter:[],baskets:[],staged_prev:0,staged_now:0,progress_showtm:0,GetBasketEntry:function(t){if(!this.branch||t>this.branch.fMaxBaskets)return 0;let e=t<this.branch.fMaxBaskets?this.branch.fBasketEntry[t]:0;if(e)return e;let i=t>0?this.branch.fBaskets.arr[t-1]:null;return i?this.branch.fBasketEntry[t-1]+i.fNevBuf:0},GetTarget:function(t){if(!this.tgt)return t;for(let e=0;e<this.tgt.length;++e){let i=this.tgt[e];t[i.name]||(t[i.name]=i.lst.Create()),t=t[i.name]}return t},GetEntry:function(t){let e,i=t-this.first_entry;this.branch.TestBit(NT)||this.raw.clearObjectMap(),this.basket.fEntryOffset?(e=this.basket.fEntryOffset[i],this.basket.fDisplacement&&(this.raw.fDisplacement=this.basket.fDisplacement[i])):e=this.basket.fKeylen+this.basket.fNevBufSize*i,this.raw.locate(e-this.raw.raw_shift)}};c.GetBasketEntry(c.numbaskets+1);)c.numbaskets++;let d=t.fLeaves?t.fLeaves.arr.length:0,u=d>0?t.fLeaves.arr[0]:null,f=null,m=null,p="TBranchElement"===t._typename,g=0,_=null,x=null,y="";if(t.fBranchCount){if(_=s(t.fBranchCount),_||(_=h(t.fBranchCount,e,"$counter"+l++,!0)),!_)return console.error("Cannot add counter branch",t.fBranchCount.fName),null;let i=t.fBranchCount2;if(!i&&300===t.fBranchCount.fStreamerType&&(t.fStreamerType===Vb||521===t.fStreamerType)){let e=VT(t,n.file),r=t.fBranchCount.fBranches.arr;if(e&&e.fCountName&&r)for(let n=0;n<r.length;++n)if(r[n].fName===t.fBranchCount.fName+"."+e.fCountName){i=r[n];break}i||console.error("Did not found branch for second counter of kStreamLoop element")}if(i&&(x=s(i),x||(x=h(i,e,"$counter"+l++,!0)),!x))return console.error("Cannot add counter branch2",i.fName),null}else if(1===d&&u&&u.fLeafCount){let t=GT(n.tree,u.fLeafCount.fName);if(t&&(_=s(t),_||(_=h(t,e,"$counter"+l++,!0)),!_))return console.error("Cannot add counter branch",t.fName),null}function A(i,r,s){if(!i||!i.arr.length)return!0;let l=t.fName;"."===l[l.length-1]&&(l=l.slice(0,l.length-1)),"string"==typeof o&&"."==o[0]&&(l+=o),l+=".";for(let c=0;c<i.arr.length;++c){let d=i.arr[c];if(s>0&&d.fType!==s)continue;if(1===d.fType){if(!A(d.fBranches,r,s))return!1;continue}let u=VT(d,n.file);if(u&&"BASE"===u.fTypeName){if(d.fTotBytes&&!h(d,e,a,o))return!1;if(!A(d.fBranches,r,s))return!1;continue}let f=d.fName,m=1;if(0===d.fName.indexOf(l))f=f.slice(l.length);else if(s>0)continue;let p=f.indexOf("[");if(p>0&&(f=f.slice(0,p)),p=f.indexOf("<"),p>0&&(f=f.slice(0,p)),s>0){m="$child$";let e=f.indexOf(".");e>0&&(m=WT(i,t.fName+"."+f.slice(0,e+1),c)||"TObject")}if(!h(d,r,f,m))return!1}return!0}if("TBranchObject"===t._typename)m={name:a,typename:t.fClassName,virtual:u.fVirtual,func:function(t,e){let i=this.typename;this.virtual&&(i=t.readFastString(t.ntou1()+1)),e[this.name]=t.classStreamer({},i)}};else if(3===t.fType||4===t.fType){if(f=rw(a,3),!o||"string"==typeof o&&"."===o[0]||1===o){if(n.process_arrays=!1,m={name:a,conttype:t.fClonesName||"TObject",reallocate:i.reallocate_objects,func:function(t,e){let i=t.ntoi4(),n=0,r=e[this.name];for(!r||this.reallocate?r=e[this.name]=new Array(i):(n=r.length,r.length=i);n<i;)r[n++]=this.methods.Create()}},"string"==typeof o&&"."===o[0]&&(m.conttype=WT(t.fBranches,t.fName+o),!m.conttype))return console.error(`Cannot select object ${o} in the branch ${t.fName}`),null;m.methods=$T(m.conttype),g=3===t.fType?31:41}}else{if(y=qT(t,n.tree)){if(!0===o)return console.warn(`Object branch ${y} can not have data to be read directly`),null;n.process_arrays=!1;let i=new Array(e?e.length+1:1);for(let t=0;t<i.length-1;++t)i[t]=e[t];return i[i.length-1]={name:a,lst:$T(y)},A(t.fBranches,i,0)?c:null}if(p&&1===d&&u.fName===t.fName&&-1==t.fID){if(f=rw(a,t.fClassName),f.fType===Gb){let e=n.file.getStreamer(t.fClassName,{val:t.fClassVersion,checksum:t.fCheckSum});e?m={name:a,typename:t.fClassName,streamer:e,func:function(t,e){let i={_typename:this.typename};for(let e=0;e<this.streamer.length;++e)this.streamer[e].func(t,i);e[this.name]=i}}:(f=null,console.warn("not found streamer!"))}}else if(p&&d<=1)f=VT(t,n.file),!f&&t.fStreamerType&&t.fStreamerType<20&&(f=rw(a,t.fStreamerType));else if(1===d)f=r(u,a);else if("TBranch"===t._typename&&d>1){let e=new Array(d),i=!0;for(let s=0;s<d;++s)e[s]=aw(r(t.fLeaves.arr[s]),n.file),e[s]||(i=!1);i&&(m={name:a,leaves:e,func:function(t,e){let i=e[this.name],n=0;for(i||(e[this.name]=i={});n<this.leaves.length;)this.leaves[n++].func(t,i)}})}}if(!f&&!m)return console.warn("Not supported branch kind",t.fName,t._typename),null;if(m||(m=aw(f,n.file),void 0!==m.base&&m.basename&&(m.func=function(t,e){e[this.name]||(e[this.name]={_typename:this.basename}),t.classStreamer(e[this.name],this.basename)})),_&&"string"==typeof o){m.name0=_.name;let e=a.split(".");if(1===e.length)m.get=(t,e)=>t[e];else{if("$child$"===o)return console.error(`target name ${a} contains point, but suppose to be direct child`),null;if(2===e.length)a=m.name=e[1],m.name1=e[0],m.subtype1=o,m.methods1=$T(m.subtype1),m.get=function(t,e){let i=t[e][this.name1];return i||(i=t[e][this.name1]=this.methods1.Create()),i};else{if(!t.fParentName)return console.error(`Not possible to provide more than 2 parts in the target name ${a}`),null;a=m.name=e.pop(),m.snames=e,m.smethods=[];let i=t.fParentName;for(let t=0;t<e.length;++t){let r=YT(n.file,i,e[t]);m.smethods[t]=$T(r||"AbstractClass"),i=r}m.get=function(t,e){let i=t[e][this.snames[0]];i||(i=t[e][this.snames[0]]=this.smethods[0].Create());for(let t=1;t<this.snames.length;++t){let e=i[this.snames[t]];e||(e=i[this.snames[t]]=this.smethods[t].Create()),i=e}return i}}}m.objs_branch_func?m.func=m.objs_branch_func:(m.func0=m.func,m.func=function(t,e){let i=e[this.name0],n=0;for(;n<i.length;)this.func0(t,this.get(i,n++))})}else if(_)if(n.process_arrays=!1,9===f.fType||f.fType===jb)m.stl_size=_.name,m.func=function(t,e){e[this.name]=this.readarr(t,e[this.stl_size])};else if(49!==f.fType&&59!==f.fType||!t.fBranchCount2)if(f.fType>0&&f.fType<qb||f.fType===Hb||f.fType>Ub&&f.fType<60&&t.fBranchCount2)m={name:a,stl_size:_.name,type:f.fType,func:function(t,e){e[this.name]=t.readFastArray(e[this.stl_size],this.type)}},t.fBranchCount2&&(m.type-=Ub,m.arr_size=x.name,m.func=function(t,e){let i=e[this.stl_size],n=e[this.arr_size],r=new Array(i);for(let e=0;e<i;++e)r[e]=1===t.ntou1()?t.readFastArray(n[e],this.type):[];e[this.name]=r});else if(f.fType>Ub&&f.fType<60&&m.cntname)m.cntname=_.name;else if(f.fType==Xb){if(x)throw new Error("Second branch counter not supported yet with kStreamer");m.func=m.branch_func,m.stl_size=_.name}else if(f.fType===Vb||521===f.fType)x?(m.stl_size=_.name,m.cntname=x.name,m.func=m.branch_func):m.cntname=_.name;else{let t;if(m.name="$stl_member",x){if(!m.cntname)throw new Error("Second branch counter not used - very BAD");t=x.name,m.cntname="$loop_size"}m={name:a,stl_size:_.name,loop_size:t,member0:m,func:function(t,e){let i=e[this.stl_size],n=new Array(i);for(let r=0;r<i;++r)this.loop_size&&(e.$loop_size=e[this.loop_size][r]),this.member0.func(t,e),n[r]=e.$stl_member;delete e.$stl_member,delete e.$loop_size,e[this.name]=n}}}else m.stl_size=_.name,m.arr_size=x.name,m.func=function(t,e){let i=e[this.stl_size],n=e[this.arr_size],r=new Array(i);for(let e=0;e<i;++e)r[e]=1===t.ntou1()?this.readarr(t,n[e]):[];e[this.name]=r};return m.name=a,c.member=m,f&&(c.type=f.fType),c.index=n.arr.length,_&&(c.counters=[_.index],_.ascounter.push(c.index),x&&(c.counters.push(x.index),x.ascounter.push(c.index))),n.arr.push(c),g&&!A(t.fBranches,e,g)?null:c}for(let t=0;t<e.numBranches();++t){if(!h(e.getBranch(t),void 0,e.nameOfBranch(t),e._directs[t]))return e.Terminate(!1),Promise.reject(Error(`Fail to add branch ${e.nameOfBranch(t)}`))}for(let t=1;t<n.arr.length&&n.simple_read;++t){let e=n.arr[t],i=n.arr[0];e.numentries===i.numentries&&e.numbaskets===i.numbaskets||(n.simple_read=!1);for(let t=0;t<e.numbaskets;++t)e.GetBasketEntry(t)!==i.GetBasketEntry(t)&&(n.simple_read=!1)}n.firstentry=n.lastentry=0;for(let t=0;t<n.arr.length;++t){let e=n.arr[t].branch,i=e.fFirstEntry;void 0===i&&(i=e.fBasketBytes[0]?e.fBasketEntry[0]:0),n.firstentry=Math.max(n.firstentry,i),n.lastentry=0===t?i+e.fEntries:Math.min(n.lastentry,i+e.fEntries)}if(n.firstentry>=n.lastentry)return e.Terminate(!1),Promise.reject(Error("No any common events for selected branches"));if(n.process_min=n.firstentry,n.process_max=n.lastentry,Number.isInteger(i.firstentry)&&i.firstentry>n.firstentry&&i.firstentry<n.lastentry&&(n.process_min=i.firstentry),n.current_entry=n.staged_now=n.process_min,Number.isInteger(i.numentries)&&i.numentries>0){let t=n.process_min+i.numentries;t<n.process_max&&(n.process_max=t)}if("function"==typeof e.ProcessArrays&&n.simple_read){for(let t=0;t<n.arr.length;++t){let e=n.arr[t];(e.type<=0||e.type>=qb||7===e.type)&&(n.process_arrays=!1)}if(n.process_arrays){e.tgtarr={};for(let t=0;t<n.arr.length;++t){let e=n.arr[t],i=rw(e.name,e.type);i.fType=e.type+qb,i.fArrayLength=10,i.fArrayDim=1,i.fMaxIndex[0]=10,e.arrmember=aw(i,n.file)}}}else n.process_arrays=!1;function c(t){function e(){let e=[],i="";for(let n=0;n<t.length;++n){if(t[n].done)continue;let r=t[n].branch;if(0===e.length)i=r.fFileName;else if(i!==r.fFileName)continue;t[n].selected=!0,e.push(r.fBasketSeek[t[n].basket],r.fBasketBytes[t[n].basket])}return e.length>0?{places:e,filename:i}:null}function i(t){if(n.staged_prev===n.staged_now||n.process_max<=n.process_min)return;let e=(new Date).getTime();if(e-n.progress_showtm<500)return;n.progress_showtm=e;let i=(n.staged_prev+t*(n.staged_now-n.staged_prev))/(n.process_max-n.process_min);n.selector.ShowProgress(i)}function r(s,a){if(!s||a.length>2&&2*s.length!==a.length)return Promise.resolve(null);return 2==a.length&&(s=[s]),function a(o){for(;o<t.length;++o){if(!t[o].selected)continue;t[o].selected=!1,t[o].done=!0;let e=s.shift(),i=new xw(e,0,n.file),r=i.classStreamer({},"TBasket");if(r.fNbytes!==t[o].branch.fBasketBytes[t[o].basket]&&console.error("mismatch in read basket sizes",t[o].branch.fBasketBytes[t[o].basket]),t[o].bskt_obj=r,r.fKeylen+r.fObjlen!==r.fNbytes)return _w(e,r.fObjlen,!1,i.o).then((e=>{if(!e)throw new Error("FAIL TO UNPACK");return i=new xw(e,0,n.file),i.raw_shift=r.fKeylen,i.fTagOffset=r.fKeylen,t[o].raw=i,t[o].branch.fEntryOffsetLen>0&&i.readBasketEntryOffset(r,i.raw_shift),a(o+1)}));i.raw_shift=0,t[o].raw=i,t[o].branch.fEntryOffsetLen>0&&i.readBasketEntryOffset(r,i.raw_shift)}let l=e();return l?n.file.readBuffer(l.places,l.filename,i).then((t=>r(t))).catch((()=>null)):Promise.resolve(t)}(0)}let s=e();return s?n.file.readBuffer(s.places,s.filename,i).then((t=>r(t,s.places))).catch((()=>null)):Promise.resolve(null)}function d(){let t=0,e=[],i=!0,r=!1,s=n.process_max;for(;t<1e6&&i;){i=!1;for(let a=n.arr.length-1;a>=0;--a){let o=n.arr[a];for(;o.staged_basket<o.numbaskets;){let l=o.staged_basket++;if(o.GetBasketEntry(l)>=n.process_max)break;if(o.first_readentry<0){if(o.GetBasketEntry(l+1)<=n.process_min)continue;o.curr_basket=l,o.first_readentry=o.GetBasketEntry(l)}let h={id:a,branch:o.branch,basket:l,raw:null},c=o.branch.fBaskets.arr[l];c?(h.raw=c.fBufferRef,h.raw?h.raw.locate(0):h.raw=new xw(null,0,n.file),h.raw.raw_shift=c.fKeylen,c.fBufferRef&&o.branch.fEntryOffsetLen>0&&h.raw.readBasketEntryOffset(c,h.raw.raw_shift),h.bskt_obj=c,r=!0,o.baskets[l]=h):(e.push(h),t+=o.branch.fBasketBytes[l],i=!0),o.staged_entry=o.GetBasketEntry(l+1),s=Math.min(s,o.staged_entry);break}}}if(0===t&&!r)return n.selector.Terminate(!0),a(n.selector);n.staged_prev=n.staged_now,n.staged_now=s;let o=0;if(n.process_max>n.process_min&&(o=(n.staged_prev-n.process_min)/(n.process_max-n.process_min)),n.selector.ShowProgress(o),n.progress_showtm=(new Date).getTime(),t>0)return c(e).then(u);if(r)return u([]);throw new Error("No any data is requested - never come here")}function u(t){if(0!==n.selector._break||null===t)return n.selector.Terminate(!1),a(n.selector);for(let e=0;e<t.length;++e)n.arr[t[e].id].baskets[t[e].basket]=t[e];let e=!1;for(;;){let t,i,r=1e8;for(t=0;t<n.arr.length;++t){if(i=n.arr[t],!i.raw||!i.basket||i.first_entry+i.basket.fNevBuf<=n.current_entry){if(delete i.raw,delete i.basket,i.curr_basket>=i.numbaskets){if(0==t)return n.selector.Terminate(!0),a(n.selector);continue}let r=i.baskets[i.curr_basket];if(!r)return e?d():(n.selector.Terminate(!1),o(Error(`no data for ${i.branch.fName} basket ${i.curr_basket}`)));i.raw=r.raw,i.basket=r.bskt_obj,i.first_entry=i.GetBasketEntry(r.basket),r.raw=null,r.branch=null,r.bskt_obj=null,i.baskets[i.curr_basket++]=void 0}r=Math.min(r,i.first_entry+i.basket.fNevBuf-n.current_entry)}if(n.current_entry+r>n.process_max&&(r=n.process_max-n.current_entry),n.process_arrays&&r>1){for(t=0;t<n.arr.length;++t)i=n.arr[t],i.GetEntry(n.current_entry),i.arrmember.arrlength=r,i.arrmember.func(i.raw,n.selector.tgtarr),i.raw=null;n.selector.ProcessArrays(n.current_entry),n.current_entry+=r,e=!0}else for(;r--;){for(t=0;t<n.arr.length;++t)i=n.arr[t],i.GetEntry(n.current_entry),i.member.func(i.raw,i.GetTarget(n.selector.tgtobj));n.selector.Process(n.current_entry),n.current_entry++,e=!0}if(n.current_entry>=n.process_max)return n.selector.Terminate(!0),a(n.selector)}}return new Promise(((e,i)=>{a=e,o=i,n.selector.Begin(t),d()}))}function QT(t,e){"string"==typeof e&&(e={expr:e}),e.expr||(e.expr="");let i=new XT;return e.branch?i.drawOnlyBranch(t,e.branch,e.expr,e)||(i=null):i.parseDrawExpression(t,e)||(i=null),i?new Promise((n=>{i.setCallback(n,e.progress),ZT(t,i,e)})):Promise.reject(Error("Fail to create selector for specified expression"))}function JT(t,e){let i=[],n=[],r=[];let s=function t(e,s=""){if(!e||!e.fBranches)return 0;let a=0;for(let o=0;o<e.fBranches.arr.length;++o){let l=e.fBranches.arr[o],h=(s?s+"/":"")+l.fName;i.push(l),n.push(h),r.push(0);let c=r.length-1;a+=l.fLeaves?l.fLeaves.arr.length:0;let d=t(l,h);a+=d,r[c]=d}return a}(t);return n.push(`Total are ${i.length} branches with ${s} leaves`),function s(a){if(a>=i.length)return Promise.resolve(!0);let o=new FT;o.addBranch(i[a],"br0"),o.Process=function(){void 0===this.tgtobj.br0&&(this.fail=!0)},o.Terminate=function(t){"string"!=typeof t&&(t=!t||this.fails?"FAIL":"ok"),n[a]=t+" "+n[a]};let l=i[a],h=qT(l,t),c=l.fEntries,d=!l.fLeaves||0===l.fLeaves.arr.length;if(h&&(d=r[a]>100),d||c<=0)return s(a+1);let u={numentries:10},f=l.fFirstEntry||0,m=l.fEntryNumber||f+c;return c<u.numentries?u.numentries=c:u.firstentry=f+Math.round((m-f-u.numentries)*Math.random()),console.log(`test branch ${l.fName} first ${u.firstentry||0} num ${u.numentries}`),e.showProgress&&e.showProgress(`br ${a}/${i.length} ${l.fName}`),ZT(t,o,u).then((()=>s(a+1)))}(0).then((()=>(e.showProgress&&e.showProgress(),n)))}var KT=Object.freeze({__proto__:null,kClonesNode:3,kSTLNode:4,TSelector:FT,TDrawVariable:HT,TDrawSelector:XT,treeHierarchy:function(t,e){function i(t,e,n,r){if(!t||!e)return!1;let s=e.fBranches?e.fBranches.arr.length:0,a=e.fLeaves?e.fLeaves.arr.length:0;function o(t){let e=t.indexOf("[");return e>0&&(t=t.slice(0,e)),r&&0==t.indexOf(r.fName)&&"."===(t=t.slice(r.fName.length))[0]&&(t=t.slice(1)),t}e.$tree=n;let l={_name:o(e.fName),_kind:"ROOT."+e._typename,_title:e.fTitle,_obj:e};if(t._childs||(t._childs=[]),t._childs.push(l),"TBranchElement"===e._typename&&(l._title+=" from "+e.fClassName+";"+e.fClassVersion),s>0)return l._more=!0,l._expand=function(t,e){if(!e)return!1;t._childs||(t._childs=[]),!e.fLeaves||1!==e.fLeaves.arr.length||3!==e.fType&&4!==e.fType||(e.fLeaves.arr[0].$branch=e,t._childs.push({_name:"@size",_title:"container size",_kind:"ROOT.TLeafElement",_icon:"img_leaf",_obj:e.fLeaves.arr[0],_more:!1}));for(let n=0;n<e.fBranches.arr.length;++n)i(t,e.fBranches.arr[n],e.$tree,e);let n=qT(e,e.$tree,!0),r=n?N(n):null;if(r&&e.fBranches.arr.length>0)for(let i in r){if("function"!=typeof r[i])continue;let s=r[i].toString();s.indexOf("return")>0&&0==s.indexOf("function ()")&&t._childs.push({_name:i+"()",_title:"function "+i+" of class "+n,_kind:"ROOT.TBranchFunc",_obj:{_typename:"TBranchFunc",branch:e,func:i},_more:!1})}return!0},!0;if(1===a)l._icon="img_leaf",l._more=!1;else if(a>1){l._childs=[];for(let t=0;t<a;++t){e.fLeaves.arr[t].$branch=e;let i={_name:o(e.fLeaves.arr[t].fName),_kind:"ROOT."+e.fLeaves.arr[t]._typename,_obj:e.fLeaves.arr[t]};l._childs.push(i)}}return!0}t._childs=[],t._tree=e;for(let n=0;n<e.fBranches.arr.length;++n)i(t,e.fBranches.arr[n],e);return!0},treeProcess:ZT,treeDraw:QT,treeIOTest:JT});function tS(t,e,i){let n=e._typename;return n&&"string"==typeof n?0==n.indexOf("TH1")?hb.draw(t,e,i):0==n.indexOf("TH2")?ub.draw(t,e,i):0==n.indexOf("TH3")?mb.draw(t,e,i):0==n.indexOf("TGraph")?wT.draw(t,e,i):Promise.reject(Error(`Object of type ${n} cannot be draw with TTree`)):Promise.reject(Error("Object without type cannot be draw with TTree"))}function eS(t,e){if(e||this.last_pr){if(this.dump||this.testio){if(!e)return;if(l()){let e=new hl(this.drawid);return e.selectDom().property("_json_object_",t),Promise.resolve(e)}if("function"==typeof s.drawInspector)return s.drawInspector(this.drawid,t);let i=k("TObjString");return i.fString=T(t,2),Yl(this.drawid,i)}return this.last_pr||(this.last_pr=Promise.resolve(!0)),this.last_pr.then((()=>(this.obj_painter?this.last_pr=this.obj_painter.redrawObject(t).then((()=>this.obj_painter)):this.last_pr=tS(this.drawid,t).then((t=>(this.obj_painter=t,e||(this.last_pr=null),t))),e?this.last_pr:null)))}}function iS(t){return t.draw_first=!0,t.configureOnline=function(t,e,i,n,r){this.setItemName(t,"",this),this.url=e,this.root_version=n,this.askey=i,this.draw_expr=r},t.configureTree=function(t){this.local_tree=t},t.showExtraButtons=function(t){let e=this.selectDom(),i=this.local_tree?this.local_tree.fEntries:0;e.select(".treedraw_more").remove(),e.select(".treedraw_buttons").node().innerHTML+=`Cut: <input class="treedraw_cut ui-corner-all ui-widget" style="width:8em;margin-left:5px" title="cut expression"></input>Opt: <input class="treedraw_opt ui-corner-all ui-widget" style="width:5em;margin-left:5px" title="histogram draw options"></input>Num: <input class="treedraw_number" type="number" min="0" max="${i}" step="1000" style="width:7em;margin-left:5px" title="number of entries to process (default all)"></input>First: <input class="treedraw_first" type="number" min="0" max="${i}" step="1000" style="width:7em;margin-left:5px" title="first entry to process (default first)"></input><button class="treedraw_clear" title="Clear drawing">Clear</button>`,e.select(".treedraw_exe").on("click",(()=>this.performDraw())),e.select(".treedraw_cut").property("value",t?.parse_cut||"").on("change",(()=>this.performDraw())),e.select(".treedraw_opt").property("value",t?.drawopt||"").on("change",(()=>this.performDraw())),e.select(".treedraw_number").attr("value",t?.numentries||""),e.select(".treedraw_first").attr("value",t?.firstentry||""),e.select(".treedraw_clear").on("click",(()=>th(this.drawid)))},t.showPlayer=function(t){let e=this.selectDom();this.drawid="jsroot_tree_player_"+s.id_counter+++"_draw";let i=t?.parse_cut||t?.numentries||t?.firstentry;e.html(`<div style="display:flex; flex-flow:column; height:100%; width:100%;"><div class="treedraw_buttons" style="flex: 0 1 auto;margin-top:0.2em;"><button class="treedraw_exe" title="Execute draw expression" style="margin-left:0.5em">Draw</button>Expr:<input class="treedraw_varexp treedraw_varexp_info" style="width:12em;margin-left:5px" title="draw expression"></input><label class="treedraw_varexp_info">ⓘ</label><button class="treedraw_more">More</button></div><div style="flex: 0 1 auto"><hr/></div><div id="${this.drawid}" style="flex: 1 1 auto; overflow:hidden;"></div></div>`),this.setTopPainter(),this.local_tree&&e.select(".treedraw_buttons").attr("title","Tree draw player for: "+this.local_tree.fName),e.select(".treedraw_exe").on("click",(()=>this.performDraw())),e.select(".treedraw_varexp").attr("value",t?.parse_expr||this.draw_expr||"px:py").on("change",(()=>this.performDraw())),e.select(".treedraw_varexp_info").attr("title","Example of valid draw expressions:\n  px - 1-dim draw\n  px:py - 2-dim draw\n  px:py:pz - 3-dim draw\n  px+py:px-py - use any expressions\n  px:py>>Graph - create and draw TGraph\n  px:py>>dump - dump extracted variables\n  px:py>>h(50,-5,5,50,-5,5) - custom histogram\n  px:py;hbins:100 - custom number of bins"),i?this.showExtraButtons(t):e.select(".treedraw_more").on("click",(()=>this.showExtraButtons(t))),this.checkResize(),fv(this)},t.getValue=function(t){const e=this.selectDom().select(t);if(e.empty())return;const i=e.property("value");return void 0!==i?i:e.attr("value")},t.performLocalDraw=function(){if(!this.local_tree)return;const t=this.selectDom(),e={expr:this.getValue(".treedraw_varexp")};t.select(".treedraw_more").empty()&&(e.cut=this.getValue(".treedraw_cut"),e.cut||delete e.cut,e.drawopt=this.getValue(".treedraw_opt"),"dump"===e.drawopt&&(e.dump=!0,e.drawopt=""),e.drawopt||delete e.drawopt,e.numentries=parseInt(this.getValue(".treedraw_number")),Number.isInteger(e.numentries)||delete e.numentries,e.firstentry=parseInt(this.getValue(".treedraw_first")),Number.isInteger(e.firstentry)||delete e.firstentry),e.drawopt&&th(this.drawid),e.drawid=this.drawid,e.progress=eS.bind(e),QT(this.local_tree,e).then((t=>e.progress(t,!0)))},t.getDrawOpt=function(){let t="player",e=this.getValue(".treedraw_varexp");return e&&(t+=":"+e),t},t.performDraw=function(){if(this.local_tree)return this.performLocalDraw();let t=this.selectDom(),e=this.url+"/exe.json.gz?compact=3&method=Draw",i=this.getValue(".treedraw_varexp"),n="h_tree_draw",r="",s=i.indexOf(">>");if(s<0)i+=">>"+n;else{n=i.slice(s+2),"+"==n[0]&&(n=n.slice(1));let t=n.indexOf("(");t>0&&(n=n.slice(0,t))}if(t.select(".treedraw_more").empty()){let t=this.getValue(".treedraw_cut"),n=this.getValue(".treedraw_number"),s=this.getValue(".treedraw_first");r=this.getValue(".treedraw_opt"),e+=`&prototype="const char*,const char*,Option_t*,Long64_t,Long64_t"&varexp="${i}"&selection="${t}"`,""==n&&(n=this.root_version>=394499?"TTree::kMaxEntries":"1000000000"),""==s&&(s="0"),e+=`&option="${r}"&nentries=${n}&firstentry=${s}`}else e+=`&prototype="Option_t*"&opt="${i}"`;e+="&_ret_object_="+n;const a=()=>{E(e,"object").then((t=>{th(this.drawid),tS(this.drawid,t,r)}))};this.draw_expr=i,this.askey?(this.askey=!1,E(this.url+"/root.json.gz?compact=3","text").then(a)):a()},t.checkResize=function(){Kl(this.drawid)},t}function nS(t,e,i,n){let r=t.findItem(e),s=t.getTopOnlineItem(r),a="",o=0;if(!r||!s)return null;if(n){for(a=r._name;r&&!r._ttree;)r=r._parent;if(!r)return null;e=t.itemFullName(r)}let l=t.getOnlineItemUrl(e);if(!l)return null;let h=s._root_version||400129,c=t.getDisplay();if(!c)return null;let d=c.findFrame(e,!0);if(!d)return null;let u=Ii(d).attr("id"),f=new hl(u);if(r._childs&&!n)for(let t=0;t<r._childs.length;++t){let e=r._childs[t];e&&e._kind&&0==e._kind.indexOf("ROOT.TLeaf")&&o<2&&(o++>0&&(a+=":"),a+=e._name)}return iS(f),f.configureOnline(e,l,i,h,a),f.showPlayer(),f}XT.prototype.ShowProgress=function(t){if("undefined"==typeof document||l())return;if(void 0===t||!Number.isFinite(t))return lv();if(this.last_progress!==t){let e=t-this.last_progress;this.aver_diff||(this.aver_diff=e),this.aver_diff=.3*e+.7*this.aver_diff}let e=0;this.aver_diff<=0?e=0:this.aver_diff<1e-4?e=3:this.aver_diff<.001?e=2:this.aver_diff<.01&&(e=1);let i=document.createElement("p"),n=document.createTextNode("TTree draw "+(100*t).toFixed(e)+" %  "),r=this;i.appendChild(n),i.title="Click on element to break drawing",i.onclick=function(){if(++r._break<3)return i.title="Tree draw will break after next I/O operation",n.nodeValue="Breaking ... ";r.Abort(),lv()},lv(i),this.last_progress=t};var rS=Object.freeze({__proto__:null,drawTree:function(){let t,e=this,i=this.getObject(),n=this.getDrawOpt(),r=i,s=n;if("TBranchFunc"==i._typename?(s={expr:"."+i.func+"()",branch:i.branch},n&&0==n.indexOf("dump")?s.expr+=">>"+n:n&&(s.expr+=n),r=i.branch.$tree):i.$branch?(s={expr:"."+i.fName+(n||""),branch:i.$branch},3!==s.branch.fType&&4!==s.branch.fType||(s.expr=n,s.direct_branch=!0),r=i.$branch.$tree):i.$tree?(!n&&i.fStreamerType&&i.fStreamerType!==Hb&&i.fStreamerType>=61&&i.fStreamerType<=69&&(n="dump"),s={expr:n,branch:i},r=i.$tree):(s||(s="player"),"string"==typeof s&&(s={expr:s})),!r)throw Error("No TTree object available for TTree::Draw");if("string"==typeof s.expr){let t=s.expr.indexOf("player");0==t?(s.player=!0,s.expr=s.expr.slice(6),":"==s.expr[0]&&(s.expr=s.expr.slice(1))):t>=0&&t==s.expr.length-6&&(s.player=!0,s.expr=s.expr.slice(0,t),t>0&&";"==s.expr[t-1]&&(s.expr=s.expr.slice(0,t-1)))}if(s.player?(iS(e),e.configureTree(r),e.showPlayer(s),s.drawid=e.drawid):s.drawid=e.getDom(),s.progress=eS.bind(s),"testio"===s.expr)s.testio=!0,s.showProgress=lv,t=JT(r,s);else{if(!s.expr&&!s.branch)return Promise.resolve(e);t=QT(r,s)}return t.then((t=>s.progress(t,!0)))},drawTreePlayer:nS,drawTreePlayerKey:function(t,e){return nS(t,e,!0)},drawLeafPlayer:function(t,e){return nS(t,e,!1,!0)}});class sS extends Vl{constructor(t,e,i,n){super(t,e,i),this.csstype=n}v7EvalAttr(t,e){let i=this.getObject();if(!i)return e;this.cssprefix&&(t=this.cssprefix+t);const n=t=>{if(void 0===e)return t;let i=typeof e,n=typeof t;return i==n?t:"boolean"==i?"string"==n?""!=t&&"0"!=t&&"no"!=t&&"off"!=t:!!t:"number"==i&&"string"==n?parseFloat(t):t};if(i.fAttr&&i.fAttr.m){let e=i.fAttr.m[t];if(e)return n(e.v)}if(this.rstyle&&this.rstyle.fBlocks){let e=this.rstyle.fBlocks;for(let r=0;r<e.length;++r){let s=e[r];if((this.csstype&&s.selector==this.csstype||i.fId&&s.selector=="#"+i.fId||i.fCssClass&&s.selector=="."+i.fCssClass)&&s.map&&s.map.m){let e=s.map.m[t.toLowerCase()];if(e)return n(e.v)}}}return e}v7SetAttr(t,e){let i=this.getObject();this.cssprefix&&(t=this.cssprefix+t),i&&i.fAttr&&i.fAttr.m&&(i.fAttr.m[t]={v:e})}v7EvalLength(t,e,i){e<=0&&(e=1);let n=this.v7EvalAttr(t);if(void 0===n)return Math.round(i*e);if("number"==typeof n)return Math.round(n*e);if(null===n)return 0;let r=0,s=0,a=n,o=0,l=0;for(;a.length>0;){for(;l<a.length&&(" "==a[l]||"\t"==a[l]);)++l;if(l>=a.length)break;if("-"==a[l]||"+"==a[l]){if(o)return console.log("Fail to parse RPadLength "+n),i;o="-"==a[l]?-1:1,l++;continue}for(l>0&&(a=a.slice(l),l=0);l<a.length&&(a[l]>="0"&&a[l]<="9"||"."==a[l]);)l++;let t=parseFloat(a.slice(0,l));if(!Number.isFinite(t))return console.log("Fail to parse RPadLength "+n),Math.round(i*e);a=a.slice(l),l=0,o||(o=1),a.length>0&&"%"==a[0]?(a=a.slice(1),r+=o*t*.01):a.length>1&&"p"==a[0]&&"x"==a[1]?(a=a.slice(2),s+=o*t):r+=o*t,o=0}return Math.round(r*e+s)}v7EvalColor(t,e){let i=this.v7EvalAttr(t,"");if(!i||"string"!=typeof i)return e;if("auto"==i){let e=this.getPadPainter();if(e&&void 0!==e._auto_color_cnt){let n=e.getHistPalette(),r=e._auto_color_cnt++,s=e._num_primitives-1;s<2&&(s=2),i=n?n.getColorOrdinal(r%s/s):"blue",this._auto_colors||(this._auto_colors={}),this._auto_colors[t]=i}else this._auto_colors&&this._auto_colors[t]?i=this._auto_colors[t]:(console.error(`Autocolor ${t} not defined yet - please check code`),i="")}else if("["==i[0]){let t=parseFloat(i.slice(1,i.length-1));if(i="black",Number.isFinite(t)){let e=this.getPadPainter(),n=e?e.getHistPalette():null;n&&(i=n.getColorOrdinal(t))}}return i}v7EvalFont(t,e,i){e?"number"==typeof e&&(e={size:e}):e={};let n=this.getPadPainter(),r=n._dfltRFont||{fFamily:"Arial",fStyle:"",fWeight:""},s=this.v7EvalAttr(t+"_size",e.size||12),a=this.v7EvalAttr(t+"_angle",0),o=this.v7EvalAttr(t+"_align",e.align||"none"),l=this.v7EvalColor(t+"_color",e.color||"none"),h=this.v7EvalAttr(t+"_font_family",r.fFamily||"Arial"),c=this.v7EvalAttr(t+"_font_style",r.fStyle||""),d=this.v7EvalAttr(t+"_font_weight",r.fWeight||"");"string"==typeof s&&(s=parseFloat(s)),(!Number.isFinite(s)||s<=0)&&(s=12),i||(i=n.getPadHeight()||100);let u=new fl(null,s,i,h,c,d);return a&&u.setAngle(360-a),"none"!==o&&u.setAlign(o),"none"!==l&&u.setColor(l),u}createv7AttFill(t){t&&"string"==typeof t||(t="fill_");let e=this.v7EvalColor(t+"color",""),i=this.v7EvalAttr(t+"style",0);this.createAttFill({pattern:i,color:e,color_as_svg:!0})}createv7AttLine(t){t&&"string"==typeof t||(t="line_");let e=this.v7EvalColor(t+"color","black"),i=this.v7EvalAttr(t+"width",1),n=this.v7EvalAttr(t+"style",1),r=this.v7EvalAttr(t+"pattern");this.createAttLine({color:e,width:i,style:n,pattern:r}),"border_"==t&&this.lineatt.setBorder(this.v7EvalAttr(t+"rx",0),this.v7EvalAttr(t+"ry",0))}createv7AttMarker(t){t&&"string"==typeof t||(t="marker_");let e=this.v7EvalColor(t+"color","black"),i=this.v7EvalAttr(t+"size",.01),n=this.v7EvalAttr(t+"style",1),r=1;if(i<1){let t=this.getPadPainter();r=t?t.getPadHeight():100}this.createAttMarker({color:e,size:i,style:n,refsize:r})}v7AttrChange(t,e,i,n){if(!this.snapid)return!1;t._typename||(t._typename="ROOT::Experimental::RChangeAttrRequest",t.ids=[],t.names=[],t.values=[],t.update=!0),this.cssprefix&&(e=this.cssprefix+e),t.ids.push(this.snapid),t.names.push(e);let r=null;if(null==i&&(n||(n="none"),"none"!==n&&console.error(`Trying to set ${n} for none value`)),!n)switch(typeof i){case"number":n="double";break;case"boolean":n="boolean"}switch(r={_typename:"ROOT::Experimental::RAttrMap::"},n){case"none":r._typename+="NoValue_t";break;case"boolean":r._typename+="BoolValue_t",r.v=!!i;break;case"int":r._typename+="IntValue_t",r.v=parseInt(i);break;case"double":r._typename+="DoubleValue_t",r.v=parseFloat(i);break;default:r._typename+="StringValue_t",r.v="string"==typeof i?i:JSON.stringify(i)}return t.values.push(r),!0}v7SendAttrChanges(t,e){let i=this.getCanvPainter();i&&t&&t._typename&&(void 0!==e&&(t.update=!!e),i.v7SubmitRequest("",t))}v7SubmitRequest(t,e,i){let n=this.getCanvPainter();return n&&n.submitDrawableRequest?this.snapid?n.submitDrawableRequest(t,e,this,i):(this._pending_request={_kind:t,_req:e,_method:i},e):null}assignSnapId(t){if(this.snapid=t,this.snapid&&this._pending_request){let t=this._pending_request;this.v7SubmitRequest(t._kind,t._req,t._method),delete this._pending_request}}v7CommMode(){let t=this.getCanvPainter();return t&&t.submitDrawableRequest&&t._websocket?1:3}v7NormalMode(){return 1==this.v7CommMode()}v7OfflineMode(){return 3==this.v7CommMode()}}class aS extends sS{constructor(t,e,i,n){super(t,n?e.getObject():e,"",n?e.csstype:"axis"),Object.assign(this,ky),this.initAxisPainter(),this.axis=i,n?(this.embedded=!0,this.cssprefix=n,this.rstyle=e.rstyle):this.cssprefix="axis_"}cleanup(){delete this.axis,delete this.axis_g,this.cleanupAxisPainter(),super.cleanup()}getAxisType(){return"RAttrAxis"}configureZAxis(t,e){this.name=t,this.kind="normal",this.log=!1;let i=this.v7EvalAttr("log",0);i&&(this.log=!0,this.logbase=10,Math.abs(i-Math.exp(1))<.1?this.logbase=Math.exp(1):i>1.9&&(this.logbase=Math.round(i))),e.logz=this.log}configureAxis(t,e,i,n,r,s,a,o,l){l||(l={}),this.name=t,this.full_min=e,this.full_max=i,this.kind="normal",this.vertical=s,this.log=!1;let h=this.v7EvalAttr("log",0),c=this.v7EvalAttr("symlog",0);if(this.reverse=l.reverse||!1,this.v7EvalAttr("time")){this.kind="time",this.timeoffset=0;let t=this.v7EvalAttr("timeOffset");void 0!==t&&(t=parseFloat(t),Number.isFinite(t)&&(this.timeoffset=1e3*t))}else this.axis&&this.axis.fLabelsIndex?(this.kind="labels",delete this.own_labels):l.labels?this.kind="labels":this.kind="normal";"time"==this.kind?this.func=Da().domain([this.convertDate(n),this.convertDate(r)]):c&&c>0?(this.symlog=c,this.func=xr().constant(c).domain([n,r])):h?(r<=0&&(r=1),(n<=0||n>=r)&&(n=1e-4*r),this.log=!0,this.logbase=10,Math.abs(h-Math.exp(1))<.1?this.logbase=Math.exp(1):h>1.9&&(this.logbase=Math.round(h)),this.func=mr().base(this.logbase).domain([n,r])):this.func=sr().domain([n,r]),this.scale_min=n,this.scale_max=r,this.gr_range=o||1e3;let d=a||[0,this.gr_range];this.axis_shift=d[1]-this.gr_range,this.reverse?this.func.range([d[1],d[0]]):this.func.range(d),"time"==this.kind?this.gr=t=>this.func(this.convertDate(t)):this.log?this.gr=t=>t<this.scale_min?this.vertical?this.func.range()[0]+5:-5:this.func(t):this.gr=this.func,delete this.format;let u=this.v7EvalAttr("ndiv",508);this.nticks=u%100,this.nticks2=(u%1e4-this.nticks)/100,this.nticks3=Math.floor(u/1e4),this.nticks>20&&(this.nticks=20);let f=Math.abs(this.gr_range)||100;if("time"==this.kind){this.nticks>8&&(this.nticks=8);let t=this.scale_max-this.scale_min,e=this.v7EvalAttr("timeFormat",""),i=Ey(t/f,!1);(!e||t<.1*(this.full_max-this.full_min))&&(e=Ey(t/this.nticks,!0)),this.tfunc1=this.tfunc2=os(e),i!==e&&(this.tfunc2=os(i)),this.format=this.formatTime}else if(this.log)this.nticks2>1&&(this.nticks*=this.nticks2,this.nticks2=1),this.noexp=this.v7EvalAttr("noexp",!1),this.scale_max<300&&this.scale_min>.3&&10==this.logbase&&(this.noexp=!0),this.moreloglabels=this.v7EvalAttr("moreloglbls",!1),this.format=this.formatLog;else if("labels"==this.kind){this.nticks=50;let t=this.scale_max-this.scale_min;this.nticks>t&&(this.nticks=Math.round(t)),this.nticks2=1,this.format=this.formatLabels}else this.order=0,this.ndig=0,this.format=this.formatNormal}getScaleMin(){return this.func?this.func.domain()[0]:0}getScaleMax(){return this.func?this.func.domain()[1]:0}formatLabels(t){let e=Math.round(t);if(this.axis&&this.axis.fLabelsIndex){if(e<0||e>=this.axis.fNBinsNoOver)return null;for(let t=0;t<this.axis.fLabelsIndex.length;++t){let i=this.axis.fLabelsIndex[t];if(i.second===e)return i.first}}else{let t=this.getObject().fLabels;if(t&&e>=0&&e<t.length)return t[e]}return null}createTicks(t,e,i,n){i&&this.nticks&&"normal"==this.kind&&(this.noticksopt=!0);let r={nminor:0,nmiddle:0,nmajor:0,func:this.func};if(r.minor=r.middle=r.major=this.produceTicks(this.nticks),t){let t=r.major,e=1e-5*(this.scale_max-this.scale_min);return t[0]>this.scale_min+e&&t.unshift(this.scale_min),t[t.length-1]<this.scale_max-e&&t.push(this.scale_max),t}if(this.nticks2>1&&(!this.log||10===this.logbase)){r.minor=r.middle=this.produceTicks(r.major.length,this.nticks2);let t=Math.abs(this.func.range()[1]-this.func.range()[0]);r.middle.length<=r.major.length||r.middle.length>t/3.5?r.minor=r.middle=r.major:this.nticks3>1&&!this.log&&(r.minor=this.produceTicks(r.middle.length,this.nticks3),(r.minor.length<=r.middle.length||r.minor.length>t/1.7)&&(r.minor=r.middle))}if(r.reset=function(){this.nminor=this.nmiddle=this.nmajor=0},r.next=function(t){return!(this.nminor>=this.minor.length)&&(this.tick=this.minor[this.nminor++],this.grpos=this.func(this.tick),t&&(this.grpos=Math.round(this.grpos)),this.kind=3,this.nmiddle<this.middle.length&&Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))<1&&(this.nmiddle++,this.kind=2),this.nmajor<this.major.length&&Math.abs(this.grpos-this.func(this.major[this.nmajor]))<1&&(this.nmajor++,this.kind=1),!0)},r.last_major=function(){return 1===this.kind&&this.nmajor==this.major.length},r.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])},this.order=0,this.ndig=0,"normal"==this.kind&&!this.log&&r.major.length>0){let t=0,i=0,s=!1;if(!e){let e=Math.max(Math.abs(r.major[0]),Math.abs(r.major[r.major.length-1])),n=Math.min(Math.abs(r.major[0]),Math.abs(r.major[r.major.length-1])),a=e>0?3*Math.round(Math.log10(e)/3):0,o=n>0?3*Math.round(Math.log10(n)/3):0;s=e<2e4,(e||n)&&(t=Math.max(a,o)+3,i=Math.min(a,o)-3)}let a=0,o=this.ndig,l=1e10;for(let e=i;e<=t;e+=3){if(s&&3===e)continue;this.order=e,this.ndig=0;let t=[],i=0,n=0;for(;i<r.major.length;){let e=this.format(r.major[i],!0);if(t.indexOf(e)<0)t.push(e),n+=e.length,i++;else{if(++this.ndig>11)break;t=[],i=0,n=0}}!e&&this.ndig<4&&(n-=2*r.major.length+3),n<l&&(l=n,a=this.order,o=this.ndig)}this.order=a,this.ndig=o,n&&(this.order&&console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable"),this.ndig&&console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required"),this.ndig=0,this.order=0)}return r}isCenteredLabels(){return"labels"===this.kind||"log"!==this.kind&&this.v7EvalAttr("labels_center",!1)}processLabelsMove(t,e){if(this.optionUnlab||!this.axis_g)return!1;let i=this.axis_g.select(".axis_labels");if(!i||1!=i.size())return!1;if("start"==t){let t=i.node().getBBox();return i.append("rect").classed("zoom",!0).attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height).style("cursor","move"),this.vertical?this.drag_pos0=e[0]:this.drag_pos0=e[1],!0}let n=i.property("fix_offset");if(this.vertical?(n+=Math.round(e[0]-this.drag_pos0),i.attr("transform",`translate(${n})`)):(n+=Math.round(e[1]-this.drag_pos0),i.attr("transform",`translate(0,${n})`)),n||i.attr("transform",null),"stop"==t&&(i.select("rect.zoom").remove(),delete this.drag_pos0,n!=i.property("fix_offset"))){i.property("fix_offset",n);let t=i.property("side")||1;this.labelsOffset=n/(this.vertical?-t:t),this.changeAxisAttr(1,"labels_offset",this.labelsOffset/this.scaling_size)}return!0}addTitleDrag(t,e){if(!m.MoveResize||l())return;let i,n,r,s,a,o,h=null,c=Ki().subject(Object);c.on("start",(e=>{e.sourceEvent.preventDefault(),e.sourceEvent.stopPropagation();let l=t.node().getBBox(),c=this.vertical?l.height:l.width;r=i=t.property("shift_x"),s=n=t.property("shift_y"),o="center"==this.titlePos?1:"left"==this.titlePos?0:2,a=[0,this.gr_range/2,this.gr_range];let d=this.vertical?-c:c,u=this.isReverseAxis()?2:0;"middle"==this.title_align?(a[u]+=d/2,a[2-u]-=d/2):"begin"==this.title_align^this.isTitleRotated()?(a[1]-=d/2,a[2-u]-=d):(a[u]+=d,a[1]+=d/2),a[o]=this.vertical?n:i,h=t.append("rect").classed("zoom",!0).attr("x",l.x).attr("y",l.y).attr("width",l.width).attr("height",l.height).style("cursor","move")})).on("drag",(e=>{if(!h)return;e.sourceEvent.preventDefault(),e.sourceEvent.stopPropagation(),i+=e.dx,n+=e.dy;let l,c,d=this.vertical?n:i,u=0;for(let t=1;t<3;++t)Math.abs(d-a[t])<Math.abs(d-a[u])&&(u=t);this.vertical?(l=i,c=a[u]):(l=a[u],c=n),r=l,s=c,o=u,t.attr("transform","translate("+Math.round(r)+","+Math.round(s)+")")})).on("end",(i=>{if(!h)return;i.sourceEvent.preventDefault(),i.sourceEvent.stopPropagation();let n=t.property("basepos")||0;t.property("shift_x",r).property("shift_y",s),this.titleOffset=(this.vertical?n-r:s-n)*e,this.titlePos=1==o?"center":0==o?"left":"right",this.changeAxisAttr(0,"title_position",this.titlePos,"title_offset",this.titleOffset/this.scaling_size),h.remove(),h=null})),t.style("cursor","move").call(c)}isInsideGrRange(t,e,i){return e||(e=0),void 0===i&&(i=e),this.gr_range<0?t>=this.gr_range-i&&t<=e:t>=-e&&t<=this.gr_range+i}getGrRange(t){return t||(t=0),this.gr_range<0?this.gr_range-t:this.gr_range+t}isReverseAxis(){return!this.vertical!=this.getGrRange()>0}drawMainLine(t){let e="";if(this.endingSize&&this.endingStyle){let t=this.gr_range>0?-this.endingSize:this.endingSize,i=Math.round(.7*t);t=Math.round(t),e=this.vertical?"l"+i+","+t+"M0,"+this.gr_range+"l"+-i+","+t:"l"+t+","+i+"M"+this.gr_range+",0l"+t+","+-i}t.append("svg:path").attr("d","M0,0"+(this.vertical?"v":"h")+this.gr_range+e).call(this.lineatt.func).style("fill",e?"none":null)}drawTicks(t,e,i){i&&(this.ticks=[]),this.handle.reset();let n="",r=0,s=0,a=0;for("both"==this.ticksSide&&(e=1,r=1);this.handle.next(!0);){let t=Math.round(this.ticksSize/4),o=0;this.handle.kind<3&&(t=Math.round(this.ticksSize/2));let l=this.handle.grpos-this.axis_shift;(!this.startingSize&&!this.endingSize||this.isInsideGrRange(l,-Math.abs(this.startingSize),-Math.abs(this.endingSize)))&&(1==this.handle.kind&&("labels"!=this.kind&&null===this.format(this.handle.tick,!0)||(t=this.ticksSize),i&&this.ticks.push(l)),r>0?o=-t:e<0?(o=-t,t=0):o=0,0==n.length?n=this.vertical?"M"+t+","+l:"M"+l+","+-t:n+=this.vertical?"m"+(t-a)+","+(l-s):"m"+(l-s)+","+(a-t),n+=this.vertical?"h"+(o-t):"v"+(t-o),s=l,a=o)}n&&t.append("svg:path").attr("d",n).style("stroke",this.ticksColor||this.lineatt.color).style("stroke-width",this.ticksWidth&&1!=this.ticksWidth?this.ticksWidth:null);let o=Math.round(.25*this.ticksSize),l=Math.round(1.25*this.ticksSize);return{"-1":e>0||r?l:o,1:e<0||r?l:o}}drawLabels(t,e,i){let n=this.isCenteredLabels(),r=!1,s=1,a=0,o=!1,l=t.append("svg:g").attr("class","axis_labels").property("side",e),h=this.handle.lbl_pos||this.handle.major,c=0,d=0;function u(t){c=Math.max(c,this.result_width),d=Math.max(d,this.result_height);let i=this.result_width;if(i&&(!t.vertical&&!r||t.vertical&&r)&&!t.log){let t=.45*this.gap_before+.45*this.gap_after;this.gap_before?this.gap_after||(t=.9*this.gap_before):t=.9*this.gap_after,s=Math.min(s,t/i)}s>1e-4&&s<.8&&!t.vertical&&!r&&a>5&&e>0&&(o=!0);let n=s*(o?3:1);n>1e-4&&n<1&&t.scaleTextDrawing(1/n,l)}this.labelsFont=this.v7EvalFont("labels",{size:.03}),this.labelsFont.roundAngle(180),this.labelsFont.angle&&(this.labelsFont.angle=270,r=!0);let f=0,m=Math.round((this.vertical?-e:e)*this.labelsOffset),p=Math.round((this.vertical?-e:e)*i[e]);m&&l.attr("transform",this.vertical?`translate(${m})`:`translate(0,${m})`),l.property("fix_offset",m),this.startTextDrawing(this.labelsFont,"font",l);for(let t=0;t<h.length;++t){let i=this.format(h[t],!0);if(null===i)continue;let o=Math.round(this.func(h[t])),c={text:i,latex:1,draw_g:l};if(c.gap_before=t>0?Math.abs(Math.round(o-this.func(h[t-1]))):0,c.gap_after=t<h.length-1?Math.abs(Math.round(this.func(h[t+1])-o)):0,n){let t=c.gap_after||c.gap_before;if(o=Math.round(o-(this.vertical?.5*t:-.5*t)),!this.isInsideGrRange(o,5))continue}if(a=Math.max(a,i.length),o-=this.axis_shift,!this.startingSize&&!this.endingSize||this.isInsideGrRange(o,-Math.abs(this.startingSize),-Math.abs(this.endingSize))){if(this.vertical?(c.x=p,c.y=o,c.align=r?e<0?23:20:e<0?12:32):(c.x=o,c.y=p,c.align=r?e<0?12:32:e<0?20:23),c.post_process=u,this.drawText(c),f&&o!=f&&(this.vertical&&!r||!this.vertical&&r)){let t=Math.abs(o-f);s=Math.min(s,.9*t/this.labelsFont.size)}f=o}}return this.order&&this.drawText({x:this.vertical?5*e:this.getGrRange(5),y:this.has_obstacle?p:this.vertical?this.getGrRange(3):-3*e,align:this.vertical?e<0?30:10:this.has_obstacle^e<0?13:10,latex:1,text:"#times"+this.formatExp(10,this.order),draw_g:l}),this.finishTextDrawing(l).then((()=>{if(o&&l.selectAll("text").each((function(){let t=Ii(this),e=t.attr("transform");t.attr("transform",e+" rotate(25)").style("text-anchor","start")})),this.vertical)i[e]+=Math.round(r?1.2*d:c+.4*this.labelsFont.size)-e*m;else{let t=o?c*Math.sin(25/180*Math.PI)+d*(Math.cos(25/180*Math.PI)+.2):0;i[e]+=Math.round(Math.max(r?c+.4*this.labelsFont.size:1.2*d,1.2*this.labelsFont.size,t))+m}return i}))}addZoomingRect(t,e,i){if(m.Zooming&&!this.disable_zooming&&!l()){let n=Math.max(i[e],10),r=this.vertical?"v"+this.gr_range+"h"+-e*n+"v"+-this.gr_range:"h"+this.gr_range+"v"+e*n+"h"+-this.gr_range;t.append("svg:path").attr("d","M0,0"+r+"z").attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair")}}isTitleRotated(){return this.titleFont&&this.titleFont.angle!=(this.vertical?270:0)}drawTitle(t,e,i){if(!this.fTitle)return Promise.resolve(this);let n=t.append("svg:g").attr("class","axis_title"),r=this.v7EvalAttr("title_position","right"),s="center"==r,a="left"==r,o=0,l=0,h=0;this.titleFont=this.v7EvalFont("title",{size:.03},this.getPadPainter().getPadHeight()),this.titleFont.roundAngle(180,this.vertical?270:0),this.titleOffset=this.v7EvalLength("title_offset",this.scaling_size,0),this.titlePos=r;let c=this.isTitleRotated();return this.startTextDrawing(this.titleFont,"font",n),this.title_align=s?"middle":a^(this.isReverseAxis()||c)?"begin":"end",this.vertical?(h=Math.round(-e*i[e]),o=h+Math.round(-e*this.titleOffset),l=Math.round(s?this.gr_range/2:a?0:this.gr_range),this.drawText({align:[this.title_align,e<0^c?"top":"bottom"],text:this.fTitle,draw_g:n})):(o=Math.round(s?this.gr_range/2:a?0:this.gr_range),h=Math.round(e*i[e]),l=h+Math.round(e*this.titleOffset),this.drawText({align:[this.title_align,e>0^c?"top":"bottom"],text:this.fTitle,draw_g:n})),n.attr("transform","translate("+o+","+l+")").property("basepos",h).property("shift_x",o).property("shift_y",l),this.addTitleDrag(n,e),this.finishTextDrawing(n)}extractDrawAttributes(){this.createv7AttLine("line_"),this.endingStyle=this.v7EvalAttr("ending_style",""),this.endingSize=Math.round(this.v7EvalLength("ending_size",this.scaling_size,this.endingStyle?.02:0)),this.startingSize=Math.round(this.v7EvalLength("starting_size",this.scaling_size,0)),this.ticksSize=this.v7EvalLength("ticks_size",this.scaling_size,.02),this.ticksSide=this.v7EvalAttr("ticks_side","normal"),this.ticksColor=this.v7EvalColor("ticks_color",""),this.ticksWidth=this.v7EvalAttr("ticks_width",1),this.labelsOffset=this.v7EvalLength("labels_offset",this.scaling_size,0),this.optionUnlab=this.v7EvalAttr("labels_hide",!1),this.fTitle=this.v7EvalAttr("title_value",""),this.max_tick_size&&this.ticksSize>this.max_tick_size&&(this.ticksSize=this.max_tick_size)}drawAxis(t,e,i){let n=t,r=this.getPadPainter().getPadRect();void 0===i&&(i=1),this.standalone||(n=t.select("."+this.name+"_container"),n.empty()?n=t.append("svg:g").attr("class",this.name+"_container"):n.selectAll("*").remove()),n.attr("transform",e||null),this.scaling_size=this.vertical?r.width:r.height,this.extractDrawAttributes(),this.axis_g=n,this.side=i,"invert"==this.ticksSide&&(i=-i),this.standalone&&this.drawMainLine(n);this.handle=this.createTicks(!1,!1,!1,!1);let s=this.drawTicks(n,i,!0);return(this.optionUnlab?Promise.resolve(s):this.drawLabels(n,i,s)).then((t=>(this.addZoomingRect(n,this.standalone?i:this.side,t),this.drawTitle(n,i,t))))}setAfterDrawHandler(t){this._afterDrawAgain=t}drawAxisAgain(){if(!this.axis_g||!this.side)return;this.axis_g.selectAll("*").remove(),this.extractDrawAttributes();let t=this.side;"invert"==this.ticksSide&&(t=-t),this.standalone&&this.drawMainLine(this.axis_g);let e=this.drawTicks(this.axis_g,t,!1);return(this.optionUnlab?Promise.resolve(e):this.drawLabels(this.axis_g,t,e)).then((e=>(this.addZoomingRect(this.axis_g,this.standalone?t:this.side,e),this.drawTitle(this.axis_g,t,e)))).then((()=>{"function"==typeof this._afterDrawAgain&&this._afterDrawAgain()}))}drawAxisOtherPlace(t,e,i,n){let r=t.select("."+this.name+"_container2");r.empty()?r=t.append("svg:g").attr("class",this.name+"_container2"):r.selectAll("*").remove(),r.attr("transform",e||null),"invert"==this.ticksSide&&(i=-i);let s=this.drawTicks(r,i,!1);return(this.optionUnlab||n?Promise.resolve(s):this.drawLabels(r,i,s)).then((t=>(this.addZoomingRect(r,i,t),!0)))}zoomStandalone(t,e){this.changeAxisAttr(1,"zoomMin",t,"zoomMax",e)}redraw(){let t=this.getObject(),e=this.getPadPainter(),i=e.getCoordinate(t.fPos),n=e.getPadLength(t.fVertical,t.fLength),r=this.v7EvalAttr("reverse",!1),s=t.fLabels.length,a=s>0?0:this.v7EvalAttr("min",0),o=s>0?s:this.v7EvalAttr("max",100);t.fVertical&&(n-=e.getPadHeight());let h=this.v7EvalAttr("zoomMin"),c=this.v7EvalAttr("zoomMax");h===c&&(h=a,c=o),this.configureAxis("axis",a,o,h,c,t.fVertical,void 0,n,{reverse:r,labels:s>0}),this.createG(),this.standalone=!0;let d=this.drawAxis(this.draw_g,`translate(${i.x},${i.y})`);return l()?d:d.then((()=>{m.ContextMenu&&this.draw_g.on("contextmenu",(t=>{t.stopPropagation(),t.preventDefault(),vv(t,this).then((t=>{t.add("header:RAxisDrawable"),t.add("Unzoom",(()=>this.zoomStandalone())),this.fillAxisContextMenu(t,""),t.show()}))})),Mv(this,{x:i.x,y:i.y,width:this.vertical?10:n,height:this.vertical?n:10,only_move:!0,redraw:t=>this.positionChanged(t)}),this.draw_g.on("dblclick",(()=>this.zoomStandalone())),m.ZoomWheel&&this.draw_g.on("wheel",(t=>{t.stopPropagation(),t.preventDefault();let e=qi(t,this.draw_g.node()),i=this.vertical?1-e[1]/n:e[0]/n,r=this.analyzeWheelEvent(t,i);r.changed&&this.zoomStandalone(r.min,r.max)}))}))}positionChanged(t){let e=this.getObject(),i=this.getPadPainter().getPadRect(),n=t.x/i.width,r=1-t.y/i.height;e.fPos.fHoriz.fArr=[n],e.fPos.fVert.fArr=[r],this.submitCanvExec(`SetPos({${n.toFixed(4)},${r.toFixed(4)}})`)}changeAxisAttr(t){let e={},i=1;for(;i<arguments.length-1;)this.v7AttrChange(e,arguments[i],arguments[i+1]),this.v7SetAttr(arguments[i],arguments[i+1]),i+=2;this.v7SendAttrChanges(e,!1),1===t?this.standalone?this.redraw():this.drawAxisAgain():t&&this.redrawPad()}changeAxisLog(t){"labels"!=this.kind&&"time"!=this.kind&&("toggle"===t&&(t=this.log?0:10),t=parseFloat(t),Number.isFinite(t)&&this.changeAxisAttr(2,"log",t,"symlog",0))}fillAxisContextMenu(t,e){return e&&t.add("Unzoom",(()=>this.getFramePainter().unzoom(e))),t.add("sub:Log scale",(()=>this.changeAxisLog("toggle"))),t.addchk(!this.log&&!this.symlog,"linear",0,(t=>this.changeAxisLog(t))),t.addchk(this.log&&!this.symlog&&10==this.logbase,"log10",(()=>this.changeAxisLog(10))),t.addchk(this.log&&!this.symlog&&2==this.logbase,"log2",(()=>this.changeAxisLog(2))),t.addchk(this.log&&!this.symlog&&Math.abs(this.logbase-Math.exp(1))<.1,"ln",(()=>this.changeAxisLog(Math.exp(1)))),t.addchk(!this.log&&this.symlog,"symlog",0,(()=>t.input("set symlog constant",this.symlog||10,"float").then((t=>this.changeAxisAttr(2,"symlog",t))))),t.add("endsub:"),t.add("Divisions",(()=>t.input("Set axis devisions",this.v7EvalAttr("ndiv",508),"int").then((t=>this.changeAxisAttr(2,"ndiv",t))))),t.add("sub:Ticks"),t.addRColorMenu("color",this.ticksColor,(t=>this.changeAxisAttr(1,"ticks_color",t))),t.addSizeMenu("size",0,.05,.01,this.ticksSize/this.scaling_size,(t=>this.changeAxisAttr(1,"ticks_size",t))),t.addSelectMenu("side",["normal","invert","both"],this.ticksSide,(t=>this.changeAxisAttr(1,"ticks_side",t))),t.add("endsub:"),!this.optionUnlab&&this.labelsFont&&(t.add("sub:Labels"),t.addSizeMenu("offset",-.05,.05,.01,this.labelsOffset/this.scaling_size,(t=>this.changeAxisAttr(1,"labels_offset",t))),t.addRAttrTextItems(this.labelsFont,{noangle:1,noalign:1},(t=>this.changeAxisAttr(1,"labels_"+t.name,t.value))),t.addchk(this.labelsFont.angle,"rotate",(t=>this.changeAxisAttr(1,"labels_angle",t?180:0))),t.add("endsub:")),t.add("sub:Title",(()=>t.input("Enter axis title",this.fTitle).then((t=>this.changeAxisAttr(1,"title_value",t))))),this.fTitle&&(t.addSizeMenu("offset",-.05,.05,.01,this.titleOffset/this.scaling_size,(t=>this.changeAxisAttr(1,"title_offset",t))),t.addSelectMenu("position",["left","center","right"],this.titlePos,(t=>this.changeAxisAttr(1,"title_position",t))),t.addchk(this.isTitleRotated(),"rotate",(t=>this.changeAxisAttr(1,"title_angle",t?180:0))),t.addRAttrTextItems(this.titleFont,{noangle:1,noalign:1},(t=>this.changeAxisAttr(1,"title_"+t.name,t.value)))),t.add("endsub:"),!0}}class oS extends sS{constructor(t,e){super(t,e,"","frame"),this.mode3d=!1,this.xmin=this.xmax=0,this.ymin=this.ymax=0,this.axes_drawn=!1,this.keys_handler=null,this.projection=0,this.v7_frame=!0}getFramePainter(){return this}is_root6(){return!1}setFrameActive(t){this.enabledKeys=!(!t||!m.HandleKeys),this.control&&(this.control.enableKeys=this.enabledKeys)}setLastEventPos(t){this.fLastEventPnt=t}getLastEventPos(){return this.fLastEventPnt}updateAttributes(t){if(void 0===this.fX1NDC||t&&!this.modified_NDC){let t=this.getPadPainter().getPadRect();this.fX1NDC=this.v7EvalLength("margins_left",t.width,m.FrameNDC.fX1NDC)/t.width,this.fY1NDC=this.v7EvalLength("margins_bottom",t.height,m.FrameNDC.fY1NDC)/t.height,this.fX2NDC=1-this.v7EvalLength("margins_right",t.width,1-m.FrameNDC.fX2NDC)/t.width,this.fY2NDC=1-this.v7EvalLength("margins_top",t.height,1-m.FrameNDC.fY2NDC)/t.height}this.fillatt||this.createv7AttFill(),this.createv7AttLine("border_")}getProjectionFunc(){switch(this.projection){case 1:return(t,e)=>{const i=Math.PI/180,n=t/2*i,r=e*i,s=Math.sqrt(2),a=2*s/Math.PI,o=Math.cos(r),l=Math.sqrt(1+o*Math.cos(n));return{x:o*Math.sin(n)*2*s/l/a/i,y:Math.sin(r)*s/l/a/i}};case 2:return(t,e)=>({x:t,y:Math.log(Math.tan((Math.PI/2+e/180*Math.PI)/2))});case 3:return(t,e)=>({x:t*Math.cos(e/180*Math.PI),y:e});case 4:return(t,e)=>({x:t*(2*Math.cos(2*e/180*Math.PI/3)-1),y:180*Math.sin(e/180*Math.PI/3)})}}recalculateRange(t){this.projection=t||0,2==this.projection&&(this.scale_ymin<=-90||this.scale_ymax>=90)&&(console.warn("Mercator Projection","Latitude out of range",this.scale_ymin,this.scale_ymax),this.projection=0);let e=this.getProjectionFunc();if(!e)return;let i=[e(this.scale_xmin,this.scale_ymin),e(this.scale_xmin,this.scale_ymax),e(this.scale_xmax,this.scale_ymax),e(this.scale_xmax,this.scale_ymin)];this.scale_xmin<0&&this.scale_xmax>0&&(i.push(e(0,this.scale_ymin)),i.push(e(0,this.scale_ymax))),this.scale_ymin<0&&this.scale_ymax>0&&(i.push(e(this.scale_xmin,0)),i.push(e(this.scale_xmax,0))),this.original_xmin=this.scale_xmin,this.original_xmax=this.scale_xmax,this.original_ymin=this.scale_ymin,this.original_ymax=this.scale_ymax,this.scale_xmin=this.scale_xmax=i[0].x,this.scale_ymin=this.scale_ymax=i[0].y;for(let t=1;t<i.length;++t)this.scale_xmin=Math.min(this.scale_xmin,i[t].x),this.scale_xmax=Math.max(this.scale_xmax,i[t].x),this.scale_ymin=Math.min(this.scale_ymin,i[t].y),this.scale_ymax=Math.max(this.scale_ymax,i[t].y)}drawGrids(){let t=this.getFrameSvg().select(".grid_layer");t.selectAll(".xgrid").remove(),t.selectAll(".ygrid").remove();let e=this.getFrameHeight(),i=this.getFrameWidth(),n=this.v7EvalAttr("gridX",!1),r=this.v7EvalAttr("gridY",!1),s=Xl(p.fGridStyle),a=p.fGridColor>0?this.getColor(p.fGridColor):"black";if(this.x_handle&&(this.x_handle.draw_grid=n),this.x_handle&&this.x_handle.draw_grid){let n="";for(let t=0;t<this.x_handle.ticks.length;++t)this.swap_xy?n+="M0,"+(e+this.x_handle.ticks[t])+"h"+i:n+="M"+this.x_handle.ticks[t]+",0v"+e;n.length>0&&t.append("svg:path").attr("class","xgrid").attr("d",n).style("stroke",a).style("stroke-width",p.fGridWidth).style("stroke-dasharray",s)}if(this.y_handle&&(this.y_handle.draw_grid=r),this.y_handle&&this.y_handle.draw_grid){let n="";for(let t=0;t<this.y_handle.ticks.length;++t)this.swap_xy?n+="M"+this.y_handle.ticks[t]+",0v"+e:n+="M0,"+(e+this.y_handle.ticks[t])+"h"+i;n.length>0&&t.append("svg:path").attr("class","ygrid").attr("d",n).style("stroke",a).style("stroke-width",p.fGridWidth).style("stroke-dasharray",s)}}axisAsText(t,e){let i=this[t+"_handle"];return i?i.axisAsText(e,m[t.toUpperCase()+"ValuesFormat"]):e.toPrecision(4)}_setAxisRange(t,e,i){let n=t+"min",r=t+"max";if(this[n]!=this[r])return;let s=this.v7EvalAttr(t+"_min"),a=this.v7EvalAttr(t+"_max");void 0!==s&&(e=s),void 0!==a&&(i=a),e<i&&(this[n]=e,this[r]=i);let o="zoom_"+t+"min",l="zoom_"+t+"max";this[o]!=this[l]||this.zoomChangedInteractive(t)||(s=this.v7EvalAttr(t+"_zoomMin"),a=this.v7EvalAttr(t+"_zoomMax"),void 0===s&&void 0===a||(this[o]=void 0===s?this[n]:s,this[l]=void 0===a?this[r]:a))}setAxesRanges(t,e,i,n,r,s,a,o,l){this.axes_drawn||(this.xaxis=t,this._setAxisRange("x",e,i),this.yaxis=n,this._setAxisRange("y",r,s),this.zaxis=a,this._setAxisRange("z",o,l))}setAxes2Ranges(t,e,i,n,r,s,a,o){t&&(this.x2axis=e,this._setAxisRange("x2",i,n)),r&&(this.y2axis=s,this._setAxisRange("y2",a,o))}createXY(t){if(this.self_drawaxes)return;this.cleanXY(),t||(t={}),this.v6axes=!0,this.swap_xy=t.swap_xy||!1,this.reverse_x=t.reverse_x||!1,this.reverse_y=t.reverse_y||!1,this.logx=this.v7EvalAttr("x_log",0),this.logy=this.v7EvalAttr("y_log",0);let e=this.getFrameWidth(),i=this.getFrameHeight();if(this.scale_xmin=this.xmin,this.scale_xmax=this.xmax,this.scale_ymin=this.ymin,this.scale_ymax=this.ymax,t.extra_y_space){(this.swap_xy?this.logx:this.logy)&&this.scale_ymax>0?this.scale_ymax=Math.exp(1.1*Math.log(this.scale_ymax)):this.scale_ymax+=.1*(this.scale_ymax-this.scale_ymin)}this.zoom_ymin!=this.zoom_ymax||t.zoom_ymin==t.zoom_ymax||this.zoomChangedInteractive("y")||(this.zoom_ymin=t.zoom_ymin,this.zoom_ymax=t.zoom_ymax),this.zoom_xmin!=this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax),this.zoom_ymin!=this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax);let n=this.xaxis,r=this.yaxis;n&&"TAxis"==n._typename||(n=k("TAxis")),r&&"TAxis"==r._typename||(r=k("TAxis")),this.x_handle=new Dy(this.getDom(),n,!0),this.x_handle.setPadName(this.getPadName()),this.x_handle.optionUnlab=this.v7EvalAttr("x_labels_hide",!1),this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,this.scale_xmax,this.swap_xy,this.swap_xy?[0,i]:[0,e],{reverse:this.reverse_x,log:this.swap_xy?this.logy:this.logx,symlog:this.swap_xy?t.symlog_y:t.symlog_x,logcheckmin:this.swap_xy,logminfactor:1e-4}),this.x_handle.assignFrameMembers(this,"x"),this.y_handle=new Dy(this.getDom(),r,!0),this.y_handle.setPadName(this.getPadName()),this.y_handle.optionUnlab=this.v7EvalAttr("y_labels_hide",!1),this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!this.swap_xy,this.swap_xy?[0,e]:[0,i],{reverse:this.reverse_y,log:this.swap_xy?this.logx:this.logy,symlog:this.swap_xy?t.symlog_x:t.symlog_y,logcheckmin:t.ndim<2||this.swap_xy,log_min_nz:t.ymin_nz&&t.ymin_nz<.01*this.ymax?.3*t.ymin_nz:0,logminfactor:3e-4}),this.y_handle.assignFrameMembers(this,"y")}hasDrawnAxes(t,e){return!t&&!e&&this.axes_drawn}drawAxes(){if(this.axes_drawn||this.xmin==this.xmax||this.ymin==this.ymax)return Promise.resolve(this.axes_drawn);let t=this.v7EvalAttr("ticksX",1),e=this.v7EvalAttr("ticksY",1),i=1,n=1;this.v7EvalAttr("swapX",!1)&&(i=-1),this.v7EvalAttr("swapY",!1)&&(n=-1);let r=this.getFrameWidth(),s=this.getFrameHeight();this.v6axes||(this.cleanupAxes(),this.swap_xy=!1,this.zoom_xmin!=this.zoom_xmax?(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax):(this.scale_xmin=this.xmin,this.scale_xmax=this.xmax),this.zoom_ymin!=this.zoom_ymax?(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax):(this.scale_ymin=this.ymin,this.scale_ymax=this.ymax),this.recalculateRange(0),this.x_handle=new aS(this.getDom(),this,this.xaxis,"x_"),this.x_handle.setPadName(this.getPadName()),this.x_handle.snapid=this.snapid,this.x_handle.draw_swapside=i<0,this.x_handle.draw_ticks=t,this.y_handle=new aS(this.getDom(),this,this.yaxis,"y_"),this.y_handle.setPadName(this.getPadName()),this.y_handle.snapid=this.snapid,this.y_handle.draw_swapside=n<0,this.y_handle.draw_ticks=e,this.z_handle=new aS(this.getDom(),this,this.zaxis,"z_"),this.z_handle.setPadName(this.getPadName()),this.z_handle.snapid=this.snapid,this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,this.scale_xmax,!1,[0,r],r,{reverse:!1}),this.x_handle.assignFrameMembers(this,"x"),this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!0,[s,0],-s,{reverse:!1}),this.y_handle.assignFrameMembers(this,"y"),this.z_handle.configureZAxis("zaxis",this));let a=this.getFrameSvg().select(".axis_layer");this.x_handle.has_obstacle=!1;let o,l=this.swap_xy?this.y_handle:this.x_handle,h=this.swap_xy?this.x_handle:this.y_handle,c=this.getPadPainter();if(c&&c._fast_drawing)o=Promise.resolve(!0);else if(this.v6axes){let i=!1,n=!1,c=!1;l.disable_ticks=t<=0,h.disable_ticks=e<=0;let d=l.drawAxis(a,r,s,l.invert_side?void 0:`translate(0,${s})`,t>1?-s:0,n,void 0,!1),u=h.drawAxis(a,r,s,h.invert_side?`translate(${r})`:void 0,e>1?r:0,c,h.invert_side?0:this._frame_x,i);o=Promise.all([d,u]).then((()=>this.drawGrids()))}else{let c=[];t>0&&c.push(l.drawAxis(a,i>0?`translate(0,${s})`:"",i)),e>0&&c.push(h.drawAxis(a,n>0?`translate(0,${s})`:`translate(${r},${s})`,n)),o=Promise.all(c).then((()=>(c=[],t>1&&c.push(l.drawAxisOtherPlace(a,i<0?`translate(0,${s})`:"",-i,2==t)),e>1&&c.push(h.drawAxisOtherPlace(a,n<0?`translate(0,${s})`:`translate(${r},${s})`,-n,2==e)),Promise.all(c)))).then((()=>this.drawGrids()))}return o.then((()=>(this.axes_drawn=!0,!0)))}drawAxes2(t,e){let i,n,r=this.getFrameWidth(),s=this.getFrameHeight(),a=this.getFrameSvg().select(".axis_layer");return t&&(this.zoom_x2min!=this.zoom_x2max?(this.scale_x2min=this.zoom_x2min,this.scale_x2max=this.zoom_x2max):(this.scale_x2min=this.x2min,this.scale_x2max=this.x2max),this.x2_handle=new aS(this.getDom(),this,this.x2axis,"x2_"),this.x2_handle.setPadName(this.getPadName()),this.x2_handle.snapid=this.snapid,this.x2_handle.configureAxis("x2axis",this.x2min,this.x2max,this.scale_x2min,this.scale_x2max,!1,[0,r],r,{reverse:!1}),this.x2_handle.assignFrameMembers(this,"x2"),i=this.x2_handle.drawAxis(a,"",-1)),e&&(this.zoom_y2min!=this.zoom_y2max?(this.scale_y2min=this.zoom_y2min,this.scale_y2max=this.zoom_y2max):(this.scale_y2min=this.y2min,this.scale_y2max=this.y2max),this.y2_handle=new aS(this.getDom(),this,this.y2axis,"y2_"),this.y2_handle.setPadName(this.getPadName()),this.y2_handle.snapid=this.snapid,this.y2_handle.configureAxis("y2axis",this.y2min,this.y2max,this.scale_y2min,this.scale_y2max,!0,[s,0],-s,{reverse:!1}),this.y2_handle.assignFrameMembers(this,"y2"),n=this.y2_handle.drawAxis(a,`translate(${r},${s})`,-1)),Promise.all([i,n])}getGrFuncs(t,e){let i=t&&this.grx2,n=e&&this.gry2;return i||n?{use_x2:i,grx:i?this.grx2:this.grx,x_handle:i?this.x2_handle:this.x_handle,logx:i?this.x2_handle.log:this.x_handle.log,scale_xmin:i?this.scale_x2min:this.scale_xmin,scale_xmax:i?this.scale_x2max:this.scale_xmax,use_y2:n,gry:n?this.gry2:this.gry,y_handle:n?this.y2_handle:this.y_handle,logy:n?this.y2_handle.log:this.y_handle.log,scale_ymin:n?this.scale_y2min:this.scale_ymin,scale_ymax:n?this.scale_y2max:this.scale_ymax,swap_xy:this.swap_xy,fp:this,revertAxis:function(t,e){return"x"==t&&this.use_x2&&(t="x2"),"y"==t&&this.use_y2&&(t="y2"),this.fp.revertAxis(t,e)},axisAsText:function(t,e){return"x"==t&&this.use_x2&&(t="x2"),"y"==t&&this.use_y2&&(t="y2"),this.fp.axisAsText(t,e)}}:this}sizeChanged(){let t={};this.v7AttrChange(t,"margins_left",this.fX1NDC),this.v7AttrChange(t,"margins_bottom",this.fY1NDC),this.v7AttrChange(t,"margins_right",1-this.fX2NDC),this.v7AttrChange(t,"margins_top",1-this.fY2NDC),this.v7SendAttrChanges(t,!1),this.redrawPad()}cleanXY(){let t=(t,e)=>{this[t]&&(this[t].cleanup(),delete this[t]),delete this[e]};t("x_handle","grx"),t("y_handle","gry"),t("z_handle","grz"),t("x2_handle","grx2"),t("y2_handle","gry2"),delete this.v6axes}cleanupAxes(){this.cleanXY(),this.draw_g&&(this.draw_g.select(".grid_layer").selectAll("*").remove(),this.draw_g.select(".axis_layer").selectAll("*").remove()),this.axes_drawn=!1}cleanFrameDrawings(){"function"==typeof this.create3DScene&&this.create3DScene(-1),this.cleanupAxes();let t=t=>{this[t+"min"]=this[t+"max"]=0,this["zoom_"+t+"min"]=this["zoom_"+t+"max"]=0,this["scale_"+t+"min"]=this["scale_"+t+"max"]=0};t("x"),t("y"),t("z"),t("x2"),t("y2"),this.draw_g&&(this.draw_g.select(".main_layer").selectAll("*").remove(),this.draw_g.select(".upper_layer").selectAll("*").remove())}cleanup(){this.cleanFrameDrawings(),this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null)),this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null),delete this.enabledKeys,delete this.self_drawaxes,delete this.xaxis,delete this.yaxis,delete this.zaxis,delete this.x2axis,delete this.y2axis,delete this.draw_g,delete this._click_handler,delete this._dblclick_handler;let t=this.getPadPainter();t&&t.frame_painter_ref===this&&delete t.frame_painter_ref,super.cleanup()}redraw(){let t=this.getPadPainter();t&&(t.frame_painter_ref=this),this.updateAttributes();let e,i,n,r=t?t.getPadRect():{width:10,height:10},s=Math.round(r.width*this.fX1NDC),a=Math.round(r.width*(this.fX2NDC-this.fX1NDC)),o=Math.round(r.height*(1-this.fY2NDC)),h=Math.round(r.height*(this.fY2NDC-this.fY1NDC)),c=!1,d=!1;if(t&&t.options&&(t.options.RotateFrame&&(c=!0),t.options.FixFrame&&(d=!0)),c){e=`rotate(-90,${s},${o}) translate(${s-h},${o})`;let t=a;a=h,h=t}else e=`translate(${s},${o})`;if(this._frame_x=s,this._frame_y=o,this._frame_width=a,this._frame_height=h,this._frame_rotate=c,this._frame_fixpos=d,this.mode3d)return this;this.draw_g=this.getFrameSvg(),this.draw_g.empty()?(this.draw_g=this.getLayerSvg("primitives_layer").append("svg:g").attr("class","root_frame"),l()||this.draw_g.append("svg:title").text(""),i=this.draw_g.append("svg:rect"),this.draw_g.append("svg:g").attr("class","grid_layer"),n=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden"),this.draw_g.append("svg:g").attr("class","axis_layer"),this.draw_g.append("svg:g").attr("class","upper_layer")):(i=this.draw_g.select("rect"),n=this.draw_g.select(".main_layer")),this.axes_drawn=!1,this.draw_g.attr("transform",e),i.attr("x",0).attr("y",0).attr("width",a).attr("height",h).attr("rx",this.lineatt.rx||null).attr("ry",this.lineatt.ry||null).call(this.fillatt.func).call(this.lineatt.func),n.attr("width",a).attr("height",h).attr("viewBox",`0 0 ${a} ${h}`);let u=Promise.resolve(!0);return this.v7EvalAttr("drawAxes")&&(this.self_drawaxes=!0,this.setAxesRanges(),u=this.drawAxes().then((()=>this.addInteractivity()))),u.then((()=>(l()||(i.style("pointer-events","visibleFill"),Sv.assign(this),this.addBasicInteractivity()),this)))}getFrameWidth(){return this._frame_width||0}getFrameHeight(){return this._frame_height||0}getFrameRect(){return{x:this._frame_x||0,y:this._frame_y||0,width:this.getFrameWidth(),height:this.getFrameHeight(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}}getHistPalette(){return this.getPadPainter().getHistPalette()}configureUserClickHandler(t){this._click_handler=t&&"function"==typeof t?t:null}configureUserDblclickHandler(t){this._dblclick_handler=t&&"function"==typeof t?t:null}zoom(t,e,i,n,r,s){if(this.projection)return Promise.resolve(!1);"x"===t?(t=e,e=i,i=void 0):"y"===t?(n=i,i=e,t=e=void 0):"z"===t&&(r=e,s=i,t=e=i=void 0);let a=t!==e,o=i!==n,l=r!==s,h=!1,c=!1,d=!1;if(a){let i=0;t<=this.xmin&&(t=this.xmin,i++),e>=this.xmax&&(e=this.xmax,i++),2===i&&(a=!1,h=!0)}else h=t===e&&0===t;if(o){let t=0;i<=this.ymin&&(i=this.ymin,t++),n>=this.ymax&&(n=this.ymax,t++),2===t&&(o=!1,c=!0)}else c=i===n&&0===i;if(l){let t=0;r<=this.zmin&&(r=this.zmin,t++),s>=this.zmax&&(s=this.zmax,t++),2===t&&(l=!1,d=!0)}else d=r===s&&0===r;let u=!1,f="",m="",p="",g=!1,_={_typename:"ROOT::Experimental::RFrame::RUserRanges",values:[0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1]};const x=(h,c)=>{(c||"function"==typeof h.canZoomInside)&&(g=!0,a&&(c||h.canZoomInside("x",t,e))&&(this.zoom_xmin=t,this.zoom_xmax=e,u=!0,f="0",a=!1,_.values[0]=t,_.values[1]=e,_.flags[0]=_.flags[1]=!0),o&&(c||h.canZoomInside("y",i,n))&&(this.zoom_ymin=i,this.zoom_ymax=n,u=!0,m="1",o=!1,_.values[2]=i,_.values[3]=n,_.flags[2]=_.flags[3]=!0),l&&(c||h.canZoomInside("z",r,s))&&(this.zoom_zmin=r,this.zoom_zmax=s,u=!0,p="2",l=!1,_.values[4]=r,_.values[5]=s,_.flags[4]=_.flags[5]=!0))};return(a||o||l)&&this.forEachPainter((t=>x(t))),!g&&this.self_drawaxes&&x(null,!0),(h||c||d)&&(h&&(this.zoom_xmin!==this.zoom_xmax&&(u=!0,f="0"),this.zoom_xmin=this.zoom_xmax=0,_.values[0]=_.values[1]=-1),c&&(this.zoom_ymin!==this.zoom_ymax&&(u=!0,m="1"),this.zoom_ymin=this.zoom_ymax=0,_.values[2]=_.values[3]=-1),d&&(this.zoom_zmin!==this.zoom_zmax&&(u=!0,p="2"),this.zoom_zmin=this.zoom_zmax=0,_.values[4]=_.values[5]=-1)),u?(this.v7NormalMode()&&this.v7SubmitRequest("zoom",{_typename:"ROOT::Experimental::RFrame::RZoomRequest",ranges:_}),this.interactiveRedraw("pad","zoom"+f+m+p).then((()=>!0))):Promise.resolve(!1)}zoomSingle(t,e,i){let n=["x","y","z","x2","y2"].indexOf(t);if(this.projection||!this[t+"_handle"]||n<0)return Promise.resolve(!1);let r=e!==i,s=!1;if(r){let n=0;e<=this[t+"min"]&&(e=this[t+"min"],n++),i>=this[t+"max"]&&(i=this[t+"max"],n++),2===n&&(r=!1,s=!0)}else s=e===i&&0===e;let a=!1,o=!1,l={_typename:"ROOT::Experimental::RFrame::RUserRanges",values:[0,0,0,0,0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]},h=(s,h)=>{(h||"function"==typeof s.canZoomInside)&&(o=!0,r&&(h||s.canZoomInside(t[0],e,i))&&(this["zoom_"+t+"min"]=e,this["zoom_"+t+"max"]=i,a=!0,r=!1,l.values[2*n]=e,l.values[2*n+1]=i,l.flags[2*n]=l.flags[2*n+1]=!0))};return r&&this.forEachPainter((t=>h(t))),!o&&this.self_drawaxes&&h(null,!0),s&&(this["zoom_"+t+"min"]!==this["zoom_"+t+"max"]&&(a=!0),this["zoom_"+t+"min"]=this["zoom_"+t+"max"]=0,l.values[2*n]=l.values[2*n+1]=-1),a?(this.v7NormalMode()&&this.v7SubmitRequest("zoom",{_typename:"ROOT::Experimental::RFrame::RZoomRequest",ranges:l}),this.interactiveRedraw("pad","zoom"+n).then((()=>!0))):Promise.resolve(!1)}isAxisZoomed(t){return this["zoom_"+t+"min"]!==this["zoom_"+t+"max"]}unzoom(t,e,i){return"all"==t?this.unzoom("x2").then((()=>this.unzoom("y2"))).then((()=>this.unzoom("xyz"))):"x2"==t||"y2"==t?this.zoomSingle(t,0,0).then((e=>(e&&this.zoomChangedInteractive(t,"unzoom"),e))):(void 0===t?t=e=i=!0:"string"==typeof t&&(i=t.indexOf("z")>=0,e=t.indexOf("y")>=0,t=t.indexOf("x")>=0),this.zoom(t?0:void 0,t?0:void 0,e?0:void 0,e?0:void 0,i?0:void 0,i?0:void 0).then((n=>(n&&t&&this.zoomChangedInteractive("x","unzoom"),n&&e&&this.zoomChangedInteractive("y","unzoom"),n&&i&&this.zoomChangedInteractive("z","unzoom"),n))))}zoomChangedInteractive(t,e){if("reset"==t)return void(this.zoom_changed_x=this.zoom_changed_y=this.zoom_changed_z=void 0);if(!t||"any"==t)return this.zoom_changed_x||this.zoom_changed_y||this.zoom_changed_z;if("x"!==t&&"y"!==t&&"z"!==t)return;let i="zoom_changed_"+t;if(void 0===e)return this[i];"unzoom"!==e?e&&(this[i]=!0):this[i]?delete this[i]:this[i]=!0}fillObjectOfflineMenu(t,e){"x"!=e&&"y"!=e||t.add("Unzoom",(()=>this.unzoom(e)))}changeFrameAttr(t,e){let i={};this.v7AttrChange(i,t,e),this.v7SetAttr(t,e),this.v7SendAttrChanges(i,!1),this.redrawPad()}fillContextMenu(t,e){if("x"==e||"y"==e||"x2"==e||"y2"==e){let i=this[e+"_handle"];return!!i&&(t.add("header: "+e.toUpperCase()+" axis"),i.fillAxisContextMenu(t,e))}let i=0==t.size();return i?t.add("header:Frame"):t.add("separator"),this.zoom_xmin!==this.zoom_xmax&&t.add("Unzoom X",(()=>this.unzoom("x"))),this.zoom_ymin!==this.zoom_ymax&&t.add("Unzoom Y",(()=>this.unzoom("y"))),this.zoom_zmin!==this.zoom_zmax&&t.add("Unzoom Z",(()=>this.unzoom("z"))),this.zoom_x2min!==this.zoom_x2max&&t.add("Unzoom X2",(()=>this.unzoom("x2"))),this.zoom_y2min!==this.zoom_y2max&&t.add("Unzoom Y2",(()=>this.unzoom("y2"))),t.add("Unzoom all",(()=>this.unzoom("all"))),t.add("separator"),t.addchk(this.isTooltipAllowed(),"Show tooltips",(()=>this.setTooltipAllowed("toggle"))),this.x_handle&&t.addchk(this.x_handle.draw_grid,"Grid x",(t=>this.changeFrameAttr("gridX",t))),this.y_handle&&t.addchk(this.y_handle.draw_grid,"Grid y",(t=>this.changeFrameAttr("gridY",t))),this.x_handle&&!this.x2_handle&&t.addchk(this.x_handle.draw_swapside,"Swap x",(t=>this.changeFrameAttr("swapX",t))),this.y_handle&&!this.y2_handle&&t.addchk(this.y_handle.draw_swapside,"Swap y",(t=>this.changeFrameAttr("swapY",t))),this.x_handle&&!this.x2_handle&&(t.add("sub:Ticks x"),t.addchk(0==this.x_handle.draw_ticks,"off",(()=>this.changeFrameAttr("ticksX",0))),t.addchk(1==this.x_handle.draw_ticks,"normal",(()=>this.changeFrameAttr("ticksX",1))),t.addchk(2==this.x_handle.draw_ticks,"ticks on both sides",(()=>this.changeFrameAttr("ticksX",2))),t.addchk(3==this.x_handle.draw_ticks,"labels on both sides",(()=>this.changeFrameAttr("ticksX",3))),t.add("endsub:")),this.y_handle&&!this.y2_handle&&(t.add("sub:Ticks y"),t.addchk(0==this.y_handle.draw_ticks,"off",(()=>this.changeFrameAttr("ticksY",0))),t.addchk(1==this.y_handle.draw_ticks,"normal",(()=>this.changeFrameAttr("ticksY",1))),t.addchk(2==this.y_handle.draw_ticks,"ticks on both sides",(()=>this.changeFrameAttr("ticksY",2))),t.addchk(3==this.y_handle.draw_ticks,"labels on both sides",(()=>this.changeFrameAttr("ticksY",3))),t.add("endsub:")),t.addAttributesMenu(this,i?"":"Frame "),t.add("separator"),t.add("Save as frame.png",(()=>this.getPadPainter().saveAs("png","frame","frame.png"))),t.add("Save as frame.svg",(()=>this.getPadPainter().saveAs("svg","frame","frame.svg"))),!0}revertAxis(t,e){let i=this[t+"_handle"];return i?i.revertPoint(e):0}showAxisStatus(t,e){let i=t,n=qi(e,this.getFrameSvg().node()),r="x"==t?0:1;this.swap_xy&&(r=1-r);let s=this.revertAxis(t,n[r]);this.showObjectStatus(i,"axis",t+" : "+this.axisAsText(t,s),Math.round(n[0])+","+Math.round(n[1]))}addKeysHandler(){l()||(Sv.assign(this),this.addFrameKeysHandler())}addInteractivity(t){return!(!l()&&(m.Zooming||m.ContextMenu))||(Sv.assign(this),this.addFrameInteractivity(t))}setRootPadRange(){}toggleAxisLog(t){let e=this[t+"_handle"];e&&e.changeAxisLog("toggle")}}class lS extends sS{constructor(t,e,i){super(t,e,"","pad"),this.pad=e,this.iscan=i,this.this_pad_name="",this.iscan||null===e||(e.fObjectID?this.this_pad_name="pad"+e.fObjectID:this.this_pad_name="ppp"+s.id_counter++),this.painters=[],this.has_canvas=!0,this.forEachPainter=this.forEachPainterInPad}isRoot6(){return!1}svg_this_pad(){return this.getPadSvg(this.this_pad_name)}getMainPainter(){return this.main_painter_ref||null}setMainPainter(t,e){this.main_painter_ref&&!e||(this.main_painter_ref=t)}cleanup(){this._doing_draw&&console.error("pad drawing is not completed when cleanup is called"),this.painters.forEach((t=>t.cleanup()));let t=this.svg_this_pad();t.empty()||(t.property("pad_painter",null),this.iscan||t.remove()),delete this.main_painter_ref,delete this.frame_painter_ref,delete this.pads_cache,delete this._pad_x,delete this._pad_y,delete this._pad_width,delete this._pad_height,delete this._doing_draw,delete this._dfltRFont,this.painters=[],this.pad=null,this.draw_object=null,this.pad_frame=null,this.this_pad_name=void 0,this.has_canvas=!1,Ql({pp:this,active:!1}),super.cleanup()}getFramePainter(){return this.frame_painter_ref}getPadWidth(){return this._pad_width||0}getPadHeight(){return this._pad_height||0}getPadRect(){return{x:this._pad_x||0,y:this._pad_y||0,width:this.getPadWidth(),height:this.getPadHeight()}}getFrameRect(){let t=this.getFramePainter();if(t)return t.getFrameRect();let e=this.getPadWidth(),i=this.getPadHeight(),n={};return n.szx=Math.round(.5*e),n.szy=Math.round(.5*i),n.width=2*n.szx,n.height=2*n.szy,n.x=Math.round(e/2-n.szx),n.y=Math.round(i/2-n.szy),n.hint_delta_x=n.szx,n.hint_delta_y=n.szy,n.transform=`translate(${n.x},${n.y})`,n}getRootPad(t){return void 0!==t&&t?null:this.pad}cleanPrimitives(t){if(t&&"function"==typeof t)for(let e=this.painters.length-1;e>=0;--e)t(this.painters[e])&&(this.painters[e].cleanup(),this.painters.splice(e,1))}findPainterFor(t,e,i){return this.painters.find((n=>{let r=n.getObject();if(r){if(t&&r===t)return!0;if((e||i)&&!(e&&r.fName!==e||i&&r._typename!==i))return!0}}))}getHistPalette(){let t=this.findPainterFor(void 0,void 0,"ROOT::Experimental::RPaletteDrawable");return t?t.getHistPalette():(this.fDfltPalette||(this.fDfltPalette={_typename:"ROOT::Experimental::RPalette",fColors:[{fOrdinal:0,fColor:{fColor:"rgb(53, 42, 135)"}},{fOrdinal:.125,fColor:{fColor:"rgb(15, 92, 221)"}},{fOrdinal:.25,fColor:{fColor:"rgb(20, 129, 214)"}},{fOrdinal:.375,fColor:{fColor:"rgb(6, 164, 202)"}},{fOrdinal:.5,fColor:{fColor:"rgb(46, 183, 164)"}},{fOrdinal:.625,fColor:{fColor:"rgb(135, 191, 119)"}},{fOrdinal:.75,fColor:{fColor:"rgb(209, 187, 89)"}},{fOrdinal:.875,fColor:{fColor:"rgb(254, 200, 50)"}},{fOrdinal:1,fColor:{fColor:"rgb(249, 251, 14)"}}],fInterpolate:!0,fNormalized:!0},b(this.fDfltPalette,"ROOT::Experimental::RPalette")),this.fDfltPalette)}getNumPainters(){return this.painters.length}forEachPainterInPad(t,e){e||(e="all"),"objects"!=e&&t(this);for(let i=0;i<this.painters.length;++i){let n=this.painters[i];"function"==typeof n.forEachPainterInPad?"objects"!=e&&n.forEachPainterInPad(t,e):"pads"!=e&&t(n)}}registerForPadEvents(t){this.pad_events_receiver=t}producePadEvent(t,e,i,n,r){"select"==t&&"function"==typeof this.selectActivePad&&this.selectActivePad(e,i,n),this.pad_events_receiver&&this.pad_events_receiver({what:t,padpainter:e,painter:i,position:n,place:r})}selectObjectPainter(t,e,i){let n=this.iscan||!this.has_canvas,r=n?this:this.getCanvPainter();void 0===t&&(t=this),e&&!n&&(e=nl(this.svg_this_pad(),e)),Ql({pp:this,active:!0}),r.producePadEvent("select",this,t,e,i)}createCanvasSvg(t,e){let i,n,r=null,s=null,a=null;if(t>0){if(this._fixed_size)return t>1;if(s=this.getCanvSvg(),s.empty())return!1;if(r=s.property("height_factor"),a=this.testMainResize(t,null,r),!a.changed)return!1;l()||(i=this.getLayerSvg("btns_layer",this.this_pad_name)),n=s.select(".canvas_fillrect")}else{let t=this.selectDom();"static"==t.style("position")&&t.style("position","relative"),s=t.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("current_pad","").property("redraw_by_resize",!1),this.setTopPainter(),l()||this.online_canvas||s.append("svg:title").text("ROOT canvas"),n=s.append("svg:path").attr("class","canvas_fillrect"),l()||n.style("pointer-events","visibleFill").on("dblclick",(t=>this.enlargePad(t))).on("click",(()=>this.selectObjectPainter(this,null))).on("mouseenter",(()=>this.showObjectStatus())).on("contextmenu",m.ContextMenu?t=>this.padContextMenu(t):null),s.append("svg:g").attr("class","primitives_layer"),s.append("svg:g").attr("class","info_layer"),l()||(i=s.append("svg:g").attr("class","btns_layer").property("leftside","left"==m.ToolBarSide).property("vertical",m.ToolBarVert)),r=.66,this.pad&&this.pad.fWinSize[0]&&this.pad.fWinSize[1]&&(r=this.pad.fWinSize[1]/this.pad.fWinSize[0],(r<.1||r>10)&&(r=.66)),this._fixed_size?(t.style("overflow","auto"),a={width:this.pad.fWinSize[0],height:this.pad.fWinSize[1]},a.width&&a.height||(a=il(t))):a=this.testMainResize(2,e,r)}return this.createAttFill({pattern:1001,color:0}),a.width<=5||a.height<=5?(s.style("display","none"),console.warn("Hide canvas while geometry too small w=",a.width," h=",a.height),a.width=200,a.height=100):s.style("display",null),this._fixed_size?s.attr("x",0).attr("y",0).attr("width",a.width).attr("height",a.height).style("position","absolute"):s.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",0).style("top",0).style("right",0).style("bottom",0),s.attr("viewBox",`0 0 ${a.width} ${a.height}`).attr("preserveAspectRatio","none").property("height_factor",r).property("draw_x",0).property("draw_y",0).property("draw_width",a.width).property("draw_height",a.height),this._pad_x=0,this._pad_y=0,this._pad_width=a.width,this._pad_height=a.height,n.attr("d",`M0,0H${a.width}V${a.height}H0Z`).call(this.fillatt.func),this._fast_drawing=m.SmallPad&&(a.width<m.SmallPad.width||a.height<m.SmallPad.height),this.alignButtons&&i&&this.alignButtons(i,a.width,a.height),!0}enlargePad(t){t&&(t.preventDefault(),t.stopPropagation());let e=this.getCanvSvg(),i=e.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(i||this.hasObjectsToDraw()||this.painters))i?i===this.pad?(this.enlargeMain(!1),e.property("pad_enlarged",null)):console.error("missmatch with pad double click events"):(this.enlargeMain(!0,!0),e.property("pad_enlarged",this.pad));else{if(this._fixed_size)return;if(!this.enlargeMain("toggle"))return;"off"==this.enlargeMain("state")&&e.property("pad_enlarged",null)}let n=this._fast_drawing;this.checkResize(!0),this._fast_drawing!=n&&this.showPadButtons()}createPadSvg(t){if(!this.has_canvas)return this.createCanvasSvg(t?2:0),!0;let e=this.getPadSvg(this.pad_name),i=this.getCanvSvg(),n=e.property("draw_width"),r=e.property("draw_height"),s=i.property("pad_enlarged"),a=!0,o=n,h=r,c=0,d=0,u=null,p=null,g=null;return this.pad&&this.pad.fPos&&this.pad.fSize&&(c=Math.round(n*this.pad.fPos.fHoriz.fArr[0]),d=Math.round(r*this.pad.fPos.fVert.fArr[0]),o=Math.round(n*this.pad.fSize.fHoriz.fArr[0]),h=Math.round(r*this.pad.fSize.fVert.fArr[0])),s&&(a=!1,s===this.pad?a=!0:this.forEachPainterInPad((t=>{t.getObject()==s&&(a=!0)}),"pads"),a&&(o=n,h=r,c=d=0)),t?(u=this.svg_this_pad(),p=u.select(".root_pad_border"),l()||(g=this.getLayerSvg("btns_layer",this.this_pad_name))):(u=e.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this),l()||u.append("svg:title").text("ROOT subpad"),p=u.append("svg:path").attr("class","root_pad_border"),u.append("svg:g").attr("class","primitives_layer"),l()||(g=u.append("svg:g").attr("class","btns_layer").property("leftside","left"!=m.ToolBarSide).property("vertical",m.ToolBarVert)),m.ContextMenu&&p.on("contextmenu",(t=>this.padContextMenu(t))),l()||p.style("pointer-events","visibleFill").on("dblclick",(t=>this.enlargePad(t))).on("click",(()=>this.selectObjectPainter(this,null))).on("mouseenter",(()=>this.showObjectStatus()))),this.createAttFill({attr:this.pad}),this.createAttLine({attr:this.pad,color0:0==this.pad.fBorderMode?"none":""}),u.style("display",a?null:"none").attr("viewBox",`0 0 ${o} ${h}`).attr("preserveAspectRatio","none").attr("x",c).attr("y",d).attr("width",o).attr("height",h).property("draw_x",c).property("draw_y",d).property("draw_width",o).property("draw_height",h),this._pad_x=c,this._pad_y=d,this._pad_width=o,this._pad_height=h,p.attr("d",`M0,0H${o}V${h}H0Z`).call(this.fillatt.func).call(this.lineatt.func),this._fast_drawing=m.SmallPad&&(o<m.SmallPad.width||h<m.SmallPad.height),u.property("can3d")===f.Embed3D.Overlay&&this.selectDom().select(".draw3d_"+this.this_pad_name).style("display",a?"":"none"),this.alignButtons&&g&&this.alignButtons(g,o,h),a}hasObjectsToDraw(){let t=this.pad?this.pad.fPrimitives:null;return!(!t||!t.find((t=>"ROOT::Experimental::RPadDisplayItem"!=t._typename)))}syncDraw(t){let e={kind:t||"redraw"};return void 0===this._doing_draw?(this._doing_draw=[e],Promise.resolve(!0)):!(!0!==e.kind&&this._doing_draw.findIndex(((t,i)=>i>0&&t.kind==e.kind))>0)&&(this._doing_draw.push(e),new Promise((t=>{e.func=t})))}confirmDraw(){if(void 0===this._doing_draw)return console.warn("failure, should not happen");if(this._doing_draw.shift(),0==this._doing_draw.length)delete this._doing_draw;else{let t=this._doing_draw[0];t.func&&(t.func(),delete t.func)}}drawObject(t,e,i){return console.log("Not possible to draw object without loading of draw.mjs"),Promise.resolve(null)}drawPrimitives(t){if(void 0===t)return this.iscan&&(this._start_tm=(new Date).getTime()),this._num_primitives=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.length:0,this.syncDraw(!0).then((()=>this.drawPrimitives(0)));if(!this.pad||t>=this._num_primitives){if(this.confirmDraw(),this._start_tm){let t=(new Date).getTime()-this._start_tm;t>3e3&&console.log("Canvas drawing took "+(.001*t).toFixed(2)+"s"),delete this._start_tm}return Promise.resolve()}return this.drawObject(this.getDom(),this.pad.fPrimitives[t],"").then((e=>(e&&"object"==typeof e&&(e._primitive=!0),this.drawPrimitives(t+1))))}processPadTooltipEvent(t){let e=[],i=[];return null!==this.painters&&this.painters.forEach((t=>{"function"==typeof t.processTooltipEvent&&e.push(t)})),t&&(t.nproc=e.length),e.forEach((e=>{let n=e.processTooltipEvent(t);n||(n={user_info:null}),i.push(n),t&&t.painters&&(n.painter=e)})),i}fillContextMenu(t){this.iscan?t.add("header: RCanvas"):t.add("header: RPad"),t.addchk(this.isTooltipAllowed(),"Show tooltips",(()=>this.setTooltipAllowed("toggle"))),this._websocket||t.addAttributesMenu(this),t.add("separator"),"function"==typeof this.hasMenuBar&&"function"==typeof this.actiavteMenuBar&&t.addchk(this.hasMenuBar(),"Menu bar",(t=>this.actiavteMenuBar(t))),"function"==typeof this.hasEventStatus&&"function"==typeof this.activateStatusBar&&t.addchk(this.hasEventStatus(),"Event status",(()=>this.activateStatusBar("toggle"))),(this.enlargeMain()||this.has_canvas&&this.hasObjectsToDraw())&&t.addchk("on"==this.enlargeMain("state"),"Enlarge "+(this.iscan?"canvas":"pad"),(()=>this.enlargePad()));let e=this.this_pad_name;return e||(e=this.iscan?"canvas":"pad"),t.add("Save as "+e+".png",e+".png",(()=>this.saveAs("png",!1))),t.add("Save as "+e+".svg",e+".svg",(()=>this.saveAs("svg",!1))),!0}padContextMenu(t){if(t.stopPropagation){let e=qi(t,this.svg_this_pad().node());if(2==e.length&&e[0]>=0&&e[0]<10&&e[1]>=0&&e[1]<10)return;t.stopPropagation(),t.preventDefault();let i=this.getFramePainter();i&&i.setLastEventPos()}vv(t,this).then((t=>(this.fillContextMenu(t),this.fillObjectExecMenu(t)))).then((t=>t.show()))}redrawPad(t){let e=this.syncDraw(t);if(!1===e)return console.log("Prevent RPad redrawing"),Promise.resolve(!1);let i=!0,n=e=>{for(;e<this.painters.length;){let r=this.painters[e++],s=0;if((i||r.this_pad_name)&&(s=r.redraw(t)),q(s))return s.then((()=>n(e)))}return Promise.resolve(!0)};return e.then((()=>(this.iscan?this.createCanvasSvg(2):i=this.createPadSvg(!0),n(0)))).then((()=>{if(Jl()===this){let t=this.getCanvPainter();t&&t.producePadEvent("padredraw",this)}return this.confirmDraw(),!0}))}redraw(t){return this.redrawPad(t)}needRedrawByResize(){let t=this.svg_this_pad();if(!t.empty()&&t.property("can3d")===f.Embed3D.Overlay)return!0;for(let t=0;t<this.painters.length;++t)if("function"==typeof this.painters[t].needRedrawByResize&&this.painters[t].needRedrawByResize())return!0;return!1}checkCanvasResize(t,e){if(!this.iscan&&this.has_canvas)return!1;let i=this.syncDraw("canvas_resize");if(!1===i)return!1;!0!==t&&!1!==t||(e=t,t=null),t&&"object"==typeof t&&t.force&&(e=!0),e||(e=this.needRedrawByResize());let n=!1,r=t=>{if(!n||t>=this.painters.length)return this.confirmDraw(),n;let i=this.painters[t].redraw(e?"redraw":"resize");return q(i)||(i=Promise.resolve()),i.then((()=>r(t+1)))};return i.then((()=>(n=this.createCanvasSvg(e?2:1,t),r(0))))}updateObject(t){return!!t&&(this.pad.fStyle=t.fStyle,this.pad.fAttr=t.fAttr,this.iscan?(this.pad.fTitle=t.fTitle,this.pad.fWinSize=t.fWinSize):(this.pad.fPos=t.fPos,this.pad.fSize=t.fSize),!0)}addObjectPainter(t,e,i){t&&e&&e[i]&&void 0===t.snapid&&(this.painters.indexOf(t)<0&&this.painters.push(t),t.assignSnapId(e[i].fObjectID),t.rstyle||(t.rstyle=e[i].fStyle||this.rstyle))}extractTObjectProp(t){if(t.fColIndex&&t.fColValue){let e=this.root_colors||Rl();for(let i=0;i<t.fColIndex.length;++i)e[t.fColIndex[i]]=t.fColValue[i]}let e=new sS,i=t.fObject;e.assignObject(t),e.csstype=t.fCssType,e.rstyle=t.fStyle,t.fOption=e.v7EvalAttr("options","");const n=(t,n)=>{let r=e.v7EvalColor(n,"");r&&(i[t]=function(t,e){e||(e=Ol);let i=e.indexOf(t);return i>=0?i:(e.push(t),e.length-1)}(r,this.root_colors))};void 0!==i.fLineColor&&void 0!==i.fLineWidth&&void 0!==i.fLineStyle&&(n("fLineColor","line_color"),i.fLineWidth=e.v7EvalAttr("line_width",i.fLineWidth),i.fLineStyle=e.v7EvalAttr("line_style",i.fLineStyle)),void 0!==i.fFillColor&&void 0!==i.fFillStyle&&(n("fFillColor","fill_color"),i.fFillStyle=e.v7EvalAttr("fill_style",i.fFillStyle)),void 0!==i.fMarkerColor&&void 0!==i.fMarkerStyle&&void 0!==i.fMarkerSize&&(n("fMarkerColor","marker_color"),i.fMarkerStyle=e.v7EvalAttr("marker_style",i.fMarkerStyle),i.fMarkerSize=e.v7EvalAttr("marker_size",i.fMarkerSize)),void 0!==i.fTextColor&&void 0!==i.fTextAlign&&void 0!==i.fTextAngle&&void 0!==i.fTextSize&&(n("fTextColor","text_color"),i.fTextAlign=e.v7EvalAttr("text_align",i.fTextAlign),i.fTextAngle=e.v7EvalAttr("text_angle",i.fTextAngle),i.fTextSize=e.v7EvalAttr("text_size",i.fTextSize))}drawNextSnap(t,e){if(void 0===e&&(e=-1,this._snaps_map={},this._num_primitives=t?t.length:0,this._auto_color_cnt=0),delete this.next_rstyle,++e,!t||e>=t.length)return delete this._snaps_map,delete this._auto_color_cnt,Promise.resolve(this);let i=t[e],n=i.fObjectID,r=this._snaps_map[n],s=null;if(r?r++:r=1,this._snaps_map[n]=r,i.fDummy)return this.drawNextSnap(t,e);for(let t=0;t<this.painters.length;++t)if(this.painters[t].snapid===n&&0==--r){s=this.painters[t];break}if(s){if("ROOT::Experimental::RPadDisplayItem"==i._typename)return s.redrawPadSnap(i).then((i=>(this.addObjectPainter(i,t,e),this.drawNextSnap(t,e))));let n;return"ROOT::Experimental::TObjectDisplayItem"===i._typename&&this.extractTObjectProp(i),s.updateObject(i.fDrawable||i.fObject||i,i.fOption||"")&&(n=s.redraw()),q(n)||(n=Promise.resolve(!0)),n.then((()=>this.drawNextSnap(t,e)))}if("ROOT::Experimental::RPadDisplayItem"==i._typename){let n=i,r=new lS(this.getDom(),n,!1);r.decodeOptions(""),r.addToPadPrimitives(this.this_pad_name),r.assignSnapId(i.fObjectID),r.rstyle=i.fStyle,r.createPadSvg(),i.fPrimitives&&i.fPrimitives.length>0&&r.addPadButtons();let s=r.selectCurrentPad(r.this_pad_name);return r.drawNextSnap(i.fPrimitives).then((()=>(r.selectCurrentPad(s),this.drawNextSnap(t,e))))}if(this.next_rstyle=t[e].fStyle||this.rstyle,"ROOT::Experimental::TObjectDisplayItem"===i._typename){const n={kNone:0,kObject:1,kColors:4,kStyle:5,kPalette:6};if(i.fKind==n.kStyle)return Object.assign(p,i.fObject),this.drawNextSnap(t,e);if(i.fKind==n.kColors){let n=[],r=i.fObject.arr;for(let t=0;t<r.length;++t){let e=r[t].fString,i=e.indexOf("=");i>0&&(n[parseInt(e.slice(0,i))]=e.slice(i+1))}return this.root_colors=n,this.drawNextSnap(t,e)}if(i.fKind==n.kPalette){let n=i.fObject.arr,r=[];for(let t=0;t<n.length;++t)r[t]=n[t].fString;return this.custom_palette=new Il(r),this.drawNextSnap(t,e)}if(!this.getFramePainter())return this.drawObject(this.getDom(),{_typename:"TFrame",$dummy:!0},"").then((()=>this.drawNextSnap(t,e-1)));this.extractTObjectProp(i)}return this.drawObject(this.getDom(),i.fDrawable||i.fObject||i,i.fOption||"").then((i=>(this.addObjectPainter(i,t,e),this.drawNextSnap(t,e))))}findSnap(t,e){function i(i){return!(!i||"string"!=typeof i)&&(i==t||e&&i.length>t.length&&i.indexOf(t)==i.length-t.length)}if(i(this.snapid))return this;if(!this.painters)return null;for(let n=0;n<this.painters.length;++n){let r=this.painters[n];if(e||"function"!=typeof r.findSnap?i(r.snapid)||(r=null):r=r.findSnap(t),r)return r}return null}redrawPadSnap(t){if(!t||!t.fPrimitives)return Promise.resolve(this);if(this.iscan&&this._websocket&&t.fTitle&&!this.embed_canvas&&"undefined"!=typeof document&&(document.title=t.fTitle),void 0===this.snapid){this.assignSnapId(t.fObjectID),this.draw_object=t,this.pad=t,this.batch_mode&&this.iscan&&(this._fixed_size=!0);let e=this.selectDom().attr("id");return this.batch_mode||this.use_openui||this.brlayout||!e||"string"!=typeof e||(this.brlayout=new zv(e,null,this),this.brlayout.create(e,!0),this.setDom(this.brlayout.drawing_divid()),fv(this.brlayout)),this.createCanvasSvg(0),this.addPadButtons(!0),this.drawNextSnap(t.fPrimitives)}this.updateObject(t),this.iscan?this.createCanvasSvg(2):this.createPadSvg(!0);let e=!1,i=!1;for(let n=0;n<this.painters.length;++n){let r=this.painters[n];void 0!==r.snapid&&(t.fPrimitives.forEach((t=>{r&&t.fObjectID===r.snapid&&(r=null,e=!0)})),r&&(this.painters.splice(n--,1),r.cleanup(),i=!0))}if(i&&delete this.pads_cache,!e){let t=this.getFramePainter();t&&t.is_root6()&&(t=null);for(let e=0;e<this.painters.length;++e)t!==this.painters[e]&&this.painters[e].cleanup();this.painters=[],delete this.main_painter_ref,t&&(this.painters.push(t),t.cleanFrameDrawings(),t.redraw()),this.removePadButtons&&this.removePadButtons(),this.addPadButtons(!0)}let n=this.selectCurrentPad(this.this_pad_name);return this.drawNextSnap(t.fPrimitives).then((()=>{if(this.selectCurrentPad(n),Jl()===this){let t=this.getCanvPainter();t&&t.producePadEvent("padredraw",this)}return this}))}createImage(t){return"pdf"==t?Promise.resolve(btoa("dummy PDF file")):"png"==t||"jpeg"==t||"svg"==t?this.produceImage(!0,t).then((e=>{if(!e||"svg"==t)return e;let i=e.indexOf("base64,");return i>0?e.slice(i+7):""})):Promise.resolve("")}itemContextMenu(t){let e=this.svg_this_pad().node().getBoundingClientRect(),i={clientX:e.left+10,clientY:e.top+10};if("pad"==t)return setTimeout((()=>this.padContextMenu(i)),50);let n,r=null;switch(t){case"xaxis":case"yaxis":case"zaxis":r=this.getMainPainter(),n=t[0];break;case"frame":r=this.getFramePainter();break;default:{let e=parseInt(t);Number.isInteger(e)&&(r=this.painters[e])}}r&&"function"==typeof r.fillContextMenu&&vv(i,r).then((t=>{r.fillContextMenu(t,n)&&setTimeout((()=>t.show()),50)}))}saveAs(t,e,i){i||(0===(i=this.this_pad_name).length&&(i=this.iscan?"canvas":"pad"),i+="."+t),this.produceImage(e,t).then((e=>{let n=document.createElement("a");n.download=i,n.href="svg"!=t?e:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e),document.body.appendChild(n),n.addEventListener("click",(()=>n.parentNode.removeChild(n))),n.click()}))}produceImage(t,e){let i="frame"===t,n=i?this.getFrameSvg():t?this.getCanvSvg():this.svg_this_pad();if(n.empty())return Promise.resolve("");let r=t&&!i?this.getCanvPainter():this,a=[];function o(){for(let t=0;t<a.length;++t){let e=a[t];e.img&&e.img.remove();let i=e.prnt.select(".primitives_layer");e.foreign&&e.prnt.node().insertBefore(e.foreign.node(),i.node()),e.frame_node&&i.node().insertBefore(e.frame_node,e.frame_next),e.btns_node&&e.btns_prnt.insertBefore(e.btns_node,e.btns_next)}}i||r.forEachPainterInPad((t=>{let e={prnt:t.svg_this_pad()};a.push(e);let i=t.getLayerSvg("btns_layer",this.this_pad_name);e.btns_node=i.node(),e.btns_node&&(e.btns_prnt=e.btns_node.parentNode,e.btns_next=e.btns_node.nextSibling,i.remove());let n=t.getFramePainter();if(!n||"function"!=typeof n.render3D||"function"!=typeof n.access3dKind)return;let r=n.access3dKind();if(r!==f.Embed3D.Overlay&&r!==f.Embed3D.Embed)return;let s=n.getSizeFor3d(f.Embed3D.Embed),o=n.renderer.domElement;n.render3D(0);let l=o.toDataURL("image/png");r===f.Embed3D.Embed&&(e.foreign=e.prnt.select("."+s.clname),e.foreign.remove());let h=n.getFrameSvg();e.frame_node=h.node(),e.frame_node&&(e.frame_next=e.frame_node.nextSibling,h.remove()),e.img=e.prnt.insert("image",".primitives_layer").attr("x",s.x).attr("y",s.y).attr("width",o.width).attr("height",o.height).attr("href",l)}),"pads");let l=n.property("draw_width"),h=n.property("draw_height");if(i){let t=this.getFramePainter();l=t.getFrameWidth(),h=t.getFrameHeight()}let c='<svg width="'+l+'" height="'+h+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+n.node().innerHTML+"</svg>";if(s.processSvgWorkarounds&&(c=s.processSvgWorkarounds(c)),c=ll(c),"svg"==e)return o(),Promise.resolve(c);let d=new Image;return new Promise((t=>{var i;d.onload=function(){let i=document.createElement("canvas");i.width=d.width,i.height=d.height,i.getContext("2d").drawImage(d,0,0),o(),t(i.toDataURL("image/"+e))},d.onerror=function(e){console.log("IMAGE ERROR",e),o(),t(null)},d.src="data:image/svg+xml;base64,"+window.btoa((i='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+c,i=(i=encodeURIComponent(i)).replace(/%([0-9A-F]{2})/g,(function(t,e){let i=String.fromCharCode("0x"+e);return"%"===i?"%25":i})),decodeURIComponent(i)))}))}clickPadButton(t,e){if("CanvasSnapShot"==t)return this.saveAs("png",!0);if("enlargePad"==t)return this.enlargePad();if("PadSnapShot"==t)return this.saveAs("png",!1);if("PadContextMenus"==t){if(e&&(e.preventDefault(),e.stopPropagation()),bv())return;return void vv(e,this).then((t=>{t.add("header:Menus"),this.iscan?t.add("Canvas","pad",this.itemContextMenu):t.add("Pad","pad",this.itemContextMenu),this.getFramePainter()&&t.add("Frame","frame",this.itemContextMenu);let e=this.getMainPainter();if(e&&(t.add("X axis","xaxis",this.itemContextMenu),t.add("Y axis","yaxis",this.itemContextMenu),"function"==typeof e.getDimension&&e.getDimension()>1&&t.add("Z axis","zaxis",this.itemContextMenu)),this.painters&&this.painters.length>0){t.add("separator");let e=[];for(let i=0;i<this.painters.length;++i){let n=this.painters[i],r=n?n.getObject():null;if(!r||e.indexOf(r)>=0)continue;let s="_typename"in r?r._typename+"::":"";"fName"in r&&(s+=r.fName),0==s.length&&(s="item"+i),t.add(s,i,this.itemContextMenu)}}t.show()}))}let i=!1;for(let e=0;e<this.painters.length;++e){let n=this.painters[e];"function"==typeof n.clickPadButton&&n.clickPadButton(t),i||"function"!=typeof n.clickButton||(i=n.clickButton(t))}}addPadButton(t,e,i,n){if(!m.ToolBar||l()||this.batch_mode)return;this._buttons||(this._buttons=[]);for(let t=0;t<this._buttons.length;++t)if(this._buttons[t].funcname==i)return;if(this._buttons.push({btn:t,tooltip:e,funcname:i,keyname:n}),!(this.iscan||!this.has_canvas)&&0!=i.indexOf("Pad")&&"enlargePad"!==i){let n=this.getCanvPainter();n&&n!==this&&n.addPadButton(t,e,i)}}addPadButtons(t){this.addPadButton("camera","Create PNG",this.iscan?"CanvasSnapShot":"PadSnapShot","Ctrl PrintScreen"),m.ContextMenu&&this.addPadButton("question","Access context menus","PadContextMenus"),(!this.iscan&&this.has_canvas&&this.hasObjectsToDraw()||this.enlargeMain("verify"))&&this.addPadButton("circle","Enlarge canvas","enlargePad"),t&&this.brlayout&&(this.addPadButton("diamand","Toggle Ged","ToggleGed"),this.addPadButton("three_circles","Toggle Status","ToggleStatus"))}showPadButtons(){this._buttons&&(Lv.assign(this),this.showPadButtons())}getPadLength(t,e,i){let n,r,s=t?-1:1,a=(t,i)=>t<e.fArr.length?e.fArr[t]:i,o=()=>(n||(n=i?i.getFrameRect():this.getPadRect()),n);if(i){let e=a(2),n=t?"gry":"grx";void 0!==e&&i[n]&&(r=i[n](e))}void 0===r&&(r=t?o().height:0);let l=a(0,0);return r+=s*a(1,0),l&&(r+=s*(t?o().height:o().width)*l),Math.round(r)}getCoordinate(t,e){return{x:this.getPadLength(!1,t.fHoriz,e),y:this.getPadLength(!0,t.fVert,e)}}decodeOptions(t){let e=this.getObject();if(!e)return;let i=new sl(t);this.options||(this.options={}),Object.assign(this.options,{GlobalColors:!0,LocalColors:!1,IgnorePalette:!1,RotateFrame:!1,FixFrame:!1}),(i.check("NOCOLORS")||i.check("NOCOL"))&&(this.options.GlobalColors=this.options.LocalColors=!1),(i.check("LCOLORS")||i.check("LCOL"))&&(this.options.GlobalColors=!1,this.options.LocalColors=!0),(i.check("NOPALETTE")||i.check("NOPAL"))&&(this.options.IgnorePalette=!0),i.check("ROTATE")&&(this.options.RotateFrame=!0),i.check("FIXFRAME")&&(this.options.FixFrame=!0),i.check("WHITE")&&(e.fFillColor=0),i.check("LOGX")&&(e.fLogx=1),i.check("LOGY")&&(e.fLogy=1),i.check("LOGZ")&&(e.fLogz=1),i.check("LOG")&&(e.fLogx=e.fLogy=e.fLogz=1),i.check("GRIDX")&&(e.fGridx=1),i.check("GRIDY")&&(e.fGridy=1),i.check("GRID")&&(e.fGridx=e.fGridy=1),i.check("TICKX")&&(e.fTickx=1),i.check("TICKY")&&(e.fTicky=1),i.check("TICK")&&(e.fTickx=e.fTicky=1)}static draw(t,e,i){let n=new lS(t,e,!1);n.decodeOptions(i),n.getCanvSvg().empty()?(n.has_canvas=!1,n.this_pad_name="",n.setTopPainter()):n.addToPadPrimitives(n.pad_name),n.createPadSvg(),!n.matchObjectType("TPad")||n.has_canvas&&!n.hasObjectsToDraw()||n.addPadButtons();let r=n.has_canvas?n.selectCurrentPad(n.this_pad_name):void 0;return Ql({pp:n,active:!1}),n.drawPrimitives().then((()=>(n.showPadButtons(),n.selectCurrentPad(r),n)))}}class hS{constructor(t,e,i){this.path=t,this.connid=null,this.req=null,this.raw=e,this.args=i,this.nextRequest("","connect")}nextRequest(t,e){let i=this.path,n="buf",r=null;if("connect"===e)i+=this.raw?"?raw_connect":"?txt_connect",this.args&&(i+="&"+this.args),console.log("longpoll connect "+i+" raw = "+this.raw),this.connid="connect";else if("close"===e){if(null===this.connid||"close"===this.connid)return;i+="?connection="+this.connid+"&close",this.connid="close",n="text;sync"}else{if(null===this.connid||"number"!=typeof this.connid)return void(d.qt5||console.error("No connection"));i+="?connection="+this.connid,"dummy"===e&&(i+="&dummy")}t&&(this.raw?i+="&post="+btoa(t):(n="postbuf",r=t));let s=P(i,n,(function(t){if(this.handle.req===this&&(this.handle.req=null),null===t)return this.handle.processRequest(null);if(this.handle.raw){let e="",i=0,n=new Uint8Array(t),r=n.length;if(r<4)return d.qt5||console.error("longpoll got short message in raw mode "+r),this.handle.processRequest(null);for(;i<4;)e+=String.fromCharCode(n[i++]);if("txt:"!=e){for(e="";i<r&&":"!=String.fromCharCode(n[i]);)e+=String.fromCharCode(n[i++]);++i,r=i+parseInt(e.trim())}for(e="";i<r;)e+=String.fromCharCode(n[i++]);e&&("<<nope>>"==e?this.handle.processRequest(-1111):this.handle.processRequest(e)),r<n.length&&this.handle.processRequest(t,r)}else if("application/x-binary"==this.getResponseHeader("Content-Type")){let e=this.getResponseHeader("LongpollHeader");e&&this.handle.processRequest(e),this.handle.processRequest(t,0)}else{if(t&&"string"!=typeof t){let e="",i=new Uint8Array(t);for(let t=0;t<i.length;++t)e+=String.fromCharCode(i[t]);t=e}"<<nope>>"==t?this.handle.processRequest(-1111):this.handle.processRequest(t)}}),(function(){this.handle.processRequest(null,"error")}));s.handle=this,this.req||(this.req=s),s.send(r)}processRequest(t,e){if(null===t)return"function"==typeof this.onerror&&this.onerror("receive data with connid "+(this.connid||"---")),"error"==e&&"function"==typeof this.onclose&&this.onclose("force_close"),void(this.connid=null);-1111===t&&(t="");let i=5;if("connect"===this.connid){if(!t)return this.connid=null,void("function"==typeof this.onerror&&this.onerror("connection rejected"));this.connid=parseInt(t),i=100,console.log("Get new longpoll connection with id "+this.connid),"function"==typeof this.onopen&&this.onopen()}else{if("close"===this.connid)return void("function"==typeof this.onclose&&this.onclose());"function"==typeof this.onmessage&&t&&this.onmessage({data:t,offset:e})}this.req||setTimeout((()=>{this.req||this.nextRequest("","dummy")}),i)}send(t){this.nextRequest(t)}close(){this.nextRequest("","close")}}class cS{constructor(t){this.receiver=t,this.protocol=[],this.cnt=0,E("protocol.json","text").then((t=>this.getProtocol(t)))}getProtocol(t){t&&(this.protocol=JSON.parse(t),"function"==typeof this.onopen&&this.onopen(),this.nextOperation())}send(){"send"==this.protocol[this.cnt]&&(this.cnt++,setTimeout((()=>this.nextOperation()),10))}close(){}nextOperation(){if(this.wait_for_file)return;let t=this.protocol[this.cnt];t&&"send"!=t&&(this.wait_for_file=!0,this.cnt++,E(t,t.indexOf(".bin")>0?"buf":"text").then((t=>{this.wait_for_file=!1,t&&(this.receiver.provideData&&this.receiver.provideData(1,t,0),setTimeout((()=>this.nextOperation()),10))})))}}class dS{constructor(t,e){this.kind=t,this.state=0,this.credits=e||10,this.cansend=this.credits,this.ackn=this.credits}getUserArgs(t){return t&&"string"==typeof t?this.user_args&&"object"==typeof this.user_args?this.user_args[t]:void 0:this.user_args}setUserArgs(t){this.user_args=t}setReceiver(t){this.receiver=t}cleanup(){delete this.receiver,this.close(!0)}invokeReceiver(t,e,i,n){if(this.receiver&&"function"==typeof this.receiver[e]&&this.receiver[e](this,i,n),t&&this.channels){let t=Object.keys(this.channels);for(let r=0;r<t.length;++r)this.channels[t[r]].invokeReceiver(!1,e,i,n)}}provideData(t,e,i){if(this.wait_first_recv)return console.log("FIRST MESSAGE",t,e),delete this.wait_first_recv,this.invokeReceiver(!1,"onWebsocketOpened");if(t>1&&this.channels){const n=this.channels[t];if(n)return n.provideData(1,e,i)}const n=i&&i<0;if(!(n||this.msgqueue&&this.msgqueue.length))return this.invokeReceiver(!1,"onWebsocketMsg",e,i);this.msgqueue||(this.msgqueue=[]),n&&(i=void 0),this.msgqueue.push({ready:!0,msg:e,len:i})}reserveQueueItem(){this.msgqueue||(this.msgqueue=[]);let t={ready:!1,msg:null,len:0};return this.msgqueue.push(t),t}markQueueItemDone(t,e,i){t.ready=!0,t.msg=e,t.len=i,this.processQueue()}processQueue(){if(!this._loop_msgqueue&&this.msgqueue){for(this._loop_msgqueue=!0;this.msgqueue.length>0&&this.msgqueue[0].ready;){let t=this.msgqueue.shift();this.invokeReceiver(!1,"onWebsocketMsg",t.msg,t.len)}0==this.msgqueue.length&&delete this.msgqueue,delete this._loop_msgqueue}}close(t){if(this.master)return this.master.send("CLOSECH="+this.channelid,0),delete this.master.channels[this.channelid],void delete this.master;this.timerid&&(clearTimeout(this.timerid),delete this.timerid),this._websocket&&this.state>0&&(this.state=t?-1:0,this._websocket.onclose=null,this._websocket.close(),delete this._websocket)}canSend(t){return this.cansend>=(t||1)}getRelCanSend(){return this.credits?this.cansend/this.credits:1}send(t,e){if(this.master)return this.master.send(t,this.channelid);if(!this._websocket||this.state<=0)return!1;Number.isInteger(e)||(e=1),this.cansend<=0&&console.error("should be queued before sending cansend: "+this.cansend);let i=this.ackn+":"+this.cansend+":"+e+":";return this.ackn=0,this.cansend--,this._websocket.send(i+t),"websocket"!==this.kind&&"longpoll"!==this.kind||(this.timerid&&clearTimeout(this.timerid),this.timerid=setTimeout((()=>this.keepAlive()),1e4)),!0}inject(t,e,i){if(!i)return setTimeout(this.inject.bind(this,t,e,!0),0);if(void 0===e&&(e=1),Array.isArray(t)){for(let i=0;i<t.length;++i)this.provideData(e,"string"==typeof t[i]?t[i]:JSON.stringify(t[i]),-1);this.processQueue()}else t&&this.provideData(e,"string"==typeof t?t:JSON.stringify(t))}keepAlive(){delete this.timerid,this.send("KEEPALIVE",0)}createChannel(){if(this.master)return master.createChannel();let t=new dS("channel",this.credits);return t.wait_first_recv=!0,this.channels||(this.channels={},this.freechannelid=2),t.master=this,t.channelid=this.freechannelid++,this.channels[t.channelid]=t,t}getChannelId(){return this.channelid&&this.master?this.channelid:1}setHRef(t){this.href=t}getHRef(t){if(!t||!this.kind||!this.href)return this.href;let e=this.href;if(0==t.indexOf("../")){let i=e.lastIndexOf("/",e.length-2);e=e.slice(0,i)+t.slice(2)}else e+=t;return e}connect(t){this.close(),!t&&this.href&&(t=this.href);let e=0,i=this.key?"key="+this.key:"";this.token&&(i&&(i+="&"),i+="token="+this.token);const n=r=>{if(0!=this.state)return;r||console.log("try connect window again "+(new Date).toString()),this._websocket&&(this._websocket.close(),delete this._websocket),t||((t=window.location.href)&&t.indexOf("#")>0&&(t=t.slice(0,t.indexOf("#"))),t&&t.lastIndexOf("/")>0&&(t=t.slice(0,t.lastIndexOf("/")+1))),this.href=t,e++,r&&console.log("Opening web socket at "+t),e>2&&lv("Trying to connect "+t);let s=t;"file"==this.kind?(s+="root.filedump",this._websocket=new cS(this),console.log("configure protocol log "+s)):"websocket"===this.kind&&r?(s=s.replace("http://","ws://").replace("https://","wss://")+"root.websocket",i&&(s+="?"+i),console.log("configure websocket "+s),this._websocket=new WebSocket(s)):(s+="root.longpoll",console.log("configure longpoll "+s),this._websocket=new hS(s,"rawlongpoll"===this.kind,i)),this._websocket&&(this._websocket.onopen=()=>{e>2&&lv(),this.state=1;let t=this.key||"";this.send("READY="+t,0),this.invokeReceiver(!1,"onWebsocketOpened")},this._websocket.onmessage=t=>{let e=t.data;if(this.next_binary){let i=this.next_binary;if(delete this.next_binary,e instanceof Blob){let i=new FileReader,n=this.reserveQueueItem();i.onload=t=>this.markQueueItemDone(n,t.target.result,0),i.readAsArrayBuffer(e,t.offset||0)}else this.provideData(i,e,t.offset||0);return}if("string"!=typeof e)return console.log("unsupported message kind: "+typeof e);let i=e.indexOf(":"),n=parseInt(e.slice(0,i)),r=e.indexOf(":",i+1),s=e.indexOf(":",r+1),a=parseInt(e.slice(r+1,s));this.ackn++,this.cansend+=n,e=e.slice(s+1),0==a?(console.log("GET chid=0 message",e),"CLOSE"==e&&(this.close(!0),this.invokeReceiver(!0,"onWebsocketClosed"))):"$$binary$$"==e?this.next_binary=a:"$$nullbinary$$"==e?this.provideData(a,new ArrayBuffer(0),0):this.provideData(a,e),this.ackn>7&&this.send("READY",0)},this._websocket.onclose=t=>{delete this._websocket,(this.state>0||"force_close"===t)&&(console.log("websocket closed"),this.state=0,this.invokeReceiver(!0,"onWebsocketClosed"))},this._websocket.onerror=t=>{console.log(`websocket error ${t} state ${this.state}`),this.state>0&&(this.invokeReceiver(!0,"onWebsocketError",t),this.state=0)},l()||setTimeout(n,3e3))};n(!0)}}class uS extends lS{constructor(t,e){super(t,e,!0),this._websocket=null,this.tooltip_allowed=m.Tooltip,this.v7canvas=!0}cleanup(){delete this._websocket,delete this._submreq,this._changed_layout&&this.setLayoutKind("simple"),delete this._changed_layout,super.cleanup()}getLayoutKind(){let t=this.selectDom("origin");return(t.empty()?"":t.property("layout"))||"simple"}setLayoutKind(t,e){let i=this.selectDom("origin");i.empty()||(t||(t="simple"),i.property("layout",t),i.property("layout_selector","simple"!=t&&e?e:null),this._changed_layout="simple"!==t)}changeLayout(t,e){if(this.getLayoutKind()==t)return Promise.resolve(!0);let i=this.selectDom("origin"),n=i.select(".side_panel"),r=this.selectDom(),s=[];for(;r.node().firstChild;)s.push(r.node().removeChild(r.node().firstChild));if(n.empty()||th(n.node()),this.setLayoutKind("simple"),i.html(""),"simple"==t){r=i;for(let t=0;t<s.length;++t)r.node().appendChild(s[t]);this.setLayoutKind(t)}else{let a=new Ev(i.node(),t);null==e&&(e=0==t.indexOf("vert")?0:1),r=Ii(a.getGridFrame(e)),n=Ii(a.getGridFrame(1-e)),r.classed("central_panel",!0).style("position","relative"),n.classed("side_panel",!0).style("position","relative");for(let t=0;t<s.length;++t)r.node().appendChild(s[t]);this.setLayoutKind(t,".central_panel"),i.property("mdi",null)}return Kl(r.node()),Promise.resolve(!0)}toggleProjection(t){if(delete this.proj_painter,t&&(this.proj_painter=1),this.showUI5ProjectionArea)return this.showUI5ProjectionArea(t);let e,i="simple";switch(t){case"X":case"bottom":i="vert2_31",e=0;break;case"Y":case"left":i="horiz2_13",e=1;break;case"top":i="vert2_13",e=1;break;case"right":i="horiz2_31",e=0}return this.changeLayout(i,e)}drawProjection(){}drawInSidePanel(t,e){let i=this.selectDom("origin").select(".side_panel");return i.empty()?Promise.resolve(null):this.drawObject(i.node(),t,e)}testUI5(){return!!this.use_openui&&(console.warn("full ui5 should be used - not loaded yet? Please check!!"),!0)}showMessage(t){this.testUI5()||lv(t,7e3)}saveCanvasAsFile(t){let e=t.indexOf(".");this.createImage(t.slice(e+1)).then((e=>{console.log("save",t,e.length),this.sendWebsocket("SAVE:"+t+":"+e)}))}sendSaveCommand(t){this.sendWebsocket("PRODUCE:"+t)}sendWebsocket(t,e){this._websocket&&this._websocket.send(t,e)}closeWebsocket(t){this._websocket&&(this._websocket.close(t),this._websocket.cleanup(),delete this._websocket)}useWebsocket(t){this.closeWebsocket(),this._websocket=t,this._websocket.setReceiver(this),this._websocket.connect()}onWebsocketOpened(){}onWebsocketClosed(){this.embed_canvas||hv()}onWebsocketMsg(t,e){if(console.log("GET_MSG "+e.slice(0,30)),"CLOSE"==e)this.onWebsocketClosed(),this.closeWebsocket(!0);else if("SNAP:"==e.slice(0,5)){let i=(e=e.slice(5)).indexOf(":"),n=e.slice(0,i),r=w(e.slice(i+1));this.syncDraw(!0).then((()=>this.redrawPadSnap(r))).then((()=>{t.send("SNAPDONE:"+n),this.confirmDraw()}))}else if("JSON"==e.slice(0,4)){let t=w(e.slice(4));this.redrawObject(t)}else if("REPL_REQ:"==e.slice(0,9))this.processDrawableReply(e.slice(9));else if("CMD:"==e.slice(0,4)){let i=(e=e.slice(4)).indexOf(":"),n=e.slice(0,i),r=e.slice(i+1),s="REPLY:"+n+":";if("SVG"==r||"PNG"==r||"JPEG"==r)this.createImage(r.toLowerCase()).then((e=>t.send(s+e)));else if(0==r.indexOf("ADDPANEL:")){let e=r.slice(9);if(this.showUI5Panel){let i=new dS(t.kind);i.setReceiver({cpainter:this,onWebsocketOpened:function(){},onWebsocketMsg:function(e,i){let n=0==i.indexOf("SHOWPANEL:")?i.slice(10):"";this.cpainter.showUI5Panel(n,e).then((e=>t.send(s+(e?"true":"false"))))},onWebsocketClosed:function(){t.send(s+"false")},onWebsocketError:function(){t.send(s+"false")}});let n=t.href;if(0==e.indexOf("../")){let t=n.lastIndexOf("/",n.length-2);n=n.slice(0,t)+e.slice(2)}else n+=e;i.connect(n)}else t.send(s+"false")}else console.log("Unrecognized command "+r),t.send(s)}else if("DXPROJ:"==e.slice(0,7)||"DYPROJ:"==e.slice(0,7)){let t=e[1],i=w(e.slice(7));this.drawProjection(t,i)}else if("SHOW:"==e.slice(0,5)){let t=e.slice(5),i="1"==t[t.length-1];this.showSection(t.slice(0,t.length-2),i)}else console.log("unrecognized msg len:"+e.length+" msg:"+e.slice(0,20))}submitDrawableRequest(t,e,i,n){if(!(this._websocket&&e&&e._typename&&i.snapid&&"string"==typeof i.snapid))return null;if(t&&n){i._requests||(i._requests={});let n=i._requests[t];if(n){let r=(new Date).getTime();if(!n._tm||r-n._tm<5e3)return n._nextreq=e,!1;delete i._requests[t]}i._requests[t]=e}e.id=i.snapid,n?(this._nextreqid||(this._nextreqid=1),e.reqid=this._nextreqid++):e.reqid=0;let r=JSON.stringify(e);return e.reqid&&(e._kind=t,e._painter=i,e._method=n,e._tm=(new Date).getTime(),this._submreq||(this._submreq={}),this._submreq[e.reqid]=e),this.sendWebsocket("REQ:"+r),e}submitMenuRequest(t,e,i){return new Promise((n=>{this.submitDrawableRequest("",{_typename:"ROOT::Experimental::RDrawableMenuRequest",menukind:e||"",menureqid:i},t,n)}))}submitExec(t,e,i){if(console.log("SubmitExec",e,t.snapid,i),this._websocket){if(i){if("x"!=i&&"y"!=i&&"z"!=i)return console.log(`not recoginzed subelem ${i} in SubmitExec`);e=i+"axis#"+e}this.submitDrawableRequest("",{_typename:"ROOT::Experimental::RDrawableExecRequest",exec:e},t)}}processDrawableReply(t){let e=w(t);if(!e||!e.reqid||!this._submreq)return!1;let i=this._submreq[e.reqid];if(!i)return!1;delete this._submreq[e.reqid],i._painter&&i._kind&&i._painter._requests&&i._painter._requests[i._kind]===i&&delete i._painter._requests[i._kind],i._method&&i._method(e,i),i._nextreq&&!i._painter._requests[i._kind]&&this.submitDrawableRequest(i._kind,i._nextreq,i._painter,i._method)}showSection(t,e){switch(t){case"Menu":case"StatusBar":case"Editor":case"ToolBar":break;case"ToolTips":this.setTooltipAllowed(e)}return Promise.resolve(!0)}processChanges(t,e,i){if(this._websocket&&this._websocket.canSend(2)&&"string"==typeof t)switch(e||(e=this),t){case"sbits":console.log("Status bits in RCanvas are changed - that to do?");break;case"frame":case"zoom":console.log("Frame moved or zoom is changed - that to do?");break;case"pave_moved":console.log("TPave is moved inside RCanvas - that to do?");break;default:"exec:"==t.slice(0,5)&&e&&e.snapid?this.submitExec(e,t.slice(5),i):console.log("UNPROCESSED CHANGES",t)}}clickPadButton(t,e){return"ToggleGed"==t?this.activateGed(this,null,"toggle"):"ToggleStatus"==t?this.activateStatusBar("toggle"):void super.clickPadButton(t,e)}hasEventStatus(){return!this.testUI5()&&(!!this.brlayout&&this.brlayout.hasStatus())}activateStatusBar(t){this.testUI5()||(this.brlayout&&this.brlayout.createStatusLine(23,t),this.processChanges("sbits",this))}hasGed(){return!this.testUI5()&&(!!this.brlayout&&this.brlayout.hasContent())}removeGed(){this.testUI5()||(this.registerForPadEvents(null),this.ged_view&&(this.ged_view.getController().cleanupGed(),this.ged_view.destroy(),delete this.ged_view),this.brlayout&&this.brlayout.deleteContent(),this.processChanges("sbits",this))}activateGed(t,e,i){if(this.testUI5()||!this.brlayout)return Promise.resolve(!1);if(this.brlayout.hasContent()){if("toggle"===i||!1===i)this.removeGed();else{let e=t?t.getPadPainter():null;e&&e.selectObjectPainter(t)}return Promise.resolve(!0)}if(!1===i)return Promise.resolve(!1);let n=this.brlayout.createBrowserBtns();return uv.createSVG(n,uv.diamand,15,"toggle fix-pos mode").style("margin","3px").on("click",(()=>this.brlayout.toggleKind("fix"))),uv.createSVG(n,uv.circle,15,"toggle float mode").style("margin","3px").on("click",(()=>this.brlayout.toggleKind("float"))),uv.createSVG(n,uv.cross,15,"delete GED").style("margin","3px").on("click",(()=>this.removeGed())),this.brlayout.setBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>"),this.brlayout.setBrowserTitle("GED"),this.brlayout.toggleBrowserKind(e||"float"),new Promise((e=>{dv.then((i=>{Ii("#ged_placeholder").text(""),i.ui.define(["sap/ui/model/json/JSONModel","sap/ui/core/mvc/XMLView"],((i,n)=>{let r=new i({handle:null});n.create({viewName:"rootui5.canv.view.Ged"}).then((i=>{i.setModel(r),i.placeAt("ged_placeholder"),this.ged_view=i,this.registerForPadEvents(i.getController().padEventsReceiver.bind(i.getController()));let n=t?t.getPadPainter():null;n&&n.selectObjectPainter(t),this.processChanges("sbits",this),e(!0)}))}))}))}))}produceJSON(){return console.error("RCanvasPainter.produceJSON not yet implemented"),""}static draw(t,e){let i=!e;i&&(e=k("ROOT::Experimental::TCanvas"));let n=new uS(t,e);return n.normal_canvas=!i,n.createCanvasSvg(0),Ql({pp:n,active:!1}),n.drawPrimitives().then((()=>(n.addPadButtons(),n.showPadButtons(),n)))}}function fS(t,e){if(!t)return Promise.reject(Error("Painter not provided in ensureRCanvas"));return(t.getCanvSvg().empty()?uS.draw(t.getDom(),null):Promise.resolve(!0)).then((()=>{if(!1!==e&&t.getFrameSvg().select(".main_layer").empty())return oS.draw(t.getDom(),null,"string"==typeof e?e:"")})).then((()=>(t.addToPadPrimitives(),t)))}F("ROOT::Experimental::RPalette",{extractRColor:t=>t.fColor||"black",getColor(t){return this.palette[t]},getContourIndex(t){let e,i=this.fContour,n=0,r=i.length-1;if(t<i[0])return-1;if(t>=i[r])return r-1;if(this.fCustomContour){for(;n<r-1;)e=Math.round((n+r)/2),i[e]>t?r=e:n=e;return n}return Math.floor((t-i[0])/(i[r-1]-i[0])*(r-1))},getContourColor(t){let e=this.getContourIndex(t);return e<0?"":this.getColor(e)},getContour(){return this.fContour&&this.fContour.length>1?this.fContour:null},deleteContour(){delete this.fContour},calcColor(t,e,i){let n=i.fOrdinal-e.fOrdinal,r=i.fOrdinal-t,s=t-e.fOrdinal;if(!this.fInterpolate||n<=0)return r<s?i.fColor:e.fColor;let a=ut(this.extractRColor(e.fColor)),o=ut(this.extractRColor(i.fColor));return ut(Math.round((a.r*r+o.r*s)/n),Math.round((a.g*r+o.g*s)/n),Math.round((a.b*r+o.b*s)/n)).toString()},createPaletteColors(t){let e=[],i=0;for(;e.length<t;){let n=e.length/(t-1),r=this.fColors[i];if(Math.abs(r.fOrdinal-n)<1e-4||i==this.fColors.length-1){e.push(this.extractRColor(r.fColor));continue}let s=this.fColors[i+1];s.fOrdinal<=n?i++:e.push(this.calcColor(n,r,s))}return e},getColorOrdinal(t){if(!this.fColors)return"black";"number"!=typeof t||t<0?t=0:t>1&&(t=1);let e,i=this.fColors[0];for(let n=0;n<this.fColors.length-1;++n){if(e=i,Math.abs(e.fOrdinal-t)<1e-4)return this.extractRColor(e.fColor);if(i=this.fColors[n+1],i.fOrdinal>t)return this.calcColor(t,e,i)}return this.extractRColor(i.fColor)},setFullRange(t,e){this.full_min=t,this.full_max=e},createContour(t,e,i,n,r){if(this.fContour=[],delete this.fCustomContour,this.colzmin=i,this.colzmax=n,t){this.colzmax<=0&&(this.colzmax=1),this.colzmin<=0&&(this.colzmin=void 0===r||r<=0?1e-4*this.colzmax:r<3||r>100?.3*r:1),this.colzmin>=this.colzmax&&(this.colzmin=1e-4*this.colzmax);let t=Math.log(this.colzmin)/Math.log(10),i=(Math.log(this.colzmax)/Math.log(10)-t)/e;this.fContour.push(this.colzmin);for(let n=1;n<e;n++)this.fContour.push(Math.exp((t+i*n)*Math.log(10)));this.fContour.push(this.colzmax),this.fCustomContour=!0}else{this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin));let t=(this.colzmax-this.colzmin)/e;for(let i=0;i<=e;i++)this.fContour.push(this.colzmin+t*i)}this.palette&&this.palette.length==e||(this.palette=this.createPaletteColors(e))}});var mS=Object.freeze({__proto__:null,ensureRCanvas:fS,drawRPadSnapshot:function(t,e){let i=new uS(t,null);return i.normal_canvas=!1,i.batch_mode=l(),i.syncDraw(!0).then((()=>i.redrawPadSnap(e))).then((()=>(i.confirmDraw(),i.showPadButtons(),i)))},drawRFrameTitle:function(t,e){let i=this.getFramePainter();if(!i)return console.log("no frame painter - no title");let n=i.getFrameRect(),r=n.x,s=n.y,a=n.width,o=this.getPadPainter().getPadHeight(),h=this.getObject(),c=this.v7EvalLength("margin",o,.02),d=a,u=this.v7EvalLength("height",o,.05),f=this.v7EvalFont("text",{size:.07,color:"black",align:22});if("drag"==t){u=e.height,c=s-e.y-e.height;let t={};this.v7AttrChange(t,"margin",c/o),this.v7AttrChange(t,"height",u/o),this.v7SendAttrChanges(t,!1)}this.createG(),this.draw_g.attr("transform",`translate(${r},${Math.round(s-c-u)})`);let m={x:d/2,y:u/2,text:h.fText,latex:1};return this.startTextDrawing(f,"font"),this.drawText(m),this.finishTextDrawing().then((()=>{l()||Mv(this,{x:r,y:Math.round(s-c-u),width:d,height:u,minwidth:20,minheight:20,no_change_x:!0,redraw:t=>this.redraw("drag",t)})}))},drawRFont:function(){let t=this.getObject(),e=this.getCanvSvg(),i=e.select(".canvas_defs"),n="custom_font_"+t.fFamily+t.fWeight+t.fStyle;i.empty()&&(i=e.insert("svg:defs",":first-child").attr("class","canvas_defs"));let r=i.select("."+n);return r.empty()&&(r=i.append("style").attr("type","text/css").attr("class",n)),r.text(`@font-face { font-family: "${t.fFamily}"; font-weight: ${t.fWeight?t.fWeight:"normal"}; font-style: ${t.fStyle?t.fStyle:"normal"}; src: ${t.fSrc}; }`),t.fDefault&&(this.getPadPainter()._dfltRFont=t),!0},drawRAxis:function(t,e,i){let n=new aS(t,e,i);return n.disable_zooming=!0,fS(n,!1).then((()=>n.redraw())).then((()=>n))},drawRFrame:function(t,e,i){let n=new oS(t,e);return"3d"==i&&(n.mode3d=!0),fS(n,!1).then((()=>n.redraw()))},RObjectPainter:sS,RPadPainter:lS,RCanvasPainter:uS});class pS extends sS{getHistPalette(){let t=this.getObject(),e=t?t.fPalette:null;return e&&!e.getColor&&b(e,"ROOT::Experimental::RPalette"),e}drawPalette(t){let e=this.getHistPalette(),i=e.getContour(),n=this.getFramePainter();if(!i)return console.log("no contour - no palette");if(!n)return console.log("no frame painter - no palette");let r,s,a,o,h=e.full_min,c=e.full_max,d=i[0],u=i[i.length-1],f=n.getFrameRect(),p=this.getPadPainter().getPadWidth(),g=this.getPadPainter().getPadHeight(),_=this.v7EvalAttr("visible",!0),x=this.v7EvalAttr("vertical",!0);if(t){a=t.width,o=t.height;let e={};x?(this.v7AttrChange(e,"margin",(t.x-f.x-f.width)/p),this.v7AttrChange(e,"width",a/p)):(this.v7AttrChange(e,"margin",(t.y-f.y-f.height)/p),this.v7AttrChange(e,"width",o/g)),this.v7SendAttrChanges(e,!1)}else{if(x){let t=this.v7EvalLength("margin",p,.02);r=Math.round(f.x+f.width+t),a=this.v7EvalLength("width",p,.05),s=f.y,o=f.height}else{let t=this.v7EvalLength("margin",g,.02);r=f.x,a=f.width,s=Math.round(f.y+f.height+t),o=this.v7EvalLength("width",g,.05)}this.draw_g.attr("transform",`translate(${r},${s})`)}let y=this.draw_g.select(".colbtns");if(y.empty()?y=this.draw_g.append("svg:g").attr("class","colbtns"):y.selectAll("*").remove(),!_)return;y.append("svg:path").attr("d",`M0,0H${a}V${o}H0Z`).style("stroke","black").style("fill","none"),void 0!==h&&void 0!==c||(h=d,c=u),x?n.z_handle.configureAxis("zaxis",h,c,d,u,!0,[o,0],-o,{reverse:!1}):n.z_handle.configureAxis("zaxis",h,c,d,u,!1,[0,a],a,{reverse:!1});for(let t=0;t<i.length-1;++t){let r=Math.round(n.z_handle.gr(i[t])),s=Math.round(n.z_handle.gr(i[t+1])),l=e.getContourColor((i[t]+i[t+1])/2),h=y.append("svg:path").attr("d",x?`M0,${s}H${a}V${r}H0Z`:`M${r},0V${o}H${s}V0Z`).style("fill",l).style("stroke",l).property("fill0",l).property("fill1",ut(l).darker(.5).toString());this.isTooltipAllowed()&&h.on("mouseover",(function(){Ii(this).transition().duration(100).style("fill",Ii(this).property("fill1"))})).on("mouseout",(function(){Ii(this).transition().duration(100).style("fill",Ii(this).property("fill0"))})).append("svg:title").text(i[t].toFixed(2)+" - "+i[t+1].toFixed(2)),m.Zooming&&h.on("dblclick",(()=>n.unzoom("z")))}n.z_handle.max_tick_size=Math.round(.3*a);let A=n.z_handle.drawAxis(this.draw_g,x?`translate(${a},${o})`:`translate(0,${o})`,x?-1:1);return l()||t?A:A.then((()=>{if(m.ContextMenu&&this.draw_g.on("contextmenu",(t=>{t.stopPropagation(),t.preventDefault(),vv(t,this).then((t=>{t.add("header:Palette"),t.addchk(x,"Vertical",(t=>{this.v7SetAttr("vertical",t),this.redrawPad()})),n.z_handle.fillAxisContextMenu(t,"z"),t.show()}))})),Mv(this,{x:r,y:s,width:a,height:o,minwidth:20,minheight:20,no_change_x:!x,no_change_y:x,redraw:t=>this.drawPalette(t)}),!m.Zooming)return;let t,e,i,l,h=!1,c=0,d=0;const u=r=>{if(!h)return;if(r.preventDefault(),l=qi(r,this.draw_g.node()),i)return n.z_handle.processLabelsMove("move",l);d=x?Math.min(Math.max(l[1],0),o):Math.min(Math.max(l[0],0),a);let s=Math.abs(d-c);!e&&s>1&&(t.style("display",null),e=!0),x?t.attr("y",Math.min(c,d)).attr("height",s):t.attr("x",Math.min(c,d)).attr("width",s)},f=e=>{if(h)if(e.preventDefault(),Ii(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),t.remove(),t=null,h=!1,i)n.z_handle.processLabelsMove("stop",l);else{let t=n.z_handle.func,e=t.invert(c),i=t.invert(d);this.getFramePainter().zoom("z",Math.min(e,i),Math.max(e,i))}},p=r=>{h||(h=!0,r.preventDefault(),r.stopPropagation(),l=qi(r,this.draw_g.node()),c=d=l[x?1:0],e=!1,i=!1,t=y.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").style("display","none"),x?t.attr("x",0).attr("width",a).attr("y",c).attr("height",1):t.attr("x",c).attr("width",1).attr("y",0).attr("height",o),Ii(window).on("mousemove.colzoomRect",u).on("mouseup.colzoomRect",f,!0),setTimeout((()=>{!e&&h&&(i=n.z_handle.processLabelsMove("start",l))}),500))},g=()=>{this.draw_g.selectAll(".axis_zoom, .axis_labels").on("mousedown",p).on("dblclick",(()=>n.unzoom("z"))),m.ZoomWheel&&this.draw_g.on("wheel",(t=>{t.stopPropagation(),t.preventDefault();let e=qi(t,this.draw_g.node()),i=x?1-e[1]/o:e[0]/a,r=n.z_handle.analyzeWheelEvent(t,i);r.changed&&n.zoom("z",r.min,r.max)}))};n.z_handle.setAfterDrawHandler(g),g()}))}static draw(t,e,i){let n=new pS(t,e,i,"palette");return fS(n,!1).then((()=>(n.createG(),n)))}}var gS=Object.freeze({__proto__:null,RPalettePainter:pS,drawText:function(){let t=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=!!i&&this.v7EvalAttr("clipping",!1),r=e.getCoordinate(t.fPos,i),s=this.v7EvalFont("text",{size:12,color:"black",align:22});return this.createG(n?"main_layer":!!i&&"upper_layer"),this.startTextDrawing(s,"font"),this.drawText({x:r.x,y:r.y,text:t.fText,latex:1}),this.finishTextDrawing()},drawLine:function(){let t=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=!!i&&this.v7EvalAttr("clipping",!1),r=e.getCoordinate(t.fP1,i),s=e.getCoordinate(t.fP2,i);this.createG(n?"main_layer":!!i&&"upper_layer"),this.createv7AttLine(),this.draw_g.append("svg:path").attr("d",`M${r.x},${r.y}L${s.x},${s.y}`).call(this.lineatt.func)},drawBox:function(){let t=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=!!i&&this.v7EvalAttr("clipping",!1),r=e.getCoordinate(t.fP1,i),s=e.getCoordinate(t.fP2,i);this.createG(n?"main_layer":!!i&&"upper_layer"),this.createv7AttLine("border_"),this.createv7AttFill(),this.draw_g.append("svg:path").attr("d",`M${r.x},${r.y}H${s.x}V${s.y}H${r.x}Z`).call(this.lineatt.func).call(this.fillatt.func)},drawMarker:function(){let t=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=!!i&&this.v7EvalAttr("clipping",!1),r=e.getCoordinate(t.fP,i);this.createG(n?"main_layer":!!i&&"upper_layer"),this.createv7AttMarker();let s=this.markeratt.create(r.x,r.y);s&&this.draw_g.append("svg:path").attr("d",s).call(this.markeratt.func)}});const _S=1,xS=2,yS=3,AS=4;class vS extends sS{drawContent(){return Promise.resolve(this)}drawPave(){let t=this.getPadPainter().getPadRect(),e=this.getFramePainter();this.onFrame=e&&this.v7EvalAttr("onFrame",!0),this.corner=this.v7EvalAttr("corner",xS);let i=this.v7EvalAttr("visible",!0),n=this.v7EvalLength("offsetX",t.width,.02),r=this.v7EvalLength("offsetY",t.height,.02),s=this.v7EvalLength("width",t.width,.3),a=this.v7EvalLength("height",t.height,.3);if(this.createG(),this.draw_g.classed("most_upper_primitives",!0),!i)return Promise.resolve(this);this.createv7AttLine("border_"),this.createv7AttFill();let o=0,h=0,c=this.onFrame?e.getFrameRect():t;switch(this.corner){case _S:o=c.x+n,h=c.y+r;break;case yS:o=c.x+n,h=c.y+c.height-r-a;break;case AS:o=c.x+c.width-n-s,h=c.y+c.height-r-a;break;default:o=c.x+c.width-n-s,h=c.y+r}return this.draw_g.attr("transform",`translate(${o},${h})`),this.draw_g.append("svg:rect").attr("x",0).attr("width",s).attr("y",0).attr("height",a).call(this.lineatt.func).call(this.fillatt.func),this.pave_width=s,this.pave_height=a,this.drawContent().then((()=>(l()||(m.ContextMenu&&this.paveContextMenu&&this.draw_g.on("contextmenu",(t=>this.paveContextMenu(t))),Mv(this,{x:o,y:h,width:s,height:a,minwidth:20,minheight:20,redraw:t=>this.sizeChanged(t)})),this)))}sizeChanged(t){this.pave_width=t.width,this.pave_height=t.height;let e=t.x,i=t.y,n=this.getPadPainter().getPadRect(),r=this.onFrame?this.getFramePainter().getFrameRect():n,s=0,a=0,o={};switch(this.corner){case _S:s=e-r.x,a=i-r.y;break;case yS:s=e-r.x,a=r.y+r.height-i-this.pave_height;break;case AS:s=r.x+r.width-e-this.pave_width,a=r.y+r.height-i-this.pave_height;break;default:s=r.x+r.width-e-this.pave_width,a=i-r.y}this.v7AttrChange(o,"offsetX",s/n.width),this.v7AttrChange(o,"offsetY",a/n.height),this.v7AttrChange(o,"width",this.pave_width/n.width),this.v7AttrChange(o,"height",this.pave_height/n.height),this.v7SendAttrChanges(o,!1),this.draw_g.select("rect").attr("width",this.pave_width).attr("height",this.pave_height),this.drawContent()}redraw(){return this.drawPave()}static draw(t,e,i){let n=new vS(t,e,i,"pave");return fS(n,!1).then((()=>n.drawPave()))}}class bS extends vS{drawContent(){let t=this.getObject(),e=this.v7EvalFont("text",{size:12,color:"black",align:22}),i=this.pave_width,n=this.pave_height,r=t.fEntries.length,s=this.getPadPainter();if(t.fTitle&&r++,!r||!s)return Promise.resolve(this);let a=n/r,o=0,l=.02*i;e.setSize(n/(1.2*r)),this.startTextDrawing(e,"font"),t.fTitle&&(this.drawText({latex:1,width:i-2*l,height:a,x:l,y:o,text:t.fTitle}),o+=a);for(let e=0;e<t.fEntries.length;++e){let n=null,r=t.fEntries[e],h=Math.round(i/4);this.drawText({latex:1,width:.75*i-3*l,height:a,x:2*l+h,y:o,text:r.fLabel}),"custom"!=r.fDrawableId?n=s.findSnap(r.fDrawableId,!0):r.fDrawable.fIO&&(n=new sS(this.getDom(),r.fDrawable.fIO),r.fLine&&n.createv7AttLine(),r.fFill&&n.createv7AttFill(),r.fMarker&&n.createv7AttMarker()),n&&r.fFill&&n.fillatt&&this.draw_g.append("svg:path").attr("d",`M${Math.round(l)},${Math.round(o+.1*a)}h${h}v${Math.round(.8*a)}h${-h}z`).call(n.fillatt.func),n&&r.fLine&&n.lineatt&&this.draw_g.append("svg:path").attr("d",`M${Math.round(l)},${Math.round(o+a/2)}h${h}`).call(n.lineatt.func),n&&r.fError&&n.lineatt&&this.draw_g.append("svg:path").attr("d",`M${Math.round(l+i/8)},${Math.round(o+.2*a)}v${Math.round(.6*a)}`).call(n.lineatt.func),n&&r.fMarker&&n.markeratt&&this.draw_g.append("svg:path").attr("d",n.markeratt.create(l+i/8,o+a/2)).call(n.markeratt.func),o+=a}return this.finishTextDrawing()}static draw(t,e,i){let n=new bS(t,e,i,"legend");return fS(n,!1).then((()=>n.drawPave()))}}class wS extends vS{drawContent(){let t=this.getObject(),e=this.v7EvalFont("text",{size:12,color:"black",align:22}),i=this.pave_width,n=this.pave_height,r=t.fText.length;if(!r)return;let s=n/r,a=0,o=.02*i;e.setSize(n/(1.2*r)),this.startTextDrawing(e,"font");for(let e=0;e<t.fText.length;++e){let n=t.fText[e];this.drawText({latex:1,width:i-2*o,height:s,x:o,y:a,text:n}),a+=s}return this.finishTextDrawing(void 0,!0)}static draw(t,e,i){let n=new wS(t,e,i,"pavetext");return fS(n,!1).then((()=>n.drawPave()))}}class MS extends vS{clearStat(){this.stats_lines=[]}addText(t){this.stats_lines.push(t)}updateStatistic(t){this.stats_lines=t.lines,this.drawStatistic(this.stats_lines)}fillStatistic(){let t=this.getPadPainter();if(t&&t._fast_drawing)return!1;let e=this.getObject();if(void 0!==e.fLines)return this.stats_lines=e.fLines,delete e.fLines,!0;if(this.v7OfflineMode()){let t=this.getMainPainter();return!(!t||"function"!=typeof t.fillStatistic)&&t.fillStatistic(this,p.fOptStat,p.fOptFit)}return void 0!==this.stats_lines}format(t,e){switch(e||(e="stat"),e){case"stat":e=p.fStatFormat;break;case"fit":e=p.fFitFormat;break;case"entries":if(Math.abs(t)<1e9&&Math.round(t)==t)return t.toFixed(0);e="14.7g";break;case"last":e=this.lastformat}let i=rl(t,e||"6.4g",!0);return this.lastformat=i[1],i[0]}drawContent(){return this.fillStatistic()?this.drawStatistic(this.stats_lines):Promise.resolve(this)}changeMask(t){let e=this.getObject(),i=1<<t;e.fShowMask&i?e.fShowMask=e.fShowMask&~i:e.fShowMask=e.fShowMask|i,this.fillStatistic()&&this.drawStatistic(this.stats_lines)}statsContextMenu(t){t.preventDefault(),t.stopPropagation(),createMenu(t,this).then((t=>{let e=this.getObject(),i=this.changeMask.bind(this);t.add("header: StatBox");for(let n=0;n<e.fEntries.length;++n)t.addchk(e.fShowMask&1<<n,e.fEntries[n],n,i);return this.fillObjectExecMenu(t)})).then((t=>t.show()))}drawStatistic(t){let e=this.v7EvalFont("stats_text",{size:12,color:"black",align:22}),i=0,n=0,r=0,s=this.pave_width,a=this.pave_height;if(!t)return Promise.resolve(this);let o=t.length;for(let e=0;e<o;++e){let s=t[e];if(e>0&&(r=Math.max(r,s.length)),0==e||s.indexOf("|")<0)continue;0===i&&(i=e);let a=s.split("|");a.length>n&&(n=a.length)}let l=a/o,h=!1,c=.02*s,d=this.draw_g.select(".statlines");if(d.empty()?d=this.draw_g.append("svg:g").attr("class","statlines"):d.selectAll("*").remove(),e.setSize(a/(1.2*o)),this.startTextDrawing(e,"font",d),1==o)this.drawText({width:s,height:a,text:t[0],latex:1,draw_g:d});else for(let e=0;e<o;++e){let a=e*l;if(i&&e>=i){let i=t[e].split("|");for(let t=0;t<i.length;++t)this.drawText({align:"middle",x:s*t/n,y:a,latex:0,width:s/n,height:l,text:i[t],draw_g:d})}else if(t[e].indexOf("=")<0){if(0==e){h=!0;let i=Math.max(r,Math.round((s-2*c)/l/.65));t[e].length>i+5&&(t[e]=t[e].slice(0,i+2)+"...")}this.drawText({align:0==e?"middle":"start",x:c,y:a,width:s-2*c,height:l,text:t[e],draw_g:d})}else{let i=t[e].split("="),n=[];for(let t=0;t<2;++t){let e={align:0==t?"start":"end",x:c,y:a,width:s-2*c,height:l,text:i[t],draw_g:d,_expected_width:s-2*c,_args:n,post_process:function(t){this._args[0].ready&&this._args[1].ready&&t.scaleTextDrawing(1.05*(this._args[0].result_width&&this._args[1].result_width)/this.__expected_width,this.draw_g)}};n.push(e)}for(let t=0;t<2;++t)this.drawText(n[t])}}let u="";if(h&&(u+="M0,"+Math.round(l)+"h"+s),i>0&&n>1){for(let t=i;t<o;++t)u+="M0,"+Math.round(t*l)+"h"+s;for(let t=0;t<n-1;++t)u+="M"+Math.round(s/n*(t+1))+","+Math.round(i*l)+"V"+a}return u&&this.draw_g.append("svg:path").attr("d",u),this.finishTextDrawing(d)}redraw(t){if(t&&"string"==typeof t&&0==t.indexOf("zoom")&&this.v7NormalMode()){let t={_typename:"ROOT::Experimental::RHistStatBoxBase::RRequest",mask:this.getObject().fShowMask};this.v7SubmitRequest("stat",t,(t=>this.updateStatistic(t)))}return this.drawPave()}static draw(t,e,i){let n=new MS(t,e,i,e);return fS(n,!1).then((()=>n.drawPave()))}}var TS=Object.freeze({__proto__:null,RPavePainter:vS,RLegendPainter:bS,RPaveTextPainter:wS,RHistStatsPainter:MS});function SS(t){"ROOT::Experimental::RAxisEquidistant"==t._typename||"ROOT::Experimental::RAxisLabels"==t._typename?(0===t.fInvBinWidth&&(t.$dummy=!0,t.fInvBinWidth=1,t.fNBinsNoOver=0,t.fLow=0),t.min=t.fLow,t.max=t.fLow+t.fNBinsNoOver/t.fInvBinWidth,t.GetNumBins=function(){return this.fNBinsNoOver},t.GetBinCoord=function(t){return this.fLow+t/this.fInvBinWidth},t.FindBin=function(t,e){return Math.floor((t-this.fLow)*this.fInvBinWidth+e)}):"ROOT::Experimental::RAxisIrregular"==t._typename&&(t.min=t.fBinBorders[0],t.max=t.fBinBorders[t.fBinBorders.length-1],t.GetNumBins=function(){return this.fBinBorders.length},t.GetBinCoord=function(t){let e=Math.round(t);if(e<=0)return this.fBinBorders[0];if(e>=this.fBinBorders.length)return this.fBinBorders[this.fBinBorders.length-1];if(e==t)return this.fBinBorders[e];let i=t<e?e-1:e+1;return this.fBinBorders[e]*Math.abs(t-i)+this.fBinBorders[i]*Math.abs(t-e)},t.FindBin=function(t,e){for(let i=1;i<this.fBinBorders.length;++i)if(t<this.fBinBorders[i])return Math.floor(i-1+e);return this.fBinBorders.length-1}),t.GetBinCenter=function(t){return this.GetBinCoord(t-.5)},t.GetBinLowEdge=function(t){return this.GetBinCoord(t-1)}}function CS(t){return t&&t.fHistImpl?t.fHistImpl.fIO:null}class PS extends sS{constructor(t,e){super(t,e),this.csstype="hist",this.draw_content=!0,this.nbinsx=0,this.nbinsy=0,this.accept_drops=!0,this.mode3d=!1,this.getHisto(!0)}isDisplayItem(){let t=this.getObject();return!(!t||!t.fAxes)}getHisto(t){let e=this.getObject(),i=CS(e);return!i||i.getBinContent&&!t?!i&&e&&e.fAxes&&(i=e,i.getBinContent&&!t||(3==i.fAxes.length?(SS(i.fAxes[0]),SS(i.fAxes[1]),SS(i.fAxes[2]),i.nx=i.fIndicies[1]-i.fIndicies[0],i.dx=i.fIndicies[0]+1,i.stepx=i.fIndicies[2],i.ny=i.fIndicies[4]-i.fIndicies[3],i.dy=i.fIndicies[3]+1,i.stepy=i.fIndicies[5],i.nz=i.fIndicies[7]-i.fIndicies[6],i.dz=i.fIndicies[6]+1,i.stepz=i.fIndicies[8],i.getBin=function(t,e,i){return t-1+this.fAxes[0].GetNumBins()*(e-1)+this.fAxes[0].GetNumBins()*this.fAxes[1].GetNumBins()*(i-1)},i.stepx>1||i.stepy>1||i.stepz>1?i.getBin0=function(t,e,i){return Math.floor((t-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((e-this.dy)/this.stepy)+this.nx/this.stepx*this.ny/this.stepy*Math.floor((i-this.dz)/this.stepz)}:i.getBin0=function(t,e,i){return t-this.dx+this.nx*(e-this.dy)+this.nx*this.ny*(i-dz)},i.getBinContent=function(t,e,i){return this.fBinContent[this.getBin0(t,e,i)]},i.getBinError=function(t,e,i){return Math.sqrt(Math.abs(this.getBinContent(t,e,i)))}):2==i.fAxes.length?(SS(i.fAxes[0]),SS(i.fAxes[1]),i.nx=i.fIndicies[1]-i.fIndicies[0],i.dx=i.fIndicies[0]+1,i.stepx=i.fIndicies[2],i.ny=i.fIndicies[4]-i.fIndicies[3],i.dy=i.fIndicies[3]+1,i.stepy=i.fIndicies[5],i.getBin=function(t,e){return t-1+this.fAxes[0].GetNumBins()*(e-1)},i.stepx>1||i.stepy>1?i.getBin0=function(t,e){return Math.floor((t-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((e-this.dy)/this.stepy)}:i.getBin0=function(t,e){return t-this.dx+this.nx*(e-this.dy)},i.getBinContent=function(t,e){return this.fBinContent[this.getBin0(t,e)]},i.getBinError=function(t,e){return Math.sqrt(Math.abs(this.getBinContent(t,e)))}):(SS(i.fAxes[0]),i.nx=i.fIndicies[1]-i.fIndicies[0],i.dx=i.fIndicies[0]+1,i.stepx=i.fIndicies[2],i.getBin=function(t){return t-1},i.stepx>1?i.getBin0=function(t){return Math.floor((t-this.dx)/this.stepx)}:i.getBin0=function(t){return t-this.dx},i.getBinContent=function(t){return this.fBinContent[this.getBin0(t)]},i.getBinError=function(t){return Math.sqrt(Math.abs(this.getBinContent(t)))}))):i.fAxes._2?(SS(i.fAxes._0),SS(i.fAxes._1),SS(i.fAxes._2),i.getBin=function(t,e,i){return t-1+this.fAxes._0.GetNumBins()*(e-1)+this.fAxes._0.GetNumBins()*this.fAxes._1.GetNumBins()*(i-1)},i.getBinContent=function(t,e,i){return this.fStatistics.fBinContent[this.getBin(t,e,i)]},i.getBinError=function(t,e,i){let n=this.getBin(t,e,i);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[n]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[n]))}):i.fAxes._1?(SS(i.fAxes._0),SS(i.fAxes._1),i.getBin=function(t,e){return t-1+this.fAxes._0.GetNumBins()*(e-1)},i.getBinContent=function(t,e){return this.fStatistics.fBinContent[this.getBin(t,e)]},i.getBinError=function(t,e){let i=this.getBin(t,e);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[i]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[i]))}):(SS(i.fAxes._0),i.getBin=function(t){return t-1},i.getBinContent=function(t){return this.fStatistics.fBinContent[t-1]},i.getBinError=function(t){return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[t-1]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[t-1]))}),i}decodeOptions(){this.options||(this.options={Hist:1})}copyOptionsFrom(t){if(t===this)return;let e=this.options,i=t.options;e.Mode3D=i.Mode3D}copyOptionsToOthers(){this.forEachPainter((t=>{t!==this&&"function"==typeof t.copyOptionsFrom&&t.copyOptionsFrom(this)}),"objects")}clear3DScene(){let t=this.getFramePainter();t&&"function"==typeof t.create3DScene&&t.create3DScene(-1),this.mode3d=!1}cleanup(){this.clear3DScene(),delete this.options,super.cleanup()}getDimension(){return 1}scanContent(){}drawFrameAxes(){let t=this.getFramePainter();return t?this.draw_content?this.isMainPainter()?(t.cleanupAxes(),t.xmin=t.xmax=0,t.ymin=t.ymax=0,t.zmin=t.zmax=0,t.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),t.drawAxes()):this.options.second_x||this.options.second_y?(t.setAxes2Ranges(this.options.second_x,this.getAxis("x"),this.xmin,this.xmax,this.options.second_y,this.getAxis("y"),this.ymin,this.ymax),t.drawAxes2(this.options.second_x,this.options.second_y)):Promise.resolve(!0):Promise.resolve(!0):Promise.resolve(!1)}createHistDrawAttributes(){this.createv7AttFill(),this.createv7AttLine()}updateDisplayItem(t,e){return!(!t||!e)&&(t.fAxes=e.fAxes,t.fIndicies=e.fIndicies,t.fBinContent=e.fBinContent,t.fContMin=e.fContMin,t.fContMinPos=e.fContMinPos,t.fContMax=e.fContMax,this.getHisto(!0),!0)}updateObject(t){let e=this.getObject();if(t!==e){if(!this.matchObjectType(t))return!1;if(this.isDisplayItem())this.updateDisplayItem(e,t);else{let i=CS(e),n=CS(t);if(!i||!n)return!1;i.fStatistics=n.fStatistics,e.fTitle=t.fTitle}}return this.scanContent(),this.histogram_updated=!0,!0}getAxis(t){let e=this.getHisto(),i=this.getObject(),n=null;if(i&&i.fAxes)switch(t){case"x":default:n=i.fAxes[0];break;case"y":n=i.fAxes[1];break;case"z":n=i.fAxes[2]}else if(e&&e.fAxes)switch(t){case"x":default:n=e.fAxes._0;break;case"y":n=e.fAxes._1;break;case"z":n=e.fAxes._2}return n&&!n.GetBinCoord&&SS(n),n}getAxisBinTip(t,e,i){let n=this.getFramePainter(),r=n[t+"_handle"],s=this.getAxis(t),a=s.GetBinCoord(e);if("labels"===r.kind)return n.axisAsText(t,a);let o=s.GetBinCoord(e+(i||1));return"time"===r.kind?n.axisAsText(t,(a+o)/2):"["+n.axisAsText(t,a)+", "+n.axisAsText(t,o)+")"}extractAxesProperties(t){if(!this.getHisto())return;this.nbinsx=this.nbinsy=this.nbinsz=0;let e=this.getAxis("x");this.nbinsx=e.GetNumBins(),this.xmin=e.min,this.xmax=e.max,t<2||(e=this.getAxis("y"),this.nbinsy=e.GetNumBins(),this.ymin=e.min,this.ymax=e.max,t<3||(e=this.getAxis("z"),this.nbinsz=e.GetNumBins(),this.zmin=e.min,this.zmax=e.max))}addInteractivity(){let t=this.isMainPainter(),e=this.options.second_x||this.options.second_y,i=t||e?this.getFramePainter():null;return!i||i.addInteractivity(!t&&e)}processItemReply(t,e){if(!this.isDisplayItem())return console.error("Get item when display normal histogram");e.reqid===this.current_item_reqid&&(null!==t&&this.updateDisplayItem(this.getObject(),t.item),e.resolveFunc(!0))}drawingBins(t){let e=!1;if(t&&"string"==typeof t&&0==t.indexOf("zoom")&&(t.indexOf("0")>0&&(e=!0),this.getDimension()>1&&t.indexOf("1")>0&&(e=!0),this.getDimension()>2&&t.indexOf("2")>0&&(e=!0)),this.isDisplayItem()&&e&&this.v7NormalMode()){if(this.prepareDraw({only_indexes:!0}).incomplete)return new Promise((t=>{let e=this.v7SubmitRequest("",{_typename:"ROOT::Experimental::RHistDrawableBase::RRequest"},this.processItemReply.bind(this));e?(this.current_item_reqid=e.reqid,e.resolveFunc=t,setTimeout(this.processItemReply.bind(this,null,e),1e3)):t(!0)}))}return Promise.resolve(!0)}toggleStat(){}getSelectIndex(t,e,i){let n=0,r=this.getAxis(t),s=this["nbins"+t]||0;this.options.second_x&&"x"==t&&(t="x2"),this.options.second_y&&"y"==t&&(t="y2");let a=this.getFramePainter(),o=a?a["zoom_"+t+"min"]:0,l=a?a["zoom_"+t+"max"]:0;return o!==l&&r?(n="left"==e?r.FindBin(o,i||0):r.FindBin(l,(i||0)+.5),n<0?n=0:n>s&&(n=s)):n="left"==e?0:s,n}autoZoom(){}clickButton(t){switch(t){case"ToggleZoom":if(this.zoom_xmin!==this.zoom_xmax||this.zoom_ymin!==this.zoom_ymax||this.zoom_zmin!==this.zoom_zmax)return this.unzoom(),this.getFramePainter().zoomChangedInteractive("reset"),!0;if(this.draw_content)return this.autoZoom(),!0;break;case"ToggleLogX":this.getFramePainter().toggleAxisLog("x");break;case"ToggleLogY":this.getFramePainter().toggleAxisLog("y");break;case"ToggleLogZ":this.getFramePainter().toggleAxisLog("z");break;case"ToggleStatBox":return this.toggleStat(),!0}return!1}fillToolbar(t){let e=this.getPadPainter();e&&(e.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),e.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),e.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),this.getDimension()>1&&e.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.draw_content&&e.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t||e.showPadButtons())}get3DToolTip(t){let e=this.getHisto(),i={bin:t,name:e.fName||"histo",title:e.fTitle};switch(this.getDimension()){case 1:i.ix=t+1,i.iy=1,i.value=e.getBinContent(i.ix),i.error=e.getBinError(i.ix),i.lines=this.getBinTooltips(t-1);break;case 2:i.ix=t%this.nbinsx+1,i.iy=(t-(i.ix-1))/this.nbinsx+1,i.value=e.getBinContent(i.ix,i.iy),i.error=e.getBinError(i.ix,i.iy),i.lines=this.getBinTooltips(i.ix-1,i.iy-1);break;case 3:i.ix=t%this.nbinsx+1,i.iy=(t-(i.ix-1))/this.nbinsx%this.nbinsy+1,i.iz=(t-(i.ix-1)-(i.iy-1)*this.nbinsx)/this.nbinsx/this.nbinsy+1,i.value=e.getBinContent(i.ix,i.iy,i.iz),i.error=e.getBinError(i.ix,i.iy,i.iz),i.lines=this.getBinTooltips(i.ix-1,i.iy-1,i.iz-1)}return i}createContour(t,e,i){if(!t||!e)return;i||(i={});let n=p.fNumberContours,r=this.minbin,s=this.maxbin,a=this.minposbin;i.scatter_plot&&(n>50&&(n=50),r=this.minposbin),r===s&&(r=this.gminbin,s=this.gmaxbin,a=this.gminposbin),this.getDimension()<3&&(t.zoom_zmin!==t.zoom_zmax?(r=t.zoom_zmin,s=t.zoom_zmax):i.full_z_range&&(r=t.zmin,s=t.zmax)),e.setFullRange(t.zmin,t.zmax),e.createContour(t.logz,n,r,s,a),this.getDimension()<3&&(t.scale_zmin=e.colzmin,t.scale_zmax=e.colzmax)}changeValuesRange(t,e){let i=this.getFramePainter();if(!i)return;let n=i.isAxisZoomed(e)?"zoom_"+e:e,r="["+i[n+"min"]+","+i[n+"max"]+"]";t.input("Enter values range for axis "+e+" like [0,100] or empty string to unzoom",r).then((t=>{(t=t?JSON.parse(t):[])&&"object"==typeof t&&2==t.length&&Number.isFinite(t[0])&&Number.isFinite(t[1])?i.zoom(e,t[0],t[1]):i.unzoom(e)}))}fillContextMenu(t){t.add("header:v7histo::anyname"),this.draw_content&&(t.addchk(this.toggleStat("only-check"),"Show statbox",(()=>this.toggleStat())),2==this.getDimension()&&t.add("Values range",(()=>this.changeValuesRange(t,"z"))),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(t));let e=this.getFramePainter();if(this.options.Mode3D){t.size()>0&&t.add("separator");let i=this.getMainPainter()||this;t.addchk(i.isTooltipAllowed(),"Show tooltips",(()=>i.setTooltipAllowed("toggle"))),t.addchk(e.enable_highlight,"Highlight bins",(()=>{e.enable_highlight=!e.enable_highlight,!e.enable_highlight&&i.highlightBin3D&&i.mode3d&&i.highlightBin3D(null)})),e&&e.render3D&&(t.addchk(i.options.FrontBox,"Front box",(()=>{i.options.FrontBox=!i.options.FrontBox,e.render3D()})),t.addchk(i.options.BackBox,"Back box",(()=>{i.options.BackBox=!i.options.BackBox,e.render3D()}))),this.draw_content&&(t.addchk(!this.options.Zero,"Suppress zeros",(()=>{this.options.Zero=!this.options.Zero,this.redrawPad()})),12!=this.options.Lego&&14!=this.options.Lego||this.fillPaletteMenu&&this.fillPaletteMenu(t)),i.control&&"function"==typeof i.control.reset&&t.add("Reset camera",(()=>i.control.reset()))}return t.addAttributesMenu(this),this.histogram_updated&&e.zoomChangedInteractive()&&t.add("Let update zoom",(()=>e.zoomChangedInteractive("reset"))),!0}updatePaletteDraw(){if(this.isMainPainter()){let t=this.getPadPainter().findPainterFor(void 0,void 0,"ROOT::Experimental::RPaletteDrawable");t&&t.drawPalette()}}fillPaletteMenu(t){t.addPaletteMenu(this.options.Palette||m.Palette,(t=>{this.options.Palette=parseInt(t),this.redraw()}))}toggleMode3D(){this.options.Mode3D=!this.options.Mode3D,this.options.Mode3D&&(this.options.Surf||this.options.Lego||this.options.Error||(this.nbinsx>=50||this.nbinsy>=50?this.options.Lego=this.options.Color?14:13:this.options.Lego=this.options.Color?12:1,this.options.Zero=!1)),this.copyOptionsToOthers(),this.interactiveRedraw("pad","drawopt")}prepareDraw(t){t||(t={rounding:!0,extra:0,middle:0}),void 0===t.extra&&(t.extra=0),void 0===t.right_extra&&(t.right_extra=t.extra),void 0===t.middle&&(t.middle=0);let e,i,n,r,s,a,o=this.getHisto(),l=this.getAxis("x"),h=this.getAxis("y"),c=this.getFramePainter(),d=this.getDimension(),u={i1:this.getSelectIndex("x","left",0-t.extra),i2:this.getSelectIndex("x","right",1+t.right_extra),j1:d<2?0:this.getSelectIndex("y","left",0-t.extra),j2:d<2?1:this.getSelectIndex("y","right",1+t.right_extra),k1:d<3?0:this.getSelectIndex("z","left",0-t.extra),k2:d<3?1:this.getSelectIndex("z","right",1+t.right_extra),stepi:1,stepj:1,stepk:1,min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};if(this.isDisplayItem()&&o.fIndicies&&(u.i1<o.fIndicies[0]&&(u.i1=o.fIndicies[0],u.incomplete=!0),u.i2>o.fIndicies[1]&&(u.i2=o.fIndicies[1],u.incomplete=!0),u.stepi=o.fIndicies[2],u.stepi>1&&(u.incomplete=!0),d>1&&o.fIndicies.length>5&&(u.j1<o.fIndicies[3]&&(u.j1=o.fIndicies[3],u.incomplete=!0),u.j2>o.fIndicies[4]&&(u.j2=o.fIndicies[4],u.incomplete=!0),u.stepj=o.fIndicies[5],u.stepj>1&&(u.incomplete=!0)),d>2&&o.fIndicies.length>8&&(u.k1<o.fIndicies[6]&&(u.k1=o.fIndicies[6],u.incomplete=!0),u.k2>o.fIndicies[7]&&(u.k2=o.fIndicies[7],u.incomplete=!0),u.stepk=o.fIndicies[8],u.stepk>1&&(u.incomplete=!0))),t.only_indexes)return u;u.grx=new Array(u.i2+u.stepi+1),u.gry=new Array(u.j2+u.stepj+1),t.original&&(u.original=!0,u.origx=new Array(u.i2+1),u.origy=new Array(u.j2+1)),t.pixel_density&&(t.rounding=!0);let f=c.getGrFuncs(this.options.second_x,this.options.second_y);for(e=u.i1;e<=u.i2;++e)n=l.GetBinCoord(e+t.middle),f.logx&&n<=0?u.i1=e+1:(u.origx&&(u.origx[e]=n),u.grx[e]=f.grx(n),t.rounding&&(u.grx[e]=Math.round(u.grx[e])),t.use3d&&(u.grx[e]<-c.size_x3d&&(u.i1=e,u.grx[e]=-c.size_x3d),u.grx[e]>c.size_x3d&&(u.i2=e,u.grx[e]=c.size_x3d)));for(t.use3d&&(u.i1<u.i2-2&&u.grx[u.i1]==u.grx[u.i1+1]&&u.i1++,u.i1<u.i2-2&&u.grx[u.i2-1]==u.grx[u.i2]&&u.i2--);e<u.i2+u.stepi+1;)u.grx[e++]=u.grx[u.i2];if(1===d)u.gry[0]=f.gry(0),u.gry[1]=f.gry(1);else for(i=u.j1;i<=u.j2;++i)r=h.GetBinCoord(i+t.middle),f.logy&&r<=0?u.j1=i+1:(u.origy&&(u.origy[i]=r),u.gry[i]=f.gry(r),t.rounding&&(u.gry[i]=Math.round(u.gry[i])),t.use3d&&(u.gry[i]<-c.size_y3d&&(u.j1=i,u.gry[i]=-c.size_y3d),u.gry[i]>c.size_y3d&&(u.j2=i,u.gry[i]=c.size_y3d)));for(t.use3d&&d>1&&(u.j1<u.j2-2&&u.gry[u.j1]==u.gry[u.j1+1]&&u.j1++,u.j1<u.j2-2&&u.gry[u.j2-1]==u.gry[u.j2]&&u.j2--);d>1&&i<u.j2+u.stepj+1;)u.gry[i++]=u.gry[u.j2];for(this.maxbin=this.minbin=this.minposbin=null,e=u.i1;e<u.i2;e+=u.stepi)for(i=u.j1;i<u.j2;i+=u.stepj)if(s=o.getBinContent(e+1,i+1),Number.isFinite(s)){if(u.sumz+=s,t.pixel_density){if(a=(u.grx[e+u.stepi]-u.grx[e])*(u.gry[i]-u.gry[i+u.stepj]),a<=0)continue;u.max=Math.max(u.max,s),s>0&&(s<u.min||0===u.min)&&(u.min=s),s/=a}null===this.maxbin?this.maxbin=this.minbin=s:(this.maxbin=Math.max(this.maxbin,s),this.minbin=Math.min(this.minbin,s)),s>0&&(null===this.minposbin||s<this.minposbin)&&(this.minposbin=s)}return u.palette=c.getHistPalette(),u.palette&&this.createContour(c,u.palette,t),u}}class ES extends PS{constructor(t,e){super(t,e),this.wheel_zoomy=!1}scanContent(t){let e=this.getHisto();if(!e)return;!this.nbinsx&&t&&(t=!1),t||this.extractAxesProperties(1);let i=0,n=0,r=0,s=0;if(this.isDisplayItem())i=e.fContMin,n=e.fContMinPos,r=e.fContMax,s=r;else{let a=this.getSelectIndex("x","left"),o=this.getSelectIndex("x","right");if(t&&a===this.scan_xleft&&o===this.scan_xright)return;this.scan_xleft=a,this.scan_xright=o;let l,h,c=!0;for(let t=0;t<this.nbinsx;++t)l=e.getBinContent(t+1),s+=l,t<a||t>=o||(l>0&&(0==n||l<n)&&(n=l),c&&(i=r=l,c=!1),h=0,i=Math.min(i,l-h),r=Math.max(r,l+h))}if(this.stat_entries=s,this.hmin=i,this.hmax=r,this.ymin_nz=n,0==this.nbinsx||Math.abs(i)<1e-300&&Math.abs(r)<1e-300?this.draw_content=!1:this.draw_content=!0,this.draw_content)if(i>=r)0==i?(this.ymin=0,this.ymax=1):i<0?(this.ymin=2*i,this.ymax=0):(this.ymin=0,this.ymax=2*i);else{let t=.05*(r-i);this.ymin=i-t,this.ymin<0&&i>=0&&(this.ymin=0),this.ymax=r+t}}countStat(t){let e,i=this.getHisto(),n=this.getAxis("x"),r=this.getSelectIndex("x","left"),s=this.getSelectIndex("x","right"),a=0,o=0,l=0,h=0,c=0,d=null,u=null,f=this.getFramePainter(),m={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};for(e=r;e<s;++e)h=n.GetBinCoord(e+.5),t&&!t(h)||(c=i.getBinContent(e+1),(null===d||c>u)&&(d=h,u=c),a+=c,o+=c*h,l+=c*h*h);return!f.isAxisZoomed("x")&&i.fTsumw&&(a=i.fTsumw,o=i.fTsumwx,l=i.fTsumwx2),m.integral=a,a>0&&(m.meanx=o/a,m.meany=0/a,m.rmsx=Math.sqrt(Math.abs(l/a-m.meanx*m.meanx)),m.rmsy=Math.sqrt(Math.abs(0/a-m.meany*m.meany))),null!==d&&(m.xmax=d,m.wmax=u),m}fillStatistic(t,e){let i=this.countStat(),n=e%10,r=Math.floor(e/10)%10,s=Math.floor(e/100)%10,a=Math.floor(e/1e3)%10,o=Math.floor(e/1e4)%10,l=Math.floor(e/1e5)%10,h=Math.floor(e/1e6)%10,c=Math.floor(e/1e7)%10,d=Math.floor(e/1e8)%10;return t.clearStat(),n>0&&t.addText(i.name),r>0&&t.addText("Entries = "+t.format(i.entries,"entries")),s>0&&t.addText("Mean = "+t.format(i.meanx)),a>0&&t.addText("Std Dev = "+t.format(i.rmsx)),o>0&&t.addText("Underflow = "+t.format(histo.getBinContent(0),"entries")),l>0&&t.addText("Overflow = "+t.format(histo.getBinContent(this.nbinsx+1),"entries")),h>0&&t.addText("Integral = "+t.format(i.integral,"entries")),c>0&&t.addText("Skew = <not avail>"),d>0&&t.addText("Kurt = <not avail>"),!0}drawBars(t,e,i,n){this.createG(!0);let r,s,a,o,l,h,c,d,u,f=t.i1,m=t.i2,p=t.stepi,g=this.getFramePainter(),_=this.getHisto(),x=this.getAxis("x"),y="",A="",v="";for(d=g.swap_xy?0:n,Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=e.scale_ymin&&(d=Math.round(e.gry(this.options.BaseLine))),r=f;r<m;r+=p)s=x.GetBinCoord(r),a=x.GetBinCoord(r+p),e.logx&&a<=0||(o=Math.round(e.grx(s)),l=Math.round(e.grx(a)),h=_.getBinContent(r+1),e.logy&&h<e.scale_ymin||(c=Math.round(e.gry(h)),u=l-o,o+=Math.round(this.options.BarOffset*u),u=Math.round(this.options.BarWidth*u),g.swap_xy?y+="M"+d+","+o+"h"+(c-d)+"v"+u+"h"+(d-c)+"z":y+="M"+o+","+c+"h"+u+"v"+(d-c)+"h"+-u+"z",this.options.BarStyle>0&&(l=o+u,u=Math.round(u/10),g.swap_xy?(A+="M"+d+","+o+"h"+(c-d)+"v"+u+"h"+(d-c)+"z",v+="M"+d+","+l+"h"+(c-d)+"v"+-u+"h"+(d-c)+"z"):(A+="M"+o+","+c+"h"+u+"v"+(d-c)+"h"+-u+"z",v+="M"+l+","+c+"h"+-u+"v"+(d-c)+"h"+u+"z"))));return this.fillatt.empty()&&this.fillatt.setSolidColor("blue"),y.length>0&&this.draw_g.append("svg:path").attr("d",y).call(this.fillatt.func),A.length>0&&this.draw_g.append("svg:path").attr("d",A).call(this.fillatt.func).style("fill",ut(this.fillatt.color).brighter(.5).formatHex()),v.length>0&&this.draw_g.append("svg:path").attr("d",v).call(this.fillatt.func).style("fill",ut(this.fillatt.color).darker(.5).formatHex()),Promise.resolve(!0)}drawFilledErrors(t,e){this.createG(!0);let i,n,r,s,a,o,l,h=t.i1,c=t.i2,d=t.stepi,u=this.getHisto(),f=this.getAxis("x"),m=[],p=[];for(i=h;i<c;i+=d)n=f.GetBinCoord(i+.5),e.logx&&n<=0||(r=Math.round(e.grx(n)),s=u.getBinContent(i+1),a=u.getBinError(i+1),e.logy&&s-a<e.scale_ymin||(o=Math.round(e.gry(s+a)),l=Math.round(e.gry(s-a)),m.push({grx:r,gry:o}),p.unshift({grx:r,gry:l})));let g=4===this.options.ErrorKind?"bezier":"line",_=ol(g,m),x=ol("L"+g,p);return this.fillatt.empty()&&this.fillatt.setSolidColor("blue"),this.draw_g.append("svg:path").attr("d",_.path+x.path+"Z").call(this.fillatt.func),Promise.resolve(!0)}draw1DBins(){let t=this.getFramePainter(),e=t.getFrameRect();if(!this.draw_content||e.width<=0||e.height<=0)return this.removeG(),Promise.resolve(!1);this.createHistDrawAttributes();let i=this.prepareDraw({extra:1,only_indexes:!0}),n=t.getGrFuncs(this.options.second_x,this.options.second_y);return this.options.Bar?this.drawBars(i,n,e.width,e.height):3===this.options.ErrorKind||4===this.options.ErrorKind?this.drawFilledErrors(i,n,e.width,e.height):this.drawHistBins(i,n,e.width,e.height)}drawHistBins(t,e,i,n){this.createG(!0);let r,s,a,o,h,c,d,u,f,g,_,x,y,A,v,b,w,M,T,S,C,P,E,k=this.options,D=t.i1,z=t.i2,O=t.stepi,R=this.getHisto(),L=!l()&&m.Tooltip,B=this.getAxis("x"),N="",F=!1,I=!k.Zero,j=k.Error,q=k.Mark,U=k.Line,G=k.Text,H=null,X=null,V=null,Y=null,$=null,W="",Z="",Q=0;if(j&&!q&&this.v7EvalAttr("marker_style",1)>1&&(q=!0),2===k.ErrorKind?this.fillatt.empty()?q=!0:H="":k.Error&&(X="",$=L?"":null),U&&(Y=""),q&&(this.createv7AttMarker(),this.markeratt.size>0?(V="",this.markeratt.resetPos()):q=!1),G){if(E=this.v7EvalFont("text",{size:20,color:"black",align:22}),!E.angle&&!k.TextKind){let t=i/(z-D+1);t<3*E.size&&(E.setAngle(270),E.setSize(Math.round(.7*t)))}this.startTextDrawing(E,"font")}let J=z-D>3*i;if(1===k.ErrorKind){let t=this.lineatt.width+p.fEndErrorSize;W="m0,"+t+"v-"+2*t+"m0,"+t,Z="m"+t+",0h-"+2*t+"m"+t+",0",Q=Math.floor((this.lineatt.width-1)/2)}let K=j||q;(K||G||U)&&(J=!0);let tt=t=>{if(M=R.getBinContent(t+1),!I||0!==M){if(S=Math.round(e.grx(B.GetBinCoord(t))),C=Math.round(e.grx(B.GetBinCoord(t+O))),P=Math.round((S+C)/2),v=Math.round(e.gry(M)),b=w=20,j&&(T=R.getBinError(t+1),b=Math.round(v-e.gry(M+T)),w=Math.round(e.gry(M-T)-v)),G&&0!==M){let t=M===Math.round(M)?M.toString():rl(M,p.fPaintTextFormat);E.angle?this.drawText({align:12,x:P,y:Math.round(v-2-E.size/5),text:t,latex:0}):this.drawText({x:Math.round(S+.1*(C-S)),y:Math.round(v-2-E.size),width:Math.round(.8*(C-S)),height:E.size,text:t,latex:0})}if(U&&null!==Y&&(Y+=(0===Y.length?"M":"L")+P+","+v),K&&v>=-b&&v<=n+w&&(null!==H&&(H+="M"+S+","+(v-b)+"h"+(C-S)+"v"+(b+w+1)+"h-"+(C-S)+"z"),null!==V&&(V+=this.markeratt.create(P,v)),null!==X)){let t=5;if(this.options.errorX>0){t=Math.round((C-S)*this.options.errorX);let e=P-t;X+="M"+(e+Q)+","+v+W+"h"+(P+t-e-2*Q)+W}X+="M"+P+","+(v-b+Q)+Z+"v"+(b+w-2*Q)+Z,null!==$&&($+="M"+(P-t)+","+(v-b)+"h"+2*t+"v"+(b+w)+"h"+-2*t+"z")}}};for(x=D;x<=z;x+=O)o=B.GetBinCoord(x),e.logx&&o<=0||(h=Math.round(e.grx(o)),F=x>z-O,F&&D<z?d=a:(c=R.getBinContent(x+1),d=Math.round(e.gry(c))),0===N.length?(y=A=x,_=r=s=h,g=u=f=a=d,N="M"+s+","+a):J?h!==s||F?((K||G||U)&&(y===A?tt(y):y<A?(tt(y),tt(A)):(tt(A),tt(y))),K||u===f&&g===u||(_!==s&&(N+="h"+(s-_)),a===u?(f!==g&&(N+="v"+(f-g)),u!==f&&(N+="v"+(u-f))):(u!==g&&(N+="v"+(u-g)),f!==u&&(N+="v"+(f-u)),a!==f&&(N+="v"+(a-f))),_=s,g=a),F&&_!==h&&(N+="h"+(h-_)),y=A=x,u=f=a=d,s=h):(d<u?A=x:d>f&&(y=x),u=Math.min(u,d),f=Math.max(f,d),a=d):(d!==a||F)&&(h!==s&&(N+="h"+(h-s)),d!==a&&(N+="v"+(d-a)),a=d,s=h));let et="",it=!l()&&this.fillatt.empty()&&k.Hist&&m.Tooltip&&!K&&!U;if(!this.fillatt.empty()||it){let t=n+3;if(it){let i=Math.round(e.gry(0));i<=0?t=-3:i<n&&(t=i)}et=`L${s},${t}H${r}Z`,N.length>0&&(N+=et)}return K||U?(null!==H&&H.length>0&&this.draw_g.append("svg:path").attr("d",H).call(this.fillatt.func),null!==X&&X.length>0&&this.draw_g.append("svg:path").attr("d",X).call(this.lineatt.func),null!==$&&$.length>0&&this.draw_g.append("svg:path").attr("d",$).style("fill","none").style("pointer-events",l()?null:"visibleFill"),null!==Y&&Y.length>0&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",k.Fill?Y+et:N).call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",Y).style("fill","none").call(this.lineatt.func)),null!==V&&V.length>0&&this.draw_g.append("svg:path").attr("d",V).call(this.markeratt.func)):N&&k.Hist&&this.draw_g.append("svg:path").attr("d",N).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func),G?this.finishTextDrawing():Promise.resolve(!0)}getBinTooltips(t){let e=[],i=this.getObjectHint(),n=this.getFramePainter(),r=this.getHisto(),s=this.getAxis("x"),a=this.isDisplayItem()?r.stepx:1,o=s.GetBinCoord(t),l=s.GetBinCoord(t+a),h=r.getBinContent(t+1),c=this.getAxisBinTip("x",t,a);if(i.length>0&&e.push(i),this.options.Error||this.options.Mark)e.push("x = "+c),e.push("y = "+n.axisAsText("y",h)),this.options.Error&&("["==c[0]&&e.push("error x = "+((l-o)/2).toPrecision(4)),e.push("error y = "+r.getBinError(t+1).toPrecision(4)));else{e.push("bin = "+t),e.push("x = "+c),r.$baseh&&(h-=r.$baseh.getBinContent(t+1));let i="entries = "+(a>1?"~":"");h===Math.round(h)?e.push(i+h):e.push(i+rl(h,p.fStatFormat))}return e}processTooltipEvent(t){if(!t||!this.draw_content||this.options.Mode3D||!this.draw_g)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let e,i,n,r,s,a,o,l=this.getFramePainter(),h=l.getGrFuncs(this.options.second_x,this.options.second_y),c=l.getFrameWidth(),d=l.getFrameHeight(),u=this.getHisto(),f=this.getAxis("x"),m=null,p=2,g=this.getSelectIndex("x","left",-1),_=this.getSelectIndex("x","right",2),x=g,y=_;function A(t){let e=f.GetBinCoord(t);return h.logx&&e<=0?null:h.grx(e)}function v(t){let e=u.getBinContent(t+1);return h.logy&&e<h.scale_ymin?h.swap_xy?-1e3:10*d:Math.round(h.gry(e))}let b=h.swap_xy?t.y:t.x,w=h.swap_xy?t.x:t.y;for(;x<y-1;){let t=Math.round(.5*(x+y)),e=A(t);null===e||e<b-.5?h.swap_xy?y=t:x=t:e>b+.5?h.swap_xy?x=t:y=t:(x++,y--)}if(m=y=x,i=A(m),h.swap_xy){for(;x>g&&A(x-1)<i+2;)--x;for(;y<_&&A(y+1)>i-2;)++y}else{for(;x>g&&A(x-1)>i-2;)--x;for(;y<_&&A(y+1)<i+2;)++y}if(x<y){let t=d;for(let e=x;e<=y;e++){let i=Math.abs(v(e)-w);i<t&&(t=i,m=e)}t>d/10&&(m=Math.round(x+(y-x)/d*w)),i=A(m)}if(i=Math.round(i),r=Math.round(A(m+1)),this.options.Bar){let t=r-i;i+=Math.round(this.options.BarOffset*t),r=i+Math.round(this.options.BarWidth*t)}if(i>r){let t=i;i=r,r=t}if(n=Math.round((i+r)/2),a=s=o=v(m),this.options.Bar){if(e=!0,p=0,s=Math.round(h.gry(!1!==this.options.BaseLine&&this.options.BaseLine>h.scale_ymin?this.options.BaseLine:h.scale_ymin)),s>o){let t=s;s=o,o=t}t.touch||1!==t.nproc||(w<s||w>o)&&(m=null)}else if(this.options.Error||this.options.Mark){e=!0;let l=3;if(this.markeratt&&(l=Math.max(l,this.markeratt.getFullSize())),this.options.Error){let t=u.getBinContent(m+1),e=u.getBinError(m+1);s=Math.round(h.gry(t+e)),o=Math.round(h.gry(t-e));let a=(r-i)*this.options.errorX;i=Math.round(n-a),r=Math.round(n+a)}r-i<2*l&&(i=n-l,r=n+l),s=Math.min(s,a-l),o=Math.max(o,a+l),t.touch||1!==t.nproc||(w<s||w>o)&&(m=null)}else if(this.options.Line)e=!1;else if(e=1===t.nproc&&_-g<c,e){if(o=d,!this.fillatt.empty()&&(o=Math.round(h.gry(0)),o<0?o=0:o>d&&(o=d),o<s)){let t=s;s=o,o=t}(t.y<s||t.y>o)&&!t.touch&&(m=null)}null!==m&&(m===g&&i>b+p||m===_-1&&r<b-p||b<i-p||b>r+p?m=null:this.options.Zero||0!==u.getBinContent(m+1)||(m=null));let M=this.draw_g.select(".tooltip_bin");if(null===m||o<=0||s>=d)return M.remove(),null;let T={name:"histo",title:u.fTitle,x:n,y:a,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(m)};if(t.disabled)M.remove(),T.changed=!0;else if(e)M.empty()&&(M=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),T.changed=M.property("current_bin")!==m,T.changed&&M.attr("x",l.swap_xy?s:i).attr("width",l.swap_xy?o-s:r-i).attr("y",l.swap_xy?i:s).attr("height",l.swap_xy?r-i:o-s).style("opacity","0.3").property("current_bin",m),T.exact=Math.abs(a-w)<=5||w>=s&&w<=o,T.menu=!0,T.menu_dist=Math.sqrt((n-b)*(n-b)+(a-w)*(a-w));else{let e=this.lineatt.width+3;M.empty()&&(M=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",e).call(this.lineatt.func).call(this.fillatt.func)),T.exact=Math.abs(n-t.x)<=e&&Math.abs(a-t.y)<=e,T.menu=T.exact,T.menu_dist=Math.sqrt((n-t.x)*(n-t.x)+(a-t.y)*(a-t.y)),T.changed=M.property("current_bin")!==m,T.changed&&M.attr("cx",n).attr("cy",a).property("current_bin",m)}return T.changed&&(T.user_info={obj:u,name:"histo",bin:m,cont:u.getBinContent(m+1),grx:n,gry:a}),T}fillHistContextMenu(t){t.add("Auto zoom-in",(()=>this.autoZoom()));let e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,(t=>{if("inspect"===t)return this.showInspector();this.decodeOptions(t),this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")}))}autoZoom(){let t=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",1),i=e-t,n=this.getHisto(),r=this.getAxis("x");if(0==i)return;let s=n.getBinContent(t+1);for(let i=t;i<e;++i)s=Math.min(s,n.getBinContent(i+1));if(!(s>0)){for(;t<e&&n.getBinContent(t+1)<=s;)++t;for(;t<e&&n.getBinContent(e)<=s;)--e;return t===e-1&&t>2&&e<this.nbinsx-2&&(--t,++e),e-t<i&&t<e?this.getFramePainter().zoom(r.GetBinCoord(t),r.GetBinCoord(e)):void 0}}canZoomInside(t,e,i){let n=this.getAxis("x");return"x"==t&&n.FindBin(i,.5)-n.FindBin(e,0)>1||"y"==t&&Math.abs(i-e)>1e-6*Math.abs(this.ymax-this.ymin)}callDrawFunc(t){let e=this.getFramePainter();return e&&e.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=e.mode3d),this.options.Mode3D?this.draw3D(t):this.draw2D(t)}draw2D(t){return this.clear3DScene(),this.drawFrameAxes().then((e=>!!e&&this.drawingBins(t))).then((t=>{if(t)return this.draw1DBins().then((()=>this.addInteractivity()))})).then((()=>this))}draw3D(t){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),this.draw2D(t)}redraw(t){return this.callDrawFunc(t)}static _draw(t,e){return fS(t).then((()=>{t.setAsMainPainter(),t.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:p.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1};let i=new sl(e);i.check("R3D_",!0)&&(t.options.Render3D=f.Render3D.fromString(i.part.toLowerCase()));let n=t.v7EvalAttr("kind","hist"),r=t.v7EvalAttr("sub",0),s=!!t.getMainPainter(),a=t.options;switch(a.Text=t.v7EvalAttr("drawtext",!1),a.BarOffset=t.v7EvalAttr("baroffset",0),a.BarWidth=t.v7EvalAttr("barwidth",1),a.second_x=s&&t.v7EvalAttr("secondx",!1),a.second_y=s&&t.v7EvalAttr("secondy",!1),n){case"bar":a.Bar=!0,a.BarStyle=r;break;case"err":a.Error=!0,a.ErrorKind=r;break;case"p":a.Mark=!0;break;case"l":a.Line=!0;break;case"lego":a.Lego=r>0?10+r:12,a.Mode3D=!0;break;default:a.Hist=!0}return t.scanContent(),t.callDrawFunc()}))}static draw(t,e,i){return ES._draw(new ES(t,e),i)}}class kS extends ES{draw3D(t){this.mode3d=!0;let e=this.getFramePainter(),i=this.isMainPainter();return"resize"==t?(i&&e.resize3D()&&e.render3D(),Promise.resolve(this)):(this.deleteAttr(),this.scanContent(!0),i&&(iA(e),e.create3DScene(this.options.Render3D),e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,aS,{use_y_for_z:!0,zmult:1.1,zoom:m.Zooming,ndim:1,draw:!0,v7:!0})),e.mode3d?this.drawingBins(t).then((()=>{let t=this.getFramePainter();return nA(this,!0),this.updatePaletteDraw(),t.render3D(),t.addKeysHandler(),this})):Promise.resolve(this))}static draw(t,e,i){return kS._draw(new kS(t,e),i)}}var DS=Object.freeze({__proto__:null,RH1Painter:kS});class zS extends PS{constructor(t,e){super(t,e),this.wheel_zoomy=!0}cleanup(){delete this.tt_handle,super.cleanup()}getDimension(){return 2}toggleProjection(t,e){if("Projections"==t&&(t=""),"string"==typeof t&&t.length>1&&(e=parseInt(t.slice(1)),t=t[0]),e||(e=1),t&&this.is_projection==t){if(this.projection_width!==e)return void(this.projection_width=e);t=""}delete this.proj_hist;let i=this.is_projection===t?"":t;this.is_projection="",this.projection_width=e,this.provideSpecialDrawArea(i).then((()=>(this.is_projection=i,this.redrawProjection())))}redrawProjection(){this.is_projection}executeMenuCommand(t,e){return!!super.executeMenuCommand(t,e)||("SetShowProjectionX"==t.fName||"SetShowProjectionY"==t.fName)&&(this.toggleProjection(t.fName[17],e&&parseInt(e)?parseInt(e):1),!0)}fillHistContextMenu(t){t.add("sub:Projections",(()=>this.toggleProjection()));let e=this.is_projection||"";e&&(e+=this.projection_width);let i=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10"];for(let n=0;n<i.length;++n)t.addchk(e==i[n],i[n],i[n],(t=>this.toggleProjection(t)));t.add("endsub:"),t.add("Auto zoom-in",(()=>this.autoZoom()));let n=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",n,(t=>{if("inspect"===t)return this.showInspector();this.decodeOptions(t),this.interactiveRedraw("pad","drawopt")})),this.options.Color&&this.fillPaletteMenu(t)}clickButton(t){if(super.clickButton(t))return!0;switch(t){case"ToggleColor":this.toggleColor();break;case"Toggle3D":this.toggleMode3D();break;default:return!1}return!0}fillToolbar(){super.fillToolbar(!0);let t=this.getPadPainter();t&&(t.addPadButton("th2color","Toggle color","ToggleColor"),t.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),t.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),t.showPadButtons())}toggleColor(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color,this.redraw()}autoZoom(){let t,e,i=this.getSelectIndex("x","left",-1),n=this.getSelectIndex("x","right",1),r=this.getSelectIndex("y","left",-1),s=this.getSelectIndex("y","right",1),a=this.getHisto(),o=this.getAxis("x"),l=this.getAxis("y");if(i==n||r==s)return;let h=a.getBinContent(i+1,r+1);for(t=i;t<n;++t)for(e=r;e<s;++e)h=Math.min(h,a.getBinContent(t+1,e+1));if(h>0)return;let c=n,d=i,u=s,f=r;for(t=i;t<n;++t)for(e=r;e<s;++e)a.getBinContent(t+1,e+1)>h&&(t<c&&(c=t),t>=d&&(d=t+1),e<u&&(u=e),e>=f&&(f=e+1));let m,p,g,_,x=!1;return c===d-1&&c>i+1&&d<n-1&&(c--,d++),u===f-1&&u>r+1&&f<s-1&&(u--,f++),(c>i||d<n)&&c<d-1&&(m=o.GetBinCoord(c),p=o.GetBinCoord(d),x=!0),(u>r||f<s)&&u<f-1&&(g=l.GetBinCoord(u),_=l.GetBinCoord(f),x=!0),x?this.getFramePainter().zoom(m,p,g,_):void 0}scanContent(t){if(t&&this.nbinsx&&this.nbinsy)return;let e,i,n=this.getHisto();if(this.extractAxesProperties(2),this.isDisplayItem())this.gminbin=n.fContMin,this.gminposbin=n.fContMinPos>0?n.fContMinPos:null,this.gmaxbin=n.fContMax;else for(this.gminbin=this.gmaxbin=n.getBinContent(1,1),this.gminposbin=null,e=0;e<this.nbinsx;++e)for(i=0;i<this.nbinsy;++i){let t=n.getBinContent(e+1,i+1);t<this.gminbin?this.gminbin=t:t>this.gmaxbin&&(this.gmaxbin=t),t>0&&(null===this.gminposbin||this.gminposbin>t)&&(this.gminposbin=t)}this.zmin=this.gminbin,this.zmax=this.gmaxbin,null===this.gminposbin&&(this.gminposbin=1e-4*this.gmaxbin),this.options.Axis>0?this.draw_content=!1:this.draw_content=this.gmaxbin>0}countStat(t){let e,i,n,r,s,a,o,l=this.getHisto(),h=0,c=0,d=0,u=0,f=0,m={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null},p=this.getSelectIndex("x","left"),g=this.getSelectIndex("x","right"),_=this.getSelectIndex("y","left"),x=this.getSelectIndex("y","right"),y=this.getAxis("x"),A=this.getAxis("y");for(a=1;a<=this.nbinsx;++a)for(e=a<=p+1?0:a>g+1?2:1,n=y.GetBinCoord(a-.5),o=1;o<=this.nbinsy;++o)i=o<=_+1?0:o>x+1?2:1,r=A.GetBinCoord(o-.5),s=l.getBinContent(a,o),m.entries+=s,m.matrix[3*i+e]+=s,1==e&&1==i&&(t&&!t(n,r)||((null===m.wmax||s>m.wmax)&&(m.wmax=s,m.xmax=n,m.ymax=r),h+=s,c+=n*s,d+=r*s,u+=n*n*s,f+=r*r*s));return h>0&&(m.meanx=c/h,m.meany=d/h,m.rmsx=Math.sqrt(Math.abs(u/h-m.meanx*m.meanx)),m.rmsy=Math.sqrt(Math.abs(f/h-m.meany*m.meany))),null===m.wmax&&(m.wmax=0),m.integral=h,m}fillStatistic(t,e){let i=this.countStat(),n=Math.floor(e%10),r=Math.floor(e/10)%10,s=Math.floor(e/100)%10,a=Math.floor(e/1e3)%10,o=Math.floor(e/1e4)%10,l=Math.floor(e/1e5)%10,h=Math.floor(e/1e6)%10,c=Math.floor(e/1e7)%10,d=Math.floor(e/1e8)%10;if(t.clearStat(),n>0&&t.addText(i.name),r>0&&t.addText("Entries = "+t.format(i.entries,"entries")),s>0&&(t.addText("Mean x = "+t.format(i.meanx)),t.addText("Mean y = "+t.format(i.meany))),a>0&&(t.addText("Std Dev x = "+t.format(i.rmsx)),t.addText("Std Dev y = "+t.format(i.rmsy))),h>0&&t.addText("Integral = "+t.format(i.matrix[4],"entries")),c>0&&(t.addText("Skewness x = <undef>"),t.addText("Skewness y = <undef>")),d>0&&t.addText("Kurt = <undef>"),o>0||l>0){let e=i.matrix;t.addText(e[6].toFixed(0)+" | "+e[7].toFixed(0)+" | "+e[7].toFixed(0)),t.addText(e[3].toFixed(0)+" | "+e[4].toFixed(0)+" | "+e[5].toFixed(0)),t.addText(e[0].toFixed(0)+" | "+e[1].toFixed(0)+" | "+e[2].toFixed(0))}return!0}drawBinsColor(){const t=this.getHisto(),e=this.prepareDraw(),i=e.stepi,n=e.stepj,r=[];let s,a,o,l,h,c,d,u,f,m;const p=()=>{m.path+=`h${d}v${m.y2-m.y}h${-d}z`,m.dy=0,m=null};for(l=e.i1;l<e.i2;l+=i){for(d=e.grx[l+i]-e.grx[l]||1,h=e.j1;h<e.j2;h+=n)if(c=t.getBinContent(l+1,h+1),s=e.palette.getContourIndex(c),0===c&&(this.options.Zero?null===s&&this._show_empty_bins&&(s=0):s=null),null!==s){if(a=`M${e.grx[l]},${e.gry[h]}`,u=e.gry[h+n]-e.gry[h]||-1,f=r[s],void 0===f)f=r[s]={path:a};else{if(f===m){f.y2=e.gry[h]+u;continue}o=`m${e.grx[l]-f.x},${e.gry[h]-f.y}`,f.path+=o.length<a.length?o:a}m&&p(),f.x=e.grx[l],f.y=e.gry[h],f.y2=e.gry[h]+u,m=f}else m&&p();m&&p()}return r.forEach(((t,i)=>{t&&this.draw_g.append("svg:path").style("fill",e.palette.getColor(i)).attr("d",t.path)})),this.updatePaletteDraw(),e}buildContour(t,e,i,n){let r,s,a,o,l,h,c,d,u,f,m,p,g,_,x,y=this.getHisto(),A=new Float32Array(4008),v=new Float32Array(4008),b=new Int32Array(4008),w=0,M=[],T=0,S=[0,0,0,0],C=[0,0,0,0],P=[0,0,0,0],E=[0,0,0,0],k=t.stepi,D=t.stepj;function O(t){for(let i=0;i<e.length;++i)if(t<e[i])return i-1;return e.length-1}function R(t,i,n,r,s,a,o,l){let h,c,d,u,f=n===o,m=f?l-r:o-n,p=i+1,g=s-t,_=w-1,x=999+w,y=0;for(;p<=a&&_<=x;)u=e[p],d=u-t,c=d/g,h=m*c,f?(A[_]=n,v[_]=r+h):(A[_]=n+h,v[_]=r),b[_]=p,y++,_+=2,p++;return y}let L=t.original?t.origx:t.grx,B=t.original?t.origy:t.gry;for(l=t.j1;l<t.j2-D;l+=D)for(C[1]=C[0]=(B[l]+B[l+D])/2,C[3]=C[2]=(B[l+D]+B[l+2*D])/2,o=t.i1;o<t.i2-k;o+=k){for(P[0]=y.getBinContent(o+1,l+1),P[1]=y.getBinContent(o+1+k,l+1),P[2]=y.getBinContent(o+1+k,l+1+D),P[3]=y.getBinContent(o+1,l+1+D),h=0;h<4;h++)E[h]=O(P[h]);if(E[0]!==E[1]||E[1]!==E[2]||E[2]!==E[3]||E[3]!==E[0]){for(S[3]=S[0]=(L[o]+L[o+1])/2,S[2]=S[1]=(L[o+1]+L[o+2])/2,c=P[0]<=P[1]?0:1,d=P[2]<=P[3]?2:3,P[c]>P[d]&&(c=d),c++,w=1,u=1;u<=4;u++)d=c%4+1,f=R(P[c-1],E[c-1],S[c-1],C[c-1],P[d-1],E[d-1],S[d-1],C[d-1]),w+=2*f,c=d;for(c=P[0]<=P[1]?0:1,d=P[2]<=P[3]?2:3,P[c]>P[d]&&(c=d),c++,w=2,u=1;u<=4;u++)d=1==c?4:c-1,f=R(P[c-1],E[c-1],S[c-1],C[c-1],P[d-1],E[d-1],S[d-1],C[d-1]),w+=2*f,c=d;for(m=0,u=1;u<=w-5;u+=2)for(;b[u-1]!=b[u];){for(p=A[u],g=v[u],_=b[u],x=u;x<=w-5;x+=2)A[x]=A[x+2],v[x]=v[x+2],b[x]=b[x+2];if(A[w-3]=p,v[w-3]=g,b[w-3]=_,m>2e3)break;m++}if(m>2e3)continue;for(u=1;u<=w-2;u+=2)r=b[u-1],r>=0&&r<e.length&&(s=M[r],s||(s=M[r]=z(8016,!0)),a=s.fLastPoint,a<s.fN-2&&(s.fX[a+1]=Math.round(A[u-1]),s.fY[a+1]=Math.round(v[u-1]),s.fX[a+2]=Math.round(A[u]),s.fY[a+2]=Math.round(v[u]),s.fLastPoint=a+2,T=Math.max(T,s.fLastPoint+1)))}}let N=new Int32Array(e.length),F=0;for(r=0;r<e.length;r++)if(e[r]>=0){F=r;break}for(h=0,r=F-1;r>=0;r--)N[h]=r,h++;for(r=F;r<e.length;r++)N[h]=r,h++;let I=new Float32Array(2*T),j=new Float32Array(2*T);for(h=0;h<e.length;++h){if(r=N[h],s=M[r],!s)continue;let t,e,i,a=r,l=s.fX,c=s.fY,d=s.fLastPoint+1,u=0,f=0,m=0;for(;;){for(t=T,e=t+1,I[t]=l[u],j[t]=c[u],I[e]=l[u+1],j[e]=c[u+1],l[u]=l[u+1]=f,c[u]=c[u+1]=m;;){for(i=0,o=2;o<d;o+=2)e<2*T-1&&l[o]===I[e]&&c[o]===j[e]&&(e++,I[e]=l[o+1],j[e]=c[o+1],l[o]=l[o+1]=f,c[o]=c[o+1]=m,i++),t>0&&l[o+1]===I[t]&&c[o+1]===j[t]&&(t--,I[t]=l[o],j[t]=c[o],l[o]=l[o+1]=f,c[o]=c[o+1]=m,i++);if(0==i)break}for(t+1<e&&t>=0&&n(a,I,j,t,e,r),u=0,o=2;o<d;o+=2)if(l[o]!==f&&c[o]!==m){u=o;break}if(0===u)break}}}drawBinsContour(t,e,i){let n=this.prepareDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),r=this.getFramePainter(),s=r.getHistPalette(),a=s.getContour(),o=r.getProjectionFunc(),l=(e,i,n,r,s)=>{let a,l,h,c,d="";for(let u=n;u<=r;++u){if(o?(l=o(e[u],i[u]),l.x=Math.round(t.grx(l.x)),l.y=Math.round(t.gry(l.y))):l={x:Math.round(e[u]),y:Math.round(i[u])},d)if(u==r&&h&&l.x==h.x&&l.y==h.y){if(!c)return"";d+="z",s=!1}else l.x!=a.x&&l.y!=a.y?(d+="l"+(l.x-a.x)+","+(l.y-a.y),c=!0):l.x!=a.x?(d+="h"+(l.x-a.x),c=!0):l.y!=a.y&&(d+="v"+(l.y-a.y),c=!0);else d="M"+l.x+","+l.y,h=l;a=l}return s&&(d+="z"),d};if(14===this.options.Contour){let t="M0,0h"+e+"v"+i+"h-"+e+"z";if(this.options.Proj){let e=n.stepj,i=parseInt((n.j2-n.j1)/e),r=new Float32Array(2*i),s=new Float32Array(2*i);for(let t=0;t<i;++t)r[t]=n.origx[n.i1],s[t]=(n.origy[n.j1]*(t*e+.5)+n.origy[n.j2]*(i-.5-t*e))/i,r[t+i]=n.origx[n.i2],s[t+i]=(n.origy[n.j2]*(t*e+.5)+n.origy[n.j1]*(i-.5-t*e))/i;t=l(r,s,0,2*i-1,!0)}this.draw_g.append("svg:path").attr("d",t).style("fill",s.getColor(0))}return this.buildContour(n,a,s,((t,e,i,n,r)=>{let a,o=s.getColor(t),h=o;switch(this.options.Contour){case 1:break;case 11:h="none",a=new Hl({color:o});break;case 12:h="none",a=new Hl({color:1,style:t%5+1,width:1});break;case 13:h="none",a=this.lineatt}let c=l(e,i,n,r,"none"!=h);if(!c)return;let d=this.draw_g.append("svg:path").attr("class","th2_contour").attr("d",c).style("fill",h);a&&d.call(a.func)})),n.hide_only_zeros=!0,n}createPolyBin(t,e,i){let n,r="",s=1,a=null,o=t.getGrFuncs(this.options.second_x,this.options.second_y);function l(t,i,n,r){let s=Math.sqrt((t-n)*(t-n)+(i-r)*(i-r));e._sumx+=(t+n)*s/2,e._sumy+=(i+r)*s/2,e._suml+=s}for("TMultiGraph"==e.fPoly._typename?s=e.fPoly.fGraphs.arr.length:a=e.fPoly,i&&(e._sumx=e._sumy=e._suml=0),n=0;n<s;++n){(!a||n>0)&&(a=e.fPoly.fGraphs.arr[n]);let t,s,h,c=a.fNpoints,d=a.fX,u=a.fY,f=Math.round(o.grx(d[0])),m=Math.round(o.gry(u[0]));for(c>2&&d[0]==d[c-1]&&u[0]==u[c-1]&&c--,r+="M"+f+","+m,t=1;t<c;++t)s=Math.round(o.grx(d[t])),h=Math.round(o.gry(u[t])),i&&l(f,m,s,h),f===s&&m===h||(r+=f===s?"v"+(h-m):m===h?"h"+(s-f):"l"+(s-f)+","+(h-m)),f=s,m=h;i&&l(f,m,Math.round(o.grx(d[0])),Math.round(o.gry(u[0]))),r+="z"}return i&&(e._suml>0?(e._midx=Math.round(e._sumx/e._suml),e._midy=Math.round(e._sumy/e._suml)):(e._midx=Math.round(o.grx((e.fXmin+e.fXmax)/2)),e._midy=Math.round(o.gry((e.fYmin+e.fYmax)/2)))),r}drawBinsText(t){let e,i,n,r,s,a,o,l,h,c,d=this.getHisto();null===t&&(t=this.prepareDraw({rounding:!1}));let u=this.v7EvalFont("text",{size:20,color:"black",align:22}),f=0,m=this.draw_g.append("svg:g").attr("class","th2_text"),g=t.stepi,_=t.stepj,x="E"==this.options.TextKind&&this.matchObjectType("TProfile2D")&&"function"==typeof d.getBinEntries;for(this.options.BarOffset&&(f=this.options.BarOffset),this.startTextDrawing(u,"font",m),e=t.i1;e<t.i2;e+=g)for(i=t.j1;i<t.j2;i+=_)n=d.getBinContent(e+1,i+1),(0!==n||this._show_empty_bins)&&(r=t.grx[e+g]-t.grx[e],s=t.gry[i]-t.gry[i+_],x&&(n=d.getBinEntries(e+1,i+1)),a=n===Math.round(n)?n.toString():rl(n,p.fPaintTextFormat),u.angle?(o=Math.round(t.grx[e]+.5*r),l=Math.round(t.gry[i+_]+s*(.5+f)),h=c=0):(o=Math.round(t.grx[e]+.1*r),l=Math.round(t.gry[i+_]+s*(.1+f)),h=Math.round(.8*r),c=Math.round(.8*s)),this.drawText({align:22,x:o,y:l,width:h,height:c,text:a,latex:0,draw_g:m}));return this.finishTextDrawing(m,!0).then((()=>(t.hide_only_zeros=!0,t)))}drawBinsArrow(){let t,e,i,n,r,s,a,o,l,h,c,d,u,f,m,p=this.getHisto(),g="",_=1e-30,x=this.prepareDraw({rounding:!1}),y=(x.grx[x.i2]-x.grx[x.i1])/(x.i2-x.i1+1-.03)/2,A=(x.gry[x.j2]-x.gry[x.j1])/(x.j2-x.j1+1-.03)/2,v=x.stepi,b=x.stepj;const w=(t,e)=>t?e?`l${t},${e}`:`h${t}`:e?`v${e}`:"";for(let M=0;M<2;++M)for(t=x.i1;t<x.i2;t+=v)for(e=x.j1;e<x.j2;e+=b)i=t===x.i1?p.getBinContent(t+1+v,e+1)-p.getBinContent(t+1,e+1):t>=x.i2-v?p.getBinContent(t+1,e+1)-p.getBinContent(t+1-v,e+1):.5*(p.getBinContent(t+1+v,e+1)-p.getBinContent(t+1-v,e+1)),n=e===x.j1?p.getBinContent(t+1,e+1+b)-p.getBinContent(t+1,e+1):e>=x.j2-b?p.getBinContent(t+1,e+1)-p.getBinContent(t+1,e+1-b):.5*(p.getBinContent(t+1,e+1+b)-p.getBinContent(t+1,e+1-b)),0===M?_=Math.max(_,Math.abs(i),Math.abs(n)):(r=(x.grx[t]+x.grx[t+v])/2,s=(x.gry[e]+x.gry[e+b])/2,a=y*i/_,o=A*n/_,l=r-a,h=r+a,c=s-o,d=s+o,i=Math.round(h-l),n=Math.round(d-c),0===i&&0===n||(g+="M"+Math.round(l)+","+Math.round(c)+w(i,n),(Math.abs(i)>5||Math.abs(n)>5)&&(u=Math.sqrt(2/(i*i+n*n)),f=Math.round(u*(i+n)),m=Math.round(u*(i-n)),(f||m)&&(g+=`m${-f},${m}`+w(f,-m)+w(-m,-f)))));return this.draw_g.append("svg:path").attr("d",g).style("fill","none").call(this.lineatt.func),x}drawBinsBox(){let t=this.getHisto(),e=this.prepareDraw({rounding:!1}),i=this.getFramePainter();i.maxbin===i.minbin&&(i.maxbin=this.gmaxbin,i.minbin=this.gminbin,i.minposbin=this.gminposbin),i.maxbin===i.minbin&&(i.minbin=Math.min(0,i.maxbin-1));let n,r,s,a,o,l,h,c,d,u,f,m,p=Math.max(Math.abs(i.maxbin),Math.abs(i.minbin)),g=Math.max(0,i.minbin),_="",x="",y="",A="",v=!1,b=0,w=e.stepi,M=e.stepj;if(i.logz&&p>0){v=!0;let t=Math.log(p);b=g>0?Math.log(g):i.minposbin>=1&&i.minposbin<100?Math.log(.7):i.minposbin>0?Math.log(.7*i.minposbin):t-10,b>=t&&(b=t-10),m=1/(t-b)}else m=1/(p-g);for(n=e.i1;n<e.i2;n+=w)for(r=e.j1;r<e.j2;r+=M)if(s=t.getBinContent(n+1,r+1),a=Math.abs(s),!(0===a||a<g)&&(o=v?a>0?Math.log(a)-b:0:a-g,o=.5*(o<0?1:1-Math.sqrt(o*m)),o<0&&(o=0),u=e.grx[n+w]-e.grx[n],f=e.gry[r]-e.gry[r+M],l=o*u,h=o*f,c=Math.round(e.grx[n]+l),d=Math.round(e.gry[r+M]+h),u=Math.max(Math.round(u-2*l),1),f=Math.max(Math.round(f-2*h),1),_+=`M${c},${d}v${f}h${u}v${-f}z`,s<0&&10===this.options.BoxStyle&&(x+=`M${c},${d}l${u},${f}M${c+u},${d}l${-u},${f}`),11===this.options.BoxStyle&&u>5&&f>5)){let t=Math.round(.1*u),e=Math.round(.1*f),i=`M${c},${d}h${u}l${-t},${e}h${2*t-u}v${f-2*e}l${-t},${e}z`,n=`M${c+u},${d+f}v${-f}l${-t},${e}v${f-2*e}h${2*t-u}l${-t},${e}z`;s<0?(A+=i,y+=n):(y+=i,A+=n)}if(_.length>0){let t=this.draw_g.append("svg:path").attr("d",_).call(this.fillatt.func);11!==this.options.BoxStyle&&this.fillatt.empty()&&t.call(this.lineatt.func)}if(y.length>0&&this.fillatt.hasColor()&&this.draw_g.append("svg:path").attr("d",y).call(this.fillatt.func).style("fill",ut(this.fillatt.color).brighter(.5).formatHex()),A.length>0&&this.draw_g.append("svg:path").attr("d",A).call(this.fillatt.func).style("fill",this.fillatt.hasColor()?ut(this.fillatt.color).darker(.5).formatHex():"red"),x.length>0){let t=this.draw_g.append("svg:path").attr("d",x).style("fill","none");this.lineatt.empty()||t.call(this.lineatt.func)}return e}drawBinsCandle(t,e){let i,n,r,s,a,o,l,h,c,d,u=this.getHisto(),f=this.getAxis("y"),m=this.prepareDraw(),p="",g="";for(this.createv7AttMarker(),this.markeratt.resetPos(),m.candle=[],i=m.i1;i<m.i2;++i){for(s=0,h=0,l=0,n=0;n<this.nbinsy;++n)h+=u.getBinContent(i+1,n+1);for(c={bin:i,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0},n=0;n<this.nbinsy;++n)a=u.getBinContent(i+1,n+1),d=f.GetBinCoord(n+.5),l/h<.001&&(l+a)/h>=.001&&(c.whiskerm=d),l/h<.25&&(l+a)/h>=.25&&(c.m25y=d),l/h<.5&&(l+a)/h>=.5&&(c.median=d),l/h<.75&&(l+a)/h>=.75&&(c.p25y=d),l/h<.999&&(l+a)/h>=.999&&(c.whiskerp=d),l+=a,r=d,s+=a*r;if(l>0&&(c.meany=s/l),c.iqr=c.p25y-c.m25y,c.m25y-1.5*c.iqr>c.whsikerm&&(c.whiskerm=c.m25y-1.5*c.iqr),c.p25y+1.5*c.iqr<c.whiskerp&&(c.whiskerp=c.p25y+1.5*c.iqr),!(t.logy&&c.whiskerm<=0)){for(e=m.grx[i+1]-m.grx[i],e*=.66,o=(m.grx[i+1]+m.grx[i])/2+this.options.BarOffset*e,this.options.BarWidth>0&&(e*=this.options.BarWidth),c.x1=Math.round(o-e/2),c.x2=Math.round(o+e/2),o=Math.round(o),c.y0=Math.round(t.gry(c.median)),p+="M"+c.x1+","+c.y0+"h"+(c.x2-c.x1),c.y1=Math.round(t.gry(c.p25y)),c.y2=Math.round(t.gry(c.m25y)),p+="M"+c.x1+","+c.y1+"v"+(c.y2-c.y1)+"h"+(c.x2-c.x1)+"v-"+(c.y2-c.y1)+"z",c.yy1=Math.round(t.gry(c.whiskerp)),c.yy2=Math.round(t.gry(c.whiskerm)),p+="M"+o+","+c.y1+"v"+(c.yy1-c.y1),p+="M"+c.x1+","+c.yy1+"h"+(c.x2-c.x1),p+="M"+o+","+c.y2+"v"+(c.yy2-c.y2),p+="M"+c.x1+","+c.yy2+"h"+(c.x2-c.x1),n=0;n<this.nbinsy;++n)a=u.getBinContent(i+1,n+1),d=f.GetBinCoord(n+.5),a>0&&d<c.whiskerm&&(g+=this.markeratt.create(o,d)),a>0&&d>c.whiskerp&&(g+=this.markeratt.create(o,d));m.candle.push(c)}}return p.length>0&&this.draw_g.append("svg:path").attr("d",p).call(this.lineatt.func).call(this.fillatt.func),g.length>0&&this.draw_g.append("svg:path").attr("d",g).call(this.markeratt.func),m}drawBinsScatter(){let t,e,i,n,r,a,o,l,h=this.getHisto(),c=this.prepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0}),d=[],u=[],f=[],m=[],p=[],g=1,_=this.options.ScatCoef*(this.gmaxbin>2e3?2e3/this.gmaxbin:1),x=c.stepi,y=c.stepj,A=new al(c.sumz);if(_*c.sumz<1e5){this.createv7AttMarker(),this.markeratt.resetPos();let t,e,i="";for(n=c.i1;n<c.i2;n+=x)for(o=c.grx[n+x]-c.grx[n],r=c.j1;r<c.j2;r+=y)if(l=c.gry[r]-c.gry[r+y],a=h.getBinContent(n+1,r+1),e=Math.round(_*a),!(e<=0))for(t=0;t<e;++t)i+=this.markeratt.create(Math.round(c.grx[n]+o*A.random()),Math.round(c.gry[r+1]+l*A.random()));return this.draw_g.append("svg:path").attr("d",i).call(this.markeratt.func),c}for(this.maxbin>.7&&(g=.7/this.maxbin),n=c.i1;n<c.i2;n+=x)for(r=c.j1;r<c.j2;r+=y)a=h.getBinContent(n+1,r+1),a<=0||a<this.minbin||(o=c.grx[n+x]-c.grx[n],l=c.gry[r]-c.gry[r+y],o*l<=0||(t=c.palette.getContourIndex(a/o/l),t<0||(e="M"+c.grx[n]+","+c.gry[r+y],void 0===d[t]?(d[t]=e,m[t]=o,p[t]=l):(i="m"+(c.grx[n]-u[t])+","+(c.gry[r+y]-f[t]),d[t]+=i.length<e.length?i:e,m[t]=Math.max(m[t],o),p[t]=Math.max(p[t],l)),u[t]=c.grx[n],f[t]=c.gry[r+y],d[t]+="v"+l+"h"+o+"v-"+l+"z")));let v=this.getFrameSvg().select(".main_layer"),b=v.select("defs");b.empty()&&d.length>0&&(b=v.insert("svg:defs",":first-child")),this.createv7AttMarker();let w=c.palette.getContour();for(t=0;t<d.length;++t)if(void 0!==d[t]&&t<w.length){let e="scatter_"+t,i=b.select("."+e);i.empty()?i=b.append("svg:pattern").attr("class",e).attr("id","jsroot_scatter_pattern_"+s.id_counter++).attr("patternUnits","userSpaceOnUse"):i.selectAll("*").remove();let n=Math.round(g*w[t]*m[t]*p[t]);n<1&&(n=1);let r=new Float32Array(n),a=new Float32Array(n);if(1===n)r[0]=a[0]=.5;else for(let t=0;t<n;++t)r[t]=A.random(),a[t]=A.random();this.markeratt.resetPos();let o="";for(let e=0;e<n;++e)o+=this.markeratt.create(r[e]*m[t],a[e]*p[t]);i.attr("width",m[t]).attr("height",p[t]).append("svg:path").attr("d",o).call(this.markeratt.func),this.draw_g.append("svg:path").attr("scatter-index",t).style("fill","url(#"+i.attr("id")+")").attr("d",d[t])}return c}draw2DBins(){if(!this.draw_content)return this.removeG(),Promise.resolve(!1);this.createHistDrawAttributes(),this.createG(!0);let t=this.getFramePainter(),e=t.getFrameRect(),i=t.getGrFuncs(this.options.second_x,this.options.second_y),n=null,r=null;return this.options.Scat?n=this.drawBinsScatter():this.options.Color?n=this.drawBinsColor():this.options.Box?n=this.drawBinsBox():this.options.Arrow?n=this.drawBinsArrow():this.options.Contour>0?n=this.drawBinsContour(i,e.width,e.height):this.options.Candle&&(n=this.drawBinsCandle(i,e.width)),this.options.Text&&(r=this.drawBinsText(n)),n||r||(n=this.drawBinsColor()),r||(r=Promise.resolve(n)),r.then((t=>(this.tt_handle=t,this)))}getBinTooltips(t,e){let i=[],n=this.getHisto(),r=n.getBinContent(t+1,e+1),s=1,a=1;this.isDisplayItem()&&(s=n.stepx||1,a=n.stepy||1),i.push(this.getObjectHint()||"histo<2>"),i.push("x = "+this.getAxisBinTip("x",t,s)),i.push("y = "+this.getAxisBinTip("y",e,a)),i.push("bin = "+t+", "+e),n.$baseh&&(r-=n.$baseh.getBinContent(t+1,e+1));let o="entries = "+(s>1||a>1?"~":"");return r===Math.round(r)?i.push(o+r):i.push(o+rl(r,p.fStatFormat)),i}getCandleTooltips(t){let e=[],i=this.getFramePainter(),n=this.getAxis("y");return e.push(this.getObjectHint()||"histo"),e.push("x = "+i.axisAsText("x",n.GetBinCoord(t.bin))),e.push("mean y = "+rl(t.meany,p.fStatFormat)),e.push("m25 = "+rl(t.m25y,p.fStatFormat)),e.push("p25 = "+rl(t.p25y,p.fStatFormat)),e}getPolyBinTooltips(t,e,i){let n=this.getHisto().fBins.arr[t],r=this.getFramePainter(),s=n.fPoly.fName,a=[],o=0;if("Graph"===s&&(s=""),0===s.length&&(s=n.fNumber),void 0===e&&void 0===i){e=i=0;let t=n.fPoly,r=1;"TMultiGraph"===t._typename&&(r=n.fPoly.fGraphs.arr.length,t=null);for(let s=0;s<r;++s){(!t||s>0)&&(t=n.fPoly.fGraphs.arr[s]);for(let n=0;n<t.fNpoints;++n)++o,e+=t.fX[n],i+=t.fY[n]}o>1&&(e/=o,i/=o)}return a.push(this.getObjectHint()||"histo"),a.push("x = "+r.axisAsText("x",e)),a.push("y = "+r.axisAsText("y",i)),o>0&&a.push("npnts = "+o),a.push("bin = "+s),n.fContent===Math.round(n.fContent)?a.push("content = "+n.fContent):a.push("content = "+rl(n.fContent,p.fStatFormat)),a}processTooltipEvent(t){if(!t||!this.draw_content||!this.draw_g||!this.tt_handle||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let e=this.getHisto(),i=this.tt_handle,n=this.draw_g.select(".tooltip_bin");if(i.poly){let i,r=this.getFramePainter(),s=-1;const a=r.revertAxis("x",t.x),o=r.revertAxis("y",t.y);if(void 0!==a&&void 0!==o){const t=e.fBins.arr.length;for(let n=0;n<t&&s<0;++n){if(i=e.fBins.arr[n],a<i.fXmin||a>i.fXmax||o<i.fYmin||o>i.fYmax)continue;if(0===i.fContent&&!this.options.Zero)continue;let t=i.fPoly,r=1;"TMultiGraph"===t._typename&&(r=i.fPoly.fGraphs.arr.length,t=null);for(let e=0;e<r;++e)if((!t||e>0)&&(t=i.fPoly.fGraphs.arr[e]),t.IsInside(a,o)){s=n;break}}}if(s<0)return n.remove(),null;let l={name:"histo",title:e.fTitle||"title",x:t.x,y:t.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",exact:!0,menu:!0,lines:this.getPolyBinTooltips(s,a,o)};return t.disabled?(n.remove(),l.changed=!0):(n.empty()&&(n=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),l.changed=n.property("current_bin")!==s,l.changed&&n.attr("d",this.createPolyBin(r,i)).style("opacity","0.7").property("current_bin",s)),l.changed&&(l.user_info={obj:e,name:"histo",bin:s,cont:i.fContent,grx:t.x,gry:t.y}),l}if(i.candle){let r,s;for(s=0;s<i.candle.length&&(r=i.candle[s],!(r.x1<=t.x&&t.x<=r.x2&&r.yy1<=t.y&&t.y<=r.yy2));++s);if(s>=i.candle.length)return n.remove(),null;let a={name:"histo",title:e.fTitle||"title",x:t.x,y:t.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getCandleTooltips(r),exact:!0,menu:!0};return t.disabled?(n.remove(),a.changed=!0):(n.empty()&&(n=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),a.changed=n.property("current_bin")!==s,a.changed&&n.attr("x",r.x1).attr("width",r.x2-r.x1).attr("y",r.yy1).attr("height",r.yy2-r.yy1).style("opacity","0.7").property("current_bin",s)),a.changed&&(a.user_info={obj:e,name:"histo",bin:s+1,cont:r.median,binx:s+1,biny:1,grx:t.x,gry:t.y}),a}let r,s,a=0,o=null;for(r=i.i1;r<i.i2&&!(t.x>=i.grx[r]&&t.x<=i.grx[r+1]);++r);for(s=i.j1;s<i.j2&&!(t.y>=i.gry[s+1]&&t.y<=i.gry[s]);++s);if(r<i.i2&&s<i.j2&&(a=e.getBinContent(r+1,s+1),this.is_projection?o=0:i.hide_only_zeros?o=0!==a||this._show_empty_bins?0:null:(o=i.palette.getContourIndex(a),null===o&&0===a&&this._show_empty_bins&&(o=0))),null===o)return n.remove(),null;let l={name:"histo",title:e.fTitle||"title",x:t.x,y:t.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(r,s),exact:!0,menu:!0};if(this.options.Color&&(l.color2=i.palette.getColor(o)),t.disabled&&!this.is_projection)n.remove(),l.changed=!0;else{n.empty()&&(n=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none"));let t=r,e=r+1,a=s,o=s+1,h=i.grx[t],c=i.grx[e],d=i.gry[o],u=i.gry[a],f=1e4*r+s;if("X"==this.is_projection){if(h=0,c=this.getFramePainter().getFrameWidth(),this.projection_width>1){let t=(this.projection_width-1)/2;o+t>=i.j2?(o=Math.min(Math.round(o+t),i.j2),a=Math.max(o-this.projection_width,i.j1)):(a=Math.max(Math.round(a-t),i.j1),o=Math.min(a+this.projection_width,i.j2))}d=i.gry[o],u=i.gry[a],f=777*a+333*o}else if("Y"==this.is_projection){if(d=0,u=this.getFramePainter().getFrameHeight(),this.projection_width>1){let n=(this.projection_width-1)/2;e+n>=i.i2?(e=Math.min(Math.round(e+n),i.i2),t=Math.max(e-this.projection_width,i.i1)):(t=Math.max(Math.round(t-n),i.i1),e=Math.min(t+this.projection_width,i.i2))}h=i.grx[t],c=i.grx[e],f=777*t+333*e}l.changed=n.property("current_bin")!==f,l.changed&&n.attr("x",h).attr("width",c-h).attr("y",d).attr("height",u-d).style("opacity","0.7").property("current_bin",f),this.is_projection&&l.changed&&this.redrawProjection(t,e,a,o)}return l.changed&&(l.user_info={obj:e,name:"histo",bin:e.getBin(r+1,s+1),cont:a,binx:r+1,biny:s+1,grx:t.x,gry:t.y}),l}canZoomInside(t,e,i){if("z"==t)return!0;let n=this.getAxis(t);return n.FindBin(i,.5)-n.FindBin(e,0)>1}draw2D(t){return this.clear3DScene(),this.drawFrameAxes().then((e=>!!e&&this.drawingBins(t))).then((t=>{if(t)return this.draw2DBins().then((()=>this.addInteractivity()))})).then((()=>this))}draw3D(t){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),this.draw2D(t)}callDrawFunc(t){let e=this.getFramePainter();return e&&e.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=e.mode3d),this.options.Mode3D?this.draw3D(t):this.draw2D(t)}redraw(t){return this.callDrawFunc(t)}static _draw(t,e){return fS(t).then((()=>{t.setAsMainPainter(),t.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,Candle:"",Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:-1111,maximum:-1111};let e=t.v7EvalAttr("kind",""),i=t.v7EvalAttr("sub",0),n=t.options;switch(n.Text=t.v7EvalAttr("drawtext",!1),e){case"lego":n.Lego=i>0?10+i:12,n.Mode3D=!0;break;case"surf":n.Surf=i>0?10+i:1,n.Mode3D=!0;break;case"box":n.Box=!0,n.BoxStyle=10+i;break;case"err":n.Error=!0,n.Mode3D=!0;break;case"cont":n.Contour=i>0?10+i:1;break;case"arr":n.Arrow=!0;break;case"scat":n.Scat=!0;break;case"col":n.Color=!0;break;default:n.Text||(n.Color=!0)}return t._show_empty_bins=!1,t.scanContent(),t.callDrawFunc()}))}static draw(t,e,i){return zS._draw(new zS(t,e),i)}}class OS extends zS{draw3DBins(){if(this.draw_content){if(this.options.Surf)return aA(this,!0);if(this.options.Error)return rA(this,!0);if(this.options.Contour)return sA(this,!0,!0);nA(this,!0),this.updatePaletteDraw()}}draw3D(t){this.mode3d=!0;let e=this.getFramePainter(),i=this.isMainPainter();if("resize"==t)return i&&e.resize3D()&&e.render3D(),Promise.resolve(this);let n=1.1;return this.zmin=e.logz?.3*this.gminposbin:this.gminbin,this.zmax=this.gmaxbin,-1111!==this.options.minimum&&(this.zmin=this.options.minimum),-1111!==this.options.maximum&&(this.zmax=this.options.maximum,n=1),e.logz&&this.zmin<=0&&(this.zmin=1e-5*this.zmax),this.deleteAttr(),i&&(iA(e),e.create3DScene(this.options.Render3D),e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,null,this.zmin,this.zmax),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,aS,{zmult:n,zoom:m.Zooming,ndim:2,draw:!0,v7:!0})),e.mode3d?this.drawingBins(t).then((()=>{let t=this.getFramePainter();return this.draw3DBins(),t.render3D(),t.addKeysHandler(),this})):Promise.resolve(this)}static draw(t,e,i){return OS._draw(new OS(t,e),i)}}var RS=Object.freeze({__proto__:null,RH2Painter:OS});class LS extends PS{getDimension(){return 3}scanContent(t){if(t&&this.nbinsx&&this.nbinsy&&this.nbinsz)return;let e=this.getHisto();if(e){if(this.extractAxesProperties(3),this.isDisplayItem())this.gminbin=e.fContMin,this.gminposbin=e.fContMinPos>0?e.fContMinPos:null,this.gmaxbin=e.fContMax;else{this.gminbin=this.gmaxbin=e.getBinContent(1,1,1);for(let t=0;t<this.nbinsx;++t)for(let i=0;i<this.nbinsy;++i)for(let n=0;n<this.nbinsz;++n){let r=e.getBinContent(t+1,i+1,n+1);r<this.gminbin?this.gminbin=r:r>this.gmaxbin&&(this.gmaxbin=r)}}this.draw_content=this.gmaxbin>0}}countStat(){let t,e,i,n,r,s,a,o,l,h,c=this.getHisto(),d=this.getAxis("x"),u=this.getAxis("y"),f=this.getAxis("z"),m=0,p=0,g=0,_=0,x=0,y=0,A=0,v=this.getSelectIndex("x","left"),b=this.getSelectIndex("x","right"),w=this.getSelectIndex("y","left"),M=this.getSelectIndex("y","right"),T=this.getSelectIndex("z","left"),S=this.getSelectIndex("z","right"),C=this.getFramePainter(),P={name:c.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0};for(t=1;t<=this.nbinsx;++t)for(n=d.GetBinCoord(t-.5),r=t<=v+1?0:t>b+1?2:1,e=1;e<=this.nbinsy;++e)for(s=u.GetBinCoord(e-.5),a=e<=w+1?0:e>M+1?2:1,i=1;i<=this.nbinsz;++i)o=f.GetBinCoord(i-.5),l=i<=T+1?0:i>S+1?2:1,h=c.getBinContent(t,e,i),P.entries+=h,1==r&&1==a&&1==l&&(m+=h,p+=n*h,g+=s*h,_+=o*h,x+=n*n*h,y+=s*s*h,A+=o*o*h);return c.fTsumw>0&&!C.isAxisZoomed("x")&&!C.isAxisZoomed("y")&&!C.isAxisZoomed("z")&&(m=c.fTsumw,p=c.fTsumwx,x=c.fTsumwx2,g=c.fTsumwy,y=c.fTsumwy2,_=c.fTsumwz,A=c.fTsumwz2),m>0&&(P.meanx=p/m,P.meany=g/m,P.meanz=_/m,P.rmsx=Math.sqrt(Math.abs(x/m-P.meanx*P.meanx)),P.rmsy=Math.sqrt(Math.abs(y/m-P.meany*P.meany)),P.rmsz=Math.sqrt(Math.abs(A/m-P.meanz*P.meanz))),P.integral=m,c.fEntries>1&&(P.entries=c.fEntries),P}fillStatistic(t,e){let i=this.countStat(),n=e%10,r=Math.floor(e/10)%10,s=Math.floor(e/100)%10,a=Math.floor(e/1e3)%10,o=Math.floor(e/1e6)%10;return t.clearStat(),n>0&&t.addText(i.name),r>0&&t.addText("Entries = "+t.format(i.entries,"entries")),s>0&&(t.addText("Mean x = "+t.format(i.meanx)),t.addText("Mean y = "+t.format(i.meany)),t.addText("Mean z = "+t.format(i.meanz))),a>0&&(t.addText("Std Dev x = "+t.format(i.rmsx)),t.addText("Std Dev y = "+t.format(i.rmsy)),t.addText("Std Dev z = "+t.format(i.rmsz))),o>0&&t.addText("Integral = "+t.format(i.integral,"entries")),!0}getBinTooltips(t,e,i){let n=[],r=this.getHisto(),s=1,a=1,o=1;this.isDisplayItem()&&(s=r.stepx||1,a=r.stepy||1,o=r.stepz||1),n.push(this.getObjectHint()),n.push("x = "+this.getAxisBinTip("x",t,s)+"  xbin="+t),n.push("y = "+this.getAxisBinTip("y",e,a)+"  ybin="+e),n.push("z = "+this.getAxisBinTip("z",i,o)+"  zbin="+i);let l=r.getBinContent(t+1,e+1,i+1),h="entries = "+(s>1||a>1||o>1?"~":"");return l===Math.round(l)?n.push(h+l):n.push(h+rl(l,p.fStatFormat)),n}draw3DScatter(t){let e,i,n,r,s=this.getHisto(),a=this.getFramePainter(),o=t.i1,l=t.i2,h=t.stepi,c=t.j1,d=t.j2,u=t.stepj,f=t.k1,m=t.k2,p=t.stepk;if(l<=o||d<=c||m<=f)return Promise.resolve(!0);let g=this.gmaxbin>1e3?1e3/this.gmaxbin:1,_=0,x=0,y=Math.max(0,this.gminbin);for(e=o;e<l;e+=h)for(i=c;i<d;i+=u)for(n=f;n<m;n+=p)r=s.getBinContent(e+1,i+1,n+1),x+=r,r<=y||(_+=Math.round(r*g));if(_>(a.webgl?1e5:3e4))return Promise.resolve(!1);let A=new Vy(_,a.webgl,a.size_x3d/200),v=new Int32Array(_),b=0,w=this.getAxis("x"),M=this.getAxis("y"),T=this.getAxis("z"),S=new al(x);for(e=o;e<l;e+=h)for(i=c;i<d;i+=u)for(n=f;n<m;n+=p){if(r=s.getBinContent(e+1,i+1,n+1),r<=y)continue;let t=Math.round(r*g);for(let r=0;r<t;++r){let t=w.GetBinCoord(e+S.random()),r=M.GetBinCoord(i+S.random()),o=T.GetBinCoord(n+S.random());v[b++]=s.getBin(e+1,i+1,n+1),A.addPoint(a.grx(t),a.gry(r),a.grz(o))}}return A.createPoints({color:this.v7EvalColor("fill_color","red")}).then((t=>(a.toplevel.add(t),t.bins=v,t.painter=this,t.tip_color=65280,t.tooltip=function(t){if(!Number.isInteger(t.index))return console.error("intersect.index not provided, three.js version 138"),null;let e=Math.floor(t.index/this.nvertex);if(e<0||e>=this.bins.length)return null;let i=this.painter,n=i.getFramePainter(),r=i.get3DToolTip(this.bins[e]);return r.x1=n.grx(i.getAxis("x").GetBinLowEdge(r.ix)),r.x2=n.grx(i.getAxis("x").GetBinLowEdge(r.ix+h)),r.y1=n.gry(i.getAxis("y").GetBinLowEdge(r.iy)),r.y2=n.gry(i.getAxis("y").GetBinLowEdge(r.iy+u)),r.z1=n.grz(i.getAxis("z").GetBinLowEdge(r.iz)),r.z2=n.grz(i.getAxis("z").GetBinLowEdge(r.iz+p)),r.color=this.tip_color,r.opacity=.3,r},!0)))}draw3DBins(t){let e,i,n=this.v7EvalColor("fill_color","red"),r=this.getFramePainter(),s=0,a=!1,o=!1,l=!1,h=1,c=!0,d=.5;if(this.options.Sphere){d=.4,a=!0,11===this.options.Sphere&&(l=!0);let t=r.webgl?new Bg(.5,16,12):new Bg(.5,8,6);t.applyMatrix4((new Vc).makeRotationX(Math.PI/2)),t.computeVertexNormals();let n=t.getIndex().array,o=t.getAttribute("position").array,h=t.getAttribute("normal").array;s=3*n.length,e=new Float32Array(s),i=new Float32Array(s);for(let t=0;t<n.length;++t){let r=3*n[t];e[3*t]=o[r],e[3*t+1]=o[r+1],e[3*t+2]=o[r+2],i[3*t]=h[r],i[3*t+1]=h[r+1],i[3*t+2]=h[r+2]}}else{let t=Xy.Indexes,n=Xy.Normals,r=Xy.Vertices;s=3*t.length,e=new Float32Array(s),i=new Float32Array(s);for(let s=0,a=-3;s<t.length;++s){let o=r[t[s]];e[3*s]=o.x-.5,e[3*s+1]=o.y-.5,e[3*s+2]=o.z-.5,s%6==0&&(a+=3),i[3*s]=n[a],i[3*s+1]=n[a+1],i[3*s+2]=n[a+2]}o=!0,11==this.options.Box?l=!0:12==this.options.Box?(l=!0,o=!1):this.options.Color&&(l=!0,h=.5,c=!1,o=!1,a=!0)}c&&(c=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);let u=this.getHisto(),f=t.i1,m=t.i2,p=t.stepi,g=t.j1,_=t.j2,x=t.stepj,y=t.k1,A=t.k2,v=t.stepk,b=null;if(l&&(b=r.getHistPalette(),this.createContour(r,b)),m<=f||_<=g||A<=y)return!0;let w,M,T,S,C,P=this.getAxis("x"),E=this.getAxis("y"),k=this.getAxis("z"),D=(r.grx(P.GetBinCoord(m))-r.grx(P.GetBinCoord(f)))/(m-f)*p,z=(r.gry(E.GetBinCoord(_))-r.gry(E.GetBinCoord(g)))/(_-g)*x,O=(r.grz(k.GetBinCoord(A))-r.grz(k.GetBinCoord(y)))/(A-y)*v,R=0,L=[],B=0,N=[];for(w=f;w<m;w+=p)for(M=g;M<_;M+=x)for(T=y;T<A;T+=v){if(C=u.getBinContent(w+1,M+1,T+1),!this.options.Color&&(0===C||C<this.gminbin))continue;if(S=c?Math.pow(Math.abs(C*c),.3333):1,S<.001)continue;if(R++,!l)continue;let t=b.getContourIndex(C);t>=0?(void 0===L[t]&&(L[t]=0,N[t]=B++),L[t]+=1):console.error("not found color for",C)}l||(L.push(R),B=1,N=[0]);let F,I,j,q,U,G,H=new Array(B),X=new Array(B),V=new Array(B),Y=new Array(B),$=new Array(B),W=new Array(B),Z=new Array(B);for(let t=0;t<L.length;++t){if(!L[t])continue;R=L[t];let e=N[t];H[e]=0,$[e]=0,o&&($[e]=R*s/3>65520?2:1),X[e]=new Float32Array(R*s),V[e]=new Float32Array(R*s),Y[e]=new Int32Array(R),1===$[e]&&(W[e]=new Uint16Array(R*Xy.MeshSegments.length)),2===$[e]&&(Z[e]=new Float32Array(R*Xy.Segments.length*3))}for(P=this.getAxis("x"),E=this.getAxis("y"),k=this.getAxis("z"),w=f;w<m;w+=p)for(F=P.GetBinCenter(w+1),I=r.grx(F),M=g;M<_;M+=x)for(j=E.GetBinCenter(M+1),q=r.gry(j),T=y;T<A;T+=v){if(C=u.getBinContent(w+1,M+1,T+1),!this.options.Color&&(0===C||C<this.gminbin))continue;if(S=c?Math.pow(Math.abs(C*c),.3333):1,S<.001)continue;let t=0;if(l){let e=b.getContourIndex(C);if(e<0)continue;t=N[e]}R=H[t],U=k.GetBinCenter(T+1),G=r.grz(U),Y[t][R]=u.getBin(w+1,M+1,T+1);let n=R*s,a=X[t],o=V[t];for(let t=0;t<s;t+=3,n+=3)a[n]=I+e[t]*D*S,a[n+1]=q+e[t+1]*z*S,a[n+2]=G+e[t+2]*O*S,o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2];if(1===$[t]){let e=Xy.MeshSegments;n=R*e.length;let i=Math.round(R*s/3),r=W[t];for(let t=0;t<e.length;++t)r[n+t]=i+e[t]}if(2===$[t]){let e=Xy.Segments,i=Z[t];n=R*e.length*3;for(let t=0;t<e.length;++t,n+=3){let r=Xy.Vertices[e[t]];i[n]=I+(r.x-.5)*D*S,i[n+1]=q+(r.y-.5)*z*S,i[n+2]=G+(r.z-.5)*O*S}}H[t]=R+1}for(let t=0;t<L.length;++t){if(!L[t])continue;let e=N[t],i=new Od;i.setAttribute("position",new rd(X[e],3)),i.setAttribute("normal",new rd(V[e],3)),l&&(n=b.getColor(t));let o=a?new $g({color:n,opacity:h,transparent:h<1,vertexColors:!1}):new ou({color:n,opacity:h,vertexColors:!1}),u=new Tu(i,o);if(u.bins=Y[e],u.bins_faces=s/9,u.painter=this,u.scalex=d*D,u.scaley=d*z,u.scalez=d*O,u.tip_color=65280,u.use_scale=c,u.tooltip=function(t){if(!Number.isInteger(t.faceIndex))return console.error("intersect.faceIndex not provided, three.js version 138"),null;let e=Math.floor(t.faceIndex/this.bins_faces);if(e<0||e>=this.bins.length)return null;let i=this.painter,n=i.getFramePainter(),r=i.get3DToolTip(this.bins[e]),s=n.grx(i.getAxis("x").GetBinCoord(r.ix-.5)),a=n.gry(i.getAxis("y").GetBinCoord(r.iy-.5)),o=n.grz(i.getAxis("z").GetBinCoord(r.iz-.5)),l=this.use_scale?Math.pow(Math.abs(r.value*this.use_scale),.3333):1;return r.x1=s-this.scalex*l,r.x2=s+this.scalex*l,r.y1=a-this.scaley*l,r.y2=a+this.scaley*l,r.z1=o-this.scalez*l,r.z2=o+this.scalez*l,r.color=this.tip_color,r},r.toplevel.add(u),$[e]>0){let t=this.v7EvalColor("line_color","lightblue"),i=new pp({color:t}),n=null;n=1===$[e]?Hy(X[e],i,W[e]):Hy(Z[e],i),r.toplevel.add(n)}}l&&this.updatePaletteDraw()}draw3D(){if(!this.draw_content)return!1;let t=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});return(this.options.Scatter?this.draw3DScatter(t):Promise.resolve(!1)).then((e=>e||this.draw3DBins(t)))}redraw(t){let e=this.getFramePainter();return"resize"==t?(e.resize3D()&&e.render3D(),this):(iA(e),e.create3DScene(this.options.Render3D),e.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),e.set3DOptions(this.options),e.drawXYZ(e.toplevel,aS,{zoom:m.Zooming,ndim:3,draw:!0,v7:!0}),this.drawingBins(t).then((()=>this.draw3D())).then((()=>(e.render3D(),e.addKeysHandler(),this))))}fillToolbar(){let t=this.getPadPainter();t&&(t.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&t.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t.showPadButtons())}canZoomInside(t,e,i){let n=this.getHisto();return n&&(n=n["f"+t.toUpperCase()+"axis"]),!n||n.FindBin(i,.5)-n.FindBin(e,0)>1}autoZoom(){let t,e,i,n=this.getSelectIndex("x","left"),r=this.getSelectIndex("x","right"),s=this.getSelectIndex("y","left"),a=this.getSelectIndex("y","right"),o=this.getSelectIndex("z","left"),l=this.getSelectIndex("z","right"),h=this.getHisto();if(n===r||s===a||o===l)return;let c=h.getBinContent(n+1,s+1,o+1);for(t=n;t<r;++t)for(e=s;e<a;++e)for(i=o;i<l;++i)c=Math.min(c,h.getBinContent(t+1,e+1,i+1));if(c>0)return;let d=r,u=n,f=a,m=s,p=l,g=o;for(t=n;t<r;++t)for(e=s;e<a;++e)for(i=o;i<l;++i)h.getBinContent(t+1,e+1,i+1)>c&&(t<d&&(d=t),t>=u&&(u=t+1),e<f&&(f=e),e>=m&&(m=e+1),i<p&&(p=i),i>=g&&(g=i+1));let _,x,y,A,v,b,w=!1;return d===u-1&&d>n+1&&u<r-1&&(d--,u++),f===m-1&&f>s+1&&m<a-1&&(f--,m++),p===g-1&&p>o+1&&g<l-1&&(p--,g++),(d>n||u<r)&&d<u-1&&(_=this.getAxis("x").GetBinLowEdge(d+1),x=this.getAxis("x").GetBinLowEdge(u+1),w=!0),(f>s||m<a)&&f<m-1&&(y=this.getAxis("y").GetBinLowEdge(f+1),A=this.getAxis("y").GetBinLowEdge(m+1),w=!0),(p>o||g<l)&&p<g-1&&(v=this.getAxis("z").GetBinLowEdge(p+1),b=this.getAxis("z").GetBinLowEdge(g+1),w=!0),w?this.getFramePainter().zoom(_,x,y,A,v,b):void 0}fillHistContextMenu(t){let e=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",e,(t=>{if("inspect"===t)return this.showInspector();this.decodeOptions(t),this.interactiveRedraw(!0,"drawopt")}))}static draw(t,e){let i=new LS(t,e);return i.mode3d=!0,fS(i,"3d").then((()=>{i.setAsMainPainter(),i.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:-1111,maximum:-1111};let t=i.v7EvalAttr("kind",""),e=i.v7EvalAttr("sub",0),n=i.options;switch(t){case"box":n.Box=10+e;break;case"sphere":n.Sphere=10+e;break;case"col":n.Color=!0;break;case"scat":n.Scatter=!0;break;default:n.Box=10}return i.scanContent(),i.redraw()}))}}var BS=Object.freeze({__proto__:null,RH3Painter:LS,drawHistDisplayItem:function(t,e,i){return e?1==e.fAxes.length?kS.draw(t,e,i):2==e.fAxes.length?OS.draw(t,e,i):3==e.fAxes.length?LS.draw(t,e,i):null:null}});function NS(t,e){var i=t.__state.conversionName.toString(),n=Math.round(t.r),r=Math.round(t.g),s=Math.round(t.b),a=t.a,o=Math.round(t.h),l=t.s.toFixed(1),h=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var c=t.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===i?"rgb("+n+","+r+","+s+")":"CSS_RGBA"===i?"rgba("+n+","+r+","+s+","+a+")":"HEX"===i?"0x"+t.hex.toString(16):"RGB_ARRAY"===i?"["+n+","+r+","+s+"]":"RGBA_ARRAY"===i?"["+n+","+r+","+s+","+a+"]":"RGB_OBJ"===i?"{r:"+n+",g:"+r+",b:"+s+"}":"RGBA_OBJ"===i?"{r:"+n+",g:"+r+",b:"+s+",a:"+a+"}":"HSV_OBJ"===i?"{h:"+o+",s:"+l+",v:"+h+"}":"HSVA_OBJ"===i?"{h:"+o+",s:"+l+",v:"+h+",a:"+a+"}":"unknown format"}var FS=Array.prototype.forEach,IS=Array.prototype.slice,jS={BREAK:{},extend:function(t){return this.each(IS.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(e[i])||(t[i]=e[i])}.bind(this))}),this),t},defaults:function(t){return this.each(IS.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(t[i])&&(t[i]=e[i])}.bind(this))}),this),t},compose:function(){var t=IS.call(arguments);return function(){for(var e=IS.call(arguments),i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},each:function(t,e,i){if(t)if(FS&&t.forEach&&t.forEach===FS)t.forEach(e,i);else if(t.length===t.length+0){var n,r=void 0;for(r=0,n=t.length;r<n;r++)if(r in t&&e.call(i,t[r],r)===this.BREAK)return}else for(var s in t)if(e.call(i,t[s],s)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var n=void 0;return function(){var r=this,s=arguments;function a(){n=null,i||t.apply(r,s)}var o=i||!n;clearTimeout(n),n=setTimeout(a,e),o&&t.apply(r,s)}},toArray:function(t){return t.toArray?t.toArray():IS.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},qS=[{litmus:jS.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:NS},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:NS},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:NS},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:NS}}},{litmus:jS.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:jS.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:jS.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(jS.isNumber(t.r)&&jS.isNumber(t.g)&&jS.isNumber(t.b)&&jS.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(jS.isNumber(t.r)&&jS.isNumber(t.g)&&jS.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(jS.isNumber(t.h)&&jS.isNumber(t.s)&&jS.isNumber(t.v)&&jS.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(jS.isNumber(t.h)&&jS.isNumber(t.s)&&jS.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],US=void 0,GS=void 0,HS=function(){GS=!1;var t=arguments.length>1?jS.toArray(arguments):arguments[0];return jS.each(qS,(function(e){if(e.litmus(t))return jS.each(e.conversions,(function(e,i){if(US=e.read(t),!1===GS&&!1!==US)return GS=US,US.conversionName=i,US.conversion=e,jS.BREAK})),jS.BREAK})),GS},XS=void 0,VS={hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),s=i*(1-e),a=i*(1-r*e),o=i*(1-(1-r)*e),l=[[i,o,s],[a,i,s],[s,i,o],[s,a,i],[o,s,i],[i,s,a]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,i){var n=Math.min(t,e,i),r=Math.max(t,e,i),s=r-n,a=void 0;return 0===r?{h:NaN,s:0,v:0}:(a=t===r?(e-i)/s:e===r?2+(i-t)/s:4+(t-e)/s,(a/=6)<0&&(a+=1),{h:360*a,s:s/r,v:r/255})},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,i){return i<<(XS=8*e)|t&~(255<<XS)}},YS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$S=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},WS=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),ZS=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},QS=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},JS=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},KS=function(){function t(){if($S(this,t),this.__state=HS.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return WS(t,[{key:"toString",value:function(){return NS(this)}},{key:"toHexString",value:function(){return NS(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function tC(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||KS.recalculateRGB(this,e,i),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(KS.recalculateRGB(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function eC(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||KS.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(KS.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}KS.recalculateRGB=function(t,e,i){if("HEX"===t.__state.space)t.__state[e]=VS.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");jS.extend(t.__state,VS.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},KS.recalculateHSV=function(t){var e=VS.rgb_to_hsv(t.r,t.g,t.b);jS.extend(t.__state,{s:e.s,v:e.v}),jS.isNaN(e.h)?jS.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},KS.COMPONENTS=["r","g","b","h","s","v","hex","a"],tC(KS.prototype,"r",2),tC(KS.prototype,"g",1),tC(KS.prototype,"b",0),eC(KS.prototype,"h"),eC(KS.prototype,"s"),eC(KS.prototype,"v"),Object.defineProperty(KS.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(KS.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=VS.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var iC=function(){function t(e,i){$S(this,t),this.initialValue=e[i],this.domElement=document.createElement("div"),this.object=e,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return WS(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),nC={};jS.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){jS.each(t,(function(t){nC[t]=e}))}));var rC=/(\d+(\.\d+)?)px/;function sC(t){if("0"===t||jS.isUndefined(t))return 0;var e=t.match(rC);return jS.isNull(e)?0:parseFloat(e[1])}var aC={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,i){var n=i,r=e;jS.isUndefined(r)&&(r=!0),jS.isUndefined(n)&&(n=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,i,n){var r=i||{},s=nC[e];if(!s)throw new Error("Event type "+e+" not supported.");var a=document.createEvent(s);switch(s){case"MouseEvents":var o=r.x||r.clientX||0,l=r.y||r.clientY||0;a.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,o,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=a.initKeyboardEvent||a.initKeyEvent;jS.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:a.initEvent(e,r.bubbles||!1,r.cancelable||!0)}jS.defaults(a,n),t.dispatchEvent(a)},bind:function(t,e,i,n){var r=n||!1;return t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on"+e,i),aC},unbind:function(t,e,i,n){var r=n||!1;return t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on"+e,i),aC},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);-1===i.indexOf(e)&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return aC},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),n=i.indexOf(e);-1!==n&&(i.splice(n,1),t.className=i.join(" "))}else t.className=void 0;return aC},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return sC(e["border-left-width"])+sC(e["border-right-width"])+sC(e["padding-left"])+sC(e["padding-right"])+sC(e.width)},getHeight:function(t){var e=getComputedStyle(t);return sC(e["border-top-width"])+sC(e["border-bottom-width"])+sC(e["padding-top"])+sC(e["padding-bottom"])+sC(e.height)},getOffset:function(t){var e=t,i={left:0,top:0};if(e.offsetParent)do{i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent}while(e);return i},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},oC=function(t){function e(t,i){$S(this,e);var n=JS(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),aC.bind(n.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return QS(e,t),WS(e,[{key:"setValue",value:function(t){var i=ZS(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),ZS(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(iC),lC=function(t){function e(t,i,n){$S(this,e);var r=JS(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=n,a=r;if(r.__select=document.createElement("select"),jS.isArray(s)){var o={};jS.each(s,(function(t){o[t]=t})),s=o}return jS.each(s,(function(t,e){var i=document.createElement("option");i.innerHTML=e,i.setAttribute("value",t),a.__select.appendChild(i)})),r.updateDisplay(),aC.bind(r.__select,"change",(function(){var t=this.options[this.selectedIndex].value;a.setValue(t)})),r.domElement.appendChild(r.__select),r}return QS(e,t),WS(e,[{key:"setValue",value:function(t){var i=ZS(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return aC.isActive(this.__select)?this:(this.__select.value=this.getValue(),ZS(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(iC),hC=function(t){function e(t,i){$S(this,e);var n=JS(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;function s(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),aC.bind(n.__input,"keyup",s),aC.bind(n.__input,"change",s),aC.bind(n.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),aC.bind(n.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return QS(e,t),WS(e,[{key:"updateDisplay",value:function(){return aC.isActive(this.__input)||(this.__input.value=this.getValue()),ZS(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(iC);function cC(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var dC=function(t){function e(t,i,n){$S(this,e);var r=JS(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=n||{};return r.__min=s.min,r.__max=s.max,r.__step=s.step,jS.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=cC(r.__impliedStep),r}return QS(e,t),WS(e,[{key:"setValue",value:function(t){var i=t;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),ZS(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=cC(t),this}}]),e}(iC);var uC=function(t){function e(t,i,n){$S(this,e);var r=JS(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));r.__truncationSuspended=!1;var s=r,a=void 0;function o(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function l(t){var e=a-t.clientY;s.setValue(s.getValue()+e*s.__impliedStep),a=t.clientY}function h(){aC.unbind(window,"mousemove",l),aC.unbind(window,"mouseup",h),o()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),aC.bind(r.__input,"change",(function(){var t=parseFloat(s.__input.value);jS.isNaN(t)||s.setValue(t)})),aC.bind(r.__input,"blur",(function(){o()})),aC.bind(r.__input,"mousedown",(function(t){aC.bind(window,"mousemove",l),aC.bind(window,"mouseup",h),a=t.clientY})),aC.bind(r.__input,"keydown",(function(t){13===t.keyCode&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1,o())})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return QS(e,t),WS(e,[{key:"updateDisplay",value:function(){var t,i,n;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),i=this.__precision,n=Math.pow(10,i),Math.round(t*n)/n),ZS(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(dC);function fC(t,e,i,n,r){return n+(t-e)/(i-e)*(r-n)}var mC=function(t){function e(t,i,n,r,s){$S(this,e);var a=JS(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:n,max:r,step:s})),o=a;function l(t){t.preventDefault();var e=o.__background.getBoundingClientRect();return o.setValue(fC(t.clientX,e.left,e.right,o.__min,o.__max)),!1}function h(){aC.unbind(window,"mousemove",l),aC.unbind(window,"mouseup",h),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function c(t){var e=t.touches[0].clientX,i=o.__background.getBoundingClientRect();o.setValue(fC(e,i.left,i.right,o.__min,o.__max))}function d(){aC.unbind(window,"touchmove",c),aC.unbind(window,"touchend",d),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),aC.bind(a.__background,"mousedown",(function(t){document.activeElement.blur(),aC.bind(window,"mousemove",l),aC.bind(window,"mouseup",h),l(t)})),aC.bind(a.__background,"touchstart",(function(t){if(1!==t.touches.length)return;aC.bind(window,"touchmove",c),aC.bind(window,"touchend",d),c(t)})),aC.addClass(a.__background,"slider"),aC.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return QS(e,t),WS(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",ZS(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(dC),pC=function(t){function e(t,i,n){$S(this,e);var r=JS(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,aC.bind(r.__button,"click",(function(t){return t.preventDefault(),s.fire(),!1})),aC.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return QS(e,t),WS(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(iC),gC=function(t){function e(t,i){$S(this,e);var n=JS(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));n.__color=new KS(n.getValue()),n.__temp=new KS(0);var r=n;n.domElement=document.createElement("div"),aC.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",aC.bind(n.__input,"keydown",(function(t){13===t.keyCode&&d.call(this)})),aC.bind(n.__input,"blur",d),aC.bind(n.__selector,"mousedown",(function(){aC.addClass(this,"drag").bind(window,"mouseup",(function(){aC.removeClass(r.__selector,"drag")}))})),aC.bind(n.__selector,"touchstart",(function(){aC.addClass(this,"drag").bind(window,"touchend",(function(){aC.removeClass(r.__selector,"drag")}))}));var s,a=document.createElement("div");function o(t){f(t),aC.bind(window,"mousemove",f),aC.bind(window,"touchmove",f),aC.bind(window,"mouseup",h),aC.bind(window,"touchend",h)}function l(t){m(t),aC.bind(window,"mousemove",m),aC.bind(window,"touchmove",m),aC.bind(window,"mouseup",c),aC.bind(window,"touchend",c)}function h(){aC.unbind(window,"mousemove",f),aC.unbind(window,"touchmove",f),aC.unbind(window,"mouseup",h),aC.unbind(window,"touchend",h),u()}function c(){aC.unbind(window,"mousemove",m),aC.unbind(window,"touchmove",m),aC.unbind(window,"mouseup",c),aC.unbind(window,"touchend",c),u()}function d(){var t=HS(this.value);!1!==t?(r.__color.__state=t,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function u(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__saturation_field.getBoundingClientRect(),i=t.touches&&t.touches[0]||t,n=i.clientX,s=i.clientY,a=(n-e.left)/(e.right-e.left),o=1-(s-e.top)/(e.bottom-e.top);return o>1?o=1:o<0&&(o=0),a>1?a=1:a<0&&(a=0),r.__color.v=o,r.__color.s=a,r.setValue(r.__color.toOriginal()),!1}function m(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__hue_field.getBoundingClientRect(),i=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return i>1?i=1:i<0&&(i=0),r.__color.h=360*i,r.setValue(r.__color.toOriginal()),!1}return jS.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),jS.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),jS.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),jS.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),jS.extend(a.style,{width:"100%",height:"100%",background:"none"}),xC(a,"top","rgba(0,0,0,0)","#000"),jS.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(s=n.__hue_field).style.background="",s.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",s.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",jS.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),aC.bind(n.__saturation_field,"mousedown",o),aC.bind(n.__saturation_field,"touchstart",o),aC.bind(n.__field_knob,"mousedown",o),aC.bind(n.__field_knob,"touchstart",o),aC.bind(n.__hue_field,"mousedown",l),aC.bind(n.__hue_field,"touchstart",l),n.__saturation_field.appendChild(a),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return QS(e,t),WS(e,[{key:"updateDisplay",value:function(){var t=HS(this.getValue());if(!1!==t){var e=!1;jS.each(KS.COMPONENTS,(function(i){if(!jS.isUndefined(t[i])&&!jS.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return e=!0,{}}),this),e&&jS.extend(this.__color.__state,t)}jS.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,n=255-i;jS.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,xC(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),jS.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),e}(iC),_C=["-moz-","-o-","-webkit-","-ms-",""];function xC(t,e,i,n){t.style.background="",jS.each(_C,(function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+i+" 0%, "+n+" 100%); "}))}var yC=function(t,e){var i=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var r=i.getElementsByTagName("head")[0];try{r.appendChild(n)}catch(t){}},AC='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',vC=function(t,e){var i=t[e];return jS.isArray(arguments[2])||jS.isObject(arguments[2])?new lC(t,e,arguments[2]):jS.isNumber(i)?jS.isNumber(arguments[2])&&jS.isNumber(arguments[3])?jS.isNumber(arguments[4])?new mC(t,e,arguments[2],arguments[3],arguments[4]):new mC(t,e,arguments[2],arguments[3]):jS.isNumber(arguments[4])?new uC(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new uC(t,e,{min:arguments[2],max:arguments[3]}):jS.isString(i)?new hC(t,e):jS.isFunction(i)?new pC(t,e,""):jS.isBoolean(i)?new oC(t,e):null};var bC=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},wC=function(){function t(){$S(this,t),this.backgroundElement=document.createElement("div"),jS.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),aC.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),jS.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;aC.bind(this.backgroundElement,"click",(function(){e.hide()}))}return WS(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),jS.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",aC.unbind(t.domElement,"webkitTransitionEnd",e),aC.unbind(t.domElement,"transitionend",e),aC.unbind(t.domElement,"oTransitionEnd",e)};aC.bind(this.domElement,"webkitTransitionEnd",e),aC.bind(this.domElement,"transitionend",e),aC.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-aC.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-aC.getHeight(this.domElement)/2+"px"}}]),t}(),MC=function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");yC(MC);var TC="Default",SC=function(){try{return!!window.localStorage}catch(t){return!1}}(),CC=void 0,PC=!0,EC=void 0,kC=!1,DC=[],zC=function t(e){var i=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),aC.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=jS.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=jS.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),jS.isUndefined(n.load)?n.load={preset:TC}:n.preset&&(n.load.preset=n.preset),jS.isUndefined(n.parent)&&n.hideable&&DC.push(this),n.resizable=jS.isUndefined(n.parent)&&n.resizable,n.autoPlace&&jS.isUndefined(n.scrollable)&&(n.scrollable=!0);var r,s=SC&&"true"===localStorage.getItem(FC(this,"isLocal")),a=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:n.load.preset},set:function(t){i.parent?i.getRoot().preset=t:n.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),i.revert()}},width:{get:function(){return n.width},set:function(t){n.width=t,GC(i,t)}},name:{get:function(){return n.name},set:function(t){n.name=t,o&&(o.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?aC.addClass(i.__ul,t.CLASS_CLOSED):aC.removeClass(i.__ul,t.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return s},set:function(t){SC&&(s=t,t?aC.bind(window,"unload",a):aC.unbind(window,"unload",a),localStorage.setItem(FC(i,"isLocal"),t))}}}),jS.isUndefined(n.parent)){if(this.closed=n.closed||!1,aC.addClass(this.domElement,t.CLASS_MAIN),aC.makeSelectable(this.domElement,!1),SC&&s){i.useLocalStorage=!0;var l=localStorage.getItem(FC(this,"gui"));l&&(n.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,aC.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(aC.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(aC.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),aC.bind(this.__closeButton,"click",(function(){i.closed=!i.closed}))}else{void 0===n.closed&&(n.closed=!0);var h=document.createTextNode(n.name);aC.addClass(h,"controller-name"),o=OC(i,h);aC.addClass(this.__ul,t.CLASS_CLOSED),aC.addClass(o,"title"),aC.bind(o,"click",(function(t){return t.preventDefault(),i.closed=!i.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(jS.isUndefined(n.parent)&&(PC&&(EC=document.createElement("div"),aC.addClass(EC,"dg"),aC.addClass(EC,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(EC),PC=!1),EC.appendChild(this.domElement),aC.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||GC(i,n.width)),this.__resizeHandler=function(){i.onResizeDebounced()},aC.bind(window,"resize",this.__resizeHandler),aC.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),aC.bind(this.__ul,"transitionend",this.__resizeHandler),aC.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&UC(this),a=function(){SC&&"true"===localStorage.getItem(FC(i,"isLocal"))&&localStorage.setItem(FC(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=a,n.parent||((r=i.getRoot()).width+=1,jS.defer((function(){r.width-=1})))};function OC(t,e,i){var n=document.createElement("li");return e&&n.appendChild(e),i?t.__ul.insertBefore(n,i):t.__ul.appendChild(n),t.onResize(),n}function RC(t){aC.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&aC.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function LC(t,e){var i=t.__preset_select[t.__preset_select.selectedIndex];i.innerHTML=e?i.value+"*":i.value}function BC(t,e){var i=t.getRoot(),n=i.__rememberedObjects.indexOf(e.object);if(-1!==n){var r=i.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},i.__rememberedObjectIndecesToControllers[n]=r),r[e.property]=e,i.load&&i.load.remembered){var s=i.load.remembered,a=void 0;if(s[t.preset])a=s[t.preset];else{if(!s.Default)return;a=s.Default}if(a[n]&&void 0!==a[n][e.property]){var o=a[n][e.property];e.initialValue=o,e.setValue(o)}}}}function NC(t,e,i,n){if(void 0===e[i])throw new Error('Object "'+e+'" has no property "'+i+'"');var r=void 0;if(n.color)r=new gC(e,i);else{var s=[e,i].concat(n.factoryArgs);r=vC.apply(t,s)}n.before instanceof iC&&(n.before=n.before.__li),BC(t,r),aC.addClass(r.domElement,"c");var a=document.createElement("span");aC.addClass(a,"property-name"),a.innerHTML=r.property;var o=document.createElement("div");o.appendChild(a),o.appendChild(r.domElement);var l=OC(t,o,n.before);return aC.addClass(l,zC.CLASS_CONTROLLER_ROW),r instanceof gC?aC.addClass(l,"color"):aC.addClass(l,YS(r.getValue())),function(t,e,i){if(i.__li=e,i.__gui=t,jS.extend(i,{options:function(e){if(arguments.length>1){var n=i.__li.nextElementSibling;return i.remove(),NC(t,i.object,i.property,{before:n,factoryArgs:[jS.toArray(arguments)]})}if(jS.isArray(e)||jS.isObject(e)){var r=i.__li.nextElementSibling;return i.remove(),NC(t,i.object,i.property,{before:r,factoryArgs:[e]})}},name:function(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof mC){var n=new uC(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});jS.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=i[t],r=n[t];i[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(n,t),e.apply(i,t)}})),aC.addClass(e,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof uC){var r=function(e){if(jS.isNumber(i.__min)&&jS.isNumber(i.__max)){var n=i.__li.firstElementChild.firstElementChild.innerHTML,r=i.__gui.__listening.indexOf(i)>-1;i.remove();var s=NC(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return s.name(n),r&&s.listen(),s}return e};i.min=jS.compose(r,i.min),i.max=jS.compose(r,i.max)}else i instanceof oC?(aC.bind(e,"click",(function(){aC.fakeEvent(i.__checkbox,"click")})),aC.bind(i.__checkbox,"click",(function(t){t.stopPropagation()}))):i instanceof pC?(aC.bind(e,"click",(function(){aC.fakeEvent(i.__button,"click")})),aC.bind(e,"mouseover",(function(){aC.addClass(i.__button,"hover")})),aC.bind(e,"mouseout",(function(){aC.removeClass(i.__button,"hover")}))):i instanceof gC&&(aC.addClass(e,"color"),i.updateDisplay=jS.compose((function(t){return e.style.borderLeftColor=i.__color.toString(),t}),i.updateDisplay),i.updateDisplay());i.setValue=jS.compose((function(e){return t.getRoot().__preset_select&&i.isModified()&&LC(t.getRoot(),!0),e}),i.setValue)}(t,l,r),t.__controllers.push(r),r}function FC(t,e){return document.location.href+"."+e}function IC(t,e,i){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function jC(t,e){e.style.display=t.useLocalStorage?"block":"none"}function qC(t){var e=t.__save_row=document.createElement("li");aC.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),aC.addClass(e,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",aC.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",aC.addClass(n,"button"),aC.addClass(n,"save");var r=document.createElement("span");r.innerHTML="New",aC.addClass(r,"button"),aC.addClass(r,"save-as");var s=document.createElement("span");s.innerHTML="Revert",aC.addClass(s,"button"),aC.addClass(s,"revert");var a=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?jS.each(t.load.remembered,(function(e,i){IC(t,i,i===t.preset)})):IC(t,TC,!1),aC.bind(a,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(a),e.appendChild(i),e.appendChild(n),e.appendChild(r),e.appendChild(s),SC){var o=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(FC(0,"isLocal"))&&l.setAttribute("checked","checked"),jC(t,o),aC.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,jC(t,o)}))}var h=document.getElementById("dg-new-constructor");aC.bind(h,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||CC.hide()})),aC.bind(i,"click",(function(){h.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),CC.show(),h.focus(),h.select()})),aC.bind(n,"click",(function(){t.save()})),aC.bind(r,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),aC.bind(s,"click",(function(){t.revert()}))}function UC(t){var e=void 0;function i(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function n(){aC.removeClass(t.__closeButton,zC.CLASS_DRAG),aC.unbind(window,"mousemove",i),aC.unbind(window,"mouseup",n)}function r(r){return r.preventDefault(),e=r.clientX,aC.addClass(t.__closeButton,zC.CLASS_DRAG),aC.bind(window,"mousemove",i),aC.bind(window,"mouseup",n),!1}t.__resize_handle=document.createElement("div"),jS.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),aC.bind(t.__resize_handle,"mousedown",r),aC.bind(t.__closeButton,"mousedown",r),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function GC(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function HC(t,e){var i={};return jS.each(t.__rememberedObjects,(function(n,r){var s={},a=t.__rememberedObjectIndecesToControllers[r];jS.each(a,(function(t,i){s[i]=e?t.initialValue:t.getValue()})),i[r]=s})),i}function XC(t){0!==t.length&&bC.call(window,(function(){XC(t)})),jS.each(t,(function(t){t.updateDisplay()}))}zC.toggleHide=function(){kC=!kC,jS.each(DC,(function(t){t.domElement.style.display=kC?"none":""}))},zC.CLASS_AUTO_PLACE="a",zC.CLASS_AUTO_PLACE_CONTAINER="ac",zC.CLASS_MAIN="main",zC.CLASS_CONTROLLER_ROW="cr",zC.CLASS_TOO_TALL="taller-than-window",zC.CLASS_CLOSED="closed",zC.CLASS_CLOSE_BUTTON="close-button",zC.CLASS_CLOSE_TOP="close-top",zC.CLASS_CLOSE_BOTTOM="close-bottom",zC.CLASS_DRAG="drag",zC.DEFAULT_WIDTH=245,zC.TEXT_CLOSED="Close Controls",zC.TEXT_OPEN="Open Controls",zC._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||zC.toggleHide()},aC.bind(window,"keydown",zC._keydownHandler,!1),jS.extend(zC.prototype,{add:function(t,e){return NC(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return NC(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;jS.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&EC.removeChild(this.domElement);var t=this;jS.each(this.__folders,(function(e){t.removeFolder(e)})),aC.unbind(window,"keydown",zC._keydownHandler,!1),RC(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new zC(e);this.__folders[t]=i;var n=OC(this,i.domElement);return aC.addClass(n,"folder"),i},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],RC(t);var e=this;jS.each(t.__folders,(function(e){t.removeFolder(e)})),jS.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=aC.getOffset(t.__ul).top,i=0;jS.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(i+=aC.getHeight(e))})),window.innerHeight-e-20<i?(aC.addClass(t.domElement,zC.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(aC.removeClass(t.domElement,zC.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&jS.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:jS.debounce((function(){this.onResize()}),50),remember:function(){if(jS.isUndefined(CC)&&((CC=new wC).domElement.innerHTML=AC),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;jS.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&qC(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&GC(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=HC(this)),t.folders={},jS.each(this.__folders,(function(e,i){t.folders[i]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=HC(this),LC(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=HC(this,!0)),this.load.remembered[t]=HC(this),this.preset=t,IC(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){jS.each(this.__controllers,(function(e){this.getRoot().load.remembered?BC(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),jS.each(this.__folders,(function(t){t.revert(t)})),t||LC(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&XC(this.__listening)},updateDisplay:function(){jS.each(this.__controllers,(function(t){t.updateDisplay()})),jS.each(this.__folders,(function(t){t.updateDisplay()}))}});var VC={Color:KS,math:VS,interpret:HS},YC={Controller:iC,BooleanController:oC,OptionController:lC,StringController:hC,NumberController:dC,NumberControllerBox:uC,NumberControllerSlider:mC,FunctionController:pC,ColorController:gC},$C={dom:aC},WC={GUI:zC},ZC=zC,QC={color:VC,controllers:YC,dom:$C,gui:WC,GUI:ZC},JC=Object.freeze({__proto__:null,color:VC,controllers:YC,dom:$C,gui:WC,GUI:ZC,default:QC});t.BIT=y,t.BasePainter=hl,t.BatchDisplay=Dv,t.BrowserLayout=zv,t.CustomDisplay=class extends Pv{constructor(){super("dummy"),this.frames={}}addFrame(t,e){let i=this.frames[t]||"";this.frames[t]=i+(e+";")}forEachFrame(t){let e=Object.keys(this.frames);for(let i=0;i<e.length;++i){let n=Ii("#"+e[i]);n.empty()||t(n.node())}}createFrame(t){this.beforeCreateFrame(t);let e=Object.keys(this.frames);for(let i=0;i<e.length;++i){if(this.frames[e[i]].indexOf(t+";")>=0)return Ii("#"+e[i]).node()}return null}cleanup(){super.cleanup(),this.forEachFrame((t=>Ii(t).html("")))}},t.DrawOptions=sl,t.FlexibleDisplay=kv,t.GridDisplay=Ev,t.HierarchyPainter=Iw,t.MDIDisplay=Pv,t.ObjectPainter=Vl,t.TH1Painter=hb,t.TH2Painter=ub,t.TH3Painter=mb,t.TRandom=al,t._ensureJSROOT=U,t._loadJSDOM=cl,t.addDrawFunc=yb,t.addMethods=b,t.browser=d,t.buildGUI=function(t,e=""){let i=Ii("string"==typeof t?"#"+t:t);if(i.empty())return Promise.reject(Error("no div for gui found"));i.html("");let n=S(),r="online"==e,a=!1,o=!1;if("draw"==e?r=o=a=!0:("nobrowser"==e||n.has("nobrowser")||i.attr("nobrowser")&&"false"!==i.attr("nobrowser"))&&(a=!0),"true"===i.attr("ignoreurl")&&(m.IgnoreUrlOptions=!0),Uw(),a){let t=n.get("divsize");t&&(t=t.split("x"),2!=t.length&&(t=null)),t?i.style("position","relative").style("width",t[0]+"px").style("height",t[1]+"px"):(Ii("html").style("height","100%"),Ii("body").style("min-height","100%").style("margin",0).style("overflow","hidden"),i.style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0).style("padding",1))}let l=new Iw("root",null);return r&&(l.is_online=o?"draw":"online"),o&&(l.exclude_browser=!0),l.start_without_browser=a,l.startGUI(i).then((()=>{if(!a)return l.initializeBrowser();if(!o)return;let t=null,e=s.getCachedObject||C("GetCachedObject");"function"==typeof e&&(t=w(e())),t&&(l._cached_draw_object=t);let i=n.get("opt","");return n.has("websocket")&&(i+=";websocket"),l.display("",i)})).then((()=>l))},t.buildSvgPath=ol,t.cleanup=th,t.clone=A,t.compressSVG=ll,t.constants=f,t.create=k,t.createHistogram=D,t.createHttpRequest=P,t.createTGraph=O,t.createTHStack=R,t.createTMultiGraph=L,t.createTPolyLine=z,t.d3_select=Ii,t.decodeUrl=S,t.draw=wb,t.drawRawText=Yl,t.drawingJSON=function(t){let e=$l(t);return e?e.produceJSON():""},t.findFunction=C,t.floatToString=rl,t.gStyle=p,t.getAbsPosInCanvas=nl,t.getActivePad=Jl,t.getDocument=g,t.getElementCanvPainter=$l,t.getElementMainPainter=Wl,t.getElementRect=il,t.getHPainter=Fw,t.getMethods=N,t.httpRequest=E,t.injectCode=_,t.internals=s,t.isArrayProto=u,t.isBatchMode=l,t.isNodeJs=c,t.isPromise=q,t.isRootCollection=I,t.loadOpenui5=dv,t.loadScript=x,t.makeSVG=function(t){if(t||(t={}),!t.object)return Promise.reject(Error("No object specified to generate SVG"));function e(e){return e.attr("width",t.width).attr("height",t.height).style("width",t.width+"px").style("height",t.height+"px"),s.svg_3ds=void 0,wb(e.node(),t.object,t.option||"").then((()=>{let i=s.svg_3ds&&s.processSvgWorkarounds;function n(){const t=Ii(this);"none"==t.style("display")&&t.remove()}e.select("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("width",t.width).attr("height",t.height).attr("style",null).attr("class",null).attr("x",null).attr("y",null),i&&e.selectAll("g.root_frame").each(n),e.selectAll("svg").each(n);let r=e.html();return i&&(r=s.processSvgWorkarounds(r)),r=ll(r),th(e.node()),e.remove(),r}))}return t.width||(t.width=1200),t.height||(t.height=800),c()?cl().then((t=>e(t.body.append("div")))):e(Ii("body").append("div").style("visible","hidden"))},t.openFile=Tw,t.parse=w,t.parseMulti=M,t.readStyleFromURL=Uw,t.redraw=Mb,t.registerForResize=fv,t.registerMethods=F,t.resize=Kl,t.selectActivePad=Ql,t.setBatchMode=h,t.setDefaultDrawOpt=function(t,e){let i=Ab("ROOT."+t,0);i&&(i.dflt=e)},t.settings=m,t.toJSON=T,t.version=n,t.version_date=i,t.version_id=e,Object.defineProperty(t,"__esModule",{value:!0})}));
