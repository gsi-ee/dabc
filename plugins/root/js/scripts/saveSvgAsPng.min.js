(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter"],a)}else{if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","saveSvgAsPng.js")}a(JSROOT)}}(function(c){c.sources.push("savepng");var b='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';function f(i){return i&&i.lastIndexOf("http",0)==0&&i.lastIndexOf(window.location.host)==-1}function a(l,n){var j=l.querySelectorAll("image"),m=j.length;if(m==0){return n()}for(var k=0;k<j.length;k++){(function(r){var p=r.getAttributeNS("http://www.w3.org/1999/xlink","href");if(p){if(f(p.value)){console.warn("Cannot render embedded images linking to external hosts: "+p.value);return}}var q=document.createElement("canvas"),i=q.getContext("2d"),o=new Image();p=p||r.getAttribute("href");o.src=p;o.onload=function(){q.width=o.width;q.height=o.height;i.drawImage(o,0,0);r.setAttributeNS("http://www.w3.org/1999/xlink","href",q.toDataURL("image/png"));m--;if(m==0){n()}};o.onerror=function(){console.log("Could not load "+p);m--;if(m==0){n()}}})(j[k])}}function g(k,l){var s="",r=document.styleSheets;for(var p=0;p<r.length;p++){try{var v=r[p].cssRules}catch(t){console.warn("Stylesheet could not be loaded: "+r[p].href);continue}if(v!=null){for(var o=0;o<v.length;o++){var u=v[o];if(typeof(u.style)!="undefined"){var q=null;try{q=k.querySelector(u.selectorText)}catch(n){console.warn('Invalid CSS selector "'+u.selectorText+'"',n)}if(q){var m=l?l(u.selectorText):u.selectorText;s+=m+" { "+u.style.cssText+" }\n"}else{if(u.cssText.match(/^@font-face/)){s+=u.cssText+"\n"}}}}}}return s}function e(j,l,k){var i=(j.viewBox.baseVal&&j.viewBox.baseVal[k])||(l.getAttribute(k)!==null&&!l.getAttribute(k).match(/%$/)&&parseInt(l.getAttribute(k)))||j.getBoundingClientRect()[k]||parseInt(l.style[k])||parseInt(window.getComputedStyle(j).getPropertyValue(k));return(typeof i==="undefined"||i===null||isNaN(parseFloat(i)))?0:i}function d(i){i=encodeURIComponent(i);i=i.replace(/%([0-9A-F]{2})/g,function(j,k){var l=String.fromCharCode("0x"+k);return l==="%"?"%25":l});return decodeURIComponent(i)}function h(k,j,i){j.scale=j.scale||1;var l="http://www.w3.org/2000/xmlns/";a(k,function(){var w=document.createElement("div"),u=k.cloneNode(true),m,v;if(k.tagName=="svg"){m=j.width||e(k,u,"width");v=j.height||e(k,u,"height")}else{if(k.getBBox){var q=k.getBBox();m=q.width;v=q.height;u.setAttribute("transform","translate("+(-q.x)+","+(-q.y)+")");var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.appendChild(u);u=r}else{console.error("Attempted to render non-SVG element",k);return}}u.setAttribute("version","1.1");u.setAttributeNS(l,"xmlns","http://www.w3.org/2000/svg");u.setAttributeNS(l,"xmlns:xlink","http://www.w3.org/1999/xlink");u.setAttribute("width",m*j.scale);u.setAttribute("height",v*j.scale);u.setAttribute("viewBox",[j.left||0,j.top||0,m,v].join(" "));if(j.removeClass){var p=u.querySelectorAll("."+j.removeClass);for(var n=0;n<(p?p.length:0);++n){p[n].parentNode.removeChild(p[n])}}w.appendChild(u);if(j.useGlobalStyle){var t=g(k,j.selectorRemap),x=document.createElement("style"),o=document.createElement("defs");x.setAttribute("type","text/css");x.innerHTML="<![CDATA[\n"+t+"\n]]>";o.appendChild(x);u.insertBefore(o,u.firstChild)}i(w.innerHTML)})}c.saveSvgAsPng=function(j,i,k){i=i||{};h(j,i,function(l){l=l.replace(/url\(\&quot\;\#(\w+)\&quot\;\)/g,"url(#$1)");if(i.result==="svg"){return c.CallBack(k,l)}var m=new Image();m.onload=function(){if(i.result==="image"){return c.CallBack(k,m)}var o=document.createElement("canvas");o.width=m.width;o.height=m.height;var p=o.getContext("2d");if(i&&i.backgroundColor){p.fillStyle=i.backgroundColor;p.fillRect(0,0,o.width,o.height)}p.drawImage(m,0,0);if(i.result==="canvas"){return c.CallBack(k,o)}var n=document.createElement("a");n.download=i.name||"file.png";n.href=o.toDataURL("image/png");document.body.appendChild(n);n.addEventListener("click",function(q){n.parentNode.removeChild(n);c.CallBack(k,true)});n.click()};m.onerror=function(n){c.CallBack(k,null)};m.src="data:image/svg+xml;base64,"+window.btoa(d(b+l))})};return c.Painter}));