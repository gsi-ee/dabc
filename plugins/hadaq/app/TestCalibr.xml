<?xml version="1.0"?>
<dabc version="2">
  <Context host="localhost" name="TestCalibr">
    <Run>
      <lib value="libDabcMbs.so"/>
      <lib value="libDabcHadaq.so"/>  
      <lib value="libDabcHttp.so"/>  
      <logfile value="caltest.log"/>
      <loglevel value="-1"/>
      <loglimit value="1000"/>
      <control value="true"/>
      <threads_layout value="balanced"/>
    </Run>
    
    <HttpServer name="http" port="8090"/>
    
    <!-- If uncommented, all internal manager structures will be published in the web server -->
    <!-- Publisher name="publ" manager="true"/ -->
    
    <!-- If uncommented, profiling will be enabled for all threads -->
    <!-- Thread name="*" publ="true" prof="true"/ -->
    
    <MemoryPool name="Pool">
       <BufferSize value="200000"/>
       <NumBuffers value="1000"/>
    </MemoryPool>

    <Module name="Calibr" class="hadaq::TdcCalibrationModule">    
        <!-- these parameters will force to create inputs/oputputs of module -->
       <NumInputs value="1"/>
       <NumOutputs value="1"/>

       <InputPort name="Input0" url="hld:///data.local1/padiwa/beam801_ch48_0000.hld?loop"/>

       <TDC value="[0x8a00,0x8a01,0x8a02,0x8a03]"/>  
       <Auto value="10000"/>
       <CalibrFile value="local"/>
     </Module>

     <Module name="OnlineServer" class="hadaq::MbsTransmitterModule" auto="true">
       <NumInputs value="1"/>
       <NumOutputs value="1"/>

       <InputPort name="Input0" url="Calibr/Output0" queue="10"/>

       <OutputPort name="Output0" url="mbs://Stream:6002"/>

       <!-- this is 32-bit MBS subevent id, which than can be seen in the analysis. Here procid=0x1f is configured -->
       <SubeventFullId value="0x000001F"/>

       <!-- If true, all events with the same SYNC number will be merged together into same MBS event -->
       <DoMergeSyncedEvents value="true"/>

       <TransmitData width="5" prec="3" low="0" up="50" debug="1"/>
       <TransmitEvents width="4" prec="1" low="0" up="100" debug="1"/>
     </Module>
     
     <!--  Uncomment to see terminal output like old event builder -->
     <!-- Module name="Term" class="hadaq::TerminalModule" period="0.3" clear="true"/ -->

  </Context>

</dabc>
