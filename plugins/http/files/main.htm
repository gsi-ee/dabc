<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

   <meta http-equiv="X-UA-Compatible" content="IE=Edge; text/html">
   <title>Objects hierarchy</title>
   
   <link rel="shortcut icon" href="/httpsys/img/dabc.ico">

   <script src="/jsrootsys/scripts/JSRootCore.js" type="text/javascript" ></script>
   
   <script type='text/javascript'>
   
      function createGUI() {
            var guiCode =
                 '<div id="left-div" class="column">'+
                 '  <h1>Objects hierarchy</h1>'+
                 '  Hierarchy in <a href="h.json">json</a> and <a href="h.xml">xml</a> format<br/>'+
                 '  <div id="fast_buttons"></div><br/>'+        
                 '  <input type="checkbox" name="monitoring" id="monitoring"/> Monitoring'+        
                 '  <input type="checkbox" name="show_history" id="show_history"/> History'+
                 '  <input id="grid_spinner" style="width:60px" value="3"/>' +    
                 '  <div id="dabc_tree_holder"> </div>' +
                 '</div>'+
                 '<div id="separator-div" class="column"></div>' +
                 '<div id="right-div" class="column"></div>';
                 
            $("#mainGUI").empty();     
            $("#mainGUI").append(guiCode);
                 
         
            $("#grid_spinner").spinner({
               min:1, max:5,
               spin: function( event, ui ) { h.SetDisplay('grid'+ui.value,'right-div'); }
            }); 
         
            var h = new DABC.HierarchyPainter("dabc", "dabc_tree_holder");
            
            var interval = h.MonitoringInterval(true); 
            
            if (interval > 0) {
               document.getElementById("monitoring").checked = true;
               document.getElementById("monitoring").disabled = "disabled";
            } 
               
            if (h.HistoryDepth(true) >=0) {
               document.getElementById("show_history").checked = true;
               document.getElementById("show_history").disabled = "disabled";
            }
            
            var itemsarr = [], optionsarr = [];
            var itemname = JSROOT.GetUrlOption("item");
            if (itemname) itemsarr.push(itemname);
            var items = JSROOT.GetUrlOption("items");
            if (items!=null) {
               items = JSON.parse(items);
               for (var i in items) itemsarr.push(items[i]);
            }

            var opt = JSROOT.GetUrlOption("opt");
            if (opt) optionsarr.push(opt);
            var opts = JSROOT.GetUrlOption("opts");
            if (opts!=null) {
               opts = JSON.parse(opts);
               for (var i in opts) optionsarr.push(opts[i]);
            }
            
            h.SetDisplay('grid 3x3', 'right-div');
            
            h.OpenOnline("", function() {
               h.displayAll(itemsarr, optionsarr);
            });
         
            setInterval(function() { h.UpdateDabcElements(); }, interval > 0 ? interval : 3000);
            
            var drag_sum = 0;
   
            var drag_move = d3.behavior.drag()
              .origin(Object)
              .on("dragstart", function() {
                 d3.event.sourceEvent.preventDefault();
                 drag_sum = 0;
               })
              .on("drag", function() {
                 d3.event.sourceEvent.preventDefault();
                 drag_sum += d3.event.dx;
                 d3.event.sourceEvent.stopPropagation();
               })
               .on("dragend", function() {
                  d3.event.sourceEvent.preventDefault();
         
                 var width = d3.select("#left-div").style('width');
                 width = (parseInt(width.substr(0, width.length - 2)) + Number(drag_sum)).toString() + "px";
                 d3.select("#left-div").style('width', width);
         
                 var left = d3.select("#separator-div").style('left');
                 left = parseInt(left.substr(0, left.length - 2)) + Number(drag_sum);
                 d3.select("#separator-div").style('left',left.toString() + "px");
                 d3.select("#right-div").style('left',(left+6).toString() + "px");
         
                 h.CheckResize();
               });
   
            d3.select("#separator-div").call(drag_move);
            
            JSROOT.RegisterForResize(h);
       }

   </script>
</head>

<body onload="JSROOT.AssertPrerequisites('2d;user:/httpsys/scripts/raphael.2.1.0.min.js;/httpsys/scripts/justgage.1.0.1.min.js;/httpsys/files/dabc.css;/httpsys/scripts/dabc.js;', createGUI, 'mainGUI')">
   <div id="mainGUI">
      loading scripts ...
   </div>
</body>
</html>

