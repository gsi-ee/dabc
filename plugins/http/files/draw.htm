<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

   <meta http-equiv="X-UA-Compatible" content="IE=Edge; text/html">
   <title>Element drawing</title>

   <script src="/jsrootsys/scripts/JSRootCore.js" type="text/javascript" ></script>
   
   <script type='text/javascript'>
   
      function CreateRootGui() {
         // analyze URL options
         var drawopt = JSROOT.GetUrlOption("opt");
         
         var monitor = JSROOT.GetUrlOption("monitoring");
         if (monitor == "") monitor = 3000; else
         if (monitor != null) monitor = parseInt(monitor);  
         
         var objpainter = null;
   
         function drawfunction() {
           
            var req = JSROOT.NewHttpRequest("root.json.gz?compact=3", 'text', function(result) {
                var obj = JSROOT.parse(result);
                if (!obj) {
                   if (!objpainter) $('#drawing').append("<h3>Can not get object from the server</h3>"); 
                   return;
                }
                
                document.body.style.cursor = 'wait';
                if (!objpainter) {
                   $('#drawing').empty();
                   objpainter = JSROOT.draw('drawing', obj, drawopt); 
                } else {
                   objpainter.UpdateObject(obj);   
                   objpainter.RedrawFrame();
                }
                document.body.style.cursor = 'auto';
                
            });
           
            // submit request 
            req.send(null);
         }
   
         drawfunction();
   
         if (monitor!=null)
            setInterval(drawfunction, monitor);
   
         JSROOT.RegisterForResize(function() { if (objpainter) objpainter.CheckResize(); });
      }
      
      var dabc_elem = null;
   
      function buildGUI() {
         var req = JSROOT.NewHttpRequest("h.json", 'text', function(result) {
            var node = JSON.parse(result);
            if (!node)
               return $('#drawing').append("<h3>Can not get item description from the server</h3>");
               
            $('#drawing').append("<br/>Get kind " + node._kind);   
            
            if (('_kind' in node) && (node._kind.indexOf("ROOT.")==0)) return CreateRootGui();
            
            var monitor = JSROOT.GetUrlOption("monitoring");
            if (monitor == "") monitor = 3000; else
            if (monitor != null) monitor = parseInt(monitor);
            
            var history = JSROOT.GetUrlOption("history");
            if (history == null) history = -1; else
            if (history == "") history = 0; else history = parseInt(history);
            
            dabc_elem = DABC.CreateDrawElement(node, history);
            
            if (dabc_elem==null) {
               $('#drawing').append("<br/>Cannot draw element");
               return;
            }
            
            if (monitor!=null) dabc_elem.monitoring = true; 
             
            $('#drawing').empty();
            dabc_elem.itemname = "";

            dabc_elem.CreateFrames($('#drawing'));
            
            dabc_elem.RegularCheck();
            
            setInterval(function() { if (dabc_elem) dabc_elem.RegularCheck(); }, (monitor==null) ? 3000 : monitor);
            
            JSROOT.RegisterForResize(dabc_elem);
         });
           
         // submit request 
         req.send(null);
      }
   
      function initGUI() {
         JSROOT.loadScript("/httpsys/scripts/raphael.2.1.0.min.js;/httpsys/scripts/justgage.1.0.1.min.js;/httpsys/files/dabc.css;/httpsys/scripts/dabc.js", buildGUI);
      }
      
   </script>

   
</head>

<body onload="JSROOT.AssertPrerequisites('2d', initGUI)">

   <div id="drawing" style="position:absolute; left:1px; top:1px; bottom:1px; right:1px">
      loading scripts...
   </div>
  
</body>
</html>

