<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MPRACE library: include/mprace/DMAEngineWG.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">mprace</a></div>
<h1>DMAEngineWG.h</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef DMAENGINEWG_H_</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define DMAENGINEWG_H_</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#include "DMAEngine.h"</span>
00005 
00006 <span class="keyword">namespace </span>mprace {
00007 
00008 <span class="keyword">class </span>Driver;
00009 <span class="keyword">class </span>DMADescriptorWG;
00010 
00011 <span class="comment">// This is needed to compile properly in x86_64</span>
00012 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> * puint;
00013 
<a name="l00021"></a><a class="code" href="classmprace_1_1DMAEngineWG.html">00021</a> <span class="keyword">class </span><a class="code" href="classmprace_1_1DMAEngineWG.html">DMAEngineWG</a> : <span class="keyword">public</span> <a class="code" href="classmprace_1_1DMAEngine.html">DMAEngine</a> {
00022 <span class="keyword">public</span>:
00031         <a class="code" href="classmprace_1_1DMAEngineWG.html">DMAEngineWG</a>( <a class="code" href="classmprace_1_1Driver.html">Driver</a>&amp; driver, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *base0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *base1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *inte, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ints );
00032 
00036         <span class="keyword">virtual</span> ~<a class="code" href="classmprace_1_1DMAEngineWG.html">DMAEngineWG</a>();
00037 
00043         <span class="keyword">virtual</span> <span class="keyword">inline</span> DMAStatus getStatus(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channel);
00044 
00050         <span class="keyword">virtual</span> <span class="keywordtype">void</span> reset(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channel);
00051 
00062         <span class="keyword">virtual</span> <span class="keywordtype">void</span> host2board(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <span class="keyword">const</span> <a class="code" href="classmprace_1_1DMABuffer.html">DMABuffer</a>&amp; buf, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset=0, <span class="keyword">const</span> <span class="keywordtype">bool</span> inc=<span class="keyword">true</span>, <span class="keyword">const</span> <span class="keywordtype">bool</span> lock=<span class="keyword">true</span>);
00063 
00074         <span class="keyword">virtual</span> <span class="keywordtype">void</span> board2host(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <a class="code" href="classmprace_1_1DMABuffer.html">DMABuffer</a>&amp; buf, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset=0, <span class="keyword">const</span> <span class="keywordtype">bool</span> inc=<span class="keyword">true</span>, <span class="keyword">const</span> <span class="keywordtype">bool</span> lock=<span class="keyword">true</span>);
00075 
00081         <span class="keyword">virtual</span> <span class="keywordtype">void</span> fillDescriptorList(<a class="code" href="classmprace_1_1DMABuffer.html">DMABuffer</a>&amp; buf);
00082 
00088         <span class="keyword">virtual</span> <span class="keywordtype">void</span> releaseDescriptorList(<a class="code" href="classmprace_1_1DMABuffer.html">DMABuffer</a>&amp; buf);
00089 
<a name="l00095"></a><a class="code" href="classmprace_1_1DMAEngineWG.html#a8">00095</a>         <span class="keyword">inline</span> <span class="keywordtype">void</span> setUseInterrupts(<span class="keywordtype">bool</span> val) { useInterrupts = val; }
00096         
<a name="l00100"></a><a class="code" href="classmprace_1_1DMAEngineWG.html#a9">00100</a>         <span class="keyword">inline</span> <span class="keywordtype">bool</span> getUseInterrupts() { <span class="keywordflow">return</span> useInterrupts; }
00101 
00102 <span class="keyword">protected</span>:
00103         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> STATUS_BUSY;          <span class="comment">//** Status word, Busy bit.</span>
00104         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> STATUS_DONE;          <span class="comment">//** Status word, Done bit.</span>
00105         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_RESET;           <span class="comment">//** Control word, Reset command.</span>
00106         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_END;                     <span class="comment">//** Control word, End bit.</span>
00107         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_INC;                     <span class="comment">//** Control word, Inc bit.</span>
00108         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_LAST;            <span class="comment">//** Control word, Last bit.</span>
00109         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_EDI;                     <span class="comment">//** Control word, EDI bit.</span>
00110         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_EEI;                     <span class="comment">//** Control word, EEI bit.</span>
00111         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_ESEI;            <span class="comment">//** Control word, ESEI bit.</span>
00112         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_UPA;                     <span class="comment">//** Control word, UPA bit.</span>
00113         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_V;                       <span class="comment">//** Control word, V bit.</span>
00114         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CTRL_BAR;                     <span class="comment">//** Control word, BAR number.</span>
00115 
00116         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> INTE_CH0;                     <span class="comment">//** Interrupt Enable Register, Channel 0.</span>
00117         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> INTE_CH1;                     <span class="comment">//** Interrupt Enable Register, Channel 1.</span>
00118 
00119         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> IRQ_SRC_CH0;                  <span class="comment">//** Interrupt Source queue, Channel 0.</span>
00120         <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> IRQ_SRC_CH1;                  <span class="comment">//** Interrupt Source queue, Channel 1.</span>
00121         
00127         <span class="keyword">inline</span> <span class="keywordtype">void</span> write(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channel, <span class="keyword">const</span> DMADescriptorWG&amp; desc);
00128 
00133         <span class="keyword">inline</span> <span class="keywordtype">void</span> waitChannel(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channel);
00134 
00140         <span class="keyword">inline</span> <span class="keywordtype">void</span> enableInterrupt(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channel);
00141 
00147         <span class="keyword">inline</span> <span class="keywordtype">void</span> disableInterrupt(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channel);
00148 
00154         <span class="keyword">inline</span> <span class="keywordtype">void</span> waitForInterrupt(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ch);
00155         
00166         <span class="keywordtype">void</span> sendDescriptorList(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <span class="keyword">const</span> <a class="code" href="classmprace_1_1DMABuffer.html">DMABuffer</a>&amp; buf, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset, <span class="keyword">const</span> <span class="keywordtype">bool</span> inc, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ch);
00167 
00173         <span class="keywordtype">void</span> restoreSavedData(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ch);
00174         
00175 <span class="keyword">private</span>:
00176         <span class="keyword">volatile</span> puint channel[2];      <span class="comment">//** pointers to each channel base address</span>
00177         <span class="keyword">volatile</span> puint inte;            <span class="comment">//** pointer to the Interrupt Enable Register.</span>
00178         <span class="keyword">volatile</span> puint ints;            <span class="comment">//** pointer to the Interupt Status Register.</span>
00179         <span class="keywordtype">bool</span> useInterrupts;                     <span class="comment">//** Use interrupts on the DMA transfer / wait.</span>
00180         
00181         <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00182                 <a class="code" href="classmprace_1_1DMABuffer.html">DMABuffer</a> <span class="keyword">const</span> *saved_buf;                     <span class="comment">//** The buffer related to the saved data.</span>
00183                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> saved_init_descriptor;     <span class="comment">//** Saved descriptor index, when transferring an user buffer.</span>
00184                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> saved_last_descriptor;     <span class="comment">//** Saved descriptor index, when transferring an user buffer.</span>
00185                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> saved_offset;              <span class="comment">//** Saved descriptor offset (at init), when transferring an user buffer.</span>
00186                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> saved_length;              <span class="comment">//** Saved descriptor length (at last), when transferring an user buffer.</span>
00187         } saved_data_t;
00188 
00189         <span class="keywordtype">bool</span> saved[2];                                          <span class="comment">//** Signal that valid data was saved for a channel.</span>
00190         saved_data_t saved_data[2];                     <span class="comment">//** Data saved for a SG transaction in a channel.</span>
00191 }; <span class="comment">/* class DMAEngineWG */</span>
00192 
00193 } <span class="comment">/* namespace mprace */</span>
00194 
00195 <span class="preprocessor">#endif </span><span class="comment">/*DMAENGINEWG_H_*/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Mar 10 11:02:24 2008 for MPRACE library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
