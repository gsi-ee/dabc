<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MPRACE library: include/mprace/DMADescriptorWG.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">mprace</a></div>
<h1>DMADescriptorWG.h</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef DMADESCRIPTORWG_H_</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define DMADESCRIPTORWG_H_</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#include &lt;iostream&gt;</span>
00005 
00006 <span class="preprocessor">#define HIGH(x) (static_cast&lt;unsigned int&gt;((static_cast&lt;unsigned long long&gt;((x))) &gt;&gt; 32))</span>
00007 <span class="preprocessor"></span><span class="preprocessor">#define LOW(x) (static_cast&lt;unsigned int&gt;((static_cast&lt;unsigned long long&gt;((x))) &amp; (0x00000000FFFFFFFF)))</span>
00008 <span class="preprocessor"></span>
00009 <span class="keyword">namespace </span>mprace {
00010 
00011 <span class="keyword">class </span>DMADescriptor;
00012 
00013 <span class="keyword">class </span>DMADescriptorWG : <span class="keyword">public</span> DMADescriptor {
00014 <span class="keyword">public</span>:
00015         DMADescriptorWG() { }
00016 
00017         DMADescriptorWG( <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> pa, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> per, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> host, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> l, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> next, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ctrl)
00018         {
00019                 setPhysicalAddress( pa );
00020                 setPeripheralAddress( per );
00021                 setHostAddress( host );
00022                 setNextDescriptorAddress( next );
00023                 this-&gt;length = l; 
00024                 this-&gt;control = ctrl;
00025         }
00026 
00027         <span class="keyword">virtual</span> ~DMADescriptorWG() { }
00028 
00029         <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> getPhysicalAddress() 
00030                 { <span class="keywordflow">return</span> pa; }
00031 
00032         <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> getHostAddress()
00033                 { <span class="keywordflow">return</span> ((static_cast&lt;unsigned long long&gt;(host_addr_h) &lt;&lt; 32) + host_addr_l); }
00034 
00035         <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> getPheripheralAddress()
00036                 { <span class="keywordflow">return</span> ((static_cast&lt;unsigned long long&gt;(per_addr_h) &lt;&lt; 32) + per_addr_l); }
00037 
00038         <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> getNextDescriptorAddress()
00039                 { <span class="keywordflow">return</span> ((static_cast&lt;unsigned long long&gt;(next_bda_h) &lt;&lt; 32) + next_bda_l); }
00040 
00041         <span class="keyword">inline</span> <span class="keywordtype">void</span> setPhysicalAddress(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> addr) 
00042                 { pa = addr; }
00043 
00044         <span class="keyword">inline</span> <span class="keywordtype">void</span> setPeripheralAddress(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> addr)
00045                 { per_addr_h = HIGH(addr); per_addr_l = LOW(addr); }
00046                 
00047         <span class="keyword">inline</span> <span class="keywordtype">void</span> setHostAddress(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> addr)
00048                 { host_addr_h = HIGH(addr); host_addr_l = LOW(addr); }
00049 
00050         <span class="keyword">inline</span> <span class="keywordtype">void</span> setNextDescriptorAddress(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> addr)
00051                 { next_bda_h = HIGH(addr); next_bda_l = LOW(addr); }
00052 
00053         <span class="keywordtype">void</span> print() {
00054                         std::cout &lt;&lt; std::hex &lt;&lt; getPhysicalAddress() &lt;&lt; <span class="stringliteral">": "</span>
00055                                 &lt;&lt;  getHostAddress() &lt;&lt; <span class="stringliteral">" - "</span> &lt;&lt; this-&gt;length &lt;&lt; std::endl;
00056 
00057 <span class="preprocessor">                #if 0</span>
00058 <span class="preprocessor"></span>                        std::cout &lt;&lt; <span class="keyword">sizeof</span>(*this) &lt;&lt; std::endl;
00059                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ptr = reinterpret_cast&lt;unsigned int *&gt;(const_cast&lt;DMADescriptorWG *&gt;(<span class="keyword">this</span>));
00060                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt; <span class="keyword">sizeof</span>(*this)/4;i++)
00061                                 std::cout &lt;&lt; std::hex &lt;&lt; ptr[i] &lt;&lt; std::dec &lt;&lt; std::endl;
00062 <span class="preprocessor">                #endif</span>
00063 <span class="preprocessor"></span>
00064         }
00065 
<a name="l00070"></a><a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html">00070</a>         <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00071                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> per_addr_h;
00072                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> per_addr_l;
00073                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> host_addr_h;
00074                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> host_addr_l;
00075                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> next_bda_h;
00076                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> next_bda_l;
00077                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length;
00078                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> control;
00079                 
00080                 <span class="comment">// not needed by the descriptor itself, but for linking the lists</span>
00081                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> pa;
00082                 
00083                 <span class="keywordtype">char</span> padding[24];       <span class="comment">// The descriptor list must be aligned with a 4kB boundary</span>
00084                                                         <span class="comment">// so no descriptor crosses it.</span>
00085         } <a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html">descriptor</a>;
00086 
00087         <span class="keywordtype">void</span> printDescriptor(<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html">DMADescriptorWG::descriptor</a>&amp; d) 
00088         {
00089                 std::cout &lt;&lt; std::hex
00090                         &lt;&lt; (<span class="keywordtype">unsigned</span> long)(&amp;d) &lt;&lt; <span class="stringliteral">"("</span> &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o8">pa</a> &lt;&lt; <span class="stringliteral">") : "</span>
00091                         &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o0">per_addr_h</a> &lt;&lt; <span class="stringliteral">" "</span>
00092                         &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o1">per_addr_l</a> &lt;&lt; <span class="stringliteral">" "</span>
00093                         &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o2">host_addr_h</a> &lt;&lt; <span class="stringliteral">" "</span>
00094                         &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o3">host_addr_l</a> &lt;&lt; <span class="stringliteral">" "</span>
00095                         &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o4">next_bda_h</a> &lt;&lt; <span class="stringliteral">" "</span>
00096                         &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o5">next_bda_l</a> &lt;&lt; <span class="stringliteral">" "</span>
00097                         &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o6">length</a> &lt;&lt; <span class="stringliteral">" "</span>
00098                         &lt;&lt; d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o7">control</a> &lt;&lt; std::endl;
00099         }
00100 
00101         <span class="keyword">inline</span> <a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html">DMADescriptorWG::descriptor</a>&amp; copyToDescriptor( <a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html">DMADescriptorWG::descriptor</a>&amp; d )
00102         {
00103                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o0">per_addr_h</a> = this-&gt;per_addr_h;
00104                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o1">per_addr_l</a> = this-&gt;per_addr_l;
00105                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o2">host_addr_h</a> = this-&gt;host_addr_h;
00106                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o3">host_addr_l</a> = this-&gt;host_addr_l;
00107                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o4">next_bda_h</a> = this-&gt;next_bda_h;
00108                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o5">next_bda_l</a> = this-&gt;next_bda_l;
00109                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o6">length</a> = this-&gt;length;
00110                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o7">control</a> = this-&gt;control;
00111                 d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o8">pa</a> = this-&gt;pa;
00112                 
00113                 <span class="keywordflow">return</span> d;
00114         }
00115 
00116         <span class="keyword">inline</span> DMADescriptor&amp; copyFromDescriptor( DMADescriptorWG::descriptor&amp; d )
00117         {
00118                 this-&gt;per_addr_h = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o0">per_addr_h</a>;
00119                 this-&gt;per_addr_l = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o1">per_addr_l</a>;
00120                 this-&gt;host_addr_h = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o2">host_addr_h</a>;
00121                 this-&gt;host_addr_l = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o3">host_addr_l</a>;
00122                 this-&gt;next_bda_h = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o4">next_bda_h</a>;
00123                 this-&gt;next_bda_l = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o5">next_bda_l</a>;
00124                 this-&gt;length = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o6">length</a>;
00125                 this-&gt;control = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o7">control</a>;
00126                 this-&gt;pa = d.<a class="code" href="structmprace_1_1DMADescriptorWG_1_1descriptor.html#o8">pa</a>;
00127                 
00128                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00129         }
00130 
00131         <span class="comment">// Internal data</span>
00132         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> per_addr_h;
00133         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> per_addr_l;
00134         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> host_addr_h;
00135         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> host_addr_l;
00136         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> next_bda_h;
00137         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> next_bda_l;
00138         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> length;
00139         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> control;
00140 
00141 <span class="keyword">protected</span>:
00142 
00143 <span class="keyword">private</span>:
00144         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> pa;
00145         
00146 }; <span class="comment">/* class DMADescriptorWG */</span>
00147 
00148 } <span class="comment">/* namespace mprace */</span>
00149 
00150 
00151 <span class="preprocessor">#endif </span><span class="comment">/*DMADESCRIPTORWG_H_*/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Mar 10 11:02:24 2008 for MPRACE library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
