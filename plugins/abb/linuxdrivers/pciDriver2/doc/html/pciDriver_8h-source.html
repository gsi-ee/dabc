<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PCI Driver: include/driver/pciDriver.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">driver</a></div>
<h1>pciDriver.h</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef PCIDRIVER_H_</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_H_</span>
00003 <span class="preprocessor"></span>
00015 <span class="comment">/*</span>
00016 <span class="comment"> * Change History:</span>
00017 <span class="comment"> * </span>
00018 <span class="comment"> * $Log: pciDriver.h,v $</span>
00019 <span class="comment"> * Revision 1.1  2007/05/14 15:26:18  adamczew</span>
00020 <span class="comment"> * *** empty log message ***</span>
00021 <span class="comment"> *</span>
00022 <span class="comment"> * Revision 1.4  2006/11/17 18:44:42  marcus</span>
00023 <span class="comment"> * Type of SG list can now be selected at runtime. Added type to sglist.</span>
00024 <span class="comment"> *</span>
00025 <span class="comment"> * Revision 1.3  2006/11/17 16:23:02  marcus</span>
00026 <span class="comment"> * Added slot number to the PCI info IOctl.</span>
00027 <span class="comment"> *</span>
00028 <span class="comment"> * Revision 1.2  2006/11/13 12:29:09  marcus</span>
00029 <span class="comment"> * Added a IOctl call, to confiure the interrupt response. (testing pending).</span>
00030 <span class="comment"> * Basic interrupts are now supported.</span>
00031 <span class="comment"> *</span>
00032 <span class="comment"> * Revision 1.1  2006/10/10 14:46:52  marcus</span>
00033 <span class="comment"> * Initial commit of the new pciDriver for kernel 2.6</span>
00034 <span class="comment"> *</span>
00035 <span class="comment"> * Revision 1.7  2006/10/06 15:18:06  marcus</span>
00036 <span class="comment"> * Updated PCI info and PCI cmd</span>
00037 <span class="comment"> *</span>
00038 <span class="comment"> * Revision 1.6  2006/09/25 16:51:07  marcus</span>
00039 <span class="comment"> * Added PCI config IOctls, and implemented basic mmap functions.</span>
00040 <span class="comment"> *</span>
00041 <span class="comment"> * Revision 1.5  2006/09/18 17:13:12  marcus</span>
00042 <span class="comment"> * backup commit.</span>
00043 <span class="comment"> *</span>
00044 <span class="comment"> * Revision 1.4  2006/09/15 15:44:41  marcus</span>
00045 <span class="comment"> * backup commit.</span>
00046 <span class="comment"> *</span>
00047 <span class="comment"> * Revision 1.3  2006/08/15 11:40:02  marcus</span>
00048 <span class="comment"> * backup commit.</span>
00049 <span class="comment"> *</span>
00050 <span class="comment"> * Revision 1.2  2006/08/12 18:28:42  marcus</span>
00051 <span class="comment"> * Sync with the laptop</span>
00052 <span class="comment"> *</span>
00053 <span class="comment"> * Revision 1.1  2006/08/11 15:30:46  marcus</span>
00054 <span class="comment"> * Sync with the laptop</span>
00055 <span class="comment"> *</span>
00056 <span class="comment"> */</span>
00057 
00058 <span class="preprocessor">#include &lt;linux/ioctl.h&gt;</span>
00059 
00060 <span class="comment">/* Possible values for ioctl commands */</span>
00061 
00062 <span class="comment">/* PCI mmap areas */</span>
00063 <span class="preprocessor">#define PCIDRIVER_BAR0          0</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_BAR1          1</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_BAR2          2</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_BAR3          3</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_BAR4          4</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_BAR5          5</span>
00069 <span class="preprocessor"></span>
00070 <span class="comment">/* mmap mode of the device */</span>
00071 <span class="preprocessor">#define PCIDRIVER_MMAP_PCI      0</span>
00072 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_MMAP_KMEM 1</span>
00073 <span class="preprocessor"></span>
00074 <span class="comment">/* Direction of a DMA operation */</span>
00075 <span class="preprocessor">#define PCIDRIVER_DMA_BIDIRECTIONAL 0</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_DMA_TODEVICE          1</span>
00077 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_DMA_FROMDEVICE        2</span>
00078 <span class="preprocessor"></span>
00079 <span class="comment">/* Possible sizes in a PCI command */</span>
00080 <span class="preprocessor">#define PCIDRIVER_PCI_CFG_SZ_BYTE  1</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_PCI_CFG_SZ_WORD  2</span>
00082 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_PCI_CFG_SZ_DWORD 3</span>
00083 <span class="preprocessor"></span>
00084 <span class="comment">/* Possible types of SG lists */</span>
00085 <span class="preprocessor">#define PCIDRIVER_SG_NONMERGED 0</span>
00086 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_SG_MERGED 1</span>
00087 <span class="preprocessor"></span>
00088 <span class="comment">/* Types */</span>
00089 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00090         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pa;
00091         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size;
00092         <span class="keywordtype">int</span> handle_id;
00093 } kmem_handle_t;
00094 
00095 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00096         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;
00097         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size;
00098 } umem_sgentry_t;
00099 
00100 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00101         <span class="keywordtype">int</span> handle_id;
00102         <span class="keywordtype">int</span> type;
00103         <span class="keywordtype">int</span> nents;
00104         umem_sgentry_t *sg;
00105 } umem_sglist_t;
00106 
00107 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00108         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> vma;
00109         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size;
00110         <span class="keywordtype">int</span> handle_id;
00111         <span class="keywordtype">int</span> dir;
00112 } umem_handle_t;
00113 
00114 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00115         kmem_handle_t handle;
00116         <span class="keywordtype">int</span> dir;
00117 } kmem_sync_t;
00118 
00119 
00120 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00121         <span class="keywordtype">int</span> size;
00122         <span class="keywordtype">int</span> addr;
00123         <span class="keyword">union </span>{
00124                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte;
00125                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> word;
00126                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dword;     <span class="comment">/* not strict C, but if not can have problems */</span>
00127         } val;
00128 } pci_cfg_cmd;
00129 
00130 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00131         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> vendor_id;
00132         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> device_id;
00133         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> bus;
00134         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> slot;
00135         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> devfn;
00136         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> interrupt_pin;
00137         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> interrupt_line;
00138         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> irq;
00139         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> bar_start[6];
00140         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> bar_length[6];
00141 } pci_board_info;
00142 
00143 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00144         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> test_bar;
00145         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test_offset;
00146         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test_mask;
00147 
00148         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ack_bar;
00149         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ack_offset;
00150         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ack_mask;
00151 } int_descriptor_t;
00152 
00153 <span class="comment">/* ioctl interface */</span>
00154 <span class="comment">/* See documentation for a detailed usage explanation */</span>
00155 
00156 <span class="comment">/* </span>
00157 <span class="comment"> * one of the problems of ioctl, is that requires a type definition.</span>
00158 <span class="comment"> * This type is only 8-bits wide, and half-documented in </span>
00159 <span class="comment"> * &lt;linux-src&gt;/Documentation/ioctl-number.txt.</span>
00160 <span class="comment"> * previous SHL -&gt; 'S' definition, conflicts with several devices,</span>
00161 <span class="comment"> * so I changed it to be pci -&gt; 'p', in the range 0xA0-AF</span>
00162 <span class="comment"> */</span>
00163 <span class="preprocessor">#define PCIDRIVER_IOC_MAGIC 'p'</span>
00164 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_BASE  0xA0</span>
00165 <span class="preprocessor"></span>
00166 <span class="preprocessor">#define PCIDRIVER_IOC_MMAP_MODE  _IO(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 0 )</span>
00167 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_MMAP_AREA  _IO(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 1 )</span>
00168 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_KMEM_ALLOC _IOWR( PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 2, kmem_handle_t * )</span>
00169 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_KMEM_FREE  _IOW(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 3, kmem_handle_t * )</span>
00170 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_KMEM_SYNC  _IOW(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 4, kmem_sync_t * )</span>
00171 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_UMEM_SGMAP _IOWR( PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 5, umem_handle_t * )</span>
00172 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_UMEM_SGUNMAP _IOW(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 6, umem_handle_t * )</span>
00173 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_UMEM_SGGET _IOWR( PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 7, umem_sglist_t * )</span>
00174 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_UMEM_SYNC  _IOW(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 8, umem_handle_t * )</span>
00175 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_WAITI      _IO(   PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 9 )</span>
00176 <span class="preprocessor"></span>
00177 <span class="comment">/* And now, the methods to access the PCI configuration area */</span>
00178 <span class="preprocessor">#define PCIDRIVER_IOC_PCI_CFG_RD  _IOWR(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 10, pci_cfg_cmd * )</span>
00179 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_PCI_CFG_WR  _IOWR(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 11, pci_cfg_cmd * )</span>
00180 <span class="preprocessor"></span><span class="preprocessor">#define PCIDRIVER_IOC_PCI_INFO    _IOWR(  PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 12, pci_board_info * )</span>
00181 <span class="preprocessor"></span>
00182 <span class="comment">/* Used to describe the flags and register for interrupt checking */</span>
00183 <span class="preprocessor">#define PCIDRIVER_IOC_INTCONF    _IOW(   PCIDRIVER_IOC_MAGIC, PCIDRIVER_IOC_BASE + 13, int_descriptor_t * )</span>
00184 <span class="preprocessor"></span>
00185 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 25 16:47:25 2007 for PCI Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
